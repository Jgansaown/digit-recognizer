var Bo=Object.defineProperty;var jo=(i,t,e)=>t in i?Bo(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Z=(i,t,e)=>(jo(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function e(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function s(h){if(h.ep)return;h.ep=!0;const g=e(h);fetch(h.href,g)}})();function zt(){}function Er(i){return i()}function os(){return Object.create(null)}function Pe(i){i.forEach(Er)}function Fr(i){return typeof i=="function"}function gi(i,t){return i!=i?t==t:i!==t||i&&typeof i=="object"||typeof i=="function"}function zo(i){return Object.keys(i).length===0}function Ct(i,t){i.appendChild(t)}function xt(i,t,e){i.insertBefore(t,e||null)}function mt(i){i.parentNode&&i.parentNode.removeChild(i)}function pt(i){return document.createElement(i)}function Wt(i){return document.createTextNode(i)}function Nt(){return Wt(" ")}function ce(i,t,e,s){return i.addEventListener(t,e,s),()=>i.removeEventListener(t,e,s)}function Ht(i,t,e){e==null?i.removeAttribute(t):i.getAttribute(t)!==e&&i.setAttribute(t,e)}function qt(i){return i===""?null:+i}function Wo(i){return Array.from(i.childNodes)}function as(i,t){t=""+t,i.data!==t&&(i.data=t)}function Bt(i,t){i.value=t??""}function ls(i,t,e){for(let s=0;s<i.options.length;s+=1){const h=i.options[s];if(h.__value===t){h.selected=!0;return}}(!e||t!==void 0)&&(i.selectedIndex=-1)}function Ho(i){const t=i.querySelector(":checked");return t&&t.__value}let si;function Qe(i){si=i}function No(){if(!si)throw new Error("Function called outside component initialization");return si}function Lr(i){No().$$.on_mount.push(i)}const Fe=[],ri=[];let Le=[];const Sn=[],Vo=Promise.resolve();let wn=!1;function Xo(){wn||(wn=!0,Vo.then(Rr))}function Gi(i){Le.push(i)}function Hn(i){Sn.push(i)}const hn=new Set;let De=0;function Rr(){if(De!==0)return;const i=si;do{try{for(;De<Fe.length;){const t=Fe[De];De++,Qe(t),Yo(t.$$)}}catch(t){throw Fe.length=0,De=0,t}for(Qe(null),Fe.length=0,De=0;ri.length;)ri.pop()();for(let t=0;t<Le.length;t+=1){const e=Le[t];hn.has(e)||(hn.add(e),e())}Le.length=0}while(Fe.length);for(;Sn.length;)Sn.pop()();wn=!1,hn.clear(),Qe(i)}function Yo(i){if(i.fragment!==null){i.update(),Pe(i.before_update);const t=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,t),i.after_update.forEach(Gi)}}function Uo(i){const t=[],e=[];Le.forEach(s=>i.indexOf(s)===-1?t.push(s):e.push(s)),e.forEach(s=>s()),Le=t}const Bi=new Set;let xe;function Go(){xe={r:0,c:[],p:xe}}function $o(){xe.r||Pe(xe.c),xe=xe.p}function Te(i,t){i&&i.i&&(Bi.delete(i),i.i(t))}function Ie(i,t,e,s){if(i&&i.o){if(Bi.has(i))return;Bi.add(i),xe.c.push(()=>{Bi.delete(i),s&&(e&&i.d(1),s())}),i.o(t)}else s&&s()}function Nn(i,t,e){const s=i.$$.props[t];s!==void 0&&(i.$$.bound[s]=e,e(i.$$.ctx[s]))}function nn(i){i&&i.c()}function pi(i,t,e){const{fragment:s,after_update:h}=i.$$;s&&s.m(t,e),Gi(()=>{const g=i.$$.on_mount.map(Er).filter(Fr);i.$$.on_destroy?i.$$.on_destroy.push(...g):Pe(g),i.$$.on_mount=[]}),h.forEach(Gi)}function mi(i,t){const e=i.$$;e.fragment!==null&&(Uo(e.after_update),Pe(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function qo(i,t){i.$$.dirty[0]===-1&&(Fe.push(i),Xo(),i.$$.dirty.fill(0)),i.$$.dirty[t/31|0]|=1<<t%31}function vi(i,t,e,s,h,g,m,o=[-1]){const n=si;Qe(i);const l=i.$$={fragment:null,ctx:[],props:g,update:zt,not_equal:h,bound:os(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(n?n.$$.context:[])),callbacks:os(),dirty:o,skip_bound:!1,root:t.target||n.$$.root};m&&m(l.root);let u=!1;if(l.ctx=e?e(i,t.props||{},(r,c,...a)=>{const f=a.length?a[0]:c;return l.ctx&&h(l.ctx[r],l.ctx[r]=f)&&(!l.skip_bound&&l.bound[r]&&l.bound[r](f),u&&qo(i,r)),c}):[],l.update(),u=!0,Pe(l.before_update),l.fragment=s?s(l.ctx):!1,t.target){if(t.hydrate){const r=Wo(t.target);l.fragment&&l.fragment.l(r),r.forEach(mt)}else l.fragment&&l.fragment.c();t.intro&&Te(i.$$.fragment),pi(i,t.target,t.anchor),Rr()}Qe(n)}class _i{constructor(){Z(this,"$$");Z(this,"$$set")}$destroy(){mi(this,1),this.$destroy=zt}$on(t,e){if(!Fr(e))return zt;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const h=s.indexOf(e);h!==-1&&s.splice(h,1)}}$set(t){this.$$set&&!zo(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ko="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ko);function Jo(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var h=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(e,s,h.get?h:{enumerable:!0,get:function(){return i[s]}})}),e}var Qo={};const Zo={},ta=Object.freeze(Object.defineProperty({__proto__:null,default:Zo},Symbol.toStringTag,{value:"Module"})),cn=Jo(ta);(function(i){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(i.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var e=cn,s=new e.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=s.document,t.jsdomImplForWrapper=cn.implForWrapper,t.nodeCanvas=cn.Canvas,t.window=s,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function o(a,f){if(this.__eventListeners[a]){var p=this.__eventListeners[a];f?p[p.indexOf(f)]=!1:t.util.array.fill(p,!1)}}function n(a,f){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var p in a)this.on(p,a[p]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(f);return this}function l(a,f){var p=(function(){f.apply(this,arguments),this.off(a,p)}).bind(this);this.on(a,p)}function u(a,f){if(arguments.length===1)for(var p in a)l.call(this,p,a[p]);else l.call(this,a,f);return this}function r(a,f){if(!this.__eventListeners)return this;if(arguments.length===0)for(a in this.__eventListeners)o.call(this,a);else if(arguments.length===1&&typeof arguments[0]=="object")for(var p in a)o.call(this,p,a[p]);else o.call(this,a,f);return this}function c(a,f){if(!this.__eventListeners)return this;var p=this.__eventListeners[a];if(!p)return this;for(var d=0,v=p.length;d<v;d++)p[d]&&p[d].call(this,f||{});return this.__eventListeners[a]=p.filter(function(_){return _!==!1}),this}t.Observable={fire:c,on:n,once:u,off:r}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var o=0,n=arguments.length;o<n;o++)this._onObjectAdded(arguments[o]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(o,n,l){var u=this._objects;return l?u[n]=o:u.splice(n,0,o),this._onObjectAdded&&this._onObjectAdded(o),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var o=this._objects,n,l=!1,u=0,r=arguments.length;u<r;u++)n=o.indexOf(arguments[u]),n!==-1&&(l=!0,o.splice(n,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(o,n){for(var l=this.getObjects(),u=0,r=l.length;u<r;u++)o.call(n,l[u],u,l);return this},getObjects:function(o){return typeof o>"u"?this._objects.concat():this._objects.filter(function(n){return n.type===o})},item:function(o){return this._objects[o]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(o,n){return this._objects.indexOf(o)>-1?!0:n?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(o,!0)}):!1},complexity:function(){return this._objects.reduce(function(o,n){return o+=n.complexity?n.complexity():0,o},0)}},t.CommonMethods={_setOptions:function(o){for(var n in o)this.set(n,o[n])},_initGradient:function(o,n){o&&o.colorStops&&!(o instanceof t.Gradient)&&this.set(n,new t.Gradient(o))},_initPattern:function(o,n,l){o&&o.source&&!(o instanceof t.Pattern)?this.set(n,new t.Pattern(o,l)):l&&l()},_setObject:function(o){for(var n in o)this._set(n,o[n])},set:function(o,n){return typeof o=="object"?this._setObject(o):this._set(o,n),this},_set:function(o,n){this[o]=n},toggle:function(o){var n=this.get(o);return typeof n=="boolean"&&this.set(o,!n),this},get:function(o){return this[o]}},function(o){var n=Math.sqrt,l=Math.atan2,u=Math.pow,r=Math.PI/180,c=Math.PI/2;t.util={cos:function(a){if(a===0)return 1;a<0&&(a=-a);var f=a/c;switch(f){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(a===0)return 0;var f=a/c,p=1;switch(a<0&&(p=-1),f){case 1:return p;case 2:return 0;case 3:return-p}return Math.sin(a)},removeFromArray:function(a,f){var p=a.indexOf(f);return p!==-1&&a.splice(p,1),a},getRandomInt:function(a,f){return Math.floor(Math.random()*(f-a+1))+a},degreesToRadians:function(a){return a*r},radiansToDegrees:function(a){return a/r},rotatePoint:function(a,f,p){var d=new t.Point(a.x-f.x,a.y-f.y),v=t.util.rotateVector(d,p);return new t.Point(v.x,v.y).addEquals(f)},rotateVector:function(a,f){var p=t.util.sin(f),d=t.util.cos(f),v=a.x*d-a.y*p,_=a.x*p+a.y*d;return{x:v,y:_}},createVector:function(a,f){return new t.Point(f.x-a.x,f.y-a.y)},calcAngleBetweenVectors:function(a,f){return Math.acos((a.x*f.x+a.y*f.y)/(Math.hypot(a.x,a.y)*Math.hypot(f.x,f.y)))},getHatVector:function(a){return new t.Point(a.x,a.y).multiply(1/Math.hypot(a.x,a.y))},getBisector:function(a,f,p){var d=t.util.createVector(a,f),v=t.util.createVector(a,p),_=t.util.calcAngleBetweenVectors(d,v),b=t.util.calcAngleBetweenVectors(t.util.rotateVector(d,_),v),y=_*(b===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(d,y)),angle:_}},projectStrokeOnPoints:function(a,f,p){var d=[],v=f.strokeWidth/2,_=f.strokeUniform?new t.Point(1/f.scaleX,1/f.scaleY):new t.Point(1,1),b=function(y){var x=v/Math.hypot(y.x,y.y);return new t.Point(y.x*x*_.x,y.y*x*_.y)};return a.length<=1||a.forEach(function(y,x){var C=new t.Point(y.x,y.y),S,O;x===0?(O=a[x+1],S=p?b(t.util.createVector(O,C)).addEquals(C):a[a.length-1]):x===a.length-1?(S=a[x-1],O=p?b(t.util.createVector(S,C)).addEquals(C):a[0]):(S=a[x-1],O=a[x+1]);var E=t.util.getBisector(C,S,O),R=E.vector,W=E.angle,X,Q;if(f.strokeLineJoin==="miter"&&(X=-v/Math.sin(W/2),Q=new t.Point(R.x*X*_.x,R.y*X*_.y),Math.hypot(Q.x,Q.y)/v<=f.strokeMiterLimit)){d.push(C.add(Q)),d.push(C.subtract(Q));return}X=-v*Math.SQRT2,Q=new t.Point(R.x*X*_.x,R.y*X*_.y),d.push(C.add(Q)),d.push(C.subtract(Q))}),d},transformPoint:function(a,f,p){return p?new t.Point(f[0]*a.x+f[2]*a.y,f[1]*a.x+f[3]*a.y):new t.Point(f[0]*a.x+f[2]*a.y+f[4],f[1]*a.x+f[3]*a.y+f[5])},makeBoundingBoxFromPoints:function(a,f){if(f)for(var p=0;p<a.length;p++)a[p]=t.util.transformPoint(a[p],f);var d=[a[0].x,a[1].x,a[2].x,a[3].x],v=t.util.array.min(d),_=t.util.array.max(d),b=_-v,y=[a[0].y,a[1].y,a[2].y,a[3].y],x=t.util.array.min(y),C=t.util.array.max(y),S=C-x;return{left:v,top:x,width:b,height:S}},invertTransform:function(a){var f=1/(a[0]*a[3]-a[1]*a[2]),p=[f*a[3],-f*a[1],-f*a[2],f*a[0]],d=t.util.transformPoint({x:a[4],y:a[5]},p,!0);return p[4]=-d.x,p[5]=-d.y,p},toFixed:function(a,f){return parseFloat(Number(a).toFixed(f))},parseUnit:function(a,f){var p=/\D{0,2}$/.exec(a),d=parseFloat(a);switch(f||(f=t.Text.DEFAULT_SVG_FONT_SIZE),p[0]){case"mm":return d*t.DPI/25.4;case"cm":return d*t.DPI/2.54;case"in":return d*t.DPI;case"pt":return d*t.DPI/72;case"pc":return d*t.DPI/72*12;case"em":return d*f;default:return d}},falseFunction:function(){return!1},getKlass:function(a,f){return a=t.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),t.util.resolveNamespace(f)[a]},getSvgAttributes:function(a){var f=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":f=f.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":f=f.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":f=f.concat(["offset","stop-color","stop-opacity"]);break}return f},resolveNamespace:function(a){if(!a)return t;var f=a.split("."),p=f.length,d,v=o||t.window;for(d=0;d<p;++d)v=v[f[d]];return v},loadImage:function(a,f,p,d){if(!a){f&&f.call(p,a);return}var v=t.util.createImage(),_=function(){f&&f.call(p,v,!1),v=v.onload=v.onerror=null};v.onload=_,v.onerror=function(){t.log("Error loading "+v.src),f&&f.call(p,null,!0),v=v.onload=v.onerror=null},a.indexOf("data")!==0&&d!==void 0&&d!==null&&(v.crossOrigin=d),a.substring(0,14)==="data:image/svg"&&(v.onload=null,t.util.loadImageInDom(v,_)),v.src=a},loadImageInDom:function(a,f){var p=t.document.createElement("div");p.style.width=p.style.height="1px",p.style.left=p.style.top="-100%",p.style.position="absolute",p.appendChild(a),t.document.querySelector("body").appendChild(p),a.onload=function(){f(),p.parentNode.removeChild(p),p=null}},enlivenObjects:function(a,f,p,d){a=a||[];var v=[],_=0,b=a.length;function y(){++_===b&&f&&f(v.filter(function(x){return x}))}if(!b){f&&f(v);return}a.forEach(function(x,C){if(!x||!x.type){y();return}var S=t.util.getKlass(x.type,p);S.fromObject(x,function(O,E){E||(v[C]=O),d&&d(x,O,E),y()})})},enlivenObjectEnlivables:function(a,f,p){var d=t.Object.ENLIVEN_PROPS.filter(function(v){return!!a[v]});t.util.enlivenObjects(d.map(function(v){return a[v]}),function(v){var _={};d.forEach(function(b,y){_[b]=v[y],f&&(f[b]=v[y])}),p&&p(_)})},enlivenPatterns:function(a,f){a=a||[];function p(){++v===_&&f&&f(d)}var d=[],v=0,_=a.length;if(!_){f&&f(d);return}a.forEach(function(b,y){b&&b.source?new t.Pattern(b,function(x){d[y]=x,p()}):(d[y]=b,p())})},groupSVGElements:function(a,f,p){var d;return a&&a.length===1?(typeof p<"u"&&(a[0].sourcePath=p),a[0]):(f&&(f.width&&f.height?f.centerPoint={x:f.width/2,y:f.height/2}:(delete f.width,delete f.height)),d=new t.Group(a,f),typeof p<"u"&&(d.sourcePath=p),d)},populateWithProperties:function(a,f,p){if(p&&Array.isArray(p))for(var d=0,v=p.length;d<v;d++)p[d]in a&&(f[p[d]]=a[p[d]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(a){var f=t.util.createCanvasElement();return f.width=a.width,f.height=a.height,f.getContext("2d").drawImage(a,0,0),f},toDataURL:function(a,f,p){return a.toDataURL("image/"+f,p)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(a,f,p){return[a[0]*f[0]+a[2]*f[1],a[1]*f[0]+a[3]*f[1],a[0]*f[2]+a[2]*f[3],a[1]*f[2]+a[3]*f[3],p?0:a[0]*f[4]+a[2]*f[5]+a[4],p?0:a[1]*f[4]+a[3]*f[5]+a[5]]},qrDecompose:function(a){var f=l(a[1],a[0]),p=u(a[0],2)+u(a[1],2),d=n(p),v=(a[0]*a[3]-a[2]*a[1])/d,_=l(a[0]*a[2]+a[1]*a[3],p);return{angle:f/r,scaleX:d,scaleY:v,skewX:_/r,skewY:0,translateX:a[4],translateY:a[5]}},calcRotateMatrix:function(a){if(!a.angle)return t.iMatrix.concat();var f=t.util.degreesToRadians(a.angle),p=t.util.cos(f),d=t.util.sin(f);return[p,d,-d,p,0,0]},calcDimensionsMatrix:function(a){var f=typeof a.scaleX>"u"?1:a.scaleX,p=typeof a.scaleY>"u"?1:a.scaleY,d=[a.flipX?-f:f,0,0,a.flipY?-p:p,0,0],v=t.util.multiplyTransformMatrices,_=t.util.degreesToRadians;return a.skewX&&(d=v(d,[1,0,Math.tan(_(a.skewX)),1],!0)),a.skewY&&(d=v(d,[1,Math.tan(_(a.skewY)),0,1],!0)),d},composeMatrix:function(a){var f=[1,0,0,1,a.translateX||0,a.translateY||0],p=t.util.multiplyTransformMatrices;return a.angle&&(f=p(f,t.util.calcRotateMatrix(a))),(a.scaleX!==1||a.scaleY!==1||a.skewX||a.skewY||a.flipX||a.flipY)&&(f=p(f,t.util.calcDimensionsMatrix(a))),f},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},isTransparent:function(a,f,p,d){d>0&&(f>d?f-=d:f=0,p>d?p-=d:p=0);var v=!0,_,b,y=a.getImageData(f,p,d*2||1,d*2||1),x=y.data.length;for(_=3;_<x&&(b=y.data[_],v=b<=0,v!==!1);_+=4);return y=null,v},parsePreserveAspectRatioAttribute:function(a){var f="meet",p="Mid",d="Mid",v=a.split(" "),_;return v&&v.length&&(f=v.pop(),f!=="meet"&&f!=="slice"?(_=f,f="meet"):v.length&&(_=v.pop())),p=_!=="none"?_.slice(1,4):"none",d=_!=="none"?_.slice(5,8):"none",{meetOrSlice:f,alignX:p,alignY:d}},clearFabricFontCache:function(a){a=(a||"").toLowerCase(),a?t.charWidthsCache[a]&&delete t.charWidthsCache[a]:t.charWidthsCache={}},limitDimsByArea:function(a,f){var p=Math.sqrt(f*a),d=Math.floor(f/p);return{x:Math.floor(p),y:d}},capValue:function(a,f,p){return Math.max(a,Math.min(f,p))},findScaleToFit:function(a,f){return Math.min(f.width/a.width,f.height/a.height)},findScaleToCover:function(a,f){return Math.max(f.width/a.width,f.height/a.height)},matrixToSVG:function(a){return"matrix("+a.map(function(f){return t.util.toFixed(f,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(a,f){var p=t.util.invertTransform(f),d=t.util.multiplyTransformMatrices(p,a.calcOwnMatrix());t.util.applyTransformToObject(a,d)},addTransformToObject:function(a,f){t.util.applyTransformToObject(a,t.util.multiplyTransformMatrices(f,a.calcOwnMatrix()))},applyTransformToObject:function(a,f){var p=t.util.qrDecompose(f),d=new t.Point(p.translateX,p.translateY);a.flipX=!1,a.flipY=!1,a.set("scaleX",p.scaleX),a.set("scaleY",p.scaleY),a.skewX=p.skewX,a.skewY=p.skewY,a.angle=p.angle,a.setPositionByOrigin(d,"center","center")},sizeAfterTransform:function(a,f,p){var d=a/2,v=f/2,_=[{x:-d,y:-v},{x:d,y:-v},{x:-d,y:v},{x:d,y:v}],b=t.util.calcDimensionsMatrix(p),y=t.util.makeBoundingBoxFromPoints(_,b);return{x:y.width,y:y.height}},mergeClipPaths:function(a,f){var p=a,d=f;p.inverted&&!d.inverted&&(p=f,d=a),t.util.applyTransformToObject(d,t.util.multiplyTransformMatrices(t.util.invertTransform(p.calcTransformMatrix()),d.calcTransformMatrix()));var v=p.inverted&&d.inverted;return v&&(p.inverted=d.inverted=!1),new t.Group([p],{clipPath:d,inverted:v})},hasStyleChanged:function(a,f,p){return p=p||!1,a.fill!==f.fill||a.stroke!==f.stroke||a.strokeWidth!==f.strokeWidth||a.fontSize!==f.fontSize||a.fontFamily!==f.fontFamily||a.fontWeight!==f.fontWeight||a.fontStyle!==f.fontStyle||a.textBackgroundColor!==f.textBackgroundColor||a.deltaY!==f.deltaY||p&&(a.overline!==f.overline||a.underline!==f.underline||a.linethrough!==f.linethrough)},stylesToArray:function(p,f){for(var p=t.util.object.clone(p,!0),d=f.split(`
`),v=-1,_={},b=[],y=0;y<d.length;y++){if(!p[y]){v+=d[y].length;continue}for(var x=0;x<d[y].length;x++){v++;var C=p[y][x];if(C&&Object.keys(C).length>0){var S=t.util.hasStyleChanged(_,C,!0);S?b.push({start:v,end:v+1,style:C}):b[b.length-1].end++}_=C||{}}}return b},stylesFromArray:function(a,f){if(!Array.isArray(a))return a;for(var p=f.split(`
`),d=-1,v=0,_={},b=0;b<p.length;b++)for(var y=0;y<p[b].length;y++)d++,a[v]&&a[v].start<=d&&d<a[v].end&&(_[b]=_[b]||{},_[b][y]=Object.assign({},a[v].style),d===a[v].end-1&&v++);return _}}}(i),function(){var o=Array.prototype.join,n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function u(w,M,D,P,I,k,T,A,L,N,j){var G=t.util.cos(w),J=t.util.sin(w),et=t.util.cos(M),z=t.util.sin(M),F=D*I*et-P*k*z+T,Y=P*I*et+D*k*z+A,U=N+L*(-D*I*J-P*k*G),H=j+L*(-P*I*J+D*k*G),q=F+L*(D*I*z+P*k*et),it=Y+L*(P*I*z-D*k*et);return["C",U,H,q,it,F,Y]}function r(w,M,D,P,I,k,T){var A=Math.PI,L=T*A/180,N=t.util.sin(L),j=t.util.cos(L),G=0,J=0;D=Math.abs(D),P=Math.abs(P);var et=-j*w*.5-N*M*.5,z=-j*M*.5+N*w*.5,F=D*D,Y=P*P,U=z*z,H=et*et,q=F*Y-F*U-Y*H,it=0;if(q<0){var ot=Math.sqrt(1-q/(F*Y));D*=ot,P*=ot}else it=(I===k?-1:1)*Math.sqrt(q/(F*U+Y*H));var st=it*D*z/P,V=-it*P*et/D,rt=j*st-N*V+w*.5,at=N*st+j*V+M*.5,ct=c(1,0,(et-st)/D,(z-V)/P),yt=c((et-st)/D,(z-V)/P,(-et-st)/D,(-z-V)/P);k===0&&yt>0?yt-=2*A:k===1&&yt<0&&(yt+=2*A);for(var ft=Math.ceil(Math.abs(yt/A*2)),Et=[],Ot=yt/ft,ge=8/3*Math.sin(Ot/4)*Math.sin(Ot/4)/Math.sin(Ot/2),We=ct+Ot,Yt=0;Yt<ft;Yt++)Et[Yt]=u(ct,We,j,N,D,P,rt,at,ge,G,J),G=Et[Yt][5],J=Et[Yt][6],ct=We,We+=Ot;return Et}function c(w,M,D,P){var I=Math.atan2(M,w),k=Math.atan2(P,D);return k>=I?k-I:2*Math.PI-(I-k)}function a(w,M,D,P,I,k,T,A){var L;if(t.cachesBoundsOfCurve&&(L=o.call(arguments),t.boundsOfCurveCache[L]))return t.boundsOfCurveCache[L];var N=Math.sqrt,j=Math.min,G=Math.max,J=Math.abs,et=[],z=[[],[]],F,Y,U,H,q,it,ot,st;Y=6*w-12*D+6*I,F=-3*w+9*D-9*I+3*T,U=3*D-3*w;for(var V=0;V<2;++V){if(V>0&&(Y=6*M-12*P+6*k,F=-3*M+9*P-9*k+3*A,U=3*P-3*M),J(F)<1e-12){if(J(Y)<1e-12)continue;H=-U/Y,0<H&&H<1&&et.push(H);continue}ot=Y*Y-4*U*F,!(ot<0)&&(st=N(ot),q=(-Y+st)/(2*F),0<q&&q<1&&et.push(q),it=(-Y-st)/(2*F),0<it&&it<1&&et.push(it))}for(var rt,at,ct=et.length,yt=ct,ft;ct--;)H=et[ct],ft=1-H,rt=ft*ft*ft*w+3*ft*ft*H*D+3*ft*H*H*I+H*H*H*T,z[0][ct]=rt,at=ft*ft*ft*M+3*ft*ft*H*P+3*ft*H*H*k+H*H*H*A,z[1][ct]=at;z[0][yt]=w,z[1][yt]=M,z[0][yt+1]=T,z[1][yt+1]=A;var Et=[{x:j.apply(null,z[0]),y:j.apply(null,z[1])},{x:G.apply(null,z[0]),y:G.apply(null,z[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[L]=Et),Et}function f(w,M,D){for(var P=D[1],I=D[2],k=D[3],T=D[4],A=D[5],L=D[6],N=D[7],j=r(L-w,N-M,P,I,T,A,k),G=0,J=j.length;G<J;G++)j[G][1]+=w,j[G][2]+=M,j[G][3]+=w,j[G][4]+=M,j[G][5]+=w,j[G][6]+=M;return j}function p(w){var M=0,D=0,P=w.length,I=0,k=0,T,A,L,N=[],j,G,J;for(A=0;A<P;++A){switch(L=!1,T=w[A].slice(0),T[0]){case"l":T[0]="L",T[1]+=M,T[2]+=D;case"L":M=T[1],D=T[2];break;case"h":T[1]+=M;case"H":T[0]="L",T[2]=D,M=T[1];break;case"v":T[1]+=D;case"V":T[0]="L",D=T[1],T[1]=M,T[2]=D;break;case"m":T[0]="M",T[1]+=M,T[2]+=D;case"M":M=T[1],D=T[2],I=T[1],k=T[2];break;case"c":T[0]="C",T[1]+=M,T[2]+=D,T[3]+=M,T[4]+=D,T[5]+=M,T[6]+=D;case"C":G=T[3],J=T[4],M=T[5],D=T[6];break;case"s":T[0]="S",T[1]+=M,T[2]+=D,T[3]+=M,T[4]+=D;case"S":j==="C"?(G=2*M-G,J=2*D-J):(G=M,J=D),M=T[3],D=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=G,T[2]=J,G=T[3],J=T[4];break;case"q":T[0]="Q",T[1]+=M,T[2]+=D,T[3]+=M,T[4]+=D;case"Q":G=T[1],J=T[2],M=T[3],D=T[4];break;case"t":T[0]="T",T[1]+=M,T[2]+=D;case"T":j==="Q"?(G=2*M-G,J=2*D-J):(G=M,J=D),T[0]="Q",M=T[1],D=T[2],T[1]=G,T[2]=J,T[3]=M,T[4]=D;break;case"a":T[0]="A",T[6]+=M,T[7]+=D;case"A":L=!0,N=N.concat(f(M,D,T)),M=T[6],D=T[7];break;case"z":case"Z":M=I,D=k;break}L||N.push(T),j=T[0]}return N}function d(w,M,D,P){return Math.sqrt((D-w)*(D-w)+(P-M)*(P-M))}function v(w){return w*w*w}function _(w){return 3*w*w*(1-w)}function b(w){return 3*w*(1-w)*(1-w)}function y(w){return(1-w)*(1-w)*(1-w)}function x(w,M,D,P,I,k,T,A){return function(L){var N=v(L),j=_(L),G=b(L),J=y(L);return{x:T*N+I*j+D*G+w*J,y:A*N+k*j+P*G+M*J}}}function C(w,M,D,P,I,k,T,A){return function(L){var N=1-L,j=3*N*N*(D-w)+6*N*L*(I-D)+3*L*L*(T-I),G=3*N*N*(P-M)+6*N*L*(k-P)+3*L*L*(A-k);return Math.atan2(G,j)}}function S(w){return w*w}function O(w){return 2*w*(1-w)}function E(w){return(1-w)*(1-w)}function R(w,M,D,P,I,k){return function(T){var A=S(T),L=O(T),N=E(T);return{x:I*A+D*L+w*N,y:k*A+P*L+M*N}}}function W(w,M,D,P,I,k){return function(T){var A=1-T,L=2*A*(D-w)+2*T*(I-D),N=2*A*(P-M)+2*T*(k-P);return Math.atan2(N,L)}}function X(w,M,D){var P={x:M,y:D},I,k=0,T;for(T=1;T<=100;T+=1)I=w(T/100),k+=d(P.x,P.y,I.x,I.y),P=I;return k}function Q(w,M){for(var D=0,P=0,I=w.iterator,k={x:w.x,y:w.y},T,A,L=.01,N=w.angleFinder,j;P<M&&L>1e-4;)T=I(D),j=D,A=d(k.x,k.y,T.x,T.y),A+P>M?(D-=L,L/=2):(k=T,D+=L,P+=A);return T.angle=N(j),T}function $(w){for(var M=0,D=w.length,P,I=0,k=0,T=0,A=0,L=[],N,j,G,J=0;J<D;J++){switch(P=w[J],j={x:I,y:k,command:P[0]},P[0]){case"M":j.length=0,T=I=P[1],A=k=P[2];break;case"L":j.length=d(I,k,P[1],P[2]),I=P[1],k=P[2];break;case"C":N=x(I,k,P[1],P[2],P[3],P[4],P[5],P[6]),G=C(I,k,P[1],P[2],P[3],P[4],P[5],P[6]),j.iterator=N,j.angleFinder=G,j.length=X(N,I,k),I=P[5],k=P[6];break;case"Q":N=R(I,k,P[1],P[2],P[3],P[4]),G=W(I,k,P[1],P[2],P[3],P[4]),j.iterator=N,j.angleFinder=G,j.length=X(N,I,k),I=P[3],k=P[4];break;case"Z":case"z":j.destX=T,j.destY=A,j.length=d(I,k,T,A),I=T,k=A;break}M+=j.length,L.push(j)}return L.push({length:M,x:I,y:k}),L}function B(w,M,D){D||(D=$(w));for(var P=0;M-D[P].length>0&&P<D.length-2;)M-=D[P].length,P++;var I=D[P],k=M/I.length,T=I.command,A=w[P],L;switch(T){case"M":return{x:I.x,y:I.y,angle:0};case"Z":case"z":return L=new t.Point(I.x,I.y).lerp(new t.Point(I.destX,I.destY),k),L.angle=Math.atan2(I.destY-I.y,I.destX-I.x),L;case"L":return L=new t.Point(I.x,I.y).lerp(new t.Point(A[1],A[2]),k),L.angle=Math.atan2(A[2]-I.y,A[1]-I.x),L;case"C":return Q(I,M);case"Q":return Q(I,M)}}function K(w){var M=[],D=[],P,I,k=t.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",A="("+T+")"+t.commaWsp,L="([01])"+t.commaWsp+"?",N=A+"?"+A+"?"+A+L+L+A+"?("+T+")",j=new RegExp(N,"g"),G,J,et;if(!w||!w.match)return M;et=w.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var z=0,F,Y=et.length;z<Y;z++){P=et[z],J=P.slice(1).trim(),D.length=0;var U=P.charAt(0);if(F=[U],U.toLowerCase()==="a")for(var H;H=j.exec(J);)for(var q=1;q<H.length;q++)D.push(H[q]);else for(;G=k.exec(J);)D.push(G[0]);for(var q=0,it=D.length;q<it;q++)I=parseFloat(D[q]),isNaN(I)||F.push(I);var ot=n[U.toLowerCase()],st=l[U]||U;if(F.length-1>ot)for(var V=1,rt=F.length;V<rt;V+=ot)M.push([U].concat(F.slice(V,V+ot))),U=st;else M.push(F)}return M}function tt(w,M){var D=[],P,I=new t.Point(w[0].x,w[0].y),k=new t.Point(w[1].x,w[1].y),T=w.length,A=1,L=0,N=T>2;for(M=M||0,N&&(A=w[2].x<k.x?-1:w[2].x===k.x?0:1,L=w[2].y<k.y?-1:w[2].y===k.y?0:1),D.push(["M",I.x-A*M,I.y-L*M]),P=1;P<T;P++){if(!I.eq(k)){var j=I.midPointFrom(k);D.push(["Q",I.x,I.y,j.x,j.y])}I=w[P],P+1<w.length&&(k=w[P+1])}return N&&(A=I.x>w[P-2].x?1:I.x===w[P-2].x?0:-1,L=I.y>w[P-2].y?1:I.y===w[P-2].y?0:-1),D.push(["L",I.x+A*M,I.y+L*M]),D}function nt(w,M,D){return D&&(M=t.util.multiplyTransformMatrices(M,[1,0,0,1,-D.x,-D.y])),w.map(function(P){for(var I=P.slice(0),k={},T=1;T<P.length-1;T+=2)k.x=P[T],k.y=P[T+1],k=t.util.transformPoint(k,M),I[T]=k.x,I[T+1]=k.y;return I})}t.util.joinPath=function(w){return w.map(function(M){return M.join(" ")}).join(" ")},t.util.parsePath=K,t.util.makePathSimpler=p,t.util.getSmoothPathFromPoints=tt,t.util.getPathSegmentsInfo=$,t.util.getBoundsOfCurve=a,t.util.getPointOnPath=B,t.util.transformPath=nt}(),function(){var o=Array.prototype.slice;function n(a,f){for(var p=o.call(arguments,2),d=[],v=0,_=a.length;v<_;v++)d[v]=p.length?a[v][f].apply(a[v],p):a[v][f].call(a[v]);return d}function l(a,f){return c(a,f,function(p,d){return p>=d})}function u(a,f){return c(a,f,function(p,d){return p<d})}function r(a,f){for(var p=a.length;p--;)a[p]=f;return a}function c(a,f,p){if(!(!a||a.length===0)){var d=a.length-1,v=f?a[d][f]:a[d];if(f)for(;d--;)p(a[d][f],v)&&(v=a[d][f]);else for(;d--;)p(a[d],v)&&(v=a[d]);return v}}t.util.array={fill:r,invoke:n,min:u,max:l}}(),function(){function o(l,u,r){if(r)if(!t.isLikelyNode&&u instanceof Element)l=u;else if(u instanceof Array){l=[];for(var c=0,a=u.length;c<a;c++)l[c]=o({},u[c],r)}else if(u&&typeof u=="object")for(var f in u)f==="canvas"||f==="group"?l[f]=null:u.hasOwnProperty(f)&&(l[f]=o({},u[f],r));else l=u;else for(var f in u)l[f]=u[f];return l}function n(l,u){return o({},l,u)}t.util.object={extend:o,clone:n},t.util.object.extend(t.util,t.Observable)}(),function(){function o(c){return c.replace(/-+(.)?/g,function(a,f){return f?f.toUpperCase():""})}function n(c,a){return c.charAt(0).toUpperCase()+(a?c.slice(1):c.slice(1).toLowerCase())}function l(c){return c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(c){var a=0,f,p=[];for(a=0,f;a<c.length;a++)(f=r(c,a))!==!1&&p.push(f);return p}function r(c,a){var f=c.charCodeAt(a);if(isNaN(f))return"";if(f<55296||f>57343)return c.charAt(a);if(55296<=f&&f<=56319){if(c.length<=a+1)throw"High surrogate without following low surrogate";var p=c.charCodeAt(a+1);if(56320>p||p>57343)throw"High surrogate without following low surrogate";return c.charAt(a)+c.charAt(a+1)}if(a===0)throw"Low surrogate without preceding high surrogate";var d=c.charCodeAt(a-1);if(55296>d||d>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:o,capitalize:n,escapeXml:l,graphemeSplit:u}}(),function(){var o=Array.prototype.slice,n=function(){},l=function(){for(var f in{toString:1})if(f==="toString")return!1;return!0}(),u=function(f,p,d){for(var v in p)v in f.prototype&&typeof f.prototype[v]=="function"&&(p[v]+"").indexOf("callSuper")>-1?f.prototype[v]=function(_){return function(){var b=this.constructor.superclass;this.constructor.superclass=d;var y=p[_].apply(this,arguments);if(this.constructor.superclass=b,_!=="initialize")return y}}(v):f.prototype[v]=p[v],l&&(p.toString!==Object.prototype.toString&&(f.prototype.toString=p.toString),p.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=p.valueOf))};function r(){}function c(f){for(var p=null,d=this;d.constructor.superclass;){var v=d.constructor.superclass.prototype[f];if(d[f]!==v){p=v;break}d=d.constructor.superclass.prototype}return p?arguments.length>1?p.apply(this,o.call(arguments,1)):p.call(this):console.log("tried to callSuper "+f+", method not found in prototype chain",this)}function a(){var f=null,p=o.call(arguments,0);typeof p[0]=="function"&&(f=p.shift());function d(){this.initialize.apply(this,arguments)}d.superclass=f,d.subclasses=[],f&&(r.prototype=f.prototype,d.prototype=new r,f.subclasses.push(d));for(var v=0,_=p.length;v<_;v++)u(d,p[v],f);return d.prototype.initialize||(d.prototype.initialize=n),d.prototype.constructor=d,d.prototype.callSuper=c,d}t.util.createClass=a}(),function(){var o=!!t.document.createElement("div").attachEvent,n=["touchstart","touchmove","touchend"];t.util.addListener=function(u,r,c,a){u&&u.addEventListener(r,c,o?!1:a)},t.util.removeListener=function(u,r,c,a){u&&u.removeEventListener(r,c,o?!1:a)};function l(u){var r=u.changedTouches;return r&&r[0]?r[0]:u}t.util.getPointer=function(u){var r=u.target,c=t.util.getScrollLeftTop(r),a=l(u);return{x:a.clientX+c.left,y:a.clientY+c.top}},t.util.isTouchEvent=function(u){return n.indexOf(u.type)>-1||u.pointerType==="touch"}}(),function(){function o(a,f){var p=a.style;if(!p)return a;if(typeof f=="string")return a.style.cssText+=";"+f,f.indexOf("opacity")>-1?c(a,f.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in f)if(d==="opacity")c(a,f[d]);else{var v=d==="float"||d==="cssFloat"?typeof p.styleFloat>"u"?"cssFloat":"styleFloat":d;p.setProperty(v,f[d])}return a}var n=t.document.createElement("div"),l=typeof n.style.opacity=="string",u=typeof n.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(a){return a};l?c=function(a,f){return a.style.opacity=f,a}:u&&(c=function(a,f){var p=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(p.zoom=1),r.test(p.filter)?(f=f>=.9999?"":"alpha(opacity="+f*100+")",p.filter=p.filter.replace(r,f)):p.filter+=" alpha(opacity="+f*100+")",a}),t.util.setStyle=o}(),function(){var o=Array.prototype.slice;function n(y){return typeof y=="string"?t.document.getElementById(y):y}var l,u=function(y){return o.call(y,0)};try{l=u(t.document.childNodes)instanceof Array}catch{}l||(u=function(y){for(var x=new Array(y.length),C=y.length;C--;)x[C]=y[C];return x});function r(y,x){var C=t.document.createElement(y);for(var S in x)S==="class"?C.className=x[S]:S==="for"?C.htmlFor=x[S]:C.setAttribute(S,x[S]);return C}function c(y,x){y&&(" "+y.className+" ").indexOf(" "+x+" ")===-1&&(y.className+=(y.className?" ":"")+x)}function a(y,x,C){return typeof x=="string"&&(x=r(x,C)),y.parentNode&&y.parentNode.replaceChild(x,y),x.appendChild(y),x}function f(y){for(var x=0,C=0,S=t.document.documentElement,O=t.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&(y=y.parentNode||y.host,y===t.document?(x=O.scrollLeft||S.scrollLeft||0,C=O.scrollTop||S.scrollTop||0):(x+=y.scrollLeft||0,C+=y.scrollTop||0),!(y.nodeType===1&&y.style.position==="fixed")););return{left:x,top:C}}function p(y){var x,C=y&&y.ownerDocument,S={left:0,top:0},O={left:0,top:0},E,R={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return O;for(var W in R)O[R[W]]+=parseInt(d(y,W),10)||0;return x=C.documentElement,typeof y.getBoundingClientRect<"u"&&(S=y.getBoundingClientRect()),E=f(y),{left:S.left+E.left-(x.clientLeft||0)+O.left,top:S.top+E.top-(x.clientTop||0)+O.top}}var d;t.document.defaultView&&t.document.defaultView.getComputedStyle?d=function(y,x){var C=t.document.defaultView.getComputedStyle(y,null);return C?C[x]:void 0}:d=function(y,x){var C=y.style[x];return!C&&y.currentStyle&&(C=y.currentStyle[x]),C},function(){var y=t.document.documentElement.style,x="userSelect"in y?"userSelect":"MozUserSelect"in y?"MozUserSelect":"WebkitUserSelect"in y?"WebkitUserSelect":"KhtmlUserSelect"in y?"KhtmlUserSelect":"";function C(O){return typeof O.onselectstart<"u"&&(O.onselectstart=t.util.falseFunction),x?O.style[x]="none":typeof O.unselectable=="string"&&(O.unselectable="on"),O}function S(O){return typeof O.onselectstart<"u"&&(O.onselectstart=null),x?O.style[x]="":typeof O.unselectable=="string"&&(O.unselectable=""),O}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=S}();function v(y){var x=t.jsdomImplForWrapper(y);return x._canvas||x._image}function _(y){if(t.isLikelyNode){var x=t.jsdomImplForWrapper(y);x&&(x._image=null,x._canvas=null,x._currentSrc=null,x._attributes=null,x._classList=null)}}function b(y,x){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=x}t.util.setImageSmoothing=b,t.util.getById=n,t.util.toArray=u,t.util.addClass=c,t.util.makeElement=r,t.util.wrapElement=a,t.util.getScrollLeftTop=f,t.util.getElementOffset=p,t.util.getNodeCanvas=v,t.util.cleanUpJsdomNode=_}(),function(){function o(u,r){return u+(/\?/.test(u)?"&":"?")+r}function n(){}function l(u,r){r||(r={});var c=r.method?r.method.toUpperCase():"GET",a=r.onComplete||function(){},f=new t.window.XMLHttpRequest,p=r.body||r.parameters;return f.onreadystatechange=function(){f.readyState===4&&(a(f),f.onreadystatechange=n)},c==="GET"&&(p=null,typeof r.parameters=="string"&&(u=o(u,r.parameters))),f.open(c,u,!0),(c==="POST"||c==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(p),f}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var o=t.util.object.extend,n=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var v=this.splice(0);return v.forEach(function(_){_.cancel()}),v},cancelByCanvas:function(v){if(!v)return[];var _=this.filter(function(b){return typeof b.target=="object"&&b.target.canvas===v});return _.forEach(function(b){b.cancel()}),_},cancelByTarget:function(v){var _=this.findAnimationsByTarget(v);return _.forEach(function(b){b.cancel()}),_},findAnimationIndex:function(v){return this.indexOf(this.findAnimation(v))},findAnimation:function(v){return this.find(function(_){return _.cancel===v})},findAnimationsByTarget:function(v){return v?this.filter(function(_){return _.target===v}):[]}});function u(){return!1}function r(v,_,b,y){return-b*Math.cos(v/y*(Math.PI/2))+b+_}function c(v){v||(v={});var _=!1,b,y=function(){var x=t.runningAnimations.indexOf(b);return x>-1&&t.runningAnimations.splice(x,1)[0]};return b=o(n(v),{cancel:function(){return _=!0,y()},currentValue:"startValue"in v?v.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(b),p(function(x){var C=x||+new Date,S=v.duration||500,O=C+S,E,R=v.onChange||u,W=v.abort||u,X=v.onComplete||u,Q=v.easing||r,$="startValue"in v?v.startValue.length>0:!1,B="startValue"in v?v.startValue:0,K="endValue"in v?v.endValue:100,tt=v.byValue||($?B.map(function(nt,w){return K[w]-B[w]}):K-B);v.onStart&&v.onStart(),function nt(w){E=w||+new Date;var M=E>O?S:E-C,D=M/S,P=$?B.map(function(k,T){return Q(M,B[T],tt[T],S)}):Q(M,B,tt,S),I=Math.abs($?(P[0]-B[0])/tt[0]:(P-B)/tt);if(b.currentValue=$?P.slice():P,b.completionRate=I,b.durationRate=D,!_){if(W(P,I,D)){y();return}if(E>O){b.currentValue=$?K.slice():K,b.completionRate=1,b.durationRate=1,R($?K.slice():K,1,1),X(K,1,1),y();return}else R(P,I,D),p(nt)}}(C)}),b.cancel}var a=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(v){return t.window.setTimeout(v,1e3/60)},f=t.window.cancelAnimationFrame||t.window.clearTimeout;function p(){return a.apply(t.window,arguments)}function d(){return f.apply(t.window,arguments)}t.util.animate=c,t.util.requestAnimFrame=p,t.util.cancelAnimFrame=d,t.runningAnimations=l}(),function(){function o(l,u,r){var c="rgba("+parseInt(l[0]+r*(u[0]-l[0]),10)+","+parseInt(l[1]+r*(u[1]-l[1]),10)+","+parseInt(l[2]+r*(u[2]-l[2]),10);return c+=","+(l&&u?parseFloat(l[3]+r*(u[3]-l[3])):1),c+=")",c}function n(l,u,r,c){var a=new t.Color(l).getSource(),f=new t.Color(u).getSource(),p=c.onComplete,d=c.onChange;return c=c||{},t.util.animate(t.util.object.extend(c,{duration:r||500,startValue:a,endValue:f,byValue:f,easing:function(v,_,b,y){var x=c.colorEasing?c.colorEasing(v,y):1-Math.cos(v/y*(Math.PI/2));return o(_,b,x)},onComplete:function(v,_,b){if(p)return p(o(f,f,0),_,b)},onChange:function(v,_,b){if(d){if(Array.isArray(v))return d(o(v,v,0),_,b);d(v,_,b)}}}))}t.util.animateColor=n}(),function(){function o(w,M,D,P){return w<Math.abs(M)?(w=M,P=D/4):M===0&&w===0?P=D/(2*Math.PI)*Math.asin(1):P=D/(2*Math.PI)*Math.asin(M/w),{a:w,c:M,p:D,s:P}}function n(w,M,D){return w.a*Math.pow(2,10*(M-=1))*Math.sin((M*D-w.s)*(2*Math.PI)/w.p)}function l(w,M,D,P){return D*((w=w/P-1)*w*w+1)+M}function u(w,M,D,P){return w/=P/2,w<1?D/2*w*w*w+M:D/2*((w-=2)*w*w+2)+M}function r(w,M,D,P){return D*(w/=P)*w*w*w+M}function c(w,M,D,P){return-D*((w=w/P-1)*w*w*w-1)+M}function a(w,M,D,P){return w/=P/2,w<1?D/2*w*w*w*w+M:-D/2*((w-=2)*w*w*w-2)+M}function f(w,M,D,P){return D*(w/=P)*w*w*w*w+M}function p(w,M,D,P){return D*((w=w/P-1)*w*w*w*w+1)+M}function d(w,M,D,P){return w/=P/2,w<1?D/2*w*w*w*w*w+M:D/2*((w-=2)*w*w*w*w+2)+M}function v(w,M,D,P){return-D*Math.cos(w/P*(Math.PI/2))+D+M}function _(w,M,D,P){return D*Math.sin(w/P*(Math.PI/2))+M}function b(w,M,D,P){return-D/2*(Math.cos(Math.PI*w/P)-1)+M}function y(w,M,D,P){return w===0?M:D*Math.pow(2,10*(w/P-1))+M}function x(w,M,D,P){return w===P?M+D:D*(-Math.pow(2,-10*w/P)+1)+M}function C(w,M,D,P){return w===0?M:w===P?M+D:(w/=P/2,w<1?D/2*Math.pow(2,10*(w-1))+M:D/2*(-Math.pow(2,-10*--w)+2)+M)}function S(w,M,D,P){return-D*(Math.sqrt(1-(w/=P)*w)-1)+M}function O(w,M,D,P){return D*Math.sqrt(1-(w=w/P-1)*w)+M}function E(w,M,D,P){return w/=P/2,w<1?-D/2*(Math.sqrt(1-w*w)-1)+M:D/2*(Math.sqrt(1-(w-=2)*w)+1)+M}function R(w,M,D,P){var I=1.70158,k=0,T=D;if(w===0)return M;if(w/=P,w===1)return M+D;k||(k=P*.3);var A=o(T,D,k,I);return-n(A,w,P)+M}function W(w,M,D,P){var I=1.70158,k=0,T=D;if(w===0)return M;if(w/=P,w===1)return M+D;k||(k=P*.3);var A=o(T,D,k,I);return A.a*Math.pow(2,-10*w)*Math.sin((w*P-A.s)*(2*Math.PI)/A.p)+A.c+M}function X(w,M,D,P){var I=1.70158,k=0,T=D;if(w===0)return M;if(w/=P/2,w===2)return M+D;k||(k=P*(.3*1.5));var A=o(T,D,k,I);return w<1?-.5*n(A,w,P)+M:A.a*Math.pow(2,-10*(w-=1))*Math.sin((w*P-A.s)*(2*Math.PI)/A.p)*.5+A.c+M}function Q(w,M,D,P,I){return I===void 0&&(I=1.70158),D*(w/=P)*w*((I+1)*w-I)+M}function $(w,M,D,P,I){return I===void 0&&(I=1.70158),D*((w=w/P-1)*w*((I+1)*w+I)+1)+M}function B(w,M,D,P,I){return I===void 0&&(I=1.70158),w/=P/2,w<1?D/2*(w*w*(((I*=1.525)+1)*w-I))+M:D/2*((w-=2)*w*(((I*=1.525)+1)*w+I)+2)+M}function K(w,M,D,P){return D-tt(P-w,0,D,P)+M}function tt(w,M,D,P){return(w/=P)<1/2.75?D*(7.5625*w*w)+M:w<2/2.75?D*(7.5625*(w-=1.5/2.75)*w+.75)+M:w<2.5/2.75?D*(7.5625*(w-=2.25/2.75)*w+.9375)+M:D*(7.5625*(w-=2.625/2.75)*w+.984375)+M}function nt(w,M,D,P){return w<P/2?K(w*2,0,D,P)*.5+M:tt(w*2-P,0,D,P)*.5+D*.5+M}t.util.ease={easeInQuad:function(w,M,D,P){return D*(w/=P)*w+M},easeOutQuad:function(w,M,D,P){return-D*(w/=P)*(w-2)+M},easeInOutQuad:function(w,M,D,P){return w/=P/2,w<1?D/2*w*w+M:-D/2*(--w*(w-2)-1)+M},easeInCubic:function(w,M,D,P){return D*(w/=P)*w*w+M},easeOutCubic:l,easeInOutCubic:u,easeInQuart:r,easeOutQuart:c,easeInOutQuart:a,easeInQuint:f,easeOutQuint:p,easeInOutQuint:d,easeInSine:v,easeOutSine:_,easeInOutSine:b,easeInExpo:y,easeOutExpo:x,easeInOutExpo:C,easeInCirc:S,easeOutCirc:O,easeInOutCirc:E,easeInElastic:R,easeOutElastic:W,easeInOutElastic:X,easeInBack:Q,easeOutBack:$,easeInOutBack:B,easeInBounce:K,easeOutBounce:tt,easeInOutBounce:nt}}(),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.object.clone,r=n.util.toFixed,c=n.util.parseUnit,a=n.util.multiplyTransformMatrices,f=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],p=["symbol","image","marker","pattern","view","svg"],d=["pattern","defs","symbol","metadata","clipPath","mask","desc"],v=["symbol","g","a","svg","clipPath","defs"],_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},b={stroke:"strokeOpacity",fill:"fillOpacity"},y="font-size",x="clip-path";n.svgValidTagNamesRegEx=O(f),n.svgViewBoxElementsRegEx=O(p),n.svgInvalidAncestorsRegEx=O(d),n.svgValidParentsRegEx=O(v),n.cssRules={},n.gradientDefs={},n.clipPaths={};function C(k){return k in _?_[k]:k}function S(k,T,A,L){var N=Array.isArray(T),j;if((k==="fill"||k==="stroke")&&T==="none")T="";else{if(k==="strokeUniform")return T==="non-scaling-stroke";if(k==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(k==="transformMatrix")A&&A.transformMatrix?T=a(A.transformMatrix,n.parseTransformAttribute(T)):T=n.parseTransformAttribute(T);else if(k==="visible")T=T!=="none"&&T!=="hidden",A&&A.visible===!1&&(T=!1);else if(k==="opacity")T=parseFloat(T),A&&typeof A.opacity<"u"&&(T*=A.opacity);else if(k==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(k==="charSpacing")j=c(T,L)/L*1e3;else if(k==="paintFirst"){var G=T.indexOf("fill"),J=T.indexOf("stroke"),T="fill";(G>-1&&J>-1&&J<G||G===-1&&J>-1)&&(T="stroke")}else{if(k==="href"||k==="xlink:href"||k==="font")return T;if(k==="imageSmoothing")return T==="optimizeQuality";j=N?T.map(c):c(T,L)}}return!N&&isNaN(j)?T:j}function O(k){return new RegExp("^("+k.join("|")+")\\b","i")}function E(k){for(var T in b)if(!(typeof k[b[T]]>"u"||k[T]==="")){if(typeof k[T]>"u"){if(!n.Object.prototype[T])continue;k[T]=n.Object.prototype[T]}if(k[T].indexOf("url(")!==0){var A=new n.Color(k[T]);k[T]=A.setAlpha(r(A.getAlpha()*k[b[T]],2)).toRgba()}}return k}function R(k,T){var A,L=[],N,j,G;for(j=0,G=T.length;j<G;j++)A=T[j],N=k.getElementsByTagName(A),L=L.concat(Array.prototype.slice.call(N));return L}n.parseTransformAttribute=function(){function k(V,rt){var at=n.util.cos(rt[0]),ct=n.util.sin(rt[0]),yt=0,ft=0;rt.length===3&&(yt=rt[1],ft=rt[2]),V[0]=at,V[1]=ct,V[2]=-ct,V[3]=at,V[4]=yt-(at*yt-ct*ft),V[5]=ft-(ct*yt+at*ft)}function T(V,rt){var at=rt[0],ct=rt.length===2?rt[1]:rt[0];V[0]=at,V[3]=ct}function A(V,rt,at){V[at]=Math.tan(n.util.degreesToRadians(rt[0]))}function L(V,rt){V[4]=rt[0],rt.length===2&&(V[5]=rt[1])}var N=n.iMatrix,j=n.reNum,G=n.commaWsp,J="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",et="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",z="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+")"+G+"("+j+"))?\\s*\\))",F="(?:(scale)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",Y="(?:(translate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",U="(?:(matrix)\\s*\\(\\s*("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")\\s*\\))",H="(?:"+U+"|"+Y+"|"+F+"|"+z+"|"+J+"|"+et+")",q="(?:"+H+"(?:"+G+"*"+H+")*)",it="^\\s*(?:"+q+"?)\\s*$",ot=new RegExp(it),st=new RegExp(H,"g");return function(V){var rt=N.concat(),at=[];if(!V||V&&!ot.test(V))return rt;V.replace(st,function(yt){var ft=new RegExp(H).exec(yt).filter(function(ge){return!!ge}),Et=ft[1],Ot=ft.slice(2).map(parseFloat);switch(Et){case"translate":L(rt,Ot);break;case"rotate":Ot[0]=n.util.degreesToRadians(Ot[0]),k(rt,Ot);break;case"scale":T(rt,Ot);break;case"skewX":A(rt,Ot,2);break;case"skewY":A(rt,Ot,1);break;case"matrix":rt=Ot;break}at.push(rt.concat()),rt=N.concat()});for(var ct=at[0];at.length>1;)at.shift(),ct=n.util.multiplyTransformMatrices(ct,at[0]);return ct}}();function W(k,T){var A,L;k.replace(/;\s*$/,"").split(";").forEach(function(N){var j=N.split(":");A=j[0].trim().toLowerCase(),L=j[1].trim(),T[A]=L})}function X(k,T){var A,L;for(var N in k)typeof k[N]>"u"||(A=N.toLowerCase(),L=k[N],T[A]=L)}function Q(k,T){var A={};for(var L in n.cssRules[T])if($(k,L.split(" ")))for(var N in n.cssRules[T][L])A[N]=n.cssRules[T][L][N];return A}function $(k,T){var A,L=!0;return A=K(k,T.pop()),A&&T.length&&(L=B(k,T)),A&&L&&T.length===0}function B(k,T){for(var A,L=!0;k.parentNode&&k.parentNode.nodeType===1&&T.length;)L&&(A=T.pop()),k=k.parentNode,L=K(k,A);return T.length===0}function K(k,T){var A=k.nodeName,L=k.getAttribute("class"),N=k.getAttribute("id"),j,G;if(j=new RegExp("^"+A,"i"),T=T.replace(j,""),N&&T.length&&(j=new RegExp("#"+N+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"")),L&&T.length)for(L=L.split(" "),G=L.length;G--;)j=new RegExp("\\."+L[G]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"");return T.length===0}function tt(k,T){var A;if(k.getElementById&&(A=k.getElementById(T)),A)return A;var L,N,j,G=k.getElementsByTagName("*");for(N=0,j=G.length;N<j;N++)if(L=G[N],T===L.getAttribute("id"))return L}function nt(k){for(var T=R(k,["use","svg:use"]),A=0;T.length&&A<T.length;){var L=T[A],N=L.getAttribute("xlink:href")||L.getAttribute("href");if(N===null)return;var j=N.slice(1),G=L.getAttribute("x")||0,J=L.getAttribute("y")||0,et=tt(k,j).cloneNode(!0),z=(et.getAttribute("transform")||"")+" translate("+G+", "+J+")",F,Y=T.length,U,H,q,it,ot=n.svgNS;if(M(et),/^svg$/i.test(et.nodeName)){var st=et.ownerDocument.createElementNS(ot,"g");for(H=0,q=et.attributes,it=q.length;H<it;H++)U=q.item(H),st.setAttributeNS(ot,U.nodeName,U.nodeValue);for(;et.firstChild;)st.appendChild(et.firstChild);et=st}for(H=0,q=L.attributes,it=q.length;H<it;H++)U=q.item(H),!(U.nodeName==="x"||U.nodeName==="y"||U.nodeName==="xlink:href"||U.nodeName==="href")&&(U.nodeName==="transform"?z=U.nodeValue+" "+z:et.setAttribute(U.nodeName,U.nodeValue));et.setAttribute("transform",z),et.setAttribute("instantiated_by_use","1"),et.removeAttribute("id"),F=L.parentNode,F.replaceChild(et,L),T.length===Y&&A++}}var w=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");function M(k){if(!n.svgViewBoxElementsRegEx.test(k.nodeName))return{};var T=k.getAttribute("viewBox"),A=1,L=1,N=0,j=0,G,J,et,z,F=k.getAttribute("width"),Y=k.getAttribute("height"),U=k.getAttribute("x")||0,H=k.getAttribute("y")||0,q=k.getAttribute("preserveAspectRatio")||"",it=!T||!(T=T.match(w)),ot=!F||!Y||F==="100%"||Y==="100%",st=it&&ot,V={},rt="",at=0,ct=0;if(V.width=0,V.height=0,V.toBeParsed=st,it&&(U||H)&&k.parentNode&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+c(U)+" "+c(H)+") ",et=(k.getAttribute("transform")||"")+rt,k.setAttribute("transform",et),k.removeAttribute("x"),k.removeAttribute("y")),st)return V;if(it)return V.width=c(F),V.height=c(Y),V;if(N=-parseFloat(T[1]),j=-parseFloat(T[2]),G=parseFloat(T[3]),J=parseFloat(T[4]),V.minX=N,V.minY=j,V.viewBoxWidth=G,V.viewBoxHeight=J,ot?(V.width=G,V.height=J):(V.width=c(F),V.height=c(Y),A=V.width/G,L=V.height/J),q=n.util.parsePreserveAspectRatioAttribute(q),q.alignX!=="none"&&(q.meetOrSlice==="meet"&&(L=A=A>L?L:A),q.meetOrSlice==="slice"&&(L=A=A>L?A:L),at=V.width-G*A,ct=V.height-J*A,q.alignX==="Mid"&&(at/=2),q.alignY==="Mid"&&(ct/=2),q.alignX==="Min"&&(at=0),q.alignY==="Min"&&(ct=0)),A===1&&L===1&&N===0&&j===0&&U===0&&H===0)return V;if((U||H)&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+c(U)+" "+c(H)+") "),et=rt+" matrix("+A+" 0 0 "+L+" "+(N*A+at)+" "+(j*L+ct)+") ",k.nodeName==="svg"){for(z=k.ownerDocument.createElementNS(n.svgNS,"g");k.firstChild;)z.appendChild(k.firstChild);k.appendChild(z)}else z=k,z.removeAttribute("x"),z.removeAttribute("y"),et=z.getAttribute("transform")+et;return z.setAttribute("transform",et),V}function D(k,T){for(;k&&(k=k.parentNode);)if(k.nodeName&&T.test(k.nodeName.replace("svg:",""))&&!k.getAttribute("instantiated_by_use"))return!0;return!1}n.parseSVGDocument=function(k,T,A,L){if(k){nt(k);var N=n.Object.__uid++,j,G,J=M(k),et=n.util.toArray(k.getElementsByTagName("*"));if(J.crossOrigin=L&&L.crossOrigin,J.svgUid=N,et.length===0&&n.isLikelyNode){et=k.selectNodes('//*[name(.)!="svg"]');var z=[];for(j=0,G=et.length;j<G;j++)z[j]=et[j];et=z}var F=et.filter(function(U){return M(U),n.svgValidTagNamesRegEx.test(U.nodeName.replace("svg:",""))&&!D(U,n.svgInvalidAncestorsRegEx)});if(!F||F&&!F.length){T&&T([],{});return}var Y={};et.filter(function(U){return U.nodeName.replace("svg:","")==="clipPath"}).forEach(function(U){var H=U.getAttribute("id");Y[H]=n.util.toArray(U.getElementsByTagName("*")).filter(function(q){return n.svgValidTagNamesRegEx.test(q.nodeName.replace("svg:",""))})}),n.gradientDefs[N]=n.getGradientDefs(k),n.cssRules[N]=n.getCSSRules(k),n.clipPaths[N]=Y,n.parseElements(F,function(U,H){T&&(T(U,J,H,et),delete n.gradientDefs[N],delete n.cssRules[N],delete n.clipPaths[N])},u(J),A,L)}};function P(k,T){var A=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],L="xlink:href",N=T.getAttribute(L).slice(1),j=tt(k,N);if(j&&j.getAttribute(L)&&P(k,j),A.forEach(function(J){j&&!T.hasAttribute(J)&&j.hasAttribute(J)&&T.setAttribute(J,j.getAttribute(J))}),!T.children.length)for(var G=j.cloneNode(!0);G.firstChild;)T.appendChild(G.firstChild);T.removeAttribute(L)}var I=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");l(n,{parseFontDeclaration:function(k,T){var A=k.match(I);if(A){var L=A[1],N=A[3],j=A[4],G=A[5],J=A[6];L&&(T.fontStyle=L),N&&(T.fontWeight=isNaN(parseFloat(N))?N:parseFloat(N)),j&&(T.fontSize=c(j)),J&&(T.fontFamily=J),G&&(T.lineHeight=G==="normal"?1:G)}},getGradientDefs:function(k){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],A=R(k,T),L,N=0,j={};for(N=A.length;N--;)L=A[N],L.getAttribute("xlink:href")&&P(k,L),j[L.getAttribute("id")]=L;return j},parseAttributes:function(k,T,A){if(k){var L,N={},j,G;typeof A>"u"&&(A=k.getAttribute("svgUid")),k.parentNode&&n.svgValidParentsRegEx.test(k.parentNode.nodeName)&&(N=n.parseAttributes(k.parentNode,T,A));var J=T.reduce(function(q,it){return L=k.getAttribute(it),L&&(q[it]=L),q},{}),et=l(Q(k,A),n.parseStyleAttribute(k));J=l(J,et),et[x]&&k.setAttribute(x,et[x]),j=G=N.fontSize||n.Text.DEFAULT_SVG_FONT_SIZE,J[y]&&(J[y]=j=c(J[y],G));var z,F,Y={};for(var U in J)z=C(U),F=S(z,J[U],N,j),Y[z]=F;Y&&Y.font&&n.parseFontDeclaration(Y.font,Y);var H=l(N,Y);return n.svgValidParentsRegEx.test(k.nodeName)?H:E(H)}},parseElements:function(k,T,A,L,N){new n.ElementsParser(k,T,A,L,N).parse()},parseStyleAttribute:function(k){var T={},A=k.getAttribute("style");return A&&(typeof A=="string"?W(A,T):X(A,T)),T},parsePointsAttribute:function(k){if(!k)return null;k=k.replace(/,/g," ").trim(),k=k.split(/\s+/);var T=[],A,L;for(A=0,L=k.length;A<L;A+=2)T.push({x:parseFloat(k[A]),y:parseFloat(k[A+1])});return T},getCSSRules:function(k){var T=k.getElementsByTagName("style"),A,L,N={},j;for(A=0,L=T.length;A<L;A++){var G=T[A].textContent;G=G.replace(/\/\*[\s\S]*?\*\//g,""),G.trim()!==""&&(j=G.split("}"),j=j.filter(function(J){return J.trim()}),j.forEach(function(J){var et=J.split("{"),z={},F=et[1].trim(),Y=F.split(";").filter(function(it){return it.trim()});for(A=0,L=Y.length;A<L;A++){var U=Y[A].split(":"),H=U[0].trim(),q=U[1].trim();z[H]=q}J=et[0].trim(),J.split(",").forEach(function(it){it=it.replace(/^svg/i,"").trim(),it!==""&&(N[it]?n.util.object.extend(N[it],z):N[it]=n.util.object.clone(z))})}))}return N},loadSVGFromURL:function(k,T,A,L){k=k.replace(/^\n\s*/,"").trim(),new n.util.request(k,{method:"get",onComplete:N});function N(j){var G=j.responseXML;if(!G||!G.documentElement)return T&&T(null),!1;n.parseSVGDocument(G.documentElement,function(J,et,z,F){T&&T(J,et,z,F)},A,L)}},loadSVGFromString:function(k,T,A,L){var N=new n.window.DOMParser,j=N.parseFromString(k.trim(),"text/xml");n.parseSVGDocument(j.documentElement,function(G,J,et,z){T(G,J,et,z)},A,L)}})}(i),t.ElementsParser=function(o,n,l,u,r,c){this.elements=o,this.callback=n,this.options=l,this.reviver=u,this.svgUid=l&&l.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=c},function(o){o.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},o.createObjects=function(){var n=this;this.elements.forEach(function(l,u){l.setAttribute("svgUid",n.svgUid),n.createObject(l,u)})},o.findTag=function(n){return t[t.util.string.capitalize(n.tagName.replace("svg:",""))]},o.createObject=function(n,l){var u=this.findTag(n);if(u&&u.fromElement)try{u.fromElement(n,this.createCallback(l,n),this.options)}catch(r){t.log(r)}else this.checkIfDone()},o.createCallback=function(n,l){var u=this;return function(r){var c;u.resolveGradient(r,l,"fill"),u.resolveGradient(r,l,"stroke"),r instanceof t.Image&&r._originalElement&&(c=r.parsePreserveAspectRatioAttribute(l)),r._removeTransformMatrix(c),u.resolveClipPath(r,l),u.reviver&&u.reviver(l,r),u.instances[n]=r,u.checkIfDone()}},o.extractPropertyDefinition=function(n,l,u){var r=n[l],c=this.regexUrl;if(c.test(r)){c.lastIndex=0;var a=c.exec(r)[1];return c.lastIndex=0,t[u][this.svgUid][a]}},o.resolveGradient=function(n,l,u){var r=this.extractPropertyDefinition(n,u,"gradientDefs");if(r){var c=l.getAttribute(u+"-opacity"),a=t.Gradient.fromElement(r,n,c,this.options);n.set(u,a)}},o.createClipPathCallback=function(n,l){return function(u){u._removeTransformMatrix(),u.fillRule=u.clipRule,l.push(u)}},o.resolveClipPath=function(n,l){var u=this.extractPropertyDefinition(n,"clipPath","clipPaths"),r,c,a,f,p,d;if(u){f=[],a=t.util.invertTransform(n.calcTransformMatrix());for(var v=u[0].parentNode,_=l;_.parentNode&&_.getAttribute("clip-path")!==n.clipPath;)_=_.parentNode;_.parentNode.appendChild(v);for(var b=0;b<u.length;b++)r=u[b],c=this.findTag(r),c.fromElement(r,this.createClipPathCallback(n,f),this.options);f.length===1?u=f[0]:u=new t.Group(f),p=t.util.multiplyTransformMatrices(a,u.calcTransformMatrix()),u.clipPath&&this.resolveClipPath(u,_);var d=t.util.qrDecompose(p);u.flipX=!1,u.flipY=!1,u.set("scaleX",d.scaleX),u.set("scaleY",d.scaleY),u.angle=d.angle,u.skewX=d.skewX,u.skewY=0,u.setPositionByOrigin({x:d.translateX,y:d.translateY},"center","center"),n.clipPath=u}else delete n.clipPath},o.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(o){var n=o.fabric||(o.fabric={});if(n.Point){n.warn("fabric.Point is already defined");return}n.Point=l;function l(u,r){this.x=u,this.y=r}l.prototype={type:"point",constructor:l,add:function(u){return new l(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new l(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new l(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new l(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new l(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new l(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new l(this.x+(u.x-this.x)*r,this.y+(u.y-this.y)*r)},distanceFrom:function(u){var r=this.x-u.x,c=this.y-u.y;return Math.sqrt(r*r+c*c)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new l(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new l(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,r){return this.x=u,this.y=r,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var r=this.x,c=this.y;this.x=u.x,this.y=u.y,u.x=r,u.y=c},clone:function(){return new l(this.x,this.y)}}}(i),function(o){var n=o.fabric||(o.fabric={});if(n.Intersection){n.warn("fabric.Intersection is already defined");return}function l(u){this.status=u,this.points=[]}n.Intersection=l,n.Intersection.prototype={constructor:l,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},n.Intersection.intersectLineLine=function(u,r,c,a){var f,p=(a.x-c.x)*(u.y-c.y)-(a.y-c.y)*(u.x-c.x),d=(r.x-u.x)*(u.y-c.y)-(r.y-u.y)*(u.x-c.x),v=(a.y-c.y)*(r.x-u.x)-(a.x-c.x)*(r.y-u.y);if(v!==0){var _=p/v,b=d/v;0<=_&&_<=1&&0<=b&&b<=1?(f=new l("Intersection"),f.appendPoint(new n.Point(u.x+_*(r.x-u.x),u.y+_*(r.y-u.y)))):f=new l}else p===0||d===0?f=new l("Coincident"):f=new l("Parallel");return f},n.Intersection.intersectLinePolygon=function(u,r,c){var a=new l,f=c.length,p,d,v,_;for(_=0;_<f;_++)p=c[_],d=c[(_+1)%f],v=l.intersectLineLine(u,r,p,d),a.appendPoints(v.points);return a.points.length>0&&(a.status="Intersection"),a},n.Intersection.intersectPolygonPolygon=function(u,r){var c=new l,a=u.length,f;for(f=0;f<a;f++){var p=u[f],d=u[(f+1)%a],v=l.intersectLinePolygon(p,d,r);c.appendPoints(v.points)}return c.points.length>0&&(c.status="Intersection"),c},n.Intersection.intersectPolygonRectangle=function(u,r,c){var a=r.min(c),f=r.max(c),p=new n.Point(f.x,a.y),d=new n.Point(a.x,f.y),v=l.intersectLinePolygon(a,p,u),_=l.intersectLinePolygon(p,f,u),b=l.intersectLinePolygon(f,d,u),y=l.intersectLinePolygon(d,a,u),x=new l;return x.appendPoints(v.points),x.appendPoints(_.points),x.appendPoints(b.points),x.appendPoints(y.points),x.points.length>0&&(x.status="Intersection"),x}}(i),function(o){var n=o.fabric||(o.fabric={});if(n.Color){n.warn("fabric.Color is already defined.");return}function l(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}n.Color=l,n.Color.prototype={_tryParsingColor:function(r){var c;r in l.colorNameMap&&(r=l.colorNameMap[r]),r==="transparent"&&(c=[255,255,255,0]),c||(c=l.sourceFromHex(r)),c||(c=l.sourceFromRgb(r)),c||(c=l.sourceFromHsl(r)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(r,c,a){r/=255,c/=255,a/=255;var f,p,d,v=n.util.array.max([r,c,a]),_=n.util.array.min([r,c,a]);if(d=(v+_)/2,v===_)f=p=0;else{var b=v-_;switch(p=d>.5?b/(2-v-_):b/(v+_),v){case r:f=(c-a)/b+(c<a?6:0);break;case c:f=(a-r)/b+2;break;case a:f=(r-c)/b+4;break}f/=6}return[Math.round(f*360),Math.round(p*100),Math.round(d*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),c=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+c[0]+","+c[1]+"%,"+c[2]+"%)"},toHsla:function(){var r=this.getSource(),c=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+c[0]+","+c[1]+"%,"+c[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),c,a,f;return c=r[0].toString(16),c=c.length===1?"0"+c:c,a=r[1].toString(16),a=a.length===1?"0"+a:a,f=r[2].toString(16),f=f.length===1?"0"+f:f,c.toUpperCase()+a.toUpperCase()+f.toUpperCase()},toHexa:function(){var r=this.getSource(),c;return c=Math.round(r[3]*255),c=c.toString(16),c=c.length===1?"0"+c:c,this.toHex()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var c=this.getSource();return c[3]=r,this.setSource(c),this},toGrayscale:function(){var r=this.getSource(),c=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),a=r[3];return this.setSource([c,c,c,a]),this},toBlackWhite:function(r){var c=this.getSource(),a=(c[0]*.3+c[1]*.59+c[2]*.11).toFixed(0),f=c[3];return r=r||127,a=Number(a)<Number(r)?0:255,this.setSource([a,a,a,f]),this},overlayWith:function(r){r instanceof l||(r=new l(r));var c=[],a=this.getAlpha(),f=.5,p=this.getSource(),d=r.getSource(),v;for(v=0;v<3;v++)c.push(Math.round(p[v]*(1-f)+d[v]*f));return c[3]=a,this.setSource(c),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,n.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function u(r,c,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?r+(c-r)*6*a:a<1/2?c:a<2/3?r+(c-r)*(2/3-a)*6:r}n.Color.fromRgb=function(r){return l.fromSource(l.sourceFromRgb(r))},n.Color.sourceFromRgb=function(r){var c=r.match(l.reRGBa);if(c){var a=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),f=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),p=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(a,10),parseInt(f,10),parseInt(p,10),c[4]?parseFloat(c[4]):1]}},n.Color.fromRgba=l.fromRgb,n.Color.fromHsl=function(r){return l.fromSource(l.sourceFromHsl(r))},n.Color.sourceFromHsl=function(r){var c=r.match(l.reHSLa);if(c){var a=(parseFloat(c[1])%360+360)%360/360,f=parseFloat(c[2])/(/%$/.test(c[2])?100:1),p=parseFloat(c[3])/(/%$/.test(c[3])?100:1),d,v,_;if(f===0)d=v=_=p;else{var b=p<=.5?p*(f+1):p+f-p*f,y=p*2-b;d=u(y,b,a+1/3),v=u(y,b,a),_=u(y,b,a-1/3)}return[Math.round(d*255),Math.round(v*255),Math.round(_*255),c[4]?parseFloat(c[4]):1]}},n.Color.fromHsla=l.fromHsl,n.Color.fromHex=function(r){return l.fromSource(l.sourceFromHex(r))},n.Color.sourceFromHex=function(r){if(r.match(l.reHex)){var c=r.slice(r.indexOf("#")+1),a=c.length===3||c.length===4,f=c.length===8||c.length===4,p=a?c.charAt(0)+c.charAt(0):c.substring(0,2),d=a?c.charAt(1)+c.charAt(1):c.substring(2,4),v=a?c.charAt(2)+c.charAt(2):c.substring(4,6),_=f?a?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(p,16),parseInt(d,16),parseInt(v,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},n.Color.fromSource=function(r){var c=new l;return c.setSource(r),c}}(i),function(o){var n=o.fabric||(o.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],r={},c="left",a="top",f="right",p="bottom",d="center",v={top:p,bottom:a,left:f,right:c,center:d},_=n.util.radiansToDegrees,b=Math.sign||function(z){return(z>0)-(z<0)||+z};function y(z,F){var Y=z.angle+_(Math.atan2(F.y,F.x))+360;return Math.round(Y%360/45)}function x(z,F){var Y=F.transform.target,U=Y.canvas,H=n.util.object.clone(F);H.target=Y,U&&U.fire("object:"+z,H),Y.fire(z,F)}function C(z,F){var Y=F.canvas,U=Y.uniScaleKey,H=z[U];return Y.uniformScaling&&!H||!Y.uniformScaling&&H}function S(z){return z.originX===d&&z.originY===d}function O(z,F,Y){var U=z.lockScalingX,H=z.lockScalingY;return!!(U&&H||!F&&(U||H)&&Y||U&&F==="x"||H&&F==="y")}function E(z,F,Y){var U="not-allowed",H=C(z,Y),q="";if(F.x!==0&&F.y===0?q="x":F.x===0&&F.y!==0&&(q="y"),O(Y,q,H))return U;var it=y(Y,F);return l[it]+"-resize"}function R(z,F,Y){var U="not-allowed";if(F.x!==0&&Y.lockSkewingY||F.y!==0&&Y.lockSkewingX)return U;var H=y(Y,F)%4;return u[H]+"-resize"}function W(z,F,Y){return z[Y.canvas.altActionKey]?r.skewCursorStyleHandler(z,F,Y):r.scaleCursorStyleHandler(z,F,Y)}function X(z,F,Y){var U=z[Y.canvas.altActionKey];if(F.x===0)return U?"skewX":"scaleY";if(F.y===0)return U?"skewY":"scaleX"}function Q(z,F,Y){return Y.lockRotation?"not-allowed":F.cursorStyle}function $(z,F,Y,U){return{e:z,transform:F,pointer:{x:Y,y:U}}}function B(z){return function(F,Y,U,H){var q=Y.target,it=q.getCenterPoint(),ot=q.translateToOriginPoint(it,Y.originX,Y.originY),st=z(F,Y,U,H);return q.setPositionByOrigin(ot,Y.originX,Y.originY),st}}function K(z,F){return function(Y,U,H,q){var it=F(Y,U,H,q);return it&&x(z,$(Y,U,H,q)),it}}function tt(z,F,Y,U,H){var q=z.target,it=q.controls[z.corner],ot=q.canvas.getZoom(),st=q.padding/ot,V=q.toLocalPoint(new n.Point(U,H),F,Y);return V.x>=st&&(V.x-=st),V.x<=-st&&(V.x+=st),V.y>=st&&(V.y-=st),V.y<=st&&(V.y+=st),V.x-=it.offsetX,V.y-=it.offsetY,V}function nt(z){return z.flipX!==z.flipY}function w(z,F,Y,U,H){if(z[F]!==0){var q=z._getTransformedDimensions()[U],it=H/q*z[Y];z.set(Y,it)}}function M(z,F,Y,U){var H=F.target,q=H._getTransformedDimensions(0,H.skewY),it=tt(F,F.originX,F.originY,Y,U),ot=Math.abs(it.x*2)-q.x,st=H.skewX,V;ot<2?V=0:(V=_(Math.atan2(ot/H.scaleX,q.y/H.scaleY)),F.originX===c&&F.originY===p&&(V=-V),F.originX===f&&F.originY===a&&(V=-V),nt(H)&&(V=-V));var rt=st!==V;if(rt){var at=H._getTransformedDimensions().y;H.set("skewX",V),w(H,"skewY","scaleY","y",at)}return rt}function D(z,F,Y,U){var H=F.target,q=H._getTransformedDimensions(H.skewX,0),it=tt(F,F.originX,F.originY,Y,U),ot=Math.abs(it.y*2)-q.y,st=H.skewY,V;ot<2?V=0:(V=_(Math.atan2(ot/H.scaleY,q.x/H.scaleX)),F.originX===c&&F.originY===p&&(V=-V),F.originX===f&&F.originY===a&&(V=-V),nt(H)&&(V=-V));var rt=st!==V;if(rt){var at=H._getTransformedDimensions().x;H.set("skewY",V),w(H,"skewX","scaleX","x",at)}return rt}function P(z,F,Y,U){var H=F.target,q=H.skewX,it,ot=F.originY;if(H.lockSkewingX)return!1;if(q===0){var st=tt(F,d,d,Y,U);st.x>0?it=c:it=f}else q>0&&(it=ot===a?c:f),q<0&&(it=ot===a?f:c),nt(H)&&(it=it===c?f:c);F.originX=it;var V=K("skewing",B(M));return V(z,F,Y,U)}function I(z,F,Y,U){var H=F.target,q=H.skewY,it,ot=F.originX;if(H.lockSkewingY)return!1;if(q===0){var st=tt(F,d,d,Y,U);st.y>0?it=a:it=p}else q>0&&(it=ot===c?a:p),q<0&&(it=ot===c?p:a),nt(H)&&(it=it===a?p:a);F.originY=it;var V=K("skewing",B(D));return V(z,F,Y,U)}function k(z,F,Y,U){var H=F,q=H.target,it=q.translateToOriginPoint(q.getCenterPoint(),H.originX,H.originY);if(q.lockRotation)return!1;var ot=Math.atan2(H.ey-it.y,H.ex-it.x),st=Math.atan2(U-it.y,Y-it.x),V=_(st-ot+H.theta),rt=!0;if(q.snapAngle>0){var at=q.snapAngle,ct=q.snapThreshold||at,yt=Math.ceil(V/at)*at,ft=Math.floor(V/at)*at;Math.abs(V-ft)<ct?V=ft:Math.abs(V-yt)<ct&&(V=yt)}return V<0&&(V=360+V),V%=360,rt=q.angle!==V,q.angle=V,rt}function T(z,F,Y,U,H){H=H||{};var q=F.target,it=q.lockScalingX,ot=q.lockScalingY,st=H.by,V,rt,at,ct,yt=C(z,q),ft=O(q,st,yt),Et,Ot,ge=F.gestureScale;if(ft)return!1;if(ge)rt=F.scaleX*ge,at=F.scaleY*ge;else{if(V=tt(F,F.originX,F.originY,Y,U),Et=st!=="y"?b(V.x):1,Ot=st!=="x"?b(V.y):1,F.signX||(F.signX=Et),F.signY||(F.signY=Ot),q.lockScalingFlip&&(F.signX!==Et||F.signY!==Ot))return!1;if(ct=q._getTransformedDimensions(),yt&&!st){var We=Math.abs(V.x)+Math.abs(V.y),Yt=F.original,Lo=Math.abs(ct.x*Yt.scaleX/q.scaleX)+Math.abs(ct.y*Yt.scaleY/q.scaleY),rs=We/Lo;rt=Yt.scaleX*rs,at=Yt.scaleY*rs}else rt=Math.abs(V.x*q.scaleX/ct.x),at=Math.abs(V.y*q.scaleY/ct.y);S(F)&&(rt*=2,at*=2),F.signX!==Et&&st!=="y"&&(F.originX=v[F.originX],rt*=-1,F.signX=Et),F.signY!==Ot&&st!=="x"&&(F.originY=v[F.originY],at*=-1,F.signY=Ot)}var Ro=q.scaleX,Io=q.scaleY;return st?(st==="x"&&q.set("scaleX",rt),st==="y"&&q.set("scaleY",at)):(!it&&q.set("scaleX",rt),!ot&&q.set("scaleY",at)),Ro!==q.scaleX||Io!==q.scaleY}function A(z,F,Y,U){return T(z,F,Y,U)}function L(z,F,Y,U){return T(z,F,Y,U,{by:"x"})}function N(z,F,Y,U){return T(z,F,Y,U,{by:"y"})}function j(z,F,Y,U){return z[F.target.canvas.altActionKey]?r.skewHandlerX(z,F,Y,U):r.scalingY(z,F,Y,U)}function G(z,F,Y,U){return z[F.target.canvas.altActionKey]?r.skewHandlerY(z,F,Y,U):r.scalingX(z,F,Y,U)}function J(z,F,Y,U){var H=F.target,q=tt(F,F.originX,F.originY,Y,U),it=H.strokeWidth/(H.strokeUniform?H.scaleX:1),ot=S(F)?2:1,st=H.width,V=Math.abs(q.x*ot/H.scaleX)-it;return H.set("width",Math.max(V,0)),st!==V}function et(z,F,Y,U){var H=F.target,q=Y-F.offsetX,it=U-F.offsetY,ot=!H.get("lockMovementX")&&H.left!==q,st=!H.get("lockMovementY")&&H.top!==it;return ot&&H.set("left",q),st&&H.set("top",it),(ot||st)&&x("moving",$(z,F,Y,U)),ot||st}r.scaleCursorStyleHandler=E,r.skewCursorStyleHandler=R,r.scaleSkewCursorStyleHandler=W,r.rotationWithSnapping=K("rotating",B(k)),r.scalingEqually=K("scaling",B(A)),r.scalingX=K("scaling",B(L)),r.scalingY=K("scaling",B(N)),r.scalingYOrSkewingX=j,r.scalingXOrSkewingY=G,r.changeWidth=K("resizing",B(J)),r.skewHandlerX=P,r.skewHandlerY=I,r.dragHandler=et,r.scaleOrSkewActionName=X,r.rotationStyleHandler=Q,r.fireEvent=x,r.wrapWithFixedAnchor=B,r.wrapWithFireEvent=K,r.getLocalPoint=tt,n.controlsUtils=r}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.degreesToRadians,u=n.controlsUtils;function r(a,f,p,d,v){d=d||{};var _=this.sizeX||d.cornerSize||v.cornerSize,b=this.sizeY||d.cornerSize||v.cornerSize,y=typeof d.transparentCorners<"u"?d.transparentCorners:v.transparentCorners,x=y?"stroke":"fill",C=!y&&(d.cornerStrokeColor||v.cornerStrokeColor),S=f,O=p,E;a.save(),a.fillStyle=d.cornerColor||v.cornerColor,a.strokeStyle=d.cornerStrokeColor||v.cornerStrokeColor,_>b?(E=_,a.scale(1,b/_),O=p*_/b):b>_?(E=b,a.scale(_/b,1),S=f*b/_):E=_,a.lineWidth=1,a.beginPath(),a.arc(S,O,E/2,0,2*Math.PI,!1),a[x](),C&&a.stroke(),a.restore()}function c(a,f,p,d,v){d=d||{};var _=this.sizeX||d.cornerSize||v.cornerSize,b=this.sizeY||d.cornerSize||v.cornerSize,y=typeof d.transparentCorners<"u"?d.transparentCorners:v.transparentCorners,x=y?"stroke":"fill",C=!y&&(d.cornerStrokeColor||v.cornerStrokeColor),S=_/2,O=b/2;a.save(),a.fillStyle=d.cornerColor||v.cornerColor,a.strokeStyle=d.cornerStrokeColor||v.cornerStrokeColor,a.lineWidth=1,a.translate(f,p),a.rotate(l(v.angle)),a[x+"Rect"](-S,-O,_,b),C&&a.strokeRect(-S,-O,_,b),a.restore()}u.renderCircleControl=r,u.renderSquareControl=c}(i),function(o){var n=o.fabric||(o.fabric={});function l(u){for(var r in u)this[r]=u[r]}n.Control=l,n.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(u,r){return r.cursorStyle},getActionName:function(u,r){return r.actionName},getVisibility:function(u,r){var c=u._controlsVisibility;return c&&typeof c[r]<"u"?c[r]:this.visible},setVisibility:function(u){this.visible=u},positionHandler:function(u,r){var c=n.util.transformPoint({x:this.x*u.x+this.offsetX,y:this.y*u.y+this.offsetY},r);return c},calcCornerCoords:function(u,r,c,a,f){var p,d,v,_,b=f?this.touchSizeX:this.sizeX,y=f?this.touchSizeY:this.sizeY;if(b&&y&&b!==y){var x=Math.atan2(y,b),C=Math.sqrt(b*b+y*y)/2,S=x-n.util.degreesToRadians(u),O=Math.PI/2-x-n.util.degreesToRadians(u);p=C*n.util.cos(S),d=C*n.util.sin(S),v=C*n.util.cos(O),_=C*n.util.sin(O)}else{var E=b&&y?b:r;C=E*.7071067812;var S=n.util.degreesToRadians(45-u);p=v=C*n.util.cos(S),d=_=C*n.util.sin(S)}return{tl:{x:c-_,y:a-v},tr:{x:c+p,y:a-d},bl:{x:c-p,y:a+d},br:{x:c+_,y:a+v}}},render:function(u,r,c,a,f){switch(a=a||{},a.cornerStyle||f.cornerStyle){case"circle":n.controlsUtils.renderCircleControl.call(this,u,r,c,a,f);break;default:n.controlsUtils.renderSquareControl.call(this,u,r,c,a,f)}}}}(i),function(){function o(c,a){var f=c.getAttribute("style"),p=c.getAttribute("offset")||0,d,v,_,b;if(p=parseFloat(p)/(/%$/.test(p)?100:1),p=p<0?0:p>1?1:p,f){var y=f.split(/\s*;\s*/);for(y[y.length-1]===""&&y.pop(),b=y.length;b--;){var x=y[b].split(/\s*:\s*/),C=x[0].trim(),S=x[1].trim();C==="stop-color"?d=S:C==="stop-opacity"&&(_=S)}}return d||(d=c.getAttribute("stop-color")||"rgb(0,0,0)"),_||(_=c.getAttribute("stop-opacity")),d=new t.Color(d),v=d.getAlpha(),_=isNaN(parseFloat(_))?1:parseFloat(_),_*=v*a,{offset:p,color:d.toRgb(),opacity:_}}function n(c){return{x1:c.getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}}function l(c){return{x1:c.getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"}}var u=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(c){c||(c={}),c.coords||(c.coords={});var a,f=this;Object.keys(c).forEach(function(p){f[p]=c[p]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,a={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0},this.type==="radial"&&(a.r1=c.coords.r1||0,a.r2=c.coords.r2||0),this.coords=a,this.colorStops=c.colorStops.slice()},addColorStop:function(c){for(var a in c){var f=new t.Color(c[a]);this.colorStops.push({offset:parseFloat(a),color:f.toRgb(),opacity:f.getAlpha()})}return this},toObject:function(c){var a={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,a,c),a},toSVG:function(c,v){var f=u(this.coords,!0),p,d,v=v||{},_,b,y=u(this.colorStops,!0),x=f.r1>f.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,O=-this.offsetY,E=!!v.additionalTransform,R=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(y.sort(function(B,K){return B.offset-K.offset}),R==="objectBoundingBox"?(S/=c.width,O/=c.height):(S+=c.width/2,O+=c.height/2),c.type==="path"&&this.gradientUnits!=="percentage"&&(S-=c.pathOffset.x,O-=c.pathOffset.y),C[4]-=S,C[5]-=O,b='id="SVGID_'+this.id+'" gradientUnits="'+R+'"',b+=' gradientTransform="'+(E?v.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?_=["<linearGradient ",b,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(_=["<radialGradient ",b,' cx="',x?f.x1:f.x2,'" cy="',x?f.y1:f.y2,'" r="',x?f.r1:f.r2,'" fx="',x?f.x2:f.x1,'" fy="',x?f.y2:f.y1,`">
`]),this.type==="radial"){if(x)for(y=y.concat(),y.reverse(),p=0,d=y.length;p<d;p++)y[p].offset=1-y[p].offset;var W=Math.min(f.r1,f.r2);if(W>0){var X=Math.max(f.r1,f.r2),Q=W/X;for(p=0,d=y.length;p<d;p++)y[p].offset+=Q*(1-y[p].offset)}}for(p=0,d=y.length;p<d;p++){var $=y[p];_.push("<stop ",'offset="',$.offset*100+"%",'" style="stop-color:',$.color,typeof $.opacity<"u"?";stop-opacity: "+$.opacity:";",`"/>
`)}return _.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),_.join("")},toLive:function(c){var a,f=t.util.object.clone(this.coords),p,d;if(this.type){for(this.type==="linear"?a=c.createLinearGradient(f.x1,f.y1,f.x2,f.y2):this.type==="radial"&&(a=c.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2)),p=0,d=this.colorStops.length;p<d;p++){var v=this.colorStops[p].color,_=this.colorStops[p].opacity,b=this.colorStops[p].offset;typeof _<"u"&&(v=new t.Color(v).setAlpha(_).toRgba()),a.addColorStop(b,v)}return a}}}),t.util.object.extend(t.Gradient,{fromElement:function(c,a,f,p){var d=parseFloat(f)/(/%$/.test(f)?100:1);d=d<0?0:d>1?1:d,isNaN(d)&&(d=1);var v=c.getElementsByTagName("stop"),_,b=c.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",y=c.getAttribute("gradientTransform")||"",x=[],C,S,O=0,E=0,R;for(c.nodeName==="linearGradient"||c.nodeName==="LINEARGRADIENT"?(_="linear",C=n(c)):(_="radial",C=l(c)),S=v.length;S--;)x.push(o(v[S],d));R=t.parseTransformAttribute(y),r(a,C,p,b),b==="pixels"&&(O=-a.left,E=-a.top);var W=new t.Gradient({id:c.getAttribute("id"),type:_,coords:C,colorStops:x,gradientUnits:b,gradientTransform:R,offsetX:O,offsetY:E});return W}});function r(c,a,f,p){var d,v;Object.keys(a).forEach(function(_){d=a[_],d==="Infinity"?v=1:d==="-Infinity"?v=0:(v=parseFloat(a[_],10),typeof d=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(d)&&(v*=.01,p==="pixels"&&((_==="x1"||_==="x2"||_==="r2")&&(v*=f.viewBoxWidth||f.width),(_==="y1"||_==="y2")&&(v*=f.viewBoxHeight||f.height)))),a[_]=v})}}(),function(){var o=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(n,l){if(n||(n={}),this.id=t.Object.__uid++,this.setOptions(n),!n.source||n.source&&typeof n.source!="string"){l&&l(this);return}else{var u=this;this.source=t.util.createImage(),t.util.loadImage(n.source,function(r,c){u.source=r,l&&l(u,c)},null,this.crossOrigin)}},toObject:function(n){var l=t.Object.NUM_FRACTION_DIGITS,u,r;return typeof this.source.src=="string"?u=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(u=this.source.toDataURL()),r={type:"pattern",source:u,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:o(this.offsetX,l),offsetY:o(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,r,n),r},toSVG:function(n){var l=typeof this.source=="function"?this.source():this.source,u=l.width/n.width,r=l.height/n.height,c=this.offsetX/n.width,a=this.offsetY/n.height,f="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,a&&(r+=Math.abs(a))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(u=1,c&&(u+=Math.abs(c))),l.src?f=l.src:l.toDataURL&&(f=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+c+'" y="'+a+'" width="'+u+'" height="'+r+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+f+`"></image>
</pattern>
`},setOptions:function(n){for(var l in n)this[l]=n[l]},toLive:function(n){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":n.createPattern(l,this.repeat)}})}(),function(o){var n=o.fabric||(o.fabric={}),l=n.util.toFixed;if(n.Shadow){n.warn("fabric.Shadow is already defined.");return}n.Shadow=n.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){typeof u=="string"&&(u=this._parseShadow(u));for(var r in u)this[r]=u[r];this.id=n.Object.__uid++},_parseShadow:function(u){var r=u.trim(),c=n.Shadow.reOffsetsAndBlur.exec(r)||[],a=r.replace(n.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:a.trim(),offsetX:parseFloat(c[1],10)||0,offsetY:parseFloat(c[2],10)||0,blur:parseFloat(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var r=40,c=40,a=n.Object.NUM_FRACTION_DIGITS,f=n.util.rotateVector({x:this.offsetX,y:this.offsetY},n.util.degreesToRadians(-u.angle)),p=20,d=new n.Color(this.color);return u.width&&u.height&&(r=l((Math.abs(f.x)+this.blur)/u.width,a)*100+p,c=l((Math.abs(f.y)+this.blur)/u.height,a)*100+p),u.flipX&&(f.x*=-1),u.flipY&&(f.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+c+'%" height="'+(100+2*c)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,a)+`"></feGaussianBlur>
	<feOffset dx="`+l(f.x,a)+'" dy="'+l(f.y,a)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+d.toRgb()+'" flood-opacity="'+d.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},r=n.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(c){this[c]!==r[c]&&(u[c]=this[c])},this),u}}),n.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(i),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var o=t.util.object.extend,n=t.util.getElementOffset,l=t.util.removeFromArray,u=t.util.toFixed,r=t.util.transformPoint,c=t.util.invertTransform,a=t.util.getNodeCanvas,f=t.util.createCanvasElement,p=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(d,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(d,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(d,v){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(d),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,_),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,_),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,_),v.overlayColor&&this.setOverlayColor(v.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var d=t.devicePixelRatio;this.__initRetinaScaling(d,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(d,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(d,v,_){v.setAttribute("width",this.width*d),v.setAttribute("height",this.height*d),_.scale(d,d)},calcOffset:function(){return this._offset=n(this.lowerCanvasEl),this},setOverlayImage:function(d,v,_){return this.__setBgOverlayImage("overlayImage",d,v,_)},setBackgroundImage:function(d,v,_){return this.__setBgOverlayImage("backgroundImage",d,v,_)},setOverlayColor:function(d,v){return this.__setBgOverlayColor("overlayColor",d,v)},setBackgroundColor:function(d,v){return this.__setBgOverlayColor("backgroundColor",d,v)},__setBgOverlayImage:function(d,v,_,b){return typeof v=="string"?t.util.loadImage(v,function(y,x){if(y){var C=new t.Image(y,b);this[d]=C,C.canvas=this}_&&_(y,x)},this,b&&b.crossOrigin):(b&&v.setOptions(b),this[d]=v,v&&(v.canvas=this),_&&_(v,!1)),this},__setBgOverlayColor:function(d,v,_){return this[d]=v,this._initGradient(v,d),this._initPattern(v,d,_),this},_createCanvasElement:function(){var d=f();if(!d||(d.style||(d.style={}),typeof d.getContext>"u"))throw p;return d},_initOptions:function(d){var v=this.lowerCanvasEl;this._setOptions(d),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(d){d&&d.getContext?this.lowerCanvasEl=d:this.lowerCanvasEl=t.util.getById(d)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(d,v){return this.setDimensions({width:d},v)},setHeight:function(d,v){return this.setDimensions({height:d},v)},setDimensions:function(d,v){var _;v=v||{};for(var b in d)_=d[b],v.cssOnly||(this._setBackstoreDimension(b,d[b]),_+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(b,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(d,v){return this.lowerCanvasEl[d]=v,this.upperCanvasEl&&(this.upperCanvasEl[d]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[d]=v),this[d]=v,this},_setCssDimension:function(d,v){return this.lowerCanvasEl.style[d]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[d]=v),this.wrapperEl&&(this.wrapperEl.style[d]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(d){var v=this._activeObject,_=this.backgroundImage,b=this.overlayImage,y,x,C;for(this.viewportTransform=d,x=0,C=this._objects.length;x<C;x++)y=this._objects[x],y.group||y.setCoords(!0);return v&&v.setCoords(),_&&_.setCoords(!0),b&&b.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(d,v){var _=d,b=this.viewportTransform.slice(0);d=r(d,c(this.viewportTransform)),b[0]=v,b[3]=v;var y=r(d,b);return b[4]+=_.x-y.x,b[5]+=_.y-y.y,this.setViewportTransform(b)},setZoom:function(d){return this.zoomToPoint(new t.Point(0,0),d),this},absolutePan:function(d){var v=this.viewportTransform.slice(0);return v[4]=-d.x,v[5]=-d.y,this.setViewportTransform(v)},relativePan:function(d){return this.absolutePan(new t.Point(-d.x-this.viewportTransform[4],-d.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(d){this.stateful&&d.setupState(),d._set("canvas",this),d.setCoords(),this.fire("object:added",{target:d}),d.fire("added")},_onObjectRemoved:function(d){this.fire("object:removed",{target:d}),d.fire("removed"),delete d.canvas},clearContext:function(d){return d.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var d=this.contextContainer;return this.renderCanvas(d,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var d={},v=this.width,_=this.height,b=c(this.viewportTransform);return d.tl=r({x:0,y:0},b),d.br=r({x:v,y:_},b),d.tr=new t.Point(d.br.x,d.tl.y),d.bl=new t.Point(d.tl.x,d.br.y),this.vptCoords=d,d},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(d,v){var _=this.viewportTransform,b=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(d),t.util.setImageSmoothing(d,this.imageSmoothingEnabled),this.fire("before:render",{ctx:d}),this._renderBackground(d),d.save(),d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(d,v),d.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),b&&(b.canvas=this,b.shouldCache(),b._transformDone=!0,b.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(d)),this._renderOverlay(d),this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),this.fire("after:render",{ctx:d})},drawClipPathOnCanvas:function(d){var v=this.viewportTransform,_=this.clipPath;d.save(),d.transform(v[0],v[1],v[2],v[3],v[4],v[5]),d.globalCompositeOperation="destination-in",_.transform(d),d.scale(1/_.zoomX,1/_.zoomY),d.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),d.restore()},_renderObjects:function(d,v){var _,b;for(_=0,b=v.length;_<b;++_)v[_]&&v[_].render(d)},_renderBackgroundOrOverlay:function(d,v){var _=this[v+"Color"],b=this[v+"Image"],y=this.viewportTransform,x=this[v+"Vpt"];if(!(!_&&!b)){if(_){d.save(),d.beginPath(),d.moveTo(0,0),d.lineTo(this.width,0),d.lineTo(this.width,this.height),d.lineTo(0,this.height),d.closePath(),d.fillStyle=_.toLive?_.toLive(d,this):_,x&&d.transform(y[0],y[1],y[2],y[3],y[4],y[5]),d.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var C=_.gradientTransform||_.patternTransform;C&&d.transform(C[0],C[1],C[2],C[3],C[4],C[5]),d.fill(),d.restore()}b&&(d.save(),x&&d.transform(y[0],y[1],y[2],y[3],y[4],y[5]),b.render(d),d.restore())}},_renderBackground:function(d){this._renderBackgroundOrOverlay(d,"background")},_renderOverlay:function(d){this._renderBackgroundOrOverlay(d,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(d){return this._centerObject(d,new t.Point(this.getCenterPoint().x,d.getCenterPoint().y))},centerObjectV:function(d){return this._centerObject(d,new t.Point(d.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(d){var v=this.getCenterPoint();return this._centerObject(d,v)},viewportCenterObject:function(d){var v=this.getVpCenter();return this._centerObject(d,v)},viewportCenterObjectH:function(d){var v=this.getVpCenter();return this._centerObject(d,new t.Point(v.x,d.getCenterPoint().y)),this},viewportCenterObjectV:function(d){var v=this.getVpCenter();return this._centerObject(d,new t.Point(d.getCenterPoint().x,v.y))},getVpCenter:function(){var d=this.getCenterPoint(),v=c(this.viewportTransform);return r(d,v)},_centerObject:function(d,v){return d.setPositionByOrigin(v,"center","center"),d.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(d){return this.toDatalessObject(d)},toObject:function(d){return this._toObjectMethod("toObject",d)},toDatalessObject:function(d){return this._toObjectMethod("toDatalessObject",d)},_toObjectMethod:function(d,v){var _=this.clipPath,b={version:t.version,objects:this._toObjects(d,v)};return _&&!_.excludeFromExport&&(b.clipPath=this._toObject(this.clipPath,d,v)),o(b,this.__serializeBgOverlay(d,v)),t.util.populateWithProperties(this,b,v),b},_toObjects:function(d,v){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,d,v)},this)},_toObject:function(d,v,_){var b;this.includeDefaultValues||(b=d.includeDefaultValues,d.includeDefaultValues=!1);var y=d[v](_);return this.includeDefaultValues||(d.includeDefaultValues=b),y},__serializeBgOverlay:function(d,v){var _={},b=this.backgroundImage,y=this.overlayImage,x=this.backgroundColor,C=this.overlayColor;return x&&x.toObject?x.excludeFromExport||(_.background=x.toObject(v)):x&&(_.background=x),C&&C.toObject?C.excludeFromExport||(_.overlay=C.toObject(v)):C&&(_.overlay=C),b&&!b.excludeFromExport&&(_.backgroundImage=this._toObject(b,d,v)),y&&!y.excludeFromExport&&(_.overlayImage=this._toObject(y,d,v)),_},svgViewportTransformation:!0,toSVG:function(d,v){d||(d={}),d.reviver=v;var _=[];return this._setSVGPreamble(_,d),this._setSVGHeader(_,d),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",v),this._setSVGObjects(_,v),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",v),_.push("</svg>"),_.join("")},_setSVGPreamble:function(d,v){v.suppressPreamble||d.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(d,v){var _=v.width||this.width,b=v.height||this.height,y,x='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;v.viewBox?x='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(y=this.viewportTransform,x='viewBox="'+u(-y[4]/y[0],C)+" "+u(-y[5]/y[3],C)+" "+u(this.width/y[0],C)+" "+u(this.height/y[3],C)+'" '),d.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',_,'" ','height="',b,'" ',x,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(d){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(d.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var d=this,v=["background","overlay"].map(function(_){var b=d[_+"Color"];if(b&&b.toLive){var y=d[_+"Vpt"],x=d.viewportTransform,C={width:d.width/(y?x[0]:1),height:d.height/(y?x[3]:1)};return b.toSVG(C,{additionalTransform:y?t.util.matrixToSVG(x):""})}});return v.join("")},createSVGFontFacesMarkup:function(){var d="",v={},_,b,y,x,C,S,O,E,R,W=t.fontPaths,X=[];for(this._objects.forEach(function $(B){X.push(B),B._objects&&B._objects.forEach($)}),E=0,R=X.length;E<R;E++)if(_=X[E],b=_.fontFamily,!(_.type.indexOf("text")===-1||v[b]||!W[b])&&(v[b]=!0,!!_.styles)){y=_.styles;for(C in y){x=y[C];for(O in x)S=x[O],b=S.fontFamily,!v[b]&&W[b]&&(v[b]=!0)}}for(var Q in v)d+=[`		@font-face {
`,"			font-family: '",Q,`';
`,"			src: url('",W[Q],`');
`,`		}
`].join("");return d&&(d=['	<style type="text/css">',`<![CDATA[
`,d,"]]>",`</style>
`].join("")),d},_setSVGObjects:function(d,v){var _,b,y,x=this._objects;for(b=0,y=x.length;b<y;b++)_=x[b],!_.excludeFromExport&&this._setSVGObject(d,_,v)},_setSVGObject:function(d,v,_){d.push(v.toSVG(_))},_setSVGBgOverlayImage:function(d,v,_){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&d.push(this[v].toSVG(_))},_setSVGBgOverlayColor:function(d,v){var _=this[v+"Color"],b=this.viewportTransform,y=this.width,x=this.height;if(_)if(_.toLive){var C=_.repeat,S=t.util.invertTransform(b),O=this[v+"Vpt"],E=O?t.util.matrixToSVG(S):"";d.push('<rect transform="'+E+" translate(",y/2,",",x/2,')"',' x="',_.offsetX-y/2,'" y="',_.offsetY-x/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?_.source.width:y,'" height="',C==="repeat-x"||C==="no-repeat"?_.source.height:x,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else d.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(d){if(!d)return this;var v=this._activeObject,_,b,y;if(d===v&&d.type==="activeSelection")for(y=v._objects,_=y.length;_--;)b=y[_],l(this._objects,b),this._objects.unshift(b);else l(this._objects,d),this._objects.unshift(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(d){if(!d)return this;var v=this._activeObject,_,b,y;if(d===v&&d.type==="activeSelection")for(y=v._objects,_=0;_<y.length;_++)b=y[_],l(this._objects,b),this._objects.push(b);else l(this._objects,d),this._objects.push(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(d,v){if(!d)return this;var _=this._activeObject,b,y,x,C,S,O=0;if(d===_&&d.type==="activeSelection")for(S=_._objects,b=0;b<S.length;b++)y=S[b],x=this._objects.indexOf(y),x>0+O&&(C=x-1,l(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(d),x!==0&&(C=this._findNewLowerIndex(d,x,v),l(this._objects,d),this._objects.splice(C,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(d,v,_){var b,y;if(_)for(b=v,y=v-1;y>=0;--y){var x=d.intersectsWithObject(this._objects[y])||d.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(d);if(x){b=y;break}}else b=v-1;return b},bringForward:function(d,v){if(!d)return this;var _=this._activeObject,b,y,x,C,S,O=0;if(d===_&&d.type==="activeSelection")for(S=_._objects,b=S.length;b--;)y=S[b],x=this._objects.indexOf(y),x<this._objects.length-1-O&&(C=x+1,l(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(d),x!==this._objects.length-1&&(C=this._findNewUpperIndex(d,x,v),l(this._objects,d),this._objects.splice(C,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(d,v,_){var b,y,x;if(_)for(b=v,y=v+1,x=this._objects.length;y<x;++y){var C=d.intersectsWithObject(this._objects[y])||d.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(d);if(C){b=y;break}}else b=v+1;return b},moveTo:function(d,v){return l(this._objects,d),this._objects.splice(v,0,d),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(d){d.dispose&&d.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),o(t.StaticCanvas.prototype,t.Observable),o(t.StaticCanvas.prototype,t.Collection),o(t.StaticCanvas.prototype,t.DataURLExporter),o(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(d){var v=f();if(!v||!v.getContext)return null;var _=v.getContext("2d");if(!_)return null;switch(d){case"setLineDash":return typeof _.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var d=a(this.lowerCanvasEl);return d&&d.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(d){var v=a(this.lowerCanvasEl);return v&&v.createJPEGStream(d)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(o){o.strokeStyle=this.color,o.lineWidth=this.width,o.lineCap=this.strokeLineCap,o.miterLimit=this.strokeMiterLimit,o.lineJoin=this.strokeLineJoin,o.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(o){var n=this.canvas.viewportTransform;o.save(),o.transform(n[0],n[1],n[2],n[3],n[4],n[5])},_setShadow:function(){if(this.shadow){var o=this.canvas,n=this.shadow,l=o.contextTop,u=o.getZoom();o&&o._isRetinaScaling()&&(u*=t.devicePixelRatio),l.shadowColor=n.color,l.shadowBlur=n.blur*u,l.shadowOffsetX=n.offsetX*u,l.shadowOffsetY=n.offsetY*u}},needsFullRender:function(){var o=new t.Color(this.color);return o.getAlpha()<1||!!this.shadow},_resetShadow:function(){var o=this.canvas.contextTop;o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0},_isOutSideCanvas:function(o){return o.x<0||o.x>this.canvas.getWidth()||o.y<0||o.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(o){this.canvas=o,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(o,n,l){var u=n.midPointFrom(l);return o.quadraticCurveTo(n.x,n.y,u.x,u.y),u},onMouseDown:function(o,n){this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],this._prepareForDrawing(o),this._captureDrawingPath(o),this._render())},onMouseMove:function(o,n){if(this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o))&&this._captureDrawingPath(o)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,u=l.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,l[u-2],l[u-1],!0),r.stroke(),r.restore()}},onMouseUp:function(o){return this.canvas._isMainEvent(o.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(o){var n=new t.Point(o.x,o.y);this._reset(),this._addPoint(n),this.canvas.contextTop.moveTo(n.x,n.y)},_addPoint:function(o){return this._points.length>1&&o.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(o),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(o){var n=new t.Point(o.x,o.y);return this._addPoint(n)},_render:function(o){var n,l,u=this._points[0],r=this._points[1];if(o=o||this.canvas.contextTop,this._saveAndTransform(o),o.beginPath(),this._points.length===2&&u.x===r.x&&u.y===r.y){var c=this.width/1e3;u=new t.Point(u.x,u.y),r=new t.Point(r.x,r.y),u.x-=c,r.x+=c}for(o.moveTo(u.x,u.y),n=1,l=this._points.length;n<l;n++)this._drawSegment(o,u,r),u=this._points[n],r=this._points[n+1];o.lineTo(u.x,u.y),o.stroke(),o.restore()},convertPointsToSVGPath:function(o){var n=this.width/1e3;return t.util.getSmoothPathFromPoints(o,n)},_isEmptySVGPath:function(o){var n=t.util.joinPath(o);return n==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(o){var n=new t.Path(o,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,n.shadow=new t.Shadow(this.shadow)),n},decimatePoints:function(o,n){if(o.length<=2)return o;var l=this.canvas.getZoom(),u=Math.pow(n/l,2),r,c=o.length-1,a=o[0],f=[a],p;for(r=1;r<c-1;r++)p=Math.pow(a.x-o[r].x,2)+Math.pow(a.y-o[r].y,2),p>=u&&(a=o[r],f.push(a));return f.push(o[c]),f},_finalizeAndAddPath:function(){var o=this.canvas.contextTop;o.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var n=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(n)){this.canvas.requestRenderAll();return}var l=this.createPath(n);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(o){this.canvas=o,this.points=[]},drawDot:function(o){var n=this.addPoint(o),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,n),l.restore()},dot:function(o,n){o.fillStyle=n.fill,o.beginPath(),o.arc(n.x,n.y,n.radius,0,Math.PI*2,!1),o.closePath(),o.fill()},onMouseDown:function(o){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(o)},_render:function(){var o=this.canvas.contextTop,n,l,u=this.points;for(this._saveAndTransform(o),n=0,l=u.length;n<l;n++)this.dot(o,u[n]);o.restore()},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(o),this._render()):this.drawDot(o))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove,n,l;this.canvas.renderOnAddRemove=!1;var u=[];for(n=0,l=this.points.length;n<l;n++){var r=this.points[n],c=new t.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(c.shadow=new t.Shadow(this.shadow)),u.push(c)}var a=new t.Group(u);a.canvas=this.canvas,this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},addPoint:function(o){var n=new t.Point(o.x,o.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return n.radius=l,n.fill=u,this.points.push(n),n}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(o){this.canvas=o,this.sprayChunks=[]},onMouseDown:function(o){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(o),this.render(this.sprayChunkPoints)},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.addSprayChunk(o),this.render(this.sprayChunkPoints))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var n=[],l=0,u=this.sprayChunks.length;l<u;l++)for(var r=this.sprayChunks[l],c=0,a=r.length;c<a;c++){var f=new t.Rect({width:r[c].width,height:r[c].width,left:r[c].x+1,top:r[c].y+1,originX:"center",originY:"center",fill:this.color});n.push(f)}this.optimizeOverlapping&&(n=this._getOptimizedRects(n));var p=new t.Group(n);this.shadow&&p.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:p}),this.canvas.add(p),this.canvas.fire("path:created",{path:p}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},_getOptimizedRects:function(o){var n={},l,u,r;for(u=0,r=o.length;u<r;u++)l=o[u].left+""+o[u].top,n[l]||(n[l]=o[u]);var c=[];for(l in n)c.push(n[l]);return c},render:function(o){var n=this.canvas.contextTop,l,u;for(n.fillStyle=this.color,this._saveAndTransform(n),l=0,u=o.length;l<u;l++){var r=o[l];typeof r.opacity<"u"&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var o=this.canvas.contextTop,n,l;for(o.fillStyle=this.color,this._saveAndTransform(o),n=0,l=this.sprayChunks.length;n<l;n++)this.render(this.sprayChunks[n]);o.restore()},addSprayChunk:function(o){this.sprayChunkPoints=[];var n,l,u,r=this.width/2,c;for(c=0;c<this.density;c++){n=t.util.getRandomInt(o.x-r,o.x+r),l=t.util.getRandomInt(o.y-r,o.y+r),this.dotWidthVariance?u=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):u=this.dotWidth;var a=new t.Point(n,l);a.width=u,this.randomOpacity&&(a.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var o=20,n=5,l=t.util.createCanvasElement(),u=l.getContext("2d");return l.width=l.height=o+n,u.fillStyle=this.color,u.beginPath(),u.arc(o/2,o/2,o/2,0,Math.PI*2,!1),u.closePath(),u.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(o){return o.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(o){this.callSuper("_setBrushStyles",o),o.strokeStyle=this.getPattern(o)},createPath:function(o){var n=this.callSuper("createPath",o),l=n._getLeftTopCoords().scalarAdd(n.strokeWidth/2);return n.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),n}}),function(){var o=t.util.getPointer,n=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(r,c){c||(c={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,c),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),c,a,f;if(r.length>0&&!this.preserveObjectStacking){a=[],f=[];for(var p=0,d=this._objects.length;p<d;p++)c=this._objects[p],r.indexOf(c)===-1?a.push(c):f.push(c);r.length>1&&(this._activeObject._objects=f),a.push.apply(a,f)}else a=this._objects;return a},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,c){var a=r.calcTransformMatrix(),f=t.util.invertTransform(a),p=this.restorePointerVpt(c);return t.util.transformPoint(p,f)},isTargetTransparent:function(r,c,a){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var f=this._normalizePointer(r,{x:c,y:a}),p=Math.max(r.cacheTranslationX+f.x*r.zoomX,0),d=Math.max(r.cacheTranslationY+f.y*r.zoomY,0),y=t.util.isTransparent(r._cacheContext,Math.round(p),Math.round(d),this.targetFindTolerance);return y}var v=this.contextCache,_=r.selectionBackgroundColor,b=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(b[0],b[1],b[2],b[3],b[4],b[5]),r.render(v),v.restore(),r.selectionBackgroundColor=_;var y=t.util.isTransparent(v,c,a,this.targetFindTolerance);return y},_isSelectionKeyPressed:function(r){var c=!1;return Array.isArray(this.selectionKey)?c=!!this.selectionKey.find(function(a){return r[a]===!0}):c=r[this.selectionKey],c},_shouldClearSelection:function(r,c){var a=this.getActiveObjects(),f=this._activeObject;return!c||c&&f&&a.length>1&&a.indexOf(c)===-1&&f!==c&&!this._isSelectionKeyPressed(r)||c&&!c.evented||c&&!c.selectable&&f&&f!==c},_shouldCenterTransform:function(r,c,a){if(r){var f;return c==="scale"||c==="scaleX"||c==="scaleY"||c==="resizing"?f=this.centeredScaling||r.centeredScaling:c==="rotate"&&(f=this.centeredRotation||r.centeredRotation),f?!a:a}},_getOriginFromCorner:function(r,c){var a={x:r.originX,y:r.originY};return c==="ml"||c==="tl"||c==="bl"?a.x="right":(c==="mr"||c==="tr"||c==="br")&&(a.x="left"),c==="tl"||c==="mt"||c==="tr"?a.y="bottom":(c==="bl"||c==="mb"||c==="br")&&(a.y="top"),a},_getActionFromCorner:function(r,c,a,f){if(!c||!r)return"drag";var p=f.controls[c];return p.getActionName(a,p,f)},_setupCurrentTransform:function(r,c,a){if(c){var f=this.getPointer(r),p=c.__corner,d=c.controls[p],v=a&&p?d.getActionHandler(r,c,d):t.controlsUtils.dragHandler,_=this._getActionFromCorner(a,p,r,c),b=this._getOriginFromCorner(c,p),y=r[this.centeredKey],x={target:c,action:_,actionHandler:v,corner:p,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:f.x-c.left,offsetY:f.y-c.top,originX:b.x,originY:b.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,theta:n(c.angle),width:c.width*c.scaleX,shiftKey:r.shiftKey,altKey:y,original:t.util.saveObjectTransform(c)};this._shouldCenterTransform(c,_,y)&&(x.originX="center",x.originY="center"),x.original.originX=b.x,x.original.originY=b.y,this._currentTransform=x,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var c=this._groupSelector,a=new t.Point(c.ex,c.ey),f=t.util.transformPoint(a,this.viewportTransform),p=new t.Point(c.ex+c.left,c.ey+c.top),d=t.util.transformPoint(p,this.viewportTransform),v=Math.min(f.x,d.x),_=Math.min(f.y,d.y),b=Math.max(f.x,d.x),y=Math.max(f.y,d.y),x=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(v,_,b-v,y-_)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,v+=x,_+=x,b-=x,y-=x,t.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(v,_,b-v,y-_))},findTarget:function(r,c){if(!this.skipTargetFind){var a=!0,f=this.getPointer(r,a),p=this._activeObject,d=this.getActiveObjects(),v,_,b=l(r),y=d.length>1&&!c||d.length===1;if(this.targets=[],y&&p._findTargetCorner(f,b)||d.length>1&&!c&&p===this._searchPossibleTargets([p],f))return p;if(d.length===1&&p===this._searchPossibleTargets([p],f))if(this.preserveObjectStacking)v=p,_=this.targets,this.targets=[];else return p;var x=this._searchPossibleTargets(this._objects,f);return r[this.altSelectionKey]&&x&&v&&x!==v&&(x=v,this.targets=_),x}},_checkTarget:function(r,c,a){if(c&&c.visible&&c.evented&&c.containsPoint(r))if((this.perPixelTargetFind||c.perPixelTargetFind)&&!c.isEditing){var f=this.isTargetTransparent(c,a.x,a.y);if(!f)return!0}else return!0},_searchPossibleTargets:function(r,c){for(var a,f=r.length,p;f--;){var d=r[f],v=d.group?this._normalizePointer(d.group,c):c;if(this._checkTarget(v,d,c)){a=r[f],a.subTargetCheck&&a instanceof t.Group&&(p=this._searchPossibleTargets(a._objects,c),p&&this.targets.push(p));break}}return a},restorePointerVpt:function(r){return t.util.transformPoint(r,t.util.invertTransform(this.viewportTransform))},getPointer:function(r,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var a=o(r),f=this.upperCanvasEl,p=f.getBoundingClientRect(),d=p.width||0,v=p.height||0,_;(!d||!v)&&("top"in p&&"bottom"in p&&(v=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(d=Math.abs(p.right-p.left))),this.calcOffset(),a.x=a.x-this._offset.left,a.y=a.y-this._offset.top,c||(a=this.restorePointerVpt(a));var b=this.getRetinaScaling();return b!==1&&(a.x/=b,a.y/=b),d===0||v===0?_={width:1,height:1}:_={width:f.width/d,height:f.height/v},{x:a.x*_.width,y:a.y*_.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),c=this.lowerCanvasEl,a=this.upperCanvasEl;a?a.className="":(a=this._createCanvasElement(),this.upperCanvasEl=a),t.util.addClass(a,"upper-canvas "+r),this.wrapperEl.appendChild(a),this._copyCanvasStyle(c,a),this._applyCanvasStyle(a),this.contextTop=a.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var c=this.width||r.width,a=this.height||r.height;t.util.setStyle(r,{position:"absolute",width:c+"px",height:a+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=c,r.height=a,t.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,c){c.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,c){var a=!1,f=this.getActiveObjects(),p=[],d=[];r.forEach(function(v){f.indexOf(v)===-1&&(a=!0,v.fire("deselected",{e:c,target:v}),d.push(v))}),f.forEach(function(v){r.indexOf(v)===-1&&(a=!0,v.fire("selected",{e:c,target:v}),p.push(v))}),r.length>0&&f.length>0?a&&this.fire("selection:updated",{e:c,selected:p,deselected:d}):f.length>0?this.fire("selection:created",{e:c,selected:p}):r.length>0&&this.fire("selection:cleared",{e:c,deselected:d})},setActiveObject:function(r,c){var a=this.getActiveObjects();return this._setActiveObject(r,c),this._fireSelectionEvents(a,c),this},_setActiveObject:function(r,c){return this._activeObject===r||!this._discardActiveObject(c,r)||r.onSelect({e:c})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,c){var a=this._activeObject;if(a){if(a.onDeselect({e:r,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var c=this.getActiveObjects(),a=this.getActiveObject();return c.length&&this.fire("before:selection:cleared",{target:a,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(c,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(c){t.util.cleanUpJsdomNode(this[c]),this[c]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var c=this._activeObject;c&&c._renderControls(r)},_toObject:function(r,c,a){var f=this._realizeGroupTransformOnObject(r),p=this.callSuper("_toObject",r,c,a);return this._unwindGroupTransformOnObject(r,f),p},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var c=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],a={};return c.forEach(function(f){a[f]=r[f]}),t.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),a}else return null},_unwindGroupTransformOnObject:function(r,c){c&&r.set(c)},_setSVGObject:function(r,c,a){var f=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",r,c,a),this._unwindGroupTransformOnObject(c,f)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var u in t.StaticCanvas)u!=="prototype"&&(t.Canvas[u]=t.StaticCanvas[u])}(),function(){var o=t.util.addListener,n=t.util.removeListener,l=3,u=2,r=1,c={passive:!1};function a(f,p){return f.button&&f.button===p-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(o,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(f,p){var d=this.upperCanvasEl,v=this._getEventPrefix();f(t.window,"resize",this._onResize),f(d,v+"down",this._onMouseDown),f(d,v+"move",this._onMouseMove,c),f(d,v+"out",this._onMouseOut),f(d,v+"enter",this._onMouseEnter),f(d,"wheel",this._onMouseWheel),f(d,"contextmenu",this._onContextMenu),f(d,"dblclick",this._onDoubleClick),f(d,"dragover",this._onDragOver),f(d,"dragenter",this._onDragEnter),f(d,"dragleave",this._onDragLeave),f(d,"drop",this._onDrop),this.enablePointerEvents||f(d,"touchstart",this._onTouchStart,c),typeof eventjs<"u"&&p in eventjs&&(eventjs[p](d,"gesture",this._onGesture),eventjs[p](d,"drag",this._onDrag),eventjs[p](d,"orientation",this._onOrientationChange),eventjs[p](d,"shake",this._onShake),eventjs[p](d,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(n,"remove");var f=this._getEventPrefix();n(t.document,f+"up",this._onMouseUp),n(t.document,"touchend",this._onTouchEnd,c),n(t.document,f+"move",this._onMouseMove,c),n(t.document,"touchmove",this._onMouseMove,c)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(f,p){this.__onTransformGesture&&this.__onTransformGesture(f,p)},_onDrag:function(f,p){this.__onDrag&&this.__onDrag(f,p)},_onMouseWheel:function(f){this.__onMouseWheel(f)},_onMouseOut:function(f){var p=this._hoveredTarget;this.fire("mouse:out",{target:p,e:f}),this._hoveredTarget=null,p&&p.fire("mouseout",{e:f});var d=this;this._hoveredTargets.forEach(function(v){d.fire("mouse:out",{target:p,e:f}),v&&p.fire("mouseout",{e:f})}),this._hoveredTargets=[]},_onMouseEnter:function(f){!this._currentTransform&&!this.findTarget(f)&&(this.fire("mouse:over",{target:null,e:f}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(f,p){this.__onOrientationChange&&this.__onOrientationChange(f,p)},_onShake:function(f,p){this.__onShake&&this.__onShake(f,p)},_onLongPress:function(f,p){this.__onLongPress&&this.__onLongPress(f,p)},_onDragOver:function(f){f.preventDefault();var p=this._simpleEventHandler("dragover",f);this._fireEnterLeaveEvents(p,f)},_onDrop:function(f){return this._simpleEventHandler("drop:before",f),this._simpleEventHandler("drop",f)},_onContextMenu:function(f){return this.stopContextMenu&&(f.stopPropagation(),f.preventDefault()),!1},_onDoubleClick:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"dblclick"),this._resetTransformEventData(f)},getPointerId:function(f){var p=f.changedTouches;return p?p[0]&&p[0].identifier:this.enablePointerEvents?f.pointerId:-1},_isMainEvent:function(f){return f.isPrimary===!0?!0:f.isPrimary===!1?!1:f.type==="touchend"&&f.touches.length===0?!0:f.changedTouches?f.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(f){f.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),this._resetTransformEventData();var p=this.upperCanvasEl,d=this._getEventPrefix();o(t.document,"touchend",this._onTouchEnd,c),o(t.document,"touchmove",this._onMouseMove,c),n(p,d+"down",this._onMouseDown)},_onMouseDown:function(f){this.__onMouseDown(f),this._resetTransformEventData();var p=this.upperCanvasEl,d=this._getEventPrefix();n(p,d+"move",this._onMouseMove,c),o(t.document,d+"up",this._onMouseUp),o(t.document,d+"move",this._onMouseMove,c)},_onTouchEnd:function(f){if(!(f.touches.length>0)){this.__onMouseUp(f),this._resetTransformEventData(),this.mainTouchId=null;var p=this._getEventPrefix();n(t.document,"touchend",this._onTouchEnd,c),n(t.document,"touchmove",this._onMouseMove,c);var d=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){o(d.upperCanvasEl,p+"down",d._onMouseDown),d._willAddMouseDown=0},400)}},_onMouseUp:function(f){this.__onMouseUp(f),this._resetTransformEventData();var p=this.upperCanvasEl,d=this._getEventPrefix();this._isMainEvent(f)&&(n(t.document,d+"up",this._onMouseUp),n(t.document,d+"move",this._onMouseMove,c),o(p,d+"move",this._onMouseMove,c))},_onMouseMove:function(f){!this.allowTouchScrolling&&f.preventDefault&&f.preventDefault(),this.__onMouseMove(f)},_onResize:function(){this.calcOffset()},_shouldRender:function(f){var p=this._activeObject;return!!p!=!!f||p&&f&&p!==f?!0:(p&&p.isEditing,!1)},__onMouseUp:function(f){var p,d=this._currentTransform,v=this._groupSelector,_=!1,b=!v||v.left===0&&v.top===0;if(this._cacheTransformEventData(f),p=this._target,this._handleEvent(f,"up:before"),a(f,l)){this.fireRightClick&&this._handleEvent(f,"up",l,b);return}if(a(f,u)){this.fireMiddleClick&&this._handleEvent(f,"up",u,b),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(f);return}if(this._isMainEvent(f)){if(d&&(this._finalizeCurrentTransform(f),_=d.actionPerformed),!b){var y=p===this._activeObject;this._maybeGroupObjects(f),_||(_=this._shouldRender(p)||!y&&p===this._activeObject)}var x,C;if(p){if(x=p._findTargetCorner(this.getPointer(f,!0),t.util.isTouchEvent(f)),p.selectable&&p!==this._activeObject&&p.activeOn==="up")this.setActiveObject(p,f),_=!0;else{var S=p.controls[x],O=S&&S.getMouseUpHandler(f,p,S);O&&(C=this.getPointer(f),O(f,d,C.x,C.y))}p.isMoving=!1}if(d&&(d.target!==p||d.corner!==x)){var E=d.target&&d.target.controls[d.corner],R=E&&E.getMouseUpHandler(f,p,S);C=C||this.getPointer(f),R&&R(f,d,C.x,C.y)}this._setCursorFromEvent(f,p),this._handleEvent(f,"up",r,b),this._groupSelector=null,this._currentTransform=null,p&&(p.__corner=0),_?this.requestRenderAll():b||this.renderTop()}},_simpleEventHandler:function(f,p){var d=this.findTarget(p),v=this.targets,_={e:p,target:d,subTargets:v};if(this.fire(f,_),d&&d.fire(f,_),!v)return d;for(var b=0;b<v.length;b++)v[b].fire(f,_);return d},_handleEvent:function(f,p,d,v){var _=this._target,b=this.targets||[],y={e:f,target:_,subTargets:b,button:d||r,isClick:v||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};p==="up"&&(y.currentTarget=this.findTarget(f),y.currentSubTargets=this.targets),this.fire("mouse:"+p,y),_&&_.fire("mouse"+p,y);for(var x=0;x<b.length;x++)b[x].fire("mouse"+p,y)},_finalizeCurrentTransform:function(f){var p=this._currentTransform,d=p.target,v={e:f,target:d,transform:p,action:p.action};d._scaling&&(d._scaling=!1),d.setCoords(),(p.actionPerformed||this.stateful&&d.hasStateChanged())&&this._fire("modified",v)},_onMouseDownInDrawingMode:function(f){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(f).requestRenderAll();var p=this.getPointer(f);this.freeDrawingBrush.onMouseDown(p,{e:f,pointer:p}),this._handleEvent(f,"down")},_onMouseMoveInDrawingMode:function(f){if(this._isCurrentlyDrawing){var p=this.getPointer(f);this.freeDrawingBrush.onMouseMove(p,{e:f,pointer:p})}this.setCursor(this.freeDrawingCursor),this._handleEvent(f,"move")},_onMouseUpInDrawingMode:function(f){var p=this.getPointer(f);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:f,pointer:p}),this._handleEvent(f,"up")},__onMouseDown:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"down:before");var p=this._target;if(a(f,l)){this.fireRightClick&&this._handleEvent(f,"down",l);return}if(a(f,u)){this.fireMiddleClick&&this._handleEvent(f,"down",u);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(f);return}if(this._isMainEvent(f)&&!this._currentTransform){var d=this._pointer;this._previousPointer=d;var v=this._shouldRender(p),_=this._shouldGroup(f,p);if(this._shouldClearSelection(f,p)?this.discardActiveObject(f):_&&(this._handleGrouping(f,p),p=this._activeObject),this.selection&&(!p||!p.selectable&&!p.isEditing&&p!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),p){var b=p===this._activeObject;p.selectable&&p.activeOn==="down"&&this.setActiveObject(p,f);var y=p._findTargetCorner(this.getPointer(f,!0),t.util.isTouchEvent(f));if(p.__corner=y,p===this._activeObject&&(y||!_)){this._setupCurrentTransform(f,p,b);var x=p.controls[y],d=this.getPointer(f),C=x&&x.getMouseDownHandler(f,p,x);C&&C(f,this._currentTransform,d.x,d.y)}}this._handleEvent(f,"down"),(v||_)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(f){this._resetTransformEventData(),this._pointer=this.getPointer(f,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(f)||null},_beforeTransform:function(f){var p=this._currentTransform;this.stateful&&p.target.saveState(),this.fire("before:transform",{e:f,transform:p})},__onMouseMove:function(f){this._handleEvent(f,"move:before"),this._cacheTransformEventData(f);var p,d;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(f);return}if(this._isMainEvent(f)){var v=this._groupSelector;v?(d=this._absolutePointer,v.left=d.x-v.ex,v.top=d.y-v.ey,this.renderTop()):this._currentTransform?this._transformObject(f):(p=this.findTarget(f)||null,this._setCursorFromEvent(f,p),this._fireOverOutEvents(p,f)),this._handleEvent(f,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(f,p){var d=this._hoveredTarget,v=this._hoveredTargets,_=this.targets,b=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(f,p,{oldTarget:d,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:v[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=f,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(f,p){var d=this._draggedoverTarget,v=this._hoveredTargets,_=this.targets,b=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(f,p,{oldTarget:d,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:v[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=f},fireSyntheticInOutEvents:function(f,p,d){var v,_,b=d.oldTarget,y,x,C=b!==f,S=d.canvasEvtIn,O=d.canvasEvtOut;C&&(v={e:p,target:f,previousTarget:b},_={e:p,target:b,nextTarget:f}),x=f&&C,y=b&&C,y&&(O&&this.fire(O,_),b.fire(d.evtOut,_)),x&&(S&&this.fire(S,v),f.fire(d.evtIn,v))},__onMouseWheel:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"wheel"),this._resetTransformEventData()},_transformObject:function(f){var p=this.getPointer(f),d=this._currentTransform;d.reset=!1,d.shiftKey=f.shiftKey,d.altKey=f[this.centeredKey],this._performTransformAction(f,d,p),d.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(f,p,d){var v=d.x,_=d.y,b=p.action,y=!1,x=p.actionHandler;x&&(y=x(f,p,v,_)),b==="drag"&&y&&(p.target.isMoving=!0,this.setCursor(p.target.moveCursor||this.moveCursor)),p.actionPerformed=p.actionPerformed||y},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(f,p){if(!p)return this.setCursor(this.defaultCursor),!1;var d=p.hoverCursor||this.hoverCursor,v=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,_=(!v||!v.contains(p))&&p._findTargetCorner(this.getPointer(f,!0));_?this.setCursor(this.getCornerCursor(_,p,f)):(p.subTargetCheck&&this.targets.concat().reverse().map(function(b){d=b.hoverCursor||d}),this.setCursor(d))},getCornerCursor:function(f,p,d){var v=p.controls[f];return v.cursorStyleHandler(d,v,p)}})}(),function(){var o=Math.min,n=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,u){var r=this._activeObject;return r&&this._isSelectionKeyPressed(l)&&u&&u.selectable&&this.selection&&(r!==u||r.type==="activeSelection")&&!u.onSelect({e:l})},_handleGrouping:function(l,u){var r=this._activeObject;r.__corner||u===r&&(u=this.findTarget(l,!0),!u||!u.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(u,l):this._createActiveSelection(u,l))},_updateActiveSelection:function(l,u){var r=this._activeObject,c=r._objects.slice(0);r.contains(l)?(r.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),u)):(r.addWithUpdate(l),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(c,u)},_createActiveSelection:function(l,u){var r=this.getActiveObjects(),c=this._createGroup(l);this._hoveredTarget=c,this._setActiveObject(c,u),this._fireSelectionEvents(r,u)},_createGroup:function(l){var u=this._objects,r=u.indexOf(this._activeObject)<u.indexOf(l),c=r?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(c,{canvas:this})},_groupSelectedObjects:function(l){var u=this._collectObjects(l),r;u.length===1?this.setActiveObject(u[0],l):u.length>1&&(r=new t.ActiveSelection(u.reverse(),{canvas:this}),this.setActiveObject(r,l))},_collectObjects:function(l){for(var u=[],r,c=this._groupSelector.ex,a=this._groupSelector.ey,f=c+this._groupSelector.left,p=a+this._groupSelector.top,d=new t.Point(o(c,f),o(a,p)),v=new t.Point(n(c,f),n(a,p)),_=!this.selectionFullyContained,b=c===f&&a===p,y=this._objects.length;y--&&(r=this._objects[y],!(!(!r||!r.selectable||!r.visible)&&(_&&r.intersectsWithRect(d,v,!0)||r.isContainedWithinRect(d,v,!0)||_&&r.containsPoint(d,null,!0)||_&&r.containsPoint(v,null,!0))&&(u.push(r),b))););return u.length>1&&(u=u.filter(function(x){return!x.onSelect({e:l})})),u},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(o){o||(o={});var n=o.format||"png",l=o.quality||1,u=(o.multiplier||1)*(o.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(u,o);return t.util.toDataURL(r,n,l)},toCanvasElement:function(o,n){o=o||1,n=n||{};var l=(n.width||this.width)*o,u=(n.height||this.height)*o,r=this.getZoom(),c=this.width,a=this.height,f=r*o,p=this.viewportTransform,d=(p[4]-(n.left||0))*o,v=(p[5]-(n.top||0))*o,_=this.interactive,b=[f,0,0,f,d,v],y=this.enableRetinaScaling,x=t.util.createCanvasElement(),C=this.contextTop;return x.width=l,x.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=b,this.width=l,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(x.getContext("2d"),this._objects),this.viewportTransform=p,this.width=c,this.height=a,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=y,this.contextTop=C,x}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(o,n,l){if(o){var u=typeof o=="string"?JSON.parse(o):t.util.object.clone(o),r=this,c=u.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(f){r.clear(),r._setBgOverlay(u,function(){c?r._enlivenObjects([c],function(p){r.clipPath=p[0],r.__setupCanvas.call(r,u,f,a,n)}):r.__setupCanvas.call(r,u,f,a,n)})},l),this}},__setupCanvas:function(o,n,l,u){var r=this;n.forEach(function(c,a){r.insertAt(c,a)}),this.renderOnAddRemove=l,delete o.objects,delete o.backgroundImage,delete o.overlayImage,delete o.background,delete o.overlay,this._setOptions(o),this.renderAll(),u&&u()},_setBgOverlay:function(o,n){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!o.backgroundImage&&!o.overlayImage&&!o.background&&!o.overlay){n&&n();return}var u=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&n&&n()};this.__setBgOverlay("backgroundImage",o.backgroundImage,l,u),this.__setBgOverlay("overlayImage",o.overlayImage,l,u),this.__setBgOverlay("backgroundColor",o.background,l,u),this.__setBgOverlay("overlayColor",o.overlay,l,u)},__setBgOverlay:function(o,n,l,u){var r=this;if(!n){l[o]=!0,u&&u();return}o==="backgroundImage"||o==="overlayImage"?t.util.enlivenObjects([n],function(c){r[o]=c[0],l[o]=!0,u&&u()}):this["set"+t.util.string.capitalize(o,!0)](n,function(){l[o]=!0,u&&u()})},_enlivenObjects:function(o,n,l){if(!o||o.length===0){n&&n([]);return}t.util.enlivenObjects(o,function(u){n&&n(u)},null,l)},_toDataURL:function(o,n){this.clone(function(l){n(l.toDataURL(o))})},_toDataURLWithMultiplier:function(o,n,l){this.clone(function(u){l(u.toDataURLWithMultiplier(o,n))})},clone:function(o,n){var l=JSON.stringify(this.toJSON(n));this.cloneWithoutData(function(u){u.loadFromJSON(l,function(){o&&o(u)})})},cloneWithoutData:function(o){var n=t.util.createCanvasElement();n.width=this.width,n.height=this.height;var l=new t.Canvas(n);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),o&&o(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):o&&o(l)}}),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.object.clone,r=n.util.toFixed,c=n.util.string.capitalize,a=n.util.degreesToRadians,f=!n.isLikelyNode,p=2;n.Object||(n.Object=n.util.createClass(n.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:f,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(d){d&&this.setOptions(d)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=n.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(d){var v=n.perfLimitSizeTotal,_=d.width,b=d.height,y=n.maxCacheSideLimit,x=n.minCacheSideLimit;if(_<=y&&b<=y&&_*b<=v)return _<x&&(d.width=x),b<x&&(d.height=x),d;var C=_/b,S=n.util.limitDimsByArea(C,v),O=n.util.capValue,E=O(x,S.x,y),R=O(x,S.y,y);return _>E&&(d.zoomX/=_/E,d.width=E,d.capped=!0),b>R&&(d.zoomY/=b/R,d.height=R,d.capped=!0),d},_getCacheCanvasDimensions:function(){var d=this.getTotalObjectScaling(),v=this._getTransformedDimensions(0,0),_=v.x*d.scaleX/this.scaleX,b=v.y*d.scaleY/this.scaleY;return{width:_+p,height:b+p,zoomX:d.scaleX,zoomY:d.scaleY,x:_,y:b}},_updateCacheCanvas:function(){var d=this.canvas;if(this.noScaleCache&&d&&d._currentTransform){var v=d._currentTransform.target,_=d._currentTransform.action;if(this===v&&_.slice&&_.slice(0,5)==="scale")return!1}var b=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),x=n.minCacheSideLimit,C=y.width,S=y.height,O,E,R=y.zoomX,W=y.zoomY,X=C!==this.cacheWidth||S!==this.cacheHeight,Q=this.zoomX!==R||this.zoomY!==W,$=X||Q,B=0,K=0,tt=!1;if(X){var nt=this._cacheCanvas.width,w=this._cacheCanvas.height,M=C>nt||S>w,D=(C<nt*.9||S<w*.9)&&nt>x&&w>x;tt=M||D,M&&!y.capped&&(C>x||S>x)&&(B=C*.1,K=S*.1)}return this instanceof n.Text&&this.path&&($=!0,tt=!0,B+=this.getHeightOfLine(0)*this.zoomX,K+=this.getHeightOfLine(0)*this.zoomY),$?(tt?(b.width=Math.ceil(C+B),b.height=Math.ceil(S+K)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,b.width,b.height)),O=y.x/2,E=y.y/2,this.cacheTranslationX=Math.round(b.width/2-O)+O,this.cacheTranslationY=Math.round(b.height/2-E)+E,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(R,W),this.zoomX=R,this.zoomY=W,!0):!1},setOptions:function(d){this._setOptions(d),this._initGradient(d.fill,"fill"),this._initGradient(d.stroke,"stroke"),this._initPattern(d.fill,"fill"),this._initPattern(d.stroke,"stroke")},transform:function(d){var v=this.group&&!this.group._transformDone||this.group&&this.canvas&&d===this.canvas.contextTop,_=this.calcTransformMatrix(!v);d.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(d){var v=n.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:n.version,originX:this.originX,originY:this.originY,left:r(this.left,v),top:r(this.top,v),width:r(this.width,v),height:r(this.height,v),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,v),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,v),scaleX:r(this.scaleX,v),scaleY:r(this.scaleY,v),angle:r(this.angle,v),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,v),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,v),skewY:r(this.skewY,v)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(d),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),n.util.populateWithProperties(this,_,d),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(d){return this.toObject(d)},_removeDefaultValues:function(d){var v=n.util.getKlass(d.type).prototype,_=v.stateProperties;return _.forEach(function(b){b==="left"||b==="top"||(d[b]===v[b]&&delete d[b],Array.isArray(d[b])&&Array.isArray(v[b])&&d[b].length===0&&v[b].length===0&&delete d[b])}),d},toString:function(){return"#<fabric."+c(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var d=n.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(d.scaleX),scaleY:Math.abs(d.scaleY)}},getTotalObjectScaling:function(){var d=this.getObjectScaling(),v=d.scaleX,_=d.scaleY;if(this.canvas){var b=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();v*=b*y,_*=b*y}return{scaleX:v,scaleY:_}},getObjectOpacity:function(){var d=this.opacity;return this.group&&(d*=this.group.getObjectOpacity()),d},_set:function(d,v){var _=d==="scaleX"||d==="scaleY",b=this[d]!==v,y=!1;return _&&(v=this._constrainScale(v)),d==="scaleX"&&v<0?(this.flipX=!this.flipX,v*=-1):d==="scaleY"&&v<0?(this.flipY=!this.flipY,v*=-1):d==="shadow"&&v&&!(v instanceof n.Shadow)?v=new n.Shadow(v):d==="dirty"&&this.group&&this.group.set("dirty",v),this[d]=v,b&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(d)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(d)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:n.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(d){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(d.save(),this._setupCompositeOperation(d),this.drawSelectionBackground(d),this.transform(d),this._setOpacity(d),this._setShadow(d,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(d)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(d),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),d.restore())},renderCache:function(d){d=d||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,d.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(d,v){if(d.save(),v.inverted?d.globalCompositeOperation="destination-out":d.globalCompositeOperation="destination-in",v.absolutePositioned){var _=n.util.invertTransform(this.calcTransformMatrix());d.transform(_[0],_[1],_[2],_[3],_[4],_[5])}v.transform(d),d.scale(1/v.zoomX,1/v.zoomY),d.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),d.restore()},drawObject:function(d,v){var _=this.fill,b=this.stroke;v?(this.fill="black",this.stroke="",this._setClippingProperties(d)):this._renderBackground(d),this._render(d),this._drawClipPath(d,this.clipPath),this.fill=_,this.stroke=b},_drawClipPath:function(d,v){v&&(v.canvas=this.canvas,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCache(d,v))},drawCacheOnCanvas:function(d){d.scale(1/this.zoomX,1/this.zoomY),d.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(d){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!d&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!d){var v=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-v/2,-_/2,v,_)}return!0}return!1},_renderBackground:function(d){if(this.backgroundColor){var v=this._getNonTransformedDimensions();d.fillStyle=this.backgroundColor,d.fillRect(-v.x/2,-v.y/2,v.x,v.y),this._removeShadow(d)}},_setOpacity:function(d){this.group&&!this.group._transformDone?d.globalAlpha=this.getObjectOpacity():d.globalAlpha*=this.opacity},_setStrokeStyles:function(d,v){var _=v.stroke;_&&(d.lineWidth=v.strokeWidth,d.lineCap=v.strokeLineCap,d.lineDashOffset=v.strokeDashOffset,d.lineJoin=v.strokeLineJoin,d.miterLimit=v.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(d,_):(d.strokeStyle=_.toLive(d,this),this._applyPatternGradientTransform(d,_)):d.strokeStyle=v.stroke)},_setFillStyles:function(d,v){var _=v.fill;_&&(_.toLive?(d.fillStyle=_.toLive(d,this),this._applyPatternGradientTransform(d,v.fill)):d.fillStyle=_)},_setClippingProperties:function(d){d.globalAlpha=1,d.strokeStyle="transparent",d.fillStyle="#000000"},_setLineDash:function(d,v){!v||v.length===0||(1&v.length&&v.push.apply(v,v),d.setLineDash(v))},_renderControls:function(d,v){var _=this.getViewportTransform(),b=this.calcTransformMatrix(),y,x,C;v=v||{},x=typeof v.hasBorders<"u"?v.hasBorders:this.hasBorders,C=typeof v.hasControls<"u"?v.hasControls:this.hasControls,b=n.util.multiplyTransformMatrices(_,b),y=n.util.qrDecompose(b),d.save(),d.translate(y.translateX,y.translateY),d.lineWidth=1*this.borderScaleFactor,this.group||(d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),d.rotate(a(this.group?y.angle:this.angle)),v.forActiveSelection||this.group?x&&this.drawBordersInGroup(d,y,v):x&&this.drawBorders(d,v),C&&this.drawControls(d,v),d.restore()},_setShadow:function(d){if(this.shadow){var v=this.shadow,_=this.canvas,b,y=_&&_.viewportTransform[0]||1,x=_&&_.viewportTransform[3]||1;v.nonScaling?b={scaleX:1,scaleY:1}:b=this.getObjectScaling(),_&&_._isRetinaScaling()&&(y*=n.devicePixelRatio,x*=n.devicePixelRatio),d.shadowColor=v.color,d.shadowBlur=v.blur*n.browserShadowBlurConstant*(y+x)*(b.scaleX+b.scaleY)/4,d.shadowOffsetX=v.offsetX*y*b.scaleX,d.shadowOffsetY=v.offsetY*x*b.scaleY}},_removeShadow:function(d){this.shadow&&(d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0)},_applyPatternGradientTransform:function(d,v){if(!v||!v.toLive)return{offsetX:0,offsetY:0};var _=v.gradientTransform||v.patternTransform,b=-this.width/2+v.offsetX||0,y=-this.height/2+v.offsetY||0;return v.gradientUnits==="percentage"?d.transform(this.width,0,0,this.height,b,y):d.transform(1,0,0,1,b,y),_&&d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:b,offsetY:y}},_renderPaintInOrder:function(d){this.paintFirst==="stroke"?(this._renderStroke(d),this._renderFill(d)):(this._renderFill(d),this._renderStroke(d))},_render:function(){},_renderFill:function(d){this.fill&&(d.save(),this._setFillStyles(d,this),this.fillRule==="evenodd"?d.fill("evenodd"):d.fill(),d.restore())},_renderStroke:function(d){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this.strokeUniform&&this.group){var v=this.getObjectScaling();d.scale(1/v.scaleX,1/v.scaleY)}else this.strokeUniform&&d.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(d,this.strokeDashArray),this._setStrokeStyles(d,this),d.stroke(),d.restore()}},_applyPatternForTransformedGradient:function(d,v){var _=this._limitCacheSize(this._getCacheCanvasDimensions()),b=n.util.createCanvasElement(),y,x=this.canvas.getRetinaScaling(),C=_.x/this.scaleX/x,S=_.y/this.scaleY/x;b.width=C,b.height=S,y=b.getContext("2d"),y.beginPath(),y.moveTo(0,0),y.lineTo(C,0),y.lineTo(C,S),y.lineTo(0,S),y.closePath(),y.translate(C/2,S/2),y.scale(_.zoomX/this.scaleX/x,_.zoomY/this.scaleY/x),this._applyPatternGradientTransform(y,v),y.fillStyle=v.toLive(d),y.fill(),d.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),d.scale(x*this.scaleX/_.zoomX,x*this.scaleY/_.zoomY),d.strokeStyle=y.createPattern(b,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var d=n.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",d.scaleX),this.set("scaleY",d.scaleY),this.angle=d.angle,this.skewX=d.skewX,this.skewY=0}},_removeTransformMatrix:function(d){var v=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),v=n.util.transformPoint(v,this.transformMatrix)),this.transformMatrix=null,d&&(this.scaleX*=d.scaleX,this.scaleY*=d.scaleY,this.cropX=d.cropX,this.cropY=d.cropY,v.x+=d.offsetLeft,v.y+=d.offsetTop,this.width=d.width,this.height=d.height),this.setPositionByOrigin(v,"center","center")},clone:function(d,v){var _=this.toObject(v);this.constructor.fromObject?this.constructor.fromObject(_,d):n.Object._fromObject("Object",_,d)},cloneAsImage:function(d,v){var _=this.toCanvasElement(v);return d&&d(new n.Image(_)),this},toCanvasElement:function(d){d||(d={});var v=n.util,_=v.saveObjectTransform(this),b=this.group,y=this.shadow,x=Math.abs,C=(d.multiplier||1)*(d.enableRetinaScaling?n.devicePixelRatio:1);delete this.group,d.withoutTransform&&v.resetObjectTransform(this),d.withoutShadow&&(this.shadow=null);var S=n.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),E=this.shadow,R,W={x:0,y:0},X,Q,$;E&&(X=E.blur,E.nonScaling?R={scaleX:1,scaleY:1}:R=this.getObjectScaling(),W.x=2*Math.round(x(E.offsetX)+X)*x(R.scaleX),W.y=2*Math.round(x(E.offsetY)+X)*x(R.scaleY)),Q=O.width+W.x,$=O.height+W.y,S.width=Math.ceil(Q),S.height=Math.ceil($);var B=new n.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});d.format==="jpeg"&&(B.backgroundColor="#fff"),this.setPositionByOrigin(new n.Point(B.width/2,B.height/2),"center","center");var K=this.canvas;B.add(this);var tt=B.toCanvasElement(C||1,d);return this.shadow=y,this.set("canvas",K),b&&(this.group=b),this.set(_).setCoords(),B._objects=[],B.dispose(),B=null,tt},toDataURL:function(d){return d||(d={}),n.util.toDataURL(this.toCanvasElement(d),d.format||"png",d.quality||1)},isType:function(d){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===d},complexity:function(){return 1},toJSON:function(d){return this.toObject(d)},rotate:function(d){var v=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return v&&this._setOriginToCenter(),this.set("angle",d),v&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(d,v){v=v||this.canvas.getPointer(d);var _=new n.Point(v.x,v.y),b=this._getLeftTopCoords();return this.angle&&(_=n.util.rotatePoint(_,b,a(-this.angle))),{x:_.x-b.x,y:_.y-b.y}},_setupCompositeOperation:function(d){this.globalCompositeOperation&&(d.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){n.runningAnimations&&n.runningAnimations.cancelByTarget(this)}}),n.util.createAccessors&&n.util.createAccessors(n.Object),l(n.Object.prototype,n.Observable),n.Object.NUM_FRACTION_DIGITS=2,n.Object.ENLIVEN_PROPS=["clipPath"],n.Object._fromObject=function(d,v,_,b){var y=n[d];v=u(v,!0),n.util.enlivenPatterns([v.fill,v.stroke],function(x){typeof x[0]<"u"&&(v.fill=x[0]),typeof x[1]<"u"&&(v.stroke=x[1]),n.util.enlivenObjectEnlivables(v,v,function(){var C=b?new y(v[b],v):new y(v);_&&_(C)})})},n.Object.__uid=0)}(i),function(){var o=t.util.degreesToRadians,n={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(u,r,c,a,f){var p=u.x,d=u.y,v,_,b;return typeof r=="string"?r=n[r]:r-=.5,typeof a=="string"?a=n[a]:a-=.5,v=a-r,typeof c=="string"?c=l[c]:c-=.5,typeof f=="string"?f=l[f]:f-=.5,_=f-c,(v||_)&&(b=this._getTransformedDimensions(),p=u.x+v*b.x,d=u.y+_*b.y),new t.Point(p,d)},translateToCenterPoint:function(u,r,c){var a=this.translateToGivenOrigin(u,r,c,"center","center");return this.angle?t.util.rotatePoint(a,u,o(this.angle)):a},translateToOriginPoint:function(u,r,c){var a=this.translateToGivenOrigin(u,"center","center",r,c);return this.angle?t.util.rotatePoint(a,u,o(this.angle)):a},getCenterPoint:function(){var u=new t.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,r){var c=this.getCenterPoint();return this.translateToOriginPoint(c,u,r)},toLocalPoint:function(u,r,c){var a=this.getCenterPoint(),f,p;return typeof r<"u"&&typeof c<"u"?f=this.translateToGivenOrigin(a,"center","center",r,c):f=new t.Point(this.left,this.top),p=new t.Point(u.x,u.y),this.angle&&(p=t.util.rotatePoint(p,a,-o(this.angle))),p.subtractEquals(f)},setPositionByOrigin:function(u,r,c){var a=this.translateToCenterPoint(u,r,c),f=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",f.x),this.set("top",f.y)},adjustPosition:function(u){var r=o(this.angle),c=this.getScaledWidth(),a=t.util.cos(r)*c,f=t.util.sin(r)*c,p,d;typeof this.originX=="string"?p=n[this.originX]:p=this.originX-.5,typeof u=="string"?d=n[u]:d=u-.5,this.left+=a*(d-p),this.top+=f*(d-p),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function o(c){return[new t.Point(c.tl.x,c.tl.y),new t.Point(c.tr.x,c.tr.y),new t.Point(c.br.x,c.br.y),new t.Point(c.bl.x,c.bl.y)]}var n=t.util,l=n.degreesToRadians,u=n.multiplyTransformMatrices,r=n.transformPoint;n.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(c,a){return a?c?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),c?this.aCoords:this.lineCoords)},getCoords:function(c,a){return o(this._getCoords(c,a))},intersectsWithRect:function(c,a,f,p){var d=this.getCoords(f,p),v=t.Intersection.intersectPolygonRectangle(d,c,a);return v.status==="Intersection"},intersectsWithObject:function(c,a,f){var p=t.Intersection.intersectPolygonPolygon(this.getCoords(a,f),c.getCoords(a,f));return p.status==="Intersection"||c.isContainedWithinObject(this,a,f)||this.isContainedWithinObject(c,a,f)},isContainedWithinObject:function(c,a,f){for(var p=this.getCoords(a,f),d=a?c.aCoords:c.lineCoords,v=0,_=c._getImageLines(d);v<4;v++)if(!c.containsPoint(p[v],_))return!1;return!0},isContainedWithinRect:function(c,a,f,p){var d=this.getBoundingRect(f,p);return d.left>=c.x&&d.left+d.width<=a.x&&d.top>=c.y&&d.top+d.height<=a.y},containsPoint:function(c,v,f,p){var d=this._getCoords(f,p),v=v||this._getImageLines(d),_=this._findCrossPoints(c,v);return _!==0&&_%2===1},isOnScreen:function(c){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br,p=this.getCoords(!0,c);return p.some(function(d){return d.x<=f.x&&d.x>=a.x&&d.y<=f.y&&d.y>=a.y})||this.intersectsWithRect(a,f,!0,c)?!0:this._containsCenterOfCanvas(a,f,c)},_containsCenterOfCanvas:function(c,a,f){var p={x:(c.x+a.x)/2,y:(c.y+a.y)/2};return!!this.containsPoint(p,null,!0,f)},isPartiallyOnScreen:function(c){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br;if(this.intersectsWithRect(a,f,!0,c))return!0;var p=this.getCoords(!0,c).every(function(d){return(d.x>=f.x||d.x<=a.x)&&(d.y>=f.y||d.y<=a.y)});return p&&this._containsCenterOfCanvas(a,f,c)},_getImageLines:function(c){var a={topline:{o:c.tl,d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}};return a},_findCrossPoints:function(c,a){var f,p,d,v,_,b=0,y;for(var x in a)if(y=a[x],!(y.o.y<c.y&&y.d.y<c.y)&&!(y.o.y>=c.y&&y.d.y>=c.y)&&(y.o.x===y.d.x&&y.o.x>=c.x?_=y.o.x:(f=0,p=(y.d.y-y.o.y)/(y.d.x-y.o.x),d=c.y-f*c.x,v=y.o.y-p*y.o.x,_=-(d-v)/(f-p)),_>=c.x&&(b+=1),b===2))break;return b},getBoundingRect:function(c,a){var f=this.getCoords(c,a);return n.makeBoundingBoxFromPoints(f)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?c<0?-this.minScaleLimit:this.minScaleLimit:c===0?1e-4:c},scale:function(c){return this._set("scaleX",c),this._set("scaleY",c),this.setCoords()},scaleToWidth:function(c,a){var f=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(c/this.width/f)},scaleToHeight:function(c,a){var f=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(c/this.height/f)},calcLineCoords:function(){var c=this.getViewportTransform(),a=this.padding,f=l(this.angle),p=n.cos(f),d=n.sin(f),v=p*a,_=d*a,b=v+_,y=v-_,x=this.calcACoords(),C={tl:r(x.tl,c),tr:r(x.tr,c),bl:r(x.bl,c),br:r(x.br,c)};return a&&(C.tl.x-=y,C.tl.y-=b,C.tr.x+=b,C.tr.y-=y,C.bl.x-=b,C.bl.y+=y,C.br.x+=y,C.br.y+=b),C},calcOCoords:function(){var c=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),f=this.getViewportTransform(),p=u(f,a),d=u(p,c),d=u(d,[1/f[0],0,0,1/f[3],0,0]),v=this._calculateCurrentDimensions(),_={};return this.forEachControl(function(b,y,x){_[y]=b.positionHandler(v,d,x)}),_},calcACoords:function(){var c=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),f=u(a,c),p=this._getTransformedDimensions(),d=p.x/2,v=p.y/2;return{tl:r({x:-d,y:-v},f),tr:r({x:d,y:-v},f),bl:r({x:-d,y:v},f),br:r({x:d,y:v},f)}},setCoords:function(c){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),c?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return n.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var c=this.getCenterPoint();return[1,0,0,1,c.x,c.y]},transformMatrixKey:function(c){var a="_",f="";return!c&&this.group&&(f=this.group.transformMatrixKey(c)+a),f+this.top+a+this.left+a+this.scaleX+a+this.scaleY+a+this.skewX+a+this.skewY+a+this.angle+a+this.originX+a+this.originY+a+this.width+a+this.height+a+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(c){var a=this.calcOwnMatrix();if(c||!this.group)return a;var f=this.transformMatrixKey(c),p=this.matrixCache||(this.matrixCache={});return p.key===f?p.value:(this.group&&(a=u(this.group.calcTransformMatrix(!1),a)),p.key=f,p.value=a,a)},calcOwnMatrix:function(){var c=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===c)return a.value;var f=this._calcTranslateMatrix(),p={angle:this.angle,translateX:f[4],translateY:f[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return a.key=c,a.value=n.composeMatrix(p),a.value},_getNonTransformedDimensions:function(){var c=this.strokeWidth,a=this.width+c,f=this.height+c;return{x:a,y:f}},_getTransformedDimensions:function(c,a){typeof c>"u"&&(c=this.skewX),typeof a>"u"&&(a=this.skewY);var f,p,d,v=c===0&&a===0;if(this.strokeUniform?(p=this.width,d=this.height):(f=this._getNonTransformedDimensions(),p=f.x,d=f.y),v)return this._finalizeDimensions(p*this.scaleX,d*this.scaleY);var _=n.sizeAfterTransform(p,d,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:c,skewY:a});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(c,a){return this.strokeUniform?{x:c+this.strokeWidth,y:a+this.strokeWidth}:{x:c,y:a}},_calculateCurrentDimensions:function(){var c=this.getViewportTransform(),a=this._getTransformedDimensions(),f=r(a,c,!0);return f.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(o){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,o):this.canvas&&this.canvas.sendBackwards(this,o),this},bringForward:function(o){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,o):this.canvas&&this.canvas.bringForward(this,o),this},moveTo:function(o){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,o):this.canvas&&this.canvas.moveTo(this,o),this}}),function(){function o(l,u){if(u){if(u.toLive)return l+": url(#SVGID_"+u.id+"); ";var r=new t.Color(u),c=l+": "+r.toRgb()+"; ",a=r.getAlpha();return a!==1&&(c+=l+"-opacity: "+a.toString()+"; "),c}else return l+": none; "}var n=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var u=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",c=this.strokeDashArray?this.strokeDashArray.join(" "):"none",a=this.strokeDashOffset?this.strokeDashOffset:"0",f=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",d=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=typeof this.opacity<"u"?this.opacity:"1",_=this.visible?"":" visibility: hidden;",b=l?"":this.getSvgFilter(),y=o("fill",this.fill),x=o("stroke",this.stroke);return[x,"stroke-width: ",r,"; ","stroke-dasharray: ",c,"; ","stroke-linecap: ",f,"; ","stroke-dashoffset: ",a,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",d,"; ",y,"fill-rule: ",u,"; ","opacity: ",v,";",b,_].join("")},getSvgSpanStyles:function(l,u){var r="; ",a=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+r:"",c=l.strokeWidth?"stroke-width: "+l.strokeWidth+r:"",a=a,f=l.fontSize?"font-size: "+l.fontSize+"px"+r:"",p=l.fontStyle?"font-style: "+l.fontStyle+r:"",d=l.fontWeight?"font-weight: "+l.fontWeight+r:"",v=l.fill?o("fill",l.fill):"",_=l.stroke?o("stroke",l.stroke):"",b=this.getSvgTextDecoration(l),y=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return b&&(b="text-decoration: "+b+r),[_,c,a,f,p,d,b,v,y,u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(u){return l[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,u){var r=l?this.calcTransformMatrix():this.calcOwnMatrix(),c='transform="'+t.util.matrixToSVG(r);return c+(u||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var u=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,u),'" y="',n(-this.height/2,u),'" width="',n(this.width,u),'" height="',n(this.height,u),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,u){u=u||{};var r=u.reviver,c=u.additionalTransform||"",a=[this.getSvgTransform(!0,c),this.getSvgCommons()].join(""),f=l.indexOf("COMMON_PARTS");return l[f]=a,r?r(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,u){u=u||{};var r=u.noStyle,c=u.reviver,a=r?"":'style="'+this.getSvgStyles()+'" ',f=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",p=this.clipPath,d=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",v=p&&p.absolutePositioned,_=this.stroke,b=this.fill,y=this.shadow,x,C=[],S,O=l.indexOf("COMMON_PARTS"),E=u.additionalTransform;return p&&(p.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+p.clipPathId+`" >
`+p.toClipPathSVG(c)+`</clipPath>
`),v&&C.push("<g ",f,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),v?"":f+this.getSvgCommons(),` >
`),x=[a,d,r?"":this.addPaintOrder()," ",E?'transform="'+E+'" ':""].join(""),l[O]=x,b&&b.toLive&&C.push(b.toSVG(this)),_&&_.toLive&&C.push(_.toSVG(this)),y&&C.push(y.toSVG(this)),p&&C.push(S),C.push(l.join("")),C.push(`</g>
`),v&&C.push(`</g>
`),c?c(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var o=t.util.object.extend,n="stateProperties";function l(r,c,a){var f={},p=!0;a.forEach(function(d){f[d]=r[d]}),o(r[c],f,p)}function u(r,c,a){if(r===c)return!0;if(Array.isArray(r)){if(!Array.isArray(c)||r.length!==c.length)return!1;for(var f=0,p=r.length;f<p;f++)if(!u(r[f],c[f]))return!1;return!0}else if(r&&typeof r=="object"){var d=Object.keys(r),v;if(!c||typeof c!="object"||!a&&d.length!==Object.keys(c).length)return!1;for(var f=0,p=d.length;f<p;f++)if(v=d[f],!(v==="canvas"||v==="group")&&!u(r[v],c[v]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(r){r=r||n;var c="_"+r;return Object.keys(this[c]).length<this[r].length?!0:!u(this[c],this,!0)},saveState:function(r){var c=r&&r.propertySet||n,a="_"+c;return this[a]?(l(this,a,this[c]),r&&r.stateProperties&&l(this,a,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var c=r.propertySet||n;return r.propertySet=c,this["_"+c]={},this.saveState(r),this}})}(),function(){var o=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(n,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u=n.x,r=n.y,c,a,f=Object.keys(this.oCoords),p=f.length-1,d;for(this.__corner=0;p>=0;p--)if(d=f[p],!!this.isControlVisible(d)&&(a=this._getImageLines(l?this.oCoords[d].touchCorner:this.oCoords[d].corner),c=this._findCrossPoints({x:u,y:r},a),c!==0&&c%2===1))return this.__corner=d,d;return!1},forEachControl:function(n){for(var l in this.controls)n(this.controls[l],l,this)},_setCornerCoords:function(){var n=this.oCoords;for(var l in n){var u=this.controls[l];n[l].corner=u.calcCornerCoords(this.angle,this.cornerSize,n[l].x,n[l].y,!1),n[l].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,n[l].x,n[l].y,!0)}},drawSelectionBackground:function(n){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;n.save();var l=this.getCenterPoint(),u=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return n.translate(l.x,l.y),n.scale(1/r[0],1/r[3]),n.rotate(o(this.angle)),n.fillStyle=this.selectionBackgroundColor,n.fillRect(-u.x/2,-u.y/2,u.x,u.y),n.restore(),this},drawBorders:function(n,l){l=l||{};var u=this._calculateCurrentDimensions(),r=this.borderScaleFactor,c=u.x+r,a=u.y+r,f=typeof l.hasControls<"u"?l.hasControls:this.hasControls,p=!1;return n.save(),n.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(n,l.borderDashArray||this.borderDashArray),n.strokeRect(-c/2,-a/2,c,a),f&&(n.beginPath(),this.forEachControl(function(d,v,_){d.withConnection&&d.getVisibility(_,v)&&(p=!0,n.moveTo(d.x*c,d.y*a),n.lineTo(d.x*c+d.offsetX,d.y*a+d.offsetY))}),p&&n.stroke()),n.restore(),this},drawBordersInGroup:function(n,l,u){u=u||{};var r=t.util.sizeAfterTransform(this.width,this.height,l),c=this.strokeWidth,a=this.strokeUniform,f=this.borderScaleFactor,p=r.x+c*(a?this.canvas.getZoom():l.scaleX)+f,d=r.y+c*(a?this.canvas.getZoom():l.scaleY)+f;return n.save(),this._setLineDash(n,u.borderDashArray||this.borderDashArray),n.strokeStyle=u.borderColor||this.borderColor,n.strokeRect(-p/2,-d/2,p,d),n.restore(),this},drawControls:function(n,l){l=l||{},n.save();var u=this.canvas.getRetinaScaling(),r,c;return n.setTransform(u,0,0,u,0,0),n.strokeStyle=n.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(n.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(n,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(a,f,p){c=p.oCoords[f],a.getVisibility(p,f)&&(r&&(c=t.util.transformPoint(c,r)),a.render(n,c.x,c.y,l,p))}),n.restore(),this},isControlVisible:function(n){return this.controls[n]&&this.controls[n].getVisibility(this,n)},setControlVisible:function(n,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[n]=l,this},setControlsVisibility:function(n){n||(n={});for(var l in n)this.setControlVisible(l,n[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(o,n){n=n||{};var l=function(){},u=n.onComplete||l,r=n.onChange||l,c=this;return t.util.animate({target:this,startValue:o.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(a){o.set("left",a),c.requestRenderAll(),r()},onComplete:function(){o.setCoords(),u()}})},fxCenterObjectV:function(o,n){n=n||{};var l=function(){},u=n.onComplete||l,r=n.onChange||l,c=this;return t.util.animate({target:this,startValue:o.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(a){o.set("top",a),c.requestRenderAll(),r()},onComplete:function(){o.setCoords(),u()}})},fxRemove:function(o,n){n=n||{};var l=function(){},u=n.onComplete||l,r=n.onChange||l,c=this;return t.util.animate({target:this,startValue:o.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(a){o.set("opacity",a),c.requestRenderAll(),r()},onComplete:function(){c.remove(o),u()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var o=[],n,l,u=[];for(n in arguments[0])o.push(n);for(var r=0,c=o.length;r<c;r++)n=o[r],l=r!==c-1,u.push(this._animate(n,arguments[0][n],arguments[1],l));return u}else return this._animate.apply(this,arguments)},_animate:function(o,n,l,u){var r=this,c;n=n.toString(),l?l=t.util.object.clone(l):l={},~o.indexOf(".")&&(c=o.split("."));var a=r.colorProperties.indexOf(o)>-1||c&&r.colorProperties.indexOf(c[1])>-1,f=c?this.get(c[0])[c[1]]:this.get(o);"from"in l||(l.from=f),a||(~n.indexOf("=")?n=f+parseFloat(n.replace("=","")):n=parseFloat(n));var p={target:this,startValue:l.from,endValue:n,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(d,v,_){return l.abort.call(r,d,v,_)},onChange:function(d,v,_){c?r[c[0]][c[1]]=d:r.set(o,d),!u&&l.onChange&&l.onChange(d,v,_)},onComplete:function(d,v,_){u||(r.setCoords(),l.onComplete&&l.onComplete(d,v,_))}};return a?t.util.animateColor(p.startValue,p.endValue,p.duration,p):t.util.animate(p)}}),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(n.Line){n.warn("fabric.Line is already defined");return}n.Line=n.util.createClass(n.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:n.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,f){a||(a=[0,0,0,0]),this.callSuper("initialize",f),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(f)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,f){return this.callSuper("_set",a,f),typeof r[a]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){a.beginPath();var f=this.calcLinePoints();a.moveTo(f.x1,f.y1),a.lineTo(f.x2,f.y2),a.lineWidth=this.strokeWidth;var p=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=p},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(a){return l(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(a.y-=this.strokeWidth),this.height===0&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,p=a*this.width*.5,d=f*this.height*.5,v=a*this.width*-.5,_=f*this.height*-.5;return{x1:p,x2:v,y1:d,y2:_}},_toSVG:function(){var a=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`" />
`]}}),n.Line.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),n.Line.fromElement=function(a,f,p){p=p||{};var d=n.parseAttributes(a,n.Line.ATTRIBUTE_NAMES),v=[d.x1||0,d.y1||0,d.x2||0,d.y2||0];f(new n.Line(v,l(d,p)))},n.Line.fromObject=function(a,f){function p(v){delete v.points,f&&f(v)}var d=u(a,!0);d.points=[a.x1,a.y1,a.x2,a.y2],n.Object._fromObject("Line",d,p,"points")};function c(a,f){var p=a.origin,d=a.axis1,v=a.axis2,_=a.dimension,b=f.nearest,y=f.center,x=f.farthest;return function(){switch(this.get(p)){case b:return Math.min(this.get(d),this.get(v));case y:return Math.min(this.get(d),this.get(v))+.5*this.get(_);case x:return Math.max(this.get(d),this.get(v))}}}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.degreesToRadians;if(n.Circle){n.warn("fabric.Circle is already defined.");return}n.Circle=n.util.createClass(n.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:n.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,c){return this.callSuper("_set",r,c),r==="radius"&&this.setRadius(c),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,c=0,a=0,f=(this.endAngle-this.startAngle)%360;if(f===0)r=["<circle ","COMMON_PARTS",'cx="'+c+'" cy="'+a+'" ','r="',this.radius,`" />
`];else{var p=l(this.startAngle),d=l(this.endAngle),v=this.radius,_=n.util.cos(p)*v,b=n.util.sin(p)*v,y=n.util.cos(d)*v,x=n.util.sin(d)*v,C=f>180?"1":"0";r=['<path d="M '+_+" "+b," A "+v+" "+v," 0 ",+C+" 1"," "+y+" "+x,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),n.Circle.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),n.Circle.fromElement=function(r,c){var a=n.parseAttributes(r,n.Circle.ATTRIBUTE_NAMES);if(!u(a))throw new Error("value of `r` attribute is required and can not be negative");a.left=(a.left||0)-a.radius,a.top=(a.top||0)-a.radius,c(new n.Circle(a))};function u(r){return"radius"in r&&r.radius>=0}n.Circle.fromObject=function(r,c){n.Object._fromObject("Circle",r,c)}}(i),function(o){var n=o.fabric||(o.fabric={});if(n.Triangle){n.warn("fabric.Triangle is already defined");return}n.Triangle=n.util.createClass(n.Object,{type:"triangle",width:100,height:100,_render:function(l){var u=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-u,r),l.lineTo(0,-r),l.lineTo(u,r),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,u=this.height/2,r=[-l+" "+u,"0 "+-u,l+" "+u].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),n.Triangle.fromObject=function(l,u){return n.Object._fromObject("Triangle",l,u)}}(i),function(o){var n=o.fabric||(o.fabric={}),l=Math.PI*2;if(n.Ellipse){n.warn("fabric.Ellipse is already defined.");return}n.Ellipse=n.util.createClass(n.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,r){switch(this.callSuper("_set",u,r),u){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,l,!1),u.restore(),this._renderPaintInOrder(u)}}),n.Ellipse.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),n.Ellipse.fromElement=function(u,r){var c=n.parseAttributes(u,n.Ellipse.ATTRIBUTE_NAMES);c.left=(c.left||0)-c.rx,c.top=(c.top||0)-c.ry,r(new n.Ellipse(c))},n.Ellipse.fromObject=function(u,r){n.Object._fromObject("Ellipse",u,r)}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend;if(n.Rect){n.warn("fabric.Rect is already defined");return}n.Rect=n.util.createClass(n.Object,{stateProperties:n.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var r=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,a=this.width,f=this.height,p=-this.width/2,d=-this.height/2,v=r!==0||c!==0,_=1-.5522847498;u.beginPath(),u.moveTo(p+r,d),u.lineTo(p+a-r,d),v&&u.bezierCurveTo(p+a-_*r,d,p+a,d+_*c,p+a,d+c),u.lineTo(p+a,d+f-c),v&&u.bezierCurveTo(p+a,d+f-_*c,p+a-_*r,d+f,p+a-r,d+f),u.lineTo(p+r,d+f),v&&u.bezierCurveTo(p+_*r,d+f,p,d+f-_*c,p,d+f-c),u.lineTo(p,d+c),v&&u.bezierCurveTo(p,d+_*c,p+_*r,d,p+r,d),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){var u=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',u,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),n.Rect.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),n.Rect.fromElement=function(u,r,c){if(!u)return r(null);c=c||{};var a=n.parseAttributes(u,n.Rect.ATTRIBUTE_NAMES);a.left=a.left||0,a.top=a.top||0,a.height=a.height||0,a.width=a.width||0;var f=new n.Rect(l(c?n.util.object.clone(c):{},a));f.visible=f.visible&&f.width>0&&f.height>0,r(f)},n.Rect.fromObject=function(u,r){return n.Object._fromObject("Rect",u,r)}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.array.min,r=n.util.array.max,c=n.util.toFixed,a=n.util.projectStrokeOnPoints;if(n.Polyline){n.warn("fabric.Polyline is already defined");return}n.Polyline=n.util.createClass(n.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:n.Object.prototype.cacheProperties.concat("points"),initialize:function(f,p){p=p||{},this.points=f||[],this.callSuper("initialize",p),this._setPositionDimensions(p)},_projectStrokeOnPoints:function(){return a(this.points,this,!0)},_setPositionDimensions:function(f){var p=this._calcDimensions(f),d,v=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-v,this.height=p.height-v,f.fromSVG||(d=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+v/2,y:p.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),typeof f.left>"u"&&(this.left=f.fromSVG?p.left:d.x),typeof f.top>"u"&&(this.top=f.fromSVG?p.top:d.y),this.pathOffset={x:p.left+this.width/2+v/2,y:p.top+this.height/2+v/2}},_calcDimensions:function(){var f=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,p=u(f,"x")||0,d=u(f,"y")||0,v=r(f,"x")||0,_=r(f,"y")||0,b=v-p,y=_-d;return{left:p,top:d,width:b,height:y}},toObject:function(f){return l(this.callSuper("toObject",f),{points:this.points.concat()})},_toSVG:function(){for(var f=[],p=this.pathOffset.x,d=this.pathOffset.y,v=n.Object.NUM_FRACTION_DIGITS,_=0,b=this.points.length;_<b;_++)f.push(c(this.points[_].x-p,v),",",c(this.points[_].y-d,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',f.join(""),`" />
`]},commonRender:function(f){var p,d=this.points.length,v=this.pathOffset.x,_=this.pathOffset.y;if(!d||isNaN(this.points[d-1].y))return!1;f.beginPath(),f.moveTo(this.points[0].x-v,this.points[0].y-_);for(var b=0;b<d;b++)p=this.points[b],f.lineTo(p.x-v,p.y-_);return!0},_render:function(f){this.commonRender(f)&&this._renderPaintInOrder(f)},complexity:function(){return this.get("points").length}}),n.Polyline.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polyline.fromElementGenerator=function(f){return function(p,d,v){if(!p)return d(null);v||(v={});var _=n.parsePointsAttribute(p.getAttribute("points")),b=n.parseAttributes(p,n[f].ATTRIBUTE_NAMES);b.fromSVG=!0,d(new n[f](_,l(b,v)))}},n.Polyline.fromElement=n.Polyline.fromElementGenerator("Polyline"),n.Polyline.fromObject=function(f,p){return n.Object._fromObject("Polyline",f,p,"points")}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.projectStrokeOnPoints;if(n.Polygon){n.warn("fabric.Polygon is already defined");return}n.Polygon=n.util.createClass(n.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),n.Polygon.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polygon.fromElement=n.Polyline.fromElementGenerator("Polygon"),n.Polygon.fromObject=function(u,r){n.Object._fromObject("Polygon",u,r,"points")}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.array.min,u=n.util.array.max,r=n.util.object.extend,c=n.util.object.clone,a=n.util.toFixed;if(n.Path){n.warn("fabric.Path is already defined");return}n.Path=n.util.createClass(n.Object,{type:"path",path:null,cacheProperties:n.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:n.Object.prototype.stateProperties.concat("path"),initialize:function(f,p){p=c(p||{}),delete p.path,this.callSuper("initialize",p),this._setPath(f||[],p)},_setPath:function(f,p){this.path=n.util.makePathSimpler(Array.isArray(f)?f:n.util.parsePath(f)),n.Polyline.prototype._setPositionDimensions.call(this,p||{})},_renderPathCommands:function(f){var p,d=0,v=0,_=0,b=0,y=0,x=0,C=-this.pathOffset.x,S=-this.pathOffset.y;f.beginPath();for(var O=0,E=this.path.length;O<E;++O)switch(p=this.path[O],p[0]){case"L":_=p[1],b=p[2],f.lineTo(_+C,b+S);break;case"M":_=p[1],b=p[2],d=_,v=b,f.moveTo(_+C,b+S);break;case"C":_=p[5],b=p[6],y=p[3],x=p[4],f.bezierCurveTo(p[1]+C,p[2]+S,y+C,x+S,_+C,b+S);break;case"Q":f.quadraticCurveTo(p[1]+C,p[2]+S,p[3]+C,p[4]+S),_=p[3],b=p[4],y=p[1],x=p[2];break;case"z":case"Z":_=d,b=v,f.closePath();break}},_render:function(f){this._renderPathCommands(f),this._renderPaintInOrder(f)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){return r(this.callSuper("toObject",f),{path:this.path.map(function(p){return p.slice()})})},toDatalessObject:function(f){var p=this.toObject(["sourcePath"].concat(f));return p.sourcePath&&delete p.path,p},_toSVG:function(){var f=n.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',f,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var f=n.Object.NUM_FRACTION_DIGITS;return" translate("+a(-this.pathOffset.x,f)+", "+a(-this.pathOffset.y,f)+")"},toClipPathSVG:function(f){var p=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:p})},toSVG:function(f){var p=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:p})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var f=[],p=[],d,v=0,_=0,b=0,y=0,x,C=0,S=this.path.length;C<S;++C){switch(d=this.path[C],d[0]){case"L":b=d[1],y=d[2],x=[];break;case"M":b=d[1],y=d[2],v=b,_=y,x=[];break;case"C":x=n.util.getBoundsOfCurve(b,y,d[1],d[2],d[3],d[4],d[5],d[6]),b=d[5],y=d[6];break;case"Q":x=n.util.getBoundsOfCurve(b,y,d[1],d[2],d[1],d[2],d[3],d[4]),b=d[3],y=d[4];break;case"z":case"Z":b=v,y=_;break}x.forEach(function($){f.push($.x),p.push($.y)}),f.push(b),p.push(y)}var O=l(f)||0,E=l(p)||0,R=u(f)||0,W=u(p)||0,X=R-O,Q=W-E;return{left:O,top:E,width:X,height:Q}}}),n.Path.fromObject=function(f,p){if(typeof f.sourcePath=="string"){var d=f.sourcePath;n.loadSVGFromURL(d,function(v){var _=v[0];_.setOptions(f),f.clipPath?n.util.enlivenObjects([f.clipPath],function(b){_.clipPath=b[0],p&&p(_)}):p&&p(_)})}else n.Object._fromObject("Path",f,p,"path")},n.Path.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(["d"]),n.Path.fromElement=function(f,p,d){var v=n.parseAttributes(f,n.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,p(new n.Path(v.d,r(v,d)))}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.array.min,u=n.util.array.max;n.Group||(n.Group=n.util.createClass(n.Object,n.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,c,a){c=c||{},this._objects=[],a&&this.callSuper("initialize",c),this._objects=r||[];for(var f=this._objects.length;f--;)this._objects[f].group=this;if(a)this._updateObjectsACoords();else{var p=c&&c.centerPoint;c.originX!==void 0&&(this.originX=c.originX),c.originY!==void 0&&(this.originY=c.originY),p||this._calcBounds(),this._updateObjectsCoords(p),delete c.centerPoint,this.callSuper("initialize",c)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,c=this._objects.length;c--;)this._objects[c].setCoords(r)},_updateObjectsCoords:function(c){for(var c=c||this.getCenterPoint(),a=this._objects.length;a--;)this._updateObjectCoords(this._objects[a],c)},_updateObjectCoords:function(r,c){var a=r.left,f=r.top,p=!0;r.set({left:a-c.x,top:f-c.y}),r.group=this,r.setCoords(p)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var c=!!this.group;return this._restoreObjectsState(),n.util.resetObjectTransform(this),r&&(c&&n.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,c?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),n.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,c){var a=this._objects.length;if(this.useSetOnGroup)for(;a--;)this._objects[a].setOnGroup(r,c);if(r==="canvas")for(;a--;)this._objects[a]._set(r,c);n.Object.prototype._set.call(this,r,c)},toObject:function(r){var c=this.includeDefaultValues,a=this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){var d=p.includeDefaultValues;p.includeDefaultValues=c;var v=p.toObject(r);return p.includeDefaultValues=d,v}),f=n.Object.prototype.toObject.call(this,r);return f.objects=a,f},toDatalessObject:function(r){var c,a=this.sourcePath;if(a)c=a;else{var f=this.includeDefaultValues;c=this._objects.map(function(d){var v=d.includeDefaultValues;d.includeDefaultValues=f;var _=d.toDatalessObject(r);return d.includeDefaultValues=v,_})}var p=n.Object.prototype.toDatalessObject.call(this,r);return p.objects=c,p},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=n.Object.prototype.shouldCache.call(this);if(r){for(var c=0,a=this._objects.length;c<a;c++)if(this._objects[c].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(n.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,c=this._objects.length;r<c;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var c=0,a=this._objects.length;c<a;c++)this._objects[c].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var c=0,a=this._objects.length;c<a;c++)if(this._objects[c].isCacheDirty(!0)){if(this._cacheCanvas){var f=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-p/2,f,p)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(c){n.util.addTransformToObject(c,r),delete c.group,c.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,c=this.canvas;this._objects=[];var a=this.toObject();delete a.objects;var f=new n.ActiveSelection([]);return f.set(a),f.type="activeSelection",c.remove(this),r.forEach(function(p){p.group=f,p.dirty=!0,c.add(p)}),f.canvas=c,f._objects=r,c._activeObject=f,f.setCoords(),f}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(c){c.setCoords(r)}),this},_calcBounds:function(r){for(var c=[],a=[],f,p,d,v=["tr","br","bl","tl"],_=0,b=this._objects.length,y,x=v.length;_<b;++_){for(f=this._objects[_],d=f.calcACoords(),y=0;y<x;y++)p=v[y],c.push(d[p].x),a.push(d[p].y);f.aCoords=d}this._getBounds(c,a,r)},_getBounds:function(r,c,a){var f=new n.Point(l(r),l(c)),p=new n.Point(u(r),u(c)),d=f.y||0,v=f.x||0,_=p.x-f.x||0,b=p.y-f.y||0;this.width=_,this.height=b,a||this.setPositionByOrigin({x:v,y:d},"left","top")},_toSVG:function(r){for(var c=["<g ","COMMON_PARTS",` >
`],a=0,f=this._objects.length;a<f;a++)c.push("		",this._objects[a].toSVG(r));return c.push(`</g>
`),c},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",c=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),c].join("")},toClipPathSVG:function(r){for(var c=[],a=0,f=this._objects.length;a<f;a++)c.push("	",this._objects[a].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(c,{reviver:r})}}),n.Group.fromObject=function(r,c){var a=r.objects,f=n.util.object.clone(r,!0);if(delete f.objects,typeof a=="string"){n.loadSVGFromURL(a,function(p){var d=n.util.groupSVGElements(p,r,a),v=f.clipPath;delete f.clipPath,d.set(f),v?n.util.enlivenObjects([v],function(_){d.clipPath=_[0],c&&c(d)}):c&&c(d)});return}n.util.enlivenObjects(a,function(p){n.util.enlivenObjectEnlivables(r,f,function(){c&&c(new n.Group(p,f,!0))})})})}(i),function(o){var n=o.fabric||(o.fabric={});n.ActiveSelection||(n.ActiveSelection=n.util.createClass(n.Group,{type:"activeSelection",initialize:function(l,u){u=u||{},this._objects=l||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),n.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var u=n.Object.prototype.toObject.call(this),r=new n.Group([]);if(delete u.type,r.set(u),l.forEach(function(a){a.canvas.remove(a),a.group=r}),r._objects=l,!this.canvas)return r;var c=this.canvas;return c.add(r),c._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,u,r){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,u),r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var c=0,a=this._objects.length;c<a;c++)this._objects[c]._renderControls(l,r);l.restore()}}),n.ActiveSelection.fromObject=function(l,u){n.util.enlivenObjects(l.objects,function(r){delete l.objects,u&&u(new n.ActiveSelection(r,l,!0))})})}(i),function(o){var n=t.util.object.extend;if(o.fabric||(o.fabric={}),o.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,u){u||(u={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",u),this._initElement(l,u)},getElement:function(){return this._element||{}},setElement:function(l,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var u=t.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var u=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-u,-r),l.lineTo(u,-r),l.lineTo(u,r),l.lineTo(-u,r),l.lineTo(-u,-r),l.closePath()}},toObject:function(l){var u=[];this.filters.forEach(function(c){c&&u.push(c.toObject())});var r=n(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],u=[],r,c=this._element,a=-this.width/2,f=-this.height/2,p="",d="";if(!c)return[];if(this.hasCrop()){var v=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+a+'" y="'+f+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),p=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(d='" image-rendering="optimizeSpeed'),u.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',a-this.cropX,'" y="',f-this.cropY,'" width="',c.width||c.naturalWidth,'" height="',c.height||c.height,d,'"',p,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,r=["	<rect ",'x="',a,'" y="',f,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?l=l.concat(r,u):l=l.concat(u,r),l},getSrc:function(l){var u=l?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(l,u,r){return t.util.loadImage(l,function(c,a){this.setElement(c,r),this._setWidthHeight(),u&&u(this,a)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,u=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),c=r.scaleX,a=r.scaleY,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||c>u&&a>u){this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=c,this._lastScaleY=a;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var p=t.util.createCanvasElement(),d=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=f.width,_=f.height;p.width=v,p.height=_,this._element=p,this._lastScaleX=l.scaleX=c,this._lastScaleY=l.scaleY=a,t.filterBackend.applyFilters([l],f,v,_,this._element,d),this._filterScalingX=p.width/this._originalElement.width,this._filterScalingY=p.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(f){return f&&!f.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,r=u.naturalWidth||u.width,c=u.naturalHeight||u.height;if(this._element===this._originalElement){var a=t.util.createCanvasElement();a.width=r,a.height=c,this._element=a,this._filteredEl=a}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,c),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,r,c,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var u=this._element;if(u){var r=this._filterScalingX,c=this._filterScalingY,a=this.width,f=this.height,p=Math.min,d=Math.max,v=d(this.cropX,0),_=d(this.cropY,0),b=u.naturalWidth||u.width,y=u.naturalHeight||u.height,x=v*r,C=_*c,S=p(a*r,b-x),O=p(f*c,y-C),E=-a/2,R=-f/2,W=p(a,b/r-v),X=p(f,y/c-_);u&&l.drawImage(u,x,C,S,O,E,R,W,X)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,u){this.setElement(t.util.getById(l),u),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,u){l&&l.length?t.util.enlivenObjects(l,function(r){u&&u(r)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(l){l||(l={});var u=this.getElement();this.width=l.width||u.naturalWidth||u.width||0,this.height=l.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),u=this._element.width,r=this._element.height,c=1,a=1,f=0,p=0,d=0,v=0,_,b=this.width,y=this.height,x={width:b,height:y};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(c=a=t.util.findScaleToFit(this._element,x),_=(b-u*c)/2,l.alignX==="Min"&&(f=-_),l.alignX==="Max"&&(f=_),_=(y-r*a)/2,l.alignY==="Min"&&(p=-_),l.alignY==="Max"&&(p=_)),l.meetOrSlice==="slice"&&(c=a=t.util.findScaleToCover(this._element,x),_=u-b/c,l.alignX==="Mid"&&(d=_/2),l.alignX==="Max"&&(d=_),_=r-y/a,l.alignY==="Mid"&&(v=_/2),l.alignY==="Max"&&(v=_),u=b/c,r=y/a)):(c=b/u,a=y/r),{width:u,height:r,scaleX:c,scaleY:a,offsetLeft:f,offsetTop:p,cropX:d,cropY:v}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,u){var r=t.util.object.clone(l);t.util.loadImage(r.src,function(c,a){if(a){u&&u(null,!0);return}t.Image.prototype._initFilters.call(r,r.filters,function(f){r.filters=f||[],t.Image.prototype._initFilters.call(r,[r.resizeFilter],function(p){r.resizeFilter=p[0],t.util.enlivenObjectEnlivables(r,r,function(){var d=new t.Image(c,r);u(d,!1)})})})},null,r.crossOrigin)},t.Image.fromURL=function(l,u,r){t.util.loadImage(l,function(c,a){u&&u(new t.Image(c,r),a)},null,r&&r.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,u,r){var c=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(c["xlink:href"],u,n(r?t.util.object.clone(r):{},c))}}(i),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var o=this.angle%360;return o>0?Math.round((o-1)/90)*90:Math.round(o/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(o){o=o||{};var n=function(){},l=o.onComplete||n,u=o.onChange||n,r=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){r.rotate(c),u()},onComplete:function(){r.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(o){return o.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(o){return o.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function o(l,u){var r="precision "+u+` float;
void main(){}`,c=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(c,r),l.compileShader(c),!!l.getShaderParameter(c,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),r=u.getContext("webgl")||u.getContext("experimental-webgl"),c=!1;if(r){t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),c=t.maxTextureSize>=l;for(var a=["highp","mediump","lowp"],f=0;f<3;f++)if(o(r,a[f])){t.webGlPrecision=a[f];break}}return this.isSupported=c,c},t.WebglFilterBackend=n;function n(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}n.prototype={tileSize:2048,resources:{},setupGLContext:function(l,u){this.dispose(),this.createWebGLCanvas(l,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,u)},chooseFastestCopyGLTo2DMethod:function(l,u){var r=typeof window.performance<"u",c;try{new ImageData(1,1),c=!0}catch{c=!1}var a=typeof ArrayBuffer<"u",f=typeof Uint8ClampedArray<"u";if(r&&c&&a&&f){var p=t.util.createCanvasElement(),d=new ArrayBuffer(l*u*4);if(t.forceGLPutImageData){this.imageBuffer=d,this.copyGLTo2D=m;return}var v={imageBuffer:d,destinationWidth:l,destinationHeight:u,targetCanvas:p},_,b,y;p.width=l,p.height=u,_=window.performance.now(),g.call(v,this.gl,v),b=window.performance.now()-_,_=window.performance.now(),m.call(v,this.gl,v),y=window.performance.now()-_,b>y?(this.imageBuffer=d,this.copyGLTo2D=m):this.copyGLTo2D=g}},createWebGLCanvas:function(l,u){var r=t.util.createCanvasElement();r.width=l,r.height=u;var c={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},a=r.getContext("webgl",c);a||(a=r.getContext("experimental-webgl",c)),a&&(a.clearColor(0,0,0,0),this.canvas=r,this.gl=a)},applyFilters:function(l,u,r,c,a,f){var p=this.gl,d;f&&(d=this.getCachedTexture(f,u));var v={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:r,sourceHeight:c,destinationWidth:r,destinationHeight:c,context:p,sourceTexture:this.createTexture(p,r,c,!d&&u),targetTexture:this.createTexture(p,r,c),originalTexture:d||this.createTexture(p,r,c,!d&&u),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:a},_=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,_),l.forEach(function(b){b&&b.applyTo(v)}),h(v),this.copyGLTo2D(p,v),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(v.sourceTexture),p.deleteTexture(v.targetTexture),p.deleteFramebuffer(_),a.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,u,r,c,a){var f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,a||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,a||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),c?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,c):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,u,r,0,l.RGBA,l.UNSIGNED_BYTE,null),f},getCachedTexture:function(l,u){if(this.textureCache[l])return this.textureCache[l];var r=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[l]=r,r},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:g,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,u={renderer:"",vendor:""};if(!l)return u;var r=l.getExtension("WEBGL_debug_renderer_info");if(r){var c=l.getParameter(r.UNMASKED_RENDERER_WEBGL),a=l.getParameter(r.UNMASKED_VENDOR_WEBGL);c&&(u.renderer=c.toLowerCase()),a&&(u.vendor=a.toLowerCase())}return this.gpuInfo=u,u}}}();function h(o){var n=o.targetCanvas,l=n.width,u=n.height,r=o.destinationWidth,c=o.destinationHeight;(l!==r||u!==c)&&(n.width=r,n.height=c)}function g(o,n){var l=o.canvas,u=n.targetCanvas,r=u.getContext("2d");r.translate(0,u.height),r.scale(1,-1);var c=l.height-u.height;r.drawImage(l,0,c,u.width,u.height,0,0,u.width,u.height)}function m(o,n){var l=n.targetCanvas,u=l.getContext("2d"),r=n.destinationWidth,c=n.destinationHeight,a=r*c*4,f=new Uint8Array(this.imageBuffer,0,a),p=new Uint8ClampedArray(this.imageBuffer,0,a);o.readPixels(0,0,r,c,o.RGBA,o.UNSIGNED_BYTE,f);var d=new ImageData(p,r,c);u.putImageData(d,0,0)}(function(){var o=function(){};t.Canvas2dFilterBackend=n;function n(){}n.prototype={evictCachesForKey:o,dispose:o,clearWebGLCaches:o,resources:{},applyFilters:function(l,u,r,c,a){var f=a.getContext("2d");f.drawImage(u,0,0,r,c);var p=f.getImageData(0,0,r,c),d=f.getImageData(0,0,r,c),v={sourceWidth:r,sourceHeight:c,imageData:p,originalEl:u,originalImageData:d,canvasEl:a,ctx:f,filterBackend:this};return l.forEach(function(_){_.applyTo(v)}),(v.imageData.width!==r||v.imageData.height!==c)&&(a.width=v.imageData.width,a.height=v.imageData.height),f.putImageData(v.imageData,0,0),v}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(o){o&&this.setOptions(o)},setOptions:function(o){for(var n in o)this[n]=o[n]},createProgram:function(o,n,l){n=n||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(n=n.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var u=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(u,l),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+o.getShaderInfoLog(u));var r=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(r,n),o.compileShader(r),!o.getShaderParameter(r,o.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+o.getShaderInfoLog(r));var c=o.createProgram();if(o.attachShader(c,u),o.attachShader(c,r),o.linkProgram(c),!o.getProgramParameter(c,o.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+o.getProgramInfoLog(c));var a=this.getAttributeLocations(o,c),f=this.getUniformLocations(o,c)||{};return f.uStepW=o.getUniformLocation(c,"uStepW"),f.uStepH=o.getUniformLocation(c,"uStepH"),{program:c,attributeLocations:a,uniformLocations:f}},getAttributeLocations:function(o,n){return{aPosition:o.getAttribLocation(n,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(o,n,l){var u=n.aPosition,r=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,r),o.enableVertexAttribArray(u),o.vertexAttribPointer(u,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,l,o.STATIC_DRAW)},_setupFrameBuffer:function(o){var n=o.context,l,u;o.passes>1?(l=o.destinationWidth,u=o.destinationHeight,(o.sourceWidth!==l||o.sourceHeight!==u)&&(n.deleteTexture(o.targetTexture),o.targetTexture=o.filterBackend.createTexture(n,l,u)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(o){o.passes--,o.pass++;var n=o.targetTexture;o.targetTexture=o.sourceTexture,o.sourceTexture=n},isNeutralState:function(){var o=this.mainParameter,n=t.Image.filters[this.type].prototype;if(o)if(Array.isArray(n[o])){for(var l=n[o].length;l--;)if(this[o][l]!==n[o][l])return!1;return!0}else return n[o]===this[o];else return!1},applyTo:function(o){o.webgl?(this._setupFrameBuffer(o),this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},retrieveShader:function(o){return o.programCache.hasOwnProperty(this.type)||(o.programCache[this.type]=this.createProgram(o.context)),o.programCache[this.type]},applyToWebGL:function(o){var n=o.context,l=this.retrieveShader(o);o.pass===0&&o.originalTexture?n.bindTexture(n.TEXTURE_2D,o.originalTexture):n.bindTexture(n.TEXTURE_2D,o.sourceTexture),n.useProgram(l.program),this.sendAttributeData(n,l.attributeLocations,o.aPosition),n.uniform1f(l.uniformLocations.uStepW,1/o.sourceWidth),n.uniform1f(l.uniformLocations.uStepH,1/o.sourceHeight),this.sendUniformData(n,l.uniformLocations),n.viewport(0,0,o.destinationWidth,o.destinationHeight),n.drawArrays(n.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(o,n,l){o.activeTexture(l),o.bindTexture(o.TEXTURE_2D,n),o.activeTexture(o.TEXTURE0)},unbindAdditionalTexture:function(o,n){o.activeTexture(n),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(o){this[this.mainParameter]=o},sendUniformData:function(){},createHelpLayer:function(o){if(!o.helpLayer){var n=document.createElement("canvas");n.width=o.sourceWidth,n.height=o.sourceHeight,o.helpLayer=n}},toObject:function(){var o={type:this.type},n=this.mainParameter;return n&&(o[n]=this[n]),o},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(o,n){var l=new t.Image.filters[o.type](o);return n&&n(l),l},function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.ColorMatrix=u(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var c=r.imageData,a=c.data,f=a.length,p=this.matrix,d,v,_,b,y,x=this.colorsOnly;for(y=0;y<f;y+=4)d=a[y],v=a[y+1],_=a[y+2],x?(a[y]=d*p[0]+v*p[1]+_*p[2]+p[4]*255,a[y+1]=d*p[5]+v*p[6]+_*p[7]+p[9]*255,a[y+2]=d*p[10]+v*p[11]+_*p[12]+p[14]*255):(b=a[y+3],a[y]=d*p[0]+v*p[1]+_*p[2]+b*p[3]+p[4]*255,a[y+1]=d*p[5]+v*p[6]+_*p[7]+b*p[8]+p[9]*255,a[y+2]=d*p[10]+v*p[11]+_*p[12]+b*p[13]+p[14]*255,a[y+3]=d*p[15]+v*p[16]+_*p[17]+b*p[18]+p[19]*255)},getUniformLocations:function(r,c){return{uColorMatrix:r.getUniformLocation(c,"uColorMatrix"),uConstants:r.getUniformLocation(c,"uConstants")}},sendUniformData:function(r,c){var a=this.matrix,f=[a[0],a[1],a[2],a[3],a[5],a[6],a[7],a[8],a[10],a[11],a[12],a[13],a[15],a[16],a[17],a[18]],p=[a[4],a[9],a[14],a[19]];r.uniformMatrix4fv(c.uColorMatrix,!1,f),r.uniform4fv(c.uConstants,p)}}),n.Image.filters.ColorMatrix.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Brightness=u(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var c=r.imageData,a=c.data,f,p=a.length,d=Math.round(this.brightness*255);for(f=0;f<p;f+=4)a[f]=a[f]+d,a[f+1]=a[f+1]+d,a[f+2]=a[f+2]+d}},getUniformLocations:function(r,c){return{uBrightness:r.getUniformLocation(c,"uBrightness")}},sendUniformData:function(r,c){r.uniform1f(c.uBrightness,this.brightness)}}),n.Image.filters.Brightness.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.Convolute=r(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(c){var a=Math.sqrt(this.matrix.length),f=this.type+"_"+a+"_"+(this.opaque?1:0),p=this.fragmentSource[f];return c.programCache.hasOwnProperty(f)||(c.programCache[f]=this.createProgram(c.context,p)),c.programCache[f]},applyTo2d:function(c){var a=c.imageData,f=a.data,p=this.matrix,d=Math.round(Math.sqrt(p.length)),v=Math.floor(d/2),_=a.width,b=a.height,y=c.ctx.createImageData(_,b),x=y.data,C=this.opaque?1:0,S,O,E,R,W,X,Q,$,B,K,tt,nt,w;for(tt=0;tt<b;tt++)for(K=0;K<_;K++){for(W=(tt*_+K)*4,S=0,O=0,E=0,R=0,w=0;w<d;w++)for(nt=0;nt<d;nt++)Q=tt+w-v,X=K+nt-v,!(Q<0||Q>=b||X<0||X>=_)&&($=(Q*_+X)*4,B=p[w*d+nt],S+=f[$]*B,O+=f[$+1]*B,E+=f[$+2]*B,C||(R+=f[$+3]*B));x[W]=S,x[W+1]=O,x[W+2]=E,C?x[W+3]=f[W+3]:x[W+3]=R}c.imageData=y},getUniformLocations:function(c,a){return{uMatrix:c.getUniformLocation(a,"uMatrix"),uOpaque:c.getUniformLocation(a,"uOpaque"),uHalfSize:c.getUniformLocation(a,"uHalfSize"),uSize:c.getUniformLocation(a,"uSize")}},sendUniformData:function(c,a){c.uniform1fv(a.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),n.Image.filters.Convolute.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Grayscale=u(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var c=r.imageData,a=c.data,f,p=a.length,d,v=this.mode;for(f=0;f<p;f+=4)v==="average"?d=(a[f]+a[f+1]+a[f+2])/3:v==="lightness"?d=(Math.min(a[f],a[f+1],a[f+2])+Math.max(a[f],a[f+1],a[f+2]))/2:v==="luminosity"&&(d=.21*a[f]+.72*a[f+1]+.07*a[f+2]),a[f]=d,a[f+1]=d,a[f+2]=d},retrieveShader:function(r){var c=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(c)){var a=this.fragmentSource[this.mode];r.programCache[c]=this.createProgram(r.context,a)}return r.programCache[c]},getUniformLocations:function(r,c){return{uMode:r.getUniformLocation(c,"uMode")}},sendUniformData:function(r,c){var a=1;r.uniform1i(c.uMode,a)},isNeutralState:function(){return!1}}),n.Image.filters.Grayscale.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Invert=u(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var c=r.imageData,a=c.data,f,p=a.length;for(f=0;f<p;f+=4)a[f]=255-a[f],a[f+1]=255-a[f+1],a[f+2]=255-a[f+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,c){return{uInvert:r.getUniformLocation(c,"uInvert")}},sendUniformData:function(r,c){r.uniform1i(c.uInvert,this.invert)}}),n.Image.filters.Invert.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.Noise=r(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(c){if(this.noise!==0){var a=c.imageData,f=a.data,p,d=f.length,v=this.noise,_;for(p=0,d=f.length;p<d;p+=4)_=(.5-Math.random())*v,f[p]+=_,f[p+1]+=_,f[p+2]+=_}},getUniformLocations:function(c,a){return{uNoise:c.getUniformLocation(a,"uNoise"),uSeed:c.getUniformLocation(a,"uSeed")}},sendUniformData:function(c,a){c.uniform1f(a.uNoise,this.noise/255),c.uniform1f(a.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),n.Image.filters.Noise.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Pixelate=u(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var c=r.imageData,a=c.data,f=c.height,p=c.width,d,v,_,b,y,x,C,S,O,E,R;for(v=0;v<f;v+=this.blocksize)for(_=0;_<p;_+=this.blocksize)for(d=v*4*p+_*4,b=a[d],y=a[d+1],x=a[d+2],C=a[d+3],E=Math.min(v+this.blocksize,f),R=Math.min(_+this.blocksize,p),S=v;S<E;S++)for(O=_;O<R;O++)d=S*4*p+O*4,a[d]=b,a[d+1]=y,a[d+2]=x,a[d+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,c){return{uBlocksize:r.getUniformLocation(c,"uBlocksize"),uStepW:r.getUniformLocation(c,"uStepW"),uStepH:r.getUniformLocation(c,"uStepH")}},sendUniformData:function(r,c){r.uniform1f(c.uBlocksize,this.blocksize)}}),n.Image.filters.Pixelate.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.RemoveColor=r(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(c){var a=c.imageData,f=a.data,p,d=this.distance*255,v,_,b,y=new n.Color(this.color).getSource(),x=[y[0]-d,y[1]-d,y[2]-d],C=[y[0]+d,y[1]+d,y[2]+d];for(p=0;p<f.length;p+=4)v=f[p],_=f[p+1],b=f[p+2],v>x[0]&&_>x[1]&&b>x[2]&&v<C[0]&&_<C[1]&&b<C[2]&&(f[p+3]=0)},getUniformLocations:function(c,a){return{uLow:c.getUniformLocation(a,"uLow"),uHigh:c.getUniformLocation(a,"uHigh")}},sendUniformData:function(c,a){var f=new n.Color(this.color).getSource(),p=parseFloat(this.distance),d=[0+f[0]/255-p,0+f[1]/255-p,0+f[2]/255-p,1],v=[f[0]/255+p,f[1]/255+p,f[2]/255+p,1];c.uniform4fv(a.uLow,d),c.uniform4fv(a.uHigh,v)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),n.Image.filters.RemoveColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var c in r)l[c]=u(l.ColorMatrix,{type:c,matrix:r[c],mainParameter:!1,colorsOnly:!0}),n.Image.filters[c].fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric,l=n.Image.filters,u=n.util.createClass;l.BlendColor=u(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var c=this.type+"_"+this.mode,a;return r.programCache.hasOwnProperty(c)||(a=this.buildSource(this.mode),r.programCache[c]=this.createProgram(r.context,a)),r.programCache[c]},applyTo2d:function(r){var c=r.imageData,a=c.data,f=a.length,p,d,v,_,b,y,x,C=1-this.alpha;x=new n.Color(this.color).getSource(),p=x[0]*this.alpha,d=x[1]*this.alpha,v=x[2]*this.alpha;for(var S=0;S<f;S+=4)switch(_=a[S],b=a[S+1],y=a[S+2],this.mode){case"multiply":a[S]=_*p/255,a[S+1]=b*d/255,a[S+2]=y*v/255;break;case"screen":a[S]=255-(255-_)*(255-p)/255,a[S+1]=255-(255-b)*(255-d)/255,a[S+2]=255-(255-y)*(255-v)/255;break;case"add":a[S]=_+p,a[S+1]=b+d,a[S+2]=y+v;break;case"diff":case"difference":a[S]=Math.abs(_-p),a[S+1]=Math.abs(b-d),a[S+2]=Math.abs(y-v);break;case"subtract":a[S]=_-p,a[S+1]=b-d,a[S+2]=y-v;break;case"darken":a[S]=Math.min(_,p),a[S+1]=Math.min(b,d),a[S+2]=Math.min(y,v);break;case"lighten":a[S]=Math.max(_,p),a[S+1]=Math.max(b,d),a[S+2]=Math.max(y,v);break;case"overlay":a[S]=p<128?2*_*p/255:255-2*(255-_)*(255-p)/255,a[S+1]=d<128?2*b*d/255:255-2*(255-b)*(255-d)/255,a[S+2]=v<128?2*y*v/255:255-2*(255-y)*(255-v)/255;break;case"exclusion":a[S]=p+_-2*p*_/255,a[S+1]=d+b-2*d*b/255,a[S+2]=v+y-2*v*y/255;break;case"tint":a[S]=p+_*C,a[S+1]=d+b*C,a[S+2]=v+y*C}},getUniformLocations:function(r,c){return{uColor:r.getUniformLocation(c,"uColor")}},sendUniformData:function(r,c){var a=new n.Color(this.color).getSource();a[0]=this.alpha*a[0]/255,a[1]=this.alpha*a[1]/255,a[2]=this.alpha*a[2]/255,a[3]=this.alpha,r.uniform4fv(c.uColor,a)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric,l=n.Image.filters,u=n.util.createClass;l.BlendImage=u(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var c=this.type+"_"+this.mode,a=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(c)||(r.programCache[c]=this.createProgram(r.context,a)),r.programCache[c]},applyToWebGL:function(r){var c=r.context,a=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(c,a,c.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(c,c.TEXTURE1)},createTexture:function(r,c){return r.getCachedTexture(c.cacheKey,c._element)},calculateMatrix:function(){var r=this.image,c=r._element.width,a=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/c,-r.top/a,1]},applyTo2d:function(r){var c=r.imageData,a=r.filterBackend.resources,f=c.data,p=f.length,d=c.width,v=c.height,_,b,y,x,C,S,O,E,R,W,X=this.image,Q;a.blendImage||(a.blendImage=n.util.createCanvasElement()),R=a.blendImage,W=R.getContext("2d"),R.width!==d||R.height!==v?(R.width=d,R.height=v):W.clearRect(0,0,d,v),W.setTransform(X.scaleX,0,0,X.scaleY,X.left,X.top),W.drawImage(X._element,0,0,d,v),Q=W.getImageData(0,0,d,v).data;for(var $=0;$<p;$+=4)switch(C=f[$],S=f[$+1],O=f[$+2],E=f[$+3],_=Q[$],b=Q[$+1],y=Q[$+2],x=Q[$+3],this.mode){case"multiply":f[$]=C*_/255,f[$+1]=S*b/255,f[$+2]=O*y/255,f[$+3]=E*x/255;break;case"mask":f[$+3]=x;break}},getUniformLocations:function(r,c){return{uTransformMatrix:r.getUniformLocation(c,"uTransformMatrix"),uImage:r.getUniformLocation(c,"uImage")}},sendUniformData:function(r,c){var a=this.calculateMatrix();r.uniform1i(c.uImage,1),r.uniformMatrix3fv(c.uTransformMatrix,!1,a)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendImage.fromObject=function(r,c){n.Image.fromObject(r.image,function(a){var f=n.util.object.clone(r);f.image=a,c(new n.Image.filters.BlendImage(f))})}}(i),function(o){var n=o.fabric||(o.fabric={}),l=Math.pow,u=Math.floor,r=Math.sqrt,c=Math.abs,a=Math.round,f=Math.sin,p=Math.ceil,d=n.Image.filters,v=n.util.createClass;d.Resize=v(d.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,b){return{uDelta:_.getUniformLocation(b,"uDelta"),uTaps:_.getUniformLocation(b,"uTaps")}},sendUniformData:function(_,b){_.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(b.uTaps,this.taps)},retrieveShader:function(_){var b=this.getFilterWindow(),y=this.type+"_"+b;if(!_.programCache.hasOwnProperty(y)){var x=this.generateShader(b);_.programCache[y]=this.createProgram(_.context,x)}return _.programCache[y]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,y=this.getFilterWindow(),x=new Array(y),C=1;C<=y;C++)x[C-1]=_(C*b);return x},generateShader:function(x){for(var b=new Array(x),y=this.fragmentSourceTOP,x,C=1;C<=x;C++)b[C-1]=C+".0 * uDelta";return y+="uniform float uTaps["+x+`];
`,y+=`void main() {
`,y+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,y+=`  float sum = 1.0;
`,b.forEach(function(S,O){y+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+O+`];
`,y+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+O+`];
`,y+="  sum += 2.0 * uTaps["+O+`];
`}),y+=`  gl_FragColor = color / sum;
`,y+="}",y},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(b){if(b>=_||b<=-_)return 0;if(b<11920929e-14&&b>-11920929e-14)return 1;b*=Math.PI;var y=b/_;return f(b)/b*f(y)/y}},applyTo2d:function(_){var b=_.imageData,y=this.scaleX,x=this.scaleY;this.rcpScaleX=1/y,this.rcpScaleY=1/x;var C=b.width,S=b.height,O=a(C*y),E=a(S*x),R;this.resizeType==="sliceHack"?R=this.sliceByTwo(_,C,S,O,E):this.resizeType==="hermite"?R=this.hermiteFastResize(_,C,S,O,E):this.resizeType==="bilinear"?R=this.bilinearFiltering(_,C,S,O,E):this.resizeType==="lanczos"&&(R=this.lanczosResize(_,C,S,O,E)),_.imageData=R},sliceByTwo:function(_,b,y,x,C){var S=_.imageData,O=.5,E=!1,R=!1,W=b*O,X=y*O,Q=n.filterBackend.resources,$,B,K=0,tt=0,nt=b,w=0;for(Q.sliceByTwo||(Q.sliceByTwo=document.createElement("canvas")),$=Q.sliceByTwo,($.width<b*1.5||$.height<y)&&($.width=b*1.5,$.height=y),B=$.getContext("2d"),B.clearRect(0,0,b*1.5,y),B.putImageData(S,0,0),x=u(x),C=u(C);!E||!R;)b=W,y=X,x<u(W*O)?W=u(W*O):(W=x,E=!0),C<u(X*O)?X=u(X*O):(X=C,R=!0),B.drawImage($,K,tt,b,y,nt,w,W,X),K=nt,tt=w,w+=X;return B.getImageData(K,tt,x,C)},lanczosResize:function(_,b,y,x,C){function S(D){var P,I,k,T,A,L,N,j,G,J,et;for(w.x=(D+.5)*X,M.x=u(w.x),P=0;P<C;P++){for(w.y=(P+.5)*Q,M.y=u(w.y),A=0,L=0,N=0,j=0,G=0,I=M.x-K;I<=M.x+K;I++)if(!(I<0||I>=b)){J=u(1e3*c(I-w.x)),nt[J]||(nt[J]={});for(var z=M.y-tt;z<=M.y+tt;z++)z<0||z>=y||(et=u(1e3*c(z-w.y)),nt[J][et]||(nt[J][et]=W(r(l(J*$,2)+l(et*B,2))/1e3)),k=nt[J][et],k>0&&(T=(z*b+I)*4,A+=k,L+=k*O[T],N+=k*O[T+1],j+=k*O[T+2],G+=k*O[T+3]))}T=(P*x+D)*4,R[T]=L/A,R[T+1]=N/A,R[T+2]=j/A,R[T+3]=G/A}return++D<x?S(D):E}var O=_.imageData.data,E=_.ctx.createImageData(x,C),R=E.data,W=this.lanczosCreate(this.lanczosLobes),X=this.rcpScaleX,Q=this.rcpScaleY,$=2/this.rcpScaleX,B=2/this.rcpScaleY,K=p(X*this.lanczosLobes/2),tt=p(Q*this.lanczosLobes/2),nt={},w={},M={};return S(0)},bilinearFiltering:function(_,b,y,x,C){var S,O,E,R,W,X,Q,$,B,K,tt,nt,w=0,M,D=this.rcpScaleX,P=this.rcpScaleY,I=4*(b-1),k=_.imageData,T=k.data,A=_.ctx.createImageData(x,C),L=A.data;for(Q=0;Q<C;Q++)for($=0;$<x;$++)for(W=u(D*$),X=u(P*Q),B=D*$-W,K=P*Q-X,M=4*(X*b+W),tt=0;tt<4;tt++)S=T[M+tt],O=T[M+4+tt],E=T[M+I+tt],R=T[M+I+4+tt],nt=S*(1-B)*(1-K)+O*B*(1-K)+E*K*(1-B)+R*B*K,L[w++]=nt;return A},hermiteFastResize:function(_,b,y,x,C){for(var S=this.rcpScaleX,O=this.rcpScaleY,E=p(S/2),R=p(O/2),W=_.imageData,X=W.data,Q=_.ctx.createImageData(x,C),$=Q.data,B=0;B<C;B++)for(var K=0;K<x;K++){for(var tt=(K+B*x)*4,nt=0,w=0,M=0,D=0,P=0,I=0,k=0,T=(B+.5)*O,A=u(B*O);A<(B+1)*O;A++)for(var L=c(T-(A+.5))/R,N=(K+.5)*S,j=L*L,G=u(K*S);G<(K+1)*S;G++){var J=c(N-(G+.5))/E,et=r(j+J*J);et>1&&et<-1||(nt=2*et*et*et-3*et*et+1,nt>0&&(J=4*(G+A*b),k+=nt*X[J+3],M+=nt,X[J+3]<255&&(nt=nt*X[J+3]/250),D+=nt*X[J],P+=nt*X[J+1],I+=nt*X[J+2],w+=nt))}$[tt]=D/w,$[tt+1]=P/w,$[tt+2]=I/w,$[tt+3]=k/M}return Q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),n.Image.filters.Resize.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Contrast=u(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var c=r.imageData,a,p,f=c.data,p=f.length,d=Math.floor(this.contrast*255),v=259*(d+255)/(255*(259-d));for(a=0;a<p;a+=4)f[a]=v*(f[a]-128)+128,f[a+1]=v*(f[a+1]-128)+128,f[a+2]=v*(f[a+2]-128)+128}},getUniformLocations:function(r,c){return{uContrast:r.getUniformLocation(c,"uContrast")}},sendUniformData:function(r,c){r.uniform1f(c.uContrast,this.contrast)}}),n.Image.filters.Contrast.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Saturation=u(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var c=r.imageData,a=c.data,f=a.length,p=-this.saturation,d,v;for(d=0;d<f;d+=4)v=Math.max(a[d],a[d+1],a[d+2]),a[d]+=v!==a[d]?(v-a[d])*p:0,a[d+1]+=v!==a[d+1]?(v-a[d+1])*p:0,a[d+2]+=v!==a[d+2]?(v-a[d+2])*p:0}},getUniformLocations:function(r,c){return{uSaturation:r.getUniformLocation(c,"uSaturation")}},sendUniformData:function(r,c){r.uniform1f(c.uSaturation,-this.saturation)}}),n.Image.filters.Saturation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Vibrance=u(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var c=r.imageData,a=c.data,f=a.length,p=-this.vibrance,d,v,_,b;for(d=0;d<f;d+=4)v=Math.max(a[d],a[d+1],a[d+2]),_=(a[d]+a[d+1]+a[d+2])/3,b=Math.abs(v-_)*2/255*p,a[d]+=v!==a[d]?(v-a[d])*b:0,a[d+1]+=v!==a[d+1]?(v-a[d+1])*b:0,a[d+2]+=v!==a[d+2]?(v-a[d+2])*b:0}},getUniformLocations:function(r,c){return{uVibrance:r.getUniformLocation(c,"uVibrance")}},sendUniformData:function(r,c){r.uniform1f(c.uVibrance,-this.vibrance)}}),n.Image.filters.Vibrance.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Blur=u(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var c=r.filterBackend.resources,a,f,p=r.imageData.width,d=r.imageData.height;c.blurLayer1||(c.blurLayer1=n.util.createCanvasElement(),c.blurLayer2=n.util.createCanvasElement()),a=c.blurLayer1,f=c.blurLayer2,(a.width!==p||a.height!==d)&&(f.width=a.width=p,f.height=a.height=d);var v=a.getContext("2d"),_=f.getContext("2d"),b=15,y,x,C,S,O=this.blur*.06*.5;for(v.putImageData(r.imageData,0,0),_.clearRect(0,0,p,d),S=-b;S<=b;S++)y=(Math.random()-.5)/4,x=S/b,C=O*x*p+y,_.globalAlpha=1-Math.abs(x),_.drawImage(a,C,y),v.drawImage(f,0,0),_.globalAlpha=1,_.clearRect(0,0,f.width,f.height);for(S=-b;S<=b;S++)y=(Math.random()-.5)/4,x=S/b,C=O*x*d+y,_.globalAlpha=1-Math.abs(x),_.drawImage(a,y,C),v.drawImage(f,0,0),_.globalAlpha=1,_.clearRect(0,0,f.width,f.height);r.ctx.drawImage(a,0,0);var E=r.ctx.getImageData(0,0,a.width,a.height);return v.globalAlpha=1,v.clearRect(0,0,a.width,a.height),E},getUniformLocations:function(r,c){return{delta:r.getUniformLocation(c,"uDelta")}},sendUniformData:function(r,c){var a=this.chooseRightDelta();r.uniform2fv(c.delta,a)},chooseRightDelta:function(){var r=1,c=[0,0],a;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),a=r*this.blur*.12,this.horizontal?c[0]=a:c[1]=a,c}}),l.Blur.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Gamma=u(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var c=r.imageData,a=c.data,f=this.gamma,p=a.length,d=1/f[0],v=1/f[1],_=1/f[2],b;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),b=0,p=256;b<p;b++)this.rVals[b]=Math.pow(b/255,d)*255,this.gVals[b]=Math.pow(b/255,v)*255,this.bVals[b]=Math.pow(b/255,_)*255;for(b=0,p=a.length;b<p;b+=4)a[b]=this.rVals[a[b]],a[b+1]=this.gVals[a[b+1]],a[b+2]=this.bVals[a[b+2]]},getUniformLocations:function(r,c){return{uGamma:r.getUniformLocation(c,"uGamma")}},sendUniformData:function(r,c){r.uniform3fv(c.uGamma,this.gamma)}}),n.Image.filters.Gamma.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Composed=u(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(c){c.applyTo(r)})},toObject:function(){return n.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),n.Image.filters.Composed.fromObject=function(r,c){var a=r.subFilters||[],f=a.map(function(d){return new n.Image.filters[d.type](d)}),p=new n.Image.filters.Composed({subFilters:f});return c&&c(p),p}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.HueRotation=u(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,c=n.util.cos(r),a=n.util.sin(r),f=1/3,p=Math.sqrt(f)*a,d=1-c;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=c+d/3,this.matrix[1]=f*d-p,this.matrix[2]=f*d+p,this.matrix[5]=f*d+p,this.matrix[6]=c+f*d,this.matrix[7]=f*d-p,this.matrix[10]=f*d-p,this.matrix[11]=f*d+p,this.matrix[12]=c+f*d},isNeutralState:function(r){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,r)}}),n.Image.filters.HueRotation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.clone;if(n.Text){n.warn("fabric.Text is already defined");return}var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");n.Text=n.util.createClass(n.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:n.Object.prototype.stateProperties.concat(u),cacheProperties:n.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,c){this.styles=c?c.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",c),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=n.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return n._measuringContext||(n._measuringContext=this.canvas&&this.canvas.contextCache||n.util.createCanvasElement().getContext("2d")),n._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,c,a,f,p,d,v,_=0,b=this._textLines.length;_<b;_++)if(!(this.textAlign!=="justify"&&(_===b-1||this.isEndOfWrapping(_)))&&(f=0,p=this._textLines[_],c=this.getLineWidth(_),c<this.width&&(v=this.textLines[_].match(this._reSpacesAndTabs)))){a=v.length,r=(this.width-c)/a;for(var y=0,x=p.length;y<=x;y++)d=this.__charBounds[_][y],this._reSpaceAndTab.test(p[y])?(d.width+=r,d.kernedWidth+=r,d.left+=f,f+=r):d.left+=f}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),c=this.fontSize;return r.width+=c*r.zoomX,r.height+=c*r.zoomY,r},_render:function(r){var c=this.path;c&&!c.isNotVisible()&&c._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,c,a){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(c,a)},calcTextWidth:function(){for(var r=this.getLineWidth(0),c=1,a=this._textLines.length;c<a;c++){var f=this.getLineWidth(c);f>r&&(r=f)}return r},_renderTextLine:function(r,c,a,f,p,d){this._renderChars(r,c,a,f,p,d)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var c,a,f=r.fillStyle,p,d,v=this._getLeftOffset(),_=this._getTopOffset(),b=0,y=0,x,C,S=this.path,O,E=0,R=this._textLines.length;E<R;E++){if(c=this.getHeightOfLine(E),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",E)){_+=c;continue}p=this._textLines[E],a=this._getLineLeftOffset(E),y=0,b=0,d=this.getValueOfPropertyAt(E,0,"textBackgroundColor");for(var W=0,X=p.length;W<X;W++)x=this.__charBounds[E][W],C=this.getValueOfPropertyAt(E,W,"textBackgroundColor"),S?(r.save(),r.translate(x.renderLeft,x.renderTop),r.rotate(x.angle),r.fillStyle=C,C&&r.fillRect(-x.width/2,-c/this.lineHeight*(1-this._fontSizeFraction),x.width,c/this.lineHeight),r.restore()):C!==d?(O=v+a+b,this.direction==="rtl"&&(O=this.width-O-y),r.fillStyle=d,d&&r.fillRect(O,_,y,c/this.lineHeight),b=x.left,y=x.width,d=C):y+=x.kernedWidth;C&&!S&&(O=v+a+b,this.direction==="rtl"&&(O=this.width-O-y),r.fillStyle=C,r.fillRect(O,_,y,c/this.lineHeight)),_+=c}r.fillStyle=f,this._removeShadow(r)}},getFontCache:function(r){var c=r.fontFamily.toLowerCase();n.charWidthsCache[c]||(n.charWidthsCache[c]={});var a=n.charWidthsCache[c],f=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return a[f]||(a[f]={}),a[f]},_measureChar:function(r,c,a,f){var p=this.getFontCache(c),d=this._getFontDeclaration(c),v=this._getFontDeclaration(f),_=a+r,b=d===v,y,x,C,S=c.fontSize/this.CACHE_FONT_SIZE,O;if(a&&p[a]!==void 0&&(C=p[a]),p[r]!==void 0&&(O=y=p[r]),b&&p[_]!==void 0&&(x=p[_],O=x-C),y===void 0||C===void 0||x===void 0){var E=this.getMeasuringContext();this._setTextStyles(E,c,!0)}return y===void 0&&(O=y=E.measureText(r).width,p[r]=y),C===void 0&&b&&a&&(C=E.measureText(a).width,p[a]=C),b&&x===void 0&&(x=E.measureText(_).width,p[_]=x,O=x-C),{width:y*S,kernedWidth:O*S}},getHeightOfChar:function(r,c){return this.getValueOfPropertyAt(r,c,"fontSize")},measureLine:function(r){var c=this._measureLine(r);return this.charSpacing!==0&&(c.width-=this._getWidthOfCharSpacing()),c.width<0&&(c.width=0),c},_measureLine:function(r){var c=0,a,f,p=this._textLines[r],d,v,_=0,b=new Array(p.length),y=0,x,C,S=this.path,O=this.pathSide==="right";for(this.__charBounds[r]=b,a=0;a<p.length;a++)f=p[a],v=this._getGraphemeBox(f,r,a,d),b[a]=v,c+=v.kernedWidth,d=f;if(b[a]={left:v?v.left+v.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(C=S.segmentsInfo[S.segmentsInfo.length-1].length,x=n.util.getPointOnPath(S.path,0,S.segmentsInfo),x.x+=S.pathOffset.x,x.y+=S.pathOffset.y,this.textAlign){case"left":y=O?C-c:0;break;case"center":y=(C-c)/2;break;case"right":y=O?0:C-c;break}for(y+=this.pathStartOffset*(O?-1:1),a=O?p.length-1:0;O?a>=0:a<p.length;O?a--:a++)v=b[a],y>C?y%=C:y<0&&(y+=C),this._setGraphemeOnPath(y,v,x),y+=v.kernedWidth}return{width:c,numOfSpaces:_}},_setGraphemeOnPath:function(r,c,a){var f=r+c.kernedWidth/2,p=this.path,d=n.util.getPointOnPath(p.path,f,p.segmentsInfo);c.renderLeft=d.x-a.x,c.renderTop=d.y-a.y,c.angle=d.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,c,a,f,p){var d=this.getCompleteStyleDeclaration(c,a),v=f?this.getCompleteStyleDeclaration(c,a-1):{},_=this._measureChar(r,d,f,v),b=_.kernedWidth,y=_.width,x;this.charSpacing!==0&&(x=this._getWidthOfCharSpacing(),y+=x,b+=x);var C={width:y,left:0,height:d.fontSize,kernedWidth:b,deltaY:d.deltaY};if(a>0&&!p){var S=this.__charBounds[c][a-1];C.left=S.left+S.width+_.kernedWidth-_.width}return C},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var c=this._textLines[r],a=this.getHeightOfChar(r,0),f=1,p=c.length;f<p;f++)a=Math.max(this.getHeightOfChar(r,f),a);return this.__lineHeights[r]=a*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,c=0,a=0,f=this._textLines.length;a<f;a++)r=this.getHeightOfLine(a),c+=a===f-1?r/this.lineHeight:r;return c},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,c){r.save();for(var a=0,f=this._getLeftOffset(),p=this._getTopOffset(),d=0,v=this._textLines.length;d<v;d++){var _=this.getHeightOfLine(d),b=_/this.lineHeight,y=this._getLineLeftOffset(d);this._renderTextLine(c,r,this._textLines[d],f+y,p+a+b,d),a+=_}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,c,a,f,p,d){var v=this.getHeightOfLine(d),_=this.textAlign.indexOf("justify")!==-1,b,y,x="",C,S=0,O,E=this.path,R=!_&&this.charSpacing===0&&this.isEmptyStyles(d)&&!E,W=this.direction==="ltr",X=this.direction==="ltr"?1:-1,Q,$=c.canvas.getAttribute("dir");if(c.save(),$!==this.direction&&(c.canvas.setAttribute("dir",W?"ltr":"rtl"),c.direction=W?"ltr":"rtl",c.textAlign=W?"left":"right"),p-=v*this._fontSizeFraction/this.lineHeight,R){this._renderChar(r,c,d,0,a.join(""),f,p,v),c.restore();return}for(var B=0,K=a.length-1;B<=K;B++)O=B===K||this.charSpacing||E,x+=a[B],C=this.__charBounds[d][B],S===0?(f+=X*(C.kernedWidth-C.width),S+=C.width):S+=C.kernedWidth,_&&!O&&this._reSpaceAndTab.test(a[B])&&(O=!0),O||(b=b||this.getCompleteStyleDeclaration(d,B),y=this.getCompleteStyleDeclaration(d,B+1),O=n.util.hasStyleChanged(b,y,!1)),O&&(E?(c.save(),c.translate(C.renderLeft,C.renderTop),c.rotate(C.angle),this._renderChar(r,c,d,B,x,-S/2,0,v),c.restore()):(Q=f,this._renderChar(r,c,d,B,x,Q,p,v)),x="",b=y,f+=X*S,S=0);c.restore()},_applyPatternGradientTransformText:function(r){var c=n.util.createCanvasElement(),a,f=this.width+this.strokeWidth,p=this.height+this.strokeWidth;return c.width=f,c.height=p,a=c.getContext("2d"),a.beginPath(),a.moveTo(0,0),a.lineTo(f,0),a.lineTo(f,p),a.lineTo(0,p),a.closePath(),a.translate(f/2,p/2),a.fillStyle=r.toLive(a),this._applyPatternGradientTransform(a,r),a.fill(),a.createPattern(c,"no-repeat")},handleFiller:function(r,c,a){var f,p;return a.toLive?a.gradientUnits==="percentage"||a.gradientTransform||a.patternTransform?(f=-this.width/2,p=-this.height/2,r.translate(f,p),r[c]=this._applyPatternGradientTransformText(a),{offsetX:f,offsetY:p}):(r[c]=a.toLive(r,this),this._applyPatternGradientTransform(r,a)):(r[c]=a,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,c){return r.lineWidth=c.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",c.stroke)},_setFillStyles:function(r,c){return this.handleFiller(r,"fillStyle",c.fill)},_renderChar:function(r,c,a,f,p,d,v){var _=this._getStyleDeclaration(a,f),b=this.getCompleteStyleDeclaration(a,f),y=r==="fillText"&&b.fill,x=r==="strokeText"&&b.stroke&&b.strokeWidth,C,S;!x&&!y||(c.save(),y&&(C=this._setFillStyles(c,b)),x&&(S=this._setStrokeStyles(c,b)),c.font=this._getFontDeclaration(b),_&&_.textBackgroundColor&&this._removeShadow(c),_&&_.deltaY&&(v+=_.deltaY),y&&c.fillText(p,d-C.offsetX,v-C.offsetY),x&&c.strokeText(p,d-S.offsetX,v-S.offsetY),c.restore())},setSuperscript:function(r,c){return this._setScript(r,c,this.superscript)},setSubscript:function(r,c){return this._setScript(r,c,this.subscript)},_setScript:function(r,c,a){var f=this.get2DCursorLocation(r,!0),p=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"fontSize"),d=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"deltaY"),v={fontSize:p*a.size,deltaY:d+p*a.baseline};return this.setSelectionStyles(v,r,c),this},_getLineLeftOffset:function(r){var c=this.getLineWidth(r),a=this.width-c,f=this.textAlign,p=this.direction,v,d=0,v=this.isEndOfWrapping(r);return f==="justify"||f==="justify-center"&&!v||f==="justify-right"&&!v||f==="justify-left"&&!v?0:(f==="center"&&(d=a/2),f==="right"&&(d=a),f==="justify-center"&&(d=a/2),f==="justify-right"&&(d=a),p==="rtl"&&(d-=a),d)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var c=this.measureLine(r),a=c.width;return this.__lineWidths[r]=a,a},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,c,a){var f=this._getStyleDeclaration(r,c);return f&&typeof f[a]<"u"?f[a]:this[a]},_renderTextDecoration:function(r,c){if(!(!this[c]&&!this.styleHas(c))){for(var a,f,p,d,v,_,b,y,x=this._getLeftOffset(),C=this._getTopOffset(),S,O,E,R,W,X,Q,$,B=this.path,K=this._getWidthOfCharSpacing(),tt=this.offsets[c],nt=0,w=this._textLines.length;nt<w;nt++){if(a=this.getHeightOfLine(nt),!this[c]&&!this.styleHas(c,nt)){C+=a;continue}b=this._textLines[nt],X=a/this.lineHeight,d=this._getLineLeftOffset(nt),O=0,E=0,y=this.getValueOfPropertyAt(nt,0,c),$=this.getValueOfPropertyAt(nt,0,"fill"),S=C+X*(1-this._fontSizeFraction),f=this.getHeightOfChar(nt,0),v=this.getValueOfPropertyAt(nt,0,"deltaY");for(var M=0,D=b.length;M<D;M++)if(R=this.__charBounds[nt][M],W=this.getValueOfPropertyAt(nt,M,c),Q=this.getValueOfPropertyAt(nt,M,"fill"),p=this.getHeightOfChar(nt,M),_=this.getValueOfPropertyAt(nt,M,"deltaY"),B&&W&&Q)r.save(),r.fillStyle=$,r.translate(R.renderLeft,R.renderTop),r.rotate(R.angle),r.fillRect(-R.kernedWidth/2,tt*p+_,R.kernedWidth,this.fontSize/15),r.restore();else if((W!==y||Q!==$||p!==f||_!==v)&&E>0){var P=x+d+O;this.direction==="rtl"&&(P=this.width-P-E),y&&$&&(r.fillStyle=$,r.fillRect(P,S+tt*f+v,E,this.fontSize/15)),O=R.left,E=R.width,y=W,$=Q,f=p,v=_}else E+=R.kernedWidth;var P=x+d+O;this.direction==="rtl"&&(P=this.width-P-E),r.fillStyle=Q,W&&Q&&r.fillRect(P,S+tt*f+v,E-K,this.fontSize/15),C+=a}this._removeShadow(r)}},_getFontDeclaration:function(r,c){var a=r||this,f=this.fontFamily,p=n.Text.genericFonts.indexOf(f.toLowerCase())>-1,d=f===void 0||f.indexOf("'")>-1||f.indexOf(",")>-1||f.indexOf('"')>-1||p?a.fontFamily:'"'+a.fontFamily+'"';return[n.isLikelyNode?a.fontWeight:a.fontStyle,n.isLikelyNode?a.fontStyle:a.fontWeight,c?this.CACHE_FONT_SIZE+"px":a.fontSize+"px",d].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var c=r.split(this._reNewline),a=new Array(c.length),f=[`
`],p=[],d=0;d<c.length;d++)a[d]=n.util.string.graphemeSplit(c[d]),p=p.concat(a[d],f);return p.pop(),{_unwrappedLines:a,lines:c,graphemeText:p,graphemeLines:a}},toObject:function(r){var c=u.concat(r),a=this.callSuper("toObject",c);return a.styles=n.util.stylesToArray(this.styles,this.text),a.path&&(a.path=this.path.toObject()),a},set:function(r,c){this.callSuper("set",r,c);var a=!1,f=!1;if(typeof r=="object")for(var p in r)p==="path"&&this.setPathInfo(),a=a||this._dimensionAffectingProps.indexOf(p)!==-1,f=f||p==="path";else a=this._dimensionAffectingProps.indexOf(r)!==-1,f=r==="path";return f&&this.setPathInfo(),a&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),n.Text.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),n.Text.DEFAULT_SVG_FONT_SIZE=16,n.Text.fromElement=function(r,c,a){if(!r)return c(null);var f=n.parseAttributes(r,n.Text.ATTRIBUTE_NAMES),p=f.textAnchor||"left";if(a=n.util.object.extend(a?l(a):{},f),a.top=a.top||0,a.left=a.left||0,f.textDecoration){var d=f.textDecoration;d.indexOf("underline")!==-1&&(a.underline=!0),d.indexOf("overline")!==-1&&(a.overline=!0),d.indexOf("line-through")!==-1&&(a.linethrough=!0),delete a.textDecoration}"dx"in f&&(a.left+=f.dx),"dy"in f&&(a.top+=f.dy),"fontSize"in a||(a.fontSize=n.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in r?v=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(v=r.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=a.strokeWidth;a.strokeWidth=0;var b=new n.Text(v,a),y=b.getScaledHeight()/b.height,x=(b.height+b.strokeWidth)*b.lineHeight-b.height,C=x*y,S=b.getScaledHeight()+C,O=0;p==="center"&&(O=b.getScaledWidth()/2),p==="right"&&(O=b.getScaledWidth()),b.set({left:b.left-O,top:b.top-(S-b.fontSize*(.07+b._fontSizeFraction))/b.lineHeight,strokeWidth:typeof _<"u"?_:1}),c(b)},n.Text.fromObject=function(r,c){var a=l(r),f=r.path;return delete a.path,n.Object._fromObject("Text",a,function(p){p.styles=n.util.stylesFromArray(r.styles,r.text),f?n.Object._fromObject("Path",f,function(d){p.set("path",d),c(p)},"path"):c(p)},"text")},n.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],n.util.createAccessors&&n.util.createAccessors(n.Text)}(i),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(o){if(!this.styles||typeof o<"u"&&!this.styles[o])return!0;var n=typeof o>"u"?this.styles:{line:this.styles[o]};for(var l in n)for(var u in n[l])for(var r in n[l][u])return!1;return!0},styleHas:function(o,n){if(!this.styles||!o||o===""||typeof n<"u"&&!this.styles[n])return!1;var l=typeof n>"u"?this.styles:{0:this.styles[n]};for(var u in l)for(var r in l[u])if(typeof l[u][r][o]<"u")return!0;return!1},cleanStyle:function(o){if(!this.styles||!o||o==="")return!1;var n=this.styles,l=0,u,r,c=!0,a=0,f;for(var p in n){u=0;for(var d in n[p]){var f=n[p][d],v=f.hasOwnProperty(o);l++,v?(r?f[o]!==r&&(c=!1):r=f[o],f[o]===this[o]&&delete f[o]):c=!1,Object.keys(f).length!==0?u++:delete n[p][d]}u===0&&delete n[p]}for(var _=0;_<this._textLines.length;_++)a+=this._textLines[_].length;c&&l===a&&(this[o]=r,this.removeStyle(o))},removeStyle:function(o){if(!(!this.styles||!o||o==="")){var n=this.styles,l,u,r;for(u in n){l=n[u];for(r in l)delete l[r][o],Object.keys(l[r]).length===0&&delete l[r];Object.keys(l).length===0&&delete n[u]}}},_extendStyles:function(o,n){var l=this.get2DCursorLocation(o);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),n)},get2DCursorLocation:function(o,n){typeof o>"u"&&(o=this.selectionStart);for(var l=n?this._unwrappedTextLines:this._textLines,u=l.length,r=0;r<u;r++){if(o<=l[r].length)return{lineIndex:r,charIndex:o};o-=l[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:l[r-1].length<o?l[r-1].length:o}},getSelectionStyles:function(o,n,l){typeof o>"u"&&(o=this.selectionStart||0),typeof n>"u"&&(n=this.selectionEnd||o);for(var u=[],r=o;r<n;r++)u.push(this.getStyleAtPosition(r,l));return u},getStyleAtPosition:function(o,n){var l=this.get2DCursorLocation(o),u=n?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return u||{}},setSelectionStyles:function(o,n,l){typeof n>"u"&&(n=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||n);for(var u=n;u<l;u++)this._extendStyles(u,o);return this._forceClearCache=!0,this},_getStyleDeclaration:function(o,n){var l=this.styles&&this.styles[o];return l?l[n]:null},getCompleteStyleDeclaration:function(o,n){for(var l=this._getStyleDeclaration(o,n)||{},u={},r,c=0;c<this._styleProperties.length;c++)r=this._styleProperties[c],u[r]=typeof l[r]>"u"?this[r]:l[r];return u},_setStyleDeclaration:function(o,n,l){this.styles[o][n]=l},_deleteStyleDeclaration:function(o,n){delete this.styles[o][n]},_getLineStyle:function(o){return!!this.styles[o]},_setLineStyle:function(o){this.styles[o]={}},_deleteLineStyle:function(o){delete this.styles[o]}})}(),function(){function o(n){n.textDecoration&&(n.textDecoration.indexOf("underline")>-1&&(n.underline=!0),n.textDecoration.indexOf("line-through")>-1&&(n.linethrough=!0),n.textDecoration.indexOf("overline")>-1&&(n.overline=!0),delete n.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(n,l){this.callSuper("initialize",n,l),this.initBehavior()},setSelectionStart:function(n){n=Math.max(n,0),this._updateAndFire("selectionStart",n)},setSelectionEnd:function(n){n=Math.min(n,this.text.length),this._updateAndFire("selectionEnd",n)},_updateAndFire:function(n,l){this[n]!==l&&(this._fireSelectionChanged(),this[n]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(n){this.clearContextTop(),this.callSuper("render",n),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(n){this.callSuper("_render",n)},clearContextTop:function(n){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,u=this.canvas.viewportTransform;l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(l),this._clearTextArea(l),n||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var n=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(n,l):this.renderSelection(n,l),l.restore()}},_clearTextArea:function(n){var l=this.width+4,u=this.height+4;n.clearRect(-l/2,-u/2,l,u)},_getCursorBoundaries:function(n){typeof n>"u"&&(n=this.selectionStart);var l=this._getLeftOffset(),u=this._getTopOffset(),r=this._getCursorBoundariesOffsets(n);return{left:l,top:u,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(n){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,u,r,c=0,a=0,f,p=this.get2DCursorLocation(n);r=p.charIndex,u=p.lineIndex;for(var d=0;d<u;d++)c+=this.getHeightOfLine(d);l=this._getLineLeftOffset(u);var v=this.__charBounds[u][r];return v&&(a=v.left),this.charSpacing!==0&&r===this._textLines[u].length&&(a-=this._getWidthOfCharSpacing()),f={top:c,left:l+(a>0?a:0)},this.direction==="rtl"&&(f.left*=-1),this.cursorOffsetCache=f,this.cursorOffsetCache},renderCursor:function(n,l){var u=this.get2DCursorLocation(),r=u.lineIndex,c=u.charIndex>0?u.charIndex-1:0,a=this.getValueOfPropertyAt(r,c,"fontSize"),f=this.scaleX*this.canvas.getZoom(),p=this.cursorWidth/f,d=n.topOffset,v=this.getValueOfPropertyAt(r,c,"deltaY");d+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-a*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(n,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,c,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(n.left+n.leftOffset-p/2,d+n.top+v,p,a)},renderSelection:function(n,l){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,c=this.textAlign.indexOf("justify")!==-1,a=this.get2DCursorLocation(u),f=this.get2DCursorLocation(r),p=a.lineIndex,d=f.lineIndex,v=a.charIndex<0?0:a.charIndex,_=f.charIndex<0?0:f.charIndex,b=p;b<=d;b++){var y=this._getLineLeftOffset(b)||0,x=this.getHeightOfLine(b),C=0,S=0,O=0;if(b===p&&(S=this.__charBounds[p][v].left),b>=p&&b<d)O=c&&!this.isEndOfWrapping(b)?this.width:this.getLineWidth(b)||5;else if(b===d)if(_===0)O=this.__charBounds[d][_].left;else{var E=this._getWidthOfCharSpacing();O=this.__charBounds[d][_-1].left+this.__charBounds[d][_-1].width-E}C=x,(this.lineHeight<1||b===d&&this.lineHeight>1)&&(x/=this.lineHeight);var R=n.left+y+S,W=O-S,X=x,Q=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",X=1,Q=x):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(R=this.width-R-W),l.fillRect(R,n.top+n.topOffset+Q,W,X),n.topOffset+=C}},getCurrentCharFontSize:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fontSize")},getCurrentCharColor:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fill")},_getCurrentCharIndex:function(){var n=this.get2DCursorLocation(this.selectionStart,!0),l=n.charIndex>0?n.charIndex-1:0;return{l:n.lineIndex,c:l}}}),t.IText.fromObject=function(n,l){var u=t.util.stylesFromArray(n.styles,n.text),r=Object.assign({},n,{styles:u});if(o(r),r.styles)for(var c in r.styles)for(var a in r.styles[c])o(r.styles[c][a]);t.Object._fromObject("IText",r,l,"text")}}(),function(){var o=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var n=this;this.on("added",function(){var l=n.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,n._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){var l=n.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,n),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,n._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(n){n._mouseUpITextHandler=function(){n._iTextInstances&&n._iTextInstances.forEach(function(l){l.__isMousedown=!1})},n.on("mouse:up",n._mouseUpITextHandler)},_removeCanvasHandlers:function(n){n.off("mouse:up",n._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,l,u,r){var c;return c={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",l,{duration:u,onComplete:function(){c.isAborted||n[r]()},onChange:function(){n.canvas&&n.selectionStart===n.selectionEnd&&n.renderCursorOrSelection()},abort:function(){return c.isAborted}}),c},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var l=this,u=n?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},u)},abortCursorAnimation:function(){var n=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,n&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(n){var l=0,u=n-1;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u--;for(;/\S/.test(this._text[u])&&u>-1;)l++,u--;return n-l},findWordBoundaryRight:function(n){var l=0,u=n;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u++;for(;/\S/.test(this._text[u])&&u<this._text.length;)l++,u++;return n+l},findLineBoundaryLeft:function(n){for(var l=0,u=n-1;!/\n/.test(this._text[u])&&u>-1;)l++,u--;return n-l},findLineBoundaryRight:function(n){for(var l=0,u=n;!/\n/.test(this._text[u])&&u<this._text.length;)l++,u++;return n+l},searchWordBoundary:function(n,l){for(var u=this._text,r=this._reSpace.test(u[n])?n-1:n,c=u[r],a=t.reNonWord;!a.test(c)&&r>0&&r<u.length;)r+=l,c=u[r];return a.test(c)&&(r+=l===1?0:1),r},selectWord:function(n){n=n||this.selectionStart;var l=this.searchWordBoundary(n,-1),u=this.searchWordBoundary(n,1);this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(n){n=n||this.selectionStart;var l=this.findLineBoundaryLeft(n),u=this.findLineBoundaryRight(n);return this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(n){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(n),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(n){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(n.e),u=this.selectionStart,r=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||u===r)&&(u===l||r===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==u||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(n,l,u){var r=u.slice(0,n),c=t.util.string.graphemeSplit(r).length;if(n===l)return{selectionStart:c,selectionEnd:c};var a=u.slice(n,l),f=t.util.string.graphemeSplit(a).length;return{selectionStart:c,selectionEnd:c+f}},fromGraphemeToStringSelection:function(n,l,u){var r=u.slice(0,n),c=r.join("").length;if(n===l)return{selectionStart:c,selectionEnd:c};var a=u.slice(n,l),f=a.join("").length;return{selectionStart:c,selectionEnd:c+f}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var n=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=n.selectionStart,this.hiddenTextarea.selectionEnd=n.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var n=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=n.selectionEnd,this.inCompositionMode||(this.selectionStart=n.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var n=this._calcTextareaPosition();this.hiddenTextarea.style.left=n.left,this.hiddenTextarea.style.top=n.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var n=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(n),u=this.get2DCursorLocation(n),r=u.lineIndex,c=u.charIndex,a=this.getValueOfPropertyAt(r,c,"fontSize")*this.lineHeight,f=l.leftOffset,p=this.calcTransformMatrix(),d={x:l.left+f,y:l.top+l.topOffset+a},v=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,b=_.width/v,y=_.height/v,x=b-a,C=y-a,S=_.clientWidth/b,O=_.clientHeight/y;return d=t.util.transformPoint(d,p),d=t.util.transformPoint(d,this.canvas.viewportTransform),d.x*=S,d.y*=O,d.x<0&&(d.x=0),d.x>x&&(d.x=x),d.y<0&&(d.y=0),d.y>C&&(d.y=C),d.x+=this.canvas._offset.left,d.y+=this.canvas._offset.top,{left:d.x+"px",top:d.y+"px",fontSize:a+"px",charHeight:a}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var n=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),n&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),n&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},removeStyleFromTo:function(n,l){var u=this.get2DCursorLocation(n,!0),r=this.get2DCursorLocation(l,!0),c=u.lineIndex,a=u.charIndex,f=r.lineIndex,p=r.charIndex,d,v;if(c!==f){if(this.styles[c])for(d=a;d<this._unwrappedTextLines[c].length;d++)delete this.styles[c][d];if(this.styles[f])for(d=p;d<this._unwrappedTextLines[f].length;d++)v=this.styles[f][d],v&&(this.styles[c]||(this.styles[c]={}),this.styles[c][a+d-p]=v);for(d=c+1;d<=f;d++)delete this.styles[d];this.shiftLineStyles(f,c-f)}else if(this.styles[c]){v=this.styles[c];var _=p-a,b,y;for(d=a;d<p;d++)delete v[d];for(y in this.styles[c])b=parseInt(y,10),b>=p&&(v[b-_]=v[y],delete v[y])}},shiftLineStyles:function(n,l){var u=o(this.styles);for(var r in this.styles){var c=parseInt(r,10);c>n&&(this.styles[c+l]=u[c],u[c-l]||delete this.styles[c])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(n,l,u,r){var c,a={},f=!1,p=this._unwrappedTextLines[n].length===l;u||(u=1),this.shiftLineStyles(n,u),this.styles[n]&&(c=this.styles[n][l===0?l:l-1]);for(var d in this.styles[n]){var v=parseInt(d,10);v>=l&&(f=!0,a[v-l]=this.styles[n][d],p&&l===0||delete this.styles[n][d])}var _=!1;for(f&&!p&&(this.styles[n+u]=a,_=!0),_&&u--;u>0;)r&&r[u-1]?this.styles[n+u]={0:o(r[u-1])}:c?this.styles[n+u]={0:o(c)}:delete this.styles[n+u],u--;this._forceClearCache=!0},insertCharStyleObject:function(n,l,u,r){this.styles||(this.styles={});var c=this.styles[n],a=c?o(c):{};u||(u=1);for(var f in a){var p=parseInt(f,10);p>=l&&(c[p+u]=a[p],a[p-u]||delete c[p])}if(this._forceClearCache=!0,r){for(;u--;)Object.keys(r[u]).length&&(this.styles[n]||(this.styles[n]={}),this.styles[n][l+u]=o(r[u]));return}if(c)for(var d=c[l?l-1:1];d&&u--;)this.styles[n][l+u]=o(d)},insertNewStyleBlock:function(n,l,u){for(var r=this.get2DCursorLocation(l,!0),c=[0],a=0,f=0;f<n.length;f++)n[f]===`
`?(a++,c[a]=0):c[a]++;c[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,c[0],u),u=u&&u.slice(c[0]+1)),a&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+c[0],a);for(var f=1;f<a;f++)c[f]>0?this.insertCharStyleObject(r.lineIndex+f,0,c[f],u):u&&this.styles[r.lineIndex+f]&&u[0]&&(this.styles[r.lineIndex+f][0]=u[0]),u=u&&u.slice(c[f]+1);c[f]>0&&this.insertCharStyleObject(r.lineIndex+f,0,c[f],u)},setSelectionStartEndWithShift:function(n,l,u){u<=n?(l===n?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=n),this.selectionStart=u):u>n&&u<l?this._selectionDirection==="right"?this.selectionEnd=u:this.selectionStart=u:(l===n?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=u)},setSelectionInBoundaries:function(){var n=this.text.length;this.selectionStart>n?this.selectionStart=n:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>n?this.selectionEnd=n:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(o){if(this.canvas){this.__newClickTime=+new Date;var n=o.pointer;this.isTripleClick(n)&&(this.fire("tripleclick",o),this._stopEvent(o.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=n,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(o){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===o.x&&this.__lastPointer.y===o.y},_stopEvent:function(o){o.preventDefault&&o.preventDefault(),o.stopPropagation&&o.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(o){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(o.e))},tripleClickHandler:function(o){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(o.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(o.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(o){if(this.__isMousedown=!1,!(!this.editable||this.group||o.transform&&o.transform.actionPerformed||o.e.button&&o.e.button!==1)){if(this.canvas){var n=this.canvas._activeObject;if(n&&n!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(o.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(o){var n=this.getSelectionStartFromPointer(o),l=this.selectionStart,u=this.selectionEnd;o.shiftKey?this.setSelectionStartEndWithShift(l,u,n):(this.selectionStart=n,this.selectionEnd=n),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(o){for(var n=this.getLocalPointer(o),l=0,u=0,r=0,c=0,a=0,f,p,d=0,v=this._textLines.length;d<v&&r<=n.y;d++)r+=this.getHeightOfLine(d)*this.scaleY,a=d,d>0&&(c+=this._textLines[d-1].length+this.missingNewlineOffset(d-1));f=this._getLineLeftOffset(a),u=f*this.scaleX,p=this._textLines[a],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+u);for(var _=0,b=p.length;_<b&&(l=u,u+=this.__charBounds[a][_].kernedWidth*this.scaleX,u<=n.x);_++)c++;return this._getNewSelectionStartFromOffset(n,l,u,c,b)},_getNewSelectionStartFromOffset:function(o,n,l,u,r){var c=o.x-n,a=l-o.x,f=a>c||a<0?0:1,p=u+f;return this.flipX&&(p=r-p),p>this._text.length&&(p=this._text.length),p}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var o=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+o.top+"; left: "+o.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+o.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(o){if(this.isEditing){var n=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(o.keyCode in n)this[n[o.keyCode]](o);else if(o.keyCode in this.ctrlKeysMapDown&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapDown[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),o.keyCode>=33&&o.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(o){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(o.keyCode in this.ctrlKeysMapUp&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapUp[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(o){var n=this.fromPaste;if(this.fromPaste=!1,o&&o.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,u=this._text.length,r=l.length,c,a,f=r-u,p=this.selectionStart,d=this.selectionEnd,v=p!==d,_,b,y;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var x=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=p>x.selectionStart;v?(c=this._text.slice(p,d),f+=d-p):r<u&&(C?c=this._text.slice(d+f,d):c=this._text.slice(p,p-f)),a=l.slice(x.selectionEnd-f,x.selectionEnd),c&&c.length&&(a.length&&(_=this.getSelectionStyles(p,p+1,!1),_=a.map(function(){return _[0]})),v?(b=p,y=d):C?(b=d-c.length,y=d):(b=d,y=d+c.length),this.removeStyleFromTo(b,y)),a.length&&(n&&a.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(_=t.copiedTextStyle),this.insertNewStyleBlock(a,p,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(o){this.compositionStart=o.target.selectionStart,this.compositionEnd=o.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(o){return o&&o.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(o,n){var l=this._getLineLeftOffset(o),u;return n>0&&(u=this.__charBounds[o][n-1],l+=u.left+u.width),l},getDownCursorOffset:function(o,n){var l=this._getSelectionForOffset(o,n),u=this.get2DCursorLocation(l),r=u.lineIndex;if(r===this._textLines.length-1||o.metaKey||o.keyCode===34)return this._text.length-l;var c=u.charIndex,a=this._getWidthBeforeCursor(r,c),f=this._getIndexOnLine(r+1,a),p=this._textLines[r].slice(c);return p.length+f+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(o,n){return o.shiftKey&&this.selectionStart!==this.selectionEnd&&n?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(o,n){var l=this._getSelectionForOffset(o,n),u=this.get2DCursorLocation(l),r=u.lineIndex;if(r===0||o.metaKey||o.keyCode===33)return-l;var c=u.charIndex,a=this._getWidthBeforeCursor(r,c),f=this._getIndexOnLine(r-1,a),p=this._textLines[r].slice(0,c),d=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+f-p.length+(1-d)},_getIndexOnLine:function(o,n){for(var l=this._textLines[o],u=this._getLineLeftOffset(o),r=u,c=0,a,f,p=0,d=l.length;p<d;p++)if(a=this.__charBounds[o][p].width,r+=a,r>n){f=!0;var v=r-a,_=r,b=Math.abs(v-n),y=Math.abs(_-n);c=y<b?p:p-1;break}return f||(c=l.length-1),c},moveCursorDown:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",o)},moveCursorUp:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",o)},_moveCursorUpOrDown:function(o,n){var l="get"+o+"CursorOffset",u=this[l](n,this._selectionDirection==="right");n.shiftKey?this.moveCursorWithShift(u):this.moveCursorWithoutShift(u),u!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(o){var n=this._selectionDirection==="left"?this.selectionStart+o:this.selectionEnd+o;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,n),o!==0},moveCursorWithoutShift:function(o){return o<0?(this.selectionStart+=o,this.selectionEnd=this.selectionStart):(this.selectionEnd+=o,this.selectionStart=this.selectionEnd),o!==0},moveCursorLeft:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",o)},_move:function(o,n,l){var u;if(o.altKey)u=this["findWordBoundary"+l](this[n]);else if(o.metaKey||o.keyCode===35||o.keyCode===36)u=this["findLineBoundary"+l](this[n]);else return this[n]+=l==="Left"?-1:1,!0;if(typeof u<"u"&&this[n]!==u)return this[n]=u,!0},_moveLeft:function(o,n){return this._move(o,n,"Left")},_moveRight:function(o,n){return this._move(o,n,"Right")},moveCursorLeftWithoutShift:function(o){var n=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(n=this._moveLeft(o,"selectionStart")),this.selectionEnd=this.selectionStart,n},moveCursorLeftWithShift:function(o){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(o,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(o,"selectionStart")},moveCursorRight:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",o)},_moveCursorLeftOrRight:function(o,n){var l="moveCursor"+o+"With";this._currentCursorOpacity=1,n.shiftKey?l+="Shift":l+="outShift",this[l](n)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(o){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(o,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(o,"selectionEnd")},moveCursorRightWithoutShift:function(o){var n=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(n=this._moveRight(o,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,n},removeChars:function(o,n){typeof n>"u"&&(n=o+1),this.removeStyleFromTo(o,n),this._text.splice(o,n-o),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(o,n,l,u){typeof u>"u"&&(u=l),u>l&&this.removeStyleFromTo(l,u);var r=t.util.string.graphemeSplit(o);this.insertNewStyleBlock(r,l,n),this._text=[].concat(this._text.slice(0,l),r,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var o=t.util.toFixed,n=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=!0,r=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",r?'text-decoration="'+r+'" ':"",'style="',this.getSvgStyles(u),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var r=[],c=[],a=l,f;this._setSVGBg(c);for(var p=0,d=this._textLines.length;p<d;p++)f=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(c,p,u+f,a),this._setSVGTextLineText(r,p,u+f,a),a+=this.getHeightOfLine(p);return{textSpans:r,textBgRects:c}},_createTextCharSpan:function(l,u,r,c){var a=l!==l.trim()||l.match(n),f=this.getSvgSpanStyles(u,a),p=f?'style="'+f+'"':"",d=u.deltaY,v="",_=t.Object.NUM_FRACTION_DIGITS;return d&&(v=' dy="'+o(d,_)+'" '),['<tspan x="',o(r,_),'" y="',o(c,_),'" ',v,p,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,r,c){var a=this.getHeightOfLine(u),f=this.textAlign.indexOf("justify")!==-1,p,d,v="",_,b,y=0,x=this._textLines[u],C;c+=a*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,O=x.length-1;S<=O;S++)C=S===O||this.charSpacing,v+=x[S],_=this.__charBounds[u][S],y===0?(r+=_.kernedWidth-_.width,y+=_.width):y+=_.kernedWidth,f&&!C&&this._reSpaceAndTab.test(x[S])&&(C=!0),C||(p=p||this.getCompleteStyleDeclaration(u,S),d=this.getCompleteStyleDeclaration(u,S+1),C=t.util.hasStyleChanged(p,d,!0)),C&&(b=this._getStyleDeclaration(u,S)||{},l.push(this._createTextCharSpan(v,b,r,c)),v="",p=d,r+=y,y=0)},_pushTextBgRect:function(l,u,r,c,a,f){var p=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',o(r,p),'" y="',o(c,p),'" width="',o(a,p),'" height="',o(f,p),`"></rect>
`)},_setSVGTextLineBg:function(l,u,r,c){for(var a=this._textLines[u],f=this.getHeightOfLine(u)/this.lineHeight,p=0,d=0,v,_,b=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),y=0,x=a.length;y<x;y++)v=this.__charBounds[u][y],_=this.getValueOfPropertyAt(u,y,"textBackgroundColor"),_!==b?(b&&this._pushTextBgRect(l,b,r+d,c,p,f),d=v.left,p=v.width,b=_):p+=v.kernedWidth;_&&this._pushTextBgRect(l,_,r+d,c,p,f)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new t.Color(l):"";return!u||!u.getSource()||u.getAlpha()===1?'fill="'+l+'"':'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var u=0,r=0,c=0;c<l;c++)u+=this.getHeightOfLine(c);return r=this.getHeightOfLine(c),{lineTop:u,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var u=t.Object.prototype.getSvgStyles.call(this,l);return u+" white-space: pre;"}})}(),function(o){var n=o.fabric||(o.fabric={});n.Textbox=n.util.createClass(n.IText,n.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:n.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var u=0,r=0,c=0,a={},f=0;f<l.graphemeLines.length;f++)l.graphemeText[c]===`
`&&f>0?(r=0,c++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[c])&&f>0&&(r++,c++),a[f]={line:u,offset:r},c+=l.graphemeLines[f].length,r+=l.graphemeLines[f].length;return a},styleHas:function(l,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];r&&(u=r.line)}return n.Text.prototype.styleHas.call(this,l,u)},isEmptyStyles:function(l){if(!this.styles)return!0;var u=0,r=l+1,c,a,f=!1,p=this._styleMap[l],d=this._styleMap[l+1];p&&(l=p.line,u=p.offset),d&&(r=d.line,f=r===l,c=d.offset),a=typeof l>"u"?this.styles:{line:this.styles[l]};for(var v in a)for(var _ in a[v])if(_>=u&&(!f||_<c))for(var b in a[v][_])return!1;return!0},_getStyleDeclaration:function(l,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[l];if(!r)return null;l=r.line,u=r.offset+u}return this.callSuper("_getStyleDeclaration",l,u)},_setStyleDeclaration:function(l,u,r){var c=this._styleMap[l];l=c.line,u=c.offset+u,this.styles[l][u]=r},_deleteStyleDeclaration:function(l,u){var r=this._styleMap[l];l=r.line,u=r.offset+u,delete this.styles[l][u]},_getLineStyle:function(l){var u=this._styleMap[l];return!!this.styles[u.line]},_setLineStyle:function(l){var u=this._styleMap[l];this.styles[u.line]={}},_wrapText:function(l,u){var r=[],c;for(this.isWrapping=!0,c=0;c<l.length;c++)r=r.concat(this._wrapLine(l[c],c,u));return this.isWrapping=!1,r},_measureWord:function(l,u,r){var c=0,a,f=!0;r=r||0;for(var p=0,d=l.length;p<d;p++){var v=this._getGraphemeBox(l[p],u,p+r,a,f);c+=v.kernedWidth,a=l[p]}return c},_wrapLine:function(l,u,r,R){var a=0,f=this.splitByGrapheme,p=[],d=[],v=f?n.util.string.graphemeSplit(l):l.split(this._wordJoiners),_="",b=0,y=f?"":" ",x=0,C=0,S=0,O=!0,E=this._getWidthOfCharSpacing(),R=R||0;v.length===0&&v.push([]),r-=R;for(var W=0;W<v.length;W++)_=f?v[W]:n.util.string.graphemeSplit(v[W]),x=this._measureWord(_,u,b),b+=_.length,a+=C+x-E,a>r&&!O?(p.push(d),d=[],a=x,O=!0):a+=E,!O&&!f&&d.push(y),d=d.concat(_),C=f?0:this._measureWord([y],u,b),b++,O=!1,x>S&&(S=x);return W&&p.push(d),S+R>this.dynamicMinWidth&&(this.dynamicMinWidth=S-E+R),p},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var u=n.Text.prototype._splitTextIntoLines.call(this,l),r=this._wrapText(u.lines,this.width),c=new Array(r.length),a=0;a<r.length;a++)c[a]=r[a].join("");return u.lines=c,u.graphemeLines=r,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var u in this._styleMap)this._textLines[u]&&(l[this._styleMap[u].line]=1);for(var u in this.styles)l[u]||delete this.styles[u]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),n.Textbox.fromObject=function(l,u){var r=n.util.stylesFromArray(l.styles,l.text),c=Object.assign({},l,{styles:r});return n.Object._fromObject("Textbox",c,u,"text")}}(i),function(){var o=t.controlsUtils,n=o.scaleSkewCursorStyleHandler,l=o.scaleCursorStyleHandler,u=o.scalingEqually,r=o.scalingYOrSkewingX,c=o.scalingXOrSkewingY,a=o.scaleOrSkewActionName,f=t.Object.prototype.controls;if(f.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:n,actionHandler:c,getActionName:a}),f.mr=new t.Control({x:.5,y:0,cursorStyleHandler:n,actionHandler:c,getActionName:a}),f.mb=new t.Control({x:0,y:.5,cursorStyleHandler:n,actionHandler:r,getActionName:a}),f.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:n,actionHandler:r,getActionName:a}),f.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),f.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),f.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:u}),f.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:u}),f.mtr=new t.Control({x:0,y:-.5,actionHandler:o.rotationWithSnapping,cursorStyleHandler:o.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var p=t.Textbox.prototype.controls={};p.mtr=f.mtr,p.tr=f.tr,p.br=f.br,p.tl=f.tl,p.bl=f.bl,p.mt=f.mt,p.mb=f.mb,p.mr=new t.Control({x:.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:n,actionName:"resizing"}),p.ml=new t.Control({x:-.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:n,actionName:"resizing"})}}()})(Qo);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function bi(i){return i+.5|0}const re=(i,t,e)=>Math.max(Math.min(i,e),t);function Ue(i){return re(bi(i*2.55),0,255)}function he(i){return re(bi(i*255),0,255)}function Zt(i){return re(bi(i/2.55)/100,0,1)}function hs(i){return re(bi(i*100),0,100)}const jt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Tn=[..."0123456789ABCDEF"],ea=i=>Tn[i&15],ia=i=>Tn[(i&240)>>4]+Tn[i&15],Ci=i=>(i&240)>>4===(i&15),na=i=>Ci(i.r)&&Ci(i.g)&&Ci(i.b)&&Ci(i.a);function sa(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&jt[i[1]]*17,g:255&jt[i[2]]*17,b:255&jt[i[3]]*17,a:t===5?jt[i[4]]*17:255}:(t===7||t===9)&&(e={r:jt[i[1]]<<4|jt[i[2]],g:jt[i[3]]<<4|jt[i[4]],b:jt[i[5]]<<4|jt[i[6]],a:t===9?jt[i[7]]<<4|jt[i[8]]:255})),e}const ra=(i,t)=>i<255?t(i):"";function oa(i){var t=na(i)?ea:ia;return i?"#"+t(i.r)+t(i.g)+t(i.b)+ra(i.a,t):void 0}const aa=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Ir(i,t,e){const s=t*Math.min(e,1-e),h=(g,m=(g+i/30)%12)=>e-s*Math.max(Math.min(m-3,9-m,1),-1);return[h(0),h(8),h(4)]}function la(i,t,e){const s=(h,g=(h+i/60)%6)=>e-e*t*Math.max(Math.min(g,4-g,1),0);return[s(5),s(3),s(1)]}function ha(i,t,e){const s=Ir(i,1,.5);let h;for(t+e>1&&(h=1/(t+e),t*=h,e*=h),h=0;h<3;h++)s[h]*=1-t-e,s[h]+=t;return s}function ca(i,t,e,s,h){return i===h?(t-e)/s+(t<e?6:0):t===h?(e-i)/s+2:(i-t)/s+4}function Vn(i){const e=i.r/255,s=i.g/255,h=i.b/255,g=Math.max(e,s,h),m=Math.min(e,s,h),o=(g+m)/2;let n,l,u;return g!==m&&(u=g-m,l=o>.5?u/(2-g-m):u/(g+m),n=ca(e,s,h,u,g),n=n*60+.5),[n|0,l||0,o]}function Xn(i,t,e,s){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,s)).map(he)}function Yn(i,t,e){return Xn(Ir,i,t,e)}function ua(i,t,e){return Xn(ha,i,t,e)}function fa(i,t,e){return Xn(la,i,t,e)}function Br(i){return(i%360+360)%360}function da(i){const t=aa.exec(i);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?Ue(+t[5]):he(+t[5]));const h=Br(+t[2]),g=+t[3]/100,m=+t[4]/100;return t[1]==="hwb"?s=ua(h,g,m):t[1]==="hsv"?s=fa(h,g,m):s=Yn(h,g,m),{r:s[0],g:s[1],b:s[2],a:e}}function ga(i,t){var e=Vn(i);e[0]=Br(e[0]+t),e=Yn(e),i.r=e[0],i.g=e[1],i.b=e[2]}function pa(i){if(!i)return;const t=Vn(i),e=t[0],s=hs(t[1]),h=hs(t[2]);return i.a<255?`hsla(${e}, ${s}%, ${h}%, ${Zt(i.a)})`:`hsl(${e}, ${s}%, ${h}%)`}const cs={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},us={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ma(){const i={},t=Object.keys(us),e=Object.keys(cs);let s,h,g,m,o;for(s=0;s<t.length;s++){for(m=o=t[s],h=0;h<e.length;h++)g=e[h],o=o.replace(g,cs[g]);g=parseInt(us[m],16),i[o]=[g>>16&255,g>>8&255,g&255]}return i}let Si;function va(i){Si||(Si=ma(),Si.transparent=[0,0,0,0]);const t=Si[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const _a=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function ba(i){const t=_a.exec(i);let e=255,s,h,g;if(t){if(t[7]!==s){const m=+t[7];e=t[8]?Ue(m):re(m*255,0,255)}return s=+t[1],h=+t[3],g=+t[5],s=255&(t[2]?Ue(s):re(s,0,255)),h=255&(t[4]?Ue(h):re(h,0,255)),g=255&(t[6]?Ue(g):re(g,0,255)),{r:s,g:h,b:g,a:e}}}function ya(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${Zt(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const un=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,Ae=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function xa(i,t,e){const s=Ae(Zt(i.r)),h=Ae(Zt(i.g)),g=Ae(Zt(i.b));return{r:he(un(s+e*(Ae(Zt(t.r))-s))),g:he(un(h+e*(Ae(Zt(t.g))-h))),b:he(un(g+e*(Ae(Zt(t.b))-g))),a:i.a+e*(t.a-i.a)}}function wi(i,t,e){if(i){let s=Vn(i);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=Yn(s),i.r=s[0],i.g=s[1],i.b=s[2]}}function jr(i,t){return i&&Object.assign(t||{},i)}function fs(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=he(i[3]))):(t=jr(i,{r:0,g:0,b:0,a:1}),t.a=he(t.a)),t}function Ca(i){return i.charAt(0)==="r"?ba(i):da(i)}class oi{constructor(t){if(t instanceof oi)return t;const e=typeof t;let s;e==="object"?s=fs(t):e==="string"&&(s=sa(t)||va(t)||Ca(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=jr(this._rgb);return t&&(t.a=Zt(t.a)),t}set rgb(t){this._rgb=fs(t)}rgbString(){return this._valid?ya(this._rgb):void 0}hexString(){return this._valid?oa(this._rgb):void 0}hslString(){return this._valid?pa(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,h=t.rgb;let g;const m=e===g?.5:e,o=2*m-1,n=s.a-h.a,l=((o*n===-1?o:(o+n)/(1+o*n))+1)/2;g=1-l,s.r=255&l*s.r+g*h.r+.5,s.g=255&l*s.g+g*h.g+.5,s.b=255&l*s.b+g*h.b+.5,s.a=m*s.a+(1-m)*h.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=xa(this._rgb,t._rgb,e)),this}clone(){return new oi(this.rgb)}alpha(t){return this._rgb.a=he(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=bi(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return wi(this._rgb,2,t),this}darken(t){return wi(this._rgb,2,-t),this}saturate(t){return wi(this._rgb,1,t),this}desaturate(t){return wi(this._rgb,1,-t),this}rotate(t){return ga(this._rgb,t),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function Kt(){}const Sa=(()=>{let i=0;return()=>i++})();function ut(i){return i===null||typeof i>"u"}function vt(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function ht(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function St(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function Rt(i,t){return St(i)?i:t}function lt(i,t){return typeof i>"u"?t:i}const wa=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,zr=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function gt(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function dt(i,t,e,s){let h,g,m;if(vt(i))if(g=i.length,s)for(h=g-1;h>=0;h--)t.call(e,i[h],h);else for(h=0;h<g;h++)t.call(e,i[h],h);else if(ht(i))for(m=Object.keys(i),g=m.length,h=0;h<g;h++)t.call(e,i[m[h]],m[h])}function $i(i,t){let e,s,h,g;if(!i||!t||i.length!==t.length)return!1;for(e=0,s=i.length;e<s;++e)if(h=i[e],g=t[e],h.datasetIndex!==g.datasetIndex||h.index!==g.index)return!1;return!0}function qi(i){if(vt(i))return i.map(qi);if(ht(i)){const t=Object.create(null),e=Object.keys(i),s=e.length;let h=0;for(;h<s;++h)t[e[h]]=qi(i[e[h]]);return t}return i}function Wr(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function Ta(i,t,e,s){if(!Wr(i))return;const h=t[i],g=e[i];ht(h)&&ht(g)?ai(h,g,s):t[i]=qi(g)}function ai(i,t,e){const s=vt(t)?t:[t],h=s.length;if(!ht(i))return i;e=e||{};const g=e.merger||Ta;let m;for(let o=0;o<h;++o){if(m=s[o],!ht(m))continue;const n=Object.keys(m);for(let l=0,u=n.length;l<u;++l)g(n[l],i,m,e)}return i}function Ze(i,t){return ai(i,t,{merger:Oa})}function Oa(i,t,e){if(!Wr(i))return;const s=t[i],h=e[i];ht(s)&&ht(h)?Ze(s,h):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=qi(h))}const ds={"":i=>i,x:i=>i.x,y:i=>i.y};function ka(i){const t=i.split("."),e=[];let s="";for(const h of t)s+=h,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function Pa(i){const t=ka(i);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function ue(i,t){return(ds[t]||(ds[t]=Pa(t)))(i)}function Un(i){return i.charAt(0).toUpperCase()+i.slice(1)}const li=i=>typeof i<"u",fe=i=>typeof i=="function",gs=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function Ma(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const bt=Math.PI,_t=2*bt,Da=_t+bt,Ki=Number.POSITIVE_INFINITY,Aa=bt/180,Tt=bt/2,pe=bt/4,ps=bt*2/3,oe=Math.log10,$t=Math.sign;function ti(i,t,e){return Math.abs(i-t)<e}function ms(i){const t=Math.round(i);i=ti(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(oe(i))),s=i/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function Ea(i){const t=[],e=Math.sqrt(i);let s;for(s=1;s<e;s++)i%s===0&&(t.push(s),t.push(i/s));return e===(e|0)&&t.push(e),t.sort((h,g)=>h-g).pop(),t}function Be(i){return!isNaN(parseFloat(i))&&isFinite(i)}function Fa(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function Hr(i,t,e){let s,h,g;for(s=0,h=i.length;s<h;s++)g=i[s][e],isNaN(g)||(t.min=Math.min(t.min,g),t.max=Math.max(t.max,g))}function Vt(i){return i*(bt/180)}function Gn(i){return i*(180/bt)}function vs(i){if(!St(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function Nr(i,t){const e=t.x-i.x,s=t.y-i.y,h=Math.sqrt(e*e+s*s);let g=Math.atan2(s,e);return g<-.5*bt&&(g+=_t),{angle:g,distance:h}}function On(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function La(i,t){return(i-t+Da)%_t-bt}function It(i){return(i%_t+_t)%_t}function hi(i,t,e,s){const h=It(i),g=It(t),m=It(e),o=It(g-h),n=It(m-h),l=It(h-g),u=It(h-m);return h===g||h===m||s&&g===m||o>n&&l<u}function Pt(i,t,e){return Math.max(t,Math.min(e,i))}function Ra(i){return Pt(i,-32768,32767)}function ee(i,t,e,s=1e-6){return i>=Math.min(t,e)-s&&i<=Math.max(t,e)+s}function $n(i,t,e){e=e||(m=>i[m]<t);let s=i.length-1,h=0,g;for(;s-h>1;)g=h+s>>1,e(g)?h=g:s=g;return{lo:h,hi:s}}const ie=(i,t,e,s)=>$n(i,e,s?h=>{const g=i[h][t];return g<e||g===e&&i[h+1][t]===e}:h=>i[h][t]<e),Ia=(i,t,e)=>$n(i,e,s=>i[s][t]>=e);function Ba(i,t,e){let s=0,h=i.length;for(;s<h&&i[s]<t;)s++;for(;h>s&&i[h-1]>e;)h--;return s>0||h<i.length?i.slice(s,h):i}const Vr=["push","pop","shift","splice","unshift"];function ja(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Vr.forEach(e=>{const s="_onData"+Un(e),h=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...g){const m=h.apply(this,g);return i._chartjs.listeners.forEach(o=>{typeof o[s]=="function"&&o[s](...g)}),m}})})}function _s(i,t){const e=i._chartjs;if(!e)return;const s=e.listeners,h=s.indexOf(t);h!==-1&&s.splice(h,1),!(s.length>0)&&(Vr.forEach(g=>{delete i[g]}),delete i._chartjs)}function Xr(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const Yr=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function Ur(i,t){let e=[],s=!1;return function(...h){e=h,s||(s=!0,Yr.call(window,()=>{s=!1,i.apply(t,e)}))}}function za(i,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(i,t,s)):i.apply(this,s),t}}const qn=i=>i==="start"?"left":i==="end"?"right":"center",Mt=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2,Wa=(i,t,e,s)=>i===(s?"left":"right")?e:i==="center"?(t+e)/2:t;function Gr(i,t,e){const s=t.length;let h=0,g=s;if(i._sorted){const{iScale:m,_parsed:o}=i,n=m.axis,{min:l,max:u,minDefined:r,maxDefined:c}=m.getUserBounds();r&&(h=Pt(Math.min(ie(o,n,l).lo,e?s:ie(t,n,m.getPixelForValue(l)).lo),0,s-1)),c?g=Pt(Math.max(ie(o,m.axis,u,!0).hi+1,e?0:ie(t,n,m.getPixelForValue(u),!0).hi+1),h,s)-h:g=s-h}return{start:h,count:g}}function $r(i){const{xScale:t,yScale:e,_scaleRanges:s}=i,h={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return i._scaleRanges=h,!0;const g=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,h),g}const Ti=i=>i===0||i===1,bs=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*_t/e)),ys=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*_t/e)+1,ei={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*Tt)+1,easeOutSine:i=>Math.sin(i*Tt),easeInOutSine:i=>-.5*(Math.cos(bt*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>Ti(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>Ti(i)?i:bs(i,.075,.3),easeOutElastic:i=>Ti(i)?i:ys(i,.075,.3),easeInOutElastic(i){return Ti(i)?i:i<.5?.5*bs(i*2,.1125,.45):.5+.5*ys(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-ei.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?ei.easeInBounce(i*2)*.5:ei.easeOutBounce(i*2-1)*.5+.5};function Kn(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function xs(i){return Kn(i)?i:new oi(i)}function fn(i){return Kn(i)?i:new oi(i).saturate(.5).darken(.1).hexString()}const Ha=["x","y","borderWidth","radius","tension"],Na=["color","borderColor","backgroundColor"];function Va(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:Na},numbers:{type:"number",properties:Ha}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Xa(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Cs=new Map;function Ya(i,t){t=t||{};const e=i+JSON.stringify(t);let s=Cs.get(e);return s||(s=new Intl.NumberFormat(i,t),Cs.set(e,s)),s}function yi(i,t,e){return Ya(t,e).format(i)}const qr={values(i){return vt(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const s=this.chart.options.locale;let h,g=i;if(e.length>1){const l=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(l<1e-4||l>1e15)&&(h="scientific"),g=Ua(i,e)}const m=oe(Math.abs(g)),o=isNaN(m)?1:Math.max(Math.min(-1*Math.floor(m),20),0),n={notation:h,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(n,this.options.ticks.format),yi(i,s,n)},logarithmic(i,t,e){if(i===0)return"0";const s=e[t].significand||i/Math.pow(10,Math.floor(oe(i)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?qr.numeric.call(this,i,t,e):""}};function Ua(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var sn={formatters:qr};function Ga(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:sn.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Oe=Object.create(null),kn=Object.create(null);function ii(i,t){if(!t)return i;const e=t.split(".");for(let s=0,h=e.length;s<h;++s){const g=e[s];i=i[g]||(i[g]=Object.create(null))}return i}function dn(i,t,e){return typeof t=="string"?ai(ii(i,t),e):ai(ii(i,""),t)}class $a{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,h)=>fn(h.backgroundColor),this.hoverBorderColor=(s,h)=>fn(h.borderColor),this.hoverColor=(s,h)=>fn(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return dn(this,t,e)}get(t){return ii(this,t)}describe(t,e){return dn(kn,t,e)}override(t,e){return dn(Oe,t,e)}route(t,e,s,h){const g=ii(this,t),m=ii(this,s),o="_"+e;Object.defineProperties(g,{[o]:{value:g[e],writable:!0},[e]:{enumerable:!0,get(){const n=this[o],l=m[h];return ht(n)?Object.assign({},l,n):lt(n,l)},set(n){this[o]=n}}})}apply(t){t.forEach(e=>e(this))}}var wt=new $a({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Va,Xa,Ga]);function qa(i){return!i||ut(i.size)||ut(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function Ji(i,t,e,s,h){let g=t[h];return g||(g=t[h]=i.measureText(h).width,e.push(h)),g>s&&(s=g),s}function Ka(i,t,e,s){s=s||{};let h=s.data=s.data||{},g=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(h=s.data={},g=s.garbageCollect=[],s.font=t),i.save(),i.font=t;let m=0;const o=e.length;let n,l,u,r,c;for(n=0;n<o;n++)if(r=e[n],r!=null&&!vt(r))m=Ji(i,h,g,m,r);else if(vt(r))for(l=0,u=r.length;l<u;l++)c=r[l],c!=null&&!vt(c)&&(m=Ji(i,h,g,m,c));i.restore();const a=g.length/2;if(a>e.length){for(n=0;n<a;n++)delete h[g[n]];g.splice(0,a)}return m}function me(i,t,e){const s=i.currentDevicePixelRatio,h=e!==0?Math.max(e/2,.5):0;return Math.round((t-h)*s)/s+h}function Ss(i,t){t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore()}function Pn(i,t,e,s){Kr(i,t,e,s,null)}function Kr(i,t,e,s,h){let g,m,o,n,l,u,r,c;const a=t.pointStyle,f=t.rotation,p=t.radius;let d=(f||0)*Aa;if(a&&typeof a=="object"&&(g=a.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){i.save(),i.translate(e,s),i.rotate(d),i.drawImage(a,-a.width/2,-a.height/2,a.width,a.height),i.restore();return}if(!(isNaN(p)||p<=0)){switch(i.beginPath(),a){default:h?i.ellipse(e,s,h/2,p,0,0,_t):i.arc(e,s,p,0,_t),i.closePath();break;case"triangle":u=h?h/2:p,i.moveTo(e+Math.sin(d)*u,s-Math.cos(d)*p),d+=ps,i.lineTo(e+Math.sin(d)*u,s-Math.cos(d)*p),d+=ps,i.lineTo(e+Math.sin(d)*u,s-Math.cos(d)*p),i.closePath();break;case"rectRounded":l=p*.516,n=p-l,m=Math.cos(d+pe)*n,r=Math.cos(d+pe)*(h?h/2-l:n),o=Math.sin(d+pe)*n,c=Math.sin(d+pe)*(h?h/2-l:n),i.arc(e-r,s-o,l,d-bt,d-Tt),i.arc(e+c,s-m,l,d-Tt,d),i.arc(e+r,s+o,l,d,d+Tt),i.arc(e-c,s+m,l,d+Tt,d+bt),i.closePath();break;case"rect":if(!f){n=Math.SQRT1_2*p,u=h?h/2:n,i.rect(e-u,s-n,2*u,2*n);break}d+=pe;case"rectRot":r=Math.cos(d)*(h?h/2:p),m=Math.cos(d)*p,o=Math.sin(d)*p,c=Math.sin(d)*(h?h/2:p),i.moveTo(e-r,s-o),i.lineTo(e+c,s-m),i.lineTo(e+r,s+o),i.lineTo(e-c,s+m),i.closePath();break;case"crossRot":d+=pe;case"cross":r=Math.cos(d)*(h?h/2:p),m=Math.cos(d)*p,o=Math.sin(d)*p,c=Math.sin(d)*(h?h/2:p),i.moveTo(e-r,s-o),i.lineTo(e+r,s+o),i.moveTo(e+c,s-m),i.lineTo(e-c,s+m);break;case"star":r=Math.cos(d)*(h?h/2:p),m=Math.cos(d)*p,o=Math.sin(d)*p,c=Math.sin(d)*(h?h/2:p),i.moveTo(e-r,s-o),i.lineTo(e+r,s+o),i.moveTo(e+c,s-m),i.lineTo(e-c,s+m),d+=pe,r=Math.cos(d)*(h?h/2:p),m=Math.cos(d)*p,o=Math.sin(d)*p,c=Math.sin(d)*(h?h/2:p),i.moveTo(e-r,s-o),i.lineTo(e+r,s+o),i.moveTo(e+c,s-m),i.lineTo(e-c,s+m);break;case"line":m=h?h/2:Math.cos(d)*p,o=Math.sin(d)*p,i.moveTo(e-m,s-o),i.lineTo(e+m,s+o);break;case"dash":i.moveTo(e,s),i.lineTo(e+Math.cos(d)*(h?h/2:p),s+Math.sin(d)*p);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function ne(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function rn(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function on(i){i.restore()}function Ja(i,t,e,s,h){if(!t)return i.lineTo(e.x,e.y);if(h==="middle"){const g=(t.x+e.x)/2;i.lineTo(g,t.y),i.lineTo(g,e.y)}else h==="after"!=!!s?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function Qa(i,t,e,s){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function Za(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),ut(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function tl(i,t,e,s,h){if(h.strikethrough||h.underline){const g=i.measureText(s),m=t-g.actualBoundingBoxLeft,o=t+g.actualBoundingBoxRight,n=e-g.actualBoundingBoxAscent,l=e+g.actualBoundingBoxDescent,u=h.strikethrough?(n+l)/2:l;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=h.decorationWidth||2,i.moveTo(m,u),i.lineTo(o,u),i.stroke()}}function el(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function ke(i,t,e,s,h,g={}){const m=vt(t)?t:[t],o=g.strokeWidth>0&&g.strokeColor!=="";let n,l;for(i.save(),i.font=h.string,Za(i,g),n=0;n<m.length;++n)l=m[n],g.backdrop&&el(i,g.backdrop),o&&(g.strokeColor&&(i.strokeStyle=g.strokeColor),ut(g.strokeWidth)||(i.lineWidth=g.strokeWidth),i.strokeText(l,e,s,g.maxWidth)),i.fillText(l,e,s,g.maxWidth),tl(i,e,s,l,g),s+=Number(h.lineHeight);i.restore()}function ci(i,t){const{x:e,y:s,w:h,h:g,radius:m}=t;i.arc(e+m.topLeft,s+m.topLeft,m.topLeft,1.5*bt,bt,!0),i.lineTo(e,s+g-m.bottomLeft),i.arc(e+m.bottomLeft,s+g-m.bottomLeft,m.bottomLeft,bt,Tt,!0),i.lineTo(e+h-m.bottomRight,s+g),i.arc(e+h-m.bottomRight,s+g-m.bottomRight,m.bottomRight,Tt,0,!0),i.lineTo(e+h,s+m.topRight),i.arc(e+h-m.topRight,s+m.topRight,m.topRight,0,-Tt,!0),i.lineTo(e+m.topLeft,s)}const il=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,nl=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function sl(i,t){const e=(""+i).match(il);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const rl=i=>+i||0;function Jn(i,t){const e={},s=ht(t),h=s?Object.keys(t):t,g=ht(i)?s?m=>lt(i[m],i[t[m]]):m=>i[m]:()=>i;for(const m of h)e[m]=rl(g(m));return e}function Jr(i){return Jn(i,{top:"y",right:"x",bottom:"y",left:"x"})}function Se(i){return Jn(i,["topLeft","topRight","bottomLeft","bottomRight"])}function At(i){const t=Jr(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function kt(i,t){i=i||{},t=t||wt.font;let e=lt(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=lt(i.style,t.style);s&&!(""+s).match(nl)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const h={family:lt(i.family,t.family),lineHeight:sl(lt(i.lineHeight,t.lineHeight),e),size:e,style:s,weight:lt(i.weight,t.weight),string:""};return h.string=qa(h),h}function Ge(i,t,e,s){let h=!0,g,m,o;for(g=0,m=i.length;g<m;++g)if(o=i[g],o!==void 0&&(t!==void 0&&typeof o=="function"&&(o=o(t),h=!1),e!==void 0&&vt(o)&&(o=o[e%o.length],h=!1),o!==void 0))return s&&!h&&(s.cacheable=!1),o}function ol(i,t,e){const{min:s,max:h}=i,g=zr(t,(h-s)/2),m=(o,n)=>e&&o===0?0:o+n;return{min:m(s,-Math.abs(g)),max:m(h,g)}}function de(i,t){return Object.assign(Object.create(i),t)}function Qn(i,t=[""],e,s,h=()=>i[0]){const g=e||i;typeof s>"u"&&(s=eo("_fallback",i));const m={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:g,_fallback:s,_getTarget:h,override:o=>Qn([o,...i],t,g,s)};return new Proxy(m,{deleteProperty(o,n){return delete o[n],delete o._keys,delete i[0][n],!0},get(o,n){return Zr(o,n,()=>gl(n,t,i,o))},getOwnPropertyDescriptor(o,n){return Reflect.getOwnPropertyDescriptor(o._scopes[0],n)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(o,n){return Ts(o).includes(n)},ownKeys(o){return Ts(o)},set(o,n,l){const u=o._storage||(o._storage=h());return o[n]=u[n]=l,delete o._keys,!0}})}function je(i,t,e,s){const h={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:Qr(i,s),setContext:g=>je(i,g,e,s),override:g=>je(i.override(g),t,e,s)};return new Proxy(h,{deleteProperty(g,m){return delete g[m],delete i[m],!0},get(g,m,o){return Zr(g,m,()=>ll(g,m,o))},getOwnPropertyDescriptor(g,m){return g._descriptors.allKeys?Reflect.has(i,m)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,m)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(g,m){return Reflect.has(i,m)},ownKeys(){return Reflect.ownKeys(i)},set(g,m,o){return i[m]=o,delete g[m],!0}})}function Qr(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:h=t.allKeys}=i;return{allKeys:h,scriptable:e,indexable:s,isScriptable:fe(e)?e:()=>e,isIndexable:fe(s)?s:()=>s}}const al=(i,t)=>i?i+Un(t):t,Zn=(i,t)=>ht(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Zr(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t))return i[t];const s=e();return i[t]=s,s}function ll(i,t,e){const{_proxy:s,_context:h,_subProxy:g,_descriptors:m}=i;let o=s[t];return fe(o)&&m.isScriptable(t)&&(o=hl(t,o,i,e)),vt(o)&&o.length&&(o=cl(t,o,i,m.isIndexable)),Zn(t,o)&&(o=je(o,h,g&&g[t],m)),o}function hl(i,t,e,s){const{_proxy:h,_context:g,_subProxy:m,_stack:o}=e;if(o.has(i))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+i);o.add(i);let n=t(g,m||s);return o.delete(i),Zn(i,n)&&(n=ts(h._scopes,h,i,n)),n}function cl(i,t,e,s){const{_proxy:h,_context:g,_subProxy:m,_descriptors:o}=e;if(typeof g.index<"u"&&s(i))return t[g.index%t.length];if(ht(t[0])){const n=t,l=h._scopes.filter(u=>u!==n);t=[];for(const u of n){const r=ts(l,h,i,u);t.push(je(r,g,m&&m[i],o))}}return t}function to(i,t,e){return fe(i)?i(t,e):i}const ul=(i,t)=>i===!0?t:typeof i=="string"?ue(t,i):void 0;function fl(i,t,e,s,h){for(const g of t){const m=ul(e,g);if(m){i.add(m);const o=to(m._fallback,e,h);if(typeof o<"u"&&o!==e&&o!==s)return o}else if(m===!1&&typeof s<"u"&&e!==s)return null}return!1}function ts(i,t,e,s){const h=t._rootScopes,g=to(t._fallback,e,s),m=[...i,...h],o=new Set;o.add(s);let n=ws(o,m,e,g||e,s);return n===null||typeof g<"u"&&g!==e&&(n=ws(o,m,g,n,s),n===null)?!1:Qn(Array.from(o),[""],h,g,()=>dl(t,e,s))}function ws(i,t,e,s,h){for(;e;)e=fl(i,t,e,s,h);return e}function dl(i,t,e){const s=i._getTarget();t in s||(s[t]={});const h=s[t];return vt(h)&&ht(e)?e:h||{}}function gl(i,t,e,s){let h;for(const g of t)if(h=eo(al(g,i),e),typeof h<"u")return Zn(i,h)?ts(e,s,i,h):h}function eo(i,t){for(const e of t){if(!e)continue;const s=e[i];if(typeof s<"u")return s}}function Ts(i){let t=i._keys;return t||(t=i._keys=pl(i._scopes)),t}function pl(i){const t=new Set;for(const e of i)for(const s of Object.keys(e).filter(h=>!h.startsWith("_")))t.add(s);return Array.from(t)}function io(i,t,e,s){const{iScale:h}=i,{key:g="r"}=this._parsing,m=new Array(s);let o,n,l,u;for(o=0,n=s;o<n;++o)l=o+e,u=t[l],m[o]={r:h.parse(ue(u,g),l)};return m}const ml=Number.EPSILON||1e-14,ze=(i,t)=>t<i.length&&!i[t].skip&&i[t],no=i=>i==="x"?"y":"x";function vl(i,t,e,s){const h=i.skip?t:i,g=t,m=e.skip?t:e,o=On(g,h),n=On(m,g);let l=o/(o+n),u=n/(o+n);l=isNaN(l)?0:l,u=isNaN(u)?0:u;const r=s*l,c=s*u;return{previous:{x:g.x-r*(m.x-h.x),y:g.y-r*(m.y-h.y)},next:{x:g.x+c*(m.x-h.x),y:g.y+c*(m.y-h.y)}}}function _l(i,t,e){const s=i.length;let h,g,m,o,n,l=ze(i,0);for(let u=0;u<s-1;++u)if(n=l,l=ze(i,u+1),!(!n||!l)){if(ti(t[u],0,ml)){e[u]=e[u+1]=0;continue}h=e[u]/t[u],g=e[u+1]/t[u],o=Math.pow(h,2)+Math.pow(g,2),!(o<=9)&&(m=3/Math.sqrt(o),e[u]=h*m*t[u],e[u+1]=g*m*t[u])}}function bl(i,t,e="x"){const s=no(e),h=i.length;let g,m,o,n=ze(i,0);for(let l=0;l<h;++l){if(m=o,o=n,n=ze(i,l+1),!o)continue;const u=o[e],r=o[s];m&&(g=(u-m[e])/3,o[`cp1${e}`]=u-g,o[`cp1${s}`]=r-g*t[l]),n&&(g=(n[e]-u)/3,o[`cp2${e}`]=u+g,o[`cp2${s}`]=r+g*t[l])}}function yl(i,t="x"){const e=no(t),s=i.length,h=Array(s).fill(0),g=Array(s);let m,o,n,l=ze(i,0);for(m=0;m<s;++m)if(o=n,n=l,l=ze(i,m+1),!!n){if(l){const u=l[t]-n[t];h[m]=u!==0?(l[e]-n[e])/u:0}g[m]=o?l?$t(h[m-1])!==$t(h[m])?0:(h[m-1]+h[m])/2:h[m-1]:h[m]}_l(i,h,g),bl(i,g,t)}function Oi(i,t,e){return Math.max(Math.min(i,e),t)}function xl(i,t){let e,s,h,g,m,o=ne(i[0],t);for(e=0,s=i.length;e<s;++e)m=g,g=o,o=e<s-1&&ne(i[e+1],t),g&&(h=i[e],m&&(h.cp1x=Oi(h.cp1x,t.left,t.right),h.cp1y=Oi(h.cp1y,t.top,t.bottom)),o&&(h.cp2x=Oi(h.cp2x,t.left,t.right),h.cp2y=Oi(h.cp2y,t.top,t.bottom)))}function Cl(i,t,e,s,h){let g,m,o,n;if(t.spanGaps&&(i=i.filter(l=>!l.skip)),t.cubicInterpolationMode==="monotone")yl(i,h);else{let l=s?i[i.length-1]:i[0];for(g=0,m=i.length;g<m;++g)o=i[g],n=vl(l,o,i[Math.min(g+1,m-(s?0:1))%m],t.tension),o.cp1x=n.previous.x,o.cp1y=n.previous.y,o.cp2x=n.next.x,o.cp2y=n.next.y,l=o}t.capBezierPoints&&xl(i,e)}function so(){return typeof window<"u"&&typeof document<"u"}function es(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Qi(i,t,e){let s;return typeof i=="string"?(s=parseInt(i,10),i.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=i,s}const an=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function Sl(i,t){return an(i).getPropertyValue(t)}const wl=["top","right","bottom","left"];function we(i,t,e){const s={};e=e?"-"+e:"";for(let h=0;h<4;h++){const g=wl[h];s[g]=parseFloat(i[t+"-"+g+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const Tl=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function Ol(i,t){const e=i.touches,s=e&&e.length?e[0]:i,{offsetX:h,offsetY:g}=s;let m=!1,o,n;if(Tl(h,g,i.target))o=h,n=g;else{const l=t.getBoundingClientRect();o=s.clientX-l.left,n=s.clientY-l.top,m=!0}return{x:o,y:n,box:m}}function be(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:s}=t,h=an(e),g=h.boxSizing==="border-box",m=we(h,"padding"),o=we(h,"border","width"),{x:n,y:l,box:u}=Ol(i,e),r=m.left+(u&&o.left),c=m.top+(u&&o.top);let{width:a,height:f}=t;return g&&(a-=m.width+o.width,f-=m.height+o.height),{x:Math.round((n-r)/a*e.width/s),y:Math.round((l-c)/f*e.height/s)}}function kl(i,t,e){let s,h;if(t===void 0||e===void 0){const g=es(i);if(!g)t=i.clientWidth,e=i.clientHeight;else{const m=g.getBoundingClientRect(),o=an(g),n=we(o,"border","width"),l=we(o,"padding");t=m.width-l.width-n.width,e=m.height-l.height-n.height,s=Qi(o.maxWidth,g,"clientWidth"),h=Qi(o.maxHeight,g,"clientHeight")}}return{width:t,height:e,maxWidth:s||Ki,maxHeight:h||Ki}}const ki=i=>Math.round(i*10)/10;function Pl(i,t,e,s){const h=an(i),g=we(h,"margin"),m=Qi(h.maxWidth,i,"clientWidth")||Ki,o=Qi(h.maxHeight,i,"clientHeight")||Ki,n=kl(i,t,e);let{width:l,height:u}=n;if(h.boxSizing==="content-box"){const c=we(h,"border","width"),a=we(h,"padding");l-=a.width+c.width,u-=a.height+c.height}return l=Math.max(0,l-g.width),u=Math.max(0,s?l/s:u-g.height),l=ki(Math.min(l,m,n.maxWidth)),u=ki(Math.min(u,o,n.maxHeight)),l&&!u&&(u=ki(l/2)),(t!==void 0||e!==void 0)&&s&&n.height&&u>n.height&&(u=n.height,l=ki(Math.floor(u*s))),{width:l,height:u}}function Os(i,t,e){const s=t||1,h=Math.floor(i.height*s),g=Math.floor(i.width*s);i.height=Math.floor(i.height),i.width=Math.floor(i.width);const m=i.canvas;return m.style&&(e||!m.style.height&&!m.style.width)&&(m.style.height=`${i.height}px`,m.style.width=`${i.width}px`),i.currentDevicePixelRatio!==s||m.height!==h||m.width!==g?(i.currentDevicePixelRatio=s,m.height=h,m.width=g,i.ctx.setTransform(s,0,0,s,0,0),!0):!1}const Ml=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch{}return i}();function ks(i,t){const e=Sl(i,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function ye(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function Dl(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:s==="middle"?e<.5?i.y:t.y:s==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function Al(i,t,e,s){const h={x:i.cp2x,y:i.cp2y},g={x:t.cp1x,y:t.cp1y},m=ye(i,h,e),o=ye(h,g,e),n=ye(g,t,e),l=ye(m,o,e),u=ye(o,n,e);return ye(l,u,e)}const El=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},Fl=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function Re(i,t,e){return i?El(t,e):Fl()}function ro(i,t){let e,s;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=s)}function oo(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function ao(i){return i==="angle"?{between:hi,compare:La,normalize:It}:{between:ee,compare:(t,e)=>t-e,normalize:t=>t}}function Ps({start:i,end:t,count:e,loop:s,style:h}){return{start:i%e,end:t%e,loop:s&&(t-i+1)%e===0,style:h}}function Ll(i,t,e){const{property:s,start:h,end:g}=e,{between:m,normalize:o}=ao(s),n=t.length;let{start:l,end:u,loop:r}=i,c,a;if(r){for(l+=n,u+=n,c=0,a=n;c<a&&m(o(t[l%n][s]),h,g);++c)l--,u--;l%=n,u%=n}return u<l&&(u+=n),{start:l,end:u,loop:r,style:i.style}}function lo(i,t,e){if(!e)return[i];const{property:s,start:h,end:g}=e,m=t.length,{compare:o,between:n,normalize:l}=ao(s),{start:u,end:r,loop:c,style:a}=Ll(i,t,e),f=[];let p=!1,d=null,v,_,b;const y=()=>n(h,b,v)&&o(h,b)!==0,x=()=>o(g,v)===0||n(g,b,v),C=()=>p||y(),S=()=>!p||x();for(let O=u,E=u;O<=r;++O)_=t[O%m],!_.skip&&(v=l(_[s]),v!==b&&(p=n(v,h,g),d===null&&C()&&(d=o(v,h)===0?O:E),d!==null&&S()&&(f.push(Ps({start:d,end:O,loop:c,count:m,style:a})),d=null),E=O,b=v));return d!==null&&f.push(Ps({start:d,end:r,loop:c,count:m,style:a})),f}function ho(i,t){const e=[],s=i.segments;for(let h=0;h<s.length;h++){const g=lo(s[h],i.points,t);g.length&&e.push(...g)}return e}function Rl(i,t,e,s){let h=0,g=t-1;if(e&&!s)for(;h<t&&!i[h].skip;)h++;for(;h<t&&i[h].skip;)h++;for(h%=t,e&&(g+=h);g>h&&i[g%t].skip;)g--;return g%=t,{start:h,end:g}}function Il(i,t,e,s){const h=i.length,g=[];let m=t,o=i[t],n;for(n=t+1;n<=e;++n){const l=i[n%h];l.skip||l.stop?o.skip||(s=!1,g.push({start:t%h,end:(n-1)%h,loop:s}),t=m=l.stop?n:null):(m=n,o.skip&&(t=n)),o=l}return m!==null&&g.push({start:t%h,end:m%h,loop:s}),g}function Bl(i,t){const e=i.points,s=i.options.spanGaps,h=e.length;if(!h)return[];const g=!!i._loop,{start:m,end:o}=Rl(e,h,g,s);if(s===!0)return Ms(i,[{start:m,end:o,loop:g}],e,t);const n=o<m?o+h:o,l=!!i._fullLoop&&m===0&&o===h-1;return Ms(i,Il(e,m,n,l),e,t)}function Ms(i,t,e,s){return!s||!s.setContext||!e?t:jl(i,t,e,s)}function jl(i,t,e,s){const h=i._chart.getContext(),g=Ds(i.options),{_datasetIndex:m,options:{spanGaps:o}}=i,n=e.length,l=[];let u=g,r=t[0].start,c=r;function a(f,p,d,v){const _=o?-1:1;if(f!==p){for(f+=n;e[f%n].skip;)f-=_;for(;e[p%n].skip;)p+=_;f%n!==p%n&&(l.push({start:f%n,end:p%n,loop:d,style:v}),u=v,r=p%n)}}for(const f of t){r=o?r:f.start;let p=e[r%n],d;for(c=r+1;c<=f.end;c++){const v=e[c%n];d=Ds(s.setContext(de(h,{type:"segment",p0:p,p1:v,p0DataIndex:(c-1)%n,p1DataIndex:c%n,datasetIndex:m}))),zl(d,u)&&a(r,c-1,f.loop,u),p=v,u=d}r<c-1&&a(r,c-1,f.loop,u)}return l}function Ds(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function zl(i,t){if(!t)return!1;const e=[],s=function(h,g){return Kn(g)?(e.includes(g)||e.push(g),e.indexOf(g)):g};return JSON.stringify(i,s)!==JSON.stringify(t,s)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class Wl{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,h){const g=e.listeners[h],m=e.duration;g.forEach(o=>o({chart:t,initial:e.initial,numSteps:m,currentStep:Math.min(s-e.start,m)}))}_refresh(){this._request||(this._running=!0,this._request=Yr.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,h)=>{if(!s.running||!s.items.length)return;const g=s.items;let m=g.length-1,o=!1,n;for(;m>=0;--m)n=g[m],n._active?(n._total>s.duration&&(s.duration=n._total),n.tick(t),o=!0):(g[m]=g[g.length-1],g.pop());o&&(h.draw(),this._notify(h,s,t,"progress")),g.length||(s.running=!1,this._notify(h,s,t,"complete"),s.initial=!1),e+=g.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,h)=>Math.max(s,h._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let h=s.length-1;for(;h>=0;--h)s[h].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Jt=new Wl;const As="transparent",Hl={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const s=xs(i||As),h=s.valid&&xs(t||As);return h&&h.valid?h.mix(s,e).hexString():t},number(i,t,e){return i+(t-i)*e}};class Nl{constructor(t,e,s,h){const g=e[s];h=Ge([t.to,h,g,t.from]);const m=Ge([t.from,g,h]);this._active=!0,this._fn=t.fn||Hl[t.type||typeof m],this._easing=ei[t.easing]||ei.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=m,this._to=h,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const h=this._target[this._prop],g=s-this._start,m=this._duration-g;this._start=s,this._duration=Math.floor(Math.max(m,t.duration)),this._total+=g,this._loop=!!t.loop,this._to=Ge([t.to,e,h,t.from]),this._from=Ge([t.from,h,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,h=this._prop,g=this._from,m=this._loop,o=this._to;let n;if(this._active=g!==o&&(m||e<s),!this._active){this._target[h]=o,this._notify(!0);return}if(e<0){this._target[h]=g;return}n=e/s%2,n=m&&n>1?2-n:n,n=this._easing(Math.min(1,Math.max(0,n))),this._target[h]=this._fn(g,o,n)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let h=0;h<s.length;h++)s[h][e]()}}class co{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!ht(t))return;const e=Object.keys(wt.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(h=>{const g=t[h];if(!ht(g))return;const m={};for(const o of e)m[o]=g[o];(vt(g.properties)&&g.properties||[h]).forEach(o=>{(o===h||!s.has(o))&&s.set(o,m)})})}_animateOptions(t,e){const s=e.options,h=Xl(t,s);if(!h)return[];const g=this._createAnimations(h,s);return s.$shared&&Vl(t.options.$animations,s).then(()=>{t.options=s},()=>{}),g}_createAnimations(t,e){const s=this._properties,h=[],g=t.$animations||(t.$animations={}),m=Object.keys(e),o=Date.now();let n;for(n=m.length-1;n>=0;--n){const l=m[n];if(l.charAt(0)==="$")continue;if(l==="options"){h.push(...this._animateOptions(t,e));continue}const u=e[l];let r=g[l];const c=s.get(l);if(r)if(c&&r.active()){r.update(c,u,o);continue}else r.cancel();if(!c||!c.duration){t[l]=u;continue}g[l]=r=new Nl(c,t,l,u),h.push(r)}return h}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return Jt.add(this._chart,s),!0}}function Vl(i,t){const e=[],s=Object.keys(t);for(let h=0;h<s.length;h++){const g=i[s[h]];g&&g.active()&&e.push(g.wait())}return Promise.all(e)}function Xl(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Es(i,t){const e=i&&i.options||{},s=e.reverse,h=e.min===void 0?t:0,g=e.max===void 0?t:0;return{start:s?g:h,end:s?h:g}}function Yl(i,t,e){if(e===!1)return!1;const s=Es(i,e),h=Es(t,e);return{top:h.end,right:s.end,bottom:h.start,left:s.start}}function Ul(i){let t,e,s,h;return ht(i)?(t=i.top,e=i.right,s=i.bottom,h=i.left):t=e=s=h=i,{top:t,right:e,bottom:s,left:h,disabled:i===!1}}function uo(i,t){const e=[],s=i._getSortedDatasetMetas(t);let h,g;for(h=0,g=s.length;h<g;++h)e.push(s[h].index);return e}function Fs(i,t,e,s={}){const h=i.keys,g=s.mode==="single";let m,o,n,l;if(t!==null){for(m=0,o=h.length;m<o;++m){if(n=+h[m],n===e){if(s.all)continue;break}l=i.values[n],St(l)&&(g||t===0||$t(t)===$t(l))&&(t+=l)}return t}}function Gl(i){const t=Object.keys(i),e=new Array(t.length);let s,h,g;for(s=0,h=t.length;s<h;++s)g=t[s],e[s]={x:g,y:i[g]};return e}function Ls(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function $l(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function ql(i){const{min:t,max:e,minDefined:s,maxDefined:h}=i.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:h?e:Number.POSITIVE_INFINITY}}function Kl(i,t,e){const s=i[t]||(i[t]={});return s[e]||(s[e]={})}function Rs(i,t,e,s){for(const h of t.getMatchingVisibleMetas(s).reverse()){const g=i[h.index];if(e&&g>0||!e&&g<0)return h.index}return null}function Is(i,t){const{chart:e,_cachedMeta:s}=i,h=e._stacks||(e._stacks={}),{iScale:g,vScale:m,index:o}=s,n=g.axis,l=m.axis,u=$l(g,m,s),r=t.length;let c;for(let a=0;a<r;++a){const f=t[a],{[n]:p,[l]:d}=f,v=f._stacks||(f._stacks={});c=v[l]=Kl(h,u,p),c[o]=d,c._top=Rs(c,m,!0,s.type),c._bottom=Rs(c,m,!1,s.type);const _=c._visualValues||(c._visualValues={});_[o]=d}}function gn(i,t){const e=i.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function Jl(i,t){return de(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Ql(i,t,e){return de(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function He(i,t){const e=i.controller.index,s=i.vScale&&i.vScale.axis;if(s){t=t||i._parsed;for(const h of t){const g=h._stacks;if(!g||g[s]===void 0||g[s][e]===void 0)return;delete g[s][e],g[s]._visualValues!==void 0&&g[s]._visualValues[e]!==void 0&&delete g[s]._visualValues[e]}}}const pn=i=>i==="reset"||i==="none",Bs=(i,t)=>t?i:Object.assign({},i),Zl=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:uo(e,!0),values:null};class Xt{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Ls(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&He(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),h=(r,c,a,f)=>r==="x"?c:r==="r"?f:a,g=e.xAxisID=lt(s.xAxisID,gn(t,"x")),m=e.yAxisID=lt(s.yAxisID,gn(t,"y")),o=e.rAxisID=lt(s.rAxisID,gn(t,"r")),n=e.indexAxis,l=e.iAxisID=h(n,g,m,o),u=e.vAxisID=h(n,m,g,o);e.xScale=this.getScaleForId(g),e.yScale=this.getScaleForId(m),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&_s(this._data,this),t._stacked&&He(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(ht(e))this._data=Gl(e);else if(s!==e){if(s){_s(s,this);const h=this._cachedMeta;He(h),h._parsed=[]}e&&Object.isExtensible(e)&&ja(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let h=!1;this._dataCheck();const g=e._stacked;e._stacked=Ls(e.vScale,e),e.stack!==s.stack&&(h=!0,He(e),e.stack=s.stack),this._resyncElements(t),(h||g!==e._stacked)&&Is(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:h}=this,{iScale:g,_stacked:m}=s,o=g.axis;let n=t===0&&e===h.length?!0:s._sorted,l=t>0&&s._parsed[t-1],u,r,c;if(this._parsing===!1)s._parsed=h,s._sorted=!0,c=h;else{vt(h[t])?c=this.parseArrayData(s,h,t,e):ht(h[t])?c=this.parseObjectData(s,h,t,e):c=this.parsePrimitiveData(s,h,t,e);const a=()=>r[o]===null||l&&r[o]<l[o];for(u=0;u<e;++u)s._parsed[u+t]=r=c[u],n&&(a()&&(n=!1),l=r);s._sorted=n}m&&Is(this,c)}parsePrimitiveData(t,e,s,h){const{iScale:g,vScale:m}=t,o=g.axis,n=m.axis,l=g.getLabels(),u=g===m,r=new Array(h);let c,a,f;for(c=0,a=h;c<a;++c)f=c+s,r[c]={[o]:u||g.parse(l[f],f),[n]:m.parse(e[f],f)};return r}parseArrayData(t,e,s,h){const{xScale:g,yScale:m}=t,o=new Array(h);let n,l,u,r;for(n=0,l=h;n<l;++n)u=n+s,r=e[u],o[n]={x:g.parse(r[0],u),y:m.parse(r[1],u)};return o}parseObjectData(t,e,s,h){const{xScale:g,yScale:m}=t,{xAxisKey:o="x",yAxisKey:n="y"}=this._parsing,l=new Array(h);let u,r,c,a;for(u=0,r=h;u<r;++u)c=u+s,a=e[c],l[u]={x:g.parse(ue(a,o),c),y:m.parse(ue(a,n),c)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const h=this.chart,g=this._cachedMeta,m=e[t.axis],o={keys:uo(h,!0),values:e._stacks[t.axis]._visualValues};return Fs(o,m,g.index,{mode:s})}updateRangeFromParsed(t,e,s,h){const g=s[e.axis];let m=g===null?NaN:g;const o=h&&s._stacks[e.axis];h&&o&&(h.values=o,m=Fs(h,g,this._cachedMeta.index)),t.min=Math.min(t.min,m),t.max=Math.max(t.max,m)}getMinMax(t,e){const s=this._cachedMeta,h=s._parsed,g=s._sorted&&t===s.iScale,m=h.length,o=this._getOtherScale(t),n=Zl(e,s,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:r}=ql(o);let c,a;function f(){a=h[c];const p=a[o.axis];return!St(a[t.axis])||u>p||r<p}for(c=0;c<m&&!(!f()&&(this.updateRangeFromParsed(l,t,a,n),g));++c);if(g){for(c=m-1;c>=0;--c)if(!f()){this.updateRangeFromParsed(l,t,a,n);break}}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let h,g,m;for(h=0,g=e.length;h<g;++h)m=e[h][t.axis],St(m)&&s.push(m);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,h=e.vScale,g=this.getParsed(t);return{label:s?""+s.getLabelForValue(g[s.axis]):"",value:h?""+h.getLabelForValue(g[h.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Ul(lt(this.options.clip,Yl(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,h=s.data||[],g=e.chartArea,m=[],o=this._drawStart||0,n=this._drawCount||h.length-o,l=this.options.drawActiveElementsOnTop;let u;for(s.dataset&&s.dataset.draw(t,g,o,n),u=o;u<o+n;++u){const r=h[u];r.hidden||(r.active&&l?m.push(r):r.draw(t,g))}for(u=0;u<m.length;++u)m[u].draw(t,g)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const h=this.getDataset();let g;if(t>=0&&t<this._cachedMeta.data.length){const m=this._cachedMeta.data[t];g=m.$context||(m.$context=Ql(this.getContext(),t,m)),g.parsed=this.getParsed(t),g.raw=h.data[t],g.index=g.dataIndex=t}else g=this.$context||(this.$context=Jl(this.chart.getContext(),this.index)),g.dataset=h,g.index=g.datasetIndex=this.index;return g.active=!!e,g.mode=s,g}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const h=e==="active",g=this._cachedDataOpts,m=t+"-"+e,o=g[m],n=this.enableOptionSharing&&li(s);if(o)return Bs(o,n);const l=this.chart.config,u=l.datasetElementScopeKeys(this._type,t),r=h?[`${t}Hover`,"hover",t,""]:[t,""],c=l.getOptionScopes(this.getDataset(),u),a=Object.keys(wt.elements[t]),f=()=>this.getContext(s,h,e),p=l.resolveNamedOptions(c,a,f,r);return p.$shared&&(p.$shared=n,g[m]=Object.freeze(Bs(p,n))),p}_resolveAnimations(t,e,s){const h=this.chart,g=this._cachedDataOpts,m=`animation-${e}`,o=g[m];if(o)return o;let n;if(h.options.animation!==!1){const u=this.chart.config,r=u.datasetAnimationScopeKeys(this._type,e),c=u.getOptionScopes(this.getDataset(),r);n=u.createResolver(c,this.getContext(t,s,e))}const l=new co(h,n&&n.animations);return n&&n._cacheable&&(g[m]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||pn(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),h=this._sharedOptions,g=this.getSharedOptions(s),m=this.includeOptions(e,g)||g!==h;return this.updateSharedOptions(g,e,s),{sharedOptions:g,includeOptions:m}}updateElement(t,e,s,h){pn(h)?Object.assign(t,s):this._resolveAnimations(e,h).update(t,s)}updateSharedOptions(t,e,s){t&&!pn(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,h){t.active=h;const g=this.getStyle(e,h);this._resolveAnimations(e,s,h).update(t,{options:!h&&this.getSharedOptions(g)||g})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[o,n,l]of this._syncList)this[o](n,l);this._syncList=[];const h=s.length,g=e.length,m=Math.min(g,h);m&&this.parse(0,m),g>h?this._insertElements(h,g-h,t):g<h&&this._removeElements(g,h-g)}_insertElements(t,e,s=!0){const h=this._cachedMeta,g=h.data,m=t+e;let o;const n=l=>{for(l.length+=e,o=l.length-1;o>=m;o--)l[o]=l[o-e]};for(n(g),o=t;o<m;++o)g[o]=new this.dataElementType;this._parsing&&n(h._parsed),this.parse(t,e),s&&this.updateElements(g,t,e,"reset")}updateElements(t,e,s,h){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const h=s._parsed.splice(t,e);s._stacked&&He(s,h)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,h]=t;this[e](s,h)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Z(Xt,"defaults",{}),Z(Xt,"datasetElementType",null),Z(Xt,"dataElementType",null);function th(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let s=[];for(let h=0,g=e.length;h<g;h++)s=s.concat(e[h].controller.getAllParsedValues(i));i._cache.$bar=Xr(s.sort((h,g)=>h-g))}return i._cache.$bar}function eh(i){const t=i.iScale,e=th(t,i.type);let s=t._length,h,g,m,o;const n=()=>{m===32767||m===-32768||(li(o)&&(s=Math.min(s,Math.abs(m-o)||s)),o=m)};for(h=0,g=e.length;h<g;++h)m=t.getPixelForValue(e[h]),n();for(o=void 0,h=0,g=t.ticks.length;h<g;++h)m=t.getPixelForTick(h),n();return s}function ih(i,t,e,s){const h=e.barThickness;let g,m;return ut(h)?(g=t.min*e.categoryPercentage,m=e.barPercentage):(g=h*s,m=1),{chunk:g/s,ratio:m,start:t.pixels[i]-g/2}}function nh(i,t,e,s){const h=t.pixels,g=h[i];let m=i>0?h[i-1]:null,o=i<h.length-1?h[i+1]:null;const n=e.categoryPercentage;m===null&&(m=g-(o===null?t.end-t.start:o-g)),o===null&&(o=g+g-m);const l=g-(g-Math.min(m,o))/2*n;return{chunk:Math.abs(o-m)/2*n/s,ratio:e.barPercentage,start:l}}function sh(i,t,e,s){const h=e.parse(i[0],s),g=e.parse(i[1],s),m=Math.min(h,g),o=Math.max(h,g);let n=m,l=o;Math.abs(m)>Math.abs(o)&&(n=o,l=m),t[e.axis]=l,t._custom={barStart:n,barEnd:l,start:h,end:g,min:m,max:o}}function fo(i,t,e,s){return vt(i)?sh(i,t,e,s):t[e.axis]=e.parse(i,s),t}function js(i,t,e,s){const h=i.iScale,g=i.vScale,m=h.getLabels(),o=h===g,n=[];let l,u,r,c;for(l=e,u=e+s;l<u;++l)c=t[l],r={},r[h.axis]=o||h.parse(m[l],l),n.push(fo(c,r,g,l));return n}function mn(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function rh(i,t,e){return i!==0?$t(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function oh(i){let t,e,s,h,g;return i.horizontal?(t=i.base>i.x,e="left",s="right"):(t=i.base<i.y,e="bottom",s="top"),t?(h="end",g="start"):(h="start",g="end"),{start:e,end:s,reverse:t,top:h,bottom:g}}function ah(i,t,e,s){let h=t.borderSkipped;const g={};if(!h){i.borderSkipped=g;return}if(h===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:m,end:o,reverse:n,top:l,bottom:u}=oh(i);h==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===s?h=l:(e._bottom||0)===s?h=u:(g[zs(u,m,o,n)]=!0,h=l)),g[zs(h,m,o,n)]=!0,i.borderSkipped=g}function zs(i,t,e,s){return s?(i=lh(i,t,e),i=Ws(i,e,t)):i=Ws(i,t,e),i}function lh(i,t,e){return i===t?e:i===e?t:i}function Ws(i,t,e){return i==="start"?t:i==="end"?e:i}function hh(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class ji extends Xt{parsePrimitiveData(t,e,s,h){return js(t,e,s,h)}parseArrayData(t,e,s,h){return js(t,e,s,h)}parseObjectData(t,e,s,h){const{iScale:g,vScale:m}=t,{xAxisKey:o="x",yAxisKey:n="y"}=this._parsing,l=g.axis==="x"?o:n,u=m.axis==="x"?o:n,r=[];let c,a,f,p;for(c=s,a=s+h;c<a;++c)p=e[c],f={},f[g.axis]=g.parse(ue(p,l),c),r.push(fo(ue(p,u),f,m,c));return r}updateRangeFromParsed(t,e,s,h){super.updateRangeFromParsed(t,e,s,h);const g=s._custom;g&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,g.min),t.max=Math.max(t.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:h}=e,g=this.getParsed(t),m=g._custom,o=mn(m)?"["+m.start+", "+m.end+"]":""+h.getLabelForValue(g[h.axis]);return{label:""+s.getLabelForValue(g[s.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,h){const g=h==="reset",{index:m,_cachedMeta:{vScale:o}}=this,n=o.getBasePixel(),l=o.isHorizontal(),u=this._getRuler(),{sharedOptions:r,includeOptions:c}=this._getSharedOptions(e,h);for(let a=e;a<e+s;a++){const f=this.getParsed(a),p=g||ut(f[o.axis])?{base:n,head:n}:this._calculateBarValuePixels(a),d=this._calculateBarIndexPixels(a,u),v=(f._stacks||{})[o.axis],_={horizontal:l,base:p.base,enableBorderRadius:!v||mn(f._custom)||m===v._top||m===v._bottom,x:l?p.head:d.center,y:l?d.center:p.head,height:l?d.size:Math.abs(p.size),width:l?Math.abs(p.size):d.size};c&&(_.options=r||this.resolveDataElementOptions(a,t[a].active?"active":h));const b=_.options||t[a].options;ah(_,b,v,m),hh(_,b,u.ratio),this.updateElement(t[a],a,_,h)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,h=s.getMatchingVisibleMetas(this._type).filter(n=>n.controller.options.grouped),g=s.options.stacked,m=[],o=n=>{const l=n.controller.getParsed(e),u=l&&l[n.vScale.axis];if(ut(u)||isNaN(u))return!0};for(const n of h)if(!(e!==void 0&&o(n))&&((g===!1||m.indexOf(n.stack)===-1||g===void 0&&n.stack===void 0)&&m.push(n.stack),n.index===t))break;return m.length||m.push(void 0),m}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,s){const h=this._getStacks(t,s),g=e!==void 0?h.indexOf(e):-1;return g===-1?h.length-1:g}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,h=[];let g,m;for(g=0,m=e.data.length;g<m;++g)h.push(s.getPixelForValue(this.getParsed(g)[s.axis],g));const o=t.barThickness;return{min:o||eh(e),pixels:h,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:h},options:{base:g,minBarLength:m}}=this,o=g||0,n=this.getParsed(t),l=n._custom,u=mn(l);let r=n[e.axis],c=0,a=s?this.applyStack(e,n,s):r,f,p;a!==r&&(c=a-r,a=r),u&&(r=l.barStart,a=l.barEnd-l.barStart,r!==0&&$t(r)!==$t(l.barEnd)&&(c=0),c+=r);const d=!ut(g)&&!u?g:c;let v=e.getPixelForValue(d);if(this.chart.getDataVisibility(t)?f=e.getPixelForValue(c+a):f=v,p=f-v,Math.abs(p)<m){p=rh(p,e,o)*m,r===o&&(v-=p/2);const _=e.getPixelForDecimal(0),b=e.getPixelForDecimal(1),y=Math.min(_,b),x=Math.max(_,b);v=Math.max(Math.min(v,x),y),f=v+p,s&&!u&&(n._stacks[e.axis]._visualValues[h]=e.getValueForPixel(f)-e.getValueForPixel(v))}if(v===e.getPixelForValue(o)){const _=$t(p)*e.getLineWidthForValue(o)/2;v+=_,p-=_}return{size:p,base:v,head:f,center:f+p/2}}_calculateBarIndexPixels(t,e){const s=e.scale,h=this.options,g=h.skipNull,m=lt(h.maxBarThickness,1/0);let o,n;if(e.grouped){const l=g?this._getStackCount(t):e.stackCount,u=h.barThickness==="flex"?nh(t,e,h,l):ih(t,e,h,l),r=this._getStackIndex(this.index,this._cachedMeta.stack,g?t:void 0);o=u.start+u.chunk*r+u.chunk/2,n=Math.min(m,u.chunk*u.ratio)}else o=s.getPixelForValue(this.getParsed(t)[s.axis],t),n=Math.min(m,e.min*e.ratio);return{base:o-n/2,head:o+n/2,center:o,size:n}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,h=s.length;let g=0;for(;g<h;++g)this.getParsed(g)[e.axis]!==null&&s[g].draw(this._ctx)}}Z(ji,"id","bar"),Z(ji,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Z(ji,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class zi extends Xt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,h){const g=super.parsePrimitiveData(t,e,s,h);for(let m=0;m<g.length;m++)g[m]._custom=this.resolveDataElementOptions(m+s).radius;return g}parseArrayData(t,e,s,h){const g=super.parseArrayData(t,e,s,h);for(let m=0;m<g.length;m++){const o=e[s+m];g[m]._custom=lt(o[2],this.resolveDataElementOptions(m+s).radius)}return g}parseObjectData(t,e,s,h){const g=super.parseObjectData(t,e,s,h);for(let m=0;m<g.length;m++){const o=e[s+m];g[m]._custom=lt(o&&o.r&&+o.r,this.resolveDataElementOptions(m+s).radius)}return g}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:h,yScale:g}=e,m=this.getParsed(t),o=h.getLabelForValue(m.x),n=g.getLabelForValue(m.y),l=m._custom;return{label:s[t]||"",value:"("+o+", "+n+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,h){const g=h==="reset",{iScale:m,vScale:o}=this._cachedMeta,{sharedOptions:n,includeOptions:l}=this._getSharedOptions(e,h),u=m.axis,r=o.axis;for(let c=e;c<e+s;c++){const a=t[c],f=!g&&this.getParsed(c),p={},d=p[u]=g?m.getPixelForDecimal(.5):m.getPixelForValue(f[u]),v=p[r]=g?o.getBasePixel():o.getPixelForValue(f[r]);p.skip=isNaN(d)||isNaN(v),l&&(p.options=n||this.resolveDataElementOptions(c,a.active?"active":h),g&&(p.options.radius=0)),this.updateElement(a,c,p,h)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let h=super.resolveDataElementOptions(t,e);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const g=h.radius;return e!=="active"&&(h.radius=0),h.radius+=lt(s&&s._custom,g),h}}Z(zi,"id","bubble"),Z(zi,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),Z(zi,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function ch(i,t,e){let s=1,h=1,g=0,m=0;if(t<_t){const o=i,n=o+t,l=Math.cos(o),u=Math.sin(o),r=Math.cos(n),c=Math.sin(n),a=(b,y,x)=>hi(b,o,n,!0)?1:Math.max(y,y*e,x,x*e),f=(b,y,x)=>hi(b,o,n,!0)?-1:Math.min(y,y*e,x,x*e),p=a(0,l,r),d=a(Tt,u,c),v=f(bt,l,r),_=f(bt+Tt,u,c);s=(p-v)/2,h=(d-_)/2,g=-(p+v)/2,m=-(d+_)/2}return{ratioX:s,ratioY:h,offsetX:g,offsetY:m}}class Ce extends Xt{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=s;else{let g=n=>+s[n];if(ht(s[t])){const{key:n="value"}=this._parsing;g=l=>+ue(s[l],n)}let m,o;for(m=t,o=t+e;m<o;++m)h._parsed[m]=g(m)}}_getRotation(){return Vt(this.options.rotation-90)}_getCircumference(){return Vt(this.options.circumference)}_getRotationExtents(){let t=_t,e=-_t;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const h=this.chart.getDatasetMeta(s).controller,g=h._getRotation(),m=h._getCircumference();t=Math.min(t,g),e=Math.max(e,g+m)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,h=this._cachedMeta,g=h.data,m=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,o=Math.max((Math.min(s.width,s.height)-m)/2,0),n=Math.min(wa(this.options.cutout,o),1),l=this._getRingWeight(this.index),{circumference:u,rotation:r}=this._getRotationExtents(),{ratioX:c,ratioY:a,offsetX:f,offsetY:p}=ch(r,u,n),d=(s.width-m)/c,v=(s.height-m)/a,_=Math.max(Math.min(d,v)/2,0),b=zr(this.options.radius,_),y=Math.max(b*n,0),x=(b-y)/this._getVisibleDatasetWeightTotal();this.offsetX=f*b,this.offsetY=p*b,h.total=this.calculateTotal(),this.outerRadius=b-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*l,0),this.updateElements(g,0,g.length,t)}_circumference(t,e){const s=this.options,h=this._cachedMeta,g=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||h._parsed[t]===null||h.data[t].hidden?0:this.calculateCircumference(h._parsed[t]*g/_t)}updateElements(t,e,s,h){const g=h==="reset",m=this.chart,o=m.chartArea,l=m.options.animation,u=(o.left+o.right)/2,r=(o.top+o.bottom)/2,c=g&&l.animateScale,a=c?0:this.innerRadius,f=c?0:this.outerRadius,{sharedOptions:p,includeOptions:d}=this._getSharedOptions(e,h);let v=this._getRotation(),_;for(_=0;_<e;++_)v+=this._circumference(_,g);for(_=e;_<e+s;++_){const b=this._circumference(_,g),y=t[_],x={x:u+this.offsetX,y:r+this.offsetY,startAngle:v,endAngle:v+b,circumference:b,outerRadius:f,innerRadius:a};d&&(x.options=p||this.resolveDataElementOptions(_,y.active?"active":h)),v+=b,this.updateElement(y,_,x,h)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,h;for(h=0;h<e.length;h++){const g=t._parsed[h];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(h)&&!e[h].hidden&&(s+=Math.abs(g))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?_t*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,h=s.data.labels||[],g=yi(e._parsed[t],s.options.locale);return{label:h[t]||"",value:g}}getMaxBorderWidth(t){let e=0;const s=this.chart;let h,g,m,o,n;if(!t){for(h=0,g=s.data.datasets.length;h<g;++h)if(s.isDatasetVisible(h)){m=s.getDatasetMeta(h),t=m.data,o=m.controller;break}}if(!t)return 0;for(h=0,g=t.length;h<g;++h)n=o.resolveDataElementOptions(h),n.borderAlign!=="inner"&&(e=Math.max(e,n.borderWidth||0,n.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,h=t.length;s<h;++s){const g=this.resolveDataElementOptions(s);e=Math.max(e,g.offset||0,g.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(lt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Z(Ce,"id","doughnut"),Z(Ce,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Z(Ce,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),Z(Ce,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:h}}=t.legend.options;return e.labels.map((g,m)=>{const n=t.getDatasetMeta(0).controller.getStyle(m);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:h,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(m),index:m}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class Wi extends Xt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:h=[],_dataset:g}=e,m=this.chart._animationsDisabled;let{start:o,count:n}=Gr(e,h,m);this._drawStart=o,this._drawCount=n,$r(e)&&(o=0,n=h.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!g._decimated,s.points=h;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(s,void 0,{animated:!m,options:l},t),this.updateElements(h,o,n,t)}updateElements(t,e,s,h){const g=h==="reset",{iScale:m,vScale:o,_stacked:n,_dataset:l}=this._cachedMeta,{sharedOptions:u,includeOptions:r}=this._getSharedOptions(e,h),c=m.axis,a=o.axis,{spanGaps:f,segment:p}=this.options,d=Be(f)?f:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||g||h==="none",_=e+s,b=t.length;let y=e>0&&this.getParsed(e-1);for(let x=0;x<b;++x){const C=t[x],S=v?C:{};if(x<e||x>=_){S.skip=!0;continue}const O=this.getParsed(x),E=ut(O[a]),R=S[c]=m.getPixelForValue(O[c],x),W=S[a]=g||E?o.getBasePixel():o.getPixelForValue(n?this.applyStack(o,O,n):O[a],x);S.skip=isNaN(R)||isNaN(W)||E,S.stop=x>0&&Math.abs(O[c]-y[c])>d,p&&(S.parsed=O,S.raw=l.data[x]),r&&(S.options=u||this.resolveDataElementOptions(x,C.active?"active":h)),v||this.updateElement(C,x,S,h),y=O}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,h=t.data||[];if(!h.length)return s;const g=h[0].size(this.resolveDataElementOptions(0)),m=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(s,g,m)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Z(Wi,"id","line"),Z(Wi,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Z(Wi,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ni extends Xt{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,h=s.data.labels||[],g=yi(e._parsed[t].r,s.options.locale);return{label:h[t]||"",value:g}}parseObjectData(t,e,s,h){return io.bind(this)(t,e,s,h)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,h)=>{const g=this.getParsed(h).r;!isNaN(g)&&this.chart.getDataVisibility(h)&&(g<e.min&&(e.min=g),g>e.max&&(e.max=g))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,h=Math.min(e.right-e.left,e.bottom-e.top),g=Math.max(h/2,0),m=Math.max(s.cutoutPercentage?g/100*s.cutoutPercentage:1,0),o=(g-m)/t.getVisibleDatasetCount();this.outerRadius=g-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(t,e,s,h){const g=h==="reset",m=this.chart,n=m.options.animation,l=this._cachedMeta.rScale,u=l.xCenter,r=l.yCenter,c=l.getIndexAngle(0)-.5*bt;let a=c,f;const p=360/this.countVisibleElements();for(f=0;f<e;++f)a+=this._computeAngle(f,h,p);for(f=e;f<e+s;f++){const d=t[f];let v=a,_=a+this._computeAngle(f,h,p),b=m.getDataVisibility(f)?l.getDistanceFromCenterForValue(this.getParsed(f).r):0;a=_,g&&(n.animateScale&&(b=0),n.animateRotate&&(v=_=c));const y={x:u,y:r,innerRadius:0,outerRadius:b,startAngle:v,endAngle:_,options:this.resolveDataElementOptions(f,d.active?"active":h)};this.updateElement(d,f,y,h)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?Vt(this.resolveDataElementOptions(t,e).angle||s):0}}Z(ni,"id","polarArea"),Z(ni,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Z(ni,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:h}}=t.legend.options;return e.labels.map((g,m)=>{const n=t.getDatasetMeta(0).controller.getStyle(m);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:h,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(m),index:m}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Mn extends Ce{}Z(Mn,"id","pie"),Z(Mn,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Hi extends Xt{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,h){return io.bind(this)(t,e,s,h)}update(t){const e=this._cachedMeta,s=e.dataset,h=e.data||[],g=e.iScale.getLabels();if(s.points=h,t!=="resize"){const m=this.resolveDatasetElementOptions(t);this.options.showLine||(m.borderWidth=0);const o={_loop:!0,_fullLoop:g.length===h.length,options:m};this.updateElement(s,void 0,o,t)}this.updateElements(h,0,h.length,t)}updateElements(t,e,s,h){const g=this._cachedMeta.rScale,m=h==="reset";for(let o=e;o<e+s;o++){const n=t[o],l=this.resolveDataElementOptions(o,n.active?"active":h),u=g.getPointPositionForValue(o,this.getParsed(o).r),r=m?g.xCenter:u.x,c=m?g.yCenter:u.y,a={x:r,y:c,angle:u.angle,skip:isNaN(r)||isNaN(c),options:l};this.updateElement(n,o,a,h)}}}Z(Hi,"id","radar"),Z(Hi,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),Z(Hi,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Ni extends Xt{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:h,yScale:g}=e,m=this.getParsed(t),o=h.getLabelForValue(m.x),n=g.getLabelForValue(m.y);return{label:s[t]||"",value:"("+o+", "+n+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,h=this.chart._animationsDisabled;let{start:g,count:m}=Gr(e,s,h);if(this._drawStart=g,this._drawCount=m,$r(e)&&(g=0,m=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:n}=e;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!n._decimated,o.points=s;const l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(o,void 0,{animated:!h,options:l},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,g,m,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,h){const g=h==="reset",{iScale:m,vScale:o,_stacked:n,_dataset:l}=this._cachedMeta,u=this.resolveDataElementOptions(e,h),r=this.getSharedOptions(u),c=this.includeOptions(h,r),a=m.axis,f=o.axis,{spanGaps:p,segment:d}=this.options,v=Be(p)?p:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||g||h==="none";let b=e>0&&this.getParsed(e-1);for(let y=e;y<e+s;++y){const x=t[y],C=this.getParsed(y),S=_?x:{},O=ut(C[f]),E=S[a]=m.getPixelForValue(C[a],y),R=S[f]=g||O?o.getBasePixel():o.getPixelForValue(n?this.applyStack(o,C,n):C[f],y);S.skip=isNaN(E)||isNaN(R)||O,S.stop=y>0&&Math.abs(C[a]-b[a])>v,d&&(S.parsed=C,S.raw=l.data[y]),c&&(S.options=r||this.resolveDataElementOptions(y,x.active?"active":h)),_||this.updateElement(x,y,S,h),b=C}this.updateSharedOptions(r,h,u)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let o=0;for(let n=e.length-1;n>=0;--n)o=Math.max(o,e[n].size(this.resolveDataElementOptions(n))/2);return o>0&&o}const s=t.dataset,h=s.options&&s.options.borderWidth||0;if(!e.length)return h;const g=e[0].size(this.resolveDataElementOptions(0)),m=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(h,g,m)/2}}Z(Ni,"id","scatter"),Z(Ni,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),Z(Ni,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var uh=Object.freeze({__proto__:null,BarController:ji,BubbleController:zi,DoughnutController:Ce,LineController:Wi,PieController:Mn,PolarAreaController:ni,RadarController:Hi,ScatterController:Ni});function ve(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class is{constructor(t){Z(this,"options");this.options=t||{}}static override(t){Object.assign(is.prototype,t)}init(){}formats(){return ve()}parse(){return ve()}format(){return ve()}add(){return ve()}diff(){return ve()}startOf(){return ve()}endOf(){return ve()}}var fh={_date:is};function dh(i,t,e,s){const{controller:h,data:g,_sorted:m}=i,o=h._cachedMeta.iScale;if(o&&t===o.axis&&t!=="r"&&m&&g.length){const n=o._reversePixels?Ia:ie;if(s){if(h._sharedOptions){const l=g[0],u=typeof l.getRange=="function"&&l.getRange(t);if(u){const r=n(g,t,e-u),c=n(g,t,e+u);return{lo:r.lo,hi:c.hi}}}}else return n(g,t,e)}return{lo:0,hi:g.length-1}}function xi(i,t,e,s,h){const g=i.getSortedVisibleDatasetMetas(),m=e[t];for(let o=0,n=g.length;o<n;++o){const{index:l,data:u}=g[o],{lo:r,hi:c}=dh(g[o],t,m,h);for(let a=r;a<=c;++a){const f=u[a];f.skip||s(f,l,a)}}}function gh(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(s,h){const g=t?Math.abs(s.x-h.x):0,m=e?Math.abs(s.y-h.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(m,2))}}function vn(i,t,e,s,h){const g=[];return!h&&!i.isPointInArea(t)||xi(i,e,t,function(o,n,l){!h&&!ne(o,i.chartArea,0)||o.inRange(t.x,t.y,s)&&g.push({element:o,datasetIndex:n,index:l})},!0),g}function ph(i,t,e,s){let h=[];function g(m,o,n){const{startAngle:l,endAngle:u}=m.getProps(["startAngle","endAngle"],s),{angle:r}=Nr(m,{x:t.x,y:t.y});hi(r,l,u)&&h.push({element:m,datasetIndex:o,index:n})}return xi(i,e,t,g),h}function mh(i,t,e,s,h,g){let m=[];const o=gh(e);let n=Number.POSITIVE_INFINITY;function l(u,r,c){const a=u.inRange(t.x,t.y,h);if(s&&!a)return;const f=u.getCenterPoint(h);if(!(!!g||i.isPointInArea(f))&&!a)return;const d=o(t,f);d<n?(m=[{element:u,datasetIndex:r,index:c}],n=d):d===n&&m.push({element:u,datasetIndex:r,index:c})}return xi(i,e,t,l),m}function _n(i,t,e,s,h,g){return!g&&!i.isPointInArea(t)?[]:e==="r"&&!s?ph(i,t,e,h):mh(i,t,e,s,h,g)}function Hs(i,t,e,s,h){const g=[],m=e==="x"?"inXRange":"inYRange";let o=!1;return xi(i,e,t,(n,l,u)=>{n[m](t[e],h)&&(g.push({element:n,datasetIndex:l,index:u}),o=o||n.inRange(t.x,t.y,h))}),s&&!o?[]:g}var vh={evaluateInteractionItems:xi,modes:{index(i,t,e,s){const h=be(t,i),g=e.axis||"x",m=e.includeInvisible||!1,o=e.intersect?vn(i,h,g,s,m):_n(i,h,g,!1,s,m),n=[];return o.length?(i.getSortedVisibleDatasetMetas().forEach(l=>{const u=o[0].index,r=l.data[u];r&&!r.skip&&n.push({element:r,datasetIndex:l.index,index:u})}),n):[]},dataset(i,t,e,s){const h=be(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;let o=e.intersect?vn(i,h,g,s,m):_n(i,h,g,!1,s,m);if(o.length>0){const n=o[0].datasetIndex,l=i.getDatasetMeta(n).data;o=[];for(let u=0;u<l.length;++u)o.push({element:l[u],datasetIndex:n,index:u})}return o},point(i,t,e,s){const h=be(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;return vn(i,h,g,s,m)},nearest(i,t,e,s){const h=be(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;return _n(i,h,g,e.intersect,s,m)},x(i,t,e,s){const h=be(t,i);return Hs(i,h,"x",e.intersect,s)},y(i,t,e,s){const h=be(t,i);return Hs(i,h,"y",e.intersect,s)}}};const go=["left","top","right","bottom"];function Ne(i,t){return i.filter(e=>e.pos===t)}function Ns(i,t){return i.filter(e=>go.indexOf(e.pos)===-1&&e.box.axis===t)}function Ve(i,t){return i.sort((e,s)=>{const h=t?s:e,g=t?e:s;return h.weight===g.weight?h.index-g.index:h.weight-g.weight})}function _h(i){const t=[];let e,s,h,g,m,o;for(e=0,s=(i||[]).length;e<s;++e)h=i[e],{position:g,options:{stack:m,stackWeight:o=1}}=h,t.push({index:e,box:h,pos:g,horizontal:h.isHorizontal(),weight:h.weight,stack:m&&g+m,stackWeight:o});return t}function bh(i){const t={};for(const e of i){const{stack:s,pos:h,stackWeight:g}=e;if(!s||!go.includes(h))continue;const m=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});m.count++,m.weight+=g}return t}function yh(i,t){const e=bh(i),{vBoxMaxWidth:s,hBoxMaxHeight:h}=t;let g,m,o;for(g=0,m=i.length;g<m;++g){o=i[g];const{fullSize:n}=o.box,l=e[o.stack],u=l&&o.stackWeight/l.weight;o.horizontal?(o.width=u?u*s:n&&t.availableWidth,o.height=h):(o.width=s,o.height=u?u*h:n&&t.availableHeight)}return e}function xh(i){const t=_h(i),e=Ve(t.filter(l=>l.box.fullSize),!0),s=Ve(Ne(t,"left"),!0),h=Ve(Ne(t,"right")),g=Ve(Ne(t,"top"),!0),m=Ve(Ne(t,"bottom")),o=Ns(t,"x"),n=Ns(t,"y");return{fullSize:e,leftAndTop:s.concat(g),rightAndBottom:h.concat(n).concat(m).concat(o),chartArea:Ne(t,"chartArea"),vertical:s.concat(h).concat(n),horizontal:g.concat(m).concat(o)}}function Vs(i,t,e,s){return Math.max(i[e],t[e])+Math.max(i[s],t[s])}function po(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function Ch(i,t,e,s){const{pos:h,box:g}=e,m=i.maxPadding;if(!ht(h)){e.size&&(i[h]-=e.size);const r=s[e.stack]||{size:0,count:1};r.size=Math.max(r.size,e.horizontal?g.height:g.width),e.size=r.size/r.count,i[h]+=e.size}g.getPadding&&po(m,g.getPadding());const o=Math.max(0,t.outerWidth-Vs(m,i,"left","right")),n=Math.max(0,t.outerHeight-Vs(m,i,"top","bottom")),l=o!==i.w,u=n!==i.h;return i.w=o,i.h=n,e.horizontal?{same:l,other:u}:{same:u,other:l}}function Sh(i){const t=i.maxPadding;function e(s){const h=Math.max(t[s]-i[s],0);return i[s]+=h,h}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function wh(i,t){const e=t.maxPadding;function s(h){const g={left:0,top:0,right:0,bottom:0};return h.forEach(m=>{g[m]=Math.max(t[m],e[m])}),g}return s(i?["left","right"]:["top","bottom"])}function $e(i,t,e,s){const h=[];let g,m,o,n,l,u;for(g=0,m=i.length,l=0;g<m;++g){o=i[g],n=o.box,n.update(o.width||t.w,o.height||t.h,wh(o.horizontal,t));const{same:r,other:c}=Ch(t,e,o,s);l|=r&&h.length,u=u||c,n.fullSize||h.push(o)}return l&&$e(h,t,e,s)||u}function Pi(i,t,e,s,h){i.top=e,i.left=t,i.right=t+s,i.bottom=e+h,i.width=s,i.height=h}function Xs(i,t,e,s){const h=e.padding;let{x:g,y:m}=t;for(const o of i){const n=o.box,l=s[o.stack]||{count:1,placed:0,weight:1},u=o.stackWeight/l.weight||1;if(o.horizontal){const r=t.w*u,c=l.size||n.height;li(l.start)&&(m=l.start),n.fullSize?Pi(n,h.left,m,e.outerWidth-h.right-h.left,c):Pi(n,t.left+l.placed,m,r,c),l.start=m,l.placed+=r,m=n.bottom}else{const r=t.h*u,c=l.size||n.width;li(l.start)&&(g=l.start),n.fullSize?Pi(n,g,h.top,c,e.outerHeight-h.bottom-h.top):Pi(n,g,t.top+l.placed,c,r),l.start=g,l.placed+=r,g=n.right}}t.x=g,t.y=m}var Dt={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,s){if(!i)return;const h=At(i.options.layout.padding),g=Math.max(t-h.width,0),m=Math.max(e-h.height,0),o=xh(i.boxes),n=o.vertical,l=o.horizontal;dt(i.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const u=n.reduce((p,d)=>d.box.options&&d.box.options.display===!1?p:p+1,0)||1,r=Object.freeze({outerWidth:t,outerHeight:e,padding:h,availableWidth:g,availableHeight:m,vBoxMaxWidth:g/2/u,hBoxMaxHeight:m/2}),c=Object.assign({},h);po(c,At(s));const a=Object.assign({maxPadding:c,w:g,h:m,x:h.left,y:h.top},h),f=yh(n.concat(l),r);$e(o.fullSize,a,r,f),$e(n,a,r,f),$e(l,a,r,f)&&$e(n,a,r,f),Sh(a),Xs(o.leftAndTop,a,r,f),a.x+=a.w,a.y+=a.h,Xs(o.rightAndBottom,a,r,f),i.chartArea={left:a.left,top:a.top,right:a.left+a.w,bottom:a.top+a.h,height:a.h,width:a.w},dt(o.chartArea,p=>{const d=p.box;Object.assign(d,i.chartArea),d.update(a.w,a.h,{left:0,top:0,right:0,bottom:0})})}};class mo{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,h){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,h?Math.floor(e/h):s)}}isAttached(t){return!0}updateConfig(t){}}class Th extends mo{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Vi="$chartjs",Oh={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ys=i=>i===null||i==="";function kh(i,t){const e=i.style,s=i.getAttribute("height"),h=i.getAttribute("width");if(i[Vi]={initial:{height:s,width:h,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Ys(h)){const g=ks(i,"width");g!==void 0&&(i.width=g)}if(Ys(s))if(i.style.height==="")i.height=i.width/(t||2);else{const g=ks(i,"height");g!==void 0&&(i.height=g)}return i}const vo=Ml?{passive:!0}:!1;function Ph(i,t,e){i.addEventListener(t,e,vo)}function Mh(i,t,e){i.canvas.removeEventListener(t,e,vo)}function Dh(i,t){const e=Oh[i.type]||i.type,{x:s,y:h}=be(i,t);return{type:e,chart:t,native:i,x:s!==void 0?s:null,y:h!==void 0?h:null}}function Zi(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function Ah(i,t,e){const s=i.canvas,h=new MutationObserver(g=>{let m=!1;for(const o of g)m=m||Zi(o.addedNodes,s),m=m&&!Zi(o.removedNodes,s);m&&e()});return h.observe(document,{childList:!0,subtree:!0}),h}function Eh(i,t,e){const s=i.canvas,h=new MutationObserver(g=>{let m=!1;for(const o of g)m=m||Zi(o.removedNodes,s),m=m&&!Zi(o.addedNodes,s);m&&e()});return h.observe(document,{childList:!0,subtree:!0}),h}const ui=new Map;let Us=0;function _o(){const i=window.devicePixelRatio;i!==Us&&(Us=i,ui.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function Fh(i,t){ui.size||window.addEventListener("resize",_o),ui.set(i,t)}function Lh(i){ui.delete(i),ui.size||window.removeEventListener("resize",_o)}function Rh(i,t,e){const s=i.canvas,h=s&&es(s);if(!h)return;const g=Ur((o,n)=>{const l=h.clientWidth;e(o,n),l<h.clientWidth&&e()},window),m=new ResizeObserver(o=>{const n=o[0],l=n.contentRect.width,u=n.contentRect.height;l===0&&u===0||g(l,u)});return m.observe(h),Fh(i,g),m}function bn(i,t,e){e&&e.disconnect(),t==="resize"&&Lh(i)}function Ih(i,t,e){const s=i.canvas,h=Ur(g=>{i.ctx!==null&&e(Dh(g,i))},i);return Ph(s,t,h),h}class Bh extends mo{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(kh(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[Vi])return!1;const s=e[Vi].initial;["height","width"].forEach(g=>{const m=s[g];ut(m)?e.removeAttribute(g):e.setAttribute(g,m)});const h=s.style||{};return Object.keys(h).forEach(g=>{e.style[g]=h[g]}),e.width=e.width,delete e[Vi],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const h=t.$proxies||(t.$proxies={}),m={attach:Ah,detach:Eh,resize:Rh}[e]||Ih;h[e]=m(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),h=s[e];if(!h)return;({attach:bn,detach:bn,resize:bn}[e]||Mh)(t,e,h),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,h){return Pl(t,e,s,h)}isAttached(t){const e=es(t);return!!(e&&e.isConnected)}}function jh(i){return!so()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?Th:Bh}var Ii;let se=(Ii=class{constructor(){Z(this,"x");Z(this,"y");Z(this,"active",!1);Z(this,"options");Z(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return Be(this.x)&&Be(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const h={};return t.forEach(g=>{h[g]=s[g]&&s[g].active()?s[g]._to:this[g]}),h}},Z(Ii,"defaults",{}),Z(Ii,"defaultRoutes"),Ii);function zh(i,t){const e=i.options.ticks,s=Wh(i),h=Math.min(e.maxTicksLimit||s,s),g=e.major.enabled?Nh(t):[],m=g.length,o=g[0],n=g[m-1],l=[];if(m>h)return Vh(t,l,g,m/h),l;const u=Hh(g,t,h);if(m>0){let r,c;const a=m>1?Math.round((n-o)/(m-1)):null;for(Mi(t,l,u,ut(a)?0:o-a,o),r=0,c=m-1;r<c;r++)Mi(t,l,u,g[r],g[r+1]);return Mi(t,l,u,n,ut(a)?t.length:n+a),l}return Mi(t,l,u),l}function Wh(i){const t=i.options.offset,e=i._tickSize(),s=i._length/e+(t?0:1),h=i._maxLength/e;return Math.floor(Math.min(s,h))}function Hh(i,t,e){const s=Xh(i),h=t.length/e;if(!s)return Math.max(h,1);const g=Ea(s);for(let m=0,o=g.length-1;m<o;m++){const n=g[m];if(n>h)return n}return Math.max(h,1)}function Nh(i){const t=[];let e,s;for(e=0,s=i.length;e<s;e++)i[e].major&&t.push(e);return t}function Vh(i,t,e,s){let h=0,g=e[0],m;for(s=Math.ceil(s),m=0;m<i.length;m++)m===g&&(t.push(i[m]),h++,g=e[h*s])}function Mi(i,t,e,s,h){const g=lt(s,0),m=Math.min(lt(h,i.length),i.length);let o=0,n,l,u;for(e=Math.ceil(e),h&&(n=h-s,e=n/Math.floor(n/e)),u=g;u<0;)o++,u=Math.round(g+o*e);for(l=Math.max(g,0);l<m;l++)l===u&&(t.push(i[l]),o++,u=Math.round(g+o*e))}function Xh(i){const t=i.length;let e,s;if(t<2)return!1;for(s=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==s)return!1;return s}const Yh=i=>i==="left"?"right":i==="right"?"left":i,Gs=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,$s=(i,t)=>Math.min(t||i,i);function qs(i,t){const e=[],s=i.length/t,h=i.length;let g=0;for(;g<h;g+=s)e.push(i[Math.floor(g)]);return e}function Uh(i,t,e){const s=i.ticks.length,h=Math.min(t,s-1),g=i._startPixel,m=i._endPixel,o=1e-6;let n=i.getPixelForTick(h),l;if(!(e&&(s===1?l=Math.max(n-g,m-n):t===0?l=(i.getPixelForTick(1)-n)/2:l=(n-i.getPixelForTick(h-1))/2,n+=h<t?l:-l,n<g-o||n>m+o)))return n}function Gh(i,t){dt(i,e=>{const s=e.gc,h=s.length/2;let g;if(h>t){for(g=0;g<h;++g)delete e.data[s[g]];s.splice(0,h)}})}function Xe(i){return i.drawTicks?i.tickLength:0}function Ks(i,t){if(!i.display)return 0;const e=kt(i.font,t),s=At(i.padding);return(vt(i.text)?i.text.length:1)*e.lineHeight+s.height}function $h(i,t){return de(i,{scale:t,type:"scale"})}function qh(i,t,e){return de(i,{tick:e,index:t,type:"tick"})}function Kh(i,t,e){let s=qn(i);return(e&&t!=="right"||!e&&t==="right")&&(s=Yh(s)),s}function Jh(i,t,e,s){const{top:h,left:g,bottom:m,right:o,chart:n}=i,{chartArea:l,scales:u}=n;let r=0,c,a,f;const p=m-h,d=o-g;if(i.isHorizontal()){if(a=Mt(s,g,o),ht(e)){const v=Object.keys(e)[0],_=e[v];f=u[v].getPixelForValue(_)+p-t}else e==="center"?f=(l.bottom+l.top)/2+p-t:f=Gs(i,e,t);c=o-g}else{if(ht(e)){const v=Object.keys(e)[0],_=e[v];a=u[v].getPixelForValue(_)-d+t}else e==="center"?a=(l.left+l.right)/2-d+t:a=Gs(i,e,t);f=Mt(s,m,h),r=e==="left"?-Tt:Tt}return{titleX:a,titleY:f,maxWidth:c,rotation:r}}class Me extends se{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:h}=this;return t=Rt(t,Number.POSITIVE_INFINITY),e=Rt(e,Number.NEGATIVE_INFINITY),s=Rt(s,Number.POSITIVE_INFINITY),h=Rt(h,Number.NEGATIVE_INFINITY),{min:Rt(t,s),max:Rt(e,h),minDefined:St(t),maxDefined:St(e)}}getMinMax(t){let{min:e,max:s,minDefined:h,maxDefined:g}=this.getUserBounds(),m;if(h&&g)return{min:e,max:s};const o=this.getMatchingVisibleMetas();for(let n=0,l=o.length;n<l;++n)m=o[n].controller.getMinMax(this,t),h||(e=Math.min(e,m.min)),g||(s=Math.max(s,m.max));return e=g&&e>s?s:e,s=h&&e>s?e:s,{min:Rt(e,Rt(s,e)),max:Rt(s,Rt(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){gt(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:h,grace:g,ticks:m}=this.options,o=m.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=ol(this,g,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const n=o<this.ticks.length;this._convertTicksToLabels(n?qs(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),m.display&&(m.autoSkip||m.source==="auto")&&(this.ticks=zh(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),n&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){gt(this.options.afterUpdate,[this])}beforeSetDimensions(){gt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){gt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),gt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){gt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,h,g;for(s=0,h=t.length;s<h;s++)g=t[s],g.label=gt(e.callback,[g.value,s,t],this)}afterTickToLabelConversion(){gt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){gt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=$s(this.ticks.length,t.ticks.maxTicksLimit),h=e.minRotation||0,g=e.maxRotation;let m=h,o,n,l;if(!this._isVisible()||!e.display||h>=g||s<=1||!this.isHorizontal()){this.labelRotation=h;return}const u=this._getLabelSizes(),r=u.widest.width,c=u.highest.height,a=Pt(this.chart.width-r,0,this.maxWidth);o=t.offset?this.maxWidth/s:a/(s-1),r+6>o&&(o=a/(s-(t.offset?.5:1)),n=this.maxHeight-Xe(t.grid)-e.padding-Ks(t.title,this.chart.options.font),l=Math.sqrt(r*r+c*c),m=Gn(Math.min(Math.asin(Pt((u.highest.height+6)/o,-1,1)),Math.asin(Pt(n/l,-1,1))-Math.asin(Pt(c/l,-1,1)))),m=Math.max(h,Math.min(g,m))),this.labelRotation=m}afterCalculateLabelRotation(){gt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){gt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:h,grid:g}}=this,m=this._isVisible(),o=this.isHorizontal();if(m){const n=Ks(h,e.options.font);if(o?(t.width=this.maxWidth,t.height=Xe(g)+n):(t.height=this.maxHeight,t.width=Xe(g)+n),s.display&&this.ticks.length){const{first:l,last:u,widest:r,highest:c}=this._getLabelSizes(),a=s.padding*2,f=Vt(this.labelRotation),p=Math.cos(f),d=Math.sin(f);if(o){const v=s.mirror?0:d*r.width+p*c.height;t.height=Math.min(this.maxHeight,t.height+v+a)}else{const v=s.mirror?0:p*r.width+d*c.height;t.width=Math.min(this.maxWidth,t.width+v+a)}this._calculatePadding(l,u,d,p)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,h){const{ticks:{align:g,padding:m},position:o}=this.options,n=this.labelRotation!==0,l=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,r=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,a=0;n?l?(c=h*t.width,a=s*e.height):(c=s*t.height,a=h*e.width):g==="start"?a=e.width:g==="end"?c=t.width:g!=="inner"&&(c=t.width/2,a=e.width/2),this.paddingLeft=Math.max((c-u+m)*this.width/(this.width-u),0),this.paddingRight=Math.max((a-r+m)*this.width/(this.width-r),0)}else{let u=e.height/2,r=t.height/2;g==="start"?(u=0,r=t.height):g==="end"&&(u=e.height,r=0),this.paddingTop=u+m,this.paddingBottom=r+m}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){gt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)ut(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=qs(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:h,_longestTextCache:g}=this,m=[],o=[],n=Math.floor(e/$s(e,s));let l=0,u=0,r,c,a,f,p,d,v,_,b,y,x;for(r=0;r<e;r+=n){if(f=t[r].label,p=this._resolveTickFontOptions(r),h.font=d=p.string,v=g[d]=g[d]||{data:{},gc:[]},_=p.lineHeight,b=y=0,!ut(f)&&!vt(f))b=Ji(h,v.data,v.gc,b,f),y=_;else if(vt(f))for(c=0,a=f.length;c<a;++c)x=f[c],!ut(x)&&!vt(x)&&(b=Ji(h,v.data,v.gc,b,x),y+=_);m.push(b),o.push(y),l=Math.max(b,l),u=Math.max(y,u)}Gh(g,e);const C=m.indexOf(l),S=o.indexOf(u),O=E=>({width:m[E]||0,height:o[E]||0});return{first:O(0),last:O(e-1),widest:O(C),highest:O(S),widths:m,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Ra(this._alignToPixels?me(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=qh(this.getContext(),t,s))}return this.$context||(this.$context=$h(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Vt(this.labelRotation),s=Math.abs(Math.cos(e)),h=Math.abs(Math.sin(e)),g=this._getLabelSizes(),m=t.autoSkipPadding||0,o=g?g.widest.width+m:0,n=g?g.highest.height+m:0;return this.isHorizontal()?n*s>o*h?o/s:n/h:n*h<o*s?n/s:o/h}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,h=this.options,{grid:g,position:m,border:o}=h,n=g.offset,l=this.isHorizontal(),r=this.ticks.length+(n?1:0),c=Xe(g),a=[],f=o.setContext(this.getContext()),p=f.display?f.width:0,d=p/2,v=function(K){return me(s,K,p)};let _,b,y,x,C,S,O,E,R,W,X,Q;if(m==="top")_=v(this.bottom),S=this.bottom-c,E=_-d,W=v(t.top)+d,Q=t.bottom;else if(m==="bottom")_=v(this.top),W=t.top,Q=v(t.bottom)-d,S=_+d,E=this.top+c;else if(m==="left")_=v(this.right),C=this.right-c,O=_-d,R=v(t.left)+d,X=t.right;else if(m==="right")_=v(this.left),R=t.left,X=v(t.right)-d,C=_+d,O=this.left+c;else if(e==="x"){if(m==="center")_=v((t.top+t.bottom)/2+.5);else if(ht(m)){const K=Object.keys(m)[0],tt=m[K];_=v(this.chart.scales[K].getPixelForValue(tt))}W=t.top,Q=t.bottom,S=_+d,E=S+c}else if(e==="y"){if(m==="center")_=v((t.left+t.right)/2);else if(ht(m)){const K=Object.keys(m)[0],tt=m[K];_=v(this.chart.scales[K].getPixelForValue(tt))}C=_-d,O=C-c,R=t.left,X=t.right}const $=lt(h.ticks.maxTicksLimit,r),B=Math.max(1,Math.ceil(r/$));for(b=0;b<r;b+=B){const K=this.getContext(b),tt=g.setContext(K),nt=o.setContext(K),w=tt.lineWidth,M=tt.color,D=nt.dash||[],P=nt.dashOffset,I=tt.tickWidth,k=tt.tickColor,T=tt.tickBorderDash||[],A=tt.tickBorderDashOffset;y=Uh(this,b,n),y!==void 0&&(x=me(s,y,w),l?C=O=R=X=x:S=E=W=Q=x,a.push({tx1:C,ty1:S,tx2:O,ty2:E,x1:R,y1:W,x2:X,y2:Q,width:w,color:M,borderDash:D,borderDashOffset:P,tickWidth:I,tickColor:k,tickBorderDash:T,tickBorderDashOffset:A}))}return this._ticksLength=r,this._borderValue=_,a}_computeLabelItems(t){const e=this.axis,s=this.options,{position:h,ticks:g}=s,m=this.isHorizontal(),o=this.ticks,{align:n,crossAlign:l,padding:u,mirror:r}=g,c=Xe(s.grid),a=c+u,f=r?-u:a,p=-Vt(this.labelRotation),d=[];let v,_,b,y,x,C,S,O,E,R,W,X,Q="middle";if(h==="top")C=this.bottom-f,S=this._getXAxisLabelAlignment();else if(h==="bottom")C=this.top+f,S=this._getXAxisLabelAlignment();else if(h==="left"){const B=this._getYAxisLabelAlignment(c);S=B.textAlign,x=B.x}else if(h==="right"){const B=this._getYAxisLabelAlignment(c);S=B.textAlign,x=B.x}else if(e==="x"){if(h==="center")C=(t.top+t.bottom)/2+a;else if(ht(h)){const B=Object.keys(h)[0],K=h[B];C=this.chart.scales[B].getPixelForValue(K)+a}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(h==="center")x=(t.left+t.right)/2-a;else if(ht(h)){const B=Object.keys(h)[0],K=h[B];x=this.chart.scales[B].getPixelForValue(K)}S=this._getYAxisLabelAlignment(c).textAlign}e==="y"&&(n==="start"?Q="top":n==="end"&&(Q="bottom"));const $=this._getLabelSizes();for(v=0,_=o.length;v<_;++v){b=o[v],y=b.label;const B=g.setContext(this.getContext(v));O=this.getPixelForTick(v)+g.labelOffset,E=this._resolveTickFontOptions(v),R=E.lineHeight,W=vt(y)?y.length:1;const K=W/2,tt=B.color,nt=B.textStrokeColor,w=B.textStrokeWidth;let M=S;m?(x=O,S==="inner"&&(v===_-1?M=this.options.reverse?"left":"right":v===0?M=this.options.reverse?"right":"left":M="center"),h==="top"?l==="near"||p!==0?X=-W*R+R/2:l==="center"?X=-$.highest.height/2-K*R+R:X=-$.highest.height+R/2:l==="near"||p!==0?X=R/2:l==="center"?X=$.highest.height/2-K*R:X=$.highest.height-W*R,r&&(X*=-1),p!==0&&!B.showLabelBackdrop&&(x+=R/2*Math.sin(p))):(C=O,X=(1-W)*R/2);let D;if(B.showLabelBackdrop){const P=At(B.backdropPadding),I=$.heights[v],k=$.widths[v];let T=X-P.top,A=0-P.left;switch(Q){case"middle":T-=I/2;break;case"bottom":T-=I;break}switch(S){case"center":A-=k/2;break;case"right":A-=k;break}D={left:A,top:T,width:k+P.width,height:I+P.height,color:B.backdropColor}}d.push({label:y,font:E,textOffset:X,options:{rotation:p,color:tt,strokeColor:nt,strokeWidth:w,textAlign:M,textBaseline:Q,translation:[x,C],backdrop:D}})}return d}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Vt(this.labelRotation))return t==="top"?"left":"right";let h="center";return e.align==="start"?h="left":e.align==="end"?h="right":e.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:h,padding:g}}=this.options,m=this._getLabelSizes(),o=t+g,n=m.widest.width;let l,u;return e==="left"?h?(u=this.right+g,s==="near"?l="left":s==="center"?(l="center",u+=n/2):(l="right",u+=n)):(u=this.right-o,s==="near"?l="right":s==="center"?(l="center",u-=n/2):(l="left",u=this.left)):e==="right"?h?(u=this.left+g,s==="near"?l="right":s==="center"?(l="center",u-=n/2):(l="left",u-=n)):(u=this.left+o,s==="near"?l="left":s==="center"?(l="center",u+=n/2):(l="right",u=this.right)):l="right",{textAlign:l,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:h,width:g,height:m}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,h,g,m),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const h=this.ticks.findIndex(g=>g.value===t);return h>=0?e.setContext(this.getContext(h)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let g,m;const o=(n,l,u)=>{!u.width||!u.color||(s.save(),s.lineWidth=u.width,s.strokeStyle=u.color,s.setLineDash(u.borderDash||[]),s.lineDashOffset=u.borderDashOffset,s.beginPath(),s.moveTo(n.x,n.y),s.lineTo(l.x,l.y),s.stroke(),s.restore())};if(e.display)for(g=0,m=h.length;g<m;++g){const n=h[g];e.drawOnChartArea&&o({x:n.x1,y:n.y1},{x:n.x2,y:n.y2},n),e.drawTicks&&o({x:n.tx1,y:n.ty1},{x:n.tx2,y:n.ty2},{color:n.tickColor,width:n.tickWidth,borderDash:n.tickBorderDash,borderDashOffset:n.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:h}}=this,g=s.setContext(this.getContext()),m=s.display?g.width:0;if(!m)return;const o=h.setContext(this.getContext(0)).lineWidth,n=this._borderValue;let l,u,r,c;this.isHorizontal()?(l=me(t,this.left,m)-m/2,u=me(t,this.right,o)+o/2,r=c=n):(r=me(t,this.top,m)-m/2,c=me(t,this.bottom,o)+o/2,l=u=n),e.save(),e.lineWidth=g.width,e.strokeStyle=g.color,e.beginPath(),e.moveTo(l,r),e.lineTo(u,c),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,h=this._computeLabelArea();h&&rn(s,h);const g=this.getLabelItems(t);for(const m of g){const o=m.options,n=m.font,l=m.label,u=m.textOffset;ke(s,l,0,u,n,o)}h&&on(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:h}}=this;if(!s.display)return;const g=kt(s.font),m=At(s.padding),o=s.align;let n=g.lineHeight/2;e==="bottom"||e==="center"||ht(e)?(n+=m.bottom,vt(s.text)&&(n+=g.lineHeight*(s.text.length-1))):n+=m.top;const{titleX:l,titleY:u,maxWidth:r,rotation:c}=Jh(this,n,e,o);ke(t,s.text,0,0,g,{color:s.color,maxWidth:r,rotation:c,textAlign:Kh(o,e,h),textBaseline:"middle",translation:[l,u]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=lt(t.grid&&t.grid.z,-1),h=lt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Me.prototype.draw?[{z:e,draw:g=>{this.draw(g)}}]:[{z:s,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:e,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",h=[];let g,m;for(g=0,m=e.length;g<m;++g){const o=e[g];o[s]===this.id&&(!t||o.type===t)&&h.push(o)}return h}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return kt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Di{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;tc(e)&&(s=this.register(e));const h=this.items,g=t.id,m=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+t);return g in h||(h[g]=t,Qh(t,m,s),this.override&&wt.override(t.id,t.overrides)),m}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,h=this.scope;s in e&&delete e[s],h&&s in wt[h]&&(delete wt[h][s],this.override&&delete Oe[s])}}function Qh(i,t,e){const s=ai(Object.create(null),[e?wt.get(e):{},wt.get(t),i.defaults]);wt.set(t,s),i.defaultRoutes&&Zh(t,i.defaultRoutes),i.descriptors&&wt.describe(t,i.descriptors)}function Zh(i,t){Object.keys(t).forEach(e=>{const s=e.split("."),h=s.pop(),g=[i].concat(s).join("."),m=t[e].split("."),o=m.pop(),n=m.join(".");wt.route(g,h,n,o)})}function tc(i){return"id"in i&&"defaults"in i}class ec{constructor(){this.controllers=new Di(Xt,"datasets",!0),this.elements=new Di(se,"elements"),this.plugins=new Di(Object,"plugins"),this.scales=new Di(Me,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(h=>{const g=s||this._getRegistryForType(h);s||g.isForType(h)||g===this.plugins&&h.id?this._exec(t,g,h):dt(h,m=>{const o=s||this._getRegistryForType(m);this._exec(t,o,m)})})}_exec(t,e,s){const h=Un(t);gt(s["before"+h],[],s),e[t](s),gt(s["after"+h],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const h=e.get(t);if(h===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return h}}var Gt=new ec;class ic{constructor(){this._init=[]}notify(t,e,s,h){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const g=h?this._descriptors(t).filter(h):this._descriptors(t),m=this._notify(g,t,e,s);return e==="afterDestroy"&&(this._notify(g,t,"stop"),this._notify(this._init,t,"uninstall")),m}_notify(t,e,s,h){h=h||{};for(const g of t){const m=g.plugin,o=m[s],n=[e,h,g.options];if(gt(o,n,m)===!1&&h.cancelable)return!1}return!0}invalidate(){ut(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,h=lt(s.options&&s.options.plugins,{}),g=nc(s);return h===!1&&!e?[]:rc(t,g,h,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,h=(g,m)=>g.filter(o=>!m.some(n=>o.plugin.id===n.plugin.id));this._notify(h(e,s),t,"stop"),this._notify(h(s,e),t,"start")}}function nc(i){const t={},e=[],s=Object.keys(Gt.plugins.items);for(let g=0;g<s.length;g++)e.push(Gt.getPlugin(s[g]));const h=i.plugins||[];for(let g=0;g<h.length;g++){const m=h[g];e.indexOf(m)===-1&&(e.push(m),t[m.id]=!0)}return{plugins:e,localIds:t}}function sc(i,t){return!t&&i===!1?null:i===!0?{}:i}function rc(i,{plugins:t,localIds:e},s,h){const g=[],m=i.getContext();for(const o of t){const n=o.id,l=sc(s[n],h);l!==null&&g.push({plugin:o,options:oc(i.config,{plugin:o,local:e[n]},l,m)})}return g}function oc(i,{plugin:t,local:e},s,h){const g=i.pluginScopeKeys(t),m=i.getOptionScopes(s,g);return e&&t.defaults&&m.push(t.defaults),i.createResolver(m,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Dn(i,t){const e=wt.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function ac(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function lc(i,t){return i===t?"_index_":"_value_"}function Js(i){if(i==="x"||i==="y"||i==="r")return i}function hc(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function An(i,...t){if(Js(i))return i;for(const e of t){const s=e.axis||hc(e.position)||i.length>1&&Js(i[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function Qs(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function cc(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===i||s.yAxisID===i);if(e.length)return Qs(i,"x",e[0])||Qs(i,"y",e[0])}return{}}function uc(i,t){const e=Oe[i.type]||{scales:{}},s=t.scales||{},h=Dn(i.type,t),g=Object.create(null);return Object.keys(s).forEach(m=>{const o=s[m];if(!ht(o))return console.error(`Invalid scale configuration for scale: ${m}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${m}`);const n=An(m,o,cc(m,i),wt.scales[o.type]),l=lc(n,h),u=e.scales||{};g[m]=Ze(Object.create(null),[{axis:n},o,u[n],u[l]])}),i.data.datasets.forEach(m=>{const o=m.type||i.type,n=m.indexAxis||Dn(o,t),u=(Oe[o]||{}).scales||{};Object.keys(u).forEach(r=>{const c=ac(r,n),a=m[c+"AxisID"]||c;g[a]=g[a]||Object.create(null),Ze(g[a],[{axis:c},s[a],u[r]])})}),Object.keys(g).forEach(m=>{const o=g[m];Ze(o,[wt.scales[o.type],wt.scale])}),g}function bo(i){const t=i.options||(i.options={});t.plugins=lt(t.plugins,{}),t.scales=uc(i,t)}function yo(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function fc(i){return i=i||{},i.data=yo(i.data),bo(i),i}const Zs=new Map,xo=new Set;function Ai(i,t){let e=Zs.get(i);return e||(e=t(),Zs.set(i,e),xo.add(e)),e}const Ye=(i,t,e)=>{const s=ue(t,e);s!==void 0&&i.add(s)};class dc{constructor(t){this._config=fc(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=yo(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),bo(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ai(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Ai(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Ai(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return Ai(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let h=s.get(t);return(!h||e)&&(h=new Map,s.set(t,h)),h}getOptionScopes(t,e,s){const{options:h,type:g}=this,m=this._cachedScopes(t,s),o=m.get(e);if(o)return o;const n=new Set;e.forEach(u=>{t&&(n.add(t),u.forEach(r=>Ye(n,t,r))),u.forEach(r=>Ye(n,h,r)),u.forEach(r=>Ye(n,Oe[g]||{},r)),u.forEach(r=>Ye(n,wt,r)),u.forEach(r=>Ye(n,kn,r))});const l=Array.from(n);return l.length===0&&l.push(Object.create(null)),xo.has(e)&&m.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,Oe[e]||{},wt.datasets[e]||{},{type:e},wt,kn]}resolveNamedOptions(t,e,s,h=[""]){const g={$shared:!0},{resolver:m,subPrefixes:o}=tr(this._resolverCache,t,h);let n=m;if(pc(m,e)){g.$shared=!1,s=fe(s)?s():s;const l=this.createResolver(t,s,o);n=je(m,s,l)}for(const l of e)g[l]=n[l];return g}createResolver(t,e,s=[""],h){const{resolver:g}=tr(this._resolverCache,t,s);return ht(e)?je(g,e,void 0,h):g}}function tr(i,t,e){let s=i.get(t);s||(s=new Map,i.set(t,s));const h=e.join();let g=s.get(h);return g||(g={resolver:Qn(t,e),subPrefixes:e.filter(o=>!o.toLowerCase().includes("hover"))},s.set(h,g)),g}const gc=i=>ht(i)&&Object.getOwnPropertyNames(i).reduce((t,e)=>t||fe(i[e]),!1);function pc(i,t){const{isScriptable:e,isIndexable:s}=Qr(i);for(const h of t){const g=e(h),m=s(h),o=(m||g)&&i[h];if(g&&(fe(o)||gc(o))||m&&vt(o))return!0}return!1}var mc="4.4.0";const vc=["top","bottom","left","right","chartArea"];function er(i,t){return i==="top"||i==="bottom"||vc.indexOf(i)===-1&&t==="x"}function ir(i,t){return function(e,s){return e[i]===s[i]?e[t]-s[t]:e[i]-s[i]}}function nr(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),gt(e&&e.onComplete,[i],t)}function _c(i){const t=i.chart,e=t.options.animation;gt(e&&e.onProgress,[i],t)}function Co(i){return so()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const Xi={},sr=i=>{const t=Co(i);return Object.values(Xi).filter(e=>e.canvas===t).pop()};function bc(i,t,e){const s=Object.keys(i);for(const h of s){const g=+h;if(g>=t){const m=i[h];delete i[h],(e>0||g>t)&&(i[g+e]=m)}}}function yc(i,t,e,s){return!e||i.type==="mouseout"?null:s?t:i}function Ei(i,t,e){return i.options.clip?i[e]:t[e]}function xc(i,t){const{xScale:e,yScale:s}=i;return e&&s?{left:Ei(e,t,"left"),right:Ei(e,t,"right"),top:Ei(s,t,"top"),bottom:Ei(s,t,"bottom")}:t}class te{static register(...t){Gt.add(...t),rr()}static unregister(...t){Gt.remove(...t),rr()}constructor(t,e){const s=this.config=new dc(e),h=Co(t),g=sr(h);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const m=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||jh(h)),this.platform.updateConfig(s);const o=this.platform.acquireContext(h,m.aspectRatio),n=o&&o.canvas,l=n&&n.height,u=n&&n.width;if(this.id=Sa(),this.ctx=o,this.canvas=n,this.width=u,this.height=l,this._options=m,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ic,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=za(r=>this.update(r),m.resizeDelay||0),this._dataChanges=[],Xi[this.id]=this,!o||!n){console.error("Failed to create chart: can't acquire context from the given item");return}Jt.listen(this,"complete",nr),Jt.listen(this,"progress",_c),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:h,_aspectRatio:g}=this;return ut(t)?e&&g?g:h?s/h:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Gt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Os(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Ss(this.canvas,this.ctx),this}stop(){return Jt.stop(this),this}resize(t,e){Jt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,h=this.canvas,g=s.maintainAspectRatio&&this.aspectRatio,m=this.platform.getMaximumSize(h,t,e,g),o=s.devicePixelRatio||this.platform.getDevicePixelRatio(),n=this.width?"resize":"attach";this.width=m.width,this.height=m.height,this._aspectRatio=this.aspectRatio,Os(this,o,!0)&&(this.notifyPlugins("resize",{size:m}),gt(s.onResize,[this,m],this),this.attached&&this._doResize(n)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};dt(e,(s,h)=>{s.id=h})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,h=Object.keys(s).reduce((m,o)=>(m[o]=!1,m),{});let g=[];e&&(g=g.concat(Object.keys(e).map(m=>{const o=e[m],n=An(m,o),l=n==="r",u=n==="x";return{options:o,dposition:l?"chartArea":u?"bottom":"left",dtype:l?"radialLinear":u?"category":"linear"}}))),dt(g,m=>{const o=m.options,n=o.id,l=An(n,o),u=lt(o.type,m.dtype);(o.position===void 0||er(o.position,l)!==er(m.dposition))&&(o.position=m.dposition),h[n]=!0;let r=null;if(n in s&&s[n].type===u)r=s[n];else{const c=Gt.getScale(u);r=new c({id:n,type:u,ctx:this.ctx,chart:this}),s[r.id]=r}r.init(o,t)}),dt(h,(m,o)=>{m||delete s[o]}),dt(s,m=>{Dt.configure(this,m,m.options),Dt.addBox(this,m)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((h,g)=>h.index-g.index),s>e){for(let h=e;h<s;++h)this._destroyDatasetMeta(h);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(ir("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,h)=>{e.filter(g=>g===s._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,h;for(this._removeUnreferencedMetasets(),s=0,h=e.length;s<h;s++){const g=e[s];let m=this.getDatasetMeta(s);const o=g.type||this.config.type;if(m.type&&m.type!==o&&(this._destroyDatasetMeta(s),m=this.getDatasetMeta(s)),m.type=o,m.indexAxis=g.indexAxis||Dn(o,this.options),m.order=g.order||0,m.index=s,m.label=""+g.label,m.visible=this.isDatasetVisible(s),m.controller)m.controller.updateIndex(s),m.controller.linkScales();else{const n=Gt.getController(o),{datasetElementType:l,dataElementType:u}=wt.datasets[o];Object.assign(n,{dataElementType:Gt.getElement(u),datasetElementType:l&&Gt.getElement(l)}),m.controller=new n(this,s),t.push(m.controller)}}return this._updateMetasets(),t}_resetElements(){dt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let m=0;for(let l=0,u=this.data.datasets.length;l<u;l++){const{controller:r}=this.getDatasetMeta(l),c=!h&&g.indexOf(r)===-1;r.buildOrUpdateElements(c),m=Math.max(+r.getMaxOverflow(),m)}m=this._minPadding=s.layout.autoPadding?m:0,this._updateLayout(m),h||dt(g,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(ir("z","_idx"));const{_active:o,_lastEvent:n}=this;n?this._eventHandler(n,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){dt(this.scales,t=>{Dt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!gs(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:h,count:g}of e){const m=s==="_removeElements"?-g:g;bc(t,h,m)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=g=>new Set(t.filter(m=>m[0]===g).map((m,o)=>o+","+m.splice(1).join(","))),h=s(0);for(let g=1;g<e;g++)if(!gs(h,s(g)))return;return Array.from(h).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Dt.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],dt(this.boxes,h=>{s&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,g)=>{h._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,fe(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),h={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(s.controller._update(e),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Jt.has(this)?this.attached&&!Jt.running(this)&&Jt.start(this):(this.draw(),nr({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:h}=this._resizeBeforeDraw;this._resize(s,h),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let h,g;for(h=0,g=e.length;h<g;++h){const m=e[h];(!t||m.visible)&&s.push(m)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s=t._clip,h=!s.disabled,g=xc(t,this.chartArea),m={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",m)!==!1&&(h&&rn(e,{left:s.left===!1?0:g.left-s.left,right:s.right===!1?this.width:g.right+s.right,top:s.top===!1?0:g.top-s.top,bottom:s.bottom===!1?this.height:g.bottom+s.bottom}),t.controller.draw(),h&&on(e),m.cancelable=!1,this.notifyPlugins("afterDatasetDraw",m))}isPointInArea(t){return ne(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,h){const g=vh.modes[e];return typeof g=="function"?g(this,t,s,h):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let h=s.filter(g=>g&&g._dataset===e).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(h)),h}getContext(){return this.$context||(this.$context=de(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const h=s?"show":"hide",g=this.getDatasetMeta(t),m=g.controller._resolveAnimations(void 0,h);li(e)?(g.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),m.update(g,{visible:s}),this.update(o=>o.datasetIndex===t?h:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Jt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Ss(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Xi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(g,m)=>{e.addEventListener(this,g,m),t[g]=m},h=(g,m,o)=>{g.offsetX=m,g.offsetY=o,this._eventHandler(g)};dt(this.options.events,g=>s(g,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(n,l)=>{e.addEventListener(this,n,l),t[n]=l},h=(n,l)=>{t[n]&&(e.removeEventListener(this,n,l),delete t[n])},g=(n,l)=>{this.canvas&&this.resize(n,l)};let m;const o=()=>{h("attach",o),this.attached=!0,this.resize(),s("resize",g),s("detach",m)};m=()=>{this.attached=!1,h("resize",g),this._stop(),this._resize(0,0),s("attach",o)},e.isAttached(this.canvas)?o():m()}unbindEvents(){dt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},dt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const h=s?"set":"remove";let g,m,o,n;for(e==="dataset"&&(g=this.getDatasetMeta(t[0].datasetIndex),g.controller["_"+h+"DatasetHoverStyle"]()),o=0,n=t.length;o<n;++o){m=t[o];const l=m&&this.getDatasetMeta(m.datasetIndex).controller;l&&l[h+"HoverStyle"](m.element,m.datasetIndex,m.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:g,index:m})=>{const o=this.getDatasetMeta(g);if(!o)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:o.data[m],index:m}});!$i(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const h=this.options.hover,g=(n,l)=>n.filter(u=>!l.some(r=>u.datasetIndex===r.datasetIndex&&u.index===r.index)),m=g(e,t),o=s?t:g(t,e);m.length&&this.updateHoverStyle(m,h.mode,!1),o.length&&h.mode&&this.updateHoverStyle(o,h.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},h=m=>(m.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,h)===!1)return;const g=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,h),(g||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:h=[],options:g}=this,m=e,o=this._getActiveElements(t,h,s,m),n=Ma(t),l=yc(t,this._lastEvent,s,n);s&&(this._lastEvent=null,gt(g.onHover,[t,o,this],this),n&&gt(g.onClick,[t,o,this],this));const u=!$i(o,h);return(u||e)&&(this._active=o,this._updateHoverStyles(o,h,e)),this._lastEvent=l,u}_getActiveElements(t,e,s,h){if(t.type==="mouseout")return[];if(!s)return e;const g=this.options.hover;return this.getElementsAtEventForMode(t,g.mode,g,h)}}Z(te,"defaults",wt),Z(te,"instances",Xi),Z(te,"overrides",Oe),Z(te,"registry",Gt),Z(te,"version",mc),Z(te,"getChart",sr);function rr(){return dt(te.instances,i=>i._plugins.invalidate())}function Cc(i,t,e){const{startAngle:s,pixelMargin:h,x:g,y:m,outerRadius:o,innerRadius:n}=t;let l=h/o;i.beginPath(),i.arc(g,m,o,s-l,e+l),n>h?(l=h/n,i.arc(g,m,n,e+l,s-l,!0)):i.arc(g,m,h,e+Tt,s-Tt),i.closePath(),i.clip()}function Sc(i){return Jn(i,["outerStart","outerEnd","innerStart","innerEnd"])}function wc(i,t,e,s){const h=Sc(i.options.borderRadius),g=(e-t)/2,m=Math.min(g,s*t/2),o=n=>{const l=(e-Math.min(g,n))*s/2;return Pt(n,0,Math.min(g,l))};return{outerStart:o(h.outerStart),outerEnd:o(h.outerEnd),innerStart:Pt(h.innerStart,0,m),innerEnd:Pt(h.innerEnd,0,m)}}function Ee(i,t,e,s){return{x:e+i*Math.cos(t),y:s+i*Math.sin(t)}}function tn(i,t,e,s,h,g){const{x:m,y:o,startAngle:n,pixelMargin:l,innerRadius:u}=t,r=Math.max(t.outerRadius+s+e-l,0),c=u>0?u+s+e+l:0;let a=0;const f=h-n;if(s){const B=u>0?u-s:0,K=r>0?r-s:0,tt=(B+K)/2,nt=tt!==0?f*tt/(tt+s):f;a=(f-nt)/2}const p=Math.max(.001,f*r-e/bt)/r,d=(f-p)/2,v=n+d+a,_=h-d-a,{outerStart:b,outerEnd:y,innerStart:x,innerEnd:C}=wc(t,c,r,_-v),S=r-b,O=r-y,E=v+b/S,R=_-y/O,W=c+x,X=c+C,Q=v+x/W,$=_-C/X;if(i.beginPath(),g){const B=(E+R)/2;if(i.arc(m,o,r,E,B),i.arc(m,o,r,B,R),y>0){const w=Ee(O,R,m,o);i.arc(w.x,w.y,y,R,_+Tt)}const K=Ee(X,_,m,o);if(i.lineTo(K.x,K.y),C>0){const w=Ee(X,$,m,o);i.arc(w.x,w.y,C,_+Tt,$+Math.PI)}const tt=(_-C/c+(v+x/c))/2;if(i.arc(m,o,c,_-C/c,tt,!0),i.arc(m,o,c,tt,v+x/c,!0),x>0){const w=Ee(W,Q,m,o);i.arc(w.x,w.y,x,Q+Math.PI,v-Tt)}const nt=Ee(S,v,m,o);if(i.lineTo(nt.x,nt.y),b>0){const w=Ee(S,E,m,o);i.arc(w.x,w.y,b,v-Tt,E)}}else{i.moveTo(m,o);const B=Math.cos(E)*r+m,K=Math.sin(E)*r+o;i.lineTo(B,K);const tt=Math.cos(R)*r+m,nt=Math.sin(R)*r+o;i.lineTo(tt,nt)}i.closePath()}function Tc(i,t,e,s,h){const{fullCircles:g,startAngle:m,circumference:o}=t;let n=t.endAngle;if(g){tn(i,t,e,s,n,h);for(let l=0;l<g;++l)i.fill();isNaN(o)||(n=m+(o%_t||_t))}return tn(i,t,e,s,n,h),i.fill(),n}function Oc(i,t,e,s,h){const{fullCircles:g,startAngle:m,circumference:o,options:n}=t,{borderWidth:l,borderJoinStyle:u,borderDash:r,borderDashOffset:c}=n,a=n.borderAlign==="inner";if(!l)return;i.setLineDash(r||[]),i.lineDashOffset=c,a?(i.lineWidth=l*2,i.lineJoin=u||"round"):(i.lineWidth=l,i.lineJoin=u||"bevel");let f=t.endAngle;if(g){tn(i,t,e,s,f,h);for(let p=0;p<g;++p)i.stroke();isNaN(o)||(f=m+(o%_t||_t))}a&&Cc(i,t,f),g||(tn(i,t,e,s,f,h),i.stroke())}class qe extends se{constructor(e){super();Z(this,"circumference");Z(this,"endAngle");Z(this,"fullCircles");Z(this,"innerRadius");Z(this,"outerRadius");Z(this,"pixelMargin");Z(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,h){const g=this.getProps(["x","y"],h),{angle:m,distance:o}=Nr(g,{x:e,y:s}),{startAngle:n,endAngle:l,innerRadius:u,outerRadius:r,circumference:c}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),a=(this.options.spacing+this.options.borderWidth)/2,p=lt(c,l-n)>=_t||hi(m,n,l),d=ee(o,u+a,r+a);return p&&d}getCenterPoint(e){const{x:s,y:h,startAngle:g,endAngle:m,innerRadius:o,outerRadius:n}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:l,spacing:u}=this.options,r=(g+m)/2,c=(o+n+u+l)/2;return{x:s+Math.cos(r)*c,y:h+Math.sin(r)*c}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:h}=this,g=(s.offset||0)/4,m=(s.spacing||0)/2,o=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=h>_t?Math.floor(h/_t):0,h===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const n=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(n)*g,Math.sin(n)*g);const l=1-Math.sin(Math.min(bt,h||0)),u=g*l;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,Tc(e,this,u,m,o),Oc(e,this,u,m,o),e.restore()}}Z(qe,"id","arc"),Z(qe,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),Z(qe,"defaultRoutes",{backgroundColor:"backgroundColor"}),Z(qe,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function So(i,t,e=t){i.lineCap=lt(e.borderCapStyle,t.borderCapStyle),i.setLineDash(lt(e.borderDash,t.borderDash)),i.lineDashOffset=lt(e.borderDashOffset,t.borderDashOffset),i.lineJoin=lt(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=lt(e.borderWidth,t.borderWidth),i.strokeStyle=lt(e.borderColor,t.borderColor)}function kc(i,t,e){i.lineTo(e.x,e.y)}function Pc(i){return i.stepped?Ja:i.tension||i.cubicInterpolationMode==="monotone"?Qa:kc}function wo(i,t,e={}){const s=i.length,{start:h=0,end:g=s-1}=e,{start:m,end:o}=t,n=Math.max(h,m),l=Math.min(g,o),u=h<m&&g<m||h>o&&g>o;return{count:s,start:n,loop:t.loop,ilen:l<n&&!u?s+l-n:l-n}}function Mc(i,t,e,s){const{points:h,options:g}=t,{count:m,start:o,loop:n,ilen:l}=wo(h,e,s),u=Pc(g);let{move:r=!0,reverse:c}=s||{},a,f,p;for(a=0;a<=l;++a)f=h[(o+(c?l-a:a))%m],!f.skip&&(r?(i.moveTo(f.x,f.y),r=!1):u(i,p,f,c,g.stepped),p=f);return n&&(f=h[(o+(c?l:0))%m],u(i,p,f,c,g.stepped)),!!n}function Dc(i,t,e,s){const h=t.points,{count:g,start:m,ilen:o}=wo(h,e,s),{move:n=!0,reverse:l}=s||{};let u=0,r=0,c,a,f,p,d,v;const _=y=>(m+(l?o-y:y))%g,b=()=>{p!==d&&(i.lineTo(u,d),i.lineTo(u,p),i.lineTo(u,v))};for(n&&(a=h[_(0)],i.moveTo(a.x,a.y)),c=0;c<=o;++c){if(a=h[_(c)],a.skip)continue;const y=a.x,x=a.y,C=y|0;C===f?(x<p?p=x:x>d&&(d=x),u=(r*u+y)/++r):(b(),i.lineTo(y,x),f=C,r=0,p=d=x),v=x}b()}function En(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Dc:Mc}function Ac(i){return i.stepped?Dl:i.tension||i.cubicInterpolationMode==="monotone"?Al:ye}function Ec(i,t,e,s){let h=t._path;h||(h=t._path=new Path2D,t.path(h,e,s)&&h.closePath()),So(i,t.options),i.stroke(h)}function Fc(i,t,e,s){const{segments:h,options:g}=t,m=En(t);for(const o of h)So(i,g,o.style),i.beginPath(),m(i,t,o,{start:e,end:e+s-1})&&i.closePath(),i.stroke()}const Lc=typeof Path2D=="function";function Rc(i,t,e,s){Lc&&!t.options.segment?Ec(i,t,e,s):Fc(i,t,e,s)}class ae extends se{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const h=s.spanGaps?this._loop:this._fullLoop;Cl(this._points,s,t,h,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Bl(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,h=t[e],g=this.points,m=ho(this,{property:e,start:h,end:h});if(!m.length)return;const o=[],n=Ac(s);let l,u;for(l=0,u=m.length;l<u;++l){const{start:r,end:c}=m[l],a=g[r],f=g[c];if(a===f){o.push(a);continue}const p=Math.abs((h-a[e])/(f[e]-a[e])),d=n(a,f,p,s.stepped);d[e]=t[e],o.push(d)}return o.length===1?o[0]:o}pathSegment(t,e,s){return En(this)(t,this,e,s)}path(t,e,s){const h=this.segments,g=En(this);let m=this._loop;e=e||0,s=s||this.points.length-e;for(const o of h)m&=g(t,this,o,{start:e,end:e+s-1});return!!m}draw(t,e,s,h){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(t.save(),Rc(t,this,s,h),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Z(ae,"id","line"),Z(ae,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Z(ae,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Z(ae,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function or(i,t,e,s){const h=i.options,{[e]:g}=i.getProps([e],s);return Math.abs(t-g)<h.radius+h.hitRadius}class Yi extends se{constructor(e){super();Z(this,"parsed");Z(this,"skip");Z(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,h){const g=this.options,{x:m,y:o}=this.getProps(["x","y"],h);return Math.pow(e-m,2)+Math.pow(s-o,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(e,s){return or(this,e,"x",s)}inYRange(e,s){return or(this,e,"y",s)}getCenterPoint(e){const{x:s,y:h}=this.getProps(["x","y"],e);return{x:s,y:h}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const h=s&&e.borderWidth||0;return(s+h)*2}draw(e,s){const h=this.options;this.skip||h.radius<.1||!ne(this,s,this.size(h)/2)||(e.strokeStyle=h.borderColor,e.lineWidth=h.borderWidth,e.fillStyle=h.backgroundColor,Pn(e,h,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}Z(Yi,"id","point"),Z(Yi,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Z(Yi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function To(i,t){const{x:e,y:s,base:h,width:g,height:m}=i.getProps(["x","y","base","width","height"],t);let o,n,l,u,r;return i.horizontal?(r=m/2,o=Math.min(e,h),n=Math.max(e,h),l=s-r,u=s+r):(r=g/2,o=e-r,n=e+r,l=Math.min(s,h),u=Math.max(s,h)),{left:o,top:l,right:n,bottom:u}}function le(i,t,e,s){return i?0:Pt(t,e,s)}function Ic(i,t,e){const s=i.options.borderWidth,h=i.borderSkipped,g=Jr(s);return{t:le(h.top,g.top,0,e),r:le(h.right,g.right,0,t),b:le(h.bottom,g.bottom,0,e),l:le(h.left,g.left,0,t)}}function Bc(i,t,e){const{enableBorderRadius:s}=i.getProps(["enableBorderRadius"]),h=i.options.borderRadius,g=Se(h),m=Math.min(t,e),o=i.borderSkipped,n=s||ht(h);return{topLeft:le(!n||o.top||o.left,g.topLeft,0,m),topRight:le(!n||o.top||o.right,g.topRight,0,m),bottomLeft:le(!n||o.bottom||o.left,g.bottomLeft,0,m),bottomRight:le(!n||o.bottom||o.right,g.bottomRight,0,m)}}function jc(i){const t=To(i),e=t.right-t.left,s=t.bottom-t.top,h=Ic(i,e/2,s/2),g=Bc(i,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:g},inner:{x:t.left+h.l,y:t.top+h.t,w:e-h.l-h.r,h:s-h.t-h.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,g.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(h.b,h.r))}}}}function yn(i,t,e,s){const h=t===null,g=e===null,o=i&&!(h&&g)&&To(i,s);return o&&(h||ee(t,o.left,o.right))&&(g||ee(e,o.top,o.bottom))}function zc(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function Wc(i,t){i.rect(t.x,t.y,t.w,t.h)}function xn(i,t,e={}){const s=i.x!==e.x?-t:0,h=i.y!==e.y?-t:0,g=(i.x+i.w!==e.x+e.w?t:0)-s,m=(i.y+i.h!==e.y+e.h?t:0)-h;return{x:i.x+s,y:i.y+h,w:i.w+g,h:i.h+m,radius:i.radius}}class Ui extends se{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:h}}=this,{inner:g,outer:m}=jc(this),o=zc(m.radius)?ci:Wc;t.save(),(m.w!==g.w||m.h!==g.h)&&(t.beginPath(),o(t,xn(m,e,g)),t.clip(),o(t,xn(g,-e,m)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),o(t,xn(g,e)),t.fillStyle=h,t.fill(),t.restore()}inRange(t,e,s){return yn(this,t,e,s)}inXRange(t,e){return yn(this,t,null,e)}inYRange(t,e){return yn(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:h,horizontal:g}=this.getProps(["x","y","base","horizontal"],t);return{x:g?(e+h)/2:e,y:g?s:(s+h)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}Z(Ui,"id","bar"),Z(Ui,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Z(Ui,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Hc=Object.freeze({__proto__:null,ArcElement:qe,BarElement:Ui,LineElement:ae,PointElement:Yi});const Fn=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ar=Fn.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function Oo(i){return Fn[i%Fn.length]}function ko(i){return ar[i%ar.length]}function Nc(i,t){return i.borderColor=Oo(t),i.backgroundColor=ko(t),++t}function Vc(i,t){return i.backgroundColor=i.data.map(()=>Oo(t++)),t}function Xc(i,t){return i.backgroundColor=i.data.map(()=>ko(t++)),t}function Yc(i){let t=0;return(e,s)=>{const h=i.getDatasetMeta(s).controller;h instanceof Ce?t=Vc(e,t):h instanceof ni?t=Xc(e,t):h&&(t=Nc(e,t))}}function lr(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function Uc(i){return i&&(i.borderColor||i.backgroundColor)}var Gc={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:s},options:h}=i.config,{elements:g}=h;if(!e.forceOverride&&(lr(s)||Uc(h)||g&&lr(g)))return;const m=Yc(i);s.forEach(m)}};function $c(i,t,e,s,h){const g=h.samples||s;if(g>=e)return i.slice(t,t+e);const m=[],o=(e-2)/(g-2);let n=0;const l=t+e-1;let u=t,r,c,a,f,p;for(m[n++]=i[u],r=0;r<g-2;r++){let d=0,v=0,_;const b=Math.floor((r+1)*o)+1+t,y=Math.min(Math.floor((r+2)*o)+1,e)+t,x=y-b;for(_=b;_<y;_++)d+=i[_].x,v+=i[_].y;d/=x,v/=x;const C=Math.floor(r*o)+1+t,S=Math.min(Math.floor((r+1)*o)+1,e)+t,{x:O,y:E}=i[u];for(a=f=-1,_=C;_<S;_++)f=.5*Math.abs((O-d)*(i[_].y-E)-(O-i[_].x)*(v-E)),f>a&&(a=f,c=i[_],p=_);m[n++]=c,u=p}return m[n++]=i[l],m}function qc(i,t,e,s){let h=0,g=0,m,o,n,l,u,r,c,a,f,p;const d=[],v=t+e-1,_=i[t].x,y=i[v].x-_;for(m=t;m<t+e;++m){o=i[m],n=(o.x-_)/y*s,l=o.y;const x=n|0;if(x===u)l<f?(f=l,r=m):l>p&&(p=l,c=m),h=(g*h+o.x)/++g;else{const C=m-1;if(!ut(r)&&!ut(c)){const S=Math.min(r,c),O=Math.max(r,c);S!==a&&S!==C&&d.push({...i[S],x:h}),O!==a&&O!==C&&d.push({...i[O],x:h})}m>0&&C!==a&&d.push(i[C]),d.push(o),u=x,g=0,f=p=l,r=c=a=m}}return d}function Po(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function hr(i){i.data.datasets.forEach(t=>{Po(t)})}function Kc(i,t){const e=t.length;let s=0,h;const{iScale:g}=i,{min:m,max:o,minDefined:n,maxDefined:l}=g.getUserBounds();return n&&(s=Pt(ie(t,g.axis,m).lo,0,e-1)),l?h=Pt(ie(t,g.axis,o).hi+1,s,e)-s:h=e-s,{start:s,count:h}}var Jc={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){hr(i);return}const s=i.width;i.data.datasets.forEach((h,g)=>{const{_data:m,indexAxis:o}=h,n=i.getDatasetMeta(g),l=m||h.data;if(Ge([o,i.options.indexAxis])==="y"||!n.controller.supportsDecimation)return;const u=i.scales[n.xAxisID];if(u.type!=="linear"&&u.type!=="time"||i.options.parsing)return;let{start:r,count:c}=Kc(n,l);const a=e.threshold||4*s;if(c<=a){Po(h);return}ut(m)&&(h._data=l,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let f;switch(e.algorithm){case"lttb":f=$c(l,r,c,s,e);break;case"min-max":f=qc(l,r,c,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}h._decimated=f})},destroy(i){hr(i)}};function Qc(i,t,e){const s=i.segments,h=i.points,g=t.points,m=[];for(const o of s){let{start:n,end:l}=o;l=ns(n,l,h);const u=Ln(e,h[n],h[l],o.loop);if(!t.segments){m.push({source:o,target:u,start:h[n],end:h[l]});continue}const r=ho(t,u);for(const c of r){const a=Ln(e,g[c.start],g[c.end],c.loop),f=lo(o,h,a);for(const p of f)m.push({source:p,target:c,start:{[e]:cr(u,a,"start",Math.max)},end:{[e]:cr(u,a,"end",Math.min)}})}}return m}function Ln(i,t,e,s){if(s)return;let h=t[i],g=e[i];return i==="angle"&&(h=It(h),g=It(g)),{property:i,start:h,end:g}}function Zc(i,t){const{x:e=null,y:s=null}=i||{},h=t.points,g=[];return t.segments.forEach(({start:m,end:o})=>{o=ns(m,o,h);const n=h[m],l=h[o];s!==null?(g.push({x:n.x,y:s}),g.push({x:l.x,y:s})):e!==null&&(g.push({x:e,y:n.y}),g.push({x:e,y:l.y}))}),g}function ns(i,t,e){for(;t>i;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function cr(i,t,e,s){return i&&t?s(i[e],t[e]):i?i[e]:t?t[e]:0}function Mo(i,t){let e=[],s=!1;return vt(i)?(s=!0,e=i):e=Zc(i,t),e.length?new ae({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function ur(i){return i&&i.fill!==!1}function tu(i,t,e){let h=i[t].fill;const g=[t];let m;if(!e)return h;for(;h!==!1&&g.indexOf(h)===-1;){if(!St(h))return h;if(m=i[h],!m)return!1;if(m.visible)return h;g.push(h),h=m.fill}return!1}function eu(i,t,e){const s=ru(i);if(ht(s))return isNaN(s.value)?!1:s;let h=parseFloat(s);return St(h)&&Math.floor(h)===h?iu(s[0],t,h,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function iu(i,t,e,s){return(i==="-"||i==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function nu(i,t){let e=null;return i==="start"?e=t.bottom:i==="end"?e=t.top:ht(i)?e=t.getPixelForValue(i.value):t.getBasePixel&&(e=t.getBasePixel()),e}function su(i,t,e){let s;return i==="start"?s=e:i==="end"?s=t.options.reverse?t.min:t.max:ht(i)?s=i.value:s=t.getBaseValue(),s}function ru(i){const t=i.options,e=t.fill;let s=lt(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function ou(i){const{scale:t,index:e,line:s}=i,h=[],g=s.segments,m=s.points,o=au(t,e);o.push(Mo({x:null,y:t.bottom},s));for(let n=0;n<g.length;n++){const l=g[n];for(let u=l.start;u<=l.end;u++)lu(h,m[u],o)}return new ae({points:h,options:{}})}function au(i,t){const e=[],s=i.getMatchingVisibleMetas("line");for(let h=0;h<s.length;h++){const g=s[h];if(g.index===t)break;g.hidden||e.unshift(g.dataset)}return e}function lu(i,t,e){const s=[];for(let h=0;h<e.length;h++){const g=e[h],{first:m,last:o,point:n}=hu(g,t,"x");if(!(!n||m&&o)){if(m)s.unshift(n);else if(i.push(n),!o)break}}i.push(...s)}function hu(i,t,e){const s=i.interpolate(t,e);if(!s)return{};const h=s[e],g=i.segments,m=i.points;let o=!1,n=!1;for(let l=0;l<g.length;l++){const u=g[l],r=m[u.start][e],c=m[u.end][e];if(ee(h,r,c)){o=h===r,n=h===c;break}}return{first:o,last:n,point:s}}class Do{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:h,y:g,radius:m}=this;return e=e||{start:0,end:_t},t.arc(h,g,m,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:h}=this,g=t.angle;return{x:e+Math.cos(g)*h,y:s+Math.sin(g)*h,angle:g}}}function cu(i){const{chart:t,fill:e,line:s}=i;if(St(e))return uu(t,e);if(e==="stack")return ou(i);if(e==="shape")return!0;const h=fu(i);return h instanceof Do?h:Mo(h,s)}function uu(i,t){const e=i.getDatasetMeta(t);return e&&i.isDatasetVisible(t)?e.dataset:null}function fu(i){return(i.scale||{}).getPointPositionForValue?gu(i):du(i)}function du(i){const{scale:t={},fill:e}=i,s=nu(e,t);if(St(s)){const h=t.isHorizontal();return{x:h?s:null,y:h?null:s}}return null}function gu(i){const{scale:t,fill:e}=i,s=t.options,h=t.getLabels().length,g=s.reverse?t.max:t.min,m=su(e,t,g),o=[];if(s.grid.circular){const n=t.getPointPositionForValue(0,g);return new Do({x:n.x,y:n.y,radius:t.getDistanceFromCenterForValue(m)})}for(let n=0;n<h;++n)o.push(t.getPointPositionForValue(n,m));return o}function Cn(i,t,e){const s=cu(t),{line:h,scale:g,axis:m}=t,o=h.options,n=o.fill,l=o.backgroundColor,{above:u=l,below:r=l}=n||{};s&&h.points.length&&(rn(i,e),pu(i,{line:h,target:s,above:u,below:r,area:e,scale:g,axis:m}),on(i))}function pu(i,t){const{line:e,target:s,above:h,below:g,area:m,scale:o}=t,n=e._loop?"angle":t.axis;i.save(),n==="x"&&g!==h&&(fr(i,s,m.top),dr(i,{line:e,target:s,color:h,scale:o,property:n}),i.restore(),i.save(),fr(i,s,m.bottom)),dr(i,{line:e,target:s,color:g,scale:o,property:n}),i.restore()}function fr(i,t,e){const{segments:s,points:h}=t;let g=!0,m=!1;i.beginPath();for(const o of s){const{start:n,end:l}=o,u=h[n],r=h[ns(n,l,h)];g?(i.moveTo(u.x,u.y),g=!1):(i.lineTo(u.x,e),i.lineTo(u.x,u.y)),m=!!t.pathSegment(i,o,{move:m}),m?i.closePath():i.lineTo(r.x,e)}i.lineTo(t.first().x,e),i.closePath(),i.clip()}function dr(i,t){const{line:e,target:s,property:h,color:g,scale:m}=t,o=Qc(e,s,h);for(const{source:n,target:l,start:u,end:r}of o){const{style:{backgroundColor:c=g}={}}=n,a=s!==!0;i.save(),i.fillStyle=c,mu(i,m,a&&Ln(h,u,r)),i.beginPath();const f=!!e.pathSegment(i,n);let p;if(a){f?i.closePath():gr(i,s,r,h);const d=!!s.pathSegment(i,l,{move:f,reverse:!0});p=f&&d,p||gr(i,s,u,h)}i.closePath(),i.fill(p?"evenodd":"nonzero"),i.restore()}}function mu(i,t,e){const{top:s,bottom:h}=t.chart.chartArea,{property:g,start:m,end:o}=e||{};g==="x"&&(i.beginPath(),i.rect(m,s,o-m,h-s),i.clip())}function gr(i,t,e,s){const h=t.interpolate(e,s);h&&i.lineTo(h.x,h.y)}var vu={id:"filler",afterDatasetsUpdate(i,t,e){const s=(i.data.datasets||[]).length,h=[];let g,m,o,n;for(m=0;m<s;++m)g=i.getDatasetMeta(m),o=g.dataset,n=null,o&&o.options&&o instanceof ae&&(n={visible:i.isDatasetVisible(m),index:m,fill:eu(o,m,s),chart:i,axis:g.controller.options.indexAxis,scale:g.vScale,line:o}),g.$filler=n,h.push(n);for(m=0;m<s;++m)n=h[m],!(!n||n.fill===!1)&&(n.fill=tu(h,m,e.propagate))},beforeDraw(i,t,e){const s=e.drawTime==="beforeDraw",h=i.getSortedVisibleDatasetMetas(),g=i.chartArea;for(let m=h.length-1;m>=0;--m){const o=h[m].$filler;o&&(o.line.updateControlPoints(g,o.axis),s&&o.fill&&Cn(i.ctx,o,g))}},beforeDatasetsDraw(i,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=i.getSortedVisibleDatasetMetas();for(let h=s.length-1;h>=0;--h){const g=s[h].$filler;ur(g)&&Cn(i.ctx,g,i.chartArea)}},beforeDatasetDraw(i,t,e){const s=t.meta.$filler;!ur(s)||e.drawTime!=="beforeDatasetDraw"||Cn(i.ctx,s,i.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const pr=(i,t)=>{let{boxHeight:e=t,boxWidth:s=t}=i;return i.usePointStyle&&(e=Math.min(e,t),s=i.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},_u=(i,t)=>i!==null&&t!==null&&i.datasetIndex===t.datasetIndex&&i.index===t.index;class mr extends se{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=gt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,h)=>t.sort(s,h,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,h=kt(s.font),g=h.size,m=this._computeTitleHeight(),{boxWidth:o,itemHeight:n}=pr(s,g);let l,u;e.font=h.string,this.isHorizontal()?(l=this.maxWidth,u=this._fitRows(m,g,o,n)+10):(u=this.maxHeight,l=this._fitCols(m,h,o,n)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(u,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,h){const{ctx:g,maxWidth:m,options:{labels:{padding:o}}}=this,n=this.legendHitBoxes=[],l=this.lineWidths=[0],u=h+o;let r=t;g.textAlign="left",g.textBaseline="middle";let c=-1,a=-u;return this.legendItems.forEach((f,p)=>{const d=s+e/2+g.measureText(f.text).width;(p===0||l[l.length-1]+d+2*o>m)&&(r+=u,l[l.length-(p>0?0:1)]=0,a+=u,c++),n[p]={left:0,top:a,row:c,width:d,height:h},l[l.length-1]+=d+o}),r}_fitCols(t,e,s,h){const{ctx:g,maxHeight:m,options:{labels:{padding:o}}}=this,n=this.legendHitBoxes=[],l=this.columnSizes=[],u=m-t;let r=o,c=0,a=0,f=0,p=0;return this.legendItems.forEach((d,v)=>{const{itemWidth:_,itemHeight:b}=bu(s,e,g,d,h);v>0&&a+b+2*o>u&&(r+=c+o,l.push({width:c,height:a}),f+=c+o,p++,c=a=0),n[v]={left:f,top:a,col:p,width:_,height:b},c=Math.max(c,_),a+=b+o}),r+=c,l.push({width:c,height:a}),r}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:h},rtl:g}}=this,m=Re(g,this.left,this.width);if(this.isHorizontal()){let o=0,n=Mt(s,this.left+h,this.right-this.lineWidths[o]);for(const l of e)o!==l.row&&(o=l.row,n=Mt(s,this.left+h,this.right-this.lineWidths[o])),l.top+=this.top+t+h,l.left=m.leftForLtr(m.x(n),l.width),n+=l.width+h}else{let o=0,n=Mt(s,this.top+t+h,this.bottom-this.columnSizes[o].height);for(const l of e)l.col!==o&&(o=l.col,n=Mt(s,this.top+t+h,this.bottom-this.columnSizes[o].height)),l.top=n,l.left+=this.left+h,l.left=m.leftForLtr(m.x(l.left),l.width),n+=l.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;rn(t,this),this._draw(),on(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:h}=this,{align:g,labels:m}=t,o=wt.color,n=Re(t.rtl,this.left,this.width),l=kt(m.font),{padding:u}=m,r=l.size,c=r/2;let a;this.drawTitle(),h.textAlign=n.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=l.string;const{boxWidth:f,boxHeight:p,itemHeight:d}=pr(m,r),v=function(C,S,O){if(isNaN(f)||f<=0||isNaN(p)||p<0)return;h.save();const E=lt(O.lineWidth,1);if(h.fillStyle=lt(O.fillStyle,o),h.lineCap=lt(O.lineCap,"butt"),h.lineDashOffset=lt(O.lineDashOffset,0),h.lineJoin=lt(O.lineJoin,"miter"),h.lineWidth=E,h.strokeStyle=lt(O.strokeStyle,o),h.setLineDash(lt(O.lineDash,[])),m.usePointStyle){const R={radius:p*Math.SQRT2/2,pointStyle:O.pointStyle,rotation:O.rotation,borderWidth:E},W=n.xPlus(C,f/2),X=S+c;Kr(h,R,W,X,m.pointStyleWidth&&f)}else{const R=S+Math.max((r-p)/2,0),W=n.leftForLtr(C,f),X=Se(O.borderRadius);h.beginPath(),Object.values(X).some(Q=>Q!==0)?ci(h,{x:W,y:R,w:f,h:p,radius:X}):h.rect(W,R,f,p),h.fill(),E!==0&&h.stroke()}h.restore()},_=function(C,S,O){ke(h,O.text,C,S+d/2,l,{strikethrough:O.hidden,textAlign:n.textAlign(O.textAlign)})},b=this.isHorizontal(),y=this._computeTitleHeight();b?a={x:Mt(g,this.left+u,this.right-s[0]),y:this.top+u+y,line:0}:a={x:this.left+u,y:Mt(g,this.top+y+u,this.bottom-e[0].height),line:0},ro(this.ctx,t.textDirection);const x=d+u;this.legendItems.forEach((C,S)=>{h.strokeStyle=C.fontColor,h.fillStyle=C.fontColor;const O=h.measureText(C.text).width,E=n.textAlign(C.textAlign||(C.textAlign=m.textAlign)),R=f+c+O;let W=a.x,X=a.y;n.setWidth(this.width),b?S>0&&W+R+u>this.right&&(X=a.y+=x,a.line++,W=a.x=Mt(g,this.left+u,this.right-s[a.line])):S>0&&X+x>this.bottom&&(W=a.x=W+e[a.line].width+u,a.line++,X=a.y=Mt(g,this.top+y+u,this.bottom-e[a.line].height));const Q=n.x(W);if(v(Q,X,C),W=Wa(E,W+f+c,b?W+R:this.right,t.rtl),_(n.x(W),X,C),b)a.x+=R+u;else if(typeof C.text!="string"){const $=l.lineHeight;a.y+=Ao(C,$)+u}else a.y+=x}),oo(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=kt(e.font),h=At(e.padding);if(!e.display)return;const g=Re(t.rtl,this.left,this.width),m=this.ctx,o=e.position,n=s.size/2,l=h.top+n;let u,r=this.left,c=this.width;if(this.isHorizontal())c=Math.max(...this.lineWidths),u=this.top+l,r=Mt(t.align,r,this.right-c);else{const f=this.columnSizes.reduce((p,d)=>Math.max(p,d.height),0);u=l+Mt(t.align,this.top,this.bottom-f-t.labels.padding-this._computeTitleHeight())}const a=Mt(o,r,r+c);m.textAlign=g.textAlign(qn(o)),m.textBaseline="middle",m.strokeStyle=e.color,m.fillStyle=e.color,m.font=s.string,ke(m,e.text,a,u,s)}_computeTitleHeight(){const t=this.options.title,e=kt(t.font),s=At(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,h,g;if(ee(t,this.left,this.right)&&ee(e,this.top,this.bottom)){for(g=this.legendHitBoxes,s=0;s<g.length;++s)if(h=g[s],ee(t,h.left,h.left+h.width)&&ee(e,h.top,h.top+h.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!Cu(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const h=this._hoveredItem,g=_u(h,s);h&&!g&&gt(e.onLeave,[t,h,this],this),this._hoveredItem=s,s&&!g&&gt(e.onHover,[t,s,this],this)}else s&&gt(e.onClick,[t,s,this],this)}}function bu(i,t,e,s,h){const g=yu(s,i,t,e),m=xu(h,s,t.lineHeight);return{itemWidth:g,itemHeight:m}}function yu(i,t,e,s){let h=i.text;return h&&typeof h!="string"&&(h=h.reduce((g,m)=>g.length>m.length?g:m)),t+e.size/2+s.measureText(h).width}function xu(i,t,e){let s=i;return typeof t.text!="string"&&(s=Ao(t,e)),s}function Ao(i,t){const e=i.text?i.text.length:0;return t*e}function Cu(i,t){return!!((i==="mousemove"||i==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(i==="click"||i==="mouseup"))}var Su={id:"legend",_element:mr,start(i,t,e){const s=i.legend=new mr({ctx:i.ctx,options:e,chart:i});Dt.configure(i,s,e),Dt.addBox(i,s)},stop(i){Dt.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,t,e){const s=i.legend;Dt.configure(i,s,e),s.options=e},afterUpdate(i){const t=i.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(i,t){t.replay||i.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,t,e){const s=t.datasetIndex,h=e.chart;h.isDatasetVisible(s)?(h.hide(s),t.hidden=!0):(h.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const t=i.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:h,color:g,useBorderRadius:m,borderRadius:o}}=i.legend.options;return i._getSortedDatasetMetas().map(n=>{const l=n.controller.getStyle(e?0:void 0),u=At(l.borderWidth);return{text:t[n.index].label,fillStyle:l.backgroundColor,fontColor:g,hidden:!n.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:l.borderColor,pointStyle:s||l.pointStyle,rotation:l.rotation,textAlign:h||l.textAlign,borderRadius:m&&(o||l.borderRadius),datasetIndex:n.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};class ss extends se{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const h=vt(s.text)?s.text.length:1;this._padding=At(s.padding);const g=h*kt(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:h,right:g,options:m}=this,o=m.align;let n=0,l,u,r;return this.isHorizontal()?(u=Mt(o,s,g),r=e+t,l=g-s):(m.position==="left"?(u=s+t,r=Mt(o,h,e),n=bt*-.5):(u=g-t,r=Mt(o,e,h),n=bt*.5),l=h-e),{titleX:u,titleY:r,maxWidth:l,rotation:n}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=kt(e.font),g=s.lineHeight/2+this._padding.top,{titleX:m,titleY:o,maxWidth:n,rotation:l}=this._drawArgs(g);ke(t,e.text,0,0,s,{color:e.color,maxWidth:n,rotation:l,textAlign:qn(e.align),textBaseline:"middle",translation:[m,o]})}}function wu(i,t){const e=new ss({ctx:i.ctx,options:t,chart:i});Dt.configure(i,e,t),Dt.addBox(i,e),i.titleBlock=e}var Tu={id:"title",_element:ss,start(i,t,e){wu(i,e)},stop(i){const t=i.titleBlock;Dt.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const s=i.titleBlock;Dt.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fi=new WeakMap;var Ou={id:"subtitle",start(i,t,e){const s=new ss({ctx:i.ctx,options:e,chart:i});Dt.configure(i,s,e),Dt.addBox(i,s),Fi.set(i,s)},stop(i){Dt.removeBox(i,Fi.get(i)),Fi.delete(i)},beforeUpdate(i,t,e){const s=Fi.get(i);Dt.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ke={average(i){if(!i.length)return!1;let t,e,s=0,h=0,g=0;for(t=0,e=i.length;t<e;++t){const m=i[t].element;if(m&&m.hasValue()){const o=m.tooltipPosition();s+=o.x,h+=o.y,++g}}return{x:s/g,y:h/g}},nearest(i,t){if(!i.length)return!1;let e=t.x,s=t.y,h=Number.POSITIVE_INFINITY,g,m,o;for(g=0,m=i.length;g<m;++g){const n=i[g].element;if(n&&n.hasValue()){const l=n.getCenterPoint(),u=On(t,l);u<h&&(h=u,o=n)}}if(o){const n=o.tooltipPosition();e=n.x,s=n.y}return{x:e,y:s}}};function Ut(i,t){return t&&(vt(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function Qt(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function ku(i,t){const{element:e,datasetIndex:s,index:h}=t,g=i.getDatasetMeta(s).controller,{label:m,value:o}=g.getLabelAndValue(h);return{chart:i,label:m,parsed:g.getParsed(h),raw:i.data.datasets[s].data[h],formattedValue:o,dataset:g.getDataset(),dataIndex:h,datasetIndex:s,element:e}}function vr(i,t){const e=i.chart.ctx,{body:s,footer:h,title:g}=i,{boxWidth:m,boxHeight:o}=t,n=kt(t.bodyFont),l=kt(t.titleFont),u=kt(t.footerFont),r=g.length,c=h.length,a=s.length,f=At(t.padding);let p=f.height,d=0,v=s.reduce((y,x)=>y+x.before.length+x.lines.length+x.after.length,0);if(v+=i.beforeBody.length+i.afterBody.length,r&&(p+=r*l.lineHeight+(r-1)*t.titleSpacing+t.titleMarginBottom),v){const y=t.displayColors?Math.max(o,n.lineHeight):n.lineHeight;p+=a*y+(v-a)*n.lineHeight+(v-1)*t.bodySpacing}c&&(p+=t.footerMarginTop+c*u.lineHeight+(c-1)*t.footerSpacing);let _=0;const b=function(y){d=Math.max(d,e.measureText(y).width+_)};return e.save(),e.font=l.string,dt(i.title,b),e.font=n.string,dt(i.beforeBody.concat(i.afterBody),b),_=t.displayColors?m+2+t.boxPadding:0,dt(s,y=>{dt(y.before,b),dt(y.lines,b),dt(y.after,b)}),_=0,e.font=u.string,dt(i.footer,b),e.restore(),d+=f.width,{width:d,height:p}}function Pu(i,t){const{y:e,height:s}=t;return e<s/2?"top":e>i.height-s/2?"bottom":"center"}function Mu(i,t,e,s){const{x:h,width:g}=s,m=e.caretSize+e.caretPadding;if(i==="left"&&h+g+m>t.width||i==="right"&&h-g-m<0)return!0}function Du(i,t,e,s){const{x:h,width:g}=e,{width:m,chartArea:{left:o,right:n}}=i;let l="center";return s==="center"?l=h<=(o+n)/2?"left":"right":h<=g/2?l="left":h>=m-g/2&&(l="right"),Mu(l,i,t,e)&&(l="center"),l}function _r(i,t,e){const s=e.yAlign||t.yAlign||Pu(i,e);return{xAlign:e.xAlign||t.xAlign||Du(i,t,e,s),yAlign:s}}function Au(i,t){let{x:e,width:s}=i;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function Eu(i,t,e){let{y:s,height:h}=i;return t==="top"?s+=e:t==="bottom"?s-=h+e:s-=h/2,s}function br(i,t,e,s){const{caretSize:h,caretPadding:g,cornerRadius:m}=i,{xAlign:o,yAlign:n}=e,l=h+g,{topLeft:u,topRight:r,bottomLeft:c,bottomRight:a}=Se(m);let f=Au(t,o);const p=Eu(t,n,l);return n==="center"?o==="left"?f+=l:o==="right"&&(f-=l):o==="left"?f-=Math.max(u,c)+h:o==="right"&&(f+=Math.max(r,a)+h),{x:Pt(f,0,s.width-t.width),y:Pt(p,0,s.height-t.height)}}function Li(i,t,e){const s=At(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-s.right:i.x+s.left}function yr(i){return Ut([],Qt(i))}function Fu(i,t,e){return de(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function xr(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const Eo={beforeTitle:Kt,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Kt,beforeBody:Kt,beforeLabel:Kt,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return ut(e)||(t+=e),t},labelColor(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Kt,afterBody:Kt,beforeFooter:Kt,footer:Kt,afterFooter:Kt};function Ft(i,t,e,s){const h=i[t].call(e,s);return typeof h>"u"?Eo[t].call(e,s):h}class Rn extends se{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),h=s.enabled&&e.options.animation&&s.animations,g=new co(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=Fu(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,h=Ft(s,"beforeTitle",this,t),g=Ft(s,"title",this,t),m=Ft(s,"afterTitle",this,t);let o=[];return o=Ut(o,Qt(h)),o=Ut(o,Qt(g)),o=Ut(o,Qt(m)),o}getBeforeBody(t,e){return yr(Ft(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,h=[];return dt(t,g=>{const m={before:[],lines:[],after:[]},o=xr(s,g);Ut(m.before,Qt(Ft(o,"beforeLabel",this,g))),Ut(m.lines,Ft(o,"label",this,g)),Ut(m.after,Qt(Ft(o,"afterLabel",this,g))),h.push(m)}),h}getAfterBody(t,e){return yr(Ft(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,h=Ft(s,"beforeFooter",this,t),g=Ft(s,"footer",this,t),m=Ft(s,"afterFooter",this,t);let o=[];return o=Ut(o,Qt(h)),o=Ut(o,Qt(g)),o=Ut(o,Qt(m)),o}_createItems(t){const e=this._active,s=this.chart.data,h=[],g=[],m=[];let o=[],n,l;for(n=0,l=e.length;n<l;++n)o.push(ku(this.chart,e[n]));return t.filter&&(o=o.filter((u,r,c)=>t.filter(u,r,c,s))),t.itemSort&&(o=o.sort((u,r)=>t.itemSort(u,r,s))),dt(o,u=>{const r=xr(t.callbacks,u);h.push(Ft(r,"labelColor",this,u)),g.push(Ft(r,"labelPointStyle",this,u)),m.push(Ft(r,"labelTextColor",this,u))}),this.labelColors=h,this.labelPointStyles=g,this.labelTextColors=m,this.dataPoints=o,o}update(t,e){const s=this.options.setContext(this.getContext()),h=this._active;let g,m=[];if(!h.length)this.opacity!==0&&(g={opacity:0});else{const o=Ke[s.position].call(this,h,this._eventPosition);m=this._createItems(s),this.title=this.getTitle(m,s),this.beforeBody=this.getBeforeBody(m,s),this.body=this.getBody(m,s),this.afterBody=this.getAfterBody(m,s),this.footer=this.getFooter(m,s);const n=this._size=vr(this,s),l=Object.assign({},o,n),u=_r(this.chart,s,l),r=br(s,l,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,g={opacity:1,x:r.x,y:r.y,width:n.width,height:n.height,caretX:o.x,caretY:o.y}}this._tooltipItems=m,this.$context=void 0,g&&this._resolveAnimations().update(this,g),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,h){const g=this.getCaretPosition(t,s,h);e.lineTo(g.x1,g.y1),e.lineTo(g.x2,g.y2),e.lineTo(g.x3,g.y3)}getCaretPosition(t,e,s){const{xAlign:h,yAlign:g}=this,{caretSize:m,cornerRadius:o}=s,{topLeft:n,topRight:l,bottomLeft:u,bottomRight:r}=Se(o),{x:c,y:a}=t,{width:f,height:p}=e;let d,v,_,b,y,x;return g==="center"?(y=a+p/2,h==="left"?(d=c,v=d-m,b=y+m,x=y-m):(d=c+f,v=d+m,b=y-m,x=y+m),_=d):(h==="left"?v=c+Math.max(n,u)+m:h==="right"?v=c+f-Math.max(l,r)-m:v=this.caretX,g==="top"?(b=a,y=b-m,d=v-m,_=v+m):(b=a+p,y=b+m,d=v+m,_=v-m),x=b),{x1:d,x2:v,x3:_,y1:b,y2:y,y3:x}}drawTitle(t,e,s){const h=this.title,g=h.length;let m,o,n;if(g){const l=Re(s.rtl,this.x,this.width);for(t.x=Li(this,s.titleAlign,s),e.textAlign=l.textAlign(s.titleAlign),e.textBaseline="middle",m=kt(s.titleFont),o=s.titleSpacing,e.fillStyle=s.titleColor,e.font=m.string,n=0;n<g;++n)e.fillText(h[n],l.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+o,n+1===g&&(t.y+=s.titleMarginBottom-o)}}_drawColorBox(t,e,s,h,g){const m=this.labelColors[s],o=this.labelPointStyles[s],{boxHeight:n,boxWidth:l}=g,u=kt(g.bodyFont),r=Li(this,"left",g),c=h.x(r),a=n<u.lineHeight?(u.lineHeight-n)/2:0,f=e.y+a;if(g.usePointStyle){const p={radius:Math.min(l,n)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},d=h.leftForLtr(c,l)+l/2,v=f+n/2;t.strokeStyle=g.multiKeyBackground,t.fillStyle=g.multiKeyBackground,Pn(t,p,d,v),t.strokeStyle=m.borderColor,t.fillStyle=m.backgroundColor,Pn(t,p,d,v)}else{t.lineWidth=ht(m.borderWidth)?Math.max(...Object.values(m.borderWidth)):m.borderWidth||1,t.strokeStyle=m.borderColor,t.setLineDash(m.borderDash||[]),t.lineDashOffset=m.borderDashOffset||0;const p=h.leftForLtr(c,l),d=h.leftForLtr(h.xPlus(c,1),l-2),v=Se(m.borderRadius);Object.values(v).some(_=>_!==0)?(t.beginPath(),t.fillStyle=g.multiKeyBackground,ci(t,{x:p,y:f,w:l,h:n,radius:v}),t.fill(),t.stroke(),t.fillStyle=m.backgroundColor,t.beginPath(),ci(t,{x:d,y:f+1,w:l-2,h:n-2,radius:v}),t.fill()):(t.fillStyle=g.multiKeyBackground,t.fillRect(p,f,l,n),t.strokeRect(p,f,l,n),t.fillStyle=m.backgroundColor,t.fillRect(d,f+1,l-2,n-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:h}=this,{bodySpacing:g,bodyAlign:m,displayColors:o,boxHeight:n,boxWidth:l,boxPadding:u}=s,r=kt(s.bodyFont);let c=r.lineHeight,a=0;const f=Re(s.rtl,this.x,this.width),p=function(O){e.fillText(O,f.x(t.x+a),t.y+c/2),t.y+=c+g},d=f.textAlign(m);let v,_,b,y,x,C,S;for(e.textAlign=m,e.textBaseline="middle",e.font=r.string,t.x=Li(this,d,s),e.fillStyle=s.bodyColor,dt(this.beforeBody,p),a=o&&d!=="right"?m==="center"?l/2+u:l+2+u:0,y=0,C=h.length;y<C;++y){for(v=h[y],_=this.labelTextColors[y],e.fillStyle=_,dt(v.before,p),b=v.lines,o&&b.length&&(this._drawColorBox(e,t,y,f,s),c=Math.max(r.lineHeight,n)),x=0,S=b.length;x<S;++x)p(b[x]),c=r.lineHeight;dt(v.after,p)}a=0,c=r.lineHeight,dt(this.afterBody,p),t.y-=g}drawFooter(t,e,s){const h=this.footer,g=h.length;let m,o;if(g){const n=Re(s.rtl,this.x,this.width);for(t.x=Li(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=n.textAlign(s.footerAlign),e.textBaseline="middle",m=kt(s.footerFont),e.fillStyle=s.footerColor,e.font=m.string,o=0;o<g;++o)e.fillText(h[o],n.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+s.footerSpacing}}drawBackground(t,e,s,h){const{xAlign:g,yAlign:m}=this,{x:o,y:n}=t,{width:l,height:u}=s,{topLeft:r,topRight:c,bottomLeft:a,bottomRight:f}=Se(h.cornerRadius);e.fillStyle=h.backgroundColor,e.strokeStyle=h.borderColor,e.lineWidth=h.borderWidth,e.beginPath(),e.moveTo(o+r,n),m==="top"&&this.drawCaret(t,e,s,h),e.lineTo(o+l-c,n),e.quadraticCurveTo(o+l,n,o+l,n+c),m==="center"&&g==="right"&&this.drawCaret(t,e,s,h),e.lineTo(o+l,n+u-f),e.quadraticCurveTo(o+l,n+u,o+l-f,n+u),m==="bottom"&&this.drawCaret(t,e,s,h),e.lineTo(o+a,n+u),e.quadraticCurveTo(o,n+u,o,n+u-a),m==="center"&&g==="left"&&this.drawCaret(t,e,s,h),e.lineTo(o,n+r),e.quadraticCurveTo(o,n,o+r,n),e.closePath(),e.fill(),h.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,h=s&&s.x,g=s&&s.y;if(h||g){const m=Ke[t.position].call(this,this._active,this._eventPosition);if(!m)return;const o=this._size=vr(this,t),n=Object.assign({},m,this._size),l=_r(e,t,n),u=br(t,n,l,e);(h._to!==u.x||g._to!==u.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=o.width,this.height=o.height,this.caretX=m.x,this.caretY=m.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const h={width:this.width,height:this.height},g={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const m=At(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=s,this.drawBackground(g,t,h,e),ro(t,e.textDirection),g.y+=m.top,this.drawTitle(g,t,e),this.drawBody(g,t,e),this.drawFooter(g,t,e),oo(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,h=t.map(({datasetIndex:o,index:n})=>{const l=this.chart.getDatasetMeta(o);if(!l)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:l.data[n],index:n}}),g=!$i(s,h),m=this._positionChanged(h,e);(g||m)&&(this._active=h,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,g=this._active||[],m=this._getActiveElements(t,g,e,s),o=this._positionChanged(m,t),n=e||!$i(m,g)||o;return n&&(this._active=m,(h.enabled||h.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),n}_getActiveElements(t,e,s,h){const g=this.options;if(t.type==="mouseout")return[];if(!h)return e;const m=this.chart.getElementsAtEventForMode(t,g.mode,g,s);return g.reverse&&m.reverse(),m}_positionChanged(t,e){const{caretX:s,caretY:h,options:g}=this,m=Ke[g.position].call(this,t,e);return m!==!1&&(s!==m.x||h!==m.y)}}Z(Rn,"positioners",Ke);var Lu={id:"tooltip",_element:Rn,positioners:Ke,afterInit(i,t,e){e&&(i.tooltip=new Rn({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Eo},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Ru=Object.freeze({__proto__:null,Colors:Gc,Decimation:Jc,Filler:vu,Legend:Su,SubTitle:Ou,Title:Tu,Tooltip:Lu});const Iu=(i,t,e,s)=>(typeof t=="string"?(e=i.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function Bu(i,t,e,s){const h=i.indexOf(t);if(h===-1)return Iu(i,t,e,s);const g=i.lastIndexOf(t);return h!==g?e:h}const ju=(i,t)=>i===null?null:Pt(Math.round(i),0,t);function Cr(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class In extends Me{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:h,label:g}of e)s[h]===g&&s.splice(h,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(ut(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:Bu(s,t,lt(e,t),this._addedLabels),ju(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(h=this.getLabels().length-1)),this.min=s,this.max=h}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,h=[];let g=this.getLabels();g=t===0&&e===g.length-1?g:g.slice(t,e+1),this._valueRange=Math.max(g.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let m=t;m<=e;m++)h.push({value:m});return h}getLabelForValue(t){return Cr.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}Z(In,"id","category"),Z(In,"defaults",{ticks:{callback:Cr}});function zu(i,t){const e=[],{bounds:h,step:g,min:m,max:o,precision:n,count:l,maxTicks:u,maxDigits:r,includeBounds:c}=i,a=g||1,f=u-1,{min:p,max:d}=t,v=!ut(m),_=!ut(o),b=!ut(l),y=(d-p)/(r+1);let x=ms((d-p)/f/a)*a,C,S,O,E;if(x<1e-14&&!v&&!_)return[{value:p},{value:d}];E=Math.ceil(d/x)-Math.floor(p/x),E>f&&(x=ms(E*x/f/a)*a),ut(n)||(C=Math.pow(10,n),x=Math.ceil(x*C)/C),h==="ticks"?(S=Math.floor(p/x)*x,O=Math.ceil(d/x)*x):(S=p,O=d),v&&_&&g&&Fa((o-m)/g,x/1e3)?(E=Math.round(Math.min((o-m)/x,u)),x=(o-m)/E,S=m,O=o):b?(S=v?m:S,O=_?o:O,E=l-1,x=(O-S)/E):(E=(O-S)/x,ti(E,Math.round(E),x/1e3)?E=Math.round(E):E=Math.ceil(E));const R=Math.max(vs(x),vs(S));C=Math.pow(10,ut(n)?R:n),S=Math.round(S*C)/C,O=Math.round(O*C)/C;let W=0;for(v&&(c&&S!==m?(e.push({value:m}),S<m&&W++,ti(Math.round((S+W*x)*C)/C,m,Sr(m,y,i))&&W++):S<m&&W++);W<E;++W){const X=Math.round((S+W*x)*C)/C;if(_&&X>o)break;e.push({value:X})}return _&&c&&O!==o?e.length&&ti(e[e.length-1].value,o,Sr(o,y,i))?e[e.length-1].value=o:e.push({value:o}):(!_||O===o)&&e.push({value:O}),e}function Sr(i,t,{horizontal:e,minRotation:s}){const h=Vt(s),g=(e?Math.sin(h):Math.cos(h))||.001,m=.75*t*(""+i).length;return Math.min(t/g,m)}class en extends Me{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return ut(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:h,max:g}=this;const m=n=>h=e?h:n,o=n=>g=s?g:n;if(t){const n=$t(h),l=$t(g);n<0&&l<0?o(0):n>0&&l>0&&m(0)}if(h===g){let n=g===0?1:Math.abs(g*.05);o(g+n),t||m(h-n)}this.min=h,this.max=g}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,h;return s?(h=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),e=e||11),e&&(h=Math.min(e,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const h={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},g=this._range||this,m=zu(h,g);return t.bounds==="ticks"&&Hr(m,this,"value"),t.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const h=(s-e)/Math.max(t.length-1,1)/2;e-=h,s+=h}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return yi(t,this.chart.options.locale,this.options.ticks.format)}}class Bn extends en{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=St(t)?t:0,this.max=St(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=Vt(this.options.ticks.minRotation),h=(t?Math.sin(s):Math.cos(s))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,g.lineHeight/h))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}Z(Bn,"id","linear"),Z(Bn,"defaults",{ticks:{callback:sn.formatters.numeric}});const fi=i=>Math.floor(oe(i)),_e=(i,t)=>Math.pow(10,fi(i)+t);function wr(i){return i/Math.pow(10,fi(i))===1}function Tr(i,t,e){const s=Math.pow(10,e),h=Math.floor(i/s);return Math.ceil(t/s)-h}function Wu(i,t){const e=t-i;let s=fi(e);for(;Tr(i,t,s)>10;)s++;for(;Tr(i,t,s)<10;)s--;return Math.min(s,fi(i))}function Hu(i,{min:t,max:e}){t=Rt(i.min,t);const s=[],h=fi(t);let g=Wu(t,e),m=g<0?Math.pow(10,Math.abs(g)):1;const o=Math.pow(10,g),n=h>g?Math.pow(10,h):0,l=Math.round((t-n)*m)/m,u=Math.floor((t-n)/o/10)*o*10;let r=Math.floor((l-u)/Math.pow(10,g)),c=Rt(i.min,Math.round((n+u+r*Math.pow(10,g))*m)/m);for(;c<e;)s.push({value:c,major:wr(c),significand:r}),r>=10?r=r<15?15:20:r++,r>=20&&(g++,r=2,m=g>=0?1:m),c=Math.round((n+u+r*Math.pow(10,g))*m)/m;const a=Rt(i.max,c);return s.push({value:a,major:wr(a),significand:r}),s}class jn extends Me{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=en.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return St(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=St(t)?Math.max(0,t):null,this.max=St(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!St(this._userMin)&&(this.min=t===_e(this.min,0)?_e(this.min,-1):_e(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,h=this.max;const g=o=>s=t?s:o,m=o=>h=e?h:o;s===h&&(s<=0?(g(1),m(10)):(g(_e(s,-1)),m(_e(h,1)))),s<=0&&g(_e(h,-1)),h<=0&&m(_e(s,1)),this.min=s,this.max=h}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=Hu(e,this);return t.bounds==="ticks"&&Hr(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":yi(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=oe(t),this._valueRange=oe(this.max)-oe(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(oe(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}Z(jn,"id","logarithmic"),Z(jn,"defaults",{ticks:{callback:sn.formatters.logarithmic,major:{enabled:!0}}});function zn(i){const t=i.ticks;if(t.display&&i.display){const e=At(t.backdropPadding);return lt(t.font&&t.font.size,wt.font.size)+e.height}return 0}function Nu(i,t,e){return e=vt(e)?e:[e],{w:Ka(i,t.string,e),h:e.length*t.lineHeight}}function Or(i,t,e,s,h){return i===s||i===h?{start:t-e/2,end:t+e/2}:i<s||i>h?{start:t-e,end:t}:{start:t,end:t+e}}function Vu(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),s=[],h=[],g=i._pointLabels.length,m=i.options.pointLabels,o=m.centerPointLabels?bt/g:0;for(let n=0;n<g;n++){const l=m.setContext(i.getPointLabelContext(n));h[n]=l.padding;const u=i.getPointPosition(n,i.drawingArea+h[n],o),r=kt(l.font),c=Nu(i.ctx,r,i._pointLabels[n]);s[n]=c;const a=It(i.getIndexAngle(n)+o),f=Math.round(Gn(a)),p=Or(f,u.x,c.w,0,180),d=Or(f,u.y,c.h,90,270);Xu(e,t,a,p,d)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=Gu(i,s,h)}function Xu(i,t,e,s,h){const g=Math.abs(Math.sin(e)),m=Math.abs(Math.cos(e));let o=0,n=0;s.start<t.l?(o=(t.l-s.start)/g,i.l=Math.min(i.l,t.l-o)):s.end>t.r&&(o=(s.end-t.r)/g,i.r=Math.max(i.r,t.r+o)),h.start<t.t?(n=(t.t-h.start)/m,i.t=Math.min(i.t,t.t-n)):h.end>t.b&&(n=(h.end-t.b)/m,i.b=Math.max(i.b,t.b+n))}function Yu(i,t,e){const s=i.drawingArea,{extra:h,additionalAngle:g,padding:m,size:o}=e,n=i.getPointPosition(t,s+h+m,g),l=Math.round(Gn(It(n.angle+Tt))),u=Ku(n.y,o.h,l),r=$u(l),c=qu(n.x,o.w,r);return{visible:!0,x:n.x,y:u,textAlign:r,left:c,top:u,right:c+o.w,bottom:u+o.h}}function Uu(i,t){if(!t)return!0;const{left:e,top:s,right:h,bottom:g}=i;return!(ne({x:e,y:s},t)||ne({x:e,y:g},t)||ne({x:h,y:s},t)||ne({x:h,y:g},t))}function Gu(i,t,e){const s=[],h=i._pointLabels.length,g=i.options,{centerPointLabels:m,display:o}=g.pointLabels,n={extra:zn(g)/2,additionalAngle:m?bt/h:0};let l;for(let u=0;u<h;u++){n.padding=e[u],n.size=t[u];const r=Yu(i,u,n);s.push(r),o==="auto"&&(r.visible=Uu(r,l),r.visible&&(l=r))}return s}function $u(i){return i===0||i===180?"center":i<180?"left":"right"}function qu(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function Ku(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function Ju(i,t,e){const{left:s,top:h,right:g,bottom:m}=e,{backdropColor:o}=t;if(!ut(o)){const n=Se(t.borderRadius),l=At(t.backdropPadding);i.fillStyle=o;const u=s-l.left,r=h-l.top,c=g-s+l.width,a=m-h+l.height;Object.values(n).some(f=>f!==0)?(i.beginPath(),ci(i,{x:u,y:r,w:c,h:a,radius:n}),i.fill()):i.fillRect(u,r,c,a)}}function Qu(i,t){const{ctx:e,options:{pointLabels:s}}=i;for(let h=t-1;h>=0;h--){const g=i._pointLabelItems[h];if(!g.visible)continue;const m=s.setContext(i.getPointLabelContext(h));Ju(e,m,g);const o=kt(m.font),{x:n,y:l,textAlign:u}=g;ke(e,i._pointLabels[h],n,l+o.lineHeight/2,o,{color:m.color,textAlign:u,textBaseline:"middle"})}}function Fo(i,t,e,s){const{ctx:h}=i;if(e)h.arc(i.xCenter,i.yCenter,t,0,_t);else{let g=i.getPointPosition(0,t);h.moveTo(g.x,g.y);for(let m=1;m<s;m++)g=i.getPointPosition(m,t),h.lineTo(g.x,g.y)}}function Zu(i,t,e,s,h){const g=i.ctx,m=t.circular,{color:o,lineWidth:n}=t;!m&&!s||!o||!n||e<0||(g.save(),g.strokeStyle=o,g.lineWidth=n,g.setLineDash(h.dash),g.lineDashOffset=h.dashOffset,g.beginPath(),Fo(i,e,m,s),g.closePath(),g.stroke(),g.restore())}function tf(i,t,e){return de(i,{label:e,index:t,type:"pointLabel"})}class Je extends en{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=At(zn(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=St(t)&&!isNaN(t)?t:0,this.max=St(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/zn(this.options))}generateTickLabels(t){en.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const h=gt(this.options.pointLabels.callback,[e,s],this);return h||h===0?h:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?Vu(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,h){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,h))}getIndexAngle(t){const e=_t/(this._pointLabels.length||1),s=this.options.startAngle||0;return It(t*e+Vt(s))}getDistanceFromCenterForValue(t){if(ut(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(ut(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return tf(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const h=this.getIndexAngle(t)-Tt+s;return{x:Math.cos(h)*e+this.xCenter,y:Math.sin(h)*e+this.yCenter,angle:h}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:h,bottom:g}=this._pointLabelItems[t];return{left:e,top:s,right:h,bottom:g}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),Fo(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:h,border:g}=e,m=this._pointLabels.length;let o,n,l;if(e.pointLabels.display&&Qu(this,m),h.display&&this.ticks.forEach((u,r)=>{if(r!==0){n=this.getDistanceFromCenterForValue(u.value);const c=this.getContext(r),a=h.setContext(c),f=g.setContext(c);Zu(this,a,n,m,f)}}),s.display){for(t.save(),o=m-1;o>=0;o--){const u=s.setContext(this.getPointLabelContext(o)),{color:r,lineWidth:c}=u;!c||!r||(t.lineWidth=c,t.strokeStyle=r,t.setLineDash(u.borderDash),t.lineDashOffset=u.borderDashOffset,n=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(o,n),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const h=this.getIndexAngle(0);let g,m;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(h),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((o,n)=>{if(n===0&&!e.reverse)return;const l=s.setContext(this.getContext(n)),u=kt(l.font);if(g=this.getDistanceFromCenterForValue(this.ticks[n].value),l.showLabelBackdrop){t.font=u.string,m=t.measureText(o.label).width,t.fillStyle=l.backdropColor;const r=At(l.backdropPadding);t.fillRect(-m/2-r.left,-g-u.size/2-r.top,m+r.width,u.size+r.height)}ke(t,o.label,0,-g,u,{color:l.color,strokeColor:l.textStrokeColor,strokeWidth:l.textStrokeWidth})}),t.restore()}drawTitle(){}}Z(Je,"id","radialLinear"),Z(Je,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:sn.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),Z(Je,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Z(Je,"descriptors",{angleLines:{_fallback:"grid"}});const ln={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Lt=Object.keys(ln);function kr(i,t){return i-t}function Pr(i,t){if(ut(t))return null;const e=i._adapter,{parser:s,round:h,isoWeekday:g}=i._parseOpts;let m=t;return typeof s=="function"&&(m=s(m)),St(m)||(m=typeof s=="string"?e.parse(m,s):e.parse(m)),m===null?null:(h&&(m=h==="week"&&(Be(g)||g===!0)?e.startOf(m,"isoWeek",g):e.startOf(m,h)),+m)}function Mr(i,t,e,s){const h=Lt.length;for(let g=Lt.indexOf(i);g<h-1;++g){const m=ln[Lt[g]],o=m.steps?m.steps:Number.MAX_SAFE_INTEGER;if(m.common&&Math.ceil((e-t)/(o*m.size))<=s)return Lt[g]}return Lt[h-1]}function ef(i,t,e,s,h){for(let g=Lt.length-1;g>=Lt.indexOf(e);g--){const m=Lt[g];if(ln[m].common&&i._adapter.diff(h,s,m)>=t-1)return m}return Lt[e?Lt.indexOf(e):0]}function nf(i){for(let t=Lt.indexOf(i)+1,e=Lt.length;t<e;++t)if(ln[Lt[t]].common)return Lt[t]}function Dr(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:s,hi:h}=$n(e,t),g=e[s]>=t?e[s]:e[h];i[g]=!0}}function sf(i,t,e,s){const h=i._adapter,g=+h.startOf(t[0].value,s),m=t[t.length-1].value;let o,n;for(o=g;o<=m;o=+h.add(o,1,s))n=e[o],n>=0&&(t[n].major=!0);return t}function Ar(i,t,e){const s=[],h={},g=t.length;let m,o;for(m=0;m<g;++m)o=t[m],h[o]=m,s.push({value:o,major:!1});return g===0||!e?s:sf(i,s,h,e)}class di extends Me{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),h=this._adapter=new fh._date(t.adapters.date);h.init(e),Ze(s.displayFormats,h.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Pr(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:h,max:g,minDefined:m,maxDefined:o}=this.getUserBounds();function n(l){!m&&!isNaN(l.min)&&(h=Math.min(h,l.min)),!o&&!isNaN(l.max)&&(g=Math.max(g,l.max))}(!m||!o)&&(n(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&n(this.getMinMax(!1))),h=St(h)&&!isNaN(h)?h:+e.startOf(Date.now(),s),g=St(g)&&!isNaN(g)?g:+e.endOf(Date.now(),s)+1,this.min=Math.min(h,g-1),this.max=Math.max(h+1,g)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,h=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const g=this.min,m=this.max,o=Ba(h,g,m);return this._unit=e.unit||(s.autoSkip?Mr(e.minUnit,this.min,this.max,this._getLabelCapacity(g)):ef(this,o.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:nf(this._unit),this.initOffsets(h),t.reverse&&o.reverse(),Ar(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,h,g;this.options.offset&&t.length&&(h=this.getDecimalForValue(t[0]),t.length===1?e=1-h:e=(this.getDecimalForValue(t[1])-h)/2,g=this.getDecimalForValue(t[t.length-1]),t.length===1?s=g:s=(g-this.getDecimalForValue(t[t.length-2]))/2);const m=t.length<3?.5:.25;e=Pt(e,0,m),s=Pt(s,0,m),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,h=this.options,g=h.time,m=g.unit||Mr(g.minUnit,e,s,this._getLabelCapacity(e)),o=lt(h.ticks.stepSize,1),n=m==="week"?g.isoWeekday:!1,l=Be(n)||n===!0,u={};let r=e,c,a;if(l&&(r=+t.startOf(r,"isoWeek",n)),r=+t.startOf(r,l?"day":m),t.diff(s,e,m)>1e5*o)throw new Error(e+" and "+s+" are too far apart with stepSize of "+o+" "+m);const f=h.ticks.source==="data"&&this.getDataTimestamps();for(c=r,a=0;c<s;c=+t.add(c,o,m),a++)Dr(u,c,f);return(c===s||h.bounds==="ticks"||a===1)&&Dr(u,c,f),Object.keys(u).sort(kr).map(p=>+p)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const h=this.options.time.displayFormats,g=this._unit,m=e||h[g];return this._adapter.format(t,m)}_tickFormatFunction(t,e,s,h){const g=this.options,m=g.ticks.callback;if(m)return gt(m,[t,e,s],this);const o=g.time.displayFormats,n=this._unit,l=this._majorUnit,u=n&&o[n],r=l&&o[l],c=s[e],a=l&&r&&c&&c.major;return this._adapter.format(t,h||(a?r:u))}generateTickLabels(t){let e,s,h;for(e=0,s=t.length;e<s;++e)h=t[e],h.label=this._tickFormatFunction(h.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,h=Vt(this.isHorizontal()?e.maxRotation:e.minRotation),g=Math.cos(h),m=Math.sin(h),o=this._resolveTickFontOptions(0).size;return{w:s*g+o*m,h:s*m+o*g}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,h=s[e.unit]||s.millisecond,g=this._tickFormatFunction(t,0,Ar(this,[t],this._majorUnit),h),m=this._getLabelSize(g),o=Math.floor(this.isHorizontal()?this.width/m.w:this.height/m.h)-1;return o>0?o:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(e=0,s=h.length;e<s;++e)t=t.concat(h[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const h=this.getLabels();for(e=0,s=h.length;e<s;++e)t.push(Pr(this,h[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Xr(t.sort(kr))}}Z(di,"id","time"),Z(di,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ri(i,t,e){let s=0,h=i.length-1,g,m,o,n;e?(t>=i[s].pos&&t<=i[h].pos&&({lo:s,hi:h}=ie(i,"pos",t)),{pos:g,time:o}=i[s],{pos:m,time:n}=i[h]):(t>=i[s].time&&t<=i[h].time&&({lo:s,hi:h}=ie(i,"time",t)),{time:g,pos:o}=i[s],{time:m,pos:n}=i[h]);const l=m-g;return l?o+(n-o)*(t-g)/l:o}class Wn extends di{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Ri(e,this.min),this._tableRange=Ri(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,h=[],g=[];let m,o,n,l,u;for(m=0,o=t.length;m<o;++m)l=t[m],l>=e&&l<=s&&h.push(l);if(h.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(m=0,o=h.length;m<o;++m)u=h[m+1],n=h[m-1],l=h[m],Math.round((u+n)/2)!==l&&g.push({time:l,pos:m/(o-1)});return g}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((h,g)=>h-g)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(Ri(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return Ri(this._table,s*this._tableRange+this._minPos,!0)}}Z(Wn,"id","timeseries"),Z(Wn,"defaults",di.defaults);var rf=Object.freeze({__proto__:null,CategoryScale:In,LinearScale:Bn,LogarithmicScale:jn,RadialLinearScale:Je,TimeScale:di,TimeSeriesScale:Wn});const of=[uh,Hc,Ru,rf];te.register(...of);function af(i){let t,e,s,h,g,m,o,n,l;return{c(){t=pt("label"),e=Wt(`Number of Clusters (K)
    `),s=pt("input"),h=Nt(),g=pt("label"),m=Wt(`Max Iteration
    `),o=pt("input"),Ht(s,"type","number"),Ht(o,"type","number")},m(u,r){xt(u,t,r),Ct(t,e),Ct(t,s),Bt(s,i[0].n_clusters),xt(u,h,r),xt(u,g,r),Ct(g,m),Ct(g,o),Bt(o,i[0].max_iter),n||(l=[ce(s,"input",i[1]),ce(o,"input",i[2])],n=!0)},p(u,[r]){r&1&&qt(s.value)!==u[0].n_clusters&&Bt(s,u[0].n_clusters),r&1&&qt(o.value)!==u[0].max_iter&&Bt(o,u[0].max_iter)},i:zt,o:zt,d(u){u&&(mt(t),mt(h),mt(g)),n=!1,Pe(l)}}}function lf(i,t,e){let{param:s}=t;function h(){s.n_clusters=qt(this.value),e(0,s)}function g(){s.max_iter=qt(this.value),e(0,s)}return i.$$set=m=>{"param"in m&&e(0,s=m.param)},[s,h,g]}class hf extends _i{constructor(t){super(),vi(this,t,lf,af,gi,{param:0})}}function cf(i){let t,e,s,h,g;return{c(){t=pt("label"),e=Wt(`K
    `),s=pt("input"),Ht(s,"type","number")},m(m,o){xt(m,t,o),Ct(t,e),Ct(t,s),Bt(s,i[0].k),h||(g=ce(s,"input",i[1]),h=!0)},p(m,[o]){o&1&&qt(s.value)!==m[0].k&&Bt(s,m[0].k)},i:zt,o:zt,d(m){m&&mt(t),h=!1,g()}}}function uf(i,t,e){let{param:s}=t;function h(){s.k=qt(this.value),e(0,s)}return i.$$set=g=>{"param"in g&&e(0,s=g.param)},[s,h]}class ff extends _i{constructor(t){super(),vi(this,t,uf,cf,gi,{param:0})}}function df(i){let t,e,s,h,g,m,o,n,l;return{c(){t=pt("label"),e=Wt(`Learning Rate
    `),s=pt("input"),h=Nt(),g=pt("label"),m=Wt(`Max Iteration
    `),o=pt("input"),Ht(s,"type","number"),Ht(s,"min","0.0"),Ht(s,"step","0.01"),Ht(o,"type","number"),Ht(o,"min","1")},m(u,r){xt(u,t,r),Ct(t,e),Ct(t,s),Bt(s,i[0].learning_rate),xt(u,h,r),xt(u,g,r),Ct(g,m),Ct(g,o),Bt(o,i[0].max_iter),n||(l=[ce(s,"input",i[1]),ce(o,"input",i[2])],n=!0)},p(u,[r]){r&1&&qt(s.value)!==u[0].learning_rate&&Bt(s,u[0].learning_rate),r&1&&qt(o.value)!==u[0].max_iter&&Bt(o,u[0].max_iter)},i:zt,o:zt,d(u){u&&(mt(t),mt(h),mt(g)),n=!1,Pe(l)}}}function gf(i,t,e){let{param:s}=t;function h(){s.learning_rate=qt(this.value),e(0,s)}function g(){s.max_iter=qt(this.value),e(0,s)}return i.$$set=m=>{"param"in m&&e(0,s=m.param)},[s,h,g]}class pf extends _i{constructor(t){super(),vi(this,t,gf,df,gi,{param:0})}}function mf(i){const t=new te(i,{type:"line",data:{labels:[],datasets:[{label:"Training Dataset",data:[]},{label:"Testing Dataset",data:[]}]},options:{scales:{x:{type:"linear",min:0,title:{display:!0,text:"# of Iteration"}},y:{type:"linear",min:0,max:1,title:{display:!0,text:"Error Rate"}}}}});return{chart:t,append(e,s){var h;t.data.datasets.map((g,m)=>g.data.push(e[m])),(h=t.data.labels)==null||h.push(s),t.update()},reset(){t.data.datasets.forEach(e=>e.data=[]),t.data.labels=[],t.update()}}}function vf(i){return{sendCommand(t,e){i.postMessage({cmd:t,data:e})},handleCommand(t){i.onmessage=e=>t(e.data)}}}class _f{constructor(){Z(this,"pipe");Z(this,"onstep_cb");this.pipe=vf(new Worker(new URL("/digit-recognizer/assets/wasm.worker-ad72e4d2.js",self.location),{type:"module"})),this.pipe.handleCommand(({cmd:t,data:e})=>{var s;t=="step"&&((s=this.onstep_cb)==null||s.call(null,e))})}start_training(t,e){const s={type:t,param:e};this.pipe.sendCommand("start_training",s)}stop_training(){this.pipe.sendCommand("stop_training",null)}set onstep(t){this.onstep_cb=t}}function bf(i){let t,e,s,h,g;function m(n){i[7](n)}let o={};return i[0].param.perceptron!==void 0&&(o.param=i[0].param.perceptron),s=new pf({props:o}),ri.push(()=>Nn(s,"param",m)),{c(){t=pt("h3"),t.textContent="Perceptron (1-layer Neural Network) Hyperparameters",e=Nt(),nn(s.$$.fragment)},m(n,l){xt(n,t,l),xt(n,e,l),pi(s,n,l),g=!0},p(n,l){const u={};!h&&l&1&&(h=!0,u.param=n[0].param.perceptron,Hn(()=>h=!1)),s.$set(u)},i(n){g||(Te(s.$$.fragment,n),g=!0)},o(n){Ie(s.$$.fragment,n),g=!1},d(n){n&&(mt(t),mt(e)),mi(s,n)}}}function yf(i){let t,e,s,h,g;function m(n){i[6](n)}let o={};return i[0].param.knn!==void 0&&(o.param=i[0].param.knn),s=new ff({props:o}),ri.push(()=>Nn(s,"param",m)),{c(){t=pt("h3"),t.textContent="K Nearest Neighbors Hyperparameters",e=Nt(),nn(s.$$.fragment)},m(n,l){xt(n,t,l),xt(n,e,l),pi(s,n,l),g=!0},p(n,l){const u={};!h&&l&1&&(h=!0,u.param=n[0].param.knn,Hn(()=>h=!1)),s.$set(u)},i(n){g||(Te(s.$$.fragment,n),g=!0)},o(n){Ie(s.$$.fragment,n),g=!1},d(n){n&&(mt(t),mt(e)),mi(s,n)}}}function xf(i){let t,e,s,h,g;function m(n){i[5](n)}let o={};return i[0].param.kmeans!==void 0&&(o.param=i[0].param.kmeans),s=new hf({props:o}),ri.push(()=>Nn(s,"param",m)),{c(){t=pt("h3"),t.textContent="K Means Hyperparameters",e=Nt(),nn(s.$$.fragment)},m(n,l){xt(n,t,l),xt(n,e,l),pi(s,n,l),g=!0},p(n,l){const u={};!h&&l&1&&(h=!0,u.param=n[0].param.kmeans,Hn(()=>h=!1)),s.$set(u)},i(n){g||(Te(s.$$.fragment,n),g=!0)},o(n){Ie(s.$$.fragment,n),g=!1},d(n){n&&(mt(t),mt(e)),mi(s,n)}}}function Cf(i){let t,e,s;return{c(){t=pt("button"),t.textContent="Stop Training"},m(h,g){xt(h,t,g),e||(s=ce(t,"click",i[9]),e=!0)},p:zt,d(h){h&&mt(t),e=!1,s()}}}function Sf(i){let t,e,s;return{c(){t=pt("button"),t.textContent="Start Training"},m(h,g){xt(h,t,g),e||(s=ce(t,"click",i[8]),e=!0)},p:zt,d(h){h&&mt(t),e=!1,s()}}}function wf(i){let t,e,s,h,g,m,o,n,l,u,r,c,a,f,p=i[0].selected+"",d,v,_=JSON.stringify(i[0].param[i[0].selected])+"",b,y,x,C,S,O;const E=[xf,yf,bf],R=[];function W(B,K){return B[0].selected=="kmeans"?0:B[0].selected=="knn"?1:B[0].selected=="perceptron"?2:-1}~(n=W(i))&&(l=R[n]=E[n](i));function X(B,K){return B[0].is_training==!1?Sf:Cf}let Q=X(i),$=Q(i);return{c(){t=pt("label"),e=Wt(`Select a machine learning model to train:
    `),s=pt("select"),h=pt("option"),h.textContent="K Means",g=pt("option"),g.textContent="K Nearest Neighbors",m=pt("option"),m.textContent="Perceptron (1-layer Neural Network)",o=Nt(),l&&l.c(),u=Nt(),r=pt("div"),$.c(),c=Nt(),a=pt("p"),f=Wt("Training "),d=Wt(p),v=Wt(", using params: "),b=Wt(_),y=Nt(),x=pt("canvas"),h.__value="kmeans",Bt(h,h.__value),g.__value="knn",Bt(g,g.__value),m.__value="perceptron",Bt(m,m.__value),i[0].selected===void 0&&Gi(()=>i[4].call(s)),Ht(r,"class","grid"),Ht(x,"id","training_chart")},m(B,K){xt(B,t,K),Ct(t,e),Ct(t,s),Ct(s,h),Ct(s,g),Ct(s,m),ls(s,i[0].selected,!0),xt(B,o,K),~n&&R[n].m(B,K),xt(B,u,K),xt(B,r,K),$.m(r,null),xt(B,c,K),xt(B,a,K),Ct(a,f),Ct(a,d),Ct(a,v),Ct(a,b),xt(B,y,K),xt(B,x,K),C=!0,S||(O=ce(s,"change",i[4]),S=!0)},p(B,[K]){K&1&&ls(s,B[0].selected);let tt=n;n=W(B),n===tt?~n&&R[n].p(B,K):(l&&(Go(),Ie(R[tt],1,1,()=>{R[tt]=null}),$o()),~n?(l=R[n],l?l.p(B,K):(l=R[n]=E[n](B),l.c()),Te(l,1),l.m(u.parentNode,u)):l=null),Q===(Q=X(B))&&$?$.p(B,K):($.d(1),$=Q(B),$&&($.c(),$.m(r,null))),(!C||K&1)&&p!==(p=B[0].selected+"")&&as(d,p),(!C||K&1)&&_!==(_=JSON.stringify(B[0].param[B[0].selected])+"")&&as(b,_)},i(B){C||(Te(l),C=!0)},o(B){Ie(l),C=!1},d(B){B&&(mt(t),mt(o),mt(u),mt(r),mt(c),mt(a),mt(y),mt(x)),~n&&R[n].d(B),$.d(),S=!1,O()}}}function Tf(i,t,e){const s=new _f,h={selected:"kmeans",is_training:!1,param:{kmeans:{max_iter:100,n_clusters:10},knn:{k:10},perceptron:{max_iter:100,learning_rate:.01}}};let g;Lr(()=>{e(3,g=mf("training_chart"))});function m(){g.reset(),s.start_training(h.selected,h.param[h.selected])}function o(){s.stop_training()}s.onstep=f=>{console.log(`[main][step]: ${f.i}: train: ${f.training_err}, test: ${f.testing_err}`),g.append([f.training_err,f.testing_err],f.i)};function n(){h.selected=Ho(this),e(0,h)}function l(f){i.$$.not_equal(h.param.kmeans,f)&&(h.param.kmeans=f,e(0,h))}function u(f){i.$$.not_equal(h.param.knn,f)&&(h.param.knn=f,e(0,h))}function r(f){i.$$.not_equal(h.param.perceptron,f)&&(h.param.perceptron=f,e(0,h))}const c=()=>{e(0,h.is_training=!0,h),m()},a=()=>{e(0,h.is_training=!1,h),o()};return i.$$.update=()=>{var f;if(i.$$.dirty&9&&g&&((f=g.chart.options.scales)==null?void 0:f.x)!=null){let p=h.param[h.selected];"max_iter"in p&&(e(3,g.chart.options.scales.x.max=p.max_iter,g),g.chart.update())}},[h,m,o,g,n,l,u,r,c,a]}class Of extends _i{constructor(t){super(),vi(this,t,Tf,wf,gi,{})}}function kf(i){let t,e,s,h,g,m,o;return m=new Of({}),{c(){t=pt("main"),e=pt("h1"),e.textContent="Digit Recognizer",s=Nt(),h=pt("h2"),h.textContent="Train your own model!",g=Nt(),nn(m.$$.fragment),Ht(t,"class","container")},m(n,l){xt(n,t,l),Ct(t,e),Ct(t,s),Ct(t,h),Ct(t,g),pi(m,t,null),o=!0},p:zt,i(n){o||(Te(m.$$.fragment,n),o=!0)},o(n){Ie(m.$$.fragment,n),o=!1},d(n){n&&mt(t),mi(m)}}}function Pf(i){return Lr(()=>{}),[]}class Mf extends _i{constructor(t){super(),vi(this,t,Pf,kf,gi,{})}}new Mf({target:document.getElementById("app")});
