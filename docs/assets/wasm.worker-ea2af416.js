var Q=Object.defineProperty;var X=(r,f,i)=>f in r?Q(r,f,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[f]=i;var M=(r,f,i)=>(X(r,typeof f!="symbol"?f+"":f,i),i);(function(){"use strict";let r;const f=new Array(128).fill(void 0);f.push(void 0,null,!0,!1);function i(n){return f[n]}let p=f.length;function z(n){n<132||(f[n]=p,p=n)}function F(n){const t=i(n);return z(n),t}const O=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&O.decode();let m=null;function h(){return(m===null||m.byteLength===0)&&(m=new Uint8Array(r.memory.buffer)),m}function T(n,t){return n=n>>>0,O.decode(h().subarray(n,n+t))}function c(n){p===f.length&&f.push(f.length+1);const t=p;return p=f[t],f[t]=n,t}function d(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`);return n.ptr}let y=null;function I(){return(y===null||y.byteLength===0)&&(y=new Float64Array(r.memory.buffer)),y}let g=0;function R(n,t){const e=t(n.length*8,8)>>>0;return I().set(n,e/8),g=n.length,e}let v=null;function l(){return(v===null||v.byteLength===0)&&(v=new Int32Array(r.memory.buffer)),v}function C(n,t){return n=n>>>0,I().subarray(n/8,n/8+t)}function L(){r.set_panic_hook()}function A(n,t){const e=t(n.length*1,1)>>>0;return h().set(n,e/1),g=n.length,e}const W=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},D=typeof W.encodeInto=="function"?function(n,t){return W.encodeInto(n,t)}:function(n,t){const e=W.encode(n);return t.set(e),{read:n.length,written:e.length}};function q(n,t,e){if(e===void 0){const u=W.encode(n),k=t(u.length,1)>>>0;return h().subarray(k,k+u.length).set(u),g=u.length,k}let _=n.length,o=t(_,1)>>>0;const a=h();let s=0;for(;s<_;s++){const u=n.charCodeAt(s);if(u>127)break;a[o+s]=u}if(s!==_){s!==0&&(n=n.slice(s)),o=e(o,_,_=s+n.length*3,1)>>>0;const u=h().subarray(o+s,o+_),k=D(n,u);s+=k.written}return g=s,o}function b(n,t){try{return n.apply(this,t)}catch(e){r.__wbindgen_exn_store(c(e))}}class w{static __wrap(t){t=t>>>0;const e=Object.create(w.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_dataset_free(t)}}class j{static __wrap(t){t=t>>>0;const e=Object.create(j.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_kmeans_free(t)}constructor(t,e){const _=r.kmeans_new(t,e);return j.__wrap(_)}step(t){return d(t,w),r.kmeans_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return d(t,w),r.kmeans_evaluate(this.__wbg_ptr,t.__wbg_ptr)}predict(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),s=R(t,r.__wbindgen_malloc),u=g;r.kmeans_predict(a,this.__wbg_ptr,s,u);var e=l()[a/4+0],_=l()[a/4+1],o=C(e,_).slice();return r.__wbindgen_free(e,_*8),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class x{static __wrap(t){t=t>>>0;const e=Object.create(x.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_knearestneighbors_free(t)}constructor(t){const e=r.knearestneighbors_new(t);return x.__wrap(e)}step(t){return d(t,w),r.knearestneighbors_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return d(t,w),r.knearestneighbors_evaluate(this.__wbg_ptr,t.__wbg_ptr)}predict(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),s=R(t,r.__wbindgen_malloc),u=g;r.knearestneighbors_predict(a,this.__wbg_ptr,s,u);var e=l()[a/4+0],_=l()[a/4+1],o=C(e,_).slice();return r.__wbindgen_free(e,_*8),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class S{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_mnist_free(t)}static training_from_static(){const t=r.mnist_training_from_static();return w.__wrap(t)}static testing_from_static(){const t=r.mnist_testing_from_static();return w.__wrap(t)}static training_from_gz(t,e){const _=A(t,r.__wbindgen_malloc),o=g,a=A(e,r.__wbindgen_malloc),s=g,u=r.mnist_training_from_gz(_,o,a,s);return w.__wrap(u)}static testing_from_gz(t,e){const _=A(t,r.__wbindgen_malloc),o=g,a=A(e,r.__wbindgen_malloc),s=g,u=r.mnist_testing_from_gz(_,o,a,s);return w.__wrap(u)}}class E{static __wrap(t){t=t>>>0;const e=Object.create(E.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_perceptron_free(t)}constructor(t,e,_){const o=r.perceptron_new(t,e,_);return E.__wrap(o)}step(t){return d(t,w),r.perceptron_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return d(t,w),r.perceptron_evaluate(this.__wbg_ptr,t.__wbg_ptr)}predict(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),s=R(t,r.__wbindgen_malloc),u=g;r.perceptron_predict(a,this.__wbg_ptr,s,u);var e=l()[a/4+0],_=l()[a/4+1],o=C(e,_).slice();return r.__wbindgen_free(e,_*8),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}}async function V(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(_){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await n.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(n,t);return e instanceof WebAssembly.Instance?{instance:e,module:n}:e}}function $(){const n={};return n.wbg={},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return c(t)},n.wbg.__wbg_stack_658279fe44541cf6=function(t,e){const _=i(e).stack,o=q(_,r.__wbindgen_malloc,r.__wbindgen_realloc),a=g;l()[t/4+1]=a,l()[t/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(t,e){let _,o;try{_=t,o=e,console.error(T(t,e))}finally{r.__wbindgen_free(_,o,1)}},n.wbg.__wbindgen_object_drop_ref=function(t){F(t)},n.wbg.__wbg_randomFillSync_dc1e9a60c158336d=function(){return b(function(t,e){i(t).randomFillSync(F(e))},arguments)},n.wbg.__wbg_getRandomValues_37fa2ca9e4e07fab=function(){return b(function(t,e){i(t).getRandomValues(i(e))},arguments)},n.wbg.__wbg_crypto_c48a774b022d20ac=function(t){const e=i(t).crypto;return c(e)},n.wbg.__wbindgen_is_object=function(t){const e=i(t);return typeof e=="object"&&e!==null},n.wbg.__wbg_process_298734cf255a885d=function(t){const e=i(t).process;return c(e)},n.wbg.__wbg_versions_e2e78e134e3e5d01=function(t){const e=i(t).versions;return c(e)},n.wbg.__wbg_node_1cd7a5d853dbea79=function(t){const e=i(t).node;return c(e)},n.wbg.__wbindgen_is_string=function(t){return typeof i(t)=="string"},n.wbg.__wbg_require_8f08ceecec0f4fee=function(){return b(function(){const t=module.require;return c(t)},arguments)},n.wbg.__wbindgen_string_new=function(t,e){const _=T(t,e);return c(_)},n.wbg.__wbg_msCrypto_bcb970640f50a1e8=function(t){const e=i(t).msCrypto;return c(e)},n.wbg.__wbindgen_is_function=function(t){return typeof i(t)=="function"},n.wbg.__wbg_newnoargs_581967eacc0e2604=function(t,e){const _=new Function(T(t,e));return c(_)},n.wbg.__wbg_call_cb65541d95d71282=function(){return b(function(t,e){const _=i(t).call(i(e));return c(_)},arguments)},n.wbg.__wbg_self_1ff1d729e9aae938=function(){return b(function(){const t=self.self;return c(t)},arguments)},n.wbg.__wbg_window_5f4faef6c12b79ec=function(){return b(function(){const t=window.window;return c(t)},arguments)},n.wbg.__wbg_globalThis_1d39714405582d3c=function(){return b(function(){const t=globalThis.globalThis;return c(t)},arguments)},n.wbg.__wbg_global_651f05c6a0944d1c=function(){return b(function(){const t=global.global;return c(t)},arguments)},n.wbg.__wbindgen_is_undefined=function(t){return i(t)===void 0},n.wbg.__wbg_call_01734de55d61e11d=function(){return b(function(t,e,_){const o=i(t).call(i(e),i(_));return c(o)},arguments)},n.wbg.__wbg_buffer_085ec1f694018c4f=function(t){const e=i(t).buffer;return c(e)},n.wbg.__wbg_newwithbyteoffsetandlength_6da8e527659b86aa=function(t,e,_){const o=new Uint8Array(i(t),e>>>0,_>>>0);return c(o)},n.wbg.__wbg_new_8125e318e6245eed=function(t){const e=new Uint8Array(i(t));return c(e)},n.wbg.__wbg_set_5cf90238115182c3=function(t,e,_){i(t).set(i(e),_>>>0)},n.wbg.__wbg_newwithlength_e5d69174d6984cd7=function(t){const e=new Uint8Array(t>>>0);return c(e)},n.wbg.__wbg_subarray_13db269f57aa838d=function(t,e,_){const o=i(t).subarray(e>>>0,_>>>0);return c(o)},n.wbg.__wbindgen_object_clone_ref=function(t){const e=i(t);return c(e)},n.wbg.__wbindgen_throw=function(t,e){throw new Error(T(t,e))},n.wbg.__wbindgen_memory=function(){const t=r.memory;return c(t)},n}function B(n,t){return r=n.exports,U.__wbindgen_wasm_module=t,y=null,v=null,m=null,r}async function U(n){if(r!==void 0)return r;typeof n>"u"&&(n=new URL("/digit-recognizer/assets/mnist_bg-ed10e288.wasm",self.location));const t=$();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:_}=await V(await n,t);return B(e,_)}function H(n){return{sendCommand(t,e){n.postMessage({cmd:t,data:e})},handleCommand(t){n.onmessage=e=>t(e.data)},sendCommandTransfer(t,e){n.postMessage({cmd:t,data:e},[e.buffer])}}}function G({type:n,param:t}){switch(n){case"kmeans":return new j(t.n_clusters,28*28);case"knn":return new x(t.k);case"perceptron":return new E(t.learning_rate,28*28,10);default:return}}class J{constructor(t){M(this,"pipe");M(this,"model");M(this,"interval_id");this.pipe=t}start_training(t,e){this.stop_training(),this.model!=null&&(this.model.free(),this.model=void 0),this.model=G(t);let _=0;this.interval_id=setInterval(()=>{var s,u;const o=(s=this.model)==null?void 0:s.step(e.training),a=(u=this.model)==null?void 0:u.evaluate(e.testing);_++,this.pipe.sendCommand("step",{i:_,training_err:o,testing_err:a}),(!("max_iter"in t.param)||_>=t.param.max_iter)&&this.stop_training()})}stop_training(){clearInterval(this.interval_id),this.interval_id=void 0}predict(t){if(this.model){const e=this.model.predict(t);this.pipe.sendCommandTransfer("prediction",e)}}}async function N(){const n=performance.now();await U();const t=performance.now();console.log(`wasm init took ${t-n} milliseconds`),L();const e=H(self),_=new J(e),o={training:S.training_from_static(),testing:S.testing_from_static()};e.handleCommand(({cmd:a,data:s})=>{switch(a){case"start_training":console.log("[Worker] Received start training event"),console.table(s),_.start_training(s,o);break;case"stop_training":console.log("[Worker] Received stop training event"),_.stop_training();break;case"predict":console.log("[Worker] Received predict event"),console.log(`[Worker] data.length: ${s.length}`),_.predict(s);break}})}N()})();
