var jo=Object.defineProperty;var zo=(i,t,e)=>t in i?jo(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Z=(i,t,e)=>(zo(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function e(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function s(h){if(h.ep)return;h.ep=!0;const g=e(h);fetch(h.href,g)}})();function Ht(){}function Er(i){return i()}function os(){return Object.create(null)}function de(i){i.forEach(Er)}function Fr(i){return typeof i=="function"}function gi(i,t){return i!=i?t==t:i!==t||i&&typeof i=="object"||typeof i=="function"}function Wo(i){return Object.keys(i).length===0}function ut(i,t){i.appendChild(t)}function _t(i,t,e){i.insertBefore(t,e||null)}function mt(i){i.parentNode&&i.parentNode.removeChild(i)}function ft(i){return document.createElement(i)}function Nt(i){return document.createTextNode(i)}function Dt(){return Nt(" ")}function se(i,t,e,s){return i.addEventListener(t,e,s),()=>i.removeEventListener(t,e,s)}function Lt(i,t,e){e==null?i.removeAttribute(t):i.getAttribute(t)!==e&&i.setAttribute(t,e)}function Kt(i){return i===""?null:+i}function Ho(i){return Array.from(i.childNodes)}function as(i,t){t=""+t,i.data!==t&&(i.data=t)}function zt(i,t){i.value=t??""}function No(i,t,e,s){e==null?i.style.removeProperty(t):i.style.setProperty(t,e,s?"important":"")}function ls(i,t,e){for(let s=0;s<i.options.length;s+=1){const h=i.options[s];if(h.__value===t){h.selected=!0;return}}(!e||t!==void 0)&&(i.selectedIndex=-1)}function Vo(i){const t=i.querySelector(":checked");return t&&t.__value}let si;function Qe(i){si=i}function Xo(){if(!si)throw new Error("Function called outside component initialization");return si}function Lr(i){Xo().$$.on_mount.push(i)}const Fe=[],ri=[];let Le=[];const Sn=[],Yo=Promise.resolve();let wn=!1;function Uo(){wn||(wn=!0,Yo.then(Rr))}function Gi(i){Le.push(i)}function Hn(i){Sn.push(i)}const hn=new Set;let De=0;function Rr(){if(De!==0)return;const i=si;do{try{for(;De<Fe.length;){const t=Fe[De];De++,Qe(t),Go(t.$$)}}catch(t){throw Fe.length=0,De=0,t}for(Qe(null),Fe.length=0,De=0;ri.length;)ri.pop()();for(let t=0;t<Le.length;t+=1){const e=Le[t];hn.has(e)||(hn.add(e),e())}Le.length=0}while(Fe.length);for(;Sn.length;)Sn.pop()();wn=!1,hn.clear(),Qe(i)}function Go(i){if(i.fragment!==null){i.update(),de(i.before_update);const t=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,t),i.after_update.forEach(Gi)}}function $o(i){const t=[],e=[];Le.forEach(s=>i.indexOf(s)===-1?t.push(s):e.push(s)),e.forEach(s=>s()),Le=t}const Bi=new Set;let Ce;function qo(){Ce={r:0,c:[],p:Ce}}function Ko(){Ce.r||de(Ce.c),Ce=Ce.p}function Oe(i,t){i&&i.i&&(Bi.delete(i),i.i(t))}function Ie(i,t,e,s){if(i&&i.o){if(Bi.has(i))return;Bi.add(i),Ce.c.push(()=>{Bi.delete(i),s&&(e&&i.d(1),s())}),i.o(t)}else s&&s()}function Nn(i,t,e){const s=i.$$.props[t];s!==void 0&&(i.$$.bound[s]=e,e(i.$$.ctx[s]))}function nn(i){i&&i.c()}function pi(i,t,e){const{fragment:s,after_update:h}=i.$$;s&&s.m(t,e),Gi(()=>{const g=i.$$.on_mount.map(Er).filter(Fr);i.$$.on_destroy?i.$$.on_destroy.push(...g):de(g),i.$$.on_mount=[]}),h.forEach(Gi)}function mi(i,t){const e=i.$$;e.fragment!==null&&($o(e.after_update),de(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Jo(i,t){i.$$.dirty[0]===-1&&(Fe.push(i),Uo(),i.$$.dirty.fill(0)),i.$$.dirty[t/31|0]|=1<<t%31}function vi(i,t,e,s,h,g,m,r=[-1]){const n=si;Qe(i);const l=i.$$={fragment:null,ctx:[],props:g,update:Ht,not_equal:h,bound:os(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(n?n.$$.context:[])),callbacks:os(),dirty:r,skip_bound:!1,root:t.target||n.$$.root};m&&m(l.root);let u=!1;if(l.ctx=e?e(i,t.props||{},(o,c,...a)=>{const d=a.length?a[0]:c;return l.ctx&&h(l.ctx[o],l.ctx[o]=d)&&(!l.skip_bound&&l.bound[o]&&l.bound[o](d),u&&Jo(i,o)),c}):[],l.update(),u=!0,de(l.before_update),l.fragment=s?s(l.ctx):!1,t.target){if(t.hydrate){const o=Ho(t.target);l.fragment&&l.fragment.l(o),o.forEach(mt)}else l.fragment&&l.fragment.c();t.intro&&Oe(i.$$.fragment),pi(i,t.target,t.anchor),Rr()}Qe(n)}class _i{constructor(){Z(this,"$$");Z(this,"$$set")}$destroy(){mi(this,1),this.$destroy=Ht}$on(t,e){if(!Fr(e))return Ht;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const h=s.indexOf(e);h!==-1&&s.splice(h,1)}}$set(t){this.$$set&&!Wo(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Qo="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Qo);function Zo(i){let t,e,s,h,g,m,r,n,l;return{c(){t=ft("label"),e=Nt(`Number of Clusters (K)
    `),s=ft("input"),h=Dt(),g=ft("label"),m=Nt(`Max Iteration
    `),r=ft("input"),Lt(s,"type","number"),Lt(r,"type","number")},m(u,o){_t(u,t,o),ut(t,e),ut(t,s),zt(s,i[0].n_clusters),_t(u,h,o),_t(u,g,o),ut(g,m),ut(g,r),zt(r,i[0].max_iter),n||(l=[se(s,"input",i[1]),se(r,"input",i[2])],n=!0)},p(u,[o]){o&1&&Kt(s.value)!==u[0].n_clusters&&zt(s,u[0].n_clusters),o&1&&Kt(r.value)!==u[0].max_iter&&zt(r,u[0].max_iter)},i:Ht,o:Ht,d(u){u&&(mt(t),mt(h),mt(g)),n=!1,de(l)}}}function ta(i,t,e){let{param:s}=t;function h(){s.n_clusters=Kt(this.value),e(0,s)}function g(){s.max_iter=Kt(this.value),e(0,s)}return i.$$set=m=>{"param"in m&&e(0,s=m.param)},[s,h,g]}class ea extends _i{constructor(t){super(),vi(this,t,ta,Zo,gi,{param:0})}}function ia(i){let t,e,s,h,g;return{c(){t=ft("label"),e=Nt(`K
    `),s=ft("input"),Lt(s,"type","number")},m(m,r){_t(m,t,r),ut(t,e),ut(t,s),zt(s,i[0].k),h||(g=se(s,"input",i[1]),h=!0)},p(m,[r]){r&1&&Kt(s.value)!==m[0].k&&zt(s,m[0].k)},i:Ht,o:Ht,d(m){m&&mt(t),h=!1,g()}}}function na(i,t,e){let{param:s}=t;function h(){s.k=Kt(this.value),e(0,s)}return i.$$set=g=>{"param"in g&&e(0,s=g.param)},[s,h]}class sa extends _i{constructor(t){super(),vi(this,t,na,ia,gi,{param:0})}}function ra(i){let t,e,s,h,g,m,r,n,l;return{c(){t=ft("label"),e=Nt(`Learning Rate
    `),s=ft("input"),h=Dt(),g=ft("label"),m=Nt(`Max Iteration
    `),r=ft("input"),Lt(s,"type","number"),Lt(s,"min","0.0"),Lt(s,"step","0.01"),Lt(r,"type","number"),Lt(r,"min","1")},m(u,o){_t(u,t,o),ut(t,e),ut(t,s),zt(s,i[0].learning_rate),_t(u,h,o),_t(u,g,o),ut(g,m),ut(g,r),zt(r,i[0].max_iter),n||(l=[se(s,"input",i[1]),se(r,"input",i[2])],n=!0)},p(u,[o]){o&1&&Kt(s.value)!==u[0].learning_rate&&zt(s,u[0].learning_rate),o&1&&Kt(r.value)!==u[0].max_iter&&zt(r,u[0].max_iter)},i:Ht,o:Ht,d(u){u&&(mt(t),mt(h),mt(g)),n=!1,de(l)}}}function oa(i,t,e){let{param:s}=t;function h(){s.learning_rate=Kt(this.value),e(0,s)}function g(){s.max_iter=Kt(this.value),e(0,s)}return i.$$set=m=>{"param"in m&&e(0,s=m.param)},[s,h,g]}class aa extends _i{constructor(t){super(),vi(this,t,oa,ra,gi,{param:0})}}function la(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var h=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(e,s,h.get?h:{enumerable:!0,get:function(){return i[s]}})}),e}var Ir={};const ha={},ca=Object.freeze(Object.defineProperty({__proto__:null,default:ha},Symbol.toStringTag,{value:"Module"})),cn=la(ca);(function(i){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(i.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var e=cn,s=new e.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=s.document,t.jsdomImplForWrapper=cn.implForWrapper,t.nodeCanvas=cn.Canvas,t.window=s,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function r(a,d){if(this.__eventListeners[a]){var p=this.__eventListeners[a];d?p[p.indexOf(d)]=!1:t.util.array.fill(p,!1)}}function n(a,d){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var p in a)this.on(p,a[p]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(d);return this}function l(a,d){var p=(function(){d.apply(this,arguments),this.off(a,p)}).bind(this);this.on(a,p)}function u(a,d){if(arguments.length===1)for(var p in a)l.call(this,p,a[p]);else l.call(this,a,d);return this}function o(a,d){if(!this.__eventListeners)return this;if(arguments.length===0)for(a in this.__eventListeners)r.call(this,a);else if(arguments.length===1&&typeof arguments[0]=="object")for(var p in a)r.call(this,p,a[p]);else r.call(this,a,d);return this}function c(a,d){if(!this.__eventListeners)return this;var p=this.__eventListeners[a];if(!p)return this;for(var f=0,v=p.length;f<v;f++)p[f]&&p[f].call(this,d||{});return this.__eventListeners[a]=p.filter(function(_){return _!==!1}),this}t.Observable={fire:c,on:n,once:u,off:o}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var r=0,n=arguments.length;r<n;r++)this._onObjectAdded(arguments[r]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(r,n,l){var u=this._objects;return l?u[n]=r:u.splice(n,0,r),this._onObjectAdded&&this._onObjectAdded(r),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var r=this._objects,n,l=!1,u=0,o=arguments.length;u<o;u++)n=r.indexOf(arguments[u]),n!==-1&&(l=!0,r.splice(n,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(r,n){for(var l=this.getObjects(),u=0,o=l.length;u<o;u++)r.call(n,l[u],u,l);return this},getObjects:function(r){return typeof r>"u"?this._objects.concat():this._objects.filter(function(n){return n.type===r})},item:function(r){return this._objects[r]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(r,n){return this._objects.indexOf(r)>-1?!0:n?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(r,!0)}):!1},complexity:function(){return this._objects.reduce(function(r,n){return r+=n.complexity?n.complexity():0,r},0)}},t.CommonMethods={_setOptions:function(r){for(var n in r)this.set(n,r[n])},_initGradient:function(r,n){r&&r.colorStops&&!(r instanceof t.Gradient)&&this.set(n,new t.Gradient(r))},_initPattern:function(r,n,l){r&&r.source&&!(r instanceof t.Pattern)?this.set(n,new t.Pattern(r,l)):l&&l()},_setObject:function(r){for(var n in r)this._set(n,r[n])},set:function(r,n){return typeof r=="object"?this._setObject(r):this._set(r,n),this},_set:function(r,n){this[r]=n},toggle:function(r){var n=this.get(r);return typeof n=="boolean"&&this.set(r,!n),this},get:function(r){return this[r]}},function(r){var n=Math.sqrt,l=Math.atan2,u=Math.pow,o=Math.PI/180,c=Math.PI/2;t.util={cos:function(a){if(a===0)return 1;a<0&&(a=-a);var d=a/c;switch(d){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(a===0)return 0;var d=a/c,p=1;switch(a<0&&(p=-1),d){case 1:return p;case 2:return 0;case 3:return-p}return Math.sin(a)},removeFromArray:function(a,d){var p=a.indexOf(d);return p!==-1&&a.splice(p,1),a},getRandomInt:function(a,d){return Math.floor(Math.random()*(d-a+1))+a},degreesToRadians:function(a){return a*o},radiansToDegrees:function(a){return a/o},rotatePoint:function(a,d,p){var f=new t.Point(a.x-d.x,a.y-d.y),v=t.util.rotateVector(f,p);return new t.Point(v.x,v.y).addEquals(d)},rotateVector:function(a,d){var p=t.util.sin(d),f=t.util.cos(d),v=a.x*f-a.y*p,_=a.x*p+a.y*f;return{x:v,y:_}},createVector:function(a,d){return new t.Point(d.x-a.x,d.y-a.y)},calcAngleBetweenVectors:function(a,d){return Math.acos((a.x*d.x+a.y*d.y)/(Math.hypot(a.x,a.y)*Math.hypot(d.x,d.y)))},getHatVector:function(a){return new t.Point(a.x,a.y).multiply(1/Math.hypot(a.x,a.y))},getBisector:function(a,d,p){var f=t.util.createVector(a,d),v=t.util.createVector(a,p),_=t.util.calcAngleBetweenVectors(f,v),b=t.util.calcAngleBetweenVectors(t.util.rotateVector(f,_),v),y=_*(b===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(f,y)),angle:_}},projectStrokeOnPoints:function(a,d,p){var f=[],v=d.strokeWidth/2,_=d.strokeUniform?new t.Point(1/d.scaleX,1/d.scaleY):new t.Point(1,1),b=function(y){var x=v/Math.hypot(y.x,y.y);return new t.Point(y.x*x*_.x,y.y*x*_.y)};return a.length<=1||a.forEach(function(y,x){var C=new t.Point(y.x,y.y),S,O;x===0?(O=a[x+1],S=p?b(t.util.createVector(O,C)).addEquals(C):a[a.length-1]):x===a.length-1?(S=a[x-1],O=p?b(t.util.createVector(S,C)).addEquals(C):a[0]):(S=a[x-1],O=a[x+1]);var F=t.util.getBisector(C,S,O),R=F.vector,z=F.angle,X,J;if(d.strokeLineJoin==="miter"&&(X=-v/Math.sin(z/2),J=new t.Point(R.x*X*_.x,R.y*X*_.y),Math.hypot(J.x,J.y)/v<=d.strokeMiterLimit)){f.push(C.add(J)),f.push(C.subtract(J));return}X=-v*Math.SQRT2,J=new t.Point(R.x*X*_.x,R.y*X*_.y),f.push(C.add(J)),f.push(C.subtract(J))}),f},transformPoint:function(a,d,p){return p?new t.Point(d[0]*a.x+d[2]*a.y,d[1]*a.x+d[3]*a.y):new t.Point(d[0]*a.x+d[2]*a.y+d[4],d[1]*a.x+d[3]*a.y+d[5])},makeBoundingBoxFromPoints:function(a,d){if(d)for(var p=0;p<a.length;p++)a[p]=t.util.transformPoint(a[p],d);var f=[a[0].x,a[1].x,a[2].x,a[3].x],v=t.util.array.min(f),_=t.util.array.max(f),b=_-v,y=[a[0].y,a[1].y,a[2].y,a[3].y],x=t.util.array.min(y),C=t.util.array.max(y),S=C-x;return{left:v,top:x,width:b,height:S}},invertTransform:function(a){var d=1/(a[0]*a[3]-a[1]*a[2]),p=[d*a[3],-d*a[1],-d*a[2],d*a[0]],f=t.util.transformPoint({x:a[4],y:a[5]},p,!0);return p[4]=-f.x,p[5]=-f.y,p},toFixed:function(a,d){return parseFloat(Number(a).toFixed(d))},parseUnit:function(a,d){var p=/\D{0,2}$/.exec(a),f=parseFloat(a);switch(d||(d=t.Text.DEFAULT_SVG_FONT_SIZE),p[0]){case"mm":return f*t.DPI/25.4;case"cm":return f*t.DPI/2.54;case"in":return f*t.DPI;case"pt":return f*t.DPI/72;case"pc":return f*t.DPI/72*12;case"em":return f*d;default:return f}},falseFunction:function(){return!1},getKlass:function(a,d){return a=t.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),t.util.resolveNamespace(d)[a]},getSvgAttributes:function(a){var d=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":d=d.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":d=d.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":d=d.concat(["offset","stop-color","stop-opacity"]);break}return d},resolveNamespace:function(a){if(!a)return t;var d=a.split("."),p=d.length,f,v=r||t.window;for(f=0;f<p;++f)v=v[d[f]];return v},loadImage:function(a,d,p,f){if(!a){d&&d.call(p,a);return}var v=t.util.createImage(),_=function(){d&&d.call(p,v,!1),v=v.onload=v.onerror=null};v.onload=_,v.onerror=function(){t.log("Error loading "+v.src),d&&d.call(p,null,!0),v=v.onload=v.onerror=null},a.indexOf("data")!==0&&f!==void 0&&f!==null&&(v.crossOrigin=f),a.substring(0,14)==="data:image/svg"&&(v.onload=null,t.util.loadImageInDom(v,_)),v.src=a},loadImageInDom:function(a,d){var p=t.document.createElement("div");p.style.width=p.style.height="1px",p.style.left=p.style.top="-100%",p.style.position="absolute",p.appendChild(a),t.document.querySelector("body").appendChild(p),a.onload=function(){d(),p.parentNode.removeChild(p),p=null}},enlivenObjects:function(a,d,p,f){a=a||[];var v=[],_=0,b=a.length;function y(){++_===b&&d&&d(v.filter(function(x){return x}))}if(!b){d&&d(v);return}a.forEach(function(x,C){if(!x||!x.type){y();return}var S=t.util.getKlass(x.type,p);S.fromObject(x,function(O,F){F||(v[C]=O),f&&f(x,O,F),y()})})},enlivenObjectEnlivables:function(a,d,p){var f=t.Object.ENLIVEN_PROPS.filter(function(v){return!!a[v]});t.util.enlivenObjects(f.map(function(v){return a[v]}),function(v){var _={};f.forEach(function(b,y){_[b]=v[y],d&&(d[b]=v[y])}),p&&p(_)})},enlivenPatterns:function(a,d){a=a||[];function p(){++v===_&&d&&d(f)}var f=[],v=0,_=a.length;if(!_){d&&d(f);return}a.forEach(function(b,y){b&&b.source?new t.Pattern(b,function(x){f[y]=x,p()}):(f[y]=b,p())})},groupSVGElements:function(a,d,p){var f;return a&&a.length===1?(typeof p<"u"&&(a[0].sourcePath=p),a[0]):(d&&(d.width&&d.height?d.centerPoint={x:d.width/2,y:d.height/2}:(delete d.width,delete d.height)),f=new t.Group(a,d),typeof p<"u"&&(f.sourcePath=p),f)},populateWithProperties:function(a,d,p){if(p&&Array.isArray(p))for(var f=0,v=p.length;f<v;f++)p[f]in a&&(d[p[f]]=a[p[f]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(a){var d=t.util.createCanvasElement();return d.width=a.width,d.height=a.height,d.getContext("2d").drawImage(a,0,0),d},toDataURL:function(a,d,p){return a.toDataURL("image/"+d,p)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(a,d,p){return[a[0]*d[0]+a[2]*d[1],a[1]*d[0]+a[3]*d[1],a[0]*d[2]+a[2]*d[3],a[1]*d[2]+a[3]*d[3],p?0:a[0]*d[4]+a[2]*d[5]+a[4],p?0:a[1]*d[4]+a[3]*d[5]+a[5]]},qrDecompose:function(a){var d=l(a[1],a[0]),p=u(a[0],2)+u(a[1],2),f=n(p),v=(a[0]*a[3]-a[2]*a[1])/f,_=l(a[0]*a[2]+a[1]*a[3],p);return{angle:d/o,scaleX:f,scaleY:v,skewX:_/o,skewY:0,translateX:a[4],translateY:a[5]}},calcRotateMatrix:function(a){if(!a.angle)return t.iMatrix.concat();var d=t.util.degreesToRadians(a.angle),p=t.util.cos(d),f=t.util.sin(d);return[p,f,-f,p,0,0]},calcDimensionsMatrix:function(a){var d=typeof a.scaleX>"u"?1:a.scaleX,p=typeof a.scaleY>"u"?1:a.scaleY,f=[a.flipX?-d:d,0,0,a.flipY?-p:p,0,0],v=t.util.multiplyTransformMatrices,_=t.util.degreesToRadians;return a.skewX&&(f=v(f,[1,0,Math.tan(_(a.skewX)),1],!0)),a.skewY&&(f=v(f,[1,Math.tan(_(a.skewY)),0,1],!0)),f},composeMatrix:function(a){var d=[1,0,0,1,a.translateX||0,a.translateY||0],p=t.util.multiplyTransformMatrices;return a.angle&&(d=p(d,t.util.calcRotateMatrix(a))),(a.scaleX!==1||a.scaleY!==1||a.skewX||a.skewY||a.flipX||a.flipY)&&(d=p(d,t.util.calcDimensionsMatrix(a))),d},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},isTransparent:function(a,d,p,f){f>0&&(d>f?d-=f:d=0,p>f?p-=f:p=0);var v=!0,_,b,y=a.getImageData(d,p,f*2||1,f*2||1),x=y.data.length;for(_=3;_<x&&(b=y.data[_],v=b<=0,v!==!1);_+=4);return y=null,v},parsePreserveAspectRatioAttribute:function(a){var d="meet",p="Mid",f="Mid",v=a.split(" "),_;return v&&v.length&&(d=v.pop(),d!=="meet"&&d!=="slice"?(_=d,d="meet"):v.length&&(_=v.pop())),p=_!=="none"?_.slice(1,4):"none",f=_!=="none"?_.slice(5,8):"none",{meetOrSlice:d,alignX:p,alignY:f}},clearFabricFontCache:function(a){a=(a||"").toLowerCase(),a?t.charWidthsCache[a]&&delete t.charWidthsCache[a]:t.charWidthsCache={}},limitDimsByArea:function(a,d){var p=Math.sqrt(d*a),f=Math.floor(d/p);return{x:Math.floor(p),y:f}},capValue:function(a,d,p){return Math.max(a,Math.min(d,p))},findScaleToFit:function(a,d){return Math.min(d.width/a.width,d.height/a.height)},findScaleToCover:function(a,d){return Math.max(d.width/a.width,d.height/a.height)},matrixToSVG:function(a){return"matrix("+a.map(function(d){return t.util.toFixed(d,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(a,d){var p=t.util.invertTransform(d),f=t.util.multiplyTransformMatrices(p,a.calcOwnMatrix());t.util.applyTransformToObject(a,f)},addTransformToObject:function(a,d){t.util.applyTransformToObject(a,t.util.multiplyTransformMatrices(d,a.calcOwnMatrix()))},applyTransformToObject:function(a,d){var p=t.util.qrDecompose(d),f=new t.Point(p.translateX,p.translateY);a.flipX=!1,a.flipY=!1,a.set("scaleX",p.scaleX),a.set("scaleY",p.scaleY),a.skewX=p.skewX,a.skewY=p.skewY,a.angle=p.angle,a.setPositionByOrigin(f,"center","center")},sizeAfterTransform:function(a,d,p){var f=a/2,v=d/2,_=[{x:-f,y:-v},{x:f,y:-v},{x:-f,y:v},{x:f,y:v}],b=t.util.calcDimensionsMatrix(p),y=t.util.makeBoundingBoxFromPoints(_,b);return{x:y.width,y:y.height}},mergeClipPaths:function(a,d){var p=a,f=d;p.inverted&&!f.inverted&&(p=d,f=a),t.util.applyTransformToObject(f,t.util.multiplyTransformMatrices(t.util.invertTransform(p.calcTransformMatrix()),f.calcTransformMatrix()));var v=p.inverted&&f.inverted;return v&&(p.inverted=f.inverted=!1),new t.Group([p],{clipPath:f,inverted:v})},hasStyleChanged:function(a,d,p){return p=p||!1,a.fill!==d.fill||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth||a.fontSize!==d.fontSize||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.textBackgroundColor!==d.textBackgroundColor||a.deltaY!==d.deltaY||p&&(a.overline!==d.overline||a.underline!==d.underline||a.linethrough!==d.linethrough)},stylesToArray:function(p,d){for(var p=t.util.object.clone(p,!0),f=d.split(`
`),v=-1,_={},b=[],y=0;y<f.length;y++){if(!p[y]){v+=f[y].length;continue}for(var x=0;x<f[y].length;x++){v++;var C=p[y][x];if(C&&Object.keys(C).length>0){var S=t.util.hasStyleChanged(_,C,!0);S?b.push({start:v,end:v+1,style:C}):b[b.length-1].end++}_=C||{}}}return b},stylesFromArray:function(a,d){if(!Array.isArray(a))return a;for(var p=d.split(`
`),f=-1,v=0,_={},b=0;b<p.length;b++)for(var y=0;y<p[b].length;y++)f++,a[v]&&a[v].start<=f&&f<a[v].end&&(_[b]=_[b]||{},_[b][y]=Object.assign({},a[v].style),f===a[v].end-1&&v++);return _}}}(i),function(){var r=Array.prototype.join,n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function u(w,M,D,P,I,k,T,A,E,B,j){var G=t.util.cos(w),K=t.util.sin(w),it=t.util.cos(M),W=t.util.sin(M),L=D*I*it-P*k*W+T,Y=P*I*it+D*k*W+A,U=B+E*(-D*I*K-P*k*G),H=j+E*(-P*I*K+D*k*G),$=L+E*(D*I*W+P*k*it),nt=Y+E*(P*I*W-D*k*it);return["C",U,H,$,nt,L,Y]}function o(w,M,D,P,I,k,T){var A=Math.PI,E=T*A/180,B=t.util.sin(E),j=t.util.cos(E),G=0,K=0;D=Math.abs(D),P=Math.abs(P);var it=-j*w*.5-B*M*.5,W=-j*M*.5+B*w*.5,L=D*D,Y=P*P,U=W*W,H=it*it,$=L*Y-L*U-Y*H,nt=0;if($<0){var ot=Math.sqrt(1-$/(L*Y));D*=ot,P*=ot}else nt=(I===k?-1:1)*Math.sqrt($/(L*U+Y*H));var st=nt*D*W/P,N=-nt*P*it/D,rt=j*st-B*N+w*.5,at=B*st+j*N+M*.5,ct=c(1,0,(it-st)/D,(W-N)/P),Ct=c((it-st)/D,(W-N)/P,(-it-st)/D,(-W-N)/P);k===0&&Ct>0?Ct-=2*A:k===1&&Ct<0&&(Ct+=2*A);for(var gt=Math.ceil(Math.abs(Ct/A*2)),Ft=[],Ot=Ct/gt,pe=8/3*Math.sin(Ot/4)*Math.sin(Ot/4)/Math.sin(Ot/2),We=ct+Ot,Yt=0;Yt<gt;Yt++)Ft[Yt]=u(ct,We,j,B,D,P,rt,at,pe,G,K),G=Ft[Yt][5],K=Ft[Yt][6],ct=We,We+=Ot;return Ft}function c(w,M,D,P){var I=Math.atan2(M,w),k=Math.atan2(P,D);return k>=I?k-I:2*Math.PI-(I-k)}function a(w,M,D,P,I,k,T,A){var E;if(t.cachesBoundsOfCurve&&(E=r.call(arguments),t.boundsOfCurveCache[E]))return t.boundsOfCurveCache[E];var B=Math.sqrt,j=Math.min,G=Math.max,K=Math.abs,it=[],W=[[],[]],L,Y,U,H,$,nt,ot,st;Y=6*w-12*D+6*I,L=-3*w+9*D-9*I+3*T,U=3*D-3*w;for(var N=0;N<2;++N){if(N>0&&(Y=6*M-12*P+6*k,L=-3*M+9*P-9*k+3*A,U=3*P-3*M),K(L)<1e-12){if(K(Y)<1e-12)continue;H=-U/Y,0<H&&H<1&&it.push(H);continue}ot=Y*Y-4*U*L,!(ot<0)&&(st=B(ot),$=(-Y+st)/(2*L),0<$&&$<1&&it.push($),nt=(-Y-st)/(2*L),0<nt&&nt<1&&it.push(nt))}for(var rt,at,ct=it.length,Ct=ct,gt;ct--;)H=it[ct],gt=1-H,rt=gt*gt*gt*w+3*gt*gt*H*D+3*gt*H*H*I+H*H*H*T,W[0][ct]=rt,at=gt*gt*gt*M+3*gt*gt*H*P+3*gt*H*H*k+H*H*H*A,W[1][ct]=at;W[0][Ct]=w,W[1][Ct]=M,W[0][Ct+1]=T,W[1][Ct+1]=A;var Ft=[{x:j.apply(null,W[0]),y:j.apply(null,W[1])},{x:G.apply(null,W[0]),y:G.apply(null,W[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[E]=Ft),Ft}function d(w,M,D){for(var P=D[1],I=D[2],k=D[3],T=D[4],A=D[5],E=D[6],B=D[7],j=o(E-w,B-M,P,I,T,A,k),G=0,K=j.length;G<K;G++)j[G][1]+=w,j[G][2]+=M,j[G][3]+=w,j[G][4]+=M,j[G][5]+=w,j[G][6]+=M;return j}function p(w){var M=0,D=0,P=w.length,I=0,k=0,T,A,E,B=[],j,G,K;for(A=0;A<P;++A){switch(E=!1,T=w[A].slice(0),T[0]){case"l":T[0]="L",T[1]+=M,T[2]+=D;case"L":M=T[1],D=T[2];break;case"h":T[1]+=M;case"H":T[0]="L",T[2]=D,M=T[1];break;case"v":T[1]+=D;case"V":T[0]="L",D=T[1],T[1]=M,T[2]=D;break;case"m":T[0]="M",T[1]+=M,T[2]+=D;case"M":M=T[1],D=T[2],I=T[1],k=T[2];break;case"c":T[0]="C",T[1]+=M,T[2]+=D,T[3]+=M,T[4]+=D,T[5]+=M,T[6]+=D;case"C":G=T[3],K=T[4],M=T[5],D=T[6];break;case"s":T[0]="S",T[1]+=M,T[2]+=D,T[3]+=M,T[4]+=D;case"S":j==="C"?(G=2*M-G,K=2*D-K):(G=M,K=D),M=T[3],D=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=G,T[2]=K,G=T[3],K=T[4];break;case"q":T[0]="Q",T[1]+=M,T[2]+=D,T[3]+=M,T[4]+=D;case"Q":G=T[1],K=T[2],M=T[3],D=T[4];break;case"t":T[0]="T",T[1]+=M,T[2]+=D;case"T":j==="Q"?(G=2*M-G,K=2*D-K):(G=M,K=D),T[0]="Q",M=T[1],D=T[2],T[1]=G,T[2]=K,T[3]=M,T[4]=D;break;case"a":T[0]="A",T[6]+=M,T[7]+=D;case"A":E=!0,B=B.concat(d(M,D,T)),M=T[6],D=T[7];break;case"z":case"Z":M=I,D=k;break}E||B.push(T),j=T[0]}return B}function f(w,M,D,P){return Math.sqrt((D-w)*(D-w)+(P-M)*(P-M))}function v(w){return w*w*w}function _(w){return 3*w*w*(1-w)}function b(w){return 3*w*(1-w)*(1-w)}function y(w){return(1-w)*(1-w)*(1-w)}function x(w,M,D,P,I,k,T,A){return function(E){var B=v(E),j=_(E),G=b(E),K=y(E);return{x:T*B+I*j+D*G+w*K,y:A*B+k*j+P*G+M*K}}}function C(w,M,D,P,I,k,T,A){return function(E){var B=1-E,j=3*B*B*(D-w)+6*B*E*(I-D)+3*E*E*(T-I),G=3*B*B*(P-M)+6*B*E*(k-P)+3*E*E*(A-k);return Math.atan2(G,j)}}function S(w){return w*w}function O(w){return 2*w*(1-w)}function F(w){return(1-w)*(1-w)}function R(w,M,D,P,I,k){return function(T){var A=S(T),E=O(T),B=F(T);return{x:I*A+D*E+w*B,y:k*A+P*E+M*B}}}function z(w,M,D,P,I,k){return function(T){var A=1-T,E=2*A*(D-w)+2*T*(I-D),B=2*A*(P-M)+2*T*(k-P);return Math.atan2(B,E)}}function X(w,M,D){var P={x:M,y:D},I,k=0,T;for(T=1;T<=100;T+=1)I=w(T/100),k+=f(P.x,P.y,I.x,I.y),P=I;return k}function J(w,M){for(var D=0,P=0,I=w.iterator,k={x:w.x,y:w.y},T,A,E=.01,B=w.angleFinder,j;P<M&&E>1e-4;)T=I(D),j=D,A=f(k.x,k.y,T.x,T.y),A+P>M?(D-=E,E/=2):(k=T,D+=E,P+=A);return T.angle=B(j),T}function q(w){for(var M=0,D=w.length,P,I=0,k=0,T=0,A=0,E=[],B,j,G,K=0;K<D;K++){switch(P=w[K],j={x:I,y:k,command:P[0]},P[0]){case"M":j.length=0,T=I=P[1],A=k=P[2];break;case"L":j.length=f(I,k,P[1],P[2]),I=P[1],k=P[2];break;case"C":B=x(I,k,P[1],P[2],P[3],P[4],P[5],P[6]),G=C(I,k,P[1],P[2],P[3],P[4],P[5],P[6]),j.iterator=B,j.angleFinder=G,j.length=X(B,I,k),I=P[5],k=P[6];break;case"Q":B=R(I,k,P[1],P[2],P[3],P[4]),G=z(I,k,P[1],P[2],P[3],P[4]),j.iterator=B,j.angleFinder=G,j.length=X(B,I,k),I=P[3],k=P[4];break;case"Z":case"z":j.destX=T,j.destY=A,j.length=f(I,k,T,A),I=T,k=A;break}M+=j.length,E.push(j)}return E.push({length:M,x:I,y:k}),E}function V(w,M,D){D||(D=q(w));for(var P=0;M-D[P].length>0&&P<D.length-2;)M-=D[P].length,P++;var I=D[P],k=M/I.length,T=I.command,A=w[P],E;switch(T){case"M":return{x:I.x,y:I.y,angle:0};case"Z":case"z":return E=new t.Point(I.x,I.y).lerp(new t.Point(I.destX,I.destY),k),E.angle=Math.atan2(I.destY-I.y,I.destX-I.x),E;case"L":return E=new t.Point(I.x,I.y).lerp(new t.Point(A[1],A[2]),k),E.angle=Math.atan2(A[2]-I.y,A[1]-I.x),E;case"C":return J(I,M);case"Q":return J(I,M)}}function Q(w){var M=[],D=[],P,I,k=t.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",A="("+T+")"+t.commaWsp,E="([01])"+t.commaWsp+"?",B=A+"?"+A+"?"+A+E+E+A+"?("+T+")",j=new RegExp(B,"g"),G,K,it;if(!w||!w.match)return M;it=w.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var W=0,L,Y=it.length;W<Y;W++){P=it[W],K=P.slice(1).trim(),D.length=0;var U=P.charAt(0);if(L=[U],U.toLowerCase()==="a")for(var H;H=j.exec(K);)for(var $=1;$<H.length;$++)D.push(H[$]);else for(;G=k.exec(K);)D.push(G[0]);for(var $=0,nt=D.length;$<nt;$++)I=parseFloat(D[$]),isNaN(I)||L.push(I);var ot=n[U.toLowerCase()],st=l[U]||U;if(L.length-1>ot)for(var N=1,rt=L.length;N<rt;N+=ot)M.push([U].concat(L.slice(N,N+ot))),U=st;else M.push(L)}return M}function tt(w,M){var D=[],P,I=new t.Point(w[0].x,w[0].y),k=new t.Point(w[1].x,w[1].y),T=w.length,A=1,E=0,B=T>2;for(M=M||0,B&&(A=w[2].x<k.x?-1:w[2].x===k.x?0:1,E=w[2].y<k.y?-1:w[2].y===k.y?0:1),D.push(["M",I.x-A*M,I.y-E*M]),P=1;P<T;P++){if(!I.eq(k)){var j=I.midPointFrom(k);D.push(["Q",I.x,I.y,j.x,j.y])}I=w[P],P+1<w.length&&(k=w[P+1])}return B&&(A=I.x>w[P-2].x?1:I.x===w[P-2].x?0:-1,E=I.y>w[P-2].y?1:I.y===w[P-2].y?0:-1),D.push(["L",I.x+A*M,I.y+E*M]),D}function et(w,M,D){return D&&(M=t.util.multiplyTransformMatrices(M,[1,0,0,1,-D.x,-D.y])),w.map(function(P){for(var I=P.slice(0),k={},T=1;T<P.length-1;T+=2)k.x=P[T],k.y=P[T+1],k=t.util.transformPoint(k,M),I[T]=k.x,I[T+1]=k.y;return I})}t.util.joinPath=function(w){return w.map(function(M){return M.join(" ")}).join(" ")},t.util.parsePath=Q,t.util.makePathSimpler=p,t.util.getSmoothPathFromPoints=tt,t.util.getPathSegmentsInfo=q,t.util.getBoundsOfCurve=a,t.util.getPointOnPath=V,t.util.transformPath=et}(),function(){var r=Array.prototype.slice;function n(a,d){for(var p=r.call(arguments,2),f=[],v=0,_=a.length;v<_;v++)f[v]=p.length?a[v][d].apply(a[v],p):a[v][d].call(a[v]);return f}function l(a,d){return c(a,d,function(p,f){return p>=f})}function u(a,d){return c(a,d,function(p,f){return p<f})}function o(a,d){for(var p=a.length;p--;)a[p]=d;return a}function c(a,d,p){if(!(!a||a.length===0)){var f=a.length-1,v=d?a[f][d]:a[f];if(d)for(;f--;)p(a[f][d],v)&&(v=a[f][d]);else for(;f--;)p(a[f],v)&&(v=a[f]);return v}}t.util.array={fill:o,invoke:n,min:u,max:l}}(),function(){function r(l,u,o){if(o)if(!t.isLikelyNode&&u instanceof Element)l=u;else if(u instanceof Array){l=[];for(var c=0,a=u.length;c<a;c++)l[c]=r({},u[c],o)}else if(u&&typeof u=="object")for(var d in u)d==="canvas"||d==="group"?l[d]=null:u.hasOwnProperty(d)&&(l[d]=r({},u[d],o));else l=u;else for(var d in u)l[d]=u[d];return l}function n(l,u){return r({},l,u)}t.util.object={extend:r,clone:n},t.util.object.extend(t.util,t.Observable)}(),function(){function r(c){return c.replace(/-+(.)?/g,function(a,d){return d?d.toUpperCase():""})}function n(c,a){return c.charAt(0).toUpperCase()+(a?c.slice(1):c.slice(1).toLowerCase())}function l(c){return c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(c){var a=0,d,p=[];for(a=0,d;a<c.length;a++)(d=o(c,a))!==!1&&p.push(d);return p}function o(c,a){var d=c.charCodeAt(a);if(isNaN(d))return"";if(d<55296||d>57343)return c.charAt(a);if(55296<=d&&d<=56319){if(c.length<=a+1)throw"High surrogate without following low surrogate";var p=c.charCodeAt(a+1);if(56320>p||p>57343)throw"High surrogate without following low surrogate";return c.charAt(a)+c.charAt(a+1)}if(a===0)throw"Low surrogate without preceding high surrogate";var f=c.charCodeAt(a-1);if(55296>f||f>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:r,capitalize:n,escapeXml:l,graphemeSplit:u}}(),function(){var r=Array.prototype.slice,n=function(){},l=function(){for(var d in{toString:1})if(d==="toString")return!1;return!0}(),u=function(d,p,f){for(var v in p)v in d.prototype&&typeof d.prototype[v]=="function"&&(p[v]+"").indexOf("callSuper")>-1?d.prototype[v]=function(_){return function(){var b=this.constructor.superclass;this.constructor.superclass=f;var y=p[_].apply(this,arguments);if(this.constructor.superclass=b,_!=="initialize")return y}}(v):d.prototype[v]=p[v],l&&(p.toString!==Object.prototype.toString&&(d.prototype.toString=p.toString),p.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=p.valueOf))};function o(){}function c(d){for(var p=null,f=this;f.constructor.superclass;){var v=f.constructor.superclass.prototype[d];if(f[d]!==v){p=v;break}f=f.constructor.superclass.prototype}return p?arguments.length>1?p.apply(this,r.call(arguments,1)):p.call(this):console.log("tried to callSuper "+d+", method not found in prototype chain",this)}function a(){var d=null,p=r.call(arguments,0);typeof p[0]=="function"&&(d=p.shift());function f(){this.initialize.apply(this,arguments)}f.superclass=d,f.subclasses=[],d&&(o.prototype=d.prototype,f.prototype=new o,d.subclasses.push(f));for(var v=0,_=p.length;v<_;v++)u(f,p[v],d);return f.prototype.initialize||(f.prototype.initialize=n),f.prototype.constructor=f,f.prototype.callSuper=c,f}t.util.createClass=a}(),function(){var r=!!t.document.createElement("div").attachEvent,n=["touchstart","touchmove","touchend"];t.util.addListener=function(u,o,c,a){u&&u.addEventListener(o,c,r?!1:a)},t.util.removeListener=function(u,o,c,a){u&&u.removeEventListener(o,c,r?!1:a)};function l(u){var o=u.changedTouches;return o&&o[0]?o[0]:u}t.util.getPointer=function(u){var o=u.target,c=t.util.getScrollLeftTop(o),a=l(u);return{x:a.clientX+c.left,y:a.clientY+c.top}},t.util.isTouchEvent=function(u){return n.indexOf(u.type)>-1||u.pointerType==="touch"}}(),function(){function r(a,d){var p=a.style;if(!p)return a;if(typeof d=="string")return a.style.cssText+=";"+d,d.indexOf("opacity")>-1?c(a,d.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var f in d)if(f==="opacity")c(a,d[f]);else{var v=f==="float"||f==="cssFloat"?typeof p.styleFloat>"u"?"cssFloat":"styleFloat":f;p.setProperty(v,d[f])}return a}var n=t.document.createElement("div"),l=typeof n.style.opacity=="string",u=typeof n.style.filter=="string",o=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(a){return a};l?c=function(a,d){return a.style.opacity=d,a}:u&&(c=function(a,d){var p=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(p.zoom=1),o.test(p.filter)?(d=d>=.9999?"":"alpha(opacity="+d*100+")",p.filter=p.filter.replace(o,d)):p.filter+=" alpha(opacity="+d*100+")",a}),t.util.setStyle=r}(),function(){var r=Array.prototype.slice;function n(y){return typeof y=="string"?t.document.getElementById(y):y}var l,u=function(y){return r.call(y,0)};try{l=u(t.document.childNodes)instanceof Array}catch{}l||(u=function(y){for(var x=new Array(y.length),C=y.length;C--;)x[C]=y[C];return x});function o(y,x){var C=t.document.createElement(y);for(var S in x)S==="class"?C.className=x[S]:S==="for"?C.htmlFor=x[S]:C.setAttribute(S,x[S]);return C}function c(y,x){y&&(" "+y.className+" ").indexOf(" "+x+" ")===-1&&(y.className+=(y.className?" ":"")+x)}function a(y,x,C){return typeof x=="string"&&(x=o(x,C)),y.parentNode&&y.parentNode.replaceChild(x,y),x.appendChild(y),x}function d(y){for(var x=0,C=0,S=t.document.documentElement,O=t.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&(y=y.parentNode||y.host,y===t.document?(x=O.scrollLeft||S.scrollLeft||0,C=O.scrollTop||S.scrollTop||0):(x+=y.scrollLeft||0,C+=y.scrollTop||0),!(y.nodeType===1&&y.style.position==="fixed")););return{left:x,top:C}}function p(y){var x,C=y&&y.ownerDocument,S={left:0,top:0},O={left:0,top:0},F,R={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return O;for(var z in R)O[R[z]]+=parseInt(f(y,z),10)||0;return x=C.documentElement,typeof y.getBoundingClientRect<"u"&&(S=y.getBoundingClientRect()),F=d(y),{left:S.left+F.left-(x.clientLeft||0)+O.left,top:S.top+F.top-(x.clientTop||0)+O.top}}var f;t.document.defaultView&&t.document.defaultView.getComputedStyle?f=function(y,x){var C=t.document.defaultView.getComputedStyle(y,null);return C?C[x]:void 0}:f=function(y,x){var C=y.style[x];return!C&&y.currentStyle&&(C=y.currentStyle[x]),C},function(){var y=t.document.documentElement.style,x="userSelect"in y?"userSelect":"MozUserSelect"in y?"MozUserSelect":"WebkitUserSelect"in y?"WebkitUserSelect":"KhtmlUserSelect"in y?"KhtmlUserSelect":"";function C(O){return typeof O.onselectstart<"u"&&(O.onselectstart=t.util.falseFunction),x?O.style[x]="none":typeof O.unselectable=="string"&&(O.unselectable="on"),O}function S(O){return typeof O.onselectstart<"u"&&(O.onselectstart=null),x?O.style[x]="":typeof O.unselectable=="string"&&(O.unselectable=""),O}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=S}();function v(y){var x=t.jsdomImplForWrapper(y);return x._canvas||x._image}function _(y){if(t.isLikelyNode){var x=t.jsdomImplForWrapper(y);x&&(x._image=null,x._canvas=null,x._currentSrc=null,x._attributes=null,x._classList=null)}}function b(y,x){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=x}t.util.setImageSmoothing=b,t.util.getById=n,t.util.toArray=u,t.util.addClass=c,t.util.makeElement=o,t.util.wrapElement=a,t.util.getScrollLeftTop=d,t.util.getElementOffset=p,t.util.getNodeCanvas=v,t.util.cleanUpJsdomNode=_}(),function(){function r(u,o){return u+(/\?/.test(u)?"&":"?")+o}function n(){}function l(u,o){o||(o={});var c=o.method?o.method.toUpperCase():"GET",a=o.onComplete||function(){},d=new t.window.XMLHttpRequest,p=o.body||o.parameters;return d.onreadystatechange=function(){d.readyState===4&&(a(d),d.onreadystatechange=n)},c==="GET"&&(p=null,typeof o.parameters=="string"&&(u=r(u,o.parameters))),d.open(c,u,!0),(c==="POST"||c==="PUT")&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(p),d}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var r=t.util.object.extend,n=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var v=this.splice(0);return v.forEach(function(_){_.cancel()}),v},cancelByCanvas:function(v){if(!v)return[];var _=this.filter(function(b){return typeof b.target=="object"&&b.target.canvas===v});return _.forEach(function(b){b.cancel()}),_},cancelByTarget:function(v){var _=this.findAnimationsByTarget(v);return _.forEach(function(b){b.cancel()}),_},findAnimationIndex:function(v){return this.indexOf(this.findAnimation(v))},findAnimation:function(v){return this.find(function(_){return _.cancel===v})},findAnimationsByTarget:function(v){return v?this.filter(function(_){return _.target===v}):[]}});function u(){return!1}function o(v,_,b,y){return-b*Math.cos(v/y*(Math.PI/2))+b+_}function c(v){v||(v={});var _=!1,b,y=function(){var x=t.runningAnimations.indexOf(b);return x>-1&&t.runningAnimations.splice(x,1)[0]};return b=r(n(v),{cancel:function(){return _=!0,y()},currentValue:"startValue"in v?v.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(b),p(function(x){var C=x||+new Date,S=v.duration||500,O=C+S,F,R=v.onChange||u,z=v.abort||u,X=v.onComplete||u,J=v.easing||o,q="startValue"in v?v.startValue.length>0:!1,V="startValue"in v?v.startValue:0,Q="endValue"in v?v.endValue:100,tt=v.byValue||(q?V.map(function(et,w){return Q[w]-V[w]}):Q-V);v.onStart&&v.onStart(),function et(w){F=w||+new Date;var M=F>O?S:F-C,D=M/S,P=q?V.map(function(k,T){return J(M,V[T],tt[T],S)}):J(M,V,tt,S),I=Math.abs(q?(P[0]-V[0])/tt[0]:(P-V)/tt);if(b.currentValue=q?P.slice():P,b.completionRate=I,b.durationRate=D,!_){if(z(P,I,D)){y();return}if(F>O){b.currentValue=q?Q.slice():Q,b.completionRate=1,b.durationRate=1,R(q?Q.slice():Q,1,1),X(Q,1,1),y();return}else R(P,I,D),p(et)}}(C)}),b.cancel}var a=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(v){return t.window.setTimeout(v,1e3/60)},d=t.window.cancelAnimationFrame||t.window.clearTimeout;function p(){return a.apply(t.window,arguments)}function f(){return d.apply(t.window,arguments)}t.util.animate=c,t.util.requestAnimFrame=p,t.util.cancelAnimFrame=f,t.runningAnimations=l}(),function(){function r(l,u,o){var c="rgba("+parseInt(l[0]+o*(u[0]-l[0]),10)+","+parseInt(l[1]+o*(u[1]-l[1]),10)+","+parseInt(l[2]+o*(u[2]-l[2]),10);return c+=","+(l&&u?parseFloat(l[3]+o*(u[3]-l[3])):1),c+=")",c}function n(l,u,o,c){var a=new t.Color(l).getSource(),d=new t.Color(u).getSource(),p=c.onComplete,f=c.onChange;return c=c||{},t.util.animate(t.util.object.extend(c,{duration:o||500,startValue:a,endValue:d,byValue:d,easing:function(v,_,b,y){var x=c.colorEasing?c.colorEasing(v,y):1-Math.cos(v/y*(Math.PI/2));return r(_,b,x)},onComplete:function(v,_,b){if(p)return p(r(d,d,0),_,b)},onChange:function(v,_,b){if(f){if(Array.isArray(v))return f(r(v,v,0),_,b);f(v,_,b)}}}))}t.util.animateColor=n}(),function(){function r(w,M,D,P){return w<Math.abs(M)?(w=M,P=D/4):M===0&&w===0?P=D/(2*Math.PI)*Math.asin(1):P=D/(2*Math.PI)*Math.asin(M/w),{a:w,c:M,p:D,s:P}}function n(w,M,D){return w.a*Math.pow(2,10*(M-=1))*Math.sin((M*D-w.s)*(2*Math.PI)/w.p)}function l(w,M,D,P){return D*((w=w/P-1)*w*w+1)+M}function u(w,M,D,P){return w/=P/2,w<1?D/2*w*w*w+M:D/2*((w-=2)*w*w+2)+M}function o(w,M,D,P){return D*(w/=P)*w*w*w+M}function c(w,M,D,P){return-D*((w=w/P-1)*w*w*w-1)+M}function a(w,M,D,P){return w/=P/2,w<1?D/2*w*w*w*w+M:-D/2*((w-=2)*w*w*w-2)+M}function d(w,M,D,P){return D*(w/=P)*w*w*w*w+M}function p(w,M,D,P){return D*((w=w/P-1)*w*w*w*w+1)+M}function f(w,M,D,P){return w/=P/2,w<1?D/2*w*w*w*w*w+M:D/2*((w-=2)*w*w*w*w+2)+M}function v(w,M,D,P){return-D*Math.cos(w/P*(Math.PI/2))+D+M}function _(w,M,D,P){return D*Math.sin(w/P*(Math.PI/2))+M}function b(w,M,D,P){return-D/2*(Math.cos(Math.PI*w/P)-1)+M}function y(w,M,D,P){return w===0?M:D*Math.pow(2,10*(w/P-1))+M}function x(w,M,D,P){return w===P?M+D:D*(-Math.pow(2,-10*w/P)+1)+M}function C(w,M,D,P){return w===0?M:w===P?M+D:(w/=P/2,w<1?D/2*Math.pow(2,10*(w-1))+M:D/2*(-Math.pow(2,-10*--w)+2)+M)}function S(w,M,D,P){return-D*(Math.sqrt(1-(w/=P)*w)-1)+M}function O(w,M,D,P){return D*Math.sqrt(1-(w=w/P-1)*w)+M}function F(w,M,D,P){return w/=P/2,w<1?-D/2*(Math.sqrt(1-w*w)-1)+M:D/2*(Math.sqrt(1-(w-=2)*w)+1)+M}function R(w,M,D,P){var I=1.70158,k=0,T=D;if(w===0)return M;if(w/=P,w===1)return M+D;k||(k=P*.3);var A=r(T,D,k,I);return-n(A,w,P)+M}function z(w,M,D,P){var I=1.70158,k=0,T=D;if(w===0)return M;if(w/=P,w===1)return M+D;k||(k=P*.3);var A=r(T,D,k,I);return A.a*Math.pow(2,-10*w)*Math.sin((w*P-A.s)*(2*Math.PI)/A.p)+A.c+M}function X(w,M,D,P){var I=1.70158,k=0,T=D;if(w===0)return M;if(w/=P/2,w===2)return M+D;k||(k=P*(.3*1.5));var A=r(T,D,k,I);return w<1?-.5*n(A,w,P)+M:A.a*Math.pow(2,-10*(w-=1))*Math.sin((w*P-A.s)*(2*Math.PI)/A.p)*.5+A.c+M}function J(w,M,D,P,I){return I===void 0&&(I=1.70158),D*(w/=P)*w*((I+1)*w-I)+M}function q(w,M,D,P,I){return I===void 0&&(I=1.70158),D*((w=w/P-1)*w*((I+1)*w+I)+1)+M}function V(w,M,D,P,I){return I===void 0&&(I=1.70158),w/=P/2,w<1?D/2*(w*w*(((I*=1.525)+1)*w-I))+M:D/2*((w-=2)*w*(((I*=1.525)+1)*w+I)+2)+M}function Q(w,M,D,P){return D-tt(P-w,0,D,P)+M}function tt(w,M,D,P){return(w/=P)<1/2.75?D*(7.5625*w*w)+M:w<2/2.75?D*(7.5625*(w-=1.5/2.75)*w+.75)+M:w<2.5/2.75?D*(7.5625*(w-=2.25/2.75)*w+.9375)+M:D*(7.5625*(w-=2.625/2.75)*w+.984375)+M}function et(w,M,D,P){return w<P/2?Q(w*2,0,D,P)*.5+M:tt(w*2-P,0,D,P)*.5+D*.5+M}t.util.ease={easeInQuad:function(w,M,D,P){return D*(w/=P)*w+M},easeOutQuad:function(w,M,D,P){return-D*(w/=P)*(w-2)+M},easeInOutQuad:function(w,M,D,P){return w/=P/2,w<1?D/2*w*w+M:-D/2*(--w*(w-2)-1)+M},easeInCubic:function(w,M,D,P){return D*(w/=P)*w*w+M},easeOutCubic:l,easeInOutCubic:u,easeInQuart:o,easeOutQuart:c,easeInOutQuart:a,easeInQuint:d,easeOutQuint:p,easeInOutQuint:f,easeInSine:v,easeOutSine:_,easeInOutSine:b,easeInExpo:y,easeOutExpo:x,easeInOutExpo:C,easeInCirc:S,easeOutCirc:O,easeInOutCirc:F,easeInElastic:R,easeOutElastic:z,easeInOutElastic:X,easeInBack:J,easeOutBack:q,easeInOutBack:V,easeInBounce:Q,easeOutBounce:tt,easeInOutBounce:et}}(),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.util.object.clone,o=n.util.toFixed,c=n.util.parseUnit,a=n.util.multiplyTransformMatrices,d=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],p=["symbol","image","marker","pattern","view","svg"],f=["pattern","defs","symbol","metadata","clipPath","mask","desc"],v=["symbol","g","a","svg","clipPath","defs"],_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},b={stroke:"strokeOpacity",fill:"fillOpacity"},y="font-size",x="clip-path";n.svgValidTagNamesRegEx=O(d),n.svgViewBoxElementsRegEx=O(p),n.svgInvalidAncestorsRegEx=O(f),n.svgValidParentsRegEx=O(v),n.cssRules={},n.gradientDefs={},n.clipPaths={};function C(k){return k in _?_[k]:k}function S(k,T,A,E){var B=Array.isArray(T),j;if((k==="fill"||k==="stroke")&&T==="none")T="";else{if(k==="strokeUniform")return T==="non-scaling-stroke";if(k==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(k==="transformMatrix")A&&A.transformMatrix?T=a(A.transformMatrix,n.parseTransformAttribute(T)):T=n.parseTransformAttribute(T);else if(k==="visible")T=T!=="none"&&T!=="hidden",A&&A.visible===!1&&(T=!1);else if(k==="opacity")T=parseFloat(T),A&&typeof A.opacity<"u"&&(T*=A.opacity);else if(k==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(k==="charSpacing")j=c(T,E)/E*1e3;else if(k==="paintFirst"){var G=T.indexOf("fill"),K=T.indexOf("stroke"),T="fill";(G>-1&&K>-1&&K<G||G===-1&&K>-1)&&(T="stroke")}else{if(k==="href"||k==="xlink:href"||k==="font")return T;if(k==="imageSmoothing")return T==="optimizeQuality";j=B?T.map(c):c(T,E)}}return!B&&isNaN(j)?T:j}function O(k){return new RegExp("^("+k.join("|")+")\\b","i")}function F(k){for(var T in b)if(!(typeof k[b[T]]>"u"||k[T]==="")){if(typeof k[T]>"u"){if(!n.Object.prototype[T])continue;k[T]=n.Object.prototype[T]}if(k[T].indexOf("url(")!==0){var A=new n.Color(k[T]);k[T]=A.setAlpha(o(A.getAlpha()*k[b[T]],2)).toRgba()}}return k}function R(k,T){var A,E=[],B,j,G;for(j=0,G=T.length;j<G;j++)A=T[j],B=k.getElementsByTagName(A),E=E.concat(Array.prototype.slice.call(B));return E}n.parseTransformAttribute=function(){function k(N,rt){var at=n.util.cos(rt[0]),ct=n.util.sin(rt[0]),Ct=0,gt=0;rt.length===3&&(Ct=rt[1],gt=rt[2]),N[0]=at,N[1]=ct,N[2]=-ct,N[3]=at,N[4]=Ct-(at*Ct-ct*gt),N[5]=gt-(ct*Ct+at*gt)}function T(N,rt){var at=rt[0],ct=rt.length===2?rt[1]:rt[0];N[0]=at,N[3]=ct}function A(N,rt,at){N[at]=Math.tan(n.util.degreesToRadians(rt[0]))}function E(N,rt){N[4]=rt[0],rt.length===2&&(N[5]=rt[1])}var B=n.iMatrix,j=n.reNum,G=n.commaWsp,K="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",it="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",W="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+")"+G+"("+j+"))?\\s*\\))",L="(?:(scale)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",Y="(?:(translate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",U="(?:(matrix)\\s*\\(\\s*("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")\\s*\\))",H="(?:"+U+"|"+Y+"|"+L+"|"+W+"|"+K+"|"+it+")",$="(?:"+H+"(?:"+G+"*"+H+")*)",nt="^\\s*(?:"+$+"?)\\s*$",ot=new RegExp(nt),st=new RegExp(H,"g");return function(N){var rt=B.concat(),at=[];if(!N||N&&!ot.test(N))return rt;N.replace(st,function(Ct){var gt=new RegExp(H).exec(Ct).filter(function(pe){return!!pe}),Ft=gt[1],Ot=gt.slice(2).map(parseFloat);switch(Ft){case"translate":E(rt,Ot);break;case"rotate":Ot[0]=n.util.degreesToRadians(Ot[0]),k(rt,Ot);break;case"scale":T(rt,Ot);break;case"skewX":A(rt,Ot,2);break;case"skewY":A(rt,Ot,1);break;case"matrix":rt=Ot;break}at.push(rt.concat()),rt=B.concat()});for(var ct=at[0];at.length>1;)at.shift(),ct=n.util.multiplyTransformMatrices(ct,at[0]);return ct}}();function z(k,T){var A,E;k.replace(/;\s*$/,"").split(";").forEach(function(B){var j=B.split(":");A=j[0].trim().toLowerCase(),E=j[1].trim(),T[A]=E})}function X(k,T){var A,E;for(var B in k)typeof k[B]>"u"||(A=B.toLowerCase(),E=k[B],T[A]=E)}function J(k,T){var A={};for(var E in n.cssRules[T])if(q(k,E.split(" ")))for(var B in n.cssRules[T][E])A[B]=n.cssRules[T][E][B];return A}function q(k,T){var A,E=!0;return A=Q(k,T.pop()),A&&T.length&&(E=V(k,T)),A&&E&&T.length===0}function V(k,T){for(var A,E=!0;k.parentNode&&k.parentNode.nodeType===1&&T.length;)E&&(A=T.pop()),k=k.parentNode,E=Q(k,A);return T.length===0}function Q(k,T){var A=k.nodeName,E=k.getAttribute("class"),B=k.getAttribute("id"),j,G;if(j=new RegExp("^"+A,"i"),T=T.replace(j,""),B&&T.length&&(j=new RegExp("#"+B+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"")),E&&T.length)for(E=E.split(" "),G=E.length;G--;)j=new RegExp("\\."+E[G]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(j,"");return T.length===0}function tt(k,T){var A;if(k.getElementById&&(A=k.getElementById(T)),A)return A;var E,B,j,G=k.getElementsByTagName("*");for(B=0,j=G.length;B<j;B++)if(E=G[B],T===E.getAttribute("id"))return E}function et(k){for(var T=R(k,["use","svg:use"]),A=0;T.length&&A<T.length;){var E=T[A],B=E.getAttribute("xlink:href")||E.getAttribute("href");if(B===null)return;var j=B.slice(1),G=E.getAttribute("x")||0,K=E.getAttribute("y")||0,it=tt(k,j).cloneNode(!0),W=(it.getAttribute("transform")||"")+" translate("+G+", "+K+")",L,Y=T.length,U,H,$,nt,ot=n.svgNS;if(M(it),/^svg$/i.test(it.nodeName)){var st=it.ownerDocument.createElementNS(ot,"g");for(H=0,$=it.attributes,nt=$.length;H<nt;H++)U=$.item(H),st.setAttributeNS(ot,U.nodeName,U.nodeValue);for(;it.firstChild;)st.appendChild(it.firstChild);it=st}for(H=0,$=E.attributes,nt=$.length;H<nt;H++)U=$.item(H),!(U.nodeName==="x"||U.nodeName==="y"||U.nodeName==="xlink:href"||U.nodeName==="href")&&(U.nodeName==="transform"?W=U.nodeValue+" "+W:it.setAttribute(U.nodeName,U.nodeValue));it.setAttribute("transform",W),it.setAttribute("instantiated_by_use","1"),it.removeAttribute("id"),L=E.parentNode,L.replaceChild(it,E),T.length===Y&&A++}}var w=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");function M(k){if(!n.svgViewBoxElementsRegEx.test(k.nodeName))return{};var T=k.getAttribute("viewBox"),A=1,E=1,B=0,j=0,G,K,it,W,L=k.getAttribute("width"),Y=k.getAttribute("height"),U=k.getAttribute("x")||0,H=k.getAttribute("y")||0,$=k.getAttribute("preserveAspectRatio")||"",nt=!T||!(T=T.match(w)),ot=!L||!Y||L==="100%"||Y==="100%",st=nt&&ot,N={},rt="",at=0,ct=0;if(N.width=0,N.height=0,N.toBeParsed=st,nt&&(U||H)&&k.parentNode&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+c(U)+" "+c(H)+") ",it=(k.getAttribute("transform")||"")+rt,k.setAttribute("transform",it),k.removeAttribute("x"),k.removeAttribute("y")),st)return N;if(nt)return N.width=c(L),N.height=c(Y),N;if(B=-parseFloat(T[1]),j=-parseFloat(T[2]),G=parseFloat(T[3]),K=parseFloat(T[4]),N.minX=B,N.minY=j,N.viewBoxWidth=G,N.viewBoxHeight=K,ot?(N.width=G,N.height=K):(N.width=c(L),N.height=c(Y),A=N.width/G,E=N.height/K),$=n.util.parsePreserveAspectRatioAttribute($),$.alignX!=="none"&&($.meetOrSlice==="meet"&&(E=A=A>E?E:A),$.meetOrSlice==="slice"&&(E=A=A>E?A:E),at=N.width-G*A,ct=N.height-K*A,$.alignX==="Mid"&&(at/=2),$.alignY==="Mid"&&(ct/=2),$.alignX==="Min"&&(at=0),$.alignY==="Min"&&(ct=0)),A===1&&E===1&&B===0&&j===0&&U===0&&H===0)return N;if((U||H)&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+c(U)+" "+c(H)+") "),it=rt+" matrix("+A+" 0 0 "+E+" "+(B*A+at)+" "+(j*E+ct)+") ",k.nodeName==="svg"){for(W=k.ownerDocument.createElementNS(n.svgNS,"g");k.firstChild;)W.appendChild(k.firstChild);k.appendChild(W)}else W=k,W.removeAttribute("x"),W.removeAttribute("y"),it=W.getAttribute("transform")+it;return W.setAttribute("transform",it),N}function D(k,T){for(;k&&(k=k.parentNode);)if(k.nodeName&&T.test(k.nodeName.replace("svg:",""))&&!k.getAttribute("instantiated_by_use"))return!0;return!1}n.parseSVGDocument=function(k,T,A,E){if(k){et(k);var B=n.Object.__uid++,j,G,K=M(k),it=n.util.toArray(k.getElementsByTagName("*"));if(K.crossOrigin=E&&E.crossOrigin,K.svgUid=B,it.length===0&&n.isLikelyNode){it=k.selectNodes('//*[name(.)!="svg"]');var W=[];for(j=0,G=it.length;j<G;j++)W[j]=it[j];it=W}var L=it.filter(function(U){return M(U),n.svgValidTagNamesRegEx.test(U.nodeName.replace("svg:",""))&&!D(U,n.svgInvalidAncestorsRegEx)});if(!L||L&&!L.length){T&&T([],{});return}var Y={};it.filter(function(U){return U.nodeName.replace("svg:","")==="clipPath"}).forEach(function(U){var H=U.getAttribute("id");Y[H]=n.util.toArray(U.getElementsByTagName("*")).filter(function($){return n.svgValidTagNamesRegEx.test($.nodeName.replace("svg:",""))})}),n.gradientDefs[B]=n.getGradientDefs(k),n.cssRules[B]=n.getCSSRules(k),n.clipPaths[B]=Y,n.parseElements(L,function(U,H){T&&(T(U,K,H,it),delete n.gradientDefs[B],delete n.cssRules[B],delete n.clipPaths[B])},u(K),A,E)}};function P(k,T){var A=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],E="xlink:href",B=T.getAttribute(E).slice(1),j=tt(k,B);if(j&&j.getAttribute(E)&&P(k,j),A.forEach(function(K){j&&!T.hasAttribute(K)&&j.hasAttribute(K)&&T.setAttribute(K,j.getAttribute(K))}),!T.children.length)for(var G=j.cloneNode(!0);G.firstChild;)T.appendChild(G.firstChild);T.removeAttribute(E)}var I=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");l(n,{parseFontDeclaration:function(k,T){var A=k.match(I);if(A){var E=A[1],B=A[3],j=A[4],G=A[5],K=A[6];E&&(T.fontStyle=E),B&&(T.fontWeight=isNaN(parseFloat(B))?B:parseFloat(B)),j&&(T.fontSize=c(j)),K&&(T.fontFamily=K),G&&(T.lineHeight=G==="normal"?1:G)}},getGradientDefs:function(k){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],A=R(k,T),E,B=0,j={};for(B=A.length;B--;)E=A[B],E.getAttribute("xlink:href")&&P(k,E),j[E.getAttribute("id")]=E;return j},parseAttributes:function(k,T,A){if(k){var E,B={},j,G;typeof A>"u"&&(A=k.getAttribute("svgUid")),k.parentNode&&n.svgValidParentsRegEx.test(k.parentNode.nodeName)&&(B=n.parseAttributes(k.parentNode,T,A));var K=T.reduce(function($,nt){return E=k.getAttribute(nt),E&&($[nt]=E),$},{}),it=l(J(k,A),n.parseStyleAttribute(k));K=l(K,it),it[x]&&k.setAttribute(x,it[x]),j=G=B.fontSize||n.Text.DEFAULT_SVG_FONT_SIZE,K[y]&&(K[y]=j=c(K[y],G));var W,L,Y={};for(var U in K)W=C(U),L=S(W,K[U],B,j),Y[W]=L;Y&&Y.font&&n.parseFontDeclaration(Y.font,Y);var H=l(B,Y);return n.svgValidParentsRegEx.test(k.nodeName)?H:F(H)}},parseElements:function(k,T,A,E,B){new n.ElementsParser(k,T,A,E,B).parse()},parseStyleAttribute:function(k){var T={},A=k.getAttribute("style");return A&&(typeof A=="string"?z(A,T):X(A,T)),T},parsePointsAttribute:function(k){if(!k)return null;k=k.replace(/,/g," ").trim(),k=k.split(/\s+/);var T=[],A,E;for(A=0,E=k.length;A<E;A+=2)T.push({x:parseFloat(k[A]),y:parseFloat(k[A+1])});return T},getCSSRules:function(k){var T=k.getElementsByTagName("style"),A,E,B={},j;for(A=0,E=T.length;A<E;A++){var G=T[A].textContent;G=G.replace(/\/\*[\s\S]*?\*\//g,""),G.trim()!==""&&(j=G.split("}"),j=j.filter(function(K){return K.trim()}),j.forEach(function(K){var it=K.split("{"),W={},L=it[1].trim(),Y=L.split(";").filter(function(nt){return nt.trim()});for(A=0,E=Y.length;A<E;A++){var U=Y[A].split(":"),H=U[0].trim(),$=U[1].trim();W[H]=$}K=it[0].trim(),K.split(",").forEach(function(nt){nt=nt.replace(/^svg/i,"").trim(),nt!==""&&(B[nt]?n.util.object.extend(B[nt],W):B[nt]=n.util.object.clone(W))})}))}return B},loadSVGFromURL:function(k,T,A,E){k=k.replace(/^\n\s*/,"").trim(),new n.util.request(k,{method:"get",onComplete:B});function B(j){var G=j.responseXML;if(!G||!G.documentElement)return T&&T(null),!1;n.parseSVGDocument(G.documentElement,function(K,it,W,L){T&&T(K,it,W,L)},A,E)}},loadSVGFromString:function(k,T,A,E){var B=new n.window.DOMParser,j=B.parseFromString(k.trim(),"text/xml");n.parseSVGDocument(j.documentElement,function(G,K,it,W){T(G,K,it,W)},A,E)}})}(i),t.ElementsParser=function(r,n,l,u,o,c){this.elements=r,this.callback=n,this.options=l,this.reviver=u,this.svgUid=l&&l.svgUid||0,this.parsingOptions=o,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=c},function(r){r.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},r.createObjects=function(){var n=this;this.elements.forEach(function(l,u){l.setAttribute("svgUid",n.svgUid),n.createObject(l,u)})},r.findTag=function(n){return t[t.util.string.capitalize(n.tagName.replace("svg:",""))]},r.createObject=function(n,l){var u=this.findTag(n);if(u&&u.fromElement)try{u.fromElement(n,this.createCallback(l,n),this.options)}catch(o){t.log(o)}else this.checkIfDone()},r.createCallback=function(n,l){var u=this;return function(o){var c;u.resolveGradient(o,l,"fill"),u.resolveGradient(o,l,"stroke"),o instanceof t.Image&&o._originalElement&&(c=o.parsePreserveAspectRatioAttribute(l)),o._removeTransformMatrix(c),u.resolveClipPath(o,l),u.reviver&&u.reviver(l,o),u.instances[n]=o,u.checkIfDone()}},r.extractPropertyDefinition=function(n,l,u){var o=n[l],c=this.regexUrl;if(c.test(o)){c.lastIndex=0;var a=c.exec(o)[1];return c.lastIndex=0,t[u][this.svgUid][a]}},r.resolveGradient=function(n,l,u){var o=this.extractPropertyDefinition(n,u,"gradientDefs");if(o){var c=l.getAttribute(u+"-opacity"),a=t.Gradient.fromElement(o,n,c,this.options);n.set(u,a)}},r.createClipPathCallback=function(n,l){return function(u){u._removeTransformMatrix(),u.fillRule=u.clipRule,l.push(u)}},r.resolveClipPath=function(n,l){var u=this.extractPropertyDefinition(n,"clipPath","clipPaths"),o,c,a,d,p,f;if(u){d=[],a=t.util.invertTransform(n.calcTransformMatrix());for(var v=u[0].parentNode,_=l;_.parentNode&&_.getAttribute("clip-path")!==n.clipPath;)_=_.parentNode;_.parentNode.appendChild(v);for(var b=0;b<u.length;b++)o=u[b],c=this.findTag(o),c.fromElement(o,this.createClipPathCallback(n,d),this.options);d.length===1?u=d[0]:u=new t.Group(d),p=t.util.multiplyTransformMatrices(a,u.calcTransformMatrix()),u.clipPath&&this.resolveClipPath(u,_);var f=t.util.qrDecompose(p);u.flipX=!1,u.flipY=!1,u.set("scaleX",f.scaleX),u.set("scaleY",f.scaleY),u.angle=f.angle,u.skewX=f.skewX,u.skewY=0,u.setPositionByOrigin({x:f.translateX,y:f.translateY},"center","center"),n.clipPath=u}else delete n.clipPath},r.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(r){var n=r.fabric||(r.fabric={});if(n.Point){n.warn("fabric.Point is already defined");return}n.Point=l;function l(u,o){this.x=u,this.y=o}l.prototype={type:"point",constructor:l,add:function(u){return new l(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new l(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new l(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new l(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new l(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new l(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,o){return typeof o>"u"&&(o=.5),o=Math.max(Math.min(1,o),0),new l(this.x+(u.x-this.x)*o,this.y+(u.y-this.y)*o)},distanceFrom:function(u){var o=this.x-u.x,c=this.y-u.y;return Math.sqrt(o*o+c*c)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new l(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new l(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,o){return this.x=u,this.y=o,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var o=this.x,c=this.y;this.x=u.x,this.y=u.y,u.x=o,u.y=c},clone:function(){return new l(this.x,this.y)}}}(i),function(r){var n=r.fabric||(r.fabric={});if(n.Intersection){n.warn("fabric.Intersection is already defined");return}function l(u){this.status=u,this.points=[]}n.Intersection=l,n.Intersection.prototype={constructor:l,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},n.Intersection.intersectLineLine=function(u,o,c,a){var d,p=(a.x-c.x)*(u.y-c.y)-(a.y-c.y)*(u.x-c.x),f=(o.x-u.x)*(u.y-c.y)-(o.y-u.y)*(u.x-c.x),v=(a.y-c.y)*(o.x-u.x)-(a.x-c.x)*(o.y-u.y);if(v!==0){var _=p/v,b=f/v;0<=_&&_<=1&&0<=b&&b<=1?(d=new l("Intersection"),d.appendPoint(new n.Point(u.x+_*(o.x-u.x),u.y+_*(o.y-u.y)))):d=new l}else p===0||f===0?d=new l("Coincident"):d=new l("Parallel");return d},n.Intersection.intersectLinePolygon=function(u,o,c){var a=new l,d=c.length,p,f,v,_;for(_=0;_<d;_++)p=c[_],f=c[(_+1)%d],v=l.intersectLineLine(u,o,p,f),a.appendPoints(v.points);return a.points.length>0&&(a.status="Intersection"),a},n.Intersection.intersectPolygonPolygon=function(u,o){var c=new l,a=u.length,d;for(d=0;d<a;d++){var p=u[d],f=u[(d+1)%a],v=l.intersectLinePolygon(p,f,o);c.appendPoints(v.points)}return c.points.length>0&&(c.status="Intersection"),c},n.Intersection.intersectPolygonRectangle=function(u,o,c){var a=o.min(c),d=o.max(c),p=new n.Point(d.x,a.y),f=new n.Point(a.x,d.y),v=l.intersectLinePolygon(a,p,u),_=l.intersectLinePolygon(p,d,u),b=l.intersectLinePolygon(d,f,u),y=l.intersectLinePolygon(f,a,u),x=new l;return x.appendPoints(v.points),x.appendPoints(_.points),x.appendPoints(b.points),x.appendPoints(y.points),x.points.length>0&&(x.status="Intersection"),x}}(i),function(r){var n=r.fabric||(r.fabric={});if(n.Color){n.warn("fabric.Color is already defined.");return}function l(o){o?this._tryParsingColor(o):this.setSource([0,0,0,1])}n.Color=l,n.Color.prototype={_tryParsingColor:function(o){var c;o in l.colorNameMap&&(o=l.colorNameMap[o]),o==="transparent"&&(c=[255,255,255,0]),c||(c=l.sourceFromHex(o)),c||(c=l.sourceFromRgb(o)),c||(c=l.sourceFromHsl(o)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(o,c,a){o/=255,c/=255,a/=255;var d,p,f,v=n.util.array.max([o,c,a]),_=n.util.array.min([o,c,a]);if(f=(v+_)/2,v===_)d=p=0;else{var b=v-_;switch(p=f>.5?b/(2-v-_):b/(v+_),v){case o:d=(c-a)/b+(c<a?6:0);break;case c:d=(a-o)/b+2;break;case a:d=(o-c)/b+4;break}d/=6}return[Math.round(d*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(o){this._source=o},toRgb:function(){var o=this.getSource();return"rgb("+o[0]+","+o[1]+","+o[2]+")"},toRgba:function(){var o=this.getSource();return"rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")"},toHsl:function(){var o=this.getSource(),c=this._rgbToHsl(o[0],o[1],o[2]);return"hsl("+c[0]+","+c[1]+"%,"+c[2]+"%)"},toHsla:function(){var o=this.getSource(),c=this._rgbToHsl(o[0],o[1],o[2]);return"hsla("+c[0]+","+c[1]+"%,"+c[2]+"%,"+o[3]+")"},toHex:function(){var o=this.getSource(),c,a,d;return c=o[0].toString(16),c=c.length===1?"0"+c:c,a=o[1].toString(16),a=a.length===1?"0"+a:a,d=o[2].toString(16),d=d.length===1?"0"+d:d,c.toUpperCase()+a.toUpperCase()+d.toUpperCase()},toHexa:function(){var o=this.getSource(),c;return c=Math.round(o[3]*255),c=c.toString(16),c=c.length===1?"0"+c:c,this.toHex()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(o){var c=this.getSource();return c[3]=o,this.setSource(c),this},toGrayscale:function(){var o=this.getSource(),c=parseInt((o[0]*.3+o[1]*.59+o[2]*.11).toFixed(0),10),a=o[3];return this.setSource([c,c,c,a]),this},toBlackWhite:function(o){var c=this.getSource(),a=(c[0]*.3+c[1]*.59+c[2]*.11).toFixed(0),d=c[3];return o=o||127,a=Number(a)<Number(o)?0:255,this.setSource([a,a,a,d]),this},overlayWith:function(o){o instanceof l||(o=new l(o));var c=[],a=this.getAlpha(),d=.5,p=this.getSource(),f=o.getSource(),v;for(v=0;v<3;v++)c.push(Math.round(p[v]*(1-d)+f[v]*d));return c[3]=a,this.setSource(c),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,n.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function u(o,c,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?o+(c-o)*6*a:a<1/2?c:a<2/3?o+(c-o)*(2/3-a)*6:o}n.Color.fromRgb=function(o){return l.fromSource(l.sourceFromRgb(o))},n.Color.sourceFromRgb=function(o){var c=o.match(l.reRGBa);if(c){var a=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),d=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),p=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(a,10),parseInt(d,10),parseInt(p,10),c[4]?parseFloat(c[4]):1]}},n.Color.fromRgba=l.fromRgb,n.Color.fromHsl=function(o){return l.fromSource(l.sourceFromHsl(o))},n.Color.sourceFromHsl=function(o){var c=o.match(l.reHSLa);if(c){var a=(parseFloat(c[1])%360+360)%360/360,d=parseFloat(c[2])/(/%$/.test(c[2])?100:1),p=parseFloat(c[3])/(/%$/.test(c[3])?100:1),f,v,_;if(d===0)f=v=_=p;else{var b=p<=.5?p*(d+1):p+d-p*d,y=p*2-b;f=u(y,b,a+1/3),v=u(y,b,a),_=u(y,b,a-1/3)}return[Math.round(f*255),Math.round(v*255),Math.round(_*255),c[4]?parseFloat(c[4]):1]}},n.Color.fromHsla=l.fromHsl,n.Color.fromHex=function(o){return l.fromSource(l.sourceFromHex(o))},n.Color.sourceFromHex=function(o){if(o.match(l.reHex)){var c=o.slice(o.indexOf("#")+1),a=c.length===3||c.length===4,d=c.length===8||c.length===4,p=a?c.charAt(0)+c.charAt(0):c.substring(0,2),f=a?c.charAt(1)+c.charAt(1):c.substring(2,4),v=a?c.charAt(2)+c.charAt(2):c.substring(4,6),_=d?a?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(p,16),parseInt(f,16),parseInt(v,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},n.Color.fromSource=function(o){var c=new l;return c.setSource(o),c}}(i),function(r){var n=r.fabric||(r.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],o={},c="left",a="top",d="right",p="bottom",f="center",v={top:p,bottom:a,left:d,right:c,center:f},_=n.util.radiansToDegrees,b=Math.sign||function(W){return(W>0)-(W<0)||+W};function y(W,L){var Y=W.angle+_(Math.atan2(L.y,L.x))+360;return Math.round(Y%360/45)}function x(W,L){var Y=L.transform.target,U=Y.canvas,H=n.util.object.clone(L);H.target=Y,U&&U.fire("object:"+W,H),Y.fire(W,L)}function C(W,L){var Y=L.canvas,U=Y.uniScaleKey,H=W[U];return Y.uniformScaling&&!H||!Y.uniformScaling&&H}function S(W){return W.originX===f&&W.originY===f}function O(W,L,Y){var U=W.lockScalingX,H=W.lockScalingY;return!!(U&&H||!L&&(U||H)&&Y||U&&L==="x"||H&&L==="y")}function F(W,L,Y){var U="not-allowed",H=C(W,Y),$="";if(L.x!==0&&L.y===0?$="x":L.x===0&&L.y!==0&&($="y"),O(Y,$,H))return U;var nt=y(Y,L);return l[nt]+"-resize"}function R(W,L,Y){var U="not-allowed";if(L.x!==0&&Y.lockSkewingY||L.y!==0&&Y.lockSkewingX)return U;var H=y(Y,L)%4;return u[H]+"-resize"}function z(W,L,Y){return W[Y.canvas.altActionKey]?o.skewCursorStyleHandler(W,L,Y):o.scaleCursorStyleHandler(W,L,Y)}function X(W,L,Y){var U=W[Y.canvas.altActionKey];if(L.x===0)return U?"skewX":"scaleY";if(L.y===0)return U?"skewY":"scaleX"}function J(W,L,Y){return Y.lockRotation?"not-allowed":L.cursorStyle}function q(W,L,Y,U){return{e:W,transform:L,pointer:{x:Y,y:U}}}function V(W){return function(L,Y,U,H){var $=Y.target,nt=$.getCenterPoint(),ot=$.translateToOriginPoint(nt,Y.originX,Y.originY),st=W(L,Y,U,H);return $.setPositionByOrigin(ot,Y.originX,Y.originY),st}}function Q(W,L){return function(Y,U,H,$){var nt=L(Y,U,H,$);return nt&&x(W,q(Y,U,H,$)),nt}}function tt(W,L,Y,U,H){var $=W.target,nt=$.controls[W.corner],ot=$.canvas.getZoom(),st=$.padding/ot,N=$.toLocalPoint(new n.Point(U,H),L,Y);return N.x>=st&&(N.x-=st),N.x<=-st&&(N.x+=st),N.y>=st&&(N.y-=st),N.y<=st&&(N.y+=st),N.x-=nt.offsetX,N.y-=nt.offsetY,N}function et(W){return W.flipX!==W.flipY}function w(W,L,Y,U,H){if(W[L]!==0){var $=W._getTransformedDimensions()[U],nt=H/$*W[Y];W.set(Y,nt)}}function M(W,L,Y,U){var H=L.target,$=H._getTransformedDimensions(0,H.skewY),nt=tt(L,L.originX,L.originY,Y,U),ot=Math.abs(nt.x*2)-$.x,st=H.skewX,N;ot<2?N=0:(N=_(Math.atan2(ot/H.scaleX,$.y/H.scaleY)),L.originX===c&&L.originY===p&&(N=-N),L.originX===d&&L.originY===a&&(N=-N),et(H)&&(N=-N));var rt=st!==N;if(rt){var at=H._getTransformedDimensions().y;H.set("skewX",N),w(H,"skewY","scaleY","y",at)}return rt}function D(W,L,Y,U){var H=L.target,$=H._getTransformedDimensions(H.skewX,0),nt=tt(L,L.originX,L.originY,Y,U),ot=Math.abs(nt.y*2)-$.y,st=H.skewY,N;ot<2?N=0:(N=_(Math.atan2(ot/H.scaleY,$.x/H.scaleX)),L.originX===c&&L.originY===p&&(N=-N),L.originX===d&&L.originY===a&&(N=-N),et(H)&&(N=-N));var rt=st!==N;if(rt){var at=H._getTransformedDimensions().x;H.set("skewY",N),w(H,"skewX","scaleX","x",at)}return rt}function P(W,L,Y,U){var H=L.target,$=H.skewX,nt,ot=L.originY;if(H.lockSkewingX)return!1;if($===0){var st=tt(L,f,f,Y,U);st.x>0?nt=c:nt=d}else $>0&&(nt=ot===a?c:d),$<0&&(nt=ot===a?d:c),et(H)&&(nt=nt===c?d:c);L.originX=nt;var N=Q("skewing",V(M));return N(W,L,Y,U)}function I(W,L,Y,U){var H=L.target,$=H.skewY,nt,ot=L.originX;if(H.lockSkewingY)return!1;if($===0){var st=tt(L,f,f,Y,U);st.y>0?nt=a:nt=p}else $>0&&(nt=ot===c?a:p),$<0&&(nt=ot===c?p:a),et(H)&&(nt=nt===a?p:a);L.originY=nt;var N=Q("skewing",V(D));return N(W,L,Y,U)}function k(W,L,Y,U){var H=L,$=H.target,nt=$.translateToOriginPoint($.getCenterPoint(),H.originX,H.originY);if($.lockRotation)return!1;var ot=Math.atan2(H.ey-nt.y,H.ex-nt.x),st=Math.atan2(U-nt.y,Y-nt.x),N=_(st-ot+H.theta),rt=!0;if($.snapAngle>0){var at=$.snapAngle,ct=$.snapThreshold||at,Ct=Math.ceil(N/at)*at,gt=Math.floor(N/at)*at;Math.abs(N-gt)<ct?N=gt:Math.abs(N-Ct)<ct&&(N=Ct)}return N<0&&(N=360+N),N%=360,rt=$.angle!==N,$.angle=N,rt}function T(W,L,Y,U,H){H=H||{};var $=L.target,nt=$.lockScalingX,ot=$.lockScalingY,st=H.by,N,rt,at,ct,Ct=C(W,$),gt=O($,st,Ct),Ft,Ot,pe=L.gestureScale;if(gt)return!1;if(pe)rt=L.scaleX*pe,at=L.scaleY*pe;else{if(N=tt(L,L.originX,L.originY,Y,U),Ft=st!=="y"?b(N.x):1,Ot=st!=="x"?b(N.y):1,L.signX||(L.signX=Ft),L.signY||(L.signY=Ot),$.lockScalingFlip&&(L.signX!==Ft||L.signY!==Ot))return!1;if(ct=$._getTransformedDimensions(),Ct&&!st){var We=Math.abs(N.x)+Math.abs(N.y),Yt=L.original,Ro=Math.abs(ct.x*Yt.scaleX/$.scaleX)+Math.abs(ct.y*Yt.scaleY/$.scaleY),rs=We/Ro;rt=Yt.scaleX*rs,at=Yt.scaleY*rs}else rt=Math.abs(N.x*$.scaleX/ct.x),at=Math.abs(N.y*$.scaleY/ct.y);S(L)&&(rt*=2,at*=2),L.signX!==Ft&&st!=="y"&&(L.originX=v[L.originX],rt*=-1,L.signX=Ft),L.signY!==Ot&&st!=="x"&&(L.originY=v[L.originY],at*=-1,L.signY=Ot)}var Io=$.scaleX,Bo=$.scaleY;return st?(st==="x"&&$.set("scaleX",rt),st==="y"&&$.set("scaleY",at)):(!nt&&$.set("scaleX",rt),!ot&&$.set("scaleY",at)),Io!==$.scaleX||Bo!==$.scaleY}function A(W,L,Y,U){return T(W,L,Y,U)}function E(W,L,Y,U){return T(W,L,Y,U,{by:"x"})}function B(W,L,Y,U){return T(W,L,Y,U,{by:"y"})}function j(W,L,Y,U){return W[L.target.canvas.altActionKey]?o.skewHandlerX(W,L,Y,U):o.scalingY(W,L,Y,U)}function G(W,L,Y,U){return W[L.target.canvas.altActionKey]?o.skewHandlerY(W,L,Y,U):o.scalingX(W,L,Y,U)}function K(W,L,Y,U){var H=L.target,$=tt(L,L.originX,L.originY,Y,U),nt=H.strokeWidth/(H.strokeUniform?H.scaleX:1),ot=S(L)?2:1,st=H.width,N=Math.abs($.x*ot/H.scaleX)-nt;return H.set("width",Math.max(N,0)),st!==N}function it(W,L,Y,U){var H=L.target,$=Y-L.offsetX,nt=U-L.offsetY,ot=!H.get("lockMovementX")&&H.left!==$,st=!H.get("lockMovementY")&&H.top!==nt;return ot&&H.set("left",$),st&&H.set("top",nt),(ot||st)&&x("moving",q(W,L,Y,U)),ot||st}o.scaleCursorStyleHandler=F,o.skewCursorStyleHandler=R,o.scaleSkewCursorStyleHandler=z,o.rotationWithSnapping=Q("rotating",V(k)),o.scalingEqually=Q("scaling",V(A)),o.scalingX=Q("scaling",V(E)),o.scalingY=Q("scaling",V(B)),o.scalingYOrSkewingX=j,o.scalingXOrSkewingY=G,o.changeWidth=Q("resizing",V(K)),o.skewHandlerX=P,o.skewHandlerY=I,o.dragHandler=it,o.scaleOrSkewActionName=X,o.rotationStyleHandler=J,o.fireEvent=x,o.wrapWithFixedAnchor=V,o.wrapWithFireEvent=Q,o.getLocalPoint=tt,n.controlsUtils=o}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.degreesToRadians,u=n.controlsUtils;function o(a,d,p,f,v){f=f||{};var _=this.sizeX||f.cornerSize||v.cornerSize,b=this.sizeY||f.cornerSize||v.cornerSize,y=typeof f.transparentCorners<"u"?f.transparentCorners:v.transparentCorners,x=y?"stroke":"fill",C=!y&&(f.cornerStrokeColor||v.cornerStrokeColor),S=d,O=p,F;a.save(),a.fillStyle=f.cornerColor||v.cornerColor,a.strokeStyle=f.cornerStrokeColor||v.cornerStrokeColor,_>b?(F=_,a.scale(1,b/_),O=p*_/b):b>_?(F=b,a.scale(_/b,1),S=d*b/_):F=_,a.lineWidth=1,a.beginPath(),a.arc(S,O,F/2,0,2*Math.PI,!1),a[x](),C&&a.stroke(),a.restore()}function c(a,d,p,f,v){f=f||{};var _=this.sizeX||f.cornerSize||v.cornerSize,b=this.sizeY||f.cornerSize||v.cornerSize,y=typeof f.transparentCorners<"u"?f.transparentCorners:v.transparentCorners,x=y?"stroke":"fill",C=!y&&(f.cornerStrokeColor||v.cornerStrokeColor),S=_/2,O=b/2;a.save(),a.fillStyle=f.cornerColor||v.cornerColor,a.strokeStyle=f.cornerStrokeColor||v.cornerStrokeColor,a.lineWidth=1,a.translate(d,p),a.rotate(l(v.angle)),a[x+"Rect"](-S,-O,_,b),C&&a.strokeRect(-S,-O,_,b),a.restore()}u.renderCircleControl=o,u.renderSquareControl=c}(i),function(r){var n=r.fabric||(r.fabric={});function l(u){for(var o in u)this[o]=u[o]}n.Control=l,n.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(u,o){return o.cursorStyle},getActionName:function(u,o){return o.actionName},getVisibility:function(u,o){var c=u._controlsVisibility;return c&&typeof c[o]<"u"?c[o]:this.visible},setVisibility:function(u){this.visible=u},positionHandler:function(u,o){var c=n.util.transformPoint({x:this.x*u.x+this.offsetX,y:this.y*u.y+this.offsetY},o);return c},calcCornerCoords:function(u,o,c,a,d){var p,f,v,_,b=d?this.touchSizeX:this.sizeX,y=d?this.touchSizeY:this.sizeY;if(b&&y&&b!==y){var x=Math.atan2(y,b),C=Math.sqrt(b*b+y*y)/2,S=x-n.util.degreesToRadians(u),O=Math.PI/2-x-n.util.degreesToRadians(u);p=C*n.util.cos(S),f=C*n.util.sin(S),v=C*n.util.cos(O),_=C*n.util.sin(O)}else{var F=b&&y?b:o;C=F*.7071067812;var S=n.util.degreesToRadians(45-u);p=v=C*n.util.cos(S),f=_=C*n.util.sin(S)}return{tl:{x:c-_,y:a-v},tr:{x:c+p,y:a-f},bl:{x:c-p,y:a+f},br:{x:c+_,y:a+v}}},render:function(u,o,c,a,d){switch(a=a||{},a.cornerStyle||d.cornerStyle){case"circle":n.controlsUtils.renderCircleControl.call(this,u,o,c,a,d);break;default:n.controlsUtils.renderSquareControl.call(this,u,o,c,a,d)}}}}(i),function(){function r(c,a){var d=c.getAttribute("style"),p=c.getAttribute("offset")||0,f,v,_,b;if(p=parseFloat(p)/(/%$/.test(p)?100:1),p=p<0?0:p>1?1:p,d){var y=d.split(/\s*;\s*/);for(y[y.length-1]===""&&y.pop(),b=y.length;b--;){var x=y[b].split(/\s*:\s*/),C=x[0].trim(),S=x[1].trim();C==="stop-color"?f=S:C==="stop-opacity"&&(_=S)}}return f||(f=c.getAttribute("stop-color")||"rgb(0,0,0)"),_||(_=c.getAttribute("stop-opacity")),f=new t.Color(f),v=f.getAlpha(),_=isNaN(parseFloat(_))?1:parseFloat(_),_*=v*a,{offset:p,color:f.toRgb(),opacity:_}}function n(c){return{x1:c.getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}}function l(c){return{x1:c.getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"}}var u=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(c){c||(c={}),c.coords||(c.coords={});var a,d=this;Object.keys(c).forEach(function(p){d[p]=c[p]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,a={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0},this.type==="radial"&&(a.r1=c.coords.r1||0,a.r2=c.coords.r2||0),this.coords=a,this.colorStops=c.colorStops.slice()},addColorStop:function(c){for(var a in c){var d=new t.Color(c[a]);this.colorStops.push({offset:parseFloat(a),color:d.toRgb(),opacity:d.getAlpha()})}return this},toObject:function(c){var a={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,a,c),a},toSVG:function(c,v){var d=u(this.coords,!0),p,f,v=v||{},_,b,y=u(this.colorStops,!0),x=d.r1>d.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,O=-this.offsetY,F=!!v.additionalTransform,R=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(y.sort(function(V,Q){return V.offset-Q.offset}),R==="objectBoundingBox"?(S/=c.width,O/=c.height):(S+=c.width/2,O+=c.height/2),c.type==="path"&&this.gradientUnits!=="percentage"&&(S-=c.pathOffset.x,O-=c.pathOffset.y),C[4]-=S,C[5]-=O,b='id="SVGID_'+this.id+'" gradientUnits="'+R+'"',b+=' gradientTransform="'+(F?v.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?_=["<linearGradient ",b,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`">
`]:this.type==="radial"&&(_=["<radialGradient ",b,' cx="',x?d.x1:d.x2,'" cy="',x?d.y1:d.y2,'" r="',x?d.r1:d.r2,'" fx="',x?d.x2:d.x1,'" fy="',x?d.y2:d.y1,`">
`]),this.type==="radial"){if(x)for(y=y.concat(),y.reverse(),p=0,f=y.length;p<f;p++)y[p].offset=1-y[p].offset;var z=Math.min(d.r1,d.r2);if(z>0){var X=Math.max(d.r1,d.r2),J=z/X;for(p=0,f=y.length;p<f;p++)y[p].offset+=J*(1-y[p].offset)}}for(p=0,f=y.length;p<f;p++){var q=y[p];_.push("<stop ",'offset="',q.offset*100+"%",'" style="stop-color:',q.color,typeof q.opacity<"u"?";stop-opacity: "+q.opacity:";",`"/>
`)}return _.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),_.join("")},toLive:function(c){var a,d=t.util.object.clone(this.coords),p,f;if(this.type){for(this.type==="linear"?a=c.createLinearGradient(d.x1,d.y1,d.x2,d.y2):this.type==="radial"&&(a=c.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2)),p=0,f=this.colorStops.length;p<f;p++){var v=this.colorStops[p].color,_=this.colorStops[p].opacity,b=this.colorStops[p].offset;typeof _<"u"&&(v=new t.Color(v).setAlpha(_).toRgba()),a.addColorStop(b,v)}return a}}}),t.util.object.extend(t.Gradient,{fromElement:function(c,a,d,p){var f=parseFloat(d)/(/%$/.test(d)?100:1);f=f<0?0:f>1?1:f,isNaN(f)&&(f=1);var v=c.getElementsByTagName("stop"),_,b=c.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",y=c.getAttribute("gradientTransform")||"",x=[],C,S,O=0,F=0,R;for(c.nodeName==="linearGradient"||c.nodeName==="LINEARGRADIENT"?(_="linear",C=n(c)):(_="radial",C=l(c)),S=v.length;S--;)x.push(r(v[S],f));R=t.parseTransformAttribute(y),o(a,C,p,b),b==="pixels"&&(O=-a.left,F=-a.top);var z=new t.Gradient({id:c.getAttribute("id"),type:_,coords:C,colorStops:x,gradientUnits:b,gradientTransform:R,offsetX:O,offsetY:F});return z}});function o(c,a,d,p){var f,v;Object.keys(a).forEach(function(_){f=a[_],f==="Infinity"?v=1:f==="-Infinity"?v=0:(v=parseFloat(a[_],10),typeof f=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(f)&&(v*=.01,p==="pixels"&&((_==="x1"||_==="x2"||_==="r2")&&(v*=d.viewBoxWidth||d.width),(_==="y1"||_==="y2")&&(v*=d.viewBoxHeight||d.height)))),a[_]=v})}}(),function(){var r=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(n,l){if(n||(n={}),this.id=t.Object.__uid++,this.setOptions(n),!n.source||n.source&&typeof n.source!="string"){l&&l(this);return}else{var u=this;this.source=t.util.createImage(),t.util.loadImage(n.source,function(o,c){u.source=o,l&&l(u,c)},null,this.crossOrigin)}},toObject:function(n){var l=t.Object.NUM_FRACTION_DIGITS,u,o;return typeof this.source.src=="string"?u=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(u=this.source.toDataURL()),o={type:"pattern",source:u,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:r(this.offsetX,l),offsetY:r(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,o,n),o},toSVG:function(n){var l=typeof this.source=="function"?this.source():this.source,u=l.width/n.width,o=l.height/n.height,c=this.offsetX/n.width,a=this.offsetY/n.height,d="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(o=1,a&&(o+=Math.abs(a))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(u=1,c&&(u+=Math.abs(c))),l.src?d=l.src:l.toDataURL&&(d=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+c+'" y="'+a+'" width="'+u+'" height="'+o+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+d+`"></image>
</pattern>
`},setOptions:function(n){for(var l in n)this[l]=n[l]},toLive:function(n){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":n.createPattern(l,this.repeat)}})}(),function(r){var n=r.fabric||(r.fabric={}),l=n.util.toFixed;if(n.Shadow){n.warn("fabric.Shadow is already defined.");return}n.Shadow=n.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){typeof u=="string"&&(u=this._parseShadow(u));for(var o in u)this[o]=u[o];this.id=n.Object.__uid++},_parseShadow:function(u){var o=u.trim(),c=n.Shadow.reOffsetsAndBlur.exec(o)||[],a=o.replace(n.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:a.trim(),offsetX:parseFloat(c[1],10)||0,offsetY:parseFloat(c[2],10)||0,blur:parseFloat(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var o=40,c=40,a=n.Object.NUM_FRACTION_DIGITS,d=n.util.rotateVector({x:this.offsetX,y:this.offsetY},n.util.degreesToRadians(-u.angle)),p=20,f=new n.Color(this.color);return u.width&&u.height&&(o=l((Math.abs(d.x)+this.blur)/u.width,a)*100+p,c=l((Math.abs(d.y)+this.blur)/u.height,a)*100+p),u.flipX&&(d.x*=-1),u.flipY&&(d.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+c+'%" height="'+(100+2*c)+'%" x="-'+o+'%" width="'+(100+2*o)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,a)+`"></feGaussianBlur>
	<feOffset dx="`+l(d.x,a)+'" dy="'+l(d.y,a)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+f.toRgb()+'" flood-opacity="'+f.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},o=n.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(c){this[c]!==o[c]&&(u[c]=this[c])},this),u}}),n.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(i),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var r=t.util.object.extend,n=t.util.getElementOffset,l=t.util.removeFromArray,u=t.util.toFixed,o=t.util.transformPoint,c=t.util.invertTransform,a=t.util.getNodeCanvas,d=t.util.createCanvasElement,p=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(f,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(f,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(f,v){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(f),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,_),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,_),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,_),v.overlayColor&&this.setOverlayColor(v.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var f=t.devicePixelRatio;this.__initRetinaScaling(f,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(f,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(f,v,_){v.setAttribute("width",this.width*f),v.setAttribute("height",this.height*f),_.scale(f,f)},calcOffset:function(){return this._offset=n(this.lowerCanvasEl),this},setOverlayImage:function(f,v,_){return this.__setBgOverlayImage("overlayImage",f,v,_)},setBackgroundImage:function(f,v,_){return this.__setBgOverlayImage("backgroundImage",f,v,_)},setOverlayColor:function(f,v){return this.__setBgOverlayColor("overlayColor",f,v)},setBackgroundColor:function(f,v){return this.__setBgOverlayColor("backgroundColor",f,v)},__setBgOverlayImage:function(f,v,_,b){return typeof v=="string"?t.util.loadImage(v,function(y,x){if(y){var C=new t.Image(y,b);this[f]=C,C.canvas=this}_&&_(y,x)},this,b&&b.crossOrigin):(b&&v.setOptions(b),this[f]=v,v&&(v.canvas=this),_&&_(v,!1)),this},__setBgOverlayColor:function(f,v,_){return this[f]=v,this._initGradient(v,f),this._initPattern(v,f,_),this},_createCanvasElement:function(){var f=d();if(!f||(f.style||(f.style={}),typeof f.getContext>"u"))throw p;return f},_initOptions:function(f){var v=this.lowerCanvasEl;this._setOptions(f),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(f){f&&f.getContext?this.lowerCanvasEl=f:this.lowerCanvasEl=t.util.getById(f)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f,v){return this.setDimensions({width:f},v)},setHeight:function(f,v){return this.setDimensions({height:f},v)},setDimensions:function(f,v){var _;v=v||{};for(var b in f)_=f[b],v.cssOnly||(this._setBackstoreDimension(b,f[b]),_+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(b,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(f,v){return this.lowerCanvasEl[f]=v,this.upperCanvasEl&&(this.upperCanvasEl[f]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[f]=v),this[f]=v,this},_setCssDimension:function(f,v){return this.lowerCanvasEl.style[f]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[f]=v),this.wrapperEl&&(this.wrapperEl.style[f]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(f){var v=this._activeObject,_=this.backgroundImage,b=this.overlayImage,y,x,C;for(this.viewportTransform=f,x=0,C=this._objects.length;x<C;x++)y=this._objects[x],y.group||y.setCoords(!0);return v&&v.setCoords(),_&&_.setCoords(!0),b&&b.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(f,v){var _=f,b=this.viewportTransform.slice(0);f=o(f,c(this.viewportTransform)),b[0]=v,b[3]=v;var y=o(f,b);return b[4]+=_.x-y.x,b[5]+=_.y-y.y,this.setViewportTransform(b)},setZoom:function(f){return this.zoomToPoint(new t.Point(0,0),f),this},absolutePan:function(f){var v=this.viewportTransform.slice(0);return v[4]=-f.x,v[5]=-f.y,this.setViewportTransform(v)},relativePan:function(f){return this.absolutePan(new t.Point(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(f){this.stateful&&f.setupState(),f._set("canvas",this),f.setCoords(),this.fire("object:added",{target:f}),f.fire("added")},_onObjectRemoved:function(f){this.fire("object:removed",{target:f}),f.fire("removed"),delete f.canvas},clearContext:function(f){return f.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var f=this.contextContainer;return this.renderCanvas(f,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var f={},v=this.width,_=this.height,b=c(this.viewportTransform);return f.tl=o({x:0,y:0},b),f.br=o({x:v,y:_},b),f.tr=new t.Point(f.br.x,f.tl.y),f.bl=new t.Point(f.tl.x,f.br.y),this.vptCoords=f,f},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(f,v){var _=this.viewportTransform,b=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(f),t.util.setImageSmoothing(f,this.imageSmoothingEnabled),this.fire("before:render",{ctx:f}),this._renderBackground(f),f.save(),f.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(f,v),f.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),b&&(b.canvas=this,b.shouldCache(),b._transformDone=!0,b.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(f)),this._renderOverlay(f),this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),this.fire("after:render",{ctx:f})},drawClipPathOnCanvas:function(f){var v=this.viewportTransform,_=this.clipPath;f.save(),f.transform(v[0],v[1],v[2],v[3],v[4],v[5]),f.globalCompositeOperation="destination-in",_.transform(f),f.scale(1/_.zoomX,1/_.zoomY),f.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),f.restore()},_renderObjects:function(f,v){var _,b;for(_=0,b=v.length;_<b;++_)v[_]&&v[_].render(f)},_renderBackgroundOrOverlay:function(f,v){var _=this[v+"Color"],b=this[v+"Image"],y=this.viewportTransform,x=this[v+"Vpt"];if(!(!_&&!b)){if(_){f.save(),f.beginPath(),f.moveTo(0,0),f.lineTo(this.width,0),f.lineTo(this.width,this.height),f.lineTo(0,this.height),f.closePath(),f.fillStyle=_.toLive?_.toLive(f,this):_,x&&f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),f.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var C=_.gradientTransform||_.patternTransform;C&&f.transform(C[0],C[1],C[2],C[3],C[4],C[5]),f.fill(),f.restore()}b&&(f.save(),x&&f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),b.render(f),f.restore())}},_renderBackground:function(f){this._renderBackgroundOrOverlay(f,"background")},_renderOverlay:function(f){this._renderBackgroundOrOverlay(f,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(f){return this._centerObject(f,new t.Point(this.getCenterPoint().x,f.getCenterPoint().y))},centerObjectV:function(f){return this._centerObject(f,new t.Point(f.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(f){var v=this.getCenterPoint();return this._centerObject(f,v)},viewportCenterObject:function(f){var v=this.getVpCenter();return this._centerObject(f,v)},viewportCenterObjectH:function(f){var v=this.getVpCenter();return this._centerObject(f,new t.Point(v.x,f.getCenterPoint().y)),this},viewportCenterObjectV:function(f){var v=this.getVpCenter();return this._centerObject(f,new t.Point(f.getCenterPoint().x,v.y))},getVpCenter:function(){var f=this.getCenterPoint(),v=c(this.viewportTransform);return o(f,v)},_centerObject:function(f,v){return f.setPositionByOrigin(v,"center","center"),f.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,v){var _=this.clipPath,b={version:t.version,objects:this._toObjects(f,v)};return _&&!_.excludeFromExport&&(b.clipPath=this._toObject(this.clipPath,f,v)),r(b,this.__serializeBgOverlay(f,v)),t.util.populateWithProperties(this,b,v),b},_toObjects:function(f,v){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,f,v)},this)},_toObject:function(f,v,_){var b;this.includeDefaultValues||(b=f.includeDefaultValues,f.includeDefaultValues=!1);var y=f[v](_);return this.includeDefaultValues||(f.includeDefaultValues=b),y},__serializeBgOverlay:function(f,v){var _={},b=this.backgroundImage,y=this.overlayImage,x=this.backgroundColor,C=this.overlayColor;return x&&x.toObject?x.excludeFromExport||(_.background=x.toObject(v)):x&&(_.background=x),C&&C.toObject?C.excludeFromExport||(_.overlay=C.toObject(v)):C&&(_.overlay=C),b&&!b.excludeFromExport&&(_.backgroundImage=this._toObject(b,f,v)),y&&!y.excludeFromExport&&(_.overlayImage=this._toObject(y,f,v)),_},svgViewportTransformation:!0,toSVG:function(f,v){f||(f={}),f.reviver=v;var _=[];return this._setSVGPreamble(_,f),this._setSVGHeader(_,f),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",v),this._setSVGObjects(_,v),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",v),_.push("</svg>"),_.join("")},_setSVGPreamble:function(f,v){v.suppressPreamble||f.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(f,v){var _=v.width||this.width,b=v.height||this.height,y,x='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;v.viewBox?x='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(y=this.viewportTransform,x='viewBox="'+u(-y[4]/y[0],C)+" "+u(-y[5]/y[3],C)+" "+u(this.width/y[0],C)+" "+u(this.height/y[3],C)+'" '),f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',_,'" ','height="',b,'" ',x,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(f){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(f.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var f=this,v=["background","overlay"].map(function(_){var b=f[_+"Color"];if(b&&b.toLive){var y=f[_+"Vpt"],x=f.viewportTransform,C={width:f.width/(y?x[0]:1),height:f.height/(y?x[3]:1)};return b.toSVG(C,{additionalTransform:y?t.util.matrixToSVG(x):""})}});return v.join("")},createSVGFontFacesMarkup:function(){var f="",v={},_,b,y,x,C,S,O,F,R,z=t.fontPaths,X=[];for(this._objects.forEach(function q(V){X.push(V),V._objects&&V._objects.forEach(q)}),F=0,R=X.length;F<R;F++)if(_=X[F],b=_.fontFamily,!(_.type.indexOf("text")===-1||v[b]||!z[b])&&(v[b]=!0,!!_.styles)){y=_.styles;for(C in y){x=y[C];for(O in x)S=x[O],b=S.fontFamily,!v[b]&&z[b]&&(v[b]=!0)}}for(var J in v)f+=[`		@font-face {
`,"			font-family: '",J,`';
`,"			src: url('",z[J],`');
`,`		}
`].join("");return f&&(f=['	<style type="text/css">',`<![CDATA[
`,f,"]]>",`</style>
`].join("")),f},_setSVGObjects:function(f,v){var _,b,y,x=this._objects;for(b=0,y=x.length;b<y;b++)_=x[b],!_.excludeFromExport&&this._setSVGObject(f,_,v)},_setSVGObject:function(f,v,_){f.push(v.toSVG(_))},_setSVGBgOverlayImage:function(f,v,_){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&f.push(this[v].toSVG(_))},_setSVGBgOverlayColor:function(f,v){var _=this[v+"Color"],b=this.viewportTransform,y=this.width,x=this.height;if(_)if(_.toLive){var C=_.repeat,S=t.util.invertTransform(b),O=this[v+"Vpt"],F=O?t.util.matrixToSVG(S):"";f.push('<rect transform="'+F+" translate(",y/2,",",x/2,')"',' x="',_.offsetX-y/2,'" y="',_.offsetY-x/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?_.source.width:y,'" height="',C==="repeat-x"||C==="no-repeat"?_.source.height:x,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else f.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(f){if(!f)return this;var v=this._activeObject,_,b,y;if(f===v&&f.type==="activeSelection")for(y=v._objects,_=y.length;_--;)b=y[_],l(this._objects,b),this._objects.unshift(b);else l(this._objects,f),this._objects.unshift(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(f){if(!f)return this;var v=this._activeObject,_,b,y;if(f===v&&f.type==="activeSelection")for(y=v._objects,_=0;_<y.length;_++)b=y[_],l(this._objects,b),this._objects.push(b);else l(this._objects,f),this._objects.push(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(f,v){if(!f)return this;var _=this._activeObject,b,y,x,C,S,O=0;if(f===_&&f.type==="activeSelection")for(S=_._objects,b=0;b<S.length;b++)y=S[b],x=this._objects.indexOf(y),x>0+O&&(C=x-1,l(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(f),x!==0&&(C=this._findNewLowerIndex(f,x,v),l(this._objects,f),this._objects.splice(C,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(f,v,_){var b,y;if(_)for(b=v,y=v-1;y>=0;--y){var x=f.intersectsWithObject(this._objects[y])||f.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(f);if(x){b=y;break}}else b=v-1;return b},bringForward:function(f,v){if(!f)return this;var _=this._activeObject,b,y,x,C,S,O=0;if(f===_&&f.type==="activeSelection")for(S=_._objects,b=S.length;b--;)y=S[b],x=this._objects.indexOf(y),x<this._objects.length-1-O&&(C=x+1,l(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(f),x!==this._objects.length-1&&(C=this._findNewUpperIndex(f,x,v),l(this._objects,f),this._objects.splice(C,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(f,v,_){var b,y,x;if(_)for(b=v,y=v+1,x=this._objects.length;y<x;++y){var C=f.intersectsWithObject(this._objects[y])||f.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(f);if(C){b=y;break}}else b=v+1;return b},moveTo:function(f,v){return l(this._objects,f),this._objects.splice(v,0,f),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),r(t.StaticCanvas.prototype,t.Observable),r(t.StaticCanvas.prototype,t.Collection),r(t.StaticCanvas.prototype,t.DataURLExporter),r(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(f){var v=d();if(!v||!v.getContext)return null;var _=v.getContext("2d");if(!_)return null;switch(f){case"setLineDash":return typeof _.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var f=a(this.lowerCanvasEl);return f&&f.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(f){var v=a(this.lowerCanvasEl);return v&&v.createJPEGStream(f)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(r){r.strokeStyle=this.color,r.lineWidth=this.width,r.lineCap=this.strokeLineCap,r.miterLimit=this.strokeMiterLimit,r.lineJoin=this.strokeLineJoin,r.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(r){var n=this.canvas.viewportTransform;r.save(),r.transform(n[0],n[1],n[2],n[3],n[4],n[5])},_setShadow:function(){if(this.shadow){var r=this.canvas,n=this.shadow,l=r.contextTop,u=r.getZoom();r&&r._isRetinaScaling()&&(u*=t.devicePixelRatio),l.shadowColor=n.color,l.shadowBlur=n.blur*u,l.shadowOffsetX=n.offsetX*u,l.shadowOffsetY=n.offsetY*u}},needsFullRender:function(){var r=new t.Color(this.color);return r.getAlpha()<1||!!this.shadow},_resetShadow:function(){var r=this.canvas.contextTop;r.shadowColor="",r.shadowBlur=r.shadowOffsetX=r.shadowOffsetY=0},_isOutSideCanvas:function(r){return r.x<0||r.x>this.canvas.getWidth()||r.y<0||r.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(r){this.canvas=r,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(r,n,l){var u=n.midPointFrom(l);return r.quadraticCurveTo(n.x,n.y,u.x,u.y),u},onMouseDown:function(r,n){this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],this._prepareForDrawing(r),this._captureDrawingPath(r),this._render())},onMouseMove:function(r,n){if(this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(r))&&this._captureDrawingPath(r)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,u=l.length,o=this.canvas.contextTop;this._saveAndTransform(o),this.oldEnd&&(o.beginPath(),o.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(o,l[u-2],l[u-1],!0),o.stroke(),o.restore()}},onMouseUp:function(r){return this.canvas._isMainEvent(r.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(r){var n=new t.Point(r.x,r.y);this._reset(),this._addPoint(n),this.canvas.contextTop.moveTo(n.x,n.y)},_addPoint:function(r){return this._points.length>1&&r.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(r),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(r){var n=new t.Point(r.x,r.y);return this._addPoint(n)},_render:function(r){var n,l,u=this._points[0],o=this._points[1];if(r=r||this.canvas.contextTop,this._saveAndTransform(r),r.beginPath(),this._points.length===2&&u.x===o.x&&u.y===o.y){var c=this.width/1e3;u=new t.Point(u.x,u.y),o=new t.Point(o.x,o.y),u.x-=c,o.x+=c}for(r.moveTo(u.x,u.y),n=1,l=this._points.length;n<l;n++)this._drawSegment(r,u,o),u=this._points[n],o=this._points[n+1];r.lineTo(u.x,u.y),r.stroke(),r.restore()},convertPointsToSVGPath:function(r){var n=this.width/1e3;return t.util.getSmoothPathFromPoints(r,n)},_isEmptySVGPath:function(r){var n=t.util.joinPath(r);return n==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(r){var n=new t.Path(r,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,n.shadow=new t.Shadow(this.shadow)),n},decimatePoints:function(r,n){if(r.length<=2)return r;var l=this.canvas.getZoom(),u=Math.pow(n/l,2),o,c=r.length-1,a=r[0],d=[a],p;for(o=1;o<c-1;o++)p=Math.pow(a.x-r[o].x,2)+Math.pow(a.y-r[o].y,2),p>=u&&(a=r[o],d.push(a));return d.push(r[c]),d},_finalizeAndAddPath:function(){var r=this.canvas.contextTop;r.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var n=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(n)){this.canvas.requestRenderAll();return}var l=this.createPath(n);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(r){this.canvas=r,this.points=[]},drawDot:function(r){var n=this.addPoint(r),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,n),l.restore()},dot:function(r,n){r.fillStyle=n.fill,r.beginPath(),r.arc(n.x,n.y,n.radius,0,Math.PI*2,!1),r.closePath(),r.fill()},onMouseDown:function(r){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(r)},_render:function(){var r=this.canvas.contextTop,n,l,u=this.points;for(this._saveAndTransform(r),n=0,l=u.length;n<l;n++)this.dot(r,u[n]);r.restore()},onMouseMove:function(r){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(r)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(r),this._render()):this.drawDot(r))},onMouseUp:function(){var r=this.canvas.renderOnAddRemove,n,l;this.canvas.renderOnAddRemove=!1;var u=[];for(n=0,l=this.points.length;n<l;n++){var o=this.points[n],c=new t.Circle({radius:o.radius,left:o.x,top:o.y,originX:"center",originY:"center",fill:o.fill});this.shadow&&(c.shadow=new t.Shadow(this.shadow)),u.push(c)}var a=new t.Group(u);a.canvas=this.canvas,this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=r,this.canvas.requestRenderAll()},addPoint:function(r){var n=new t.Point(r.x,r.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return n.radius=l,n.fill=u,this.points.push(n),n}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(r){this.canvas=r,this.sprayChunks=[]},onMouseDown:function(r){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(r),this.render(this.sprayChunkPoints)},onMouseMove:function(r){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(r)||(this.addSprayChunk(r),this.render(this.sprayChunkPoints))},onMouseUp:function(){var r=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var n=[],l=0,u=this.sprayChunks.length;l<u;l++)for(var o=this.sprayChunks[l],c=0,a=o.length;c<a;c++){var d=new t.Rect({width:o[c].width,height:o[c].width,left:o[c].x+1,top:o[c].y+1,originX:"center",originY:"center",fill:this.color});n.push(d)}this.optimizeOverlapping&&(n=this._getOptimizedRects(n));var p=new t.Group(n);this.shadow&&p.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:p}),this.canvas.add(p),this.canvas.fire("path:created",{path:p}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=r,this.canvas.requestRenderAll()},_getOptimizedRects:function(r){var n={},l,u,o;for(u=0,o=r.length;u<o;u++)l=r[u].left+""+r[u].top,n[l]||(n[l]=r[u]);var c=[];for(l in n)c.push(n[l]);return c},render:function(r){var n=this.canvas.contextTop,l,u;for(n.fillStyle=this.color,this._saveAndTransform(n),l=0,u=r.length;l<u;l++){var o=r[l];typeof o.opacity<"u"&&(n.globalAlpha=o.opacity),n.fillRect(o.x,o.y,o.width,o.width)}n.restore()},_render:function(){var r=this.canvas.contextTop,n,l;for(r.fillStyle=this.color,this._saveAndTransform(r),n=0,l=this.sprayChunks.length;n<l;n++)this.render(this.sprayChunks[n]);r.restore()},addSprayChunk:function(r){this.sprayChunkPoints=[];var n,l,u,o=this.width/2,c;for(c=0;c<this.density;c++){n=t.util.getRandomInt(r.x-o,r.x+o),l=t.util.getRandomInt(r.y-o,r.y+o),this.dotWidthVariance?u=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):u=this.dotWidth;var a=new t.Point(n,l);a.width=u,this.randomOpacity&&(a.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var r=20,n=5,l=t.util.createCanvasElement(),u=l.getContext("2d");return l.width=l.height=r+n,u.fillStyle=this.color,u.beginPath(),u.arc(r/2,r/2,r/2,0,Math.PI*2,!1),u.closePath(),u.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(r){return r.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(r){this.callSuper("_setBrushStyles",r),r.strokeStyle=this.getPattern(r)},createPath:function(r){var n=this.callSuper("createPath",r),l=n._getLeftTopCoords().scalarAdd(n.strokeWidth/2);return n.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),n}}),function(){var r=t.util.getPointer,n=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(o,c){c||(c={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,c),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var o=this.getActiveObjects(),c,a,d;if(o.length>0&&!this.preserveObjectStacking){a=[],d=[];for(var p=0,f=this._objects.length;p<f;p++)c=this._objects[p],o.indexOf(c)===-1?a.push(c):d.push(c);o.length>1&&(this._activeObject._objects=d),a.push.apply(a,d)}else a=this._objects;return a},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var o=this.contextContainer;return this.renderCanvas(o,this._chooseObjectsToRender()),this},renderTopLayer:function(o){o.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(o),this.contextTopDirty=!0),o.restore()},renderTop:function(){var o=this.contextTop;return this.clearContext(o),this.renderTopLayer(o),this.fire("after:render"),this},_normalizePointer:function(o,c){var a=o.calcTransformMatrix(),d=t.util.invertTransform(a),p=this.restorePointerVpt(c);return t.util.transformPoint(p,d)},isTargetTransparent:function(o,c,a){if(o.shouldCache()&&o._cacheCanvas&&o!==this._activeObject){var d=this._normalizePointer(o,{x:c,y:a}),p=Math.max(o.cacheTranslationX+d.x*o.zoomX,0),f=Math.max(o.cacheTranslationY+d.y*o.zoomY,0),y=t.util.isTransparent(o._cacheContext,Math.round(p),Math.round(f),this.targetFindTolerance);return y}var v=this.contextCache,_=o.selectionBackgroundColor,b=this.viewportTransform;o.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(b[0],b[1],b[2],b[3],b[4],b[5]),o.render(v),v.restore(),o.selectionBackgroundColor=_;var y=t.util.isTransparent(v,c,a,this.targetFindTolerance);return y},_isSelectionKeyPressed:function(o){var c=!1;return Array.isArray(this.selectionKey)?c=!!this.selectionKey.find(function(a){return o[a]===!0}):c=o[this.selectionKey],c},_shouldClearSelection:function(o,c){var a=this.getActiveObjects(),d=this._activeObject;return!c||c&&d&&a.length>1&&a.indexOf(c)===-1&&d!==c&&!this._isSelectionKeyPressed(o)||c&&!c.evented||c&&!c.selectable&&d&&d!==c},_shouldCenterTransform:function(o,c,a){if(o){var d;return c==="scale"||c==="scaleX"||c==="scaleY"||c==="resizing"?d=this.centeredScaling||o.centeredScaling:c==="rotate"&&(d=this.centeredRotation||o.centeredRotation),d?!a:a}},_getOriginFromCorner:function(o,c){var a={x:o.originX,y:o.originY};return c==="ml"||c==="tl"||c==="bl"?a.x="right":(c==="mr"||c==="tr"||c==="br")&&(a.x="left"),c==="tl"||c==="mt"||c==="tr"?a.y="bottom":(c==="bl"||c==="mb"||c==="br")&&(a.y="top"),a},_getActionFromCorner:function(o,c,a,d){if(!c||!o)return"drag";var p=d.controls[c];return p.getActionName(a,p,d)},_setupCurrentTransform:function(o,c,a){if(c){var d=this.getPointer(o),p=c.__corner,f=c.controls[p],v=a&&p?f.getActionHandler(o,c,f):t.controlsUtils.dragHandler,_=this._getActionFromCorner(a,p,o,c),b=this._getOriginFromCorner(c,p),y=o[this.centeredKey],x={target:c,action:_,actionHandler:v,corner:p,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:b.x,originY:b.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,theta:n(c.angle),width:c.width*c.scaleX,shiftKey:o.shiftKey,altKey:y,original:t.util.saveObjectTransform(c)};this._shouldCenterTransform(c,_,y)&&(x.originX="center",x.originY="center"),x.original.originX=b.x,x.original.originY=b.y,this._currentTransform=x,this._beforeTransform(o)}},setCursor:function(o){this.upperCanvasEl.style.cursor=o},_drawSelection:function(o){var c=this._groupSelector,a=new t.Point(c.ex,c.ey),d=t.util.transformPoint(a,this.viewportTransform),p=new t.Point(c.ex+c.left,c.ey+c.top),f=t.util.transformPoint(p,this.viewportTransform),v=Math.min(d.x,f.x),_=Math.min(d.y,f.y),b=Math.max(d.x,f.x),y=Math.max(d.y,f.y),x=this.selectionLineWidth/2;this.selectionColor&&(o.fillStyle=this.selectionColor,o.fillRect(v,_,b-v,y-_)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(o.lineWidth=this.selectionLineWidth,o.strokeStyle=this.selectionBorderColor,v+=x,_+=x,b-=x,y-=x,t.Object.prototype._setLineDash.call(this,o,this.selectionDashArray),o.strokeRect(v,_,b-v,y-_))},findTarget:function(o,c){if(!this.skipTargetFind){var a=!0,d=this.getPointer(o,a),p=this._activeObject,f=this.getActiveObjects(),v,_,b=l(o),y=f.length>1&&!c||f.length===1;if(this.targets=[],y&&p._findTargetCorner(d,b)||f.length>1&&!c&&p===this._searchPossibleTargets([p],d))return p;if(f.length===1&&p===this._searchPossibleTargets([p],d))if(this.preserveObjectStacking)v=p,_=this.targets,this.targets=[];else return p;var x=this._searchPossibleTargets(this._objects,d);return o[this.altSelectionKey]&&x&&v&&x!==v&&(x=v,this.targets=_),x}},_checkTarget:function(o,c,a){if(c&&c.visible&&c.evented&&c.containsPoint(o))if((this.perPixelTargetFind||c.perPixelTargetFind)&&!c.isEditing){var d=this.isTargetTransparent(c,a.x,a.y);if(!d)return!0}else return!0},_searchPossibleTargets:function(o,c){for(var a,d=o.length,p;d--;){var f=o[d],v=f.group?this._normalizePointer(f.group,c):c;if(this._checkTarget(v,f,c)){a=o[d],a.subTargetCheck&&a instanceof t.Group&&(p=this._searchPossibleTargets(a._objects,c),p&&this.targets.push(p));break}}return a},restorePointerVpt:function(o){return t.util.transformPoint(o,t.util.invertTransform(this.viewportTransform))},getPointer:function(o,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var a=r(o),d=this.upperCanvasEl,p=d.getBoundingClientRect(),f=p.width||0,v=p.height||0,_;(!f||!v)&&("top"in p&&"bottom"in p&&(v=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(f=Math.abs(p.right-p.left))),this.calcOffset(),a.x=a.x-this._offset.left,a.y=a.y-this._offset.top,c||(a=this.restorePointerVpt(a));var b=this.getRetinaScaling();return b!==1&&(a.x/=b,a.y/=b),f===0||v===0?_={width:1,height:1}:_={width:d.width/f,height:d.height/v},{x:a.x*_.width,y:a.y*_.height}},_createUpperCanvas:function(){var o=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),c=this.lowerCanvasEl,a=this.upperCanvasEl;a?a.className="":(a=this._createCanvasElement(),this.upperCanvasEl=a),t.util.addClass(a,"upper-canvas "+o),this.wrapperEl.appendChild(a),this._copyCanvasStyle(c,a),this._applyCanvasStyle(a),this.contextTop=a.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(o){var c=this.width||o.width,a=this.height||o.height;t.util.setStyle(o,{position:"absolute",width:c+"px",height:a+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),o.width=c,o.height=a,t.util.makeElementUnselectable(o)},_copyCanvasStyle:function(o,c){c.style.cssText=o.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var o=this._activeObject;return o?o.type==="activeSelection"&&o._objects?o._objects.slice(0):[o]:[]},_onObjectRemoved:function(o){o===this._activeObject&&(this.fire("before:selection:cleared",{target:o}),this._discardActiveObject(),this.fire("selection:cleared",{target:o}),o.fire("deselected")),o===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",o)},_fireSelectionEvents:function(o,c){var a=!1,d=this.getActiveObjects(),p=[],f=[];o.forEach(function(v){d.indexOf(v)===-1&&(a=!0,v.fire("deselected",{e:c,target:v}),f.push(v))}),d.forEach(function(v){o.indexOf(v)===-1&&(a=!0,v.fire("selected",{e:c,target:v}),p.push(v))}),o.length>0&&d.length>0?a&&this.fire("selection:updated",{e:c,selected:p,deselected:f}):d.length>0?this.fire("selection:created",{e:c,selected:p}):o.length>0&&this.fire("selection:cleared",{e:c,deselected:f})},setActiveObject:function(o,c){var a=this.getActiveObjects();return this._setActiveObject(o,c),this._fireSelectionEvents(a,c),this},_setActiveObject:function(o,c){return this._activeObject===o||!this._discardActiveObject(c,o)||o.onSelect({e:c})?!1:(this._activeObject=o,!0)},_discardActiveObject:function(o,c){var a=this._activeObject;if(a){if(a.onDeselect({e:o,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(o){var c=this.getActiveObjects(),a=this.getActiveObject();return c.length&&this.fire("before:selection:cleared",{target:a,e:o}),this._discardActiveObject(o),this._fireSelectionEvents(c,o),this},dispose:function(){var o=this.wrapperEl;return this.removeListeners(),o.removeChild(this.upperCanvasEl),o.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(c){t.util.cleanUpJsdomNode(this[c]),this[c]=void 0}).bind(this)),o.parentNode&&o.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(o){var c=this._activeObject;c&&c._renderControls(o)},_toObject:function(o,c,a){var d=this._realizeGroupTransformOnObject(o),p=this.callSuper("_toObject",o,c,a);return this._unwindGroupTransformOnObject(o,d),p},_realizeGroupTransformOnObject:function(o){if(o.group&&o.group.type==="activeSelection"&&this._activeObject===o.group){var c=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],a={};return c.forEach(function(d){a[d]=o[d]}),t.util.addTransformToObject(o,this._activeObject.calcOwnMatrix()),a}else return null},_unwindGroupTransformOnObject:function(o,c){c&&o.set(c)},_setSVGObject:function(o,c,a){var d=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",o,c,a),this._unwindGroupTransformOnObject(c,d)},setViewportTransform:function(o){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,o)}});for(var u in t.StaticCanvas)u!=="prototype"&&(t.Canvas[u]=t.StaticCanvas[u])}(),function(){var r=t.util.addListener,n=t.util.removeListener,l=3,u=2,o=1,c={passive:!1};function a(d,p){return d.button&&d.button===p-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(r,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(d,p){var f=this.upperCanvasEl,v=this._getEventPrefix();d(t.window,"resize",this._onResize),d(f,v+"down",this._onMouseDown),d(f,v+"move",this._onMouseMove,c),d(f,v+"out",this._onMouseOut),d(f,v+"enter",this._onMouseEnter),d(f,"wheel",this._onMouseWheel),d(f,"contextmenu",this._onContextMenu),d(f,"dblclick",this._onDoubleClick),d(f,"dragover",this._onDragOver),d(f,"dragenter",this._onDragEnter),d(f,"dragleave",this._onDragLeave),d(f,"drop",this._onDrop),this.enablePointerEvents||d(f,"touchstart",this._onTouchStart,c),typeof eventjs<"u"&&p in eventjs&&(eventjs[p](f,"gesture",this._onGesture),eventjs[p](f,"drag",this._onDrag),eventjs[p](f,"orientation",this._onOrientationChange),eventjs[p](f,"shake",this._onShake),eventjs[p](f,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(n,"remove");var d=this._getEventPrefix();n(t.document,d+"up",this._onMouseUp),n(t.document,"touchend",this._onTouchEnd,c),n(t.document,d+"move",this._onMouseMove,c),n(t.document,"touchmove",this._onMouseMove,c)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(d,p){this.__onTransformGesture&&this.__onTransformGesture(d,p)},_onDrag:function(d,p){this.__onDrag&&this.__onDrag(d,p)},_onMouseWheel:function(d){this.__onMouseWheel(d)},_onMouseOut:function(d){var p=this._hoveredTarget;this.fire("mouse:out",{target:p,e:d}),this._hoveredTarget=null,p&&p.fire("mouseout",{e:d});var f=this;this._hoveredTargets.forEach(function(v){f.fire("mouse:out",{target:p,e:d}),v&&p.fire("mouseout",{e:d})}),this._hoveredTargets=[]},_onMouseEnter:function(d){!this._currentTransform&&!this.findTarget(d)&&(this.fire("mouse:over",{target:null,e:d}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(d,p){this.__onOrientationChange&&this.__onOrientationChange(d,p)},_onShake:function(d,p){this.__onShake&&this.__onShake(d,p)},_onLongPress:function(d,p){this.__onLongPress&&this.__onLongPress(d,p)},_onDragOver:function(d){d.preventDefault();var p=this._simpleEventHandler("dragover",d);this._fireEnterLeaveEvents(p,d)},_onDrop:function(d){return this._simpleEventHandler("drop:before",d),this._simpleEventHandler("drop",d)},_onContextMenu:function(d){return this.stopContextMenu&&(d.stopPropagation(),d.preventDefault()),!1},_onDoubleClick:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"dblclick"),this._resetTransformEventData(d)},getPointerId:function(d){var p=d.changedTouches;return p?p[0]&&p[0].identifier:this.enablePointerEvents?d.pointerId:-1},_isMainEvent:function(d){return d.isPrimary===!0?!0:d.isPrimary===!1?!1:d.type==="touchend"&&d.touches.length===0?!0:d.changedTouches?d.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(d){d.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(d)),this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,f=this._getEventPrefix();r(t.document,"touchend",this._onTouchEnd,c),r(t.document,"touchmove",this._onMouseMove,c),n(p,f+"down",this._onMouseDown)},_onMouseDown:function(d){this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,f=this._getEventPrefix();n(p,f+"move",this._onMouseMove,c),r(t.document,f+"up",this._onMouseUp),r(t.document,f+"move",this._onMouseMove,c)},_onTouchEnd:function(d){if(!(d.touches.length>0)){this.__onMouseUp(d),this._resetTransformEventData(),this.mainTouchId=null;var p=this._getEventPrefix();n(t.document,"touchend",this._onTouchEnd,c),n(t.document,"touchmove",this._onMouseMove,c);var f=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){r(f.upperCanvasEl,p+"down",f._onMouseDown),f._willAddMouseDown=0},400)}},_onMouseUp:function(d){this.__onMouseUp(d),this._resetTransformEventData();var p=this.upperCanvasEl,f=this._getEventPrefix();this._isMainEvent(d)&&(n(t.document,f+"up",this._onMouseUp),n(t.document,f+"move",this._onMouseMove,c),r(p,f+"move",this._onMouseMove,c))},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(d){var p=this._activeObject;return!!p!=!!d||p&&d&&p!==d?!0:(p&&p.isEditing,!1)},__onMouseUp:function(d){var p,f=this._currentTransform,v=this._groupSelector,_=!1,b=!v||v.left===0&&v.top===0;if(this._cacheTransformEventData(d),p=this._target,this._handleEvent(d,"up:before"),a(d,l)){this.fireRightClick&&this._handleEvent(d,"up",l,b);return}if(a(d,u)){this.fireMiddleClick&&this._handleEvent(d,"up",u,b),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(d);return}if(this._isMainEvent(d)){if(f&&(this._finalizeCurrentTransform(d),_=f.actionPerformed),!b){var y=p===this._activeObject;this._maybeGroupObjects(d),_||(_=this._shouldRender(p)||!y&&p===this._activeObject)}var x,C;if(p){if(x=p._findTargetCorner(this.getPointer(d,!0),t.util.isTouchEvent(d)),p.selectable&&p!==this._activeObject&&p.activeOn==="up")this.setActiveObject(p,d),_=!0;else{var S=p.controls[x],O=S&&S.getMouseUpHandler(d,p,S);O&&(C=this.getPointer(d),O(d,f,C.x,C.y))}p.isMoving=!1}if(f&&(f.target!==p||f.corner!==x)){var F=f.target&&f.target.controls[f.corner],R=F&&F.getMouseUpHandler(d,p,S);C=C||this.getPointer(d),R&&R(d,f,C.x,C.y)}this._setCursorFromEvent(d,p),this._handleEvent(d,"up",o,b),this._groupSelector=null,this._currentTransform=null,p&&(p.__corner=0),_?this.requestRenderAll():b||this.renderTop()}},_simpleEventHandler:function(d,p){var f=this.findTarget(p),v=this.targets,_={e:p,target:f,subTargets:v};if(this.fire(d,_),f&&f.fire(d,_),!v)return f;for(var b=0;b<v.length;b++)v[b].fire(d,_);return f},_handleEvent:function(d,p,f,v){var _=this._target,b=this.targets||[],y={e:d,target:_,subTargets:b,button:f||o,isClick:v||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};p==="up"&&(y.currentTarget=this.findTarget(d),y.currentSubTargets=this.targets),this.fire("mouse:"+p,y),_&&_.fire("mouse"+p,y);for(var x=0;x<b.length;x++)b[x].fire("mouse"+p,y)},_finalizeCurrentTransform:function(d){var p=this._currentTransform,f=p.target,v={e:d,target:f,transform:p,action:p.action};f._scaling&&(f._scaling=!1),f.setCoords(),(p.actionPerformed||this.stateful&&f.hasStateChanged())&&this._fire("modified",v)},_onMouseDownInDrawingMode:function(d){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(d).requestRenderAll();var p=this.getPointer(d);this.freeDrawingBrush.onMouseDown(p,{e:d,pointer:p}),this._handleEvent(d,"down")},_onMouseMoveInDrawingMode:function(d){if(this._isCurrentlyDrawing){var p=this.getPointer(d);this.freeDrawingBrush.onMouseMove(p,{e:d,pointer:p})}this.setCursor(this.freeDrawingCursor),this._handleEvent(d,"move")},_onMouseUpInDrawingMode:function(d){var p=this.getPointer(d);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:d,pointer:p}),this._handleEvent(d,"up")},__onMouseDown:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"down:before");var p=this._target;if(a(d,l)){this.fireRightClick&&this._handleEvent(d,"down",l);return}if(a(d,u)){this.fireMiddleClick&&this._handleEvent(d,"down",u);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(d);return}if(this._isMainEvent(d)&&!this._currentTransform){var f=this._pointer;this._previousPointer=f;var v=this._shouldRender(p),_=this._shouldGroup(d,p);if(this._shouldClearSelection(d,p)?this.discardActiveObject(d):_&&(this._handleGrouping(d,p),p=this._activeObject),this.selection&&(!p||!p.selectable&&!p.isEditing&&p!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),p){var b=p===this._activeObject;p.selectable&&p.activeOn==="down"&&this.setActiveObject(p,d);var y=p._findTargetCorner(this.getPointer(d,!0),t.util.isTouchEvent(d));if(p.__corner=y,p===this._activeObject&&(y||!_)){this._setupCurrentTransform(d,p,b);var x=p.controls[y],f=this.getPointer(d),C=x&&x.getMouseDownHandler(d,p,x);C&&C(d,this._currentTransform,f.x,f.y)}}this._handleEvent(d,"down"),(v||_)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(d){this._resetTransformEventData(),this._pointer=this.getPointer(d,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(d)||null},_beforeTransform:function(d){var p=this._currentTransform;this.stateful&&p.target.saveState(),this.fire("before:transform",{e:d,transform:p})},__onMouseMove:function(d){this._handleEvent(d,"move:before"),this._cacheTransformEventData(d);var p,f;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(d);return}if(this._isMainEvent(d)){var v=this._groupSelector;v?(f=this._absolutePointer,v.left=f.x-v.ex,v.top=f.y-v.ey,this.renderTop()):this._currentTransform?this._transformObject(d):(p=this.findTarget(d)||null,this._setCursorFromEvent(d,p),this._fireOverOutEvents(p,d)),this._handleEvent(d,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(d,p){var f=this._hoveredTarget,v=this._hoveredTargets,_=this.targets,b=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:f,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:v[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=d,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(d,p){var f=this._draggedoverTarget,v=this._hoveredTargets,_=this.targets,b=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:f,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:v[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=d},fireSyntheticInOutEvents:function(d,p,f){var v,_,b=f.oldTarget,y,x,C=b!==d,S=f.canvasEvtIn,O=f.canvasEvtOut;C&&(v={e:p,target:d,previousTarget:b},_={e:p,target:b,nextTarget:d}),x=d&&C,y=b&&C,y&&(O&&this.fire(O,_),b.fire(f.evtOut,_)),x&&(S&&this.fire(S,v),d.fire(f.evtIn,v))},__onMouseWheel:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"wheel"),this._resetTransformEventData()},_transformObject:function(d){var p=this.getPointer(d),f=this._currentTransform;f.reset=!1,f.shiftKey=d.shiftKey,f.altKey=d[this.centeredKey],this._performTransformAction(d,f,p),f.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(d,p,f){var v=f.x,_=f.y,b=p.action,y=!1,x=p.actionHandler;x&&(y=x(d,p,v,_)),b==="drag"&&y&&(p.target.isMoving=!0,this.setCursor(p.target.moveCursor||this.moveCursor)),p.actionPerformed=p.actionPerformed||y},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(d,p){if(!p)return this.setCursor(this.defaultCursor),!1;var f=p.hoverCursor||this.hoverCursor,v=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,_=(!v||!v.contains(p))&&p._findTargetCorner(this.getPointer(d,!0));_?this.setCursor(this.getCornerCursor(_,p,d)):(p.subTargetCheck&&this.targets.concat().reverse().map(function(b){f=b.hoverCursor||f}),this.setCursor(f))},getCornerCursor:function(d,p,f){var v=p.controls[d];return v.cursorStyleHandler(f,v,p)}})}(),function(){var r=Math.min,n=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,u){var o=this._activeObject;return o&&this._isSelectionKeyPressed(l)&&u&&u.selectable&&this.selection&&(o!==u||o.type==="activeSelection")&&!u.onSelect({e:l})},_handleGrouping:function(l,u){var o=this._activeObject;o.__corner||u===o&&(u=this.findTarget(l,!0),!u||!u.selectable)||(o&&o.type==="activeSelection"?this._updateActiveSelection(u,l):this._createActiveSelection(u,l))},_updateActiveSelection:function(l,u){var o=this._activeObject,c=o._objects.slice(0);o.contains(l)?(o.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),o.size()===1&&this._setActiveObject(o.item(0),u)):(o.addWithUpdate(l),this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(c,u)},_createActiveSelection:function(l,u){var o=this.getActiveObjects(),c=this._createGroup(l);this._hoveredTarget=c,this._setActiveObject(c,u),this._fireSelectionEvents(o,u)},_createGroup:function(l){var u=this._objects,o=u.indexOf(this._activeObject)<u.indexOf(l),c=o?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(c,{canvas:this})},_groupSelectedObjects:function(l){var u=this._collectObjects(l),o;u.length===1?this.setActiveObject(u[0],l):u.length>1&&(o=new t.ActiveSelection(u.reverse(),{canvas:this}),this.setActiveObject(o,l))},_collectObjects:function(l){for(var u=[],o,c=this._groupSelector.ex,a=this._groupSelector.ey,d=c+this._groupSelector.left,p=a+this._groupSelector.top,f=new t.Point(r(c,d),r(a,p)),v=new t.Point(n(c,d),n(a,p)),_=!this.selectionFullyContained,b=c===d&&a===p,y=this._objects.length;y--&&(o=this._objects[y],!(!(!o||!o.selectable||!o.visible)&&(_&&o.intersectsWithRect(f,v,!0)||o.isContainedWithinRect(f,v,!0)||_&&o.containsPoint(f,null,!0)||_&&o.containsPoint(v,null,!0))&&(u.push(o),b))););return u.length>1&&(u=u.filter(function(x){return!x.onSelect({e:l})})),u},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(r){r||(r={});var n=r.format||"png",l=r.quality||1,u=(r.multiplier||1)*(r.enableRetinaScaling?this.getRetinaScaling():1),o=this.toCanvasElement(u,r);return t.util.toDataURL(o,n,l)},toCanvasElement:function(r,n){r=r||1,n=n||{};var l=(n.width||this.width)*r,u=(n.height||this.height)*r,o=this.getZoom(),c=this.width,a=this.height,d=o*r,p=this.viewportTransform,f=(p[4]-(n.left||0))*r,v=(p[5]-(n.top||0))*r,_=this.interactive,b=[d,0,0,d,f,v],y=this.enableRetinaScaling,x=t.util.createCanvasElement(),C=this.contextTop;return x.width=l,x.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=b,this.width=l,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(x.getContext("2d"),this._objects),this.viewportTransform=p,this.width=c,this.height=a,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=y,this.contextTop=C,x}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(r,n,l){if(r){var u=typeof r=="string"?JSON.parse(r):t.util.object.clone(r),o=this,c=u.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(d){o.clear(),o._setBgOverlay(u,function(){c?o._enlivenObjects([c],function(p){o.clipPath=p[0],o.__setupCanvas.call(o,u,d,a,n)}):o.__setupCanvas.call(o,u,d,a,n)})},l),this}},__setupCanvas:function(r,n,l,u){var o=this;n.forEach(function(c,a){o.insertAt(c,a)}),this.renderOnAddRemove=l,delete r.objects,delete r.backgroundImage,delete r.overlayImage,delete r.background,delete r.overlay,this._setOptions(r),this.renderAll(),u&&u()},_setBgOverlay:function(r,n){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!r.backgroundImage&&!r.overlayImage&&!r.background&&!r.overlay){n&&n();return}var u=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&n&&n()};this.__setBgOverlay("backgroundImage",r.backgroundImage,l,u),this.__setBgOverlay("overlayImage",r.overlayImage,l,u),this.__setBgOverlay("backgroundColor",r.background,l,u),this.__setBgOverlay("overlayColor",r.overlay,l,u)},__setBgOverlay:function(r,n,l,u){var o=this;if(!n){l[r]=!0,u&&u();return}r==="backgroundImage"||r==="overlayImage"?t.util.enlivenObjects([n],function(c){o[r]=c[0],l[r]=!0,u&&u()}):this["set"+t.util.string.capitalize(r,!0)](n,function(){l[r]=!0,u&&u()})},_enlivenObjects:function(r,n,l){if(!r||r.length===0){n&&n([]);return}t.util.enlivenObjects(r,function(u){n&&n(u)},null,l)},_toDataURL:function(r,n){this.clone(function(l){n(l.toDataURL(r))})},_toDataURLWithMultiplier:function(r,n,l){this.clone(function(u){l(u.toDataURLWithMultiplier(r,n))})},clone:function(r,n){var l=JSON.stringify(this.toJSON(n));this.cloneWithoutData(function(u){u.loadFromJSON(l,function(){r&&r(u)})})},cloneWithoutData:function(r){var n=t.util.createCanvasElement();n.width=this.width,n.height=this.height;var l=new t.Canvas(n);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),r&&r(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):r&&r(l)}}),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.util.object.clone,o=n.util.toFixed,c=n.util.string.capitalize,a=n.util.degreesToRadians,d=!n.isLikelyNode,p=2;n.Object||(n.Object=n.util.createClass(n.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:d,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(f){f&&this.setOptions(f)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=n.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(f){var v=n.perfLimitSizeTotal,_=f.width,b=f.height,y=n.maxCacheSideLimit,x=n.minCacheSideLimit;if(_<=y&&b<=y&&_*b<=v)return _<x&&(f.width=x),b<x&&(f.height=x),f;var C=_/b,S=n.util.limitDimsByArea(C,v),O=n.util.capValue,F=O(x,S.x,y),R=O(x,S.y,y);return _>F&&(f.zoomX/=_/F,f.width=F,f.capped=!0),b>R&&(f.zoomY/=b/R,f.height=R,f.capped=!0),f},_getCacheCanvasDimensions:function(){var f=this.getTotalObjectScaling(),v=this._getTransformedDimensions(0,0),_=v.x*f.scaleX/this.scaleX,b=v.y*f.scaleY/this.scaleY;return{width:_+p,height:b+p,zoomX:f.scaleX,zoomY:f.scaleY,x:_,y:b}},_updateCacheCanvas:function(){var f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){var v=f._currentTransform.target,_=f._currentTransform.action;if(this===v&&_.slice&&_.slice(0,5)==="scale")return!1}var b=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),x=n.minCacheSideLimit,C=y.width,S=y.height,O,F,R=y.zoomX,z=y.zoomY,X=C!==this.cacheWidth||S!==this.cacheHeight,J=this.zoomX!==R||this.zoomY!==z,q=X||J,V=0,Q=0,tt=!1;if(X){var et=this._cacheCanvas.width,w=this._cacheCanvas.height,M=C>et||S>w,D=(C<et*.9||S<w*.9)&&et>x&&w>x;tt=M||D,M&&!y.capped&&(C>x||S>x)&&(V=C*.1,Q=S*.1)}return this instanceof n.Text&&this.path&&(q=!0,tt=!0,V+=this.getHeightOfLine(0)*this.zoomX,Q+=this.getHeightOfLine(0)*this.zoomY),q?(tt?(b.width=Math.ceil(C+V),b.height=Math.ceil(S+Q)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,b.width,b.height)),O=y.x/2,F=y.y/2,this.cacheTranslationX=Math.round(b.width/2-O)+O,this.cacheTranslationY=Math.round(b.height/2-F)+F,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(R,z),this.zoomX=R,this.zoomY=z,!0):!1},setOptions:function(f){this._setOptions(f),this._initGradient(f.fill,"fill"),this._initGradient(f.stroke,"stroke"),this._initPattern(f.fill,"fill"),this._initPattern(f.stroke,"stroke")},transform:function(f){var v=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,_=this.calcTransformMatrix(!v);f.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(f){var v=n.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:n.version,originX:this.originX,originY:this.originY,left:o(this.left,v),top:o(this.top,v),width:o(this.width,v),height:o(this.height,v),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:o(this.strokeWidth,v),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:o(this.strokeMiterLimit,v),scaleX:o(this.scaleX,v),scaleY:o(this.scaleY,v),angle:o(this.angle,v),flipX:this.flipX,flipY:this.flipY,opacity:o(this.opacity,v),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:o(this.skewX,v),skewY:o(this.skewY,v)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(f),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),n.util.populateWithProperties(this,_,f),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var v=n.util.getKlass(f.type).prototype,_=v.stateProperties;return _.forEach(function(b){b==="left"||b==="top"||(f[b]===v[b]&&delete f[b],Array.isArray(f[b])&&Array.isArray(v[b])&&f[b].length===0&&v[b].length===0&&delete f[b])}),f},toString:function(){return"#<fabric."+c(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var f=n.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(f.scaleX),scaleY:Math.abs(f.scaleY)}},getTotalObjectScaling:function(){var f=this.getObjectScaling(),v=f.scaleX,_=f.scaleY;if(this.canvas){var b=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();v*=b*y,_*=b*y}return{scaleX:v,scaleY:_}},getObjectOpacity:function(){var f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f},_set:function(f,v){var _=f==="scaleX"||f==="scaleY",b=this[f]!==v,y=!1;return _&&(v=this._constrainScale(v)),f==="scaleX"&&v<0?(this.flipX=!this.flipX,v*=-1):f==="scaleY"&&v<0?(this.flipY=!this.flipY,v*=-1):f==="shadow"&&v&&!(v instanceof n.Shadow)?v=new n.Shadow(v):f==="dirty"&&this.group&&this.group.set("dirty",v),this[f]=v,b&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(f)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(f)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:n.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(f),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),f.restore())},renderCache:function(f){f=f||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,f.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(f,v){if(f.save(),v.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",v.absolutePositioned){var _=n.util.invertTransform(this.calcTransformMatrix());f.transform(_[0],_[1],_[2],_[3],_[4],_[5])}v.transform(f),f.scale(1/v.zoomX,1/v.zoomY),f.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),f.restore()},drawObject:function(f,v){var _=this.fill,b=this.stroke;v?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath),this.fill=_,this.stroke=b},_drawClipPath:function(f,v){v&&(v.canvas=this.canvas,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCache(f,v))},drawCacheOnCanvas:function(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(f){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!f&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!f){var v=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-v/2,-_/2,v,_)}return!0}return!1},_renderBackground:function(f){if(this.backgroundColor){var v=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-v.x/2,-v.y/2,v.x,v.y),this._removeShadow(f)}},_setOpacity:function(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity},_setStrokeStyles:function(f,v){var _=v.stroke;_&&(f.lineWidth=v.strokeWidth,f.lineCap=v.strokeLineCap,f.lineDashOffset=v.strokeDashOffset,f.lineJoin=v.strokeLineJoin,f.miterLimit=v.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(f,_):(f.strokeStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,_)):f.strokeStyle=v.stroke)},_setFillStyles:function(f,v){var _=v.fill;_&&(_.toLive?(f.fillStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,v.fill)):f.fillStyle=_)},_setClippingProperties:function(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"},_setLineDash:function(f,v){!v||v.length===0||(1&v.length&&v.push.apply(v,v),f.setLineDash(v))},_renderControls:function(f,v){var _=this.getViewportTransform(),b=this.calcTransformMatrix(),y,x,C;v=v||{},x=typeof v.hasBorders<"u"?v.hasBorders:this.hasBorders,C=typeof v.hasControls<"u"?v.hasControls:this.hasControls,b=n.util.multiplyTransformMatrices(_,b),y=n.util.qrDecompose(b),f.save(),f.translate(y.translateX,y.translateY),f.lineWidth=1*this.borderScaleFactor,this.group||(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),f.rotate(a(this.group?y.angle:this.angle)),v.forActiveSelection||this.group?x&&this.drawBordersInGroup(f,y,v):x&&this.drawBorders(f,v),C&&this.drawControls(f,v),f.restore()},_setShadow:function(f){if(this.shadow){var v=this.shadow,_=this.canvas,b,y=_&&_.viewportTransform[0]||1,x=_&&_.viewportTransform[3]||1;v.nonScaling?b={scaleX:1,scaleY:1}:b=this.getObjectScaling(),_&&_._isRetinaScaling()&&(y*=n.devicePixelRatio,x*=n.devicePixelRatio),f.shadowColor=v.color,f.shadowBlur=v.blur*n.browserShadowBlurConstant*(y+x)*(b.scaleX+b.scaleY)/4,f.shadowOffsetX=v.offsetX*y*b.scaleX,f.shadowOffsetY=v.offsetY*x*b.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_applyPatternGradientTransform:function(f,v){if(!v||!v.toLive)return{offsetX:0,offsetY:0};var _=v.gradientTransform||v.patternTransform,b=-this.width/2+v.offsetX||0,y=-this.height/2+v.offsetY||0;return v.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,b,y):f.transform(1,0,0,1,b,y),_&&f.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:b,offsetY:y}},_renderPaintInOrder:function(f){this.paintFirst==="stroke"?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))},_render:function(){},_renderFill:function(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform&&this.group){var v=this.getObjectScaling();f.scale(1/v.scaleX,1/v.scaleY)}else this.strokeUniform&&f.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}},_applyPatternForTransformedGradient:function(f,v){var _=this._limitCacheSize(this._getCacheCanvasDimensions()),b=n.util.createCanvasElement(),y,x=this.canvas.getRetinaScaling(),C=_.x/this.scaleX/x,S=_.y/this.scaleY/x;b.width=C,b.height=S,y=b.getContext("2d"),y.beginPath(),y.moveTo(0,0),y.lineTo(C,0),y.lineTo(C,S),y.lineTo(0,S),y.closePath(),y.translate(C/2,S/2),y.scale(_.zoomX/this.scaleX/x,_.zoomY/this.scaleY/x),this._applyPatternGradientTransform(y,v),y.fillStyle=v.toLive(f),y.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(x*this.scaleX/_.zoomX,x*this.scaleY/_.zoomY),f.strokeStyle=y.createPattern(b,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var f=n.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",f.scaleX),this.set("scaleY",f.scaleY),this.angle=f.angle,this.skewX=f.skewX,this.skewY=0}},_removeTransformMatrix:function(f){var v=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),v=n.util.transformPoint(v,this.transformMatrix)),this.transformMatrix=null,f&&(this.scaleX*=f.scaleX,this.scaleY*=f.scaleY,this.cropX=f.cropX,this.cropY=f.cropY,v.x+=f.offsetLeft,v.y+=f.offsetTop,this.width=f.width,this.height=f.height),this.setPositionByOrigin(v,"center","center")},clone:function(f,v){var _=this.toObject(v);this.constructor.fromObject?this.constructor.fromObject(_,f):n.Object._fromObject("Object",_,f)},cloneAsImage:function(f,v){var _=this.toCanvasElement(v);return f&&f(new n.Image(_)),this},toCanvasElement:function(f){f||(f={});var v=n.util,_=v.saveObjectTransform(this),b=this.group,y=this.shadow,x=Math.abs,C=(f.multiplier||1)*(f.enableRetinaScaling?n.devicePixelRatio:1);delete this.group,f.withoutTransform&&v.resetObjectTransform(this),f.withoutShadow&&(this.shadow=null);var S=n.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),F=this.shadow,R,z={x:0,y:0},X,J,q;F&&(X=F.blur,F.nonScaling?R={scaleX:1,scaleY:1}:R=this.getObjectScaling(),z.x=2*Math.round(x(F.offsetX)+X)*x(R.scaleX),z.y=2*Math.round(x(F.offsetY)+X)*x(R.scaleY)),J=O.width+z.x,q=O.height+z.y,S.width=Math.ceil(J),S.height=Math.ceil(q);var V=new n.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});f.format==="jpeg"&&(V.backgroundColor="#fff"),this.setPositionByOrigin(new n.Point(V.width/2,V.height/2),"center","center");var Q=this.canvas;V.add(this);var tt=V.toCanvasElement(C||1,f);return this.shadow=y,this.set("canvas",Q),b&&(this.group=b),this.set(_).setCoords(),V._objects=[],V.dispose(),V=null,tt},toDataURL:function(f){return f||(f={}),n.util.toDataURL(this.toCanvasElement(f),f.format||"png",f.quality||1)},isType:function(f){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===f},complexity:function(){return 1},toJSON:function(f){return this.toObject(f)},rotate:function(f){var v=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return v&&this._setOriginToCenter(),this.set("angle",f),v&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(f,v){v=v||this.canvas.getPointer(f);var _=new n.Point(v.x,v.y),b=this._getLeftTopCoords();return this.angle&&(_=n.util.rotatePoint(_,b,a(-this.angle))),{x:_.x-b.x,y:_.y-b.y}},_setupCompositeOperation:function(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){n.runningAnimations&&n.runningAnimations.cancelByTarget(this)}}),n.util.createAccessors&&n.util.createAccessors(n.Object),l(n.Object.prototype,n.Observable),n.Object.NUM_FRACTION_DIGITS=2,n.Object.ENLIVEN_PROPS=["clipPath"],n.Object._fromObject=function(f,v,_,b){var y=n[f];v=u(v,!0),n.util.enlivenPatterns([v.fill,v.stroke],function(x){typeof x[0]<"u"&&(v.fill=x[0]),typeof x[1]<"u"&&(v.stroke=x[1]),n.util.enlivenObjectEnlivables(v,v,function(){var C=b?new y(v[b],v):new y(v);_&&_(C)})})},n.Object.__uid=0)}(i),function(){var r=t.util.degreesToRadians,n={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(u,o,c,a,d){var p=u.x,f=u.y,v,_,b;return typeof o=="string"?o=n[o]:o-=.5,typeof a=="string"?a=n[a]:a-=.5,v=a-o,typeof c=="string"?c=l[c]:c-=.5,typeof d=="string"?d=l[d]:d-=.5,_=d-c,(v||_)&&(b=this._getTransformedDimensions(),p=u.x+v*b.x,f=u.y+_*b.y),new t.Point(p,f)},translateToCenterPoint:function(u,o,c){var a=this.translateToGivenOrigin(u,o,c,"center","center");return this.angle?t.util.rotatePoint(a,u,r(this.angle)):a},translateToOriginPoint:function(u,o,c){var a=this.translateToGivenOrigin(u,"center","center",o,c);return this.angle?t.util.rotatePoint(a,u,r(this.angle)):a},getCenterPoint:function(){var u=new t.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,o){var c=this.getCenterPoint();return this.translateToOriginPoint(c,u,o)},toLocalPoint:function(u,o,c){var a=this.getCenterPoint(),d,p;return typeof o<"u"&&typeof c<"u"?d=this.translateToGivenOrigin(a,"center","center",o,c):d=new t.Point(this.left,this.top),p=new t.Point(u.x,u.y),this.angle&&(p=t.util.rotatePoint(p,a,-r(this.angle))),p.subtractEquals(d)},setPositionByOrigin:function(u,o,c){var a=this.translateToCenterPoint(u,o,c),d=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",d.x),this.set("top",d.y)},adjustPosition:function(u){var o=r(this.angle),c=this.getScaledWidth(),a=t.util.cos(o)*c,d=t.util.sin(o)*c,p,f;typeof this.originX=="string"?p=n[this.originX]:p=this.originX-.5,typeof u=="string"?f=n[u]:f=u-.5,this.left+=a*(f-p),this.top+=d*(f-p),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function r(c){return[new t.Point(c.tl.x,c.tl.y),new t.Point(c.tr.x,c.tr.y),new t.Point(c.br.x,c.br.y),new t.Point(c.bl.x,c.bl.y)]}var n=t.util,l=n.degreesToRadians,u=n.multiplyTransformMatrices,o=n.transformPoint;n.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(c,a){return a?c?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),c?this.aCoords:this.lineCoords)},getCoords:function(c,a){return r(this._getCoords(c,a))},intersectsWithRect:function(c,a,d,p){var f=this.getCoords(d,p),v=t.Intersection.intersectPolygonRectangle(f,c,a);return v.status==="Intersection"},intersectsWithObject:function(c,a,d){var p=t.Intersection.intersectPolygonPolygon(this.getCoords(a,d),c.getCoords(a,d));return p.status==="Intersection"||c.isContainedWithinObject(this,a,d)||this.isContainedWithinObject(c,a,d)},isContainedWithinObject:function(c,a,d){for(var p=this.getCoords(a,d),f=a?c.aCoords:c.lineCoords,v=0,_=c._getImageLines(f);v<4;v++)if(!c.containsPoint(p[v],_))return!1;return!0},isContainedWithinRect:function(c,a,d,p){var f=this.getBoundingRect(d,p);return f.left>=c.x&&f.left+f.width<=a.x&&f.top>=c.y&&f.top+f.height<=a.y},containsPoint:function(c,v,d,p){var f=this._getCoords(d,p),v=v||this._getImageLines(f),_=this._findCrossPoints(c,v);return _!==0&&_%2===1},isOnScreen:function(c){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br,p=this.getCoords(!0,c);return p.some(function(f){return f.x<=d.x&&f.x>=a.x&&f.y<=d.y&&f.y>=a.y})||this.intersectsWithRect(a,d,!0,c)?!0:this._containsCenterOfCanvas(a,d,c)},_containsCenterOfCanvas:function(c,a,d){var p={x:(c.x+a.x)/2,y:(c.y+a.y)/2};return!!this.containsPoint(p,null,!0,d)},isPartiallyOnScreen:function(c){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br;if(this.intersectsWithRect(a,d,!0,c))return!0;var p=this.getCoords(!0,c).every(function(f){return(f.x>=d.x||f.x<=a.x)&&(f.y>=d.y||f.y<=a.y)});return p&&this._containsCenterOfCanvas(a,d,c)},_getImageLines:function(c){var a={topline:{o:c.tl,d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}};return a},_findCrossPoints:function(c,a){var d,p,f,v,_,b=0,y;for(var x in a)if(y=a[x],!(y.o.y<c.y&&y.d.y<c.y)&&!(y.o.y>=c.y&&y.d.y>=c.y)&&(y.o.x===y.d.x&&y.o.x>=c.x?_=y.o.x:(d=0,p=(y.d.y-y.o.y)/(y.d.x-y.o.x),f=c.y-d*c.x,v=y.o.y-p*y.o.x,_=-(f-v)/(d-p)),_>=c.x&&(b+=1),b===2))break;return b},getBoundingRect:function(c,a){var d=this.getCoords(c,a);return n.makeBoundingBoxFromPoints(d)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?c<0?-this.minScaleLimit:this.minScaleLimit:c===0?1e-4:c},scale:function(c){return this._set("scaleX",c),this._set("scaleY",c),this.setCoords()},scaleToWidth:function(c,a){var d=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(c/this.width/d)},scaleToHeight:function(c,a){var d=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(c/this.height/d)},calcLineCoords:function(){var c=this.getViewportTransform(),a=this.padding,d=l(this.angle),p=n.cos(d),f=n.sin(d),v=p*a,_=f*a,b=v+_,y=v-_,x=this.calcACoords(),C={tl:o(x.tl,c),tr:o(x.tr,c),bl:o(x.bl,c),br:o(x.br,c)};return a&&(C.tl.x-=y,C.tl.y-=b,C.tr.x+=b,C.tr.y-=y,C.bl.x-=b,C.bl.y+=y,C.br.x+=y,C.br.y+=b),C},calcOCoords:function(){var c=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),d=this.getViewportTransform(),p=u(d,a),f=u(p,c),f=u(f,[1/d[0],0,0,1/d[3],0,0]),v=this._calculateCurrentDimensions(),_={};return this.forEachControl(function(b,y,x){_[y]=b.positionHandler(v,f,x)}),_},calcACoords:function(){var c=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),d=u(a,c),p=this._getTransformedDimensions(),f=p.x/2,v=p.y/2;return{tl:o({x:-f,y:-v},d),tr:o({x:f,y:-v},d),bl:o({x:-f,y:v},d),br:o({x:f,y:v},d)}},setCoords:function(c){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),c?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return n.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var c=this.getCenterPoint();return[1,0,0,1,c.x,c.y]},transformMatrixKey:function(c){var a="_",d="";return!c&&this.group&&(d=this.group.transformMatrixKey(c)+a),d+this.top+a+this.left+a+this.scaleX+a+this.scaleY+a+this.skewX+a+this.skewY+a+this.angle+a+this.originX+a+this.originY+a+this.width+a+this.height+a+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(c){var a=this.calcOwnMatrix();if(c||!this.group)return a;var d=this.transformMatrixKey(c),p=this.matrixCache||(this.matrixCache={});return p.key===d?p.value:(this.group&&(a=u(this.group.calcTransformMatrix(!1),a)),p.key=d,p.value=a,a)},calcOwnMatrix:function(){var c=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===c)return a.value;var d=this._calcTranslateMatrix(),p={angle:this.angle,translateX:d[4],translateY:d[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return a.key=c,a.value=n.composeMatrix(p),a.value},_getNonTransformedDimensions:function(){var c=this.strokeWidth,a=this.width+c,d=this.height+c;return{x:a,y:d}},_getTransformedDimensions:function(c,a){typeof c>"u"&&(c=this.skewX),typeof a>"u"&&(a=this.skewY);var d,p,f,v=c===0&&a===0;if(this.strokeUniform?(p=this.width,f=this.height):(d=this._getNonTransformedDimensions(),p=d.x,f=d.y),v)return this._finalizeDimensions(p*this.scaleX,f*this.scaleY);var _=n.sizeAfterTransform(p,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:c,skewY:a});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(c,a){return this.strokeUniform?{x:c+this.strokeWidth,y:a+this.strokeWidth}:{x:c,y:a}},_calculateCurrentDimensions:function(){var c=this.getViewportTransform(),a=this._getTransformedDimensions(),d=o(a,c,!0);return d.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(r){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,r):this.canvas&&this.canvas.sendBackwards(this,r),this},bringForward:function(r){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,r):this.canvas&&this.canvas.bringForward(this,r),this},moveTo:function(r){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,r):this.canvas&&this.canvas.moveTo(this,r),this}}),function(){function r(l,u){if(u){if(u.toLive)return l+": url(#SVGID_"+u.id+"); ";var o=new t.Color(u),c=l+": "+o.toRgb()+"; ",a=o.getAlpha();return a!==1&&(c+=l+"-opacity: "+a.toString()+"; "),c}else return l+": none; "}var n=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var u=this.fillRule?this.fillRule:"nonzero",o=this.strokeWidth?this.strokeWidth:"0",c=this.strokeDashArray?this.strokeDashArray.join(" "):"none",a=this.strokeDashOffset?this.strokeDashOffset:"0",d=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=typeof this.opacity<"u"?this.opacity:"1",_=this.visible?"":" visibility: hidden;",b=l?"":this.getSvgFilter(),y=r("fill",this.fill),x=r("stroke",this.stroke);return[x,"stroke-width: ",o,"; ","stroke-dasharray: ",c,"; ","stroke-linecap: ",d,"; ","stroke-dashoffset: ",a,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",f,"; ",y,"fill-rule: ",u,"; ","opacity: ",v,";",b,_].join("")},getSvgSpanStyles:function(l,u){var o="; ",a=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+o:"",c=l.strokeWidth?"stroke-width: "+l.strokeWidth+o:"",a=a,d=l.fontSize?"font-size: "+l.fontSize+"px"+o:"",p=l.fontStyle?"font-style: "+l.fontStyle+o:"",f=l.fontWeight?"font-weight: "+l.fontWeight+o:"",v=l.fill?r("fill",l.fill):"",_=l.stroke?r("stroke",l.stroke):"",b=this.getSvgTextDecoration(l),y=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return b&&(b="text-decoration: "+b+o),[_,c,a,d,p,f,b,v,y,u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(u){return l[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,u){var o=l?this.calcTransformMatrix():this.calcOwnMatrix(),c='transform="'+t.util.matrixToSVG(o);return c+(u||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var u=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,u),'" y="',n(-this.height/2,u),'" width="',n(this.width,u),'" height="',n(this.height,u),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,u){u=u||{};var o=u.reviver,c=u.additionalTransform||"",a=[this.getSvgTransform(!0,c),this.getSvgCommons()].join(""),d=l.indexOf("COMMON_PARTS");return l[d]=a,o?o(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,u){u=u||{};var o=u.noStyle,c=u.reviver,a=o?"":'style="'+this.getSvgStyles()+'" ',d=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",p=this.clipPath,f=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",v=p&&p.absolutePositioned,_=this.stroke,b=this.fill,y=this.shadow,x,C=[],S,O=l.indexOf("COMMON_PARTS"),F=u.additionalTransform;return p&&(p.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+p.clipPathId+`" >
`+p.toClipPathSVG(c)+`</clipPath>
`),v&&C.push("<g ",d,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),v?"":d+this.getSvgCommons(),` >
`),x=[a,f,o?"":this.addPaintOrder()," ",F?'transform="'+F+'" ':""].join(""),l[O]=x,b&&b.toLive&&C.push(b.toSVG(this)),_&&_.toLive&&C.push(_.toSVG(this)),y&&C.push(y.toSVG(this)),p&&C.push(S),C.push(l.join("")),C.push(`</g>
`),v&&C.push(`</g>
`),c?c(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var r=t.util.object.extend,n="stateProperties";function l(o,c,a){var d={},p=!0;a.forEach(function(f){d[f]=o[f]}),r(o[c],d,p)}function u(o,c,a){if(o===c)return!0;if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(var d=0,p=o.length;d<p;d++)if(!u(o[d],c[d]))return!1;return!0}else if(o&&typeof o=="object"){var f=Object.keys(o),v;if(!c||typeof c!="object"||!a&&f.length!==Object.keys(c).length)return!1;for(var d=0,p=f.length;d<p;d++)if(v=f[d],!(v==="canvas"||v==="group")&&!u(o[v],c[v]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(o){o=o||n;var c="_"+o;return Object.keys(this[c]).length<this[o].length?!0:!u(this[c],this,!0)},saveState:function(o){var c=o&&o.propertySet||n,a="_"+c;return this[a]?(l(this,a,this[c]),o&&o.stateProperties&&l(this,a,o.stateProperties),this):this.setupState(o)},setupState:function(o){o=o||{};var c=o.propertySet||n;return o.propertySet=c,this["_"+c]={},this.saveState(o),this}})}(),function(){var r=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(n,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u=n.x,o=n.y,c,a,d=Object.keys(this.oCoords),p=d.length-1,f;for(this.__corner=0;p>=0;p--)if(f=d[p],!!this.isControlVisible(f)&&(a=this._getImageLines(l?this.oCoords[f].touchCorner:this.oCoords[f].corner),c=this._findCrossPoints({x:u,y:o},a),c!==0&&c%2===1))return this.__corner=f,f;return!1},forEachControl:function(n){for(var l in this.controls)n(this.controls[l],l,this)},_setCornerCoords:function(){var n=this.oCoords;for(var l in n){var u=this.controls[l];n[l].corner=u.calcCornerCoords(this.angle,this.cornerSize,n[l].x,n[l].y,!1),n[l].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,n[l].x,n[l].y,!0)}},drawSelectionBackground:function(n){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;n.save();var l=this.getCenterPoint(),u=this._calculateCurrentDimensions(),o=this.canvas.viewportTransform;return n.translate(l.x,l.y),n.scale(1/o[0],1/o[3]),n.rotate(r(this.angle)),n.fillStyle=this.selectionBackgroundColor,n.fillRect(-u.x/2,-u.y/2,u.x,u.y),n.restore(),this},drawBorders:function(n,l){l=l||{};var u=this._calculateCurrentDimensions(),o=this.borderScaleFactor,c=u.x+o,a=u.y+o,d=typeof l.hasControls<"u"?l.hasControls:this.hasControls,p=!1;return n.save(),n.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(n,l.borderDashArray||this.borderDashArray),n.strokeRect(-c/2,-a/2,c,a),d&&(n.beginPath(),this.forEachControl(function(f,v,_){f.withConnection&&f.getVisibility(_,v)&&(p=!0,n.moveTo(f.x*c,f.y*a),n.lineTo(f.x*c+f.offsetX,f.y*a+f.offsetY))}),p&&n.stroke()),n.restore(),this},drawBordersInGroup:function(n,l,u){u=u||{};var o=t.util.sizeAfterTransform(this.width,this.height,l),c=this.strokeWidth,a=this.strokeUniform,d=this.borderScaleFactor,p=o.x+c*(a?this.canvas.getZoom():l.scaleX)+d,f=o.y+c*(a?this.canvas.getZoom():l.scaleY)+d;return n.save(),this._setLineDash(n,u.borderDashArray||this.borderDashArray),n.strokeStyle=u.borderColor||this.borderColor,n.strokeRect(-p/2,-f/2,p,f),n.restore(),this},drawControls:function(n,l){l=l||{},n.save();var u=this.canvas.getRetinaScaling(),o,c;return n.setTransform(u,0,0,u,0,0),n.strokeStyle=n.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(n.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(n,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(o=this.group.calcTransformMatrix()),this.forEachControl(function(a,d,p){c=p.oCoords[d],a.getVisibility(p,d)&&(o&&(c=t.util.transformPoint(c,o)),a.render(n,c.x,c.y,l,p))}),n.restore(),this},isControlVisible:function(n){return this.controls[n]&&this.controls[n].getVisibility(this,n)},setControlVisible:function(n,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[n]=l,this},setControlsVisibility:function(n){n||(n={});for(var l in n)this.setControlVisible(l,n[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(r,n){n=n||{};var l=function(){},u=n.onComplete||l,o=n.onChange||l,c=this;return t.util.animate({target:this,startValue:r.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(a){r.set("left",a),c.requestRenderAll(),o()},onComplete:function(){r.setCoords(),u()}})},fxCenterObjectV:function(r,n){n=n||{};var l=function(){},u=n.onComplete||l,o=n.onChange||l,c=this;return t.util.animate({target:this,startValue:r.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(a){r.set("top",a),c.requestRenderAll(),o()},onComplete:function(){r.setCoords(),u()}})},fxRemove:function(r,n){n=n||{};var l=function(){},u=n.onComplete||l,o=n.onChange||l,c=this;return t.util.animate({target:this,startValue:r.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(a){r.set("opacity",a),c.requestRenderAll(),o()},onComplete:function(){c.remove(r),u()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var r=[],n,l,u=[];for(n in arguments[0])r.push(n);for(var o=0,c=r.length;o<c;o++)n=r[o],l=o!==c-1,u.push(this._animate(n,arguments[0][n],arguments[1],l));return u}else return this._animate.apply(this,arguments)},_animate:function(r,n,l,u){var o=this,c;n=n.toString(),l?l=t.util.object.clone(l):l={},~r.indexOf(".")&&(c=r.split("."));var a=o.colorProperties.indexOf(r)>-1||c&&o.colorProperties.indexOf(c[1])>-1,d=c?this.get(c[0])[c[1]]:this.get(r);"from"in l||(l.from=d),a||(~n.indexOf("=")?n=d+parseFloat(n.replace("=","")):n=parseFloat(n));var p={target:this,startValue:l.from,endValue:n,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(f,v,_){return l.abort.call(o,f,v,_)},onChange:function(f,v,_){c?o[c[0]][c[1]]=f:o.set(r,f),!u&&l.onChange&&l.onChange(f,v,_)},onComplete:function(f,v,_){u||(o.setCoords(),l.onComplete&&l.onComplete(f,v,_))}};return a?t.util.animateColor(p.startValue,p.endValue,p.duration,p):t.util.animate(p)}}),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.util.object.clone,o={x1:1,x2:1,y1:1,y2:1};if(n.Line){n.warn("fabric.Line is already defined");return}n.Line=n.util.createClass(n.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:n.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,d){a||(a=[0,0,0,0]),this.callSuper("initialize",d),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(d)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,d){return this.callSuper("_set",a,d),typeof o[a]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){a.beginPath();var d=this.calcLinePoints();a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2),a.lineWidth=this.strokeWidth;var p=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=p},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(a){return l(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(a.y-=this.strokeWidth),this.height===0&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,p=a*this.width*.5,f=d*this.height*.5,v=a*this.width*-.5,_=d*this.height*-.5;return{x1:p,x2:v,y1:f,y2:_}},_toSVG:function(){var a=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`" />
`]}}),n.Line.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),n.Line.fromElement=function(a,d,p){p=p||{};var f=n.parseAttributes(a,n.Line.ATTRIBUTE_NAMES),v=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];d(new n.Line(v,l(f,p)))},n.Line.fromObject=function(a,d){function p(v){delete v.points,d&&d(v)}var f=u(a,!0);f.points=[a.x1,a.y1,a.x2,a.y2],n.Object._fromObject("Line",f,p,"points")};function c(a,d){var p=a.origin,f=a.axis1,v=a.axis2,_=a.dimension,b=d.nearest,y=d.center,x=d.farthest;return function(){switch(this.get(p)){case b:return Math.min(this.get(f),this.get(v));case y:return Math.min(this.get(f),this.get(v))+.5*this.get(_);case x:return Math.max(this.get(f),this.get(v))}}}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.degreesToRadians;if(n.Circle){n.warn("fabric.Circle is already defined.");return}n.Circle=n.util.createClass(n.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:n.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(o,c){return this.callSuper("_set",o,c),o==="radius"&&this.setRadius(c),this},toObject:function(o){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(o))},_toSVG:function(){var o,c=0,a=0,d=(this.endAngle-this.startAngle)%360;if(d===0)o=["<circle ","COMMON_PARTS",'cx="'+c+'" cy="'+a+'" ','r="',this.radius,`" />
`];else{var p=l(this.startAngle),f=l(this.endAngle),v=this.radius,_=n.util.cos(p)*v,b=n.util.sin(p)*v,y=n.util.cos(f)*v,x=n.util.sin(f)*v,C=d>180?"1":"0";o=['<path d="M '+_+" "+b," A "+v+" "+v," 0 ",+C+" 1"," "+y+" "+x,'" ',"COMMON_PARTS",` />
`]}return o},_render:function(o){o.beginPath(),o.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(o)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(o){return this.radius=o,this.set("width",o*2).set("height",o*2)}}),n.Circle.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),n.Circle.fromElement=function(o,c){var a=n.parseAttributes(o,n.Circle.ATTRIBUTE_NAMES);if(!u(a))throw new Error("value of `r` attribute is required and can not be negative");a.left=(a.left||0)-a.radius,a.top=(a.top||0)-a.radius,c(new n.Circle(a))};function u(o){return"radius"in o&&o.radius>=0}n.Circle.fromObject=function(o,c){n.Object._fromObject("Circle",o,c)}}(i),function(r){var n=r.fabric||(r.fabric={});if(n.Triangle){n.warn("fabric.Triangle is already defined");return}n.Triangle=n.util.createClass(n.Object,{type:"triangle",width:100,height:100,_render:function(l){var u=this.width/2,o=this.height/2;l.beginPath(),l.moveTo(-u,o),l.lineTo(0,-o),l.lineTo(u,o),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,u=this.height/2,o=[-l+" "+u,"0 "+-u,l+" "+u].join(",");return["<polygon ","COMMON_PARTS",'points="',o,'" />']}}),n.Triangle.fromObject=function(l,u){return n.Object._fromObject("Triangle",l,u)}}(i),function(r){var n=r.fabric||(r.fabric={}),l=Math.PI*2;if(n.Ellipse){n.warn("fabric.Ellipse is already defined.");return}n.Ellipse=n.util.createClass(n.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,o){switch(this.callSuper("_set",u,o),u){case"rx":this.rx=o,this.set("width",o*2);break;case"ry":this.ry=o,this.set("height",o*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,l,!1),u.restore(),this._renderPaintInOrder(u)}}),n.Ellipse.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),n.Ellipse.fromElement=function(u,o){var c=n.parseAttributes(u,n.Ellipse.ATTRIBUTE_NAMES);c.left=(c.left||0)-c.rx,c.top=(c.top||0)-c.ry,o(new n.Ellipse(c))},n.Ellipse.fromObject=function(u,o){n.Object._fromObject("Ellipse",u,o)}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend;if(n.Rect){n.warn("fabric.Rect is already defined");return}n.Rect=n.util.createClass(n.Object,{stateProperties:n.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var o=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,a=this.width,d=this.height,p=-this.width/2,f=-this.height/2,v=o!==0||c!==0,_=1-.5522847498;u.beginPath(),u.moveTo(p+o,f),u.lineTo(p+a-o,f),v&&u.bezierCurveTo(p+a-_*o,f,p+a,f+_*c,p+a,f+c),u.lineTo(p+a,f+d-c),v&&u.bezierCurveTo(p+a,f+d-_*c,p+a-_*o,f+d,p+a-o,f+d),u.lineTo(p+o,f+d),v&&u.bezierCurveTo(p+_*o,f+d,p,f+d-_*c,p,f+d-c),u.lineTo(p,f+c),v&&u.bezierCurveTo(p,f+_*c,p+_*o,f,p+o,f),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){var u=-this.width/2,o=-this.height/2;return["<rect ","COMMON_PARTS",'x="',u,'" y="',o,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),n.Rect.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),n.Rect.fromElement=function(u,o,c){if(!u)return o(null);c=c||{};var a=n.parseAttributes(u,n.Rect.ATTRIBUTE_NAMES);a.left=a.left||0,a.top=a.top||0,a.height=a.height||0,a.width=a.width||0;var d=new n.Rect(l(c?n.util.object.clone(c):{},a));d.visible=d.visible&&d.width>0&&d.height>0,o(d)},n.Rect.fromObject=function(u,o){return n.Object._fromObject("Rect",u,o)}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.util.array.min,o=n.util.array.max,c=n.util.toFixed,a=n.util.projectStrokeOnPoints;if(n.Polyline){n.warn("fabric.Polyline is already defined");return}n.Polyline=n.util.createClass(n.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:n.Object.prototype.cacheProperties.concat("points"),initialize:function(d,p){p=p||{},this.points=d||[],this.callSuper("initialize",p),this._setPositionDimensions(p)},_projectStrokeOnPoints:function(){return a(this.points,this,!0)},_setPositionDimensions:function(d){var p=this._calcDimensions(d),f,v=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-v,this.height=p.height-v,d.fromSVG||(f=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+v/2,y:p.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),typeof d.left>"u"&&(this.left=d.fromSVG?p.left:f.x),typeof d.top>"u"&&(this.top=d.fromSVG?p.top:f.y),this.pathOffset={x:p.left+this.width/2+v/2,y:p.top+this.height/2+v/2}},_calcDimensions:function(){var d=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,p=u(d,"x")||0,f=u(d,"y")||0,v=o(d,"x")||0,_=o(d,"y")||0,b=v-p,y=_-f;return{left:p,top:f,width:b,height:y}},toObject:function(d){return l(this.callSuper("toObject",d),{points:this.points.concat()})},_toSVG:function(){for(var d=[],p=this.pathOffset.x,f=this.pathOffset.y,v=n.Object.NUM_FRACTION_DIGITS,_=0,b=this.points.length;_<b;_++)d.push(c(this.points[_].x-p,v),",",c(this.points[_].y-f,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',d.join(""),`" />
`]},commonRender:function(d){var p,f=this.points.length,v=this.pathOffset.x,_=this.pathOffset.y;if(!f||isNaN(this.points[f-1].y))return!1;d.beginPath(),d.moveTo(this.points[0].x-v,this.points[0].y-_);for(var b=0;b<f;b++)p=this.points[b],d.lineTo(p.x-v,p.y-_);return!0},_render:function(d){this.commonRender(d)&&this._renderPaintInOrder(d)},complexity:function(){return this.get("points").length}}),n.Polyline.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polyline.fromElementGenerator=function(d){return function(p,f,v){if(!p)return f(null);v||(v={});var _=n.parsePointsAttribute(p.getAttribute("points")),b=n.parseAttributes(p,n[d].ATTRIBUTE_NAMES);b.fromSVG=!0,f(new n[d](_,l(b,v)))}},n.Polyline.fromElement=n.Polyline.fromElementGenerator("Polyline"),n.Polyline.fromObject=function(d,p){return n.Object._fromObject("Polyline",d,p,"points")}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.projectStrokeOnPoints;if(n.Polygon){n.warn("fabric.Polygon is already defined");return}n.Polygon=n.util.createClass(n.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),n.Polygon.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polygon.fromElement=n.Polyline.fromElementGenerator("Polygon"),n.Polygon.fromObject=function(u,o){n.Object._fromObject("Polygon",u,o,"points")}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.array.min,u=n.util.array.max,o=n.util.object.extend,c=n.util.object.clone,a=n.util.toFixed;if(n.Path){n.warn("fabric.Path is already defined");return}n.Path=n.util.createClass(n.Object,{type:"path",path:null,cacheProperties:n.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:n.Object.prototype.stateProperties.concat("path"),initialize:function(d,p){p=c(p||{}),delete p.path,this.callSuper("initialize",p),this._setPath(d||[],p)},_setPath:function(d,p){this.path=n.util.makePathSimpler(Array.isArray(d)?d:n.util.parsePath(d)),n.Polyline.prototype._setPositionDimensions.call(this,p||{})},_renderPathCommands:function(d){var p,f=0,v=0,_=0,b=0,y=0,x=0,C=-this.pathOffset.x,S=-this.pathOffset.y;d.beginPath();for(var O=0,F=this.path.length;O<F;++O)switch(p=this.path[O],p[0]){case"L":_=p[1],b=p[2],d.lineTo(_+C,b+S);break;case"M":_=p[1],b=p[2],f=_,v=b,d.moveTo(_+C,b+S);break;case"C":_=p[5],b=p[6],y=p[3],x=p[4],d.bezierCurveTo(p[1]+C,p[2]+S,y+C,x+S,_+C,b+S);break;case"Q":d.quadraticCurveTo(p[1]+C,p[2]+S,p[3]+C,p[4]+S),_=p[3],b=p[4],y=p[1],x=p[2];break;case"z":case"Z":_=f,b=v,d.closePath();break}},_render:function(d){this._renderPathCommands(d),this._renderPaintInOrder(d)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(d){return o(this.callSuper("toObject",d),{path:this.path.map(function(p){return p.slice()})})},toDatalessObject:function(d){var p=this.toObject(["sourcePath"].concat(d));return p.sourcePath&&delete p.path,p},_toSVG:function(){var d=n.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',d,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var d=n.Object.NUM_FRACTION_DIGITS;return" translate("+a(-this.pathOffset.x,d)+", "+a(-this.pathOffset.y,d)+")"},toClipPathSVG:function(d){var p=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},toSVG:function(d){var p=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var d=[],p=[],f,v=0,_=0,b=0,y=0,x,C=0,S=this.path.length;C<S;++C){switch(f=this.path[C],f[0]){case"L":b=f[1],y=f[2],x=[];break;case"M":b=f[1],y=f[2],v=b,_=y,x=[];break;case"C":x=n.util.getBoundsOfCurve(b,y,f[1],f[2],f[3],f[4],f[5],f[6]),b=f[5],y=f[6];break;case"Q":x=n.util.getBoundsOfCurve(b,y,f[1],f[2],f[1],f[2],f[3],f[4]),b=f[3],y=f[4];break;case"z":case"Z":b=v,y=_;break}x.forEach(function(q){d.push(q.x),p.push(q.y)}),d.push(b),p.push(y)}var O=l(d)||0,F=l(p)||0,R=u(d)||0,z=u(p)||0,X=R-O,J=z-F;return{left:O,top:F,width:X,height:J}}}),n.Path.fromObject=function(d,p){if(typeof d.sourcePath=="string"){var f=d.sourcePath;n.loadSVGFromURL(f,function(v){var _=v[0];_.setOptions(d),d.clipPath?n.util.enlivenObjects([d.clipPath],function(b){_.clipPath=b[0],p&&p(_)}):p&&p(_)})}else n.Object._fromObject("Path",d,p,"path")},n.Path.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(["d"]),n.Path.fromElement=function(d,p,f){var v=n.parseAttributes(d,n.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,p(new n.Path(v.d,o(v,f)))}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.array.min,u=n.util.array.max;n.Group||(n.Group=n.util.createClass(n.Object,n.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(o,c,a){c=c||{},this._objects=[],a&&this.callSuper("initialize",c),this._objects=o||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(a)this._updateObjectsACoords();else{var p=c&&c.centerPoint;c.originX!==void 0&&(this.originX=c.originX),c.originY!==void 0&&(this.originY=c.originY),p||this._calcBounds(),this._updateObjectsCoords(p),delete c.centerPoint,this.callSuper("initialize",c)}this.setCoords()},_updateObjectsACoords:function(){for(var o=!0,c=this._objects.length;c--;)this._objects[c].setCoords(o)},_updateObjectsCoords:function(c){for(var c=c||this.getCenterPoint(),a=this._objects.length;a--;)this._updateObjectCoords(this._objects[a],c)},_updateObjectCoords:function(o,c){var a=o.left,d=o.top,p=!0;o.set({left:a-c.x,top:d-c.y}),o.group=this,o.setCoords(p)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(o){var c=!!this.group;return this._restoreObjectsState(),n.util.resetObjectTransform(this),o&&(c&&n.util.removeTransformFromObject(o,this.group.calcTransformMatrix()),this._objects.push(o),o.group=this,o._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,c?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(o){return this._restoreObjectsState(),n.util.resetObjectTransform(this),this.remove(o),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(o){this.dirty=!0,o.group=this,o._set("canvas",this.canvas)},_onObjectRemoved:function(o){this.dirty=!0,delete o.group},_set:function(o,c){var a=this._objects.length;if(this.useSetOnGroup)for(;a--;)this._objects[a].setOnGroup(o,c);if(o==="canvas")for(;a--;)this._objects[a]._set(o,c);n.Object.prototype._set.call(this,o,c)},toObject:function(o){var c=this.includeDefaultValues,a=this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){var f=p.includeDefaultValues;p.includeDefaultValues=c;var v=p.toObject(o);return p.includeDefaultValues=f,v}),d=n.Object.prototype.toObject.call(this,o);return d.objects=a,d},toDatalessObject:function(o){var c,a=this.sourcePath;if(a)c=a;else{var d=this.includeDefaultValues;c=this._objects.map(function(f){var v=f.includeDefaultValues;f.includeDefaultValues=d;var _=f.toDatalessObject(o);return f.includeDefaultValues=v,_})}var p=n.Object.prototype.toDatalessObject.call(this,o);return p.objects=c,p},render:function(o){this._transformDone=!0,this.callSuper("render",o),this._transformDone=!1},shouldCache:function(){var o=n.Object.prototype.shouldCache.call(this);if(o){for(var c=0,a=this._objects.length;c<a;c++)if(this._objects[c].willDrawShadow())return this.ownCaching=!1,!1}return o},willDrawShadow:function(){if(n.Object.prototype.willDrawShadow.call(this))return!0;for(var o=0,c=this._objects.length;o<c;o++)if(this._objects[o].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(o){for(var c=0,a=this._objects.length;c<a;c++)this._objects[c].render(o);this._drawClipPath(o,this.clipPath)},isCacheDirty:function(o){if(this.callSuper("isCacheDirty",o))return!0;if(!this.statefullCache)return!1;for(var c=0,a=this._objects.length;c<a;c++)if(this._objects[c].isCacheDirty(!0)){if(this._cacheCanvas){var d=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-p/2,d,p)}return!0}return!1},_restoreObjectsState:function(){var o=this.calcOwnMatrix();return this._objects.forEach(function(c){n.util.addTransformToObject(c,o),delete c.group,c.setCoords()}),this},destroy:function(){return this._objects.forEach(function(o){o.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(o){o.dispose&&o.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var o=this._objects,c=this.canvas;this._objects=[];var a=this.toObject();delete a.objects;var d=new n.ActiveSelection([]);return d.set(a),d.type="activeSelection",c.remove(this),o.forEach(function(p){p.group=d,p.dirty=!0,c.add(p)}),d.canvas=c,d._objects=o,c._activeObject=d,d.setCoords(),d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var o=!0;return this.forEachObject(function(c){c.setCoords(o)}),this},_calcBounds:function(o){for(var c=[],a=[],d,p,f,v=["tr","br","bl","tl"],_=0,b=this._objects.length,y,x=v.length;_<b;++_){for(d=this._objects[_],f=d.calcACoords(),y=0;y<x;y++)p=v[y],c.push(f[p].x),a.push(f[p].y);d.aCoords=f}this._getBounds(c,a,o)},_getBounds:function(o,c,a){var d=new n.Point(l(o),l(c)),p=new n.Point(u(o),u(c)),f=d.y||0,v=d.x||0,_=p.x-d.x||0,b=p.y-d.y||0;this.width=_,this.height=b,a||this.setPositionByOrigin({x:v,y:f},"left","top")},_toSVG:function(o){for(var c=["<g ","COMMON_PARTS",` >
`],a=0,d=this._objects.length;a<d;a++)c.push("		",this._objects[a].toSVG(o));return c.push(`</g>
`),c},getSvgStyles:function(){var o=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",c=this.visible?"":" visibility: hidden;";return[o,this.getSvgFilter(),c].join("")},toClipPathSVG:function(o){for(var c=[],a=0,d=this._objects.length;a<d;a++)c.push("	",this._objects[a].toClipPathSVG(o));return this._createBaseClipPathSVGMarkup(c,{reviver:o})}}),n.Group.fromObject=function(o,c){var a=o.objects,d=n.util.object.clone(o,!0);if(delete d.objects,typeof a=="string"){n.loadSVGFromURL(a,function(p){var f=n.util.groupSVGElements(p,o,a),v=d.clipPath;delete d.clipPath,f.set(d),v?n.util.enlivenObjects([v],function(_){f.clipPath=_[0],c&&c(f)}):c&&c(f)});return}n.util.enlivenObjects(a,function(p){n.util.enlivenObjectEnlivables(o,d,function(){c&&c(new n.Group(p,d,!0))})})})}(i),function(r){var n=r.fabric||(r.fabric={});n.ActiveSelection||(n.ActiveSelection=n.util.createClass(n.Group,{type:"activeSelection",initialize:function(l,u){u=u||{},this._objects=l||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),n.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var u=n.Object.prototype.toObject.call(this),o=new n.Group([]);if(delete u.type,o.set(u),l.forEach(function(a){a.canvas.remove(a),a.group=o}),o._objects=l,!this.canvas)return o;var c=this.canvas;return c.add(o),c._activeObject=o,o.setCoords(),o},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,u,o){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,u),o=o||{},typeof o.hasControls>"u"&&(o.hasControls=!1),o.forActiveSelection=!0;for(var c=0,a=this._objects.length;c<a;c++)this._objects[c]._renderControls(l,o);l.restore()}}),n.ActiveSelection.fromObject=function(l,u){n.util.enlivenObjects(l.objects,function(o){delete l.objects,u&&u(new n.ActiveSelection(o,l,!0))})})}(i),function(r){var n=t.util.object.extend;if(r.fabric||(r.fabric={}),r.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,u){u||(u={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",u),this._initElement(l,u)},getElement:function(){return this._element||{}},setElement:function(l,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var u=t.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var u=this.width/2,o=this.height/2;l.beginPath(),l.moveTo(-u,-o),l.lineTo(u,-o),l.lineTo(u,o),l.lineTo(-u,o),l.lineTo(-u,-o),l.closePath()}},toObject:function(l){var u=[];this.filters.forEach(function(c){c&&u.push(c.toObject())});var o=n(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(o.resizeFilter=this.resizeFilter.toObject()),o},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],u=[],o,c=this._element,a=-this.width/2,d=-this.height/2,p="",f="";if(!c)return[];if(this.hasCrop()){var v=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+a+'" y="'+d+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),p=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(f='" image-rendering="optimizeSpeed'),u.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',a-this.cropX,'" y="',d-this.cropY,'" width="',c.width||c.naturalWidth,'" height="',c.height||c.height,f,'"',p,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,o=["	<rect ",'x="',a,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?l=l.concat(o,u):l=l.concat(u,o),l},getSrc:function(l){var u=l?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(l,u,o){return t.util.loadImage(l,function(c,a){this.setElement(c,o),this._setWidthHeight(),u&&u(this,a)},this,o&&o.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,u=this.minimumScaleTrigger,o=this.getTotalObjectScaling(),c=o.scaleX,a=o.scaleY,d=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||c>u&&a>u){this._element=d,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=c,this._lastScaleY=a;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var p=t.util.createCanvasElement(),f=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=d.width,_=d.height;p.width=v,p.height=_,this._element=p,this._lastScaleX=l.scaleX=c,this._lastScaleY=l.scaleY=a,t.filterBackend.applyFilters([l],d,v,_,this._element,f),this._filterScalingX=p.width/this._originalElement.width,this._filterScalingY=p.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(d){return d&&!d.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,o=u.naturalWidth||u.width,c=u.naturalHeight||u.height;if(this._element===this._originalElement){var a=t.util.createCanvasElement();a.width=o,a.height=c,this._element=a,this._filteredEl=a}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,o,c),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,o,c,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var u=this._element;if(u){var o=this._filterScalingX,c=this._filterScalingY,a=this.width,d=this.height,p=Math.min,f=Math.max,v=f(this.cropX,0),_=f(this.cropY,0),b=u.naturalWidth||u.width,y=u.naturalHeight||u.height,x=v*o,C=_*c,S=p(a*o,b-x),O=p(d*c,y-C),F=-a/2,R=-d/2,z=p(a,b/o-v),X=p(d,y/c-_);u&&l.drawImage(u,x,C,S,O,F,R,z,X)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,u){this.setElement(t.util.getById(l),u),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,u){l&&l.length?t.util.enlivenObjects(l,function(o){u&&u(o)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(l){l||(l={});var u=this.getElement();this.width=l.width||u.naturalWidth||u.width||0,this.height=l.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),u=this._element.width,o=this._element.height,c=1,a=1,d=0,p=0,f=0,v=0,_,b=this.width,y=this.height,x={width:b,height:y};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(c=a=t.util.findScaleToFit(this._element,x),_=(b-u*c)/2,l.alignX==="Min"&&(d=-_),l.alignX==="Max"&&(d=_),_=(y-o*a)/2,l.alignY==="Min"&&(p=-_),l.alignY==="Max"&&(p=_)),l.meetOrSlice==="slice"&&(c=a=t.util.findScaleToCover(this._element,x),_=u-b/c,l.alignX==="Mid"&&(f=_/2),l.alignX==="Max"&&(f=_),_=o-y/a,l.alignY==="Mid"&&(v=_/2),l.alignY==="Max"&&(v=_),u=b/c,o=y/a)):(c=b/u,a=y/o),{width:u,height:o,scaleX:c,scaleY:a,offsetLeft:d,offsetTop:p,cropX:f,cropY:v}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,u){var o=t.util.object.clone(l);t.util.loadImage(o.src,function(c,a){if(a){u&&u(null,!0);return}t.Image.prototype._initFilters.call(o,o.filters,function(d){o.filters=d||[],t.Image.prototype._initFilters.call(o,[o.resizeFilter],function(p){o.resizeFilter=p[0],t.util.enlivenObjectEnlivables(o,o,function(){var f=new t.Image(c,o);u(f,!1)})})})},null,o.crossOrigin)},t.Image.fromURL=function(l,u,o){t.util.loadImage(l,function(c,a){u&&u(new t.Image(c,o),a)},null,o&&o.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,u,o){var c=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(c["xlink:href"],u,n(o?t.util.object.clone(o):{},c))}}(i),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var r=this.angle%360;return r>0?Math.round((r-1)/90)*90:Math.round(r/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(r){r=r||{};var n=function(){},l=r.onComplete||n,u=r.onChange||n,o=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){o.rotate(c),u()},onComplete:function(){o.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(r){return r.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(r){return r.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function r(l,u){var o="precision "+u+` float;
void main(){}`,c=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(c,o),l.compileShader(c),!!l.getShaderParameter(c,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),o=u.getContext("webgl")||u.getContext("experimental-webgl"),c=!1;if(o){t.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),c=t.maxTextureSize>=l;for(var a=["highp","mediump","lowp"],d=0;d<3;d++)if(r(o,a[d])){t.webGlPrecision=a[d];break}}return this.isSupported=c,c},t.WebglFilterBackend=n;function n(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}n.prototype={tileSize:2048,resources:{},setupGLContext:function(l,u){this.dispose(),this.createWebGLCanvas(l,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,u)},chooseFastestCopyGLTo2DMethod:function(l,u){var o=typeof window.performance<"u",c;try{new ImageData(1,1),c=!0}catch{c=!1}var a=typeof ArrayBuffer<"u",d=typeof Uint8ClampedArray<"u";if(o&&c&&a&&d){var p=t.util.createCanvasElement(),f=new ArrayBuffer(l*u*4);if(t.forceGLPutImageData){this.imageBuffer=f,this.copyGLTo2D=m;return}var v={imageBuffer:f,destinationWidth:l,destinationHeight:u,targetCanvas:p},_,b,y;p.width=l,p.height=u,_=window.performance.now(),g.call(v,this.gl,v),b=window.performance.now()-_,_=window.performance.now(),m.call(v,this.gl,v),y=window.performance.now()-_,b>y?(this.imageBuffer=f,this.copyGLTo2D=m):this.copyGLTo2D=g}},createWebGLCanvas:function(l,u){var o=t.util.createCanvasElement();o.width=l,o.height=u;var c={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},a=o.getContext("webgl",c);a||(a=o.getContext("experimental-webgl",c)),a&&(a.clearColor(0,0,0,0),this.canvas=o,this.gl=a)},applyFilters:function(l,u,o,c,a,d){var p=this.gl,f;d&&(f=this.getCachedTexture(d,u));var v={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:o,sourceHeight:c,destinationWidth:o,destinationHeight:c,context:p,sourceTexture:this.createTexture(p,o,c,!f&&u),targetTexture:this.createTexture(p,o,c),originalTexture:f||this.createTexture(p,o,c,!f&&u),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:a},_=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,_),l.forEach(function(b){b&&b.applyTo(v)}),h(v),this.copyGLTo2D(p,v),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(v.sourceTexture),p.deleteTexture(v.targetTexture),p.deleteFramebuffer(_),a.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,u,o,c,a){var d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,a||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,a||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),c?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,c):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,u,o,0,l.RGBA,l.UNSIGNED_BYTE,null),d},getCachedTexture:function(l,u){if(this.textureCache[l])return this.textureCache[l];var o=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[l]=o,o},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:g,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,u={renderer:"",vendor:""};if(!l)return u;var o=l.getExtension("WEBGL_debug_renderer_info");if(o){var c=l.getParameter(o.UNMASKED_RENDERER_WEBGL),a=l.getParameter(o.UNMASKED_VENDOR_WEBGL);c&&(u.renderer=c.toLowerCase()),a&&(u.vendor=a.toLowerCase())}return this.gpuInfo=u,u}}}();function h(r){var n=r.targetCanvas,l=n.width,u=n.height,o=r.destinationWidth,c=r.destinationHeight;(l!==o||u!==c)&&(n.width=o,n.height=c)}function g(r,n){var l=r.canvas,u=n.targetCanvas,o=u.getContext("2d");o.translate(0,u.height),o.scale(1,-1);var c=l.height-u.height;o.drawImage(l,0,c,u.width,u.height,0,0,u.width,u.height)}function m(r,n){var l=n.targetCanvas,u=l.getContext("2d"),o=n.destinationWidth,c=n.destinationHeight,a=o*c*4,d=new Uint8Array(this.imageBuffer,0,a),p=new Uint8ClampedArray(this.imageBuffer,0,a);r.readPixels(0,0,o,c,r.RGBA,r.UNSIGNED_BYTE,d);var f=new ImageData(p,o,c);u.putImageData(f,0,0)}(function(){var r=function(){};t.Canvas2dFilterBackend=n;function n(){}n.prototype={evictCachesForKey:r,dispose:r,clearWebGLCaches:r,resources:{},applyFilters:function(l,u,o,c,a){var d=a.getContext("2d");d.drawImage(u,0,0,o,c);var p=d.getImageData(0,0,o,c),f=d.getImageData(0,0,o,c),v={sourceWidth:o,sourceHeight:c,imageData:p,originalEl:u,originalImageData:f,canvasEl:a,ctx:d,filterBackend:this};return l.forEach(function(_){_.applyTo(v)}),(v.imageData.width!==o||v.imageData.height!==c)&&(a.width=v.imageData.width,a.height=v.imageData.height),d.putImageData(v.imageData,0,0),v}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(r){r&&this.setOptions(r)},setOptions:function(r){for(var n in r)this[n]=r[n]},createProgram:function(r,n,l){n=n||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(n=n.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var u=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(u,l),r.compileShader(u),!r.getShaderParameter(u,r.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+r.getShaderInfoLog(u));var o=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(o,n),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+r.getShaderInfoLog(o));var c=r.createProgram();if(r.attachShader(c,u),r.attachShader(c,o),r.linkProgram(c),!r.getProgramParameter(c,r.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+r.getProgramInfoLog(c));var a=this.getAttributeLocations(r,c),d=this.getUniformLocations(r,c)||{};return d.uStepW=r.getUniformLocation(c,"uStepW"),d.uStepH=r.getUniformLocation(c,"uStepH"),{program:c,attributeLocations:a,uniformLocations:d}},getAttributeLocations:function(r,n){return{aPosition:r.getAttribLocation(n,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(r,n,l){var u=n.aPosition,o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,o),r.enableVertexAttribArray(u),r.vertexAttribPointer(u,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,l,r.STATIC_DRAW)},_setupFrameBuffer:function(r){var n=r.context,l,u;r.passes>1?(l=r.destinationWidth,u=r.destinationHeight,(r.sourceWidth!==l||r.sourceHeight!==u)&&(n.deleteTexture(r.targetTexture),r.targetTexture=r.filterBackend.createTexture(n,l,u)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(r){r.passes--,r.pass++;var n=r.targetTexture;r.targetTexture=r.sourceTexture,r.sourceTexture=n},isNeutralState:function(){var r=this.mainParameter,n=t.Image.filters[this.type].prototype;if(r)if(Array.isArray(n[r])){for(var l=n[r].length;l--;)if(this[r][l]!==n[r][l])return!1;return!0}else return n[r]===this[r];else return!1},applyTo:function(r){r.webgl?(this._setupFrameBuffer(r),this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},retrieveShader:function(r){return r.programCache.hasOwnProperty(this.type)||(r.programCache[this.type]=this.createProgram(r.context)),r.programCache[this.type]},applyToWebGL:function(r){var n=r.context,l=this.retrieveShader(r);r.pass===0&&r.originalTexture?n.bindTexture(n.TEXTURE_2D,r.originalTexture):n.bindTexture(n.TEXTURE_2D,r.sourceTexture),n.useProgram(l.program),this.sendAttributeData(n,l.attributeLocations,r.aPosition),n.uniform1f(l.uniformLocations.uStepW,1/r.sourceWidth),n.uniform1f(l.uniformLocations.uStepH,1/r.sourceHeight),this.sendUniformData(n,l.uniformLocations),n.viewport(0,0,r.destinationWidth,r.destinationHeight),n.drawArrays(n.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(r,n,l){r.activeTexture(l),r.bindTexture(r.TEXTURE_2D,n),r.activeTexture(r.TEXTURE0)},unbindAdditionalTexture:function(r,n){r.activeTexture(n),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(r){this[this.mainParameter]=r},sendUniformData:function(){},createHelpLayer:function(r){if(!r.helpLayer){var n=document.createElement("canvas");n.width=r.sourceWidth,n.height=r.sourceHeight,r.helpLayer=n}},toObject:function(){var r={type:this.type},n=this.mainParameter;return n&&(r[n]=this[n]),r},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(r,n){var l=new t.Image.filters[r.type](r);return n&&n(l),l},function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.ColorMatrix=u(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(o){this.callSuper("initialize",o),this.matrix=this.matrix.slice(0)},applyTo2d:function(o){var c=o.imageData,a=c.data,d=a.length,p=this.matrix,f,v,_,b,y,x=this.colorsOnly;for(y=0;y<d;y+=4)f=a[y],v=a[y+1],_=a[y+2],x?(a[y]=f*p[0]+v*p[1]+_*p[2]+p[4]*255,a[y+1]=f*p[5]+v*p[6]+_*p[7]+p[9]*255,a[y+2]=f*p[10]+v*p[11]+_*p[12]+p[14]*255):(b=a[y+3],a[y]=f*p[0]+v*p[1]+_*p[2]+b*p[3]+p[4]*255,a[y+1]=f*p[5]+v*p[6]+_*p[7]+b*p[8]+p[9]*255,a[y+2]=f*p[10]+v*p[11]+_*p[12]+b*p[13]+p[14]*255,a[y+3]=f*p[15]+v*p[16]+_*p[17]+b*p[18]+p[19]*255)},getUniformLocations:function(o,c){return{uColorMatrix:o.getUniformLocation(c,"uColorMatrix"),uConstants:o.getUniformLocation(c,"uConstants")}},sendUniformData:function(o,c){var a=this.matrix,d=[a[0],a[1],a[2],a[3],a[5],a[6],a[7],a[8],a[10],a[11],a[12],a[13],a[15],a[16],a[17],a[18]],p=[a[4],a[9],a[14],a[19]];o.uniformMatrix4fv(c.uColorMatrix,!1,d),o.uniform4fv(c.uConstants,p)}}),n.Image.filters.ColorMatrix.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Brightness=u(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(o){if(this.brightness!==0){var c=o.imageData,a=c.data,d,p=a.length,f=Math.round(this.brightness*255);for(d=0;d<p;d+=4)a[d]=a[d]+f,a[d+1]=a[d+1]+f,a[d+2]=a[d+2]+f}},getUniformLocations:function(o,c){return{uBrightness:o.getUniformLocation(c,"uBrightness")}},sendUniformData:function(o,c){o.uniform1f(c.uBrightness,this.brightness)}}),n.Image.filters.Brightness.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.Image.filters,o=n.util.createClass;u.Convolute=o(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(c){var a=Math.sqrt(this.matrix.length),d=this.type+"_"+a+"_"+(this.opaque?1:0),p=this.fragmentSource[d];return c.programCache.hasOwnProperty(d)||(c.programCache[d]=this.createProgram(c.context,p)),c.programCache[d]},applyTo2d:function(c){var a=c.imageData,d=a.data,p=this.matrix,f=Math.round(Math.sqrt(p.length)),v=Math.floor(f/2),_=a.width,b=a.height,y=c.ctx.createImageData(_,b),x=y.data,C=this.opaque?1:0,S,O,F,R,z,X,J,q,V,Q,tt,et,w;for(tt=0;tt<b;tt++)for(Q=0;Q<_;Q++){for(z=(tt*_+Q)*4,S=0,O=0,F=0,R=0,w=0;w<f;w++)for(et=0;et<f;et++)J=tt+w-v,X=Q+et-v,!(J<0||J>=b||X<0||X>=_)&&(q=(J*_+X)*4,V=p[w*f+et],S+=d[q]*V,O+=d[q+1]*V,F+=d[q+2]*V,C||(R+=d[q+3]*V));x[z]=S,x[z+1]=O,x[z+2]=F,C?x[z+3]=d[z+3]:x[z+3]=R}c.imageData=y},getUniformLocations:function(c,a){return{uMatrix:c.getUniformLocation(a,"uMatrix"),uOpaque:c.getUniformLocation(a,"uOpaque"),uHalfSize:c.getUniformLocation(a,"uHalfSize"),uSize:c.getUniformLocation(a,"uSize")}},sendUniformData:function(c,a){c.uniform1fv(a.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),n.Image.filters.Convolute.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Grayscale=u(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(o){var c=o.imageData,a=c.data,d,p=a.length,f,v=this.mode;for(d=0;d<p;d+=4)v==="average"?f=(a[d]+a[d+1]+a[d+2])/3:v==="lightness"?f=(Math.min(a[d],a[d+1],a[d+2])+Math.max(a[d],a[d+1],a[d+2]))/2:v==="luminosity"&&(f=.21*a[d]+.72*a[d+1]+.07*a[d+2]),a[d]=f,a[d+1]=f,a[d+2]=f},retrieveShader:function(o){var c=this.type+"_"+this.mode;if(!o.programCache.hasOwnProperty(c)){var a=this.fragmentSource[this.mode];o.programCache[c]=this.createProgram(o.context,a)}return o.programCache[c]},getUniformLocations:function(o,c){return{uMode:o.getUniformLocation(c,"uMode")}},sendUniformData:function(o,c){var a=1;o.uniform1i(c.uMode,a)},isNeutralState:function(){return!1}}),n.Image.filters.Grayscale.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Invert=u(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(o){var c=o.imageData,a=c.data,d,p=a.length;for(d=0;d<p;d+=4)a[d]=255-a[d],a[d+1]=255-a[d+1],a[d+2]=255-a[d+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(o,c){return{uInvert:o.getUniformLocation(c,"uInvert")}},sendUniformData:function(o,c){o.uniform1i(c.uInvert,this.invert)}}),n.Image.filters.Invert.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.Image.filters,o=n.util.createClass;u.Noise=o(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(c){if(this.noise!==0){var a=c.imageData,d=a.data,p,f=d.length,v=this.noise,_;for(p=0,f=d.length;p<f;p+=4)_=(.5-Math.random())*v,d[p]+=_,d[p+1]+=_,d[p+2]+=_}},getUniformLocations:function(c,a){return{uNoise:c.getUniformLocation(a,"uNoise"),uSeed:c.getUniformLocation(a,"uSeed")}},sendUniformData:function(c,a){c.uniform1f(a.uNoise,this.noise/255),c.uniform1f(a.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),n.Image.filters.Noise.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Pixelate=u(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(o){var c=o.imageData,a=c.data,d=c.height,p=c.width,f,v,_,b,y,x,C,S,O,F,R;for(v=0;v<d;v+=this.blocksize)for(_=0;_<p;_+=this.blocksize)for(f=v*4*p+_*4,b=a[f],y=a[f+1],x=a[f+2],C=a[f+3],F=Math.min(v+this.blocksize,d),R=Math.min(_+this.blocksize,p),S=v;S<F;S++)for(O=_;O<R;O++)f=S*4*p+O*4,a[f]=b,a[f+1]=y,a[f+2]=x,a[f+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(o,c){return{uBlocksize:o.getUniformLocation(c,"uBlocksize"),uStepW:o.getUniformLocation(c,"uStepW"),uStepH:o.getUniformLocation(c,"uStepH")}},sendUniformData:function(o,c){o.uniform1f(c.uBlocksize,this.blocksize)}}),n.Image.filters.Pixelate.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.extend,u=n.Image.filters,o=n.util.createClass;u.RemoveColor=o(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(c){var a=c.imageData,d=a.data,p,f=this.distance*255,v,_,b,y=new n.Color(this.color).getSource(),x=[y[0]-f,y[1]-f,y[2]-f],C=[y[0]+f,y[1]+f,y[2]+f];for(p=0;p<d.length;p+=4)v=d[p],_=d[p+1],b=d[p+2],v>x[0]&&_>x[1]&&b>x[2]&&v<C[0]&&_<C[1]&&b<C[2]&&(d[p+3]=0)},getUniformLocations:function(c,a){return{uLow:c.getUniformLocation(a,"uLow"),uHigh:c.getUniformLocation(a,"uHigh")}},sendUniformData:function(c,a){var d=new n.Color(this.color).getSource(),p=parseFloat(this.distance),f=[0+d[0]/255-p,0+d[1]/255-p,0+d[2]/255-p,1],v=[d[0]/255+p,d[1]/255+p,d[2]/255+p,1];c.uniform4fv(a.uLow,f),c.uniform4fv(a.uHigh,v)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),n.Image.filters.RemoveColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass,o={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var c in o)l[c]=u(l.ColorMatrix,{type:c,matrix:o[c],mainParameter:!1,colorsOnly:!0}),n.Image.filters[c].fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric,l=n.Image.filters,u=n.util.createClass;l.BlendColor=u(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(o){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[o]+`}
}`},retrieveShader:function(o){var c=this.type+"_"+this.mode,a;return o.programCache.hasOwnProperty(c)||(a=this.buildSource(this.mode),o.programCache[c]=this.createProgram(o.context,a)),o.programCache[c]},applyTo2d:function(o){var c=o.imageData,a=c.data,d=a.length,p,f,v,_,b,y,x,C=1-this.alpha;x=new n.Color(this.color).getSource(),p=x[0]*this.alpha,f=x[1]*this.alpha,v=x[2]*this.alpha;for(var S=0;S<d;S+=4)switch(_=a[S],b=a[S+1],y=a[S+2],this.mode){case"multiply":a[S]=_*p/255,a[S+1]=b*f/255,a[S+2]=y*v/255;break;case"screen":a[S]=255-(255-_)*(255-p)/255,a[S+1]=255-(255-b)*(255-f)/255,a[S+2]=255-(255-y)*(255-v)/255;break;case"add":a[S]=_+p,a[S+1]=b+f,a[S+2]=y+v;break;case"diff":case"difference":a[S]=Math.abs(_-p),a[S+1]=Math.abs(b-f),a[S+2]=Math.abs(y-v);break;case"subtract":a[S]=_-p,a[S+1]=b-f,a[S+2]=y-v;break;case"darken":a[S]=Math.min(_,p),a[S+1]=Math.min(b,f),a[S+2]=Math.min(y,v);break;case"lighten":a[S]=Math.max(_,p),a[S+1]=Math.max(b,f),a[S+2]=Math.max(y,v);break;case"overlay":a[S]=p<128?2*_*p/255:255-2*(255-_)*(255-p)/255,a[S+1]=f<128?2*b*f/255:255-2*(255-b)*(255-f)/255,a[S+2]=v<128?2*y*v/255:255-2*(255-y)*(255-v)/255;break;case"exclusion":a[S]=p+_-2*p*_/255,a[S+1]=f+b-2*f*b/255,a[S+2]=v+y-2*v*y/255;break;case"tint":a[S]=p+_*C,a[S+1]=f+b*C,a[S+2]=v+y*C}},getUniformLocations:function(o,c){return{uColor:o.getUniformLocation(c,"uColor")}},sendUniformData:function(o,c){var a=new n.Color(this.color).getSource();a[0]=this.alpha*a[0]/255,a[1]=this.alpha*a[1]/255,a[2]=this.alpha*a[2]/255,a[3]=this.alpha,o.uniform4fv(c.uColor,a)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric,l=n.Image.filters,u=n.util.createClass;l.BlendImage=u(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(o){var c=this.type+"_"+this.mode,a=this.fragmentSource[this.mode];return o.programCache.hasOwnProperty(c)||(o.programCache[c]=this.createProgram(o.context,a)),o.programCache[c]},applyToWebGL:function(o){var c=o.context,a=this.createTexture(o.filterBackend,this.image);this.bindAdditionalTexture(c,a,c.TEXTURE1),this.callSuper("applyToWebGL",o),this.unbindAdditionalTexture(c,c.TEXTURE1)},createTexture:function(o,c){return o.getCachedTexture(c.cacheKey,c._element)},calculateMatrix:function(){var o=this.image,c=o._element.width,a=o._element.height;return[1/o.scaleX,0,0,0,1/o.scaleY,0,-o.left/c,-o.top/a,1]},applyTo2d:function(o){var c=o.imageData,a=o.filterBackend.resources,d=c.data,p=d.length,f=c.width,v=c.height,_,b,y,x,C,S,O,F,R,z,X=this.image,J;a.blendImage||(a.blendImage=n.util.createCanvasElement()),R=a.blendImage,z=R.getContext("2d"),R.width!==f||R.height!==v?(R.width=f,R.height=v):z.clearRect(0,0,f,v),z.setTransform(X.scaleX,0,0,X.scaleY,X.left,X.top),z.drawImage(X._element,0,0,f,v),J=z.getImageData(0,0,f,v).data;for(var q=0;q<p;q+=4)switch(C=d[q],S=d[q+1],O=d[q+2],F=d[q+3],_=J[q],b=J[q+1],y=J[q+2],x=J[q+3],this.mode){case"multiply":d[q]=C*_/255,d[q+1]=S*b/255,d[q+2]=O*y/255,d[q+3]=F*x/255;break;case"mask":d[q+3]=x;break}},getUniformLocations:function(o,c){return{uTransformMatrix:o.getUniformLocation(c,"uTransformMatrix"),uImage:o.getUniformLocation(c,"uImage")}},sendUniformData:function(o,c){var a=this.calculateMatrix();o.uniform1i(c.uImage,1),o.uniformMatrix3fv(c.uTransformMatrix,!1,a)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendImage.fromObject=function(o,c){n.Image.fromObject(o.image,function(a){var d=n.util.object.clone(o);d.image=a,c(new n.Image.filters.BlendImage(d))})}}(i),function(r){var n=r.fabric||(r.fabric={}),l=Math.pow,u=Math.floor,o=Math.sqrt,c=Math.abs,a=Math.round,d=Math.sin,p=Math.ceil,f=n.Image.filters,v=n.util.createClass;f.Resize=v(f.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,b){return{uDelta:_.getUniformLocation(b,"uDelta"),uTaps:_.getUniformLocation(b,"uTaps")}},sendUniformData:function(_,b){_.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(b.uTaps,this.taps)},retrieveShader:function(_){var b=this.getFilterWindow(),y=this.type+"_"+b;if(!_.programCache.hasOwnProperty(y)){var x=this.generateShader(b);_.programCache[y]=this.createProgram(_.context,x)}return _.programCache[y]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,y=this.getFilterWindow(),x=new Array(y),C=1;C<=y;C++)x[C-1]=_(C*b);return x},generateShader:function(x){for(var b=new Array(x),y=this.fragmentSourceTOP,x,C=1;C<=x;C++)b[C-1]=C+".0 * uDelta";return y+="uniform float uTaps["+x+`];
`,y+=`void main() {
`,y+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,y+=`  float sum = 1.0;
`,b.forEach(function(S,O){y+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+O+`];
`,y+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+O+`];
`,y+="  sum += 2.0 * uTaps["+O+`];
`}),y+=`  gl_FragColor = color / sum;
`,y+="}",y},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(b){if(b>=_||b<=-_)return 0;if(b<11920929e-14&&b>-11920929e-14)return 1;b*=Math.PI;var y=b/_;return d(b)/b*d(y)/y}},applyTo2d:function(_){var b=_.imageData,y=this.scaleX,x=this.scaleY;this.rcpScaleX=1/y,this.rcpScaleY=1/x;var C=b.width,S=b.height,O=a(C*y),F=a(S*x),R;this.resizeType==="sliceHack"?R=this.sliceByTwo(_,C,S,O,F):this.resizeType==="hermite"?R=this.hermiteFastResize(_,C,S,O,F):this.resizeType==="bilinear"?R=this.bilinearFiltering(_,C,S,O,F):this.resizeType==="lanczos"&&(R=this.lanczosResize(_,C,S,O,F)),_.imageData=R},sliceByTwo:function(_,b,y,x,C){var S=_.imageData,O=.5,F=!1,R=!1,z=b*O,X=y*O,J=n.filterBackend.resources,q,V,Q=0,tt=0,et=b,w=0;for(J.sliceByTwo||(J.sliceByTwo=document.createElement("canvas")),q=J.sliceByTwo,(q.width<b*1.5||q.height<y)&&(q.width=b*1.5,q.height=y),V=q.getContext("2d"),V.clearRect(0,0,b*1.5,y),V.putImageData(S,0,0),x=u(x),C=u(C);!F||!R;)b=z,y=X,x<u(z*O)?z=u(z*O):(z=x,F=!0),C<u(X*O)?X=u(X*O):(X=C,R=!0),V.drawImage(q,Q,tt,b,y,et,w,z,X),Q=et,tt=w,w+=X;return V.getImageData(Q,tt,x,C)},lanczosResize:function(_,b,y,x,C){function S(D){var P,I,k,T,A,E,B,j,G,K,it;for(w.x=(D+.5)*X,M.x=u(w.x),P=0;P<C;P++){for(w.y=(P+.5)*J,M.y=u(w.y),A=0,E=0,B=0,j=0,G=0,I=M.x-Q;I<=M.x+Q;I++)if(!(I<0||I>=b)){K=u(1e3*c(I-w.x)),et[K]||(et[K]={});for(var W=M.y-tt;W<=M.y+tt;W++)W<0||W>=y||(it=u(1e3*c(W-w.y)),et[K][it]||(et[K][it]=z(o(l(K*q,2)+l(it*V,2))/1e3)),k=et[K][it],k>0&&(T=(W*b+I)*4,A+=k,E+=k*O[T],B+=k*O[T+1],j+=k*O[T+2],G+=k*O[T+3]))}T=(P*x+D)*4,R[T]=E/A,R[T+1]=B/A,R[T+2]=j/A,R[T+3]=G/A}return++D<x?S(D):F}var O=_.imageData.data,F=_.ctx.createImageData(x,C),R=F.data,z=this.lanczosCreate(this.lanczosLobes),X=this.rcpScaleX,J=this.rcpScaleY,q=2/this.rcpScaleX,V=2/this.rcpScaleY,Q=p(X*this.lanczosLobes/2),tt=p(J*this.lanczosLobes/2),et={},w={},M={};return S(0)},bilinearFiltering:function(_,b,y,x,C){var S,O,F,R,z,X,J,q,V,Q,tt,et,w=0,M,D=this.rcpScaleX,P=this.rcpScaleY,I=4*(b-1),k=_.imageData,T=k.data,A=_.ctx.createImageData(x,C),E=A.data;for(J=0;J<C;J++)for(q=0;q<x;q++)for(z=u(D*q),X=u(P*J),V=D*q-z,Q=P*J-X,M=4*(X*b+z),tt=0;tt<4;tt++)S=T[M+tt],O=T[M+4+tt],F=T[M+I+tt],R=T[M+I+4+tt],et=S*(1-V)*(1-Q)+O*V*(1-Q)+F*Q*(1-V)+R*V*Q,E[w++]=et;return A},hermiteFastResize:function(_,b,y,x,C){for(var S=this.rcpScaleX,O=this.rcpScaleY,F=p(S/2),R=p(O/2),z=_.imageData,X=z.data,J=_.ctx.createImageData(x,C),q=J.data,V=0;V<C;V++)for(var Q=0;Q<x;Q++){for(var tt=(Q+V*x)*4,et=0,w=0,M=0,D=0,P=0,I=0,k=0,T=(V+.5)*O,A=u(V*O);A<(V+1)*O;A++)for(var E=c(T-(A+.5))/R,B=(Q+.5)*S,j=E*E,G=u(Q*S);G<(Q+1)*S;G++){var K=c(B-(G+.5))/F,it=o(j+K*K);it>1&&it<-1||(et=2*it*it*it-3*it*it+1,et>0&&(K=4*(G+A*b),k+=et*X[K+3],M+=et,X[K+3]<255&&(et=et*X[K+3]/250),D+=et*X[K],P+=et*X[K+1],I+=et*X[K+2],w+=et))}q[tt]=D/w,q[tt+1]=P/w,q[tt+2]=I/w,q[tt+3]=k/M}return J},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),n.Image.filters.Resize.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Contrast=u(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(o){if(this.contrast!==0){var c=o.imageData,a,p,d=c.data,p=d.length,f=Math.floor(this.contrast*255),v=259*(f+255)/(255*(259-f));for(a=0;a<p;a+=4)d[a]=v*(d[a]-128)+128,d[a+1]=v*(d[a+1]-128)+128,d[a+2]=v*(d[a+2]-128)+128}},getUniformLocations:function(o,c){return{uContrast:o.getUniformLocation(c,"uContrast")}},sendUniformData:function(o,c){o.uniform1f(c.uContrast,this.contrast)}}),n.Image.filters.Contrast.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Saturation=u(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(o){if(this.saturation!==0){var c=o.imageData,a=c.data,d=a.length,p=-this.saturation,f,v;for(f=0;f<d;f+=4)v=Math.max(a[f],a[f+1],a[f+2]),a[f]+=v!==a[f]?(v-a[f])*p:0,a[f+1]+=v!==a[f+1]?(v-a[f+1])*p:0,a[f+2]+=v!==a[f+2]?(v-a[f+2])*p:0}},getUniformLocations:function(o,c){return{uSaturation:o.getUniformLocation(c,"uSaturation")}},sendUniformData:function(o,c){o.uniform1f(c.uSaturation,-this.saturation)}}),n.Image.filters.Saturation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Vibrance=u(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(o){if(this.vibrance!==0){var c=o.imageData,a=c.data,d=a.length,p=-this.vibrance,f,v,_,b;for(f=0;f<d;f+=4)v=Math.max(a[f],a[f+1],a[f+2]),_=(a[f]+a[f+1]+a[f+2])/3,b=Math.abs(v-_)*2/255*p,a[f]+=v!==a[f]?(v-a[f])*b:0,a[f+1]+=v!==a[f+1]?(v-a[f+1])*b:0,a[f+2]+=v!==a[f+2]?(v-a[f+2])*b:0}},getUniformLocations:function(o,c){return{uVibrance:o.getUniformLocation(c,"uVibrance")}},sendUniformData:function(o,c){o.uniform1f(c.uVibrance,-this.vibrance)}}),n.Image.filters.Vibrance.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Blur=u(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(o){o.webgl?(this.aspectRatio=o.sourceWidth/o.sourceHeight,o.passes++,this._setupFrameBuffer(o),this.horizontal=!0,this.applyToWebGL(o),this._swapTextures(o),this._setupFrameBuffer(o),this.horizontal=!1,this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},applyTo2d:function(o){o.imageData=this.simpleBlur(o)},simpleBlur:function(o){var c=o.filterBackend.resources,a,d,p=o.imageData.width,f=o.imageData.height;c.blurLayer1||(c.blurLayer1=n.util.createCanvasElement(),c.blurLayer2=n.util.createCanvasElement()),a=c.blurLayer1,d=c.blurLayer2,(a.width!==p||a.height!==f)&&(d.width=a.width=p,d.height=a.height=f);var v=a.getContext("2d"),_=d.getContext("2d"),b=15,y,x,C,S,O=this.blur*.06*.5;for(v.putImageData(o.imageData,0,0),_.clearRect(0,0,p,f),S=-b;S<=b;S++)y=(Math.random()-.5)/4,x=S/b,C=O*x*p+y,_.globalAlpha=1-Math.abs(x),_.drawImage(a,C,y),v.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);for(S=-b;S<=b;S++)y=(Math.random()-.5)/4,x=S/b,C=O*x*f+y,_.globalAlpha=1-Math.abs(x),_.drawImage(a,y,C),v.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);o.ctx.drawImage(a,0,0);var F=o.ctx.getImageData(0,0,a.width,a.height);return v.globalAlpha=1,v.clearRect(0,0,a.width,a.height),F},getUniformLocations:function(o,c){return{delta:o.getUniformLocation(c,"uDelta")}},sendUniformData:function(o,c){var a=this.chooseRightDelta();o.uniform2fv(c.delta,a)},chooseRightDelta:function(){var o=1,c=[0,0],a;return this.horizontal?this.aspectRatio>1&&(o=1/this.aspectRatio):this.aspectRatio<1&&(o=this.aspectRatio),a=o*this.blur*.12,this.horizontal?c[0]=a:c[1]=a,c}}),l.Blur.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Gamma=u(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(o){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,o)},applyTo2d:function(o){var c=o.imageData,a=c.data,d=this.gamma,p=a.length,f=1/d[0],v=1/d[1],_=1/d[2],b;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),b=0,p=256;b<p;b++)this.rVals[b]=Math.pow(b/255,f)*255,this.gVals[b]=Math.pow(b/255,v)*255,this.bVals[b]=Math.pow(b/255,_)*255;for(b=0,p=a.length;b<p;b+=4)a[b]=this.rVals[a[b]],a[b+1]=this.gVals[a[b+1]],a[b+2]=this.bVals[a[b+2]]},getUniformLocations:function(o,c){return{uGamma:o.getUniformLocation(c,"uGamma")}},sendUniformData:function(o,c){o.uniform3fv(c.uGamma,this.gamma)}}),n.Image.filters.Gamma.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Composed=u(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(o){this.callSuper("initialize",o),this.subFilters=this.subFilters.slice(0)},applyTo:function(o){o.passes+=this.subFilters.length-1,this.subFilters.forEach(function(c){c.applyTo(o)})},toObject:function(){return n.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(o){return o.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(o){return!o.isNeutralState()})}}),n.Image.filters.Composed.fromObject=function(o,c){var a=o.subFilters||[],d=a.map(function(f){return new n.Image.filters[f.type](f)}),p=new n.Image.filters.Composed({subFilters:d});return c&&c(p),p}}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.Image.filters,u=n.util.createClass;l.HueRotation=u(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var o=this.rotation*Math.PI,c=n.util.cos(o),a=n.util.sin(o),d=1/3,p=Math.sqrt(d)*a,f=1-c;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=c+f/3,this.matrix[1]=d*f-p,this.matrix[2]=d*f+p,this.matrix[5]=d*f+p,this.matrix[6]=c+d*f,this.matrix[7]=d*f-p,this.matrix[10]=d*f-p,this.matrix[11]=d*f+p,this.matrix[12]=c+d*f},isNeutralState:function(o){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,o)},applyTo:function(o){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,o)}}),n.Image.filters.HueRotation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(r){var n=r.fabric||(r.fabric={}),l=n.util.object.clone;if(n.Text){n.warn("fabric.Text is already defined");return}var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");n.Text=n.util.createClass(n.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:n.Object.prototype.stateProperties.concat(u),cacheProperties:n.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(o,c){this.styles=c?c.styles||{}:{},this.text=o,this.__skipDimension=!0,this.callSuper("initialize",c),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var o=this.path;o&&(o.segmentsInfo=n.util.getPathSegmentsInfo(o.path))},getMeasuringContext:function(){return n._measuringContext||(n._measuringContext=this.canvas&&this.canvas.contextCache||n.util.createCanvasElement().getContext("2d")),n._measuringContext},_splitText:function(){var o=this._splitTextIntoLines(this.text);return this.textLines=o.lines,this._textLines=o.graphemeLines,this._unwrappedTextLines=o._unwrappedLines,this._text=o.graphemeText,o},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var o,c,a,d,p,f,v,_=0,b=this._textLines.length;_<b;_++)if(!(this.textAlign!=="justify"&&(_===b-1||this.isEndOfWrapping(_)))&&(d=0,p=this._textLines[_],c=this.getLineWidth(_),c<this.width&&(v=this.textLines[_].match(this._reSpacesAndTabs)))){a=v.length,o=(this.width-c)/a;for(var y=0,x=p.length;y<=x;y++)f=this.__charBounds[_][y],this._reSpaceAndTab.test(p[y])?(f.width+=o,f.kernedWidth+=o,f.left+=d,d+=o):f.left+=d}},isEndOfWrapping:function(o){return o===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var o=this.callSuper("_getCacheCanvasDimensions"),c=this.fontSize;return o.width+=c*o.zoomX,o.height+=c*o.zoomY,o},_render:function(o){var c=this.path;c&&!c.isNotVisible()&&c._render(o),this._setTextStyles(o),this._renderTextLinesBackground(o),this._renderTextDecoration(o,"underline"),this._renderText(o),this._renderTextDecoration(o,"overline"),this._renderTextDecoration(o,"linethrough")},_renderText:function(o){this.paintFirst==="stroke"?(this._renderTextStroke(o),this._renderTextFill(o)):(this._renderTextFill(o),this._renderTextStroke(o))},_setTextStyles:function(o,c,a){if(o.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":o.textBaseline="middle";break;case"ascender":o.textBaseline="top";break;case"descender":o.textBaseline="bottom";break}o.font=this._getFontDeclaration(c,a)},calcTextWidth:function(){for(var o=this.getLineWidth(0),c=1,a=this._textLines.length;c<a;c++){var d=this.getLineWidth(c);d>o&&(o=d)}return o},_renderTextLine:function(o,c,a,d,p,f){this._renderChars(o,c,a,d,p,f)},_renderTextLinesBackground:function(o){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var c,a,d=o.fillStyle,p,f,v=this._getLeftOffset(),_=this._getTopOffset(),b=0,y=0,x,C,S=this.path,O,F=0,R=this._textLines.length;F<R;F++){if(c=this.getHeightOfLine(F),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",F)){_+=c;continue}p=this._textLines[F],a=this._getLineLeftOffset(F),y=0,b=0,f=this.getValueOfPropertyAt(F,0,"textBackgroundColor");for(var z=0,X=p.length;z<X;z++)x=this.__charBounds[F][z],C=this.getValueOfPropertyAt(F,z,"textBackgroundColor"),S?(o.save(),o.translate(x.renderLeft,x.renderTop),o.rotate(x.angle),o.fillStyle=C,C&&o.fillRect(-x.width/2,-c/this.lineHeight*(1-this._fontSizeFraction),x.width,c/this.lineHeight),o.restore()):C!==f?(O=v+a+b,this.direction==="rtl"&&(O=this.width-O-y),o.fillStyle=f,f&&o.fillRect(O,_,y,c/this.lineHeight),b=x.left,y=x.width,f=C):y+=x.kernedWidth;C&&!S&&(O=v+a+b,this.direction==="rtl"&&(O=this.width-O-y),o.fillStyle=C,o.fillRect(O,_,y,c/this.lineHeight)),_+=c}o.fillStyle=d,this._removeShadow(o)}},getFontCache:function(o){var c=o.fontFamily.toLowerCase();n.charWidthsCache[c]||(n.charWidthsCache[c]={});var a=n.charWidthsCache[c],d=o.fontStyle.toLowerCase()+"_"+(o.fontWeight+"").toLowerCase();return a[d]||(a[d]={}),a[d]},_measureChar:function(o,c,a,d){var p=this.getFontCache(c),f=this._getFontDeclaration(c),v=this._getFontDeclaration(d),_=a+o,b=f===v,y,x,C,S=c.fontSize/this.CACHE_FONT_SIZE,O;if(a&&p[a]!==void 0&&(C=p[a]),p[o]!==void 0&&(O=y=p[o]),b&&p[_]!==void 0&&(x=p[_],O=x-C),y===void 0||C===void 0||x===void 0){var F=this.getMeasuringContext();this._setTextStyles(F,c,!0)}return y===void 0&&(O=y=F.measureText(o).width,p[o]=y),C===void 0&&b&&a&&(C=F.measureText(a).width,p[a]=C),b&&x===void 0&&(x=F.measureText(_).width,p[_]=x,O=x-C),{width:y*S,kernedWidth:O*S}},getHeightOfChar:function(o,c){return this.getValueOfPropertyAt(o,c,"fontSize")},measureLine:function(o){var c=this._measureLine(o);return this.charSpacing!==0&&(c.width-=this._getWidthOfCharSpacing()),c.width<0&&(c.width=0),c},_measureLine:function(o){var c=0,a,d,p=this._textLines[o],f,v,_=0,b=new Array(p.length),y=0,x,C,S=this.path,O=this.pathSide==="right";for(this.__charBounds[o]=b,a=0;a<p.length;a++)d=p[a],v=this._getGraphemeBox(d,o,a,f),b[a]=v,c+=v.kernedWidth,f=d;if(b[a]={left:v?v.left+v.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(C=S.segmentsInfo[S.segmentsInfo.length-1].length,x=n.util.getPointOnPath(S.path,0,S.segmentsInfo),x.x+=S.pathOffset.x,x.y+=S.pathOffset.y,this.textAlign){case"left":y=O?C-c:0;break;case"center":y=(C-c)/2;break;case"right":y=O?0:C-c;break}for(y+=this.pathStartOffset*(O?-1:1),a=O?p.length-1:0;O?a>=0:a<p.length;O?a--:a++)v=b[a],y>C?y%=C:y<0&&(y+=C),this._setGraphemeOnPath(y,v,x),y+=v.kernedWidth}return{width:c,numOfSpaces:_}},_setGraphemeOnPath:function(o,c,a){var d=o+c.kernedWidth/2,p=this.path,f=n.util.getPointOnPath(p.path,d,p.segmentsInfo);c.renderLeft=f.x-a.x,c.renderTop=f.y-a.y,c.angle=f.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(o,c,a,d,p){var f=this.getCompleteStyleDeclaration(c,a),v=d?this.getCompleteStyleDeclaration(c,a-1):{},_=this._measureChar(o,f,d,v),b=_.kernedWidth,y=_.width,x;this.charSpacing!==0&&(x=this._getWidthOfCharSpacing(),y+=x,b+=x);var C={width:y,left:0,height:f.fontSize,kernedWidth:b,deltaY:f.deltaY};if(a>0&&!p){var S=this.__charBounds[c][a-1];C.left=S.left+S.width+_.kernedWidth-_.width}return C},getHeightOfLine:function(o){if(this.__lineHeights[o])return this.__lineHeights[o];for(var c=this._textLines[o],a=this.getHeightOfChar(o,0),d=1,p=c.length;d<p;d++)a=Math.max(this.getHeightOfChar(o,d),a);return this.__lineHeights[o]=a*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var o,c=0,a=0,d=this._textLines.length;a<d;a++)o=this.getHeightOfLine(a),c+=a===d-1?o/this.lineHeight:o;return c},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(o,c){o.save();for(var a=0,d=this._getLeftOffset(),p=this._getTopOffset(),f=0,v=this._textLines.length;f<v;f++){var _=this.getHeightOfLine(f),b=_/this.lineHeight,y=this._getLineLeftOffset(f);this._renderTextLine(c,o,this._textLines[f],d+y,p+a+b,f),a+=_}o.restore()},_renderTextFill:function(o){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(o,"fillText")},_renderTextStroke:function(o){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this._setLineDash(o,this.strokeDashArray),o.beginPath(),this._renderTextCommon(o,"strokeText"),o.closePath(),o.restore())},_renderChars:function(o,c,a,d,p,f){var v=this.getHeightOfLine(f),_=this.textAlign.indexOf("justify")!==-1,b,y,x="",C,S=0,O,F=this.path,R=!_&&this.charSpacing===0&&this.isEmptyStyles(f)&&!F,z=this.direction==="ltr",X=this.direction==="ltr"?1:-1,J,q=c.canvas.getAttribute("dir");if(c.save(),q!==this.direction&&(c.canvas.setAttribute("dir",z?"ltr":"rtl"),c.direction=z?"ltr":"rtl",c.textAlign=z?"left":"right"),p-=v*this._fontSizeFraction/this.lineHeight,R){this._renderChar(o,c,f,0,a.join(""),d,p,v),c.restore();return}for(var V=0,Q=a.length-1;V<=Q;V++)O=V===Q||this.charSpacing||F,x+=a[V],C=this.__charBounds[f][V],S===0?(d+=X*(C.kernedWidth-C.width),S+=C.width):S+=C.kernedWidth,_&&!O&&this._reSpaceAndTab.test(a[V])&&(O=!0),O||(b=b||this.getCompleteStyleDeclaration(f,V),y=this.getCompleteStyleDeclaration(f,V+1),O=n.util.hasStyleChanged(b,y,!1)),O&&(F?(c.save(),c.translate(C.renderLeft,C.renderTop),c.rotate(C.angle),this._renderChar(o,c,f,V,x,-S/2,0,v),c.restore()):(J=d,this._renderChar(o,c,f,V,x,J,p,v)),x="",b=y,d+=X*S,S=0);c.restore()},_applyPatternGradientTransformText:function(o){var c=n.util.createCanvasElement(),a,d=this.width+this.strokeWidth,p=this.height+this.strokeWidth;return c.width=d,c.height=p,a=c.getContext("2d"),a.beginPath(),a.moveTo(0,0),a.lineTo(d,0),a.lineTo(d,p),a.lineTo(0,p),a.closePath(),a.translate(d/2,p/2),a.fillStyle=o.toLive(a),this._applyPatternGradientTransform(a,o),a.fill(),a.createPattern(c,"no-repeat")},handleFiller:function(o,c,a){var d,p;return a.toLive?a.gradientUnits==="percentage"||a.gradientTransform||a.patternTransform?(d=-this.width/2,p=-this.height/2,o.translate(d,p),o[c]=this._applyPatternGradientTransformText(a),{offsetX:d,offsetY:p}):(o[c]=a.toLive(o,this),this._applyPatternGradientTransform(o,a)):(o[c]=a,{offsetX:0,offsetY:0})},_setStrokeStyles:function(o,c){return o.lineWidth=c.strokeWidth,o.lineCap=this.strokeLineCap,o.lineDashOffset=this.strokeDashOffset,o.lineJoin=this.strokeLineJoin,o.miterLimit=this.strokeMiterLimit,this.handleFiller(o,"strokeStyle",c.stroke)},_setFillStyles:function(o,c){return this.handleFiller(o,"fillStyle",c.fill)},_renderChar:function(o,c,a,d,p,f,v){var _=this._getStyleDeclaration(a,d),b=this.getCompleteStyleDeclaration(a,d),y=o==="fillText"&&b.fill,x=o==="strokeText"&&b.stroke&&b.strokeWidth,C,S;!x&&!y||(c.save(),y&&(C=this._setFillStyles(c,b)),x&&(S=this._setStrokeStyles(c,b)),c.font=this._getFontDeclaration(b),_&&_.textBackgroundColor&&this._removeShadow(c),_&&_.deltaY&&(v+=_.deltaY),y&&c.fillText(p,f-C.offsetX,v-C.offsetY),x&&c.strokeText(p,f-S.offsetX,v-S.offsetY),c.restore())},setSuperscript:function(o,c){return this._setScript(o,c,this.superscript)},setSubscript:function(o,c){return this._setScript(o,c,this.subscript)},_setScript:function(o,c,a){var d=this.get2DCursorLocation(o,!0),p=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),f=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),v={fontSize:p*a.size,deltaY:f+p*a.baseline};return this.setSelectionStyles(v,o,c),this},_getLineLeftOffset:function(o){var c=this.getLineWidth(o),a=this.width-c,d=this.textAlign,p=this.direction,v,f=0,v=this.isEndOfWrapping(o);return d==="justify"||d==="justify-center"&&!v||d==="justify-right"&&!v||d==="justify-left"&&!v?0:(d==="center"&&(f=a/2),d==="right"&&(f=a),d==="justify-center"&&(f=a/2),d==="justify-right"&&(f=a),p==="rtl"&&(f-=a),f)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var o=this._forceClearCache;return o||(o=this.hasStateChanged("_dimensionAffectingProps")),o&&(this.dirty=!0,this._forceClearCache=!1),o},getLineWidth:function(o){if(this.__lineWidths[o]!==void 0)return this.__lineWidths[o];var c=this.measureLine(o),a=c.width;return this.__lineWidths[o]=a,a},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(o,c,a){var d=this._getStyleDeclaration(o,c);return d&&typeof d[a]<"u"?d[a]:this[a]},_renderTextDecoration:function(o,c){if(!(!this[c]&&!this.styleHas(c))){for(var a,d,p,f,v,_,b,y,x=this._getLeftOffset(),C=this._getTopOffset(),S,O,F,R,z,X,J,q,V=this.path,Q=this._getWidthOfCharSpacing(),tt=this.offsets[c],et=0,w=this._textLines.length;et<w;et++){if(a=this.getHeightOfLine(et),!this[c]&&!this.styleHas(c,et)){C+=a;continue}b=this._textLines[et],X=a/this.lineHeight,f=this._getLineLeftOffset(et),O=0,F=0,y=this.getValueOfPropertyAt(et,0,c),q=this.getValueOfPropertyAt(et,0,"fill"),S=C+X*(1-this._fontSizeFraction),d=this.getHeightOfChar(et,0),v=this.getValueOfPropertyAt(et,0,"deltaY");for(var M=0,D=b.length;M<D;M++)if(R=this.__charBounds[et][M],z=this.getValueOfPropertyAt(et,M,c),J=this.getValueOfPropertyAt(et,M,"fill"),p=this.getHeightOfChar(et,M),_=this.getValueOfPropertyAt(et,M,"deltaY"),V&&z&&J)o.save(),o.fillStyle=q,o.translate(R.renderLeft,R.renderTop),o.rotate(R.angle),o.fillRect(-R.kernedWidth/2,tt*p+_,R.kernedWidth,this.fontSize/15),o.restore();else if((z!==y||J!==q||p!==d||_!==v)&&F>0){var P=x+f+O;this.direction==="rtl"&&(P=this.width-P-F),y&&q&&(o.fillStyle=q,o.fillRect(P,S+tt*d+v,F,this.fontSize/15)),O=R.left,F=R.width,y=z,q=J,d=p,v=_}else F+=R.kernedWidth;var P=x+f+O;this.direction==="rtl"&&(P=this.width-P-F),o.fillStyle=J,z&&J&&o.fillRect(P,S+tt*d+v,F-Q,this.fontSize/15),C+=a}this._removeShadow(o)}},_getFontDeclaration:function(o,c){var a=o||this,d=this.fontFamily,p=n.Text.genericFonts.indexOf(d.toLowerCase())>-1,f=d===void 0||d.indexOf("'")>-1||d.indexOf(",")>-1||d.indexOf('"')>-1||p?a.fontFamily:'"'+a.fontFamily+'"';return[n.isLikelyNode?a.fontWeight:a.fontStyle,n.isLikelyNode?a.fontStyle:a.fontWeight,c?this.CACHE_FONT_SIZE+"px":a.fontSize+"px",f].join(" ")},render:function(o){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",o)))},_splitTextIntoLines:function(o){for(var c=o.split(this._reNewline),a=new Array(c.length),d=[`
`],p=[],f=0;f<c.length;f++)a[f]=n.util.string.graphemeSplit(c[f]),p=p.concat(a[f],d);return p.pop(),{_unwrappedLines:a,lines:c,graphemeText:p,graphemeLines:a}},toObject:function(o){var c=u.concat(o),a=this.callSuper("toObject",c);return a.styles=n.util.stylesToArray(this.styles,this.text),a.path&&(a.path=this.path.toObject()),a},set:function(o,c){this.callSuper("set",o,c);var a=!1,d=!1;if(typeof o=="object")for(var p in o)p==="path"&&this.setPathInfo(),a=a||this._dimensionAffectingProps.indexOf(p)!==-1,d=d||p==="path";else a=this._dimensionAffectingProps.indexOf(o)!==-1,d=o==="path";return d&&this.setPathInfo(),a&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),n.Text.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),n.Text.DEFAULT_SVG_FONT_SIZE=16,n.Text.fromElement=function(o,c,a){if(!o)return c(null);var d=n.parseAttributes(o,n.Text.ATTRIBUTE_NAMES),p=d.textAnchor||"left";if(a=n.util.object.extend(a?l(a):{},d),a.top=a.top||0,a.left=a.left||0,d.textDecoration){var f=d.textDecoration;f.indexOf("underline")!==-1&&(a.underline=!0),f.indexOf("overline")!==-1&&(a.overline=!0),f.indexOf("line-through")!==-1&&(a.linethrough=!0),delete a.textDecoration}"dx"in d&&(a.left+=d.dx),"dy"in d&&(a.top+=d.dy),"fontSize"in a||(a.fontSize=n.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in o?v=o.textContent:"firstChild"in o&&o.firstChild!==null&&"data"in o.firstChild&&o.firstChild.data!==null&&(v=o.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=a.strokeWidth;a.strokeWidth=0;var b=new n.Text(v,a),y=b.getScaledHeight()/b.height,x=(b.height+b.strokeWidth)*b.lineHeight-b.height,C=x*y,S=b.getScaledHeight()+C,O=0;p==="center"&&(O=b.getScaledWidth()/2),p==="right"&&(O=b.getScaledWidth()),b.set({left:b.left-O,top:b.top-(S-b.fontSize*(.07+b._fontSizeFraction))/b.lineHeight,strokeWidth:typeof _<"u"?_:1}),c(b)},n.Text.fromObject=function(o,c){var a=l(o),d=o.path;return delete a.path,n.Object._fromObject("Text",a,function(p){p.styles=n.util.stylesFromArray(o.styles,o.text),d?n.Object._fromObject("Path",d,function(f){p.set("path",f),c(p)},"path"):c(p)},"text")},n.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],n.util.createAccessors&&n.util.createAccessors(n.Text)}(i),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(r){if(!this.styles||typeof r<"u"&&!this.styles[r])return!0;var n=typeof r>"u"?this.styles:{line:this.styles[r]};for(var l in n)for(var u in n[l])for(var o in n[l][u])return!1;return!0},styleHas:function(r,n){if(!this.styles||!r||r===""||typeof n<"u"&&!this.styles[n])return!1;var l=typeof n>"u"?this.styles:{0:this.styles[n]};for(var u in l)for(var o in l[u])if(typeof l[u][o][r]<"u")return!0;return!1},cleanStyle:function(r){if(!this.styles||!r||r==="")return!1;var n=this.styles,l=0,u,o,c=!0,a=0,d;for(var p in n){u=0;for(var f in n[p]){var d=n[p][f],v=d.hasOwnProperty(r);l++,v?(o?d[r]!==o&&(c=!1):o=d[r],d[r]===this[r]&&delete d[r]):c=!1,Object.keys(d).length!==0?u++:delete n[p][f]}u===0&&delete n[p]}for(var _=0;_<this._textLines.length;_++)a+=this._textLines[_].length;c&&l===a&&(this[r]=o,this.removeStyle(r))},removeStyle:function(r){if(!(!this.styles||!r||r==="")){var n=this.styles,l,u,o;for(u in n){l=n[u];for(o in l)delete l[o][r],Object.keys(l[o]).length===0&&delete l[o];Object.keys(l).length===0&&delete n[u]}}},_extendStyles:function(r,n){var l=this.get2DCursorLocation(r);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),n)},get2DCursorLocation:function(r,n){typeof r>"u"&&(r=this.selectionStart);for(var l=n?this._unwrappedTextLines:this._textLines,u=l.length,o=0;o<u;o++){if(r<=l[o].length)return{lineIndex:o,charIndex:r};r-=l[o].length+this.missingNewlineOffset(o)}return{lineIndex:o-1,charIndex:l[o-1].length<r?l[o-1].length:r}},getSelectionStyles:function(r,n,l){typeof r>"u"&&(r=this.selectionStart||0),typeof n>"u"&&(n=this.selectionEnd||r);for(var u=[],o=r;o<n;o++)u.push(this.getStyleAtPosition(o,l));return u},getStyleAtPosition:function(r,n){var l=this.get2DCursorLocation(r),u=n?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return u||{}},setSelectionStyles:function(r,n,l){typeof n>"u"&&(n=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||n);for(var u=n;u<l;u++)this._extendStyles(u,r);return this._forceClearCache=!0,this},_getStyleDeclaration:function(r,n){var l=this.styles&&this.styles[r];return l?l[n]:null},getCompleteStyleDeclaration:function(r,n){for(var l=this._getStyleDeclaration(r,n)||{},u={},o,c=0;c<this._styleProperties.length;c++)o=this._styleProperties[c],u[o]=typeof l[o]>"u"?this[o]:l[o];return u},_setStyleDeclaration:function(r,n,l){this.styles[r][n]=l},_deleteStyleDeclaration:function(r,n){delete this.styles[r][n]},_getLineStyle:function(r){return!!this.styles[r]},_setLineStyle:function(r){this.styles[r]={}},_deleteLineStyle:function(r){delete this.styles[r]}})}(),function(){function r(n){n.textDecoration&&(n.textDecoration.indexOf("underline")>-1&&(n.underline=!0),n.textDecoration.indexOf("line-through")>-1&&(n.linethrough=!0),n.textDecoration.indexOf("overline")>-1&&(n.overline=!0),delete n.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(n,l){this.callSuper("initialize",n,l),this.initBehavior()},setSelectionStart:function(n){n=Math.max(n,0),this._updateAndFire("selectionStart",n)},setSelectionEnd:function(n){n=Math.min(n,this.text.length),this._updateAndFire("selectionEnd",n)},_updateAndFire:function(n,l){this[n]!==l&&(this._fireSelectionChanged(),this[n]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(n){this.clearContextTop(),this.callSuper("render",n),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(n){this.callSuper("_render",n)},clearContextTop:function(n){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,u=this.canvas.viewportTransform;l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(l),this._clearTextArea(l),n||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var n=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(n,l):this.renderSelection(n,l),l.restore()}},_clearTextArea:function(n){var l=this.width+4,u=this.height+4;n.clearRect(-l/2,-u/2,l,u)},_getCursorBoundaries:function(n){typeof n>"u"&&(n=this.selectionStart);var l=this._getLeftOffset(),u=this._getTopOffset(),o=this._getCursorBoundariesOffsets(n);return{left:l,top:u,leftOffset:o.left,topOffset:o.top}},_getCursorBoundariesOffsets:function(n){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,u,o,c=0,a=0,d,p=this.get2DCursorLocation(n);o=p.charIndex,u=p.lineIndex;for(var f=0;f<u;f++)c+=this.getHeightOfLine(f);l=this._getLineLeftOffset(u);var v=this.__charBounds[u][o];return v&&(a=v.left),this.charSpacing!==0&&o===this._textLines[u].length&&(a-=this._getWidthOfCharSpacing()),d={top:c,left:l+(a>0?a:0)},this.direction==="rtl"&&(d.left*=-1),this.cursorOffsetCache=d,this.cursorOffsetCache},renderCursor:function(n,l){var u=this.get2DCursorLocation(),o=u.lineIndex,c=u.charIndex>0?u.charIndex-1:0,a=this.getValueOfPropertyAt(o,c,"fontSize"),d=this.scaleX*this.canvas.getZoom(),p=this.cursorWidth/d,f=n.topOffset,v=this.getValueOfPropertyAt(o,c,"deltaY");f+=(1-this._fontSizeFraction)*this.getHeightOfLine(o)/this.lineHeight-a*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(n,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(o,c,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(n.left+n.leftOffset-p/2,f+n.top+v,p,a)},renderSelection:function(n,l){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,o=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,c=this.textAlign.indexOf("justify")!==-1,a=this.get2DCursorLocation(u),d=this.get2DCursorLocation(o),p=a.lineIndex,f=d.lineIndex,v=a.charIndex<0?0:a.charIndex,_=d.charIndex<0?0:d.charIndex,b=p;b<=f;b++){var y=this._getLineLeftOffset(b)||0,x=this.getHeightOfLine(b),C=0,S=0,O=0;if(b===p&&(S=this.__charBounds[p][v].left),b>=p&&b<f)O=c&&!this.isEndOfWrapping(b)?this.width:this.getLineWidth(b)||5;else if(b===f)if(_===0)O=this.__charBounds[f][_].left;else{var F=this._getWidthOfCharSpacing();O=this.__charBounds[f][_-1].left+this.__charBounds[f][_-1].width-F}C=x,(this.lineHeight<1||b===f&&this.lineHeight>1)&&(x/=this.lineHeight);var R=n.left+y+S,z=O-S,X=x,J=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",X=1,J=x):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(R=this.width-R-z),l.fillRect(R,n.top+n.topOffset+J,z,X),n.topOffset+=C}},getCurrentCharFontSize:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fontSize")},getCurrentCharColor:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fill")},_getCurrentCharIndex:function(){var n=this.get2DCursorLocation(this.selectionStart,!0),l=n.charIndex>0?n.charIndex-1:0;return{l:n.lineIndex,c:l}}}),t.IText.fromObject=function(n,l){var u=t.util.stylesFromArray(n.styles,n.text),o=Object.assign({},n,{styles:u});if(r(o),o.styles)for(var c in o.styles)for(var a in o.styles[c])r(o.styles[c][a]);t.Object._fromObject("IText",o,l,"text")}}(),function(){var r=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var n=this;this.on("added",function(){var l=n.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,n._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){var l=n.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,n),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,n._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(n){n._mouseUpITextHandler=function(){n._iTextInstances&&n._iTextInstances.forEach(function(l){l.__isMousedown=!1})},n.on("mouse:up",n._mouseUpITextHandler)},_removeCanvasHandlers:function(n){n.off("mouse:up",n._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,l,u,o){var c;return c={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",l,{duration:u,onComplete:function(){c.isAborted||n[o]()},onChange:function(){n.canvas&&n.selectionStart===n.selectionEnd&&n.renderCursorOrSelection()},abort:function(){return c.isAborted}}),c},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var l=this,u=n?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},u)},abortCursorAnimation:function(){var n=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,n&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(n){var l=0,u=n-1;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u--;for(;/\S/.test(this._text[u])&&u>-1;)l++,u--;return n-l},findWordBoundaryRight:function(n){var l=0,u=n;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u++;for(;/\S/.test(this._text[u])&&u<this._text.length;)l++,u++;return n+l},findLineBoundaryLeft:function(n){for(var l=0,u=n-1;!/\n/.test(this._text[u])&&u>-1;)l++,u--;return n-l},findLineBoundaryRight:function(n){for(var l=0,u=n;!/\n/.test(this._text[u])&&u<this._text.length;)l++,u++;return n+l},searchWordBoundary:function(n,l){for(var u=this._text,o=this._reSpace.test(u[n])?n-1:n,c=u[o],a=t.reNonWord;!a.test(c)&&o>0&&o<u.length;)o+=l,c=u[o];return a.test(c)&&(o+=l===1?0:1),o},selectWord:function(n){n=n||this.selectionStart;var l=this.searchWordBoundary(n,-1),u=this.searchWordBoundary(n,1);this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(n){n=n||this.selectionStart;var l=this.findLineBoundaryLeft(n),u=this.findLineBoundaryRight(n);return this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(n){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(n),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(n){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(n.e),u=this.selectionStart,o=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||u===o)&&(u===l||o===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==u||this.selectionEnd!==o)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(n,l,u){var o=u.slice(0,n),c=t.util.string.graphemeSplit(o).length;if(n===l)return{selectionStart:c,selectionEnd:c};var a=u.slice(n,l),d=t.util.string.graphemeSplit(a).length;return{selectionStart:c,selectionEnd:c+d}},fromGraphemeToStringSelection:function(n,l,u){var o=u.slice(0,n),c=o.join("").length;if(n===l)return{selectionStart:c,selectionEnd:c};var a=u.slice(n,l),d=a.join("").length;return{selectionStart:c,selectionEnd:c+d}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var n=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=n.selectionStart,this.hiddenTextarea.selectionEnd=n.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var n=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=n.selectionEnd,this.inCompositionMode||(this.selectionStart=n.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var n=this._calcTextareaPosition();this.hiddenTextarea.style.left=n.left,this.hiddenTextarea.style.top=n.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var n=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(n),u=this.get2DCursorLocation(n),o=u.lineIndex,c=u.charIndex,a=this.getValueOfPropertyAt(o,c,"fontSize")*this.lineHeight,d=l.leftOffset,p=this.calcTransformMatrix(),f={x:l.left+d,y:l.top+l.topOffset+a},v=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,b=_.width/v,y=_.height/v,x=b-a,C=y-a,S=_.clientWidth/b,O=_.clientHeight/y;return f=t.util.transformPoint(f,p),f=t.util.transformPoint(f,this.canvas.viewportTransform),f.x*=S,f.y*=O,f.x<0&&(f.x=0),f.x>x&&(f.x=x),f.y<0&&(f.y=0),f.y>C&&(f.y=C),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:f.x+"px",top:f.y+"px",fontSize:a+"px",charHeight:a}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var n=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),n&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),n&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},removeStyleFromTo:function(n,l){var u=this.get2DCursorLocation(n,!0),o=this.get2DCursorLocation(l,!0),c=u.lineIndex,a=u.charIndex,d=o.lineIndex,p=o.charIndex,f,v;if(c!==d){if(this.styles[c])for(f=a;f<this._unwrappedTextLines[c].length;f++)delete this.styles[c][f];if(this.styles[d])for(f=p;f<this._unwrappedTextLines[d].length;f++)v=this.styles[d][f],v&&(this.styles[c]||(this.styles[c]={}),this.styles[c][a+f-p]=v);for(f=c+1;f<=d;f++)delete this.styles[f];this.shiftLineStyles(d,c-d)}else if(this.styles[c]){v=this.styles[c];var _=p-a,b,y;for(f=a;f<p;f++)delete v[f];for(y in this.styles[c])b=parseInt(y,10),b>=p&&(v[b-_]=v[y],delete v[y])}},shiftLineStyles:function(n,l){var u=r(this.styles);for(var o in this.styles){var c=parseInt(o,10);c>n&&(this.styles[c+l]=u[c],u[c-l]||delete this.styles[c])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(n,l,u,o){var c,a={},d=!1,p=this._unwrappedTextLines[n].length===l;u||(u=1),this.shiftLineStyles(n,u),this.styles[n]&&(c=this.styles[n][l===0?l:l-1]);for(var f in this.styles[n]){var v=parseInt(f,10);v>=l&&(d=!0,a[v-l]=this.styles[n][f],p&&l===0||delete this.styles[n][f])}var _=!1;for(d&&!p&&(this.styles[n+u]=a,_=!0),_&&u--;u>0;)o&&o[u-1]?this.styles[n+u]={0:r(o[u-1])}:c?this.styles[n+u]={0:r(c)}:delete this.styles[n+u],u--;this._forceClearCache=!0},insertCharStyleObject:function(n,l,u,o){this.styles||(this.styles={});var c=this.styles[n],a=c?r(c):{};u||(u=1);for(var d in a){var p=parseInt(d,10);p>=l&&(c[p+u]=a[p],a[p-u]||delete c[p])}if(this._forceClearCache=!0,o){for(;u--;)Object.keys(o[u]).length&&(this.styles[n]||(this.styles[n]={}),this.styles[n][l+u]=r(o[u]));return}if(c)for(var f=c[l?l-1:1];f&&u--;)this.styles[n][l+u]=r(f)},insertNewStyleBlock:function(n,l,u){for(var o=this.get2DCursorLocation(l,!0),c=[0],a=0,d=0;d<n.length;d++)n[d]===`
`?(a++,c[a]=0):c[a]++;c[0]>0&&(this.insertCharStyleObject(o.lineIndex,o.charIndex,c[0],u),u=u&&u.slice(c[0]+1)),a&&this.insertNewlineStyleObject(o.lineIndex,o.charIndex+c[0],a);for(var d=1;d<a;d++)c[d]>0?this.insertCharStyleObject(o.lineIndex+d,0,c[d],u):u&&this.styles[o.lineIndex+d]&&u[0]&&(this.styles[o.lineIndex+d][0]=u[0]),u=u&&u.slice(c[d]+1);c[d]>0&&this.insertCharStyleObject(o.lineIndex+d,0,c[d],u)},setSelectionStartEndWithShift:function(n,l,u){u<=n?(l===n?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=n),this.selectionStart=u):u>n&&u<l?this._selectionDirection==="right"?this.selectionEnd=u:this.selectionStart=u:(l===n?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=u)},setSelectionInBoundaries:function(){var n=this.text.length;this.selectionStart>n?this.selectionStart=n:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>n?this.selectionEnd=n:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(r){if(this.canvas){this.__newClickTime=+new Date;var n=r.pointer;this.isTripleClick(n)&&(this.fire("tripleclick",r),this._stopEvent(r.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=n,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(r){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===r.x&&this.__lastPointer.y===r.y},_stopEvent:function(r){r.preventDefault&&r.preventDefault(),r.stopPropagation&&r.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(r){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(r.e))},tripleClickHandler:function(r){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(r.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(r){!this.canvas||!this.editable||r.e.button&&r.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(r.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(r){!this.canvas||!this.editable||r.e.button&&r.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(r){if(this.__isMousedown=!1,!(!this.editable||this.group||r.transform&&r.transform.actionPerformed||r.e.button&&r.e.button!==1)){if(this.canvas){var n=this.canvas._activeObject;if(n&&n!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(r.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(r){var n=this.getSelectionStartFromPointer(r),l=this.selectionStart,u=this.selectionEnd;r.shiftKey?this.setSelectionStartEndWithShift(l,u,n):(this.selectionStart=n,this.selectionEnd=n),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(r){for(var n=this.getLocalPointer(r),l=0,u=0,o=0,c=0,a=0,d,p,f=0,v=this._textLines.length;f<v&&o<=n.y;f++)o+=this.getHeightOfLine(f)*this.scaleY,a=f,f>0&&(c+=this._textLines[f-1].length+this.missingNewlineOffset(f-1));d=this._getLineLeftOffset(a),u=d*this.scaleX,p=this._textLines[a],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+u);for(var _=0,b=p.length;_<b&&(l=u,u+=this.__charBounds[a][_].kernedWidth*this.scaleX,u<=n.x);_++)c++;return this._getNewSelectionStartFromOffset(n,l,u,c,b)},_getNewSelectionStartFromOffset:function(r,n,l,u,o){var c=r.x-n,a=l-r.x,d=a>c||a<0?0:1,p=u+d;return this.flipX&&(p=o-p),p>this._text.length&&(p=this._text.length),p}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var r=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+r.top+"; left: "+r.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+r.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(r){if(this.isEditing){var n=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(r.keyCode in n)this[n[r.keyCode]](r);else if(r.keyCode in this.ctrlKeysMapDown&&(r.ctrlKey||r.metaKey))this[this.ctrlKeysMapDown[r.keyCode]](r);else return;r.stopImmediatePropagation(),r.preventDefault(),r.keyCode>=33&&r.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(r){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(r.keyCode in this.ctrlKeysMapUp&&(r.ctrlKey||r.metaKey))this[this.ctrlKeysMapUp[r.keyCode]](r);else return;r.stopImmediatePropagation(),r.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(r){var n=this.fromPaste;if(this.fromPaste=!1,r&&r.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,u=this._text.length,o=l.length,c,a,d=o-u,p=this.selectionStart,f=this.selectionEnd,v=p!==f,_,b,y;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var x=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=p>x.selectionStart;v?(c=this._text.slice(p,f),d+=f-p):o<u&&(C?c=this._text.slice(f+d,f):c=this._text.slice(p,p-d)),a=l.slice(x.selectionEnd-d,x.selectionEnd),c&&c.length&&(a.length&&(_=this.getSelectionStyles(p,p+1,!1),_=a.map(function(){return _[0]})),v?(b=p,y=f):C?(b=f-c.length,y=f):(b=f,y=f+c.length),this.removeStyleFromTo(b,y)),a.length&&(n&&a.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(_=t.copiedTextStyle),this.insertNewStyleBlock(a,p,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(r){this.compositionStart=r.target.selectionStart,this.compositionEnd=r.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(r){return r&&r.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(r,n){var l=this._getLineLeftOffset(r),u;return n>0&&(u=this.__charBounds[r][n-1],l+=u.left+u.width),l},getDownCursorOffset:function(r,n){var l=this._getSelectionForOffset(r,n),u=this.get2DCursorLocation(l),o=u.lineIndex;if(o===this._textLines.length-1||r.metaKey||r.keyCode===34)return this._text.length-l;var c=u.charIndex,a=this._getWidthBeforeCursor(o,c),d=this._getIndexOnLine(o+1,a),p=this._textLines[o].slice(c);return p.length+d+1+this.missingNewlineOffset(o)},_getSelectionForOffset:function(r,n){return r.shiftKey&&this.selectionStart!==this.selectionEnd&&n?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(r,n){var l=this._getSelectionForOffset(r,n),u=this.get2DCursorLocation(l),o=u.lineIndex;if(o===0||r.metaKey||r.keyCode===33)return-l;var c=u.charIndex,a=this._getWidthBeforeCursor(o,c),d=this._getIndexOnLine(o-1,a),p=this._textLines[o].slice(0,c),f=this.missingNewlineOffset(o-1);return-this._textLines[o-1].length+d-p.length+(1-f)},_getIndexOnLine:function(r,n){for(var l=this._textLines[r],u=this._getLineLeftOffset(r),o=u,c=0,a,d,p=0,f=l.length;p<f;p++)if(a=this.__charBounds[r][p].width,o+=a,o>n){d=!0;var v=o-a,_=o,b=Math.abs(v-n),y=Math.abs(_-n);c=y<b?p:p-1;break}return d||(c=l.length-1),c},moveCursorDown:function(r){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",r)},moveCursorUp:function(r){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",r)},_moveCursorUpOrDown:function(r,n){var l="get"+r+"CursorOffset",u=this[l](n,this._selectionDirection==="right");n.shiftKey?this.moveCursorWithShift(u):this.moveCursorWithoutShift(u),u!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(r){var n=this._selectionDirection==="left"?this.selectionStart+r:this.selectionEnd+r;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,n),r!==0},moveCursorWithoutShift:function(r){return r<0?(this.selectionStart+=r,this.selectionEnd=this.selectionStart):(this.selectionEnd+=r,this.selectionStart=this.selectionEnd),r!==0},moveCursorLeft:function(r){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",r)},_move:function(r,n,l){var u;if(r.altKey)u=this["findWordBoundary"+l](this[n]);else if(r.metaKey||r.keyCode===35||r.keyCode===36)u=this["findLineBoundary"+l](this[n]);else return this[n]+=l==="Left"?-1:1,!0;if(typeof u<"u"&&this[n]!==u)return this[n]=u,!0},_moveLeft:function(r,n){return this._move(r,n,"Left")},_moveRight:function(r,n){return this._move(r,n,"Right")},moveCursorLeftWithoutShift:function(r){var n=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(n=this._moveLeft(r,"selectionStart")),this.selectionEnd=this.selectionStart,n},moveCursorLeftWithShift:function(r){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(r,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(r,"selectionStart")},moveCursorRight:function(r){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",r)},_moveCursorLeftOrRight:function(r,n){var l="moveCursor"+r+"With";this._currentCursorOpacity=1,n.shiftKey?l+="Shift":l+="outShift",this[l](n)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(r){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(r,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(r,"selectionEnd")},moveCursorRightWithoutShift:function(r){var n=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(n=this._moveRight(r,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,n},removeChars:function(r,n){typeof n>"u"&&(n=r+1),this.removeStyleFromTo(r,n),this._text.splice(r,n-r),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(r,n,l,u){typeof u>"u"&&(u=l),u>l&&this.removeStyleFromTo(l,u);var o=t.util.string.graphemeSplit(r);this.insertNewStyleBlock(o,l,n),this._text=[].concat(this._text.slice(0,l),o,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var r=t.util.toFixed,n=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=!0,o=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",o?'text-decoration="'+o+'" ':"",'style="',this.getSvgStyles(u),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var o=[],c=[],a=l,d;this._setSVGBg(c);for(var p=0,f=this._textLines.length;p<f;p++)d=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(c,p,u+d,a),this._setSVGTextLineText(o,p,u+d,a),a+=this.getHeightOfLine(p);return{textSpans:o,textBgRects:c}},_createTextCharSpan:function(l,u,o,c){var a=l!==l.trim()||l.match(n),d=this.getSvgSpanStyles(u,a),p=d?'style="'+d+'"':"",f=u.deltaY,v="",_=t.Object.NUM_FRACTION_DIGITS;return f&&(v=' dy="'+r(f,_)+'" '),['<tspan x="',r(o,_),'" y="',r(c,_),'" ',v,p,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,o,c){var a=this.getHeightOfLine(u),d=this.textAlign.indexOf("justify")!==-1,p,f,v="",_,b,y=0,x=this._textLines[u],C;c+=a*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,O=x.length-1;S<=O;S++)C=S===O||this.charSpacing,v+=x[S],_=this.__charBounds[u][S],y===0?(o+=_.kernedWidth-_.width,y+=_.width):y+=_.kernedWidth,d&&!C&&this._reSpaceAndTab.test(x[S])&&(C=!0),C||(p=p||this.getCompleteStyleDeclaration(u,S),f=this.getCompleteStyleDeclaration(u,S+1),C=t.util.hasStyleChanged(p,f,!0)),C&&(b=this._getStyleDeclaration(u,S)||{},l.push(this._createTextCharSpan(v,b,o,c)),v="",p=f,o+=y,y=0)},_pushTextBgRect:function(l,u,o,c,a,d){var p=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',r(o,p),'" y="',r(c,p),'" width="',r(a,p),'" height="',r(d,p),`"></rect>
`)},_setSVGTextLineBg:function(l,u,o,c){for(var a=this._textLines[u],d=this.getHeightOfLine(u)/this.lineHeight,p=0,f=0,v,_,b=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),y=0,x=a.length;y<x;y++)v=this.__charBounds[u][y],_=this.getValueOfPropertyAt(u,y,"textBackgroundColor"),_!==b?(b&&this._pushTextBgRect(l,b,o+f,c,p,d),f=v.left,p=v.width,b=_):p+=v.kernedWidth;_&&this._pushTextBgRect(l,_,o+f,c,p,d)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new t.Color(l):"";return!u||!u.getSource()||u.getAlpha()===1?'fill="'+l+'"':'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var u=0,o=0,c=0;c<l;c++)u+=this.getHeightOfLine(c);return o=this.getHeightOfLine(c),{lineTop:u,offset:(this._fontSizeMult-this._fontSizeFraction)*o/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var u=t.Object.prototype.getSvgStyles.call(this,l);return u+" white-space: pre;"}})}(),function(r){var n=r.fabric||(r.fabric={});n.Textbox=n.util.createClass(n.IText,n.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:n.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var u=0,o=0,c=0,a={},d=0;d<l.graphemeLines.length;d++)l.graphemeText[c]===`
`&&d>0?(o=0,c++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[c])&&d>0&&(o++,c++),a[d]={line:u,offset:o},c+=l.graphemeLines[d].length,o+=l.graphemeLines[d].length;return a},styleHas:function(l,u){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[u];o&&(u=o.line)}return n.Text.prototype.styleHas.call(this,l,u)},isEmptyStyles:function(l){if(!this.styles)return!0;var u=0,o=l+1,c,a,d=!1,p=this._styleMap[l],f=this._styleMap[l+1];p&&(l=p.line,u=p.offset),f&&(o=f.line,d=o===l,c=f.offset),a=typeof l>"u"?this.styles:{line:this.styles[l]};for(var v in a)for(var _ in a[v])if(_>=u&&(!d||_<c))for(var b in a[v][_])return!1;return!0},_getStyleDeclaration:function(l,u){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[l];if(!o)return null;l=o.line,u=o.offset+u}return this.callSuper("_getStyleDeclaration",l,u)},_setStyleDeclaration:function(l,u,o){var c=this._styleMap[l];l=c.line,u=c.offset+u,this.styles[l][u]=o},_deleteStyleDeclaration:function(l,u){var o=this._styleMap[l];l=o.line,u=o.offset+u,delete this.styles[l][u]},_getLineStyle:function(l){var u=this._styleMap[l];return!!this.styles[u.line]},_setLineStyle:function(l){var u=this._styleMap[l];this.styles[u.line]={}},_wrapText:function(l,u){var o=[],c;for(this.isWrapping=!0,c=0;c<l.length;c++)o=o.concat(this._wrapLine(l[c],c,u));return this.isWrapping=!1,o},_measureWord:function(l,u,o){var c=0,a,d=!0;o=o||0;for(var p=0,f=l.length;p<f;p++){var v=this._getGraphemeBox(l[p],u,p+o,a,d);c+=v.kernedWidth,a=l[p]}return c},_wrapLine:function(l,u,o,R){var a=0,d=this.splitByGrapheme,p=[],f=[],v=d?n.util.string.graphemeSplit(l):l.split(this._wordJoiners),_="",b=0,y=d?"":" ",x=0,C=0,S=0,O=!0,F=this._getWidthOfCharSpacing(),R=R||0;v.length===0&&v.push([]),o-=R;for(var z=0;z<v.length;z++)_=d?v[z]:n.util.string.graphemeSplit(v[z]),x=this._measureWord(_,u,b),b+=_.length,a+=C+x-F,a>o&&!O?(p.push(f),f=[],a=x,O=!0):a+=F,!O&&!d&&f.push(y),f=f.concat(_),C=d?0:this._measureWord([y],u,b),b++,O=!1,x>S&&(S=x);return z&&p.push(f),S+R>this.dynamicMinWidth&&(this.dynamicMinWidth=S-F+R),p},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var u=n.Text.prototype._splitTextIntoLines.call(this,l),o=this._wrapText(u.lines,this.width),c=new Array(o.length),a=0;a<o.length;a++)c[a]=o[a].join("");return u.lines=c,u.graphemeLines=o,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var u in this._styleMap)this._textLines[u]&&(l[this._styleMap[u].line]=1);for(var u in this.styles)l[u]||delete this.styles[u]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),n.Textbox.fromObject=function(l,u){var o=n.util.stylesFromArray(l.styles,l.text),c=Object.assign({},l,{styles:o});return n.Object._fromObject("Textbox",c,u,"text")}}(i),function(){var r=t.controlsUtils,n=r.scaleSkewCursorStyleHandler,l=r.scaleCursorStyleHandler,u=r.scalingEqually,o=r.scalingYOrSkewingX,c=r.scalingXOrSkewingY,a=r.scaleOrSkewActionName,d=t.Object.prototype.controls;if(d.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:n,actionHandler:c,getActionName:a}),d.mr=new t.Control({x:.5,y:0,cursorStyleHandler:n,actionHandler:c,getActionName:a}),d.mb=new t.Control({x:0,y:.5,cursorStyleHandler:n,actionHandler:o,getActionName:a}),d.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:n,actionHandler:o,getActionName:a}),d.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),d.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),d.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:u}),d.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:u}),d.mtr=new t.Control({x:0,y:-.5,actionHandler:r.rotationWithSnapping,cursorStyleHandler:r.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var p=t.Textbox.prototype.controls={};p.mtr=d.mtr,p.tr=d.tr,p.br=d.br,p.tl=d.tl,p.bl=d.bl,p.mt=d.mt,p.mb=d.mb,p.mr=new t.Control({x:.5,y:0,actionHandler:r.changeWidth,cursorStyleHandler:n,actionName:"resizing"}),p.ml=new t.Control({x:-.5,y:0,actionHandler:r.changeWidth,cursorStyleHandler:n,actionName:"resizing"})}}()})(Ir);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function bi(i){return i+.5|0}const oe=(i,t,e)=>Math.max(Math.min(i,e),t);function Ue(i){return oe(bi(i*2.55),0,255)}function ce(i){return oe(bi(i*255),0,255)}function te(i){return oe(bi(i/2.55)/100,0,1)}function hs(i){return oe(bi(i*100),0,100)}const Wt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Tn=[..."0123456789ABCDEF"],ua=i=>Tn[i&15],fa=i=>Tn[(i&240)>>4]+Tn[i&15],Ci=i=>(i&240)>>4===(i&15),da=i=>Ci(i.r)&&Ci(i.g)&&Ci(i.b)&&Ci(i.a);function ga(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&Wt[i[1]]*17,g:255&Wt[i[2]]*17,b:255&Wt[i[3]]*17,a:t===5?Wt[i[4]]*17:255}:(t===7||t===9)&&(e={r:Wt[i[1]]<<4|Wt[i[2]],g:Wt[i[3]]<<4|Wt[i[4]],b:Wt[i[5]]<<4|Wt[i[6]],a:t===9?Wt[i[7]]<<4|Wt[i[8]]:255})),e}const pa=(i,t)=>i<255?t(i):"";function ma(i){var t=da(i)?ua:fa;return i?"#"+t(i.r)+t(i.g)+t(i.b)+pa(i.a,t):void 0}const va=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Br(i,t,e){const s=t*Math.min(e,1-e),h=(g,m=(g+i/30)%12)=>e-s*Math.max(Math.min(m-3,9-m,1),-1);return[h(0),h(8),h(4)]}function _a(i,t,e){const s=(h,g=(h+i/60)%6)=>e-e*t*Math.max(Math.min(g,4-g,1),0);return[s(5),s(3),s(1)]}function ba(i,t,e){const s=Br(i,1,.5);let h;for(t+e>1&&(h=1/(t+e),t*=h,e*=h),h=0;h<3;h++)s[h]*=1-t-e,s[h]+=t;return s}function ya(i,t,e,s,h){return i===h?(t-e)/s+(t<e?6:0):t===h?(e-i)/s+2:(i-t)/s+4}function Vn(i){const e=i.r/255,s=i.g/255,h=i.b/255,g=Math.max(e,s,h),m=Math.min(e,s,h),r=(g+m)/2;let n,l,u;return g!==m&&(u=g-m,l=r>.5?u/(2-g-m):u/(g+m),n=ya(e,s,h,u,g),n=n*60+.5),[n|0,l||0,r]}function Xn(i,t,e,s){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,s)).map(ce)}function Yn(i,t,e){return Xn(Br,i,t,e)}function xa(i,t,e){return Xn(ba,i,t,e)}function Ca(i,t,e){return Xn(_a,i,t,e)}function jr(i){return(i%360+360)%360}function Sa(i){const t=va.exec(i);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?Ue(+t[5]):ce(+t[5]));const h=jr(+t[2]),g=+t[3]/100,m=+t[4]/100;return t[1]==="hwb"?s=xa(h,g,m):t[1]==="hsv"?s=Ca(h,g,m):s=Yn(h,g,m),{r:s[0],g:s[1],b:s[2],a:e}}function wa(i,t){var e=Vn(i);e[0]=jr(e[0]+t),e=Yn(e),i.r=e[0],i.g=e[1],i.b=e[2]}function Ta(i){if(!i)return;const t=Vn(i),e=t[0],s=hs(t[1]),h=hs(t[2]);return i.a<255?`hsla(${e}, ${s}%, ${h}%, ${te(i.a)})`:`hsl(${e}, ${s}%, ${h}%)`}const cs={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},us={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Oa(){const i={},t=Object.keys(us),e=Object.keys(cs);let s,h,g,m,r;for(s=0;s<t.length;s++){for(m=r=t[s],h=0;h<e.length;h++)g=e[h],r=r.replace(g,cs[g]);g=parseInt(us[m],16),i[r]=[g>>16&255,g>>8&255,g&255]}return i}let Si;function ka(i){Si||(Si=Oa(),Si.transparent=[0,0,0,0]);const t=Si[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Pa=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Ma(i){const t=Pa.exec(i);let e=255,s,h,g;if(t){if(t[7]!==s){const m=+t[7];e=t[8]?Ue(m):oe(m*255,0,255)}return s=+t[1],h=+t[3],g=+t[5],s=255&(t[2]?Ue(s):oe(s,0,255)),h=255&(t[4]?Ue(h):oe(h,0,255)),g=255&(t[6]?Ue(g):oe(g,0,255)),{r:s,g:h,b:g,a:e}}}function Da(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${te(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const un=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,Ae=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function Aa(i,t,e){const s=Ae(te(i.r)),h=Ae(te(i.g)),g=Ae(te(i.b));return{r:ce(un(s+e*(Ae(te(t.r))-s))),g:ce(un(h+e*(Ae(te(t.g))-h))),b:ce(un(g+e*(Ae(te(t.b))-g))),a:i.a+e*(t.a-i.a)}}function wi(i,t,e){if(i){let s=Vn(i);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=Yn(s),i.r=s[0],i.g=s[1],i.b=s[2]}}function zr(i,t){return i&&Object.assign(t||{},i)}function fs(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=ce(i[3]))):(t=zr(i,{r:0,g:0,b:0,a:1}),t.a=ce(t.a)),t}function Ea(i){return i.charAt(0)==="r"?Ma(i):Sa(i)}class oi{constructor(t){if(t instanceof oi)return t;const e=typeof t;let s;e==="object"?s=fs(t):e==="string"&&(s=ga(t)||ka(t)||Ea(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=zr(this._rgb);return t&&(t.a=te(t.a)),t}set rgb(t){this._rgb=fs(t)}rgbString(){return this._valid?Da(this._rgb):void 0}hexString(){return this._valid?ma(this._rgb):void 0}hslString(){return this._valid?Ta(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,h=t.rgb;let g;const m=e===g?.5:e,r=2*m-1,n=s.a-h.a,l=((r*n===-1?r:(r+n)/(1+r*n))+1)/2;g=1-l,s.r=255&l*s.r+g*h.r+.5,s.g=255&l*s.g+g*h.g+.5,s.b=255&l*s.b+g*h.b+.5,s.a=m*s.a+(1-m)*h.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=Aa(this._rgb,t._rgb,e)),this}clone(){return new oi(this.rgb)}alpha(t){return this._rgb.a=ce(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=bi(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return wi(this._rgb,2,t),this}darken(t){return wi(this._rgb,2,-t),this}saturate(t){return wi(this._rgb,1,t),this}desaturate(t){return wi(this._rgb,1,-t),this}rotate(t){return wa(this._rgb,t),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function Jt(){}const Fa=(()=>{let i=0;return()=>i++})();function dt(i){return i===null||typeof i>"u"}function bt(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function ht(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function St(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function Bt(i,t){return St(i)?i:t}function lt(i,t){return typeof i>"u"?t:i}const La=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,Wr=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function vt(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function pt(i,t,e,s){let h,g,m;if(bt(i))if(g=i.length,s)for(h=g-1;h>=0;h--)t.call(e,i[h],h);else for(h=0;h<g;h++)t.call(e,i[h],h);else if(ht(i))for(m=Object.keys(i),g=m.length,h=0;h<g;h++)t.call(e,i[m[h]],m[h])}function $i(i,t){let e,s,h,g;if(!i||!t||i.length!==t.length)return!1;for(e=0,s=i.length;e<s;++e)if(h=i[e],g=t[e],h.datasetIndex!==g.datasetIndex||h.index!==g.index)return!1;return!0}function qi(i){if(bt(i))return i.map(qi);if(ht(i)){const t=Object.create(null),e=Object.keys(i),s=e.length;let h=0;for(;h<s;++h)t[e[h]]=qi(i[e[h]]);return t}return i}function Hr(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function Ra(i,t,e,s){if(!Hr(i))return;const h=t[i],g=e[i];ht(h)&&ht(g)?ai(h,g,s):t[i]=qi(g)}function ai(i,t,e){const s=bt(t)?t:[t],h=s.length;if(!ht(i))return i;e=e||{};const g=e.merger||Ra;let m;for(let r=0;r<h;++r){if(m=s[r],!ht(m))continue;const n=Object.keys(m);for(let l=0,u=n.length;l<u;++l)g(n[l],i,m,e)}return i}function Ze(i,t){return ai(i,t,{merger:Ia})}function Ia(i,t,e){if(!Hr(i))return;const s=t[i],h=e[i];ht(s)&&ht(h)?Ze(s,h):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=qi(h))}const ds={"":i=>i,x:i=>i.x,y:i=>i.y};function Ba(i){const t=i.split("."),e=[];let s="";for(const h of t)s+=h,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function ja(i){const t=Ba(i);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function ue(i,t){return(ds[t]||(ds[t]=ja(t)))(i)}function Un(i){return i.charAt(0).toUpperCase()+i.slice(1)}const li=i=>typeof i<"u",fe=i=>typeof i=="function",gs=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function za(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const xt=Math.PI,yt=2*xt,Wa=yt+xt,Ki=Number.POSITIVE_INFINITY,Ha=xt/180,Tt=xt/2,me=xt/4,ps=xt*2/3,ae=Math.log10,qt=Math.sign;function ti(i,t,e){return Math.abs(i-t)<e}function ms(i){const t=Math.round(i);i=ti(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(ae(i))),s=i/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function Na(i){const t=[],e=Math.sqrt(i);let s;for(s=1;s<e;s++)i%s===0&&(t.push(s),t.push(i/s));return e===(e|0)&&t.push(e),t.sort((h,g)=>h-g).pop(),t}function Be(i){return!isNaN(parseFloat(i))&&isFinite(i)}function Va(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function Nr(i,t,e){let s,h,g;for(s=0,h=i.length;s<h;s++)g=i[s][e],isNaN(g)||(t.min=Math.min(t.min,g),t.max=Math.max(t.max,g))}function Vt(i){return i*(xt/180)}function Gn(i){return i*(180/xt)}function vs(i){if(!St(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function Vr(i,t){const e=t.x-i.x,s=t.y-i.y,h=Math.sqrt(e*e+s*s);let g=Math.atan2(s,e);return g<-.5*xt&&(g+=yt),{angle:g,distance:h}}function On(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function Xa(i,t){return(i-t+Wa)%yt-xt}function jt(i){return(i%yt+yt)%yt}function hi(i,t,e,s){const h=jt(i),g=jt(t),m=jt(e),r=jt(g-h),n=jt(m-h),l=jt(h-g),u=jt(h-m);return h===g||h===m||s&&g===m||r>n&&l<u}function Pt(i,t,e){return Math.max(t,Math.min(e,i))}function Ya(i){return Pt(i,-32768,32767)}function ee(i,t,e,s=1e-6){return i>=Math.min(t,e)-s&&i<=Math.max(t,e)+s}function $n(i,t,e){e=e||(m=>i[m]<t);let s=i.length-1,h=0,g;for(;s-h>1;)g=h+s>>1,e(g)?h=g:s=g;return{lo:h,hi:s}}const ie=(i,t,e,s)=>$n(i,e,s?h=>{const g=i[h][t];return g<e||g===e&&i[h+1][t]===e}:h=>i[h][t]<e),Ua=(i,t,e)=>$n(i,e,s=>i[s][t]>=e);function Ga(i,t,e){let s=0,h=i.length;for(;s<h&&i[s]<t;)s++;for(;h>s&&i[h-1]>e;)h--;return s>0||h<i.length?i.slice(s,h):i}const Xr=["push","pop","shift","splice","unshift"];function $a(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Xr.forEach(e=>{const s="_onData"+Un(e),h=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...g){const m=h.apply(this,g);return i._chartjs.listeners.forEach(r=>{typeof r[s]=="function"&&r[s](...g)}),m}})})}function _s(i,t){const e=i._chartjs;if(!e)return;const s=e.listeners,h=s.indexOf(t);h!==-1&&s.splice(h,1),!(s.length>0)&&(Xr.forEach(g=>{delete i[g]}),delete i._chartjs)}function Yr(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const Ur=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function Gr(i,t){let e=[],s=!1;return function(...h){e=h,s||(s=!0,Ur.call(window,()=>{s=!1,i.apply(t,e)}))}}function qa(i,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(i,t,s)):i.apply(this,s),t}}const qn=i=>i==="start"?"left":i==="end"?"right":"center",Mt=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2,Ka=(i,t,e,s)=>i===(s?"left":"right")?e:i==="center"?(t+e)/2:t;function $r(i,t,e){const s=t.length;let h=0,g=s;if(i._sorted){const{iScale:m,_parsed:r}=i,n=m.axis,{min:l,max:u,minDefined:o,maxDefined:c}=m.getUserBounds();o&&(h=Pt(Math.min(ie(r,n,l).lo,e?s:ie(t,n,m.getPixelForValue(l)).lo),0,s-1)),c?g=Pt(Math.max(ie(r,m.axis,u,!0).hi+1,e?0:ie(t,n,m.getPixelForValue(u),!0).hi+1),h,s)-h:g=s-h}return{start:h,count:g}}function qr(i){const{xScale:t,yScale:e,_scaleRanges:s}=i,h={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return i._scaleRanges=h,!0;const g=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,h),g}const Ti=i=>i===0||i===1,bs=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*yt/e)),ys=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*yt/e)+1,ei={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*Tt)+1,easeOutSine:i=>Math.sin(i*Tt),easeInOutSine:i=>-.5*(Math.cos(xt*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>Ti(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>Ti(i)?i:bs(i,.075,.3),easeOutElastic:i=>Ti(i)?i:ys(i,.075,.3),easeInOutElastic(i){return Ti(i)?i:i<.5?.5*bs(i*2,.1125,.45):.5+.5*ys(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-ei.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?ei.easeInBounce(i*2)*.5:ei.easeOutBounce(i*2-1)*.5+.5};function Kn(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function xs(i){return Kn(i)?i:new oi(i)}function fn(i){return Kn(i)?i:new oi(i).saturate(.5).darken(.1).hexString()}const Ja=["x","y","borderWidth","radius","tension"],Qa=["color","borderColor","backgroundColor"];function Za(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:Qa},numbers:{type:"number",properties:Ja}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function tl(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Cs=new Map;function el(i,t){t=t||{};const e=i+JSON.stringify(t);let s=Cs.get(e);return s||(s=new Intl.NumberFormat(i,t),Cs.set(e,s)),s}function yi(i,t,e){return el(t,e).format(i)}const Kr={values(i){return bt(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const s=this.chart.options.locale;let h,g=i;if(e.length>1){const l=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(l<1e-4||l>1e15)&&(h="scientific"),g=il(i,e)}const m=ae(Math.abs(g)),r=isNaN(m)?1:Math.max(Math.min(-1*Math.floor(m),20),0),n={notation:h,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(n,this.options.ticks.format),yi(i,s,n)},logarithmic(i,t,e){if(i===0)return"0";const s=e[t].significand||i/Math.pow(10,Math.floor(ae(i)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?Kr.numeric.call(this,i,t,e):""}};function il(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var sn={formatters:Kr};function nl(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:sn.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ke=Object.create(null),kn=Object.create(null);function ii(i,t){if(!t)return i;const e=t.split(".");for(let s=0,h=e.length;s<h;++s){const g=e[s];i=i[g]||(i[g]=Object.create(null))}return i}function dn(i,t,e){return typeof t=="string"?ai(ii(i,t),e):ai(ii(i,""),t)}class sl{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,h)=>fn(h.backgroundColor),this.hoverBorderColor=(s,h)=>fn(h.borderColor),this.hoverColor=(s,h)=>fn(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return dn(this,t,e)}get(t){return ii(this,t)}describe(t,e){return dn(kn,t,e)}override(t,e){return dn(ke,t,e)}route(t,e,s,h){const g=ii(this,t),m=ii(this,s),r="_"+e;Object.defineProperties(g,{[r]:{value:g[e],writable:!0},[e]:{enumerable:!0,get(){const n=this[r],l=m[h];return ht(n)?Object.assign({},l,n):lt(n,l)},set(n){this[r]=n}}})}apply(t){t.forEach(e=>e(this))}}var wt=new sl({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Za,tl,nl]);function rl(i){return!i||dt(i.size)||dt(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function Ji(i,t,e,s,h){let g=t[h];return g||(g=t[h]=i.measureText(h).width,e.push(h)),g>s&&(s=g),s}function ol(i,t,e,s){s=s||{};let h=s.data=s.data||{},g=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(h=s.data={},g=s.garbageCollect=[],s.font=t),i.save(),i.font=t;let m=0;const r=e.length;let n,l,u,o,c;for(n=0;n<r;n++)if(o=e[n],o!=null&&!bt(o))m=Ji(i,h,g,m,o);else if(bt(o))for(l=0,u=o.length;l<u;l++)c=o[l],c!=null&&!bt(c)&&(m=Ji(i,h,g,m,c));i.restore();const a=g.length/2;if(a>e.length){for(n=0;n<a;n++)delete h[g[n]];g.splice(0,a)}return m}function ve(i,t,e){const s=i.currentDevicePixelRatio,h=e!==0?Math.max(e/2,.5):0;return Math.round((t-h)*s)/s+h}function Ss(i,t){t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore()}function Pn(i,t,e,s){Jr(i,t,e,s,null)}function Jr(i,t,e,s,h){let g,m,r,n,l,u,o,c;const a=t.pointStyle,d=t.rotation,p=t.radius;let f=(d||0)*Ha;if(a&&typeof a=="object"&&(g=a.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){i.save(),i.translate(e,s),i.rotate(f),i.drawImage(a,-a.width/2,-a.height/2,a.width,a.height),i.restore();return}if(!(isNaN(p)||p<=0)){switch(i.beginPath(),a){default:h?i.ellipse(e,s,h/2,p,0,0,yt):i.arc(e,s,p,0,yt),i.closePath();break;case"triangle":u=h?h/2:p,i.moveTo(e+Math.sin(f)*u,s-Math.cos(f)*p),f+=ps,i.lineTo(e+Math.sin(f)*u,s-Math.cos(f)*p),f+=ps,i.lineTo(e+Math.sin(f)*u,s-Math.cos(f)*p),i.closePath();break;case"rectRounded":l=p*.516,n=p-l,m=Math.cos(f+me)*n,o=Math.cos(f+me)*(h?h/2-l:n),r=Math.sin(f+me)*n,c=Math.sin(f+me)*(h?h/2-l:n),i.arc(e-o,s-r,l,f-xt,f-Tt),i.arc(e+c,s-m,l,f-Tt,f),i.arc(e+o,s+r,l,f,f+Tt),i.arc(e-c,s+m,l,f+Tt,f+xt),i.closePath();break;case"rect":if(!d){n=Math.SQRT1_2*p,u=h?h/2:n,i.rect(e-u,s-n,2*u,2*n);break}f+=me;case"rectRot":o=Math.cos(f)*(h?h/2:p),m=Math.cos(f)*p,r=Math.sin(f)*p,c=Math.sin(f)*(h?h/2:p),i.moveTo(e-o,s-r),i.lineTo(e+c,s-m),i.lineTo(e+o,s+r),i.lineTo(e-c,s+m),i.closePath();break;case"crossRot":f+=me;case"cross":o=Math.cos(f)*(h?h/2:p),m=Math.cos(f)*p,r=Math.sin(f)*p,c=Math.sin(f)*(h?h/2:p),i.moveTo(e-o,s-r),i.lineTo(e+o,s+r),i.moveTo(e+c,s-m),i.lineTo(e-c,s+m);break;case"star":o=Math.cos(f)*(h?h/2:p),m=Math.cos(f)*p,r=Math.sin(f)*p,c=Math.sin(f)*(h?h/2:p),i.moveTo(e-o,s-r),i.lineTo(e+o,s+r),i.moveTo(e+c,s-m),i.lineTo(e-c,s+m),f+=me,o=Math.cos(f)*(h?h/2:p),m=Math.cos(f)*p,r=Math.sin(f)*p,c=Math.sin(f)*(h?h/2:p),i.moveTo(e-o,s-r),i.lineTo(e+o,s+r),i.moveTo(e+c,s-m),i.lineTo(e-c,s+m);break;case"line":m=h?h/2:Math.cos(f)*p,r=Math.sin(f)*p,i.moveTo(e-m,s-r),i.lineTo(e+m,s+r);break;case"dash":i.moveTo(e,s),i.lineTo(e+Math.cos(f)*(h?h/2:p),s+Math.sin(f)*p);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function ne(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function rn(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function on(i){i.restore()}function al(i,t,e,s,h){if(!t)return i.lineTo(e.x,e.y);if(h==="middle"){const g=(t.x+e.x)/2;i.lineTo(g,t.y),i.lineTo(g,e.y)}else h==="after"!=!!s?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function ll(i,t,e,s){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function hl(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),dt(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function cl(i,t,e,s,h){if(h.strikethrough||h.underline){const g=i.measureText(s),m=t-g.actualBoundingBoxLeft,r=t+g.actualBoundingBoxRight,n=e-g.actualBoundingBoxAscent,l=e+g.actualBoundingBoxDescent,u=h.strikethrough?(n+l)/2:l;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=h.decorationWidth||2,i.moveTo(m,u),i.lineTo(r,u),i.stroke()}}function ul(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function Pe(i,t,e,s,h,g={}){const m=bt(t)?t:[t],r=g.strokeWidth>0&&g.strokeColor!=="";let n,l;for(i.save(),i.font=h.string,hl(i,g),n=0;n<m.length;++n)l=m[n],g.backdrop&&ul(i,g.backdrop),r&&(g.strokeColor&&(i.strokeStyle=g.strokeColor),dt(g.strokeWidth)||(i.lineWidth=g.strokeWidth),i.strokeText(l,e,s,g.maxWidth)),i.fillText(l,e,s,g.maxWidth),cl(i,e,s,l,g),s+=Number(h.lineHeight);i.restore()}function ci(i,t){const{x:e,y:s,w:h,h:g,radius:m}=t;i.arc(e+m.topLeft,s+m.topLeft,m.topLeft,1.5*xt,xt,!0),i.lineTo(e,s+g-m.bottomLeft),i.arc(e+m.bottomLeft,s+g-m.bottomLeft,m.bottomLeft,xt,Tt,!0),i.lineTo(e+h-m.bottomRight,s+g),i.arc(e+h-m.bottomRight,s+g-m.bottomRight,m.bottomRight,Tt,0,!0),i.lineTo(e+h,s+m.topRight),i.arc(e+h-m.topRight,s+m.topRight,m.topRight,0,-Tt,!0),i.lineTo(e+m.topLeft,s)}const fl=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,dl=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function gl(i,t){const e=(""+i).match(fl);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const pl=i=>+i||0;function Jn(i,t){const e={},s=ht(t),h=s?Object.keys(t):t,g=ht(i)?s?m=>lt(i[m],i[t[m]]):m=>i[m]:()=>i;for(const m of h)e[m]=pl(g(m));return e}function Qr(i){return Jn(i,{top:"y",right:"x",bottom:"y",left:"x"})}function we(i){return Jn(i,["topLeft","topRight","bottomLeft","bottomRight"])}function Et(i){const t=Qr(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function kt(i,t){i=i||{},t=t||wt.font;let e=lt(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=lt(i.style,t.style);s&&!(""+s).match(dl)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const h={family:lt(i.family,t.family),lineHeight:gl(lt(i.lineHeight,t.lineHeight),e),size:e,style:s,weight:lt(i.weight,t.weight),string:""};return h.string=rl(h),h}function Ge(i,t,e,s){let h=!0,g,m,r;for(g=0,m=i.length;g<m;++g)if(r=i[g],r!==void 0&&(t!==void 0&&typeof r=="function"&&(r=r(t),h=!1),e!==void 0&&bt(r)&&(r=r[e%r.length],h=!1),r!==void 0))return s&&!h&&(s.cacheable=!1),r}function ml(i,t,e){const{min:s,max:h}=i,g=Wr(t,(h-s)/2),m=(r,n)=>e&&r===0?0:r+n;return{min:m(s,-Math.abs(g)),max:m(h,g)}}function ge(i,t){return Object.assign(Object.create(i),t)}function Qn(i,t=[""],e,s,h=()=>i[0]){const g=e||i;typeof s>"u"&&(s=io("_fallback",i));const m={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:g,_fallback:s,_getTarget:h,override:r=>Qn([r,...i],t,g,s)};return new Proxy(m,{deleteProperty(r,n){return delete r[n],delete r._keys,delete i[0][n],!0},get(r,n){return to(r,n,()=>wl(n,t,i,r))},getOwnPropertyDescriptor(r,n){return Reflect.getOwnPropertyDescriptor(r._scopes[0],n)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(r,n){return Ts(r).includes(n)},ownKeys(r){return Ts(r)},set(r,n,l){const u=r._storage||(r._storage=h());return r[n]=u[n]=l,delete r._keys,!0}})}function je(i,t,e,s){const h={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:Zr(i,s),setContext:g=>je(i,g,e,s),override:g=>je(i.override(g),t,e,s)};return new Proxy(h,{deleteProperty(g,m){return delete g[m],delete i[m],!0},get(g,m,r){return to(g,m,()=>_l(g,m,r))},getOwnPropertyDescriptor(g,m){return g._descriptors.allKeys?Reflect.has(i,m)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,m)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(g,m){return Reflect.has(i,m)},ownKeys(){return Reflect.ownKeys(i)},set(g,m,r){return i[m]=r,delete g[m],!0}})}function Zr(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:h=t.allKeys}=i;return{allKeys:h,scriptable:e,indexable:s,isScriptable:fe(e)?e:()=>e,isIndexable:fe(s)?s:()=>s}}const vl=(i,t)=>i?i+Un(t):t,Zn=(i,t)=>ht(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function to(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t))return i[t];const s=e();return i[t]=s,s}function _l(i,t,e){const{_proxy:s,_context:h,_subProxy:g,_descriptors:m}=i;let r=s[t];return fe(r)&&m.isScriptable(t)&&(r=bl(t,r,i,e)),bt(r)&&r.length&&(r=yl(t,r,i,m.isIndexable)),Zn(t,r)&&(r=je(r,h,g&&g[t],m)),r}function bl(i,t,e,s){const{_proxy:h,_context:g,_subProxy:m,_stack:r}=e;if(r.has(i))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+i);r.add(i);let n=t(g,m||s);return r.delete(i),Zn(i,n)&&(n=ts(h._scopes,h,i,n)),n}function yl(i,t,e,s){const{_proxy:h,_context:g,_subProxy:m,_descriptors:r}=e;if(typeof g.index<"u"&&s(i))return t[g.index%t.length];if(ht(t[0])){const n=t,l=h._scopes.filter(u=>u!==n);t=[];for(const u of n){const o=ts(l,h,i,u);t.push(je(o,g,m&&m[i],r))}}return t}function eo(i,t,e){return fe(i)?i(t,e):i}const xl=(i,t)=>i===!0?t:typeof i=="string"?ue(t,i):void 0;function Cl(i,t,e,s,h){for(const g of t){const m=xl(e,g);if(m){i.add(m);const r=eo(m._fallback,e,h);if(typeof r<"u"&&r!==e&&r!==s)return r}else if(m===!1&&typeof s<"u"&&e!==s)return null}return!1}function ts(i,t,e,s){const h=t._rootScopes,g=eo(t._fallback,e,s),m=[...i,...h],r=new Set;r.add(s);let n=ws(r,m,e,g||e,s);return n===null||typeof g<"u"&&g!==e&&(n=ws(r,m,g,n,s),n===null)?!1:Qn(Array.from(r),[""],h,g,()=>Sl(t,e,s))}function ws(i,t,e,s,h){for(;e;)e=Cl(i,t,e,s,h);return e}function Sl(i,t,e){const s=i._getTarget();t in s||(s[t]={});const h=s[t];return bt(h)&&ht(e)?e:h||{}}function wl(i,t,e,s){let h;for(const g of t)if(h=io(vl(g,i),e),typeof h<"u")return Zn(i,h)?ts(e,s,i,h):h}function io(i,t){for(const e of t){if(!e)continue;const s=e[i];if(typeof s<"u")return s}}function Ts(i){let t=i._keys;return t||(t=i._keys=Tl(i._scopes)),t}function Tl(i){const t=new Set;for(const e of i)for(const s of Object.keys(e).filter(h=>!h.startsWith("_")))t.add(s);return Array.from(t)}function no(i,t,e,s){const{iScale:h}=i,{key:g="r"}=this._parsing,m=new Array(s);let r,n,l,u;for(r=0,n=s;r<n;++r)l=r+e,u=t[l],m[r]={r:h.parse(ue(u,g),l)};return m}const Ol=Number.EPSILON||1e-14,ze=(i,t)=>t<i.length&&!i[t].skip&&i[t],so=i=>i==="x"?"y":"x";function kl(i,t,e,s){const h=i.skip?t:i,g=t,m=e.skip?t:e,r=On(g,h),n=On(m,g);let l=r/(r+n),u=n/(r+n);l=isNaN(l)?0:l,u=isNaN(u)?0:u;const o=s*l,c=s*u;return{previous:{x:g.x-o*(m.x-h.x),y:g.y-o*(m.y-h.y)},next:{x:g.x+c*(m.x-h.x),y:g.y+c*(m.y-h.y)}}}function Pl(i,t,e){const s=i.length;let h,g,m,r,n,l=ze(i,0);for(let u=0;u<s-1;++u)if(n=l,l=ze(i,u+1),!(!n||!l)){if(ti(t[u],0,Ol)){e[u]=e[u+1]=0;continue}h=e[u]/t[u],g=e[u+1]/t[u],r=Math.pow(h,2)+Math.pow(g,2),!(r<=9)&&(m=3/Math.sqrt(r),e[u]=h*m*t[u],e[u+1]=g*m*t[u])}}function Ml(i,t,e="x"){const s=so(e),h=i.length;let g,m,r,n=ze(i,0);for(let l=0;l<h;++l){if(m=r,r=n,n=ze(i,l+1),!r)continue;const u=r[e],o=r[s];m&&(g=(u-m[e])/3,r[`cp1${e}`]=u-g,r[`cp1${s}`]=o-g*t[l]),n&&(g=(n[e]-u)/3,r[`cp2${e}`]=u+g,r[`cp2${s}`]=o+g*t[l])}}function Dl(i,t="x"){const e=so(t),s=i.length,h=Array(s).fill(0),g=Array(s);let m,r,n,l=ze(i,0);for(m=0;m<s;++m)if(r=n,n=l,l=ze(i,m+1),!!n){if(l){const u=l[t]-n[t];h[m]=u!==0?(l[e]-n[e])/u:0}g[m]=r?l?qt(h[m-1])!==qt(h[m])?0:(h[m-1]+h[m])/2:h[m-1]:h[m]}Pl(i,h,g),Ml(i,g,t)}function Oi(i,t,e){return Math.max(Math.min(i,e),t)}function Al(i,t){let e,s,h,g,m,r=ne(i[0],t);for(e=0,s=i.length;e<s;++e)m=g,g=r,r=e<s-1&&ne(i[e+1],t),g&&(h=i[e],m&&(h.cp1x=Oi(h.cp1x,t.left,t.right),h.cp1y=Oi(h.cp1y,t.top,t.bottom)),r&&(h.cp2x=Oi(h.cp2x,t.left,t.right),h.cp2y=Oi(h.cp2y,t.top,t.bottom)))}function El(i,t,e,s,h){let g,m,r,n;if(t.spanGaps&&(i=i.filter(l=>!l.skip)),t.cubicInterpolationMode==="monotone")Dl(i,h);else{let l=s?i[i.length-1]:i[0];for(g=0,m=i.length;g<m;++g)r=i[g],n=kl(l,r,i[Math.min(g+1,m-(s?0:1))%m],t.tension),r.cp1x=n.previous.x,r.cp1y=n.previous.y,r.cp2x=n.next.x,r.cp2y=n.next.y,l=r}t.capBezierPoints&&Al(i,e)}function ro(){return typeof window<"u"&&typeof document<"u"}function es(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Qi(i,t,e){let s;return typeof i=="string"?(s=parseInt(i,10),i.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=i,s}const an=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function Fl(i,t){return an(i).getPropertyValue(t)}const Ll=["top","right","bottom","left"];function Te(i,t,e){const s={};e=e?"-"+e:"";for(let h=0;h<4;h++){const g=Ll[h];s[g]=parseFloat(i[t+"-"+g+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const Rl=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function Il(i,t){const e=i.touches,s=e&&e.length?e[0]:i,{offsetX:h,offsetY:g}=s;let m=!1,r,n;if(Rl(h,g,i.target))r=h,n=g;else{const l=t.getBoundingClientRect();r=s.clientX-l.left,n=s.clientY-l.top,m=!0}return{x:r,y:n,box:m}}function ye(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:s}=t,h=an(e),g=h.boxSizing==="border-box",m=Te(h,"padding"),r=Te(h,"border","width"),{x:n,y:l,box:u}=Il(i,e),o=m.left+(u&&r.left),c=m.top+(u&&r.top);let{width:a,height:d}=t;return g&&(a-=m.width+r.width,d-=m.height+r.height),{x:Math.round((n-o)/a*e.width/s),y:Math.round((l-c)/d*e.height/s)}}function Bl(i,t,e){let s,h;if(t===void 0||e===void 0){const g=es(i);if(!g)t=i.clientWidth,e=i.clientHeight;else{const m=g.getBoundingClientRect(),r=an(g),n=Te(r,"border","width"),l=Te(r,"padding");t=m.width-l.width-n.width,e=m.height-l.height-n.height,s=Qi(r.maxWidth,g,"clientWidth"),h=Qi(r.maxHeight,g,"clientHeight")}}return{width:t,height:e,maxWidth:s||Ki,maxHeight:h||Ki}}const ki=i=>Math.round(i*10)/10;function jl(i,t,e,s){const h=an(i),g=Te(h,"margin"),m=Qi(h.maxWidth,i,"clientWidth")||Ki,r=Qi(h.maxHeight,i,"clientHeight")||Ki,n=Bl(i,t,e);let{width:l,height:u}=n;if(h.boxSizing==="content-box"){const c=Te(h,"border","width"),a=Te(h,"padding");l-=a.width+c.width,u-=a.height+c.height}return l=Math.max(0,l-g.width),u=Math.max(0,s?l/s:u-g.height),l=ki(Math.min(l,m,n.maxWidth)),u=ki(Math.min(u,r,n.maxHeight)),l&&!u&&(u=ki(l/2)),(t!==void 0||e!==void 0)&&s&&n.height&&u>n.height&&(u=n.height,l=ki(Math.floor(u*s))),{width:l,height:u}}function Os(i,t,e){const s=t||1,h=Math.floor(i.height*s),g=Math.floor(i.width*s);i.height=Math.floor(i.height),i.width=Math.floor(i.width);const m=i.canvas;return m.style&&(e||!m.style.height&&!m.style.width)&&(m.style.height=`${i.height}px`,m.style.width=`${i.width}px`),i.currentDevicePixelRatio!==s||m.height!==h||m.width!==g?(i.currentDevicePixelRatio=s,m.height=h,m.width=g,i.ctx.setTransform(s,0,0,s,0,0),!0):!1}const zl=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch{}return i}();function ks(i,t){const e=Fl(i,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function xe(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function Wl(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:s==="middle"?e<.5?i.y:t.y:s==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function Hl(i,t,e,s){const h={x:i.cp2x,y:i.cp2y},g={x:t.cp1x,y:t.cp1y},m=xe(i,h,e),r=xe(h,g,e),n=xe(g,t,e),l=xe(m,r,e),u=xe(r,n,e);return xe(l,u,e)}const Nl=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},Vl=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function Re(i,t,e){return i?Nl(t,e):Vl()}function oo(i,t){let e,s;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=s)}function ao(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function lo(i){return i==="angle"?{between:hi,compare:Xa,normalize:jt}:{between:ee,compare:(t,e)=>t-e,normalize:t=>t}}function Ps({start:i,end:t,count:e,loop:s,style:h}){return{start:i%e,end:t%e,loop:s&&(t-i+1)%e===0,style:h}}function Xl(i,t,e){const{property:s,start:h,end:g}=e,{between:m,normalize:r}=lo(s),n=t.length;let{start:l,end:u,loop:o}=i,c,a;if(o){for(l+=n,u+=n,c=0,a=n;c<a&&m(r(t[l%n][s]),h,g);++c)l--,u--;l%=n,u%=n}return u<l&&(u+=n),{start:l,end:u,loop:o,style:i.style}}function ho(i,t,e){if(!e)return[i];const{property:s,start:h,end:g}=e,m=t.length,{compare:r,between:n,normalize:l}=lo(s),{start:u,end:o,loop:c,style:a}=Xl(i,t,e),d=[];let p=!1,f=null,v,_,b;const y=()=>n(h,b,v)&&r(h,b)!==0,x=()=>r(g,v)===0||n(g,b,v),C=()=>p||y(),S=()=>!p||x();for(let O=u,F=u;O<=o;++O)_=t[O%m],!_.skip&&(v=l(_[s]),v!==b&&(p=n(v,h,g),f===null&&C()&&(f=r(v,h)===0?O:F),f!==null&&S()&&(d.push(Ps({start:f,end:O,loop:c,count:m,style:a})),f=null),F=O,b=v));return f!==null&&d.push(Ps({start:f,end:o,loop:c,count:m,style:a})),d}function co(i,t){const e=[],s=i.segments;for(let h=0;h<s.length;h++){const g=ho(s[h],i.points,t);g.length&&e.push(...g)}return e}function Yl(i,t,e,s){let h=0,g=t-1;if(e&&!s)for(;h<t&&!i[h].skip;)h++;for(;h<t&&i[h].skip;)h++;for(h%=t,e&&(g+=h);g>h&&i[g%t].skip;)g--;return g%=t,{start:h,end:g}}function Ul(i,t,e,s){const h=i.length,g=[];let m=t,r=i[t],n;for(n=t+1;n<=e;++n){const l=i[n%h];l.skip||l.stop?r.skip||(s=!1,g.push({start:t%h,end:(n-1)%h,loop:s}),t=m=l.stop?n:null):(m=n,r.skip&&(t=n)),r=l}return m!==null&&g.push({start:t%h,end:m%h,loop:s}),g}function Gl(i,t){const e=i.points,s=i.options.spanGaps,h=e.length;if(!h)return[];const g=!!i._loop,{start:m,end:r}=Yl(e,h,g,s);if(s===!0)return Ms(i,[{start:m,end:r,loop:g}],e,t);const n=r<m?r+h:r,l=!!i._fullLoop&&m===0&&r===h-1;return Ms(i,Ul(e,m,n,l),e,t)}function Ms(i,t,e,s){return!s||!s.setContext||!e?t:$l(i,t,e,s)}function $l(i,t,e,s){const h=i._chart.getContext(),g=Ds(i.options),{_datasetIndex:m,options:{spanGaps:r}}=i,n=e.length,l=[];let u=g,o=t[0].start,c=o;function a(d,p,f,v){const _=r?-1:1;if(d!==p){for(d+=n;e[d%n].skip;)d-=_;for(;e[p%n].skip;)p+=_;d%n!==p%n&&(l.push({start:d%n,end:p%n,loop:f,style:v}),u=v,o=p%n)}}for(const d of t){o=r?o:d.start;let p=e[o%n],f;for(c=o+1;c<=d.end;c++){const v=e[c%n];f=Ds(s.setContext(ge(h,{type:"segment",p0:p,p1:v,p0DataIndex:(c-1)%n,p1DataIndex:c%n,datasetIndex:m}))),ql(f,u)&&a(o,c-1,d.loop,u),p=v,u=f}o<c-1&&a(o,c-1,d.loop,u)}return l}function Ds(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function ql(i,t){if(!t)return!1;const e=[],s=function(h,g){return Kn(g)?(e.includes(g)||e.push(g),e.indexOf(g)):g};return JSON.stringify(i,s)!==JSON.stringify(t,s)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class Kl{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,h){const g=e.listeners[h],m=e.duration;g.forEach(r=>r({chart:t,initial:e.initial,numSteps:m,currentStep:Math.min(s-e.start,m)}))}_refresh(){this._request||(this._running=!0,this._request=Ur.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,h)=>{if(!s.running||!s.items.length)return;const g=s.items;let m=g.length-1,r=!1,n;for(;m>=0;--m)n=g[m],n._active?(n._total>s.duration&&(s.duration=n._total),n.tick(t),r=!0):(g[m]=g[g.length-1],g.pop());r&&(h.draw(),this._notify(h,s,t,"progress")),g.length||(s.running=!1,this._notify(h,s,t,"complete"),s.initial=!1),e+=g.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,h)=>Math.max(s,h._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let h=s.length-1;for(;h>=0;--h)s[h].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Qt=new Kl;const As="transparent",Jl={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const s=xs(i||As),h=s.valid&&xs(t||As);return h&&h.valid?h.mix(s,e).hexString():t},number(i,t,e){return i+(t-i)*e}};class Ql{constructor(t,e,s,h){const g=e[s];h=Ge([t.to,h,g,t.from]);const m=Ge([t.from,g,h]);this._active=!0,this._fn=t.fn||Jl[t.type||typeof m],this._easing=ei[t.easing]||ei.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=m,this._to=h,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const h=this._target[this._prop],g=s-this._start,m=this._duration-g;this._start=s,this._duration=Math.floor(Math.max(m,t.duration)),this._total+=g,this._loop=!!t.loop,this._to=Ge([t.to,e,h,t.from]),this._from=Ge([t.from,h,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,h=this._prop,g=this._from,m=this._loop,r=this._to;let n;if(this._active=g!==r&&(m||e<s),!this._active){this._target[h]=r,this._notify(!0);return}if(e<0){this._target[h]=g;return}n=e/s%2,n=m&&n>1?2-n:n,n=this._easing(Math.min(1,Math.max(0,n))),this._target[h]=this._fn(g,r,n)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let h=0;h<s.length;h++)s[h][e]()}}class uo{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!ht(t))return;const e=Object.keys(wt.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(h=>{const g=t[h];if(!ht(g))return;const m={};for(const r of e)m[r]=g[r];(bt(g.properties)&&g.properties||[h]).forEach(r=>{(r===h||!s.has(r))&&s.set(r,m)})})}_animateOptions(t,e){const s=e.options,h=th(t,s);if(!h)return[];const g=this._createAnimations(h,s);return s.$shared&&Zl(t.options.$animations,s).then(()=>{t.options=s},()=>{}),g}_createAnimations(t,e){const s=this._properties,h=[],g=t.$animations||(t.$animations={}),m=Object.keys(e),r=Date.now();let n;for(n=m.length-1;n>=0;--n){const l=m[n];if(l.charAt(0)==="$")continue;if(l==="options"){h.push(...this._animateOptions(t,e));continue}const u=e[l];let o=g[l];const c=s.get(l);if(o)if(c&&o.active()){o.update(c,u,r);continue}else o.cancel();if(!c||!c.duration){t[l]=u;continue}g[l]=o=new Ql(c,t,l,u),h.push(o)}return h}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return Qt.add(this._chart,s),!0}}function Zl(i,t){const e=[],s=Object.keys(t);for(let h=0;h<s.length;h++){const g=i[s[h]];g&&g.active()&&e.push(g.wait())}return Promise.all(e)}function th(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Es(i,t){const e=i&&i.options||{},s=e.reverse,h=e.min===void 0?t:0,g=e.max===void 0?t:0;return{start:s?g:h,end:s?h:g}}function eh(i,t,e){if(e===!1)return!1;const s=Es(i,e),h=Es(t,e);return{top:h.end,right:s.end,bottom:h.start,left:s.start}}function ih(i){let t,e,s,h;return ht(i)?(t=i.top,e=i.right,s=i.bottom,h=i.left):t=e=s=h=i,{top:t,right:e,bottom:s,left:h,disabled:i===!1}}function fo(i,t){const e=[],s=i._getSortedDatasetMetas(t);let h,g;for(h=0,g=s.length;h<g;++h)e.push(s[h].index);return e}function Fs(i,t,e,s={}){const h=i.keys,g=s.mode==="single";let m,r,n,l;if(t!==null){for(m=0,r=h.length;m<r;++m){if(n=+h[m],n===e){if(s.all)continue;break}l=i.values[n],St(l)&&(g||t===0||qt(t)===qt(l))&&(t+=l)}return t}}function nh(i){const t=Object.keys(i),e=new Array(t.length);let s,h,g;for(s=0,h=t.length;s<h;++s)g=t[s],e[s]={x:g,y:i[g]};return e}function Ls(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function sh(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function rh(i){const{min:t,max:e,minDefined:s,maxDefined:h}=i.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:h?e:Number.POSITIVE_INFINITY}}function oh(i,t,e){const s=i[t]||(i[t]={});return s[e]||(s[e]={})}function Rs(i,t,e,s){for(const h of t.getMatchingVisibleMetas(s).reverse()){const g=i[h.index];if(e&&g>0||!e&&g<0)return h.index}return null}function Is(i,t){const{chart:e,_cachedMeta:s}=i,h=e._stacks||(e._stacks={}),{iScale:g,vScale:m,index:r}=s,n=g.axis,l=m.axis,u=sh(g,m,s),o=t.length;let c;for(let a=0;a<o;++a){const d=t[a],{[n]:p,[l]:f}=d,v=d._stacks||(d._stacks={});c=v[l]=oh(h,u,p),c[r]=f,c._top=Rs(c,m,!0,s.type),c._bottom=Rs(c,m,!1,s.type);const _=c._visualValues||(c._visualValues={});_[r]=f}}function gn(i,t){const e=i.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function ah(i,t){return ge(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function lh(i,t,e){return ge(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function He(i,t){const e=i.controller.index,s=i.vScale&&i.vScale.axis;if(s){t=t||i._parsed;for(const h of t){const g=h._stacks;if(!g||g[s]===void 0||g[s][e]===void 0)return;delete g[s][e],g[s]._visualValues!==void 0&&g[s]._visualValues[e]!==void 0&&delete g[s]._visualValues[e]}}}const pn=i=>i==="reset"||i==="none",Bs=(i,t)=>t?i:Object.assign({},i),hh=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:fo(e,!0),values:null};class Xt{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Ls(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&He(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),h=(o,c,a,d)=>o==="x"?c:o==="r"?d:a,g=e.xAxisID=lt(s.xAxisID,gn(t,"x")),m=e.yAxisID=lt(s.yAxisID,gn(t,"y")),r=e.rAxisID=lt(s.rAxisID,gn(t,"r")),n=e.indexAxis,l=e.iAxisID=h(n,g,m,r),u=e.vAxisID=h(n,m,g,r);e.xScale=this.getScaleForId(g),e.yScale=this.getScaleForId(m),e.rScale=this.getScaleForId(r),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&_s(this._data,this),t._stacked&&He(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(ht(e))this._data=nh(e);else if(s!==e){if(s){_s(s,this);const h=this._cachedMeta;He(h),h._parsed=[]}e&&Object.isExtensible(e)&&$a(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let h=!1;this._dataCheck();const g=e._stacked;e._stacked=Ls(e.vScale,e),e.stack!==s.stack&&(h=!0,He(e),e.stack=s.stack),this._resyncElements(t),(h||g!==e._stacked)&&Is(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:h}=this,{iScale:g,_stacked:m}=s,r=g.axis;let n=t===0&&e===h.length?!0:s._sorted,l=t>0&&s._parsed[t-1],u,o,c;if(this._parsing===!1)s._parsed=h,s._sorted=!0,c=h;else{bt(h[t])?c=this.parseArrayData(s,h,t,e):ht(h[t])?c=this.parseObjectData(s,h,t,e):c=this.parsePrimitiveData(s,h,t,e);const a=()=>o[r]===null||l&&o[r]<l[r];for(u=0;u<e;++u)s._parsed[u+t]=o=c[u],n&&(a()&&(n=!1),l=o);s._sorted=n}m&&Is(this,c)}parsePrimitiveData(t,e,s,h){const{iScale:g,vScale:m}=t,r=g.axis,n=m.axis,l=g.getLabels(),u=g===m,o=new Array(h);let c,a,d;for(c=0,a=h;c<a;++c)d=c+s,o[c]={[r]:u||g.parse(l[d],d),[n]:m.parse(e[d],d)};return o}parseArrayData(t,e,s,h){const{xScale:g,yScale:m}=t,r=new Array(h);let n,l,u,o;for(n=0,l=h;n<l;++n)u=n+s,o=e[u],r[n]={x:g.parse(o[0],u),y:m.parse(o[1],u)};return r}parseObjectData(t,e,s,h){const{xScale:g,yScale:m}=t,{xAxisKey:r="x",yAxisKey:n="y"}=this._parsing,l=new Array(h);let u,o,c,a;for(u=0,o=h;u<o;++u)c=u+s,a=e[c],l[u]={x:g.parse(ue(a,r),c),y:m.parse(ue(a,n),c)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const h=this.chart,g=this._cachedMeta,m=e[t.axis],r={keys:fo(h,!0),values:e._stacks[t.axis]._visualValues};return Fs(r,m,g.index,{mode:s})}updateRangeFromParsed(t,e,s,h){const g=s[e.axis];let m=g===null?NaN:g;const r=h&&s._stacks[e.axis];h&&r&&(h.values=r,m=Fs(h,g,this._cachedMeta.index)),t.min=Math.min(t.min,m),t.max=Math.max(t.max,m)}getMinMax(t,e){const s=this._cachedMeta,h=s._parsed,g=s._sorted&&t===s.iScale,m=h.length,r=this._getOtherScale(t),n=hh(e,s,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:o}=rh(r);let c,a;function d(){a=h[c];const p=a[r.axis];return!St(a[t.axis])||u>p||o<p}for(c=0;c<m&&!(!d()&&(this.updateRangeFromParsed(l,t,a,n),g));++c);if(g){for(c=m-1;c>=0;--c)if(!d()){this.updateRangeFromParsed(l,t,a,n);break}}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let h,g,m;for(h=0,g=e.length;h<g;++h)m=e[h][t.axis],St(m)&&s.push(m);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,h=e.vScale,g=this.getParsed(t);return{label:s?""+s.getLabelForValue(g[s.axis]):"",value:h?""+h.getLabelForValue(g[h.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=ih(lt(this.options.clip,eh(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,h=s.data||[],g=e.chartArea,m=[],r=this._drawStart||0,n=this._drawCount||h.length-r,l=this.options.drawActiveElementsOnTop;let u;for(s.dataset&&s.dataset.draw(t,g,r,n),u=r;u<r+n;++u){const o=h[u];o.hidden||(o.active&&l?m.push(o):o.draw(t,g))}for(u=0;u<m.length;++u)m[u].draw(t,g)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const h=this.getDataset();let g;if(t>=0&&t<this._cachedMeta.data.length){const m=this._cachedMeta.data[t];g=m.$context||(m.$context=lh(this.getContext(),t,m)),g.parsed=this.getParsed(t),g.raw=h.data[t],g.index=g.dataIndex=t}else g=this.$context||(this.$context=ah(this.chart.getContext(),this.index)),g.dataset=h,g.index=g.datasetIndex=this.index;return g.active=!!e,g.mode=s,g}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const h=e==="active",g=this._cachedDataOpts,m=t+"-"+e,r=g[m],n=this.enableOptionSharing&&li(s);if(r)return Bs(r,n);const l=this.chart.config,u=l.datasetElementScopeKeys(this._type,t),o=h?[`${t}Hover`,"hover",t,""]:[t,""],c=l.getOptionScopes(this.getDataset(),u),a=Object.keys(wt.elements[t]),d=()=>this.getContext(s,h,e),p=l.resolveNamedOptions(c,a,d,o);return p.$shared&&(p.$shared=n,g[m]=Object.freeze(Bs(p,n))),p}_resolveAnimations(t,e,s){const h=this.chart,g=this._cachedDataOpts,m=`animation-${e}`,r=g[m];if(r)return r;let n;if(h.options.animation!==!1){const u=this.chart.config,o=u.datasetAnimationScopeKeys(this._type,e),c=u.getOptionScopes(this.getDataset(),o);n=u.createResolver(c,this.getContext(t,s,e))}const l=new uo(h,n&&n.animations);return n&&n._cacheable&&(g[m]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||pn(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),h=this._sharedOptions,g=this.getSharedOptions(s),m=this.includeOptions(e,g)||g!==h;return this.updateSharedOptions(g,e,s),{sharedOptions:g,includeOptions:m}}updateElement(t,e,s,h){pn(h)?Object.assign(t,s):this._resolveAnimations(e,h).update(t,s)}updateSharedOptions(t,e,s){t&&!pn(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,h){t.active=h;const g=this.getStyle(e,h);this._resolveAnimations(e,s,h).update(t,{options:!h&&this.getSharedOptions(g)||g})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[r,n,l]of this._syncList)this[r](n,l);this._syncList=[];const h=s.length,g=e.length,m=Math.min(g,h);m&&this.parse(0,m),g>h?this._insertElements(h,g-h,t):g<h&&this._removeElements(g,h-g)}_insertElements(t,e,s=!0){const h=this._cachedMeta,g=h.data,m=t+e;let r;const n=l=>{for(l.length+=e,r=l.length-1;r>=m;r--)l[r]=l[r-e]};for(n(g),r=t;r<m;++r)g[r]=new this.dataElementType;this._parsing&&n(h._parsed),this.parse(t,e),s&&this.updateElements(g,t,e,"reset")}updateElements(t,e,s,h){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const h=s._parsed.splice(t,e);s._stacked&&He(s,h)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,h]=t;this[e](s,h)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Z(Xt,"defaults",{}),Z(Xt,"datasetElementType",null),Z(Xt,"dataElementType",null);function ch(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let s=[];for(let h=0,g=e.length;h<g;h++)s=s.concat(e[h].controller.getAllParsedValues(i));i._cache.$bar=Yr(s.sort((h,g)=>h-g))}return i._cache.$bar}function uh(i){const t=i.iScale,e=ch(t,i.type);let s=t._length,h,g,m,r;const n=()=>{m===32767||m===-32768||(li(r)&&(s=Math.min(s,Math.abs(m-r)||s)),r=m)};for(h=0,g=e.length;h<g;++h)m=t.getPixelForValue(e[h]),n();for(r=void 0,h=0,g=t.ticks.length;h<g;++h)m=t.getPixelForTick(h),n();return s}function fh(i,t,e,s){const h=e.barThickness;let g,m;return dt(h)?(g=t.min*e.categoryPercentage,m=e.barPercentage):(g=h*s,m=1),{chunk:g/s,ratio:m,start:t.pixels[i]-g/2}}function dh(i,t,e,s){const h=t.pixels,g=h[i];let m=i>0?h[i-1]:null,r=i<h.length-1?h[i+1]:null;const n=e.categoryPercentage;m===null&&(m=g-(r===null?t.end-t.start:r-g)),r===null&&(r=g+g-m);const l=g-(g-Math.min(m,r))/2*n;return{chunk:Math.abs(r-m)/2*n/s,ratio:e.barPercentage,start:l}}function gh(i,t,e,s){const h=e.parse(i[0],s),g=e.parse(i[1],s),m=Math.min(h,g),r=Math.max(h,g);let n=m,l=r;Math.abs(m)>Math.abs(r)&&(n=r,l=m),t[e.axis]=l,t._custom={barStart:n,barEnd:l,start:h,end:g,min:m,max:r}}function go(i,t,e,s){return bt(i)?gh(i,t,e,s):t[e.axis]=e.parse(i,s),t}function js(i,t,e,s){const h=i.iScale,g=i.vScale,m=h.getLabels(),r=h===g,n=[];let l,u,o,c;for(l=e,u=e+s;l<u;++l)c=t[l],o={},o[h.axis]=r||h.parse(m[l],l),n.push(go(c,o,g,l));return n}function mn(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function ph(i,t,e){return i!==0?qt(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function mh(i){let t,e,s,h,g;return i.horizontal?(t=i.base>i.x,e="left",s="right"):(t=i.base<i.y,e="bottom",s="top"),t?(h="end",g="start"):(h="start",g="end"),{start:e,end:s,reverse:t,top:h,bottom:g}}function vh(i,t,e,s){let h=t.borderSkipped;const g={};if(!h){i.borderSkipped=g;return}if(h===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:m,end:r,reverse:n,top:l,bottom:u}=mh(i);h==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===s?h=l:(e._bottom||0)===s?h=u:(g[zs(u,m,r,n)]=!0,h=l)),g[zs(h,m,r,n)]=!0,i.borderSkipped=g}function zs(i,t,e,s){return s?(i=_h(i,t,e),i=Ws(i,e,t)):i=Ws(i,t,e),i}function _h(i,t,e){return i===t?e:i===e?t:i}function Ws(i,t,e){return i==="start"?t:i==="end"?e:i}function bh(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class ji extends Xt{parsePrimitiveData(t,e,s,h){return js(t,e,s,h)}parseArrayData(t,e,s,h){return js(t,e,s,h)}parseObjectData(t,e,s,h){const{iScale:g,vScale:m}=t,{xAxisKey:r="x",yAxisKey:n="y"}=this._parsing,l=g.axis==="x"?r:n,u=m.axis==="x"?r:n,o=[];let c,a,d,p;for(c=s,a=s+h;c<a;++c)p=e[c],d={},d[g.axis]=g.parse(ue(p,l),c),o.push(go(ue(p,u),d,m,c));return o}updateRangeFromParsed(t,e,s,h){super.updateRangeFromParsed(t,e,s,h);const g=s._custom;g&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,g.min),t.max=Math.max(t.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:h}=e,g=this.getParsed(t),m=g._custom,r=mn(m)?"["+m.start+", "+m.end+"]":""+h.getLabelForValue(g[h.axis]);return{label:""+s.getLabelForValue(g[s.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,h){const g=h==="reset",{index:m,_cachedMeta:{vScale:r}}=this,n=r.getBasePixel(),l=r.isHorizontal(),u=this._getRuler(),{sharedOptions:o,includeOptions:c}=this._getSharedOptions(e,h);for(let a=e;a<e+s;a++){const d=this.getParsed(a),p=g||dt(d[r.axis])?{base:n,head:n}:this._calculateBarValuePixels(a),f=this._calculateBarIndexPixels(a,u),v=(d._stacks||{})[r.axis],_={horizontal:l,base:p.base,enableBorderRadius:!v||mn(d._custom)||m===v._top||m===v._bottom,x:l?p.head:f.center,y:l?f.center:p.head,height:l?f.size:Math.abs(p.size),width:l?Math.abs(p.size):f.size};c&&(_.options=o||this.resolveDataElementOptions(a,t[a].active?"active":h));const b=_.options||t[a].options;vh(_,b,v,m),bh(_,b,u.ratio),this.updateElement(t[a],a,_,h)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,h=s.getMatchingVisibleMetas(this._type).filter(n=>n.controller.options.grouped),g=s.options.stacked,m=[],r=n=>{const l=n.controller.getParsed(e),u=l&&l[n.vScale.axis];if(dt(u)||isNaN(u))return!0};for(const n of h)if(!(e!==void 0&&r(n))&&((g===!1||m.indexOf(n.stack)===-1||g===void 0&&n.stack===void 0)&&m.push(n.stack),n.index===t))break;return m.length||m.push(void 0),m}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,s){const h=this._getStacks(t,s),g=e!==void 0?h.indexOf(e):-1;return g===-1?h.length-1:g}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,h=[];let g,m;for(g=0,m=e.data.length;g<m;++g)h.push(s.getPixelForValue(this.getParsed(g)[s.axis],g));const r=t.barThickness;return{min:r||uh(e),pixels:h,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:r?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:h},options:{base:g,minBarLength:m}}=this,r=g||0,n=this.getParsed(t),l=n._custom,u=mn(l);let o=n[e.axis],c=0,a=s?this.applyStack(e,n,s):o,d,p;a!==o&&(c=a-o,a=o),u&&(o=l.barStart,a=l.barEnd-l.barStart,o!==0&&qt(o)!==qt(l.barEnd)&&(c=0),c+=o);const f=!dt(g)&&!u?g:c;let v=e.getPixelForValue(f);if(this.chart.getDataVisibility(t)?d=e.getPixelForValue(c+a):d=v,p=d-v,Math.abs(p)<m){p=ph(p,e,r)*m,o===r&&(v-=p/2);const _=e.getPixelForDecimal(0),b=e.getPixelForDecimal(1),y=Math.min(_,b),x=Math.max(_,b);v=Math.max(Math.min(v,x),y),d=v+p,s&&!u&&(n._stacks[e.axis]._visualValues[h]=e.getValueForPixel(d)-e.getValueForPixel(v))}if(v===e.getPixelForValue(r)){const _=qt(p)*e.getLineWidthForValue(r)/2;v+=_,p-=_}return{size:p,base:v,head:d,center:d+p/2}}_calculateBarIndexPixels(t,e){const s=e.scale,h=this.options,g=h.skipNull,m=lt(h.maxBarThickness,1/0);let r,n;if(e.grouped){const l=g?this._getStackCount(t):e.stackCount,u=h.barThickness==="flex"?dh(t,e,h,l):fh(t,e,h,l),o=this._getStackIndex(this.index,this._cachedMeta.stack,g?t:void 0);r=u.start+u.chunk*o+u.chunk/2,n=Math.min(m,u.chunk*u.ratio)}else r=s.getPixelForValue(this.getParsed(t)[s.axis],t),n=Math.min(m,e.min*e.ratio);return{base:r-n/2,head:r+n/2,center:r,size:n}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,h=s.length;let g=0;for(;g<h;++g)this.getParsed(g)[e.axis]!==null&&s[g].draw(this._ctx)}}Z(ji,"id","bar"),Z(ji,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Z(ji,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class zi extends Xt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,h){const g=super.parsePrimitiveData(t,e,s,h);for(let m=0;m<g.length;m++)g[m]._custom=this.resolveDataElementOptions(m+s).radius;return g}parseArrayData(t,e,s,h){const g=super.parseArrayData(t,e,s,h);for(let m=0;m<g.length;m++){const r=e[s+m];g[m]._custom=lt(r[2],this.resolveDataElementOptions(m+s).radius)}return g}parseObjectData(t,e,s,h){const g=super.parseObjectData(t,e,s,h);for(let m=0;m<g.length;m++){const r=e[s+m];g[m]._custom=lt(r&&r.r&&+r.r,this.resolveDataElementOptions(m+s).radius)}return g}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:h,yScale:g}=e,m=this.getParsed(t),r=h.getLabelForValue(m.x),n=g.getLabelForValue(m.y),l=m._custom;return{label:s[t]||"",value:"("+r+", "+n+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,h){const g=h==="reset",{iScale:m,vScale:r}=this._cachedMeta,{sharedOptions:n,includeOptions:l}=this._getSharedOptions(e,h),u=m.axis,o=r.axis;for(let c=e;c<e+s;c++){const a=t[c],d=!g&&this.getParsed(c),p={},f=p[u]=g?m.getPixelForDecimal(.5):m.getPixelForValue(d[u]),v=p[o]=g?r.getBasePixel():r.getPixelForValue(d[o]);p.skip=isNaN(f)||isNaN(v),l&&(p.options=n||this.resolveDataElementOptions(c,a.active?"active":h),g&&(p.options.radius=0)),this.updateElement(a,c,p,h)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let h=super.resolveDataElementOptions(t,e);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const g=h.radius;return e!=="active"&&(h.radius=0),h.radius+=lt(s&&s._custom,g),h}}Z(zi,"id","bubble"),Z(zi,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),Z(zi,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function yh(i,t,e){let s=1,h=1,g=0,m=0;if(t<yt){const r=i,n=r+t,l=Math.cos(r),u=Math.sin(r),o=Math.cos(n),c=Math.sin(n),a=(b,y,x)=>hi(b,r,n,!0)?1:Math.max(y,y*e,x,x*e),d=(b,y,x)=>hi(b,r,n,!0)?-1:Math.min(y,y*e,x,x*e),p=a(0,l,o),f=a(Tt,u,c),v=d(xt,l,o),_=d(xt+Tt,u,c);s=(p-v)/2,h=(f-_)/2,g=-(p+v)/2,m=-(f+_)/2}return{ratioX:s,ratioY:h,offsetX:g,offsetY:m}}class Se extends Xt{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=s;else{let g=n=>+s[n];if(ht(s[t])){const{key:n="value"}=this._parsing;g=l=>+ue(s[l],n)}let m,r;for(m=t,r=t+e;m<r;++m)h._parsed[m]=g(m)}}_getRotation(){return Vt(this.options.rotation-90)}_getCircumference(){return Vt(this.options.circumference)}_getRotationExtents(){let t=yt,e=-yt;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const h=this.chart.getDatasetMeta(s).controller,g=h._getRotation(),m=h._getCircumference();t=Math.min(t,g),e=Math.max(e,g+m)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,h=this._cachedMeta,g=h.data,m=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,r=Math.max((Math.min(s.width,s.height)-m)/2,0),n=Math.min(La(this.options.cutout,r),1),l=this._getRingWeight(this.index),{circumference:u,rotation:o}=this._getRotationExtents(),{ratioX:c,ratioY:a,offsetX:d,offsetY:p}=yh(o,u,n),f=(s.width-m)/c,v=(s.height-m)/a,_=Math.max(Math.min(f,v)/2,0),b=Wr(this.options.radius,_),y=Math.max(b*n,0),x=(b-y)/this._getVisibleDatasetWeightTotal();this.offsetX=d*b,this.offsetY=p*b,h.total=this.calculateTotal(),this.outerRadius=b-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*l,0),this.updateElements(g,0,g.length,t)}_circumference(t,e){const s=this.options,h=this._cachedMeta,g=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||h._parsed[t]===null||h.data[t].hidden?0:this.calculateCircumference(h._parsed[t]*g/yt)}updateElements(t,e,s,h){const g=h==="reset",m=this.chart,r=m.chartArea,l=m.options.animation,u=(r.left+r.right)/2,o=(r.top+r.bottom)/2,c=g&&l.animateScale,a=c?0:this.innerRadius,d=c?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,h);let v=this._getRotation(),_;for(_=0;_<e;++_)v+=this._circumference(_,g);for(_=e;_<e+s;++_){const b=this._circumference(_,g),y=t[_],x={x:u+this.offsetX,y:o+this.offsetY,startAngle:v,endAngle:v+b,circumference:b,outerRadius:d,innerRadius:a};f&&(x.options=p||this.resolveDataElementOptions(_,y.active?"active":h)),v+=b,this.updateElement(y,_,x,h)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,h;for(h=0;h<e.length;h++){const g=t._parsed[h];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(h)&&!e[h].hidden&&(s+=Math.abs(g))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?yt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,h=s.data.labels||[],g=yi(e._parsed[t],s.options.locale);return{label:h[t]||"",value:g}}getMaxBorderWidth(t){let e=0;const s=this.chart;let h,g,m,r,n;if(!t){for(h=0,g=s.data.datasets.length;h<g;++h)if(s.isDatasetVisible(h)){m=s.getDatasetMeta(h),t=m.data,r=m.controller;break}}if(!t)return 0;for(h=0,g=t.length;h<g;++h)n=r.resolveDataElementOptions(h),n.borderAlign!=="inner"&&(e=Math.max(e,n.borderWidth||0,n.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,h=t.length;s<h;++s){const g=this.resolveDataElementOptions(s);e=Math.max(e,g.offset||0,g.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(lt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Z(Se,"id","doughnut"),Z(Se,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Z(Se,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),Z(Se,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:h}}=t.legend.options;return e.labels.map((g,m)=>{const n=t.getDatasetMeta(0).controller.getStyle(m);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:h,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(m),index:m}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class Wi extends Xt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:h=[],_dataset:g}=e,m=this.chart._animationsDisabled;let{start:r,count:n}=$r(e,h,m);this._drawStart=r,this._drawCount=n,qr(e)&&(r=0,n=h.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!g._decimated,s.points=h;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(s,void 0,{animated:!m,options:l},t),this.updateElements(h,r,n,t)}updateElements(t,e,s,h){const g=h==="reset",{iScale:m,vScale:r,_stacked:n,_dataset:l}=this._cachedMeta,{sharedOptions:u,includeOptions:o}=this._getSharedOptions(e,h),c=m.axis,a=r.axis,{spanGaps:d,segment:p}=this.options,f=Be(d)?d:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||g||h==="none",_=e+s,b=t.length;let y=e>0&&this.getParsed(e-1);for(let x=0;x<b;++x){const C=t[x],S=v?C:{};if(x<e||x>=_){S.skip=!0;continue}const O=this.getParsed(x),F=dt(O[a]),R=S[c]=m.getPixelForValue(O[c],x),z=S[a]=g||F?r.getBasePixel():r.getPixelForValue(n?this.applyStack(r,O,n):O[a],x);S.skip=isNaN(R)||isNaN(z)||F,S.stop=x>0&&Math.abs(O[c]-y[c])>f,p&&(S.parsed=O,S.raw=l.data[x]),o&&(S.options=u||this.resolveDataElementOptions(x,C.active?"active":h)),v||this.updateElement(C,x,S,h),y=O}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,h=t.data||[];if(!h.length)return s;const g=h[0].size(this.resolveDataElementOptions(0)),m=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(s,g,m)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Z(Wi,"id","line"),Z(Wi,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Z(Wi,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ni extends Xt{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,h=s.data.labels||[],g=yi(e._parsed[t].r,s.options.locale);return{label:h[t]||"",value:g}}parseObjectData(t,e,s,h){return no.bind(this)(t,e,s,h)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,h)=>{const g=this.getParsed(h).r;!isNaN(g)&&this.chart.getDataVisibility(h)&&(g<e.min&&(e.min=g),g>e.max&&(e.max=g))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,h=Math.min(e.right-e.left,e.bottom-e.top),g=Math.max(h/2,0),m=Math.max(s.cutoutPercentage?g/100*s.cutoutPercentage:1,0),r=(g-m)/t.getVisibleDatasetCount();this.outerRadius=g-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(t,e,s,h){const g=h==="reset",m=this.chart,n=m.options.animation,l=this._cachedMeta.rScale,u=l.xCenter,o=l.yCenter,c=l.getIndexAngle(0)-.5*xt;let a=c,d;const p=360/this.countVisibleElements();for(d=0;d<e;++d)a+=this._computeAngle(d,h,p);for(d=e;d<e+s;d++){const f=t[d];let v=a,_=a+this._computeAngle(d,h,p),b=m.getDataVisibility(d)?l.getDistanceFromCenterForValue(this.getParsed(d).r):0;a=_,g&&(n.animateScale&&(b=0),n.animateRotate&&(v=_=c));const y={x:u,y:o,innerRadius:0,outerRadius:b,startAngle:v,endAngle:_,options:this.resolveDataElementOptions(d,f.active?"active":h)};this.updateElement(f,d,y,h)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?Vt(this.resolveDataElementOptions(t,e).angle||s):0}}Z(ni,"id","polarArea"),Z(ni,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Z(ni,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:h}}=t.legend.options;return e.labels.map((g,m)=>{const n=t.getDatasetMeta(0).controller.getStyle(m);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:h,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(m),index:m}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Mn extends Se{}Z(Mn,"id","pie"),Z(Mn,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Hi extends Xt{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,h){return no.bind(this)(t,e,s,h)}update(t){const e=this._cachedMeta,s=e.dataset,h=e.data||[],g=e.iScale.getLabels();if(s.points=h,t!=="resize"){const m=this.resolveDatasetElementOptions(t);this.options.showLine||(m.borderWidth=0);const r={_loop:!0,_fullLoop:g.length===h.length,options:m};this.updateElement(s,void 0,r,t)}this.updateElements(h,0,h.length,t)}updateElements(t,e,s,h){const g=this._cachedMeta.rScale,m=h==="reset";for(let r=e;r<e+s;r++){const n=t[r],l=this.resolveDataElementOptions(r,n.active?"active":h),u=g.getPointPositionForValue(r,this.getParsed(r).r),o=m?g.xCenter:u.x,c=m?g.yCenter:u.y,a={x:o,y:c,angle:u.angle,skip:isNaN(o)||isNaN(c),options:l};this.updateElement(n,r,a,h)}}}Z(Hi,"id","radar"),Z(Hi,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),Z(Hi,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Ni extends Xt{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:h,yScale:g}=e,m=this.getParsed(t),r=h.getLabelForValue(m.x),n=g.getLabelForValue(m.y);return{label:s[t]||"",value:"("+r+", "+n+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,h=this.chart._animationsDisabled;let{start:g,count:m}=$r(e,s,h);if(this._drawStart=g,this._drawCount=m,qr(e)&&(g=0,m=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:n}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!n._decimated,r.points=s;const l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(r,void 0,{animated:!h,options:l},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,g,m,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,h){const g=h==="reset",{iScale:m,vScale:r,_stacked:n,_dataset:l}=this._cachedMeta,u=this.resolveDataElementOptions(e,h),o=this.getSharedOptions(u),c=this.includeOptions(h,o),a=m.axis,d=r.axis,{spanGaps:p,segment:f}=this.options,v=Be(p)?p:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||g||h==="none";let b=e>0&&this.getParsed(e-1);for(let y=e;y<e+s;++y){const x=t[y],C=this.getParsed(y),S=_?x:{},O=dt(C[d]),F=S[a]=m.getPixelForValue(C[a],y),R=S[d]=g||O?r.getBasePixel():r.getPixelForValue(n?this.applyStack(r,C,n):C[d],y);S.skip=isNaN(F)||isNaN(R)||O,S.stop=y>0&&Math.abs(C[a]-b[a])>v,f&&(S.parsed=C,S.raw=l.data[y]),c&&(S.options=o||this.resolveDataElementOptions(y,x.active?"active":h)),_||this.updateElement(x,y,S,h),b=C}this.updateSharedOptions(o,h,u)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let r=0;for(let n=e.length-1;n>=0;--n)r=Math.max(r,e[n].size(this.resolveDataElementOptions(n))/2);return r>0&&r}const s=t.dataset,h=s.options&&s.options.borderWidth||0;if(!e.length)return h;const g=e[0].size(this.resolveDataElementOptions(0)),m=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(h,g,m)/2}}Z(Ni,"id","scatter"),Z(Ni,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),Z(Ni,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var xh=Object.freeze({__proto__:null,BarController:ji,BubbleController:zi,DoughnutController:Se,LineController:Wi,PieController:Mn,PolarAreaController:ni,RadarController:Hi,ScatterController:Ni});function _e(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class is{constructor(t){Z(this,"options");this.options=t||{}}static override(t){Object.assign(is.prototype,t)}init(){}formats(){return _e()}parse(){return _e()}format(){return _e()}add(){return _e()}diff(){return _e()}startOf(){return _e()}endOf(){return _e()}}var Ch={_date:is};function Sh(i,t,e,s){const{controller:h,data:g,_sorted:m}=i,r=h._cachedMeta.iScale;if(r&&t===r.axis&&t!=="r"&&m&&g.length){const n=r._reversePixels?Ua:ie;if(s){if(h._sharedOptions){const l=g[0],u=typeof l.getRange=="function"&&l.getRange(t);if(u){const o=n(g,t,e-u),c=n(g,t,e+u);return{lo:o.lo,hi:c.hi}}}}else return n(g,t,e)}return{lo:0,hi:g.length-1}}function xi(i,t,e,s,h){const g=i.getSortedVisibleDatasetMetas(),m=e[t];for(let r=0,n=g.length;r<n;++r){const{index:l,data:u}=g[r],{lo:o,hi:c}=Sh(g[r],t,m,h);for(let a=o;a<=c;++a){const d=u[a];d.skip||s(d,l,a)}}}function wh(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(s,h){const g=t?Math.abs(s.x-h.x):0,m=e?Math.abs(s.y-h.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(m,2))}}function vn(i,t,e,s,h){const g=[];return!h&&!i.isPointInArea(t)||xi(i,e,t,function(r,n,l){!h&&!ne(r,i.chartArea,0)||r.inRange(t.x,t.y,s)&&g.push({element:r,datasetIndex:n,index:l})},!0),g}function Th(i,t,e,s){let h=[];function g(m,r,n){const{startAngle:l,endAngle:u}=m.getProps(["startAngle","endAngle"],s),{angle:o}=Vr(m,{x:t.x,y:t.y});hi(o,l,u)&&h.push({element:m,datasetIndex:r,index:n})}return xi(i,e,t,g),h}function Oh(i,t,e,s,h,g){let m=[];const r=wh(e);let n=Number.POSITIVE_INFINITY;function l(u,o,c){const a=u.inRange(t.x,t.y,h);if(s&&!a)return;const d=u.getCenterPoint(h);if(!(!!g||i.isPointInArea(d))&&!a)return;const f=r(t,d);f<n?(m=[{element:u,datasetIndex:o,index:c}],n=f):f===n&&m.push({element:u,datasetIndex:o,index:c})}return xi(i,e,t,l),m}function _n(i,t,e,s,h,g){return!g&&!i.isPointInArea(t)?[]:e==="r"&&!s?Th(i,t,e,h):Oh(i,t,e,s,h,g)}function Hs(i,t,e,s,h){const g=[],m=e==="x"?"inXRange":"inYRange";let r=!1;return xi(i,e,t,(n,l,u)=>{n[m](t[e],h)&&(g.push({element:n,datasetIndex:l,index:u}),r=r||n.inRange(t.x,t.y,h))}),s&&!r?[]:g}var kh={evaluateInteractionItems:xi,modes:{index(i,t,e,s){const h=ye(t,i),g=e.axis||"x",m=e.includeInvisible||!1,r=e.intersect?vn(i,h,g,s,m):_n(i,h,g,!1,s,m),n=[];return r.length?(i.getSortedVisibleDatasetMetas().forEach(l=>{const u=r[0].index,o=l.data[u];o&&!o.skip&&n.push({element:o,datasetIndex:l.index,index:u})}),n):[]},dataset(i,t,e,s){const h=ye(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;let r=e.intersect?vn(i,h,g,s,m):_n(i,h,g,!1,s,m);if(r.length>0){const n=r[0].datasetIndex,l=i.getDatasetMeta(n).data;r=[];for(let u=0;u<l.length;++u)r.push({element:l[u],datasetIndex:n,index:u})}return r},point(i,t,e,s){const h=ye(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;return vn(i,h,g,s,m)},nearest(i,t,e,s){const h=ye(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;return _n(i,h,g,e.intersect,s,m)},x(i,t,e,s){const h=ye(t,i);return Hs(i,h,"x",e.intersect,s)},y(i,t,e,s){const h=ye(t,i);return Hs(i,h,"y",e.intersect,s)}}};const po=["left","top","right","bottom"];function Ne(i,t){return i.filter(e=>e.pos===t)}function Ns(i,t){return i.filter(e=>po.indexOf(e.pos)===-1&&e.box.axis===t)}function Ve(i,t){return i.sort((e,s)=>{const h=t?s:e,g=t?e:s;return h.weight===g.weight?h.index-g.index:h.weight-g.weight})}function Ph(i){const t=[];let e,s,h,g,m,r;for(e=0,s=(i||[]).length;e<s;++e)h=i[e],{position:g,options:{stack:m,stackWeight:r=1}}=h,t.push({index:e,box:h,pos:g,horizontal:h.isHorizontal(),weight:h.weight,stack:m&&g+m,stackWeight:r});return t}function Mh(i){const t={};for(const e of i){const{stack:s,pos:h,stackWeight:g}=e;if(!s||!po.includes(h))continue;const m=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});m.count++,m.weight+=g}return t}function Dh(i,t){const e=Mh(i),{vBoxMaxWidth:s,hBoxMaxHeight:h}=t;let g,m,r;for(g=0,m=i.length;g<m;++g){r=i[g];const{fullSize:n}=r.box,l=e[r.stack],u=l&&r.stackWeight/l.weight;r.horizontal?(r.width=u?u*s:n&&t.availableWidth,r.height=h):(r.width=s,r.height=u?u*h:n&&t.availableHeight)}return e}function Ah(i){const t=Ph(i),e=Ve(t.filter(l=>l.box.fullSize),!0),s=Ve(Ne(t,"left"),!0),h=Ve(Ne(t,"right")),g=Ve(Ne(t,"top"),!0),m=Ve(Ne(t,"bottom")),r=Ns(t,"x"),n=Ns(t,"y");return{fullSize:e,leftAndTop:s.concat(g),rightAndBottom:h.concat(n).concat(m).concat(r),chartArea:Ne(t,"chartArea"),vertical:s.concat(h).concat(n),horizontal:g.concat(m).concat(r)}}function Vs(i,t,e,s){return Math.max(i[e],t[e])+Math.max(i[s],t[s])}function mo(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function Eh(i,t,e,s){const{pos:h,box:g}=e,m=i.maxPadding;if(!ht(h)){e.size&&(i[h]-=e.size);const o=s[e.stack]||{size:0,count:1};o.size=Math.max(o.size,e.horizontal?g.height:g.width),e.size=o.size/o.count,i[h]+=e.size}g.getPadding&&mo(m,g.getPadding());const r=Math.max(0,t.outerWidth-Vs(m,i,"left","right")),n=Math.max(0,t.outerHeight-Vs(m,i,"top","bottom")),l=r!==i.w,u=n!==i.h;return i.w=r,i.h=n,e.horizontal?{same:l,other:u}:{same:u,other:l}}function Fh(i){const t=i.maxPadding;function e(s){const h=Math.max(t[s]-i[s],0);return i[s]+=h,h}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function Lh(i,t){const e=t.maxPadding;function s(h){const g={left:0,top:0,right:0,bottom:0};return h.forEach(m=>{g[m]=Math.max(t[m],e[m])}),g}return s(i?["left","right"]:["top","bottom"])}function $e(i,t,e,s){const h=[];let g,m,r,n,l,u;for(g=0,m=i.length,l=0;g<m;++g){r=i[g],n=r.box,n.update(r.width||t.w,r.height||t.h,Lh(r.horizontal,t));const{same:o,other:c}=Eh(t,e,r,s);l|=o&&h.length,u=u||c,n.fullSize||h.push(r)}return l&&$e(h,t,e,s)||u}function Pi(i,t,e,s,h){i.top=e,i.left=t,i.right=t+s,i.bottom=e+h,i.width=s,i.height=h}function Xs(i,t,e,s){const h=e.padding;let{x:g,y:m}=t;for(const r of i){const n=r.box,l=s[r.stack]||{count:1,placed:0,weight:1},u=r.stackWeight/l.weight||1;if(r.horizontal){const o=t.w*u,c=l.size||n.height;li(l.start)&&(m=l.start),n.fullSize?Pi(n,h.left,m,e.outerWidth-h.right-h.left,c):Pi(n,t.left+l.placed,m,o,c),l.start=m,l.placed+=o,m=n.bottom}else{const o=t.h*u,c=l.size||n.width;li(l.start)&&(g=l.start),n.fullSize?Pi(n,g,h.top,c,e.outerHeight-h.bottom-h.top):Pi(n,g,t.top+l.placed,c,o),l.start=g,l.placed+=o,g=n.right}}t.x=g,t.y=m}var At={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,s){if(!i)return;const h=Et(i.options.layout.padding),g=Math.max(t-h.width,0),m=Math.max(e-h.height,0),r=Ah(i.boxes),n=r.vertical,l=r.horizontal;pt(i.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const u=n.reduce((p,f)=>f.box.options&&f.box.options.display===!1?p:p+1,0)||1,o=Object.freeze({outerWidth:t,outerHeight:e,padding:h,availableWidth:g,availableHeight:m,vBoxMaxWidth:g/2/u,hBoxMaxHeight:m/2}),c=Object.assign({},h);mo(c,Et(s));const a=Object.assign({maxPadding:c,w:g,h:m,x:h.left,y:h.top},h),d=Dh(n.concat(l),o);$e(r.fullSize,a,o,d),$e(n,a,o,d),$e(l,a,o,d)&&$e(n,a,o,d),Fh(a),Xs(r.leftAndTop,a,o,d),a.x+=a.w,a.y+=a.h,Xs(r.rightAndBottom,a,o,d),i.chartArea={left:a.left,top:a.top,right:a.left+a.w,bottom:a.top+a.h,height:a.h,width:a.w},pt(r.chartArea,p=>{const f=p.box;Object.assign(f,i.chartArea),f.update(a.w,a.h,{left:0,top:0,right:0,bottom:0})})}};class vo{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,h){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,h?Math.floor(e/h):s)}}isAttached(t){return!0}updateConfig(t){}}class Rh extends vo{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Vi="$chartjs",Ih={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ys=i=>i===null||i==="";function Bh(i,t){const e=i.style,s=i.getAttribute("height"),h=i.getAttribute("width");if(i[Vi]={initial:{height:s,width:h,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Ys(h)){const g=ks(i,"width");g!==void 0&&(i.width=g)}if(Ys(s))if(i.style.height==="")i.height=i.width/(t||2);else{const g=ks(i,"height");g!==void 0&&(i.height=g)}return i}const _o=zl?{passive:!0}:!1;function jh(i,t,e){i.addEventListener(t,e,_o)}function zh(i,t,e){i.canvas.removeEventListener(t,e,_o)}function Wh(i,t){const e=Ih[i.type]||i.type,{x:s,y:h}=ye(i,t);return{type:e,chart:t,native:i,x:s!==void 0?s:null,y:h!==void 0?h:null}}function Zi(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function Hh(i,t,e){const s=i.canvas,h=new MutationObserver(g=>{let m=!1;for(const r of g)m=m||Zi(r.addedNodes,s),m=m&&!Zi(r.removedNodes,s);m&&e()});return h.observe(document,{childList:!0,subtree:!0}),h}function Nh(i,t,e){const s=i.canvas,h=new MutationObserver(g=>{let m=!1;for(const r of g)m=m||Zi(r.removedNodes,s),m=m&&!Zi(r.addedNodes,s);m&&e()});return h.observe(document,{childList:!0,subtree:!0}),h}const ui=new Map;let Us=0;function bo(){const i=window.devicePixelRatio;i!==Us&&(Us=i,ui.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function Vh(i,t){ui.size||window.addEventListener("resize",bo),ui.set(i,t)}function Xh(i){ui.delete(i),ui.size||window.removeEventListener("resize",bo)}function Yh(i,t,e){const s=i.canvas,h=s&&es(s);if(!h)return;const g=Gr((r,n)=>{const l=h.clientWidth;e(r,n),l<h.clientWidth&&e()},window),m=new ResizeObserver(r=>{const n=r[0],l=n.contentRect.width,u=n.contentRect.height;l===0&&u===0||g(l,u)});return m.observe(h),Vh(i,g),m}function bn(i,t,e){e&&e.disconnect(),t==="resize"&&Xh(i)}function Uh(i,t,e){const s=i.canvas,h=Gr(g=>{i.ctx!==null&&e(Wh(g,i))},i);return jh(s,t,h),h}class Gh extends vo{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(Bh(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[Vi])return!1;const s=e[Vi].initial;["height","width"].forEach(g=>{const m=s[g];dt(m)?e.removeAttribute(g):e.setAttribute(g,m)});const h=s.style||{};return Object.keys(h).forEach(g=>{e.style[g]=h[g]}),e.width=e.width,delete e[Vi],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const h=t.$proxies||(t.$proxies={}),m={attach:Hh,detach:Nh,resize:Yh}[e]||Uh;h[e]=m(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),h=s[e];if(!h)return;({attach:bn,detach:bn,resize:bn}[e]||zh)(t,e,h),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,h){return jl(t,e,s,h)}isAttached(t){const e=es(t);return!!(e&&e.isConnected)}}function $h(i){return!ro()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?Rh:Gh}var Ii;let re=(Ii=class{constructor(){Z(this,"x");Z(this,"y");Z(this,"active",!1);Z(this,"options");Z(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return Be(this.x)&&Be(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const h={};return t.forEach(g=>{h[g]=s[g]&&s[g].active()?s[g]._to:this[g]}),h}},Z(Ii,"defaults",{}),Z(Ii,"defaultRoutes"),Ii);function qh(i,t){const e=i.options.ticks,s=Kh(i),h=Math.min(e.maxTicksLimit||s,s),g=e.major.enabled?Qh(t):[],m=g.length,r=g[0],n=g[m-1],l=[];if(m>h)return Zh(t,l,g,m/h),l;const u=Jh(g,t,h);if(m>0){let o,c;const a=m>1?Math.round((n-r)/(m-1)):null;for(Mi(t,l,u,dt(a)?0:r-a,r),o=0,c=m-1;o<c;o++)Mi(t,l,u,g[o],g[o+1]);return Mi(t,l,u,n,dt(a)?t.length:n+a),l}return Mi(t,l,u),l}function Kh(i){const t=i.options.offset,e=i._tickSize(),s=i._length/e+(t?0:1),h=i._maxLength/e;return Math.floor(Math.min(s,h))}function Jh(i,t,e){const s=tc(i),h=t.length/e;if(!s)return Math.max(h,1);const g=Na(s);for(let m=0,r=g.length-1;m<r;m++){const n=g[m];if(n>h)return n}return Math.max(h,1)}function Qh(i){const t=[];let e,s;for(e=0,s=i.length;e<s;e++)i[e].major&&t.push(e);return t}function Zh(i,t,e,s){let h=0,g=e[0],m;for(s=Math.ceil(s),m=0;m<i.length;m++)m===g&&(t.push(i[m]),h++,g=e[h*s])}function Mi(i,t,e,s,h){const g=lt(s,0),m=Math.min(lt(h,i.length),i.length);let r=0,n,l,u;for(e=Math.ceil(e),h&&(n=h-s,e=n/Math.floor(n/e)),u=g;u<0;)r++,u=Math.round(g+r*e);for(l=Math.max(g,0);l<m;l++)l===u&&(t.push(i[l]),r++,u=Math.round(g+r*e))}function tc(i){const t=i.length;let e,s;if(t<2)return!1;for(s=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==s)return!1;return s}const ec=i=>i==="left"?"right":i==="right"?"left":i,Gs=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,$s=(i,t)=>Math.min(t||i,i);function qs(i,t){const e=[],s=i.length/t,h=i.length;let g=0;for(;g<h;g+=s)e.push(i[Math.floor(g)]);return e}function ic(i,t,e){const s=i.ticks.length,h=Math.min(t,s-1),g=i._startPixel,m=i._endPixel,r=1e-6;let n=i.getPixelForTick(h),l;if(!(e&&(s===1?l=Math.max(n-g,m-n):t===0?l=(i.getPixelForTick(1)-n)/2:l=(n-i.getPixelForTick(h-1))/2,n+=h<t?l:-l,n<g-r||n>m+r)))return n}function nc(i,t){pt(i,e=>{const s=e.gc,h=s.length/2;let g;if(h>t){for(g=0;g<h;++g)delete e.data[s[g]];s.splice(0,h)}})}function Xe(i){return i.drawTicks?i.tickLength:0}function Ks(i,t){if(!i.display)return 0;const e=kt(i.font,t),s=Et(i.padding);return(bt(i.text)?i.text.length:1)*e.lineHeight+s.height}function sc(i,t){return ge(i,{scale:t,type:"scale"})}function rc(i,t,e){return ge(i,{tick:e,index:t,type:"tick"})}function oc(i,t,e){let s=qn(i);return(e&&t!=="right"||!e&&t==="right")&&(s=ec(s)),s}function ac(i,t,e,s){const{top:h,left:g,bottom:m,right:r,chart:n}=i,{chartArea:l,scales:u}=n;let o=0,c,a,d;const p=m-h,f=r-g;if(i.isHorizontal()){if(a=Mt(s,g,r),ht(e)){const v=Object.keys(e)[0],_=e[v];d=u[v].getPixelForValue(_)+p-t}else e==="center"?d=(l.bottom+l.top)/2+p-t:d=Gs(i,e,t);c=r-g}else{if(ht(e)){const v=Object.keys(e)[0],_=e[v];a=u[v].getPixelForValue(_)-f+t}else e==="center"?a=(l.left+l.right)/2-f+t:a=Gs(i,e,t);d=Mt(s,m,h),o=e==="left"?-Tt:Tt}return{titleX:a,titleY:d,maxWidth:c,rotation:o}}class Me extends re{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:h}=this;return t=Bt(t,Number.POSITIVE_INFINITY),e=Bt(e,Number.NEGATIVE_INFINITY),s=Bt(s,Number.POSITIVE_INFINITY),h=Bt(h,Number.NEGATIVE_INFINITY),{min:Bt(t,s),max:Bt(e,h),minDefined:St(t),maxDefined:St(e)}}getMinMax(t){let{min:e,max:s,minDefined:h,maxDefined:g}=this.getUserBounds(),m;if(h&&g)return{min:e,max:s};const r=this.getMatchingVisibleMetas();for(let n=0,l=r.length;n<l;++n)m=r[n].controller.getMinMax(this,t),h||(e=Math.min(e,m.min)),g||(s=Math.max(s,m.max));return e=g&&e>s?s:e,s=h&&e>s?e:s,{min:Bt(e,Bt(s,e)),max:Bt(s,Bt(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){vt(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:h,grace:g,ticks:m}=this.options,r=m.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=ml(this,g,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const n=r<this.ticks.length;this._convertTicksToLabels(n?qs(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),m.display&&(m.autoSkip||m.source==="auto")&&(this.ticks=qh(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),n&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){vt(this.options.afterUpdate,[this])}beforeSetDimensions(){vt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){vt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),vt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){vt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,h,g;for(s=0,h=t.length;s<h;s++)g=t[s],g.label=vt(e.callback,[g.value,s,t],this)}afterTickToLabelConversion(){vt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){vt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=$s(this.ticks.length,t.ticks.maxTicksLimit),h=e.minRotation||0,g=e.maxRotation;let m=h,r,n,l;if(!this._isVisible()||!e.display||h>=g||s<=1||!this.isHorizontal()){this.labelRotation=h;return}const u=this._getLabelSizes(),o=u.widest.width,c=u.highest.height,a=Pt(this.chart.width-o,0,this.maxWidth);r=t.offset?this.maxWidth/s:a/(s-1),o+6>r&&(r=a/(s-(t.offset?.5:1)),n=this.maxHeight-Xe(t.grid)-e.padding-Ks(t.title,this.chart.options.font),l=Math.sqrt(o*o+c*c),m=Gn(Math.min(Math.asin(Pt((u.highest.height+6)/r,-1,1)),Math.asin(Pt(n/l,-1,1))-Math.asin(Pt(c/l,-1,1)))),m=Math.max(h,Math.min(g,m))),this.labelRotation=m}afterCalculateLabelRotation(){vt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){vt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:h,grid:g}}=this,m=this._isVisible(),r=this.isHorizontal();if(m){const n=Ks(h,e.options.font);if(r?(t.width=this.maxWidth,t.height=Xe(g)+n):(t.height=this.maxHeight,t.width=Xe(g)+n),s.display&&this.ticks.length){const{first:l,last:u,widest:o,highest:c}=this._getLabelSizes(),a=s.padding*2,d=Vt(this.labelRotation),p=Math.cos(d),f=Math.sin(d);if(r){const v=s.mirror?0:f*o.width+p*c.height;t.height=Math.min(this.maxHeight,t.height+v+a)}else{const v=s.mirror?0:p*o.width+f*c.height;t.width=Math.min(this.maxWidth,t.width+v+a)}this._calculatePadding(l,u,f,p)}}this._handleMargins(),r?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,h){const{ticks:{align:g,padding:m},position:r}=this.options,n=this.labelRotation!==0,l=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,o=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,a=0;n?l?(c=h*t.width,a=s*e.height):(c=s*t.height,a=h*e.width):g==="start"?a=e.width:g==="end"?c=t.width:g!=="inner"&&(c=t.width/2,a=e.width/2),this.paddingLeft=Math.max((c-u+m)*this.width/(this.width-u),0),this.paddingRight=Math.max((a-o+m)*this.width/(this.width-o),0)}else{let u=e.height/2,o=t.height/2;g==="start"?(u=0,o=t.height):g==="end"&&(u=e.height,o=0),this.paddingTop=u+m,this.paddingBottom=o+m}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){vt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)dt(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=qs(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:h,_longestTextCache:g}=this,m=[],r=[],n=Math.floor(e/$s(e,s));let l=0,u=0,o,c,a,d,p,f,v,_,b,y,x;for(o=0;o<e;o+=n){if(d=t[o].label,p=this._resolveTickFontOptions(o),h.font=f=p.string,v=g[f]=g[f]||{data:{},gc:[]},_=p.lineHeight,b=y=0,!dt(d)&&!bt(d))b=Ji(h,v.data,v.gc,b,d),y=_;else if(bt(d))for(c=0,a=d.length;c<a;++c)x=d[c],!dt(x)&&!bt(x)&&(b=Ji(h,v.data,v.gc,b,x),y+=_);m.push(b),r.push(y),l=Math.max(b,l),u=Math.max(y,u)}nc(g,e);const C=m.indexOf(l),S=r.indexOf(u),O=F=>({width:m[F]||0,height:r[F]||0});return{first:O(0),last:O(e-1),widest:O(C),highest:O(S),widths:m,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Ya(this._alignToPixels?ve(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=rc(this.getContext(),t,s))}return this.$context||(this.$context=sc(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Vt(this.labelRotation),s=Math.abs(Math.cos(e)),h=Math.abs(Math.sin(e)),g=this._getLabelSizes(),m=t.autoSkipPadding||0,r=g?g.widest.width+m:0,n=g?g.highest.height+m:0;return this.isHorizontal()?n*s>r*h?r/s:n/h:n*h<r*s?n/s:r/h}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,h=this.options,{grid:g,position:m,border:r}=h,n=g.offset,l=this.isHorizontal(),o=this.ticks.length+(n?1:0),c=Xe(g),a=[],d=r.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,v=function(Q){return ve(s,Q,p)};let _,b,y,x,C,S,O,F,R,z,X,J;if(m==="top")_=v(this.bottom),S=this.bottom-c,F=_-f,z=v(t.top)+f,J=t.bottom;else if(m==="bottom")_=v(this.top),z=t.top,J=v(t.bottom)-f,S=_+f,F=this.top+c;else if(m==="left")_=v(this.right),C=this.right-c,O=_-f,R=v(t.left)+f,X=t.right;else if(m==="right")_=v(this.left),R=t.left,X=v(t.right)-f,C=_+f,O=this.left+c;else if(e==="x"){if(m==="center")_=v((t.top+t.bottom)/2+.5);else if(ht(m)){const Q=Object.keys(m)[0],tt=m[Q];_=v(this.chart.scales[Q].getPixelForValue(tt))}z=t.top,J=t.bottom,S=_+f,F=S+c}else if(e==="y"){if(m==="center")_=v((t.left+t.right)/2);else if(ht(m)){const Q=Object.keys(m)[0],tt=m[Q];_=v(this.chart.scales[Q].getPixelForValue(tt))}C=_-f,O=C-c,R=t.left,X=t.right}const q=lt(h.ticks.maxTicksLimit,o),V=Math.max(1,Math.ceil(o/q));for(b=0;b<o;b+=V){const Q=this.getContext(b),tt=g.setContext(Q),et=r.setContext(Q),w=tt.lineWidth,M=tt.color,D=et.dash||[],P=et.dashOffset,I=tt.tickWidth,k=tt.tickColor,T=tt.tickBorderDash||[],A=tt.tickBorderDashOffset;y=ic(this,b,n),y!==void 0&&(x=ve(s,y,w),l?C=O=R=X=x:S=F=z=J=x,a.push({tx1:C,ty1:S,tx2:O,ty2:F,x1:R,y1:z,x2:X,y2:J,width:w,color:M,borderDash:D,borderDashOffset:P,tickWidth:I,tickColor:k,tickBorderDash:T,tickBorderDashOffset:A}))}return this._ticksLength=o,this._borderValue=_,a}_computeLabelItems(t){const e=this.axis,s=this.options,{position:h,ticks:g}=s,m=this.isHorizontal(),r=this.ticks,{align:n,crossAlign:l,padding:u,mirror:o}=g,c=Xe(s.grid),a=c+u,d=o?-u:a,p=-Vt(this.labelRotation),f=[];let v,_,b,y,x,C,S,O,F,R,z,X,J="middle";if(h==="top")C=this.bottom-d,S=this._getXAxisLabelAlignment();else if(h==="bottom")C=this.top+d,S=this._getXAxisLabelAlignment();else if(h==="left"){const V=this._getYAxisLabelAlignment(c);S=V.textAlign,x=V.x}else if(h==="right"){const V=this._getYAxisLabelAlignment(c);S=V.textAlign,x=V.x}else if(e==="x"){if(h==="center")C=(t.top+t.bottom)/2+a;else if(ht(h)){const V=Object.keys(h)[0],Q=h[V];C=this.chart.scales[V].getPixelForValue(Q)+a}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(h==="center")x=(t.left+t.right)/2-a;else if(ht(h)){const V=Object.keys(h)[0],Q=h[V];x=this.chart.scales[V].getPixelForValue(Q)}S=this._getYAxisLabelAlignment(c).textAlign}e==="y"&&(n==="start"?J="top":n==="end"&&(J="bottom"));const q=this._getLabelSizes();for(v=0,_=r.length;v<_;++v){b=r[v],y=b.label;const V=g.setContext(this.getContext(v));O=this.getPixelForTick(v)+g.labelOffset,F=this._resolveTickFontOptions(v),R=F.lineHeight,z=bt(y)?y.length:1;const Q=z/2,tt=V.color,et=V.textStrokeColor,w=V.textStrokeWidth;let M=S;m?(x=O,S==="inner"&&(v===_-1?M=this.options.reverse?"left":"right":v===0?M=this.options.reverse?"right":"left":M="center"),h==="top"?l==="near"||p!==0?X=-z*R+R/2:l==="center"?X=-q.highest.height/2-Q*R+R:X=-q.highest.height+R/2:l==="near"||p!==0?X=R/2:l==="center"?X=q.highest.height/2-Q*R:X=q.highest.height-z*R,o&&(X*=-1),p!==0&&!V.showLabelBackdrop&&(x+=R/2*Math.sin(p))):(C=O,X=(1-z)*R/2);let D;if(V.showLabelBackdrop){const P=Et(V.backdropPadding),I=q.heights[v],k=q.widths[v];let T=X-P.top,A=0-P.left;switch(J){case"middle":T-=I/2;break;case"bottom":T-=I;break}switch(S){case"center":A-=k/2;break;case"right":A-=k;break}D={left:A,top:T,width:k+P.width,height:I+P.height,color:V.backdropColor}}f.push({label:y,font:F,textOffset:X,options:{rotation:p,color:tt,strokeColor:et,strokeWidth:w,textAlign:M,textBaseline:J,translation:[x,C],backdrop:D}})}return f}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Vt(this.labelRotation))return t==="top"?"left":"right";let h="center";return e.align==="start"?h="left":e.align==="end"?h="right":e.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:h,padding:g}}=this.options,m=this._getLabelSizes(),r=t+g,n=m.widest.width;let l,u;return e==="left"?h?(u=this.right+g,s==="near"?l="left":s==="center"?(l="center",u+=n/2):(l="right",u+=n)):(u=this.right-r,s==="near"?l="right":s==="center"?(l="center",u-=n/2):(l="left",u=this.left)):e==="right"?h?(u=this.left+g,s==="near"?l="right":s==="center"?(l="center",u-=n/2):(l="left",u-=n)):(u=this.left+r,s==="near"?l="left":s==="center"?(l="center",u+=n/2):(l="right",u=this.right)):l="right",{textAlign:l,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:h,width:g,height:m}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,h,g,m),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const h=this.ticks.findIndex(g=>g.value===t);return h>=0?e.setContext(this.getContext(h)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let g,m;const r=(n,l,u)=>{!u.width||!u.color||(s.save(),s.lineWidth=u.width,s.strokeStyle=u.color,s.setLineDash(u.borderDash||[]),s.lineDashOffset=u.borderDashOffset,s.beginPath(),s.moveTo(n.x,n.y),s.lineTo(l.x,l.y),s.stroke(),s.restore())};if(e.display)for(g=0,m=h.length;g<m;++g){const n=h[g];e.drawOnChartArea&&r({x:n.x1,y:n.y1},{x:n.x2,y:n.y2},n),e.drawTicks&&r({x:n.tx1,y:n.ty1},{x:n.tx2,y:n.ty2},{color:n.tickColor,width:n.tickWidth,borderDash:n.tickBorderDash,borderDashOffset:n.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:h}}=this,g=s.setContext(this.getContext()),m=s.display?g.width:0;if(!m)return;const r=h.setContext(this.getContext(0)).lineWidth,n=this._borderValue;let l,u,o,c;this.isHorizontal()?(l=ve(t,this.left,m)-m/2,u=ve(t,this.right,r)+r/2,o=c=n):(o=ve(t,this.top,m)-m/2,c=ve(t,this.bottom,r)+r/2,l=u=n),e.save(),e.lineWidth=g.width,e.strokeStyle=g.color,e.beginPath(),e.moveTo(l,o),e.lineTo(u,c),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,h=this._computeLabelArea();h&&rn(s,h);const g=this.getLabelItems(t);for(const m of g){const r=m.options,n=m.font,l=m.label,u=m.textOffset;Pe(s,l,0,u,n,r)}h&&on(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:h}}=this;if(!s.display)return;const g=kt(s.font),m=Et(s.padding),r=s.align;let n=g.lineHeight/2;e==="bottom"||e==="center"||ht(e)?(n+=m.bottom,bt(s.text)&&(n+=g.lineHeight*(s.text.length-1))):n+=m.top;const{titleX:l,titleY:u,maxWidth:o,rotation:c}=ac(this,n,e,r);Pe(t,s.text,0,0,g,{color:s.color,maxWidth:o,rotation:c,textAlign:oc(r,e,h),textBaseline:"middle",translation:[l,u]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=lt(t.grid&&t.grid.z,-1),h=lt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Me.prototype.draw?[{z:e,draw:g=>{this.draw(g)}}]:[{z:s,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:e,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",h=[];let g,m;for(g=0,m=e.length;g<m;++g){const r=e[g];r[s]===this.id&&(!t||r.type===t)&&h.push(r)}return h}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return kt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Di{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;cc(e)&&(s=this.register(e));const h=this.items,g=t.id,m=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+t);return g in h||(h[g]=t,lc(t,m,s),this.override&&wt.override(t.id,t.overrides)),m}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,h=this.scope;s in e&&delete e[s],h&&s in wt[h]&&(delete wt[h][s],this.override&&delete ke[s])}}function lc(i,t,e){const s=ai(Object.create(null),[e?wt.get(e):{},wt.get(t),i.defaults]);wt.set(t,s),i.defaultRoutes&&hc(t,i.defaultRoutes),i.descriptors&&wt.describe(t,i.descriptors)}function hc(i,t){Object.keys(t).forEach(e=>{const s=e.split("."),h=s.pop(),g=[i].concat(s).join("."),m=t[e].split("."),r=m.pop(),n=m.join(".");wt.route(g,h,n,r)})}function cc(i){return"id"in i&&"defaults"in i}class uc{constructor(){this.controllers=new Di(Xt,"datasets",!0),this.elements=new Di(re,"elements"),this.plugins=new Di(Object,"plugins"),this.scales=new Di(Me,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(h=>{const g=s||this._getRegistryForType(h);s||g.isForType(h)||g===this.plugins&&h.id?this._exec(t,g,h):pt(h,m=>{const r=s||this._getRegistryForType(m);this._exec(t,r,m)})})}_exec(t,e,s){const h=Un(t);vt(s["before"+h],[],s),e[t](s),vt(s["after"+h],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const h=e.get(t);if(h===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return h}}var Gt=new uc;class fc{constructor(){this._init=[]}notify(t,e,s,h){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const g=h?this._descriptors(t).filter(h):this._descriptors(t),m=this._notify(g,t,e,s);return e==="afterDestroy"&&(this._notify(g,t,"stop"),this._notify(this._init,t,"uninstall")),m}_notify(t,e,s,h){h=h||{};for(const g of t){const m=g.plugin,r=m[s],n=[e,h,g.options];if(vt(r,n,m)===!1&&h.cancelable)return!1}return!0}invalidate(){dt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,h=lt(s.options&&s.options.plugins,{}),g=dc(s);return h===!1&&!e?[]:pc(t,g,h,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,h=(g,m)=>g.filter(r=>!m.some(n=>r.plugin.id===n.plugin.id));this._notify(h(e,s),t,"stop"),this._notify(h(s,e),t,"start")}}function dc(i){const t={},e=[],s=Object.keys(Gt.plugins.items);for(let g=0;g<s.length;g++)e.push(Gt.getPlugin(s[g]));const h=i.plugins||[];for(let g=0;g<h.length;g++){const m=h[g];e.indexOf(m)===-1&&(e.push(m),t[m.id]=!0)}return{plugins:e,localIds:t}}function gc(i,t){return!t&&i===!1?null:i===!0?{}:i}function pc(i,{plugins:t,localIds:e},s,h){const g=[],m=i.getContext();for(const r of t){const n=r.id,l=gc(s[n],h);l!==null&&g.push({plugin:r,options:mc(i.config,{plugin:r,local:e[n]},l,m)})}return g}function mc(i,{plugin:t,local:e},s,h){const g=i.pluginScopeKeys(t),m=i.getOptionScopes(s,g);return e&&t.defaults&&m.push(t.defaults),i.createResolver(m,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Dn(i,t){const e=wt.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function vc(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function _c(i,t){return i===t?"_index_":"_value_"}function Js(i){if(i==="x"||i==="y"||i==="r")return i}function bc(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function An(i,...t){if(Js(i))return i;for(const e of t){const s=e.axis||bc(e.position)||i.length>1&&Js(i[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function Qs(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function yc(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===i||s.yAxisID===i);if(e.length)return Qs(i,"x",e[0])||Qs(i,"y",e[0])}return{}}function xc(i,t){const e=ke[i.type]||{scales:{}},s=t.scales||{},h=Dn(i.type,t),g=Object.create(null);return Object.keys(s).forEach(m=>{const r=s[m];if(!ht(r))return console.error(`Invalid scale configuration for scale: ${m}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${m}`);const n=An(m,r,yc(m,i),wt.scales[r.type]),l=_c(n,h),u=e.scales||{};g[m]=Ze(Object.create(null),[{axis:n},r,u[n],u[l]])}),i.data.datasets.forEach(m=>{const r=m.type||i.type,n=m.indexAxis||Dn(r,t),u=(ke[r]||{}).scales||{};Object.keys(u).forEach(o=>{const c=vc(o,n),a=m[c+"AxisID"]||c;g[a]=g[a]||Object.create(null),Ze(g[a],[{axis:c},s[a],u[o]])})}),Object.keys(g).forEach(m=>{const r=g[m];Ze(r,[wt.scales[r.type],wt.scale])}),g}function yo(i){const t=i.options||(i.options={});t.plugins=lt(t.plugins,{}),t.scales=xc(i,t)}function xo(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function Cc(i){return i=i||{},i.data=xo(i.data),yo(i),i}const Zs=new Map,Co=new Set;function Ai(i,t){let e=Zs.get(i);return e||(e=t(),Zs.set(i,e),Co.add(e)),e}const Ye=(i,t,e)=>{const s=ue(t,e);s!==void 0&&i.add(s)};class Sc{constructor(t){this._config=Cc(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=xo(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),yo(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ai(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Ai(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Ai(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return Ai(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let h=s.get(t);return(!h||e)&&(h=new Map,s.set(t,h)),h}getOptionScopes(t,e,s){const{options:h,type:g}=this,m=this._cachedScopes(t,s),r=m.get(e);if(r)return r;const n=new Set;e.forEach(u=>{t&&(n.add(t),u.forEach(o=>Ye(n,t,o))),u.forEach(o=>Ye(n,h,o)),u.forEach(o=>Ye(n,ke[g]||{},o)),u.forEach(o=>Ye(n,wt,o)),u.forEach(o=>Ye(n,kn,o))});const l=Array.from(n);return l.length===0&&l.push(Object.create(null)),Co.has(e)&&m.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,ke[e]||{},wt.datasets[e]||{},{type:e},wt,kn]}resolveNamedOptions(t,e,s,h=[""]){const g={$shared:!0},{resolver:m,subPrefixes:r}=tr(this._resolverCache,t,h);let n=m;if(Tc(m,e)){g.$shared=!1,s=fe(s)?s():s;const l=this.createResolver(t,s,r);n=je(m,s,l)}for(const l of e)g[l]=n[l];return g}createResolver(t,e,s=[""],h){const{resolver:g}=tr(this._resolverCache,t,s);return ht(e)?je(g,e,void 0,h):g}}function tr(i,t,e){let s=i.get(t);s||(s=new Map,i.set(t,s));const h=e.join();let g=s.get(h);return g||(g={resolver:Qn(t,e),subPrefixes:e.filter(r=>!r.toLowerCase().includes("hover"))},s.set(h,g)),g}const wc=i=>ht(i)&&Object.getOwnPropertyNames(i).reduce((t,e)=>t||fe(i[e]),!1);function Tc(i,t){const{isScriptable:e,isIndexable:s}=Zr(i);for(const h of t){const g=e(h),m=s(h),r=(m||g)&&i[h];if(g&&(fe(r)||wc(r))||m&&bt(r))return!0}return!1}var Oc="4.4.0";const kc=["top","bottom","left","right","chartArea"];function er(i,t){return i==="top"||i==="bottom"||kc.indexOf(i)===-1&&t==="x"}function ir(i,t){return function(e,s){return e[i]===s[i]?e[t]-s[t]:e[i]-s[i]}}function nr(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),vt(e&&e.onComplete,[i],t)}function Pc(i){const t=i.chart,e=t.options.animation;vt(e&&e.onProgress,[i],t)}function So(i){return ro()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const Xi={},sr=i=>{const t=So(i);return Object.values(Xi).filter(e=>e.canvas===t).pop()};function Mc(i,t,e){const s=Object.keys(i);for(const h of s){const g=+h;if(g>=t){const m=i[h];delete i[h],(e>0||g>t)&&(i[g+e]=m)}}}function Dc(i,t,e,s){return!e||i.type==="mouseout"?null:s?t:i}function Ei(i,t,e){return i.options.clip?i[e]:t[e]}function Ac(i,t){const{xScale:e,yScale:s}=i;return e&&s?{left:Ei(e,t,"left"),right:Ei(e,t,"right"),top:Ei(s,t,"top"),bottom:Ei(s,t,"bottom")}:t}class $t{static register(...t){Gt.add(...t),rr()}static unregister(...t){Gt.remove(...t),rr()}constructor(t,e){const s=this.config=new Sc(e),h=So(t),g=sr(h);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const m=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||$h(h)),this.platform.updateConfig(s);const r=this.platform.acquireContext(h,m.aspectRatio),n=r&&r.canvas,l=n&&n.height,u=n&&n.width;if(this.id=Fa(),this.ctx=r,this.canvas=n,this.width=u,this.height=l,this._options=m,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new fc,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=qa(o=>this.update(o),m.resizeDelay||0),this._dataChanges=[],Xi[this.id]=this,!r||!n){console.error("Failed to create chart: can't acquire context from the given item");return}Qt.listen(this,"complete",nr),Qt.listen(this,"progress",Pc),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:h,_aspectRatio:g}=this;return dt(t)?e&&g?g:h?s/h:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Gt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Os(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Ss(this.canvas,this.ctx),this}stop(){return Qt.stop(this),this}resize(t,e){Qt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,h=this.canvas,g=s.maintainAspectRatio&&this.aspectRatio,m=this.platform.getMaximumSize(h,t,e,g),r=s.devicePixelRatio||this.platform.getDevicePixelRatio(),n=this.width?"resize":"attach";this.width=m.width,this.height=m.height,this._aspectRatio=this.aspectRatio,Os(this,r,!0)&&(this.notifyPlugins("resize",{size:m}),vt(s.onResize,[this,m],this),this.attached&&this._doResize(n)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};pt(e,(s,h)=>{s.id=h})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,h=Object.keys(s).reduce((m,r)=>(m[r]=!1,m),{});let g=[];e&&(g=g.concat(Object.keys(e).map(m=>{const r=e[m],n=An(m,r),l=n==="r",u=n==="x";return{options:r,dposition:l?"chartArea":u?"bottom":"left",dtype:l?"radialLinear":u?"category":"linear"}}))),pt(g,m=>{const r=m.options,n=r.id,l=An(n,r),u=lt(r.type,m.dtype);(r.position===void 0||er(r.position,l)!==er(m.dposition))&&(r.position=m.dposition),h[n]=!0;let o=null;if(n in s&&s[n].type===u)o=s[n];else{const c=Gt.getScale(u);o=new c({id:n,type:u,ctx:this.ctx,chart:this}),s[o.id]=o}o.init(r,t)}),pt(h,(m,r)=>{m||delete s[r]}),pt(s,m=>{At.configure(this,m,m.options),At.addBox(this,m)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((h,g)=>h.index-g.index),s>e){for(let h=e;h<s;++h)this._destroyDatasetMeta(h);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(ir("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,h)=>{e.filter(g=>g===s._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,h;for(this._removeUnreferencedMetasets(),s=0,h=e.length;s<h;s++){const g=e[s];let m=this.getDatasetMeta(s);const r=g.type||this.config.type;if(m.type&&m.type!==r&&(this._destroyDatasetMeta(s),m=this.getDatasetMeta(s)),m.type=r,m.indexAxis=g.indexAxis||Dn(r,this.options),m.order=g.order||0,m.index=s,m.label=""+g.label,m.visible=this.isDatasetVisible(s),m.controller)m.controller.updateIndex(s),m.controller.linkScales();else{const n=Gt.getController(r),{datasetElementType:l,dataElementType:u}=wt.datasets[r];Object.assign(n,{dataElementType:Gt.getElement(u),datasetElementType:l&&Gt.getElement(l)}),m.controller=new n(this,s),t.push(m.controller)}}return this._updateMetasets(),t}_resetElements(){pt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let m=0;for(let l=0,u=this.data.datasets.length;l<u;l++){const{controller:o}=this.getDatasetMeta(l),c=!h&&g.indexOf(o)===-1;o.buildOrUpdateElements(c),m=Math.max(+o.getMaxOverflow(),m)}m=this._minPadding=s.layout.autoPadding?m:0,this._updateLayout(m),h||pt(g,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(ir("z","_idx"));const{_active:r,_lastEvent:n}=this;n?this._eventHandler(n,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){pt(this.scales,t=>{At.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!gs(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:h,count:g}of e){const m=s==="_removeElements"?-g:g;Mc(t,h,m)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=g=>new Set(t.filter(m=>m[0]===g).map((m,r)=>r+","+m.splice(1).join(","))),h=s(0);for(let g=1;g<e;g++)if(!gs(h,s(g)))return;return Array.from(h).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;At.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],pt(this.boxes,h=>{s&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,g)=>{h._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,fe(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),h={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(s.controller._update(e),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Qt.has(this)?this.attached&&!Qt.running(this)&&Qt.start(this):(this.draw(),nr({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:h}=this._resizeBeforeDraw;this._resize(s,h),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let h,g;for(h=0,g=e.length;h<g;++h){const m=e[h];(!t||m.visible)&&s.push(m)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s=t._clip,h=!s.disabled,g=Ac(t,this.chartArea),m={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",m)!==!1&&(h&&rn(e,{left:s.left===!1?0:g.left-s.left,right:s.right===!1?this.width:g.right+s.right,top:s.top===!1?0:g.top-s.top,bottom:s.bottom===!1?this.height:g.bottom+s.bottom}),t.controller.draw(),h&&on(e),m.cancelable=!1,this.notifyPlugins("afterDatasetDraw",m))}isPointInArea(t){return ne(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,h){const g=kh.modes[e];return typeof g=="function"?g(this,t,s,h):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let h=s.filter(g=>g&&g._dataset===e).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(h)),h}getContext(){return this.$context||(this.$context=ge(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const h=s?"show":"hide",g=this.getDatasetMeta(t),m=g.controller._resolveAnimations(void 0,h);li(e)?(g.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),m.update(g,{visible:s}),this.update(r=>r.datasetIndex===t?h:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Qt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Ss(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Xi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(g,m)=>{e.addEventListener(this,g,m),t[g]=m},h=(g,m,r)=>{g.offsetX=m,g.offsetY=r,this._eventHandler(g)};pt(this.options.events,g=>s(g,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(n,l)=>{e.addEventListener(this,n,l),t[n]=l},h=(n,l)=>{t[n]&&(e.removeEventListener(this,n,l),delete t[n])},g=(n,l)=>{this.canvas&&this.resize(n,l)};let m;const r=()=>{h("attach",r),this.attached=!0,this.resize(),s("resize",g),s("detach",m)};m=()=>{this.attached=!1,h("resize",g),this._stop(),this._resize(0,0),s("attach",r)},e.isAttached(this.canvas)?r():m()}unbindEvents(){pt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},pt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const h=s?"set":"remove";let g,m,r,n;for(e==="dataset"&&(g=this.getDatasetMeta(t[0].datasetIndex),g.controller["_"+h+"DatasetHoverStyle"]()),r=0,n=t.length;r<n;++r){m=t[r];const l=m&&this.getDatasetMeta(m.datasetIndex).controller;l&&l[h+"HoverStyle"](m.element,m.datasetIndex,m.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:g,index:m})=>{const r=this.getDatasetMeta(g);if(!r)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:r.data[m],index:m}});!$i(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const h=this.options.hover,g=(n,l)=>n.filter(u=>!l.some(o=>u.datasetIndex===o.datasetIndex&&u.index===o.index)),m=g(e,t),r=s?t:g(t,e);m.length&&this.updateHoverStyle(m,h.mode,!1),r.length&&h.mode&&this.updateHoverStyle(r,h.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},h=m=>(m.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,h)===!1)return;const g=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,h),(g||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:h=[],options:g}=this,m=e,r=this._getActiveElements(t,h,s,m),n=za(t),l=Dc(t,this._lastEvent,s,n);s&&(this._lastEvent=null,vt(g.onHover,[t,r,this],this),n&&vt(g.onClick,[t,r,this],this));const u=!$i(r,h);return(u||e)&&(this._active=r,this._updateHoverStyles(r,h,e)),this._lastEvent=l,u}_getActiveElements(t,e,s,h){if(t.type==="mouseout")return[];if(!s)return e;const g=this.options.hover;return this.getElementsAtEventForMode(t,g.mode,g,h)}}Z($t,"defaults",wt),Z($t,"instances",Xi),Z($t,"overrides",ke),Z($t,"registry",Gt),Z($t,"version",Oc),Z($t,"getChart",sr);function rr(){return pt($t.instances,i=>i._plugins.invalidate())}function Ec(i,t,e){const{startAngle:s,pixelMargin:h,x:g,y:m,outerRadius:r,innerRadius:n}=t;let l=h/r;i.beginPath(),i.arc(g,m,r,s-l,e+l),n>h?(l=h/n,i.arc(g,m,n,e+l,s-l,!0)):i.arc(g,m,h,e+Tt,s-Tt),i.closePath(),i.clip()}function Fc(i){return Jn(i,["outerStart","outerEnd","innerStart","innerEnd"])}function Lc(i,t,e,s){const h=Fc(i.options.borderRadius),g=(e-t)/2,m=Math.min(g,s*t/2),r=n=>{const l=(e-Math.min(g,n))*s/2;return Pt(n,0,Math.min(g,l))};return{outerStart:r(h.outerStart),outerEnd:r(h.outerEnd),innerStart:Pt(h.innerStart,0,m),innerEnd:Pt(h.innerEnd,0,m)}}function Ee(i,t,e,s){return{x:e+i*Math.cos(t),y:s+i*Math.sin(t)}}function tn(i,t,e,s,h,g){const{x:m,y:r,startAngle:n,pixelMargin:l,innerRadius:u}=t,o=Math.max(t.outerRadius+s+e-l,0),c=u>0?u+s+e+l:0;let a=0;const d=h-n;if(s){const V=u>0?u-s:0,Q=o>0?o-s:0,tt=(V+Q)/2,et=tt!==0?d*tt/(tt+s):d;a=(d-et)/2}const p=Math.max(.001,d*o-e/xt)/o,f=(d-p)/2,v=n+f+a,_=h-f-a,{outerStart:b,outerEnd:y,innerStart:x,innerEnd:C}=Lc(t,c,o,_-v),S=o-b,O=o-y,F=v+b/S,R=_-y/O,z=c+x,X=c+C,J=v+x/z,q=_-C/X;if(i.beginPath(),g){const V=(F+R)/2;if(i.arc(m,r,o,F,V),i.arc(m,r,o,V,R),y>0){const w=Ee(O,R,m,r);i.arc(w.x,w.y,y,R,_+Tt)}const Q=Ee(X,_,m,r);if(i.lineTo(Q.x,Q.y),C>0){const w=Ee(X,q,m,r);i.arc(w.x,w.y,C,_+Tt,q+Math.PI)}const tt=(_-C/c+(v+x/c))/2;if(i.arc(m,r,c,_-C/c,tt,!0),i.arc(m,r,c,tt,v+x/c,!0),x>0){const w=Ee(z,J,m,r);i.arc(w.x,w.y,x,J+Math.PI,v-Tt)}const et=Ee(S,v,m,r);if(i.lineTo(et.x,et.y),b>0){const w=Ee(S,F,m,r);i.arc(w.x,w.y,b,v-Tt,F)}}else{i.moveTo(m,r);const V=Math.cos(F)*o+m,Q=Math.sin(F)*o+r;i.lineTo(V,Q);const tt=Math.cos(R)*o+m,et=Math.sin(R)*o+r;i.lineTo(tt,et)}i.closePath()}function Rc(i,t,e,s,h){const{fullCircles:g,startAngle:m,circumference:r}=t;let n=t.endAngle;if(g){tn(i,t,e,s,n,h);for(let l=0;l<g;++l)i.fill();isNaN(r)||(n=m+(r%yt||yt))}return tn(i,t,e,s,n,h),i.fill(),n}function Ic(i,t,e,s,h){const{fullCircles:g,startAngle:m,circumference:r,options:n}=t,{borderWidth:l,borderJoinStyle:u,borderDash:o,borderDashOffset:c}=n,a=n.borderAlign==="inner";if(!l)return;i.setLineDash(o||[]),i.lineDashOffset=c,a?(i.lineWidth=l*2,i.lineJoin=u||"round"):(i.lineWidth=l,i.lineJoin=u||"bevel");let d=t.endAngle;if(g){tn(i,t,e,s,d,h);for(let p=0;p<g;++p)i.stroke();isNaN(r)||(d=m+(r%yt||yt))}a&&Ec(i,t,d),g||(tn(i,t,e,s,d,h),i.stroke())}class qe extends re{constructor(e){super();Z(this,"circumference");Z(this,"endAngle");Z(this,"fullCircles");Z(this,"innerRadius");Z(this,"outerRadius");Z(this,"pixelMargin");Z(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,h){const g=this.getProps(["x","y"],h),{angle:m,distance:r}=Vr(g,{x:e,y:s}),{startAngle:n,endAngle:l,innerRadius:u,outerRadius:o,circumference:c}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),a=(this.options.spacing+this.options.borderWidth)/2,p=lt(c,l-n)>=yt||hi(m,n,l),f=ee(r,u+a,o+a);return p&&f}getCenterPoint(e){const{x:s,y:h,startAngle:g,endAngle:m,innerRadius:r,outerRadius:n}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:l,spacing:u}=this.options,o=(g+m)/2,c=(r+n+u+l)/2;return{x:s+Math.cos(o)*c,y:h+Math.sin(o)*c}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:h}=this,g=(s.offset||0)/4,m=(s.spacing||0)/2,r=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=h>yt?Math.floor(h/yt):0,h===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const n=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(n)*g,Math.sin(n)*g);const l=1-Math.sin(Math.min(xt,h||0)),u=g*l;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,Rc(e,this,u,m,r),Ic(e,this,u,m,r),e.restore()}}Z(qe,"id","arc"),Z(qe,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),Z(qe,"defaultRoutes",{backgroundColor:"backgroundColor"}),Z(qe,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function wo(i,t,e=t){i.lineCap=lt(e.borderCapStyle,t.borderCapStyle),i.setLineDash(lt(e.borderDash,t.borderDash)),i.lineDashOffset=lt(e.borderDashOffset,t.borderDashOffset),i.lineJoin=lt(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=lt(e.borderWidth,t.borderWidth),i.strokeStyle=lt(e.borderColor,t.borderColor)}function Bc(i,t,e){i.lineTo(e.x,e.y)}function jc(i){return i.stepped?al:i.tension||i.cubicInterpolationMode==="monotone"?ll:Bc}function To(i,t,e={}){const s=i.length,{start:h=0,end:g=s-1}=e,{start:m,end:r}=t,n=Math.max(h,m),l=Math.min(g,r),u=h<m&&g<m||h>r&&g>r;return{count:s,start:n,loop:t.loop,ilen:l<n&&!u?s+l-n:l-n}}function zc(i,t,e,s){const{points:h,options:g}=t,{count:m,start:r,loop:n,ilen:l}=To(h,e,s),u=jc(g);let{move:o=!0,reverse:c}=s||{},a,d,p;for(a=0;a<=l;++a)d=h[(r+(c?l-a:a))%m],!d.skip&&(o?(i.moveTo(d.x,d.y),o=!1):u(i,p,d,c,g.stepped),p=d);return n&&(d=h[(r+(c?l:0))%m],u(i,p,d,c,g.stepped)),!!n}function Wc(i,t,e,s){const h=t.points,{count:g,start:m,ilen:r}=To(h,e,s),{move:n=!0,reverse:l}=s||{};let u=0,o=0,c,a,d,p,f,v;const _=y=>(m+(l?r-y:y))%g,b=()=>{p!==f&&(i.lineTo(u,f),i.lineTo(u,p),i.lineTo(u,v))};for(n&&(a=h[_(0)],i.moveTo(a.x,a.y)),c=0;c<=r;++c){if(a=h[_(c)],a.skip)continue;const y=a.x,x=a.y,C=y|0;C===d?(x<p?p=x:x>f&&(f=x),u=(o*u+y)/++o):(b(),i.lineTo(y,x),d=C,o=0,p=f=x),v=x}b()}function En(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Wc:zc}function Hc(i){return i.stepped?Wl:i.tension||i.cubicInterpolationMode==="monotone"?Hl:xe}function Nc(i,t,e,s){let h=t._path;h||(h=t._path=new Path2D,t.path(h,e,s)&&h.closePath()),wo(i,t.options),i.stroke(h)}function Vc(i,t,e,s){const{segments:h,options:g}=t,m=En(t);for(const r of h)wo(i,g,r.style),i.beginPath(),m(i,t,r,{start:e,end:e+s-1})&&i.closePath(),i.stroke()}const Xc=typeof Path2D=="function";function Yc(i,t,e,s){Xc&&!t.options.segment?Nc(i,t,e,s):Vc(i,t,e,s)}class le extends re{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const h=s.spanGaps?this._loop:this._fullLoop;El(this._points,s,t,h,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Gl(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,h=t[e],g=this.points,m=co(this,{property:e,start:h,end:h});if(!m.length)return;const r=[],n=Hc(s);let l,u;for(l=0,u=m.length;l<u;++l){const{start:o,end:c}=m[l],a=g[o],d=g[c];if(a===d){r.push(a);continue}const p=Math.abs((h-a[e])/(d[e]-a[e])),f=n(a,d,p,s.stepped);f[e]=t[e],r.push(f)}return r.length===1?r[0]:r}pathSegment(t,e,s){return En(this)(t,this,e,s)}path(t,e,s){const h=this.segments,g=En(this);let m=this._loop;e=e||0,s=s||this.points.length-e;for(const r of h)m&=g(t,this,r,{start:e,end:e+s-1});return!!m}draw(t,e,s,h){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(t.save(),Yc(t,this,s,h),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Z(le,"id","line"),Z(le,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Z(le,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Z(le,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function or(i,t,e,s){const h=i.options,{[e]:g}=i.getProps([e],s);return Math.abs(t-g)<h.radius+h.hitRadius}class Yi extends re{constructor(e){super();Z(this,"parsed");Z(this,"skip");Z(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,h){const g=this.options,{x:m,y:r}=this.getProps(["x","y"],h);return Math.pow(e-m,2)+Math.pow(s-r,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(e,s){return or(this,e,"x",s)}inYRange(e,s){return or(this,e,"y",s)}getCenterPoint(e){const{x:s,y:h}=this.getProps(["x","y"],e);return{x:s,y:h}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const h=s&&e.borderWidth||0;return(s+h)*2}draw(e,s){const h=this.options;this.skip||h.radius<.1||!ne(this,s,this.size(h)/2)||(e.strokeStyle=h.borderColor,e.lineWidth=h.borderWidth,e.fillStyle=h.backgroundColor,Pn(e,h,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}Z(Yi,"id","point"),Z(Yi,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Z(Yi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Oo(i,t){const{x:e,y:s,base:h,width:g,height:m}=i.getProps(["x","y","base","width","height"],t);let r,n,l,u,o;return i.horizontal?(o=m/2,r=Math.min(e,h),n=Math.max(e,h),l=s-o,u=s+o):(o=g/2,r=e-o,n=e+o,l=Math.min(s,h),u=Math.max(s,h)),{left:r,top:l,right:n,bottom:u}}function he(i,t,e,s){return i?0:Pt(t,e,s)}function Uc(i,t,e){const s=i.options.borderWidth,h=i.borderSkipped,g=Qr(s);return{t:he(h.top,g.top,0,e),r:he(h.right,g.right,0,t),b:he(h.bottom,g.bottom,0,e),l:he(h.left,g.left,0,t)}}function Gc(i,t,e){const{enableBorderRadius:s}=i.getProps(["enableBorderRadius"]),h=i.options.borderRadius,g=we(h),m=Math.min(t,e),r=i.borderSkipped,n=s||ht(h);return{topLeft:he(!n||r.top||r.left,g.topLeft,0,m),topRight:he(!n||r.top||r.right,g.topRight,0,m),bottomLeft:he(!n||r.bottom||r.left,g.bottomLeft,0,m),bottomRight:he(!n||r.bottom||r.right,g.bottomRight,0,m)}}function $c(i){const t=Oo(i),e=t.right-t.left,s=t.bottom-t.top,h=Uc(i,e/2,s/2),g=Gc(i,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:g},inner:{x:t.left+h.l,y:t.top+h.t,w:e-h.l-h.r,h:s-h.t-h.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,g.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(h.b,h.r))}}}}function yn(i,t,e,s){const h=t===null,g=e===null,r=i&&!(h&&g)&&Oo(i,s);return r&&(h||ee(t,r.left,r.right))&&(g||ee(e,r.top,r.bottom))}function qc(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function Kc(i,t){i.rect(t.x,t.y,t.w,t.h)}function xn(i,t,e={}){const s=i.x!==e.x?-t:0,h=i.y!==e.y?-t:0,g=(i.x+i.w!==e.x+e.w?t:0)-s,m=(i.y+i.h!==e.y+e.h?t:0)-h;return{x:i.x+s,y:i.y+h,w:i.w+g,h:i.h+m,radius:i.radius}}class Ui extends re{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:h}}=this,{inner:g,outer:m}=$c(this),r=qc(m.radius)?ci:Kc;t.save(),(m.w!==g.w||m.h!==g.h)&&(t.beginPath(),r(t,xn(m,e,g)),t.clip(),r(t,xn(g,-e,m)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),r(t,xn(g,e)),t.fillStyle=h,t.fill(),t.restore()}inRange(t,e,s){return yn(this,t,e,s)}inXRange(t,e){return yn(this,t,null,e)}inYRange(t,e){return yn(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:h,horizontal:g}=this.getProps(["x","y","base","horizontal"],t);return{x:g?(e+h)/2:e,y:g?s:(s+h)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}Z(Ui,"id","bar"),Z(Ui,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Z(Ui,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Jc=Object.freeze({__proto__:null,ArcElement:qe,BarElement:Ui,LineElement:le,PointElement:Yi});const Fn=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ar=Fn.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function ko(i){return Fn[i%Fn.length]}function Po(i){return ar[i%ar.length]}function Qc(i,t){return i.borderColor=ko(t),i.backgroundColor=Po(t),++t}function Zc(i,t){return i.backgroundColor=i.data.map(()=>ko(t++)),t}function tu(i,t){return i.backgroundColor=i.data.map(()=>Po(t++)),t}function eu(i){let t=0;return(e,s)=>{const h=i.getDatasetMeta(s).controller;h instanceof Se?t=Zc(e,t):h instanceof ni?t=tu(e,t):h&&(t=Qc(e,t))}}function lr(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function iu(i){return i&&(i.borderColor||i.backgroundColor)}var nu={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:s},options:h}=i.config,{elements:g}=h;if(!e.forceOverride&&(lr(s)||iu(h)||g&&lr(g)))return;const m=eu(i);s.forEach(m)}};function su(i,t,e,s,h){const g=h.samples||s;if(g>=e)return i.slice(t,t+e);const m=[],r=(e-2)/(g-2);let n=0;const l=t+e-1;let u=t,o,c,a,d,p;for(m[n++]=i[u],o=0;o<g-2;o++){let f=0,v=0,_;const b=Math.floor((o+1)*r)+1+t,y=Math.min(Math.floor((o+2)*r)+1,e)+t,x=y-b;for(_=b;_<y;_++)f+=i[_].x,v+=i[_].y;f/=x,v/=x;const C=Math.floor(o*r)+1+t,S=Math.min(Math.floor((o+1)*r)+1,e)+t,{x:O,y:F}=i[u];for(a=d=-1,_=C;_<S;_++)d=.5*Math.abs((O-f)*(i[_].y-F)-(O-i[_].x)*(v-F)),d>a&&(a=d,c=i[_],p=_);m[n++]=c,u=p}return m[n++]=i[l],m}function ru(i,t,e,s){let h=0,g=0,m,r,n,l,u,o,c,a,d,p;const f=[],v=t+e-1,_=i[t].x,y=i[v].x-_;for(m=t;m<t+e;++m){r=i[m],n=(r.x-_)/y*s,l=r.y;const x=n|0;if(x===u)l<d?(d=l,o=m):l>p&&(p=l,c=m),h=(g*h+r.x)/++g;else{const C=m-1;if(!dt(o)&&!dt(c)){const S=Math.min(o,c),O=Math.max(o,c);S!==a&&S!==C&&f.push({...i[S],x:h}),O!==a&&O!==C&&f.push({...i[O],x:h})}m>0&&C!==a&&f.push(i[C]),f.push(r),u=x,g=0,d=p=l,o=c=a=m}}return f}function Mo(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function hr(i){i.data.datasets.forEach(t=>{Mo(t)})}function ou(i,t){const e=t.length;let s=0,h;const{iScale:g}=i,{min:m,max:r,minDefined:n,maxDefined:l}=g.getUserBounds();return n&&(s=Pt(ie(t,g.axis,m).lo,0,e-1)),l?h=Pt(ie(t,g.axis,r).hi+1,s,e)-s:h=e-s,{start:s,count:h}}var au={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){hr(i);return}const s=i.width;i.data.datasets.forEach((h,g)=>{const{_data:m,indexAxis:r}=h,n=i.getDatasetMeta(g),l=m||h.data;if(Ge([r,i.options.indexAxis])==="y"||!n.controller.supportsDecimation)return;const u=i.scales[n.xAxisID];if(u.type!=="linear"&&u.type!=="time"||i.options.parsing)return;let{start:o,count:c}=ou(n,l);const a=e.threshold||4*s;if(c<=a){Mo(h);return}dt(m)&&(h._data=l,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let d;switch(e.algorithm){case"lttb":d=su(l,o,c,s,e);break;case"min-max":d=ru(l,o,c,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}h._decimated=d})},destroy(i){hr(i)}};function lu(i,t,e){const s=i.segments,h=i.points,g=t.points,m=[];for(const r of s){let{start:n,end:l}=r;l=ns(n,l,h);const u=Ln(e,h[n],h[l],r.loop);if(!t.segments){m.push({source:r,target:u,start:h[n],end:h[l]});continue}const o=co(t,u);for(const c of o){const a=Ln(e,g[c.start],g[c.end],c.loop),d=ho(r,h,a);for(const p of d)m.push({source:p,target:c,start:{[e]:cr(u,a,"start",Math.max)},end:{[e]:cr(u,a,"end",Math.min)}})}}return m}function Ln(i,t,e,s){if(s)return;let h=t[i],g=e[i];return i==="angle"&&(h=jt(h),g=jt(g)),{property:i,start:h,end:g}}function hu(i,t){const{x:e=null,y:s=null}=i||{},h=t.points,g=[];return t.segments.forEach(({start:m,end:r})=>{r=ns(m,r,h);const n=h[m],l=h[r];s!==null?(g.push({x:n.x,y:s}),g.push({x:l.x,y:s})):e!==null&&(g.push({x:e,y:n.y}),g.push({x:e,y:l.y}))}),g}function ns(i,t,e){for(;t>i;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function cr(i,t,e,s){return i&&t?s(i[e],t[e]):i?i[e]:t?t[e]:0}function Do(i,t){let e=[],s=!1;return bt(i)?(s=!0,e=i):e=hu(i,t),e.length?new le({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function ur(i){return i&&i.fill!==!1}function cu(i,t,e){let h=i[t].fill;const g=[t];let m;if(!e)return h;for(;h!==!1&&g.indexOf(h)===-1;){if(!St(h))return h;if(m=i[h],!m)return!1;if(m.visible)return h;g.push(h),h=m.fill}return!1}function uu(i,t,e){const s=pu(i);if(ht(s))return isNaN(s.value)?!1:s;let h=parseFloat(s);return St(h)&&Math.floor(h)===h?fu(s[0],t,h,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function fu(i,t,e,s){return(i==="-"||i==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function du(i,t){let e=null;return i==="start"?e=t.bottom:i==="end"?e=t.top:ht(i)?e=t.getPixelForValue(i.value):t.getBasePixel&&(e=t.getBasePixel()),e}function gu(i,t,e){let s;return i==="start"?s=e:i==="end"?s=t.options.reverse?t.min:t.max:ht(i)?s=i.value:s=t.getBaseValue(),s}function pu(i){const t=i.options,e=t.fill;let s=lt(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function mu(i){const{scale:t,index:e,line:s}=i,h=[],g=s.segments,m=s.points,r=vu(t,e);r.push(Do({x:null,y:t.bottom},s));for(let n=0;n<g.length;n++){const l=g[n];for(let u=l.start;u<=l.end;u++)_u(h,m[u],r)}return new le({points:h,options:{}})}function vu(i,t){const e=[],s=i.getMatchingVisibleMetas("line");for(let h=0;h<s.length;h++){const g=s[h];if(g.index===t)break;g.hidden||e.unshift(g.dataset)}return e}function _u(i,t,e){const s=[];for(let h=0;h<e.length;h++){const g=e[h],{first:m,last:r,point:n}=bu(g,t,"x");if(!(!n||m&&r)){if(m)s.unshift(n);else if(i.push(n),!r)break}}i.push(...s)}function bu(i,t,e){const s=i.interpolate(t,e);if(!s)return{};const h=s[e],g=i.segments,m=i.points;let r=!1,n=!1;for(let l=0;l<g.length;l++){const u=g[l],o=m[u.start][e],c=m[u.end][e];if(ee(h,o,c)){r=h===o,n=h===c;break}}return{first:r,last:n,point:s}}class Ao{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:h,y:g,radius:m}=this;return e=e||{start:0,end:yt},t.arc(h,g,m,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:h}=this,g=t.angle;return{x:e+Math.cos(g)*h,y:s+Math.sin(g)*h,angle:g}}}function yu(i){const{chart:t,fill:e,line:s}=i;if(St(e))return xu(t,e);if(e==="stack")return mu(i);if(e==="shape")return!0;const h=Cu(i);return h instanceof Ao?h:Do(h,s)}function xu(i,t){const e=i.getDatasetMeta(t);return e&&i.isDatasetVisible(t)?e.dataset:null}function Cu(i){return(i.scale||{}).getPointPositionForValue?wu(i):Su(i)}function Su(i){const{scale:t={},fill:e}=i,s=du(e,t);if(St(s)){const h=t.isHorizontal();return{x:h?s:null,y:h?null:s}}return null}function wu(i){const{scale:t,fill:e}=i,s=t.options,h=t.getLabels().length,g=s.reverse?t.max:t.min,m=gu(e,t,g),r=[];if(s.grid.circular){const n=t.getPointPositionForValue(0,g);return new Ao({x:n.x,y:n.y,radius:t.getDistanceFromCenterForValue(m)})}for(let n=0;n<h;++n)r.push(t.getPointPositionForValue(n,m));return r}function Cn(i,t,e){const s=yu(t),{line:h,scale:g,axis:m}=t,r=h.options,n=r.fill,l=r.backgroundColor,{above:u=l,below:o=l}=n||{};s&&h.points.length&&(rn(i,e),Tu(i,{line:h,target:s,above:u,below:o,area:e,scale:g,axis:m}),on(i))}function Tu(i,t){const{line:e,target:s,above:h,below:g,area:m,scale:r}=t,n=e._loop?"angle":t.axis;i.save(),n==="x"&&g!==h&&(fr(i,s,m.top),dr(i,{line:e,target:s,color:h,scale:r,property:n}),i.restore(),i.save(),fr(i,s,m.bottom)),dr(i,{line:e,target:s,color:g,scale:r,property:n}),i.restore()}function fr(i,t,e){const{segments:s,points:h}=t;let g=!0,m=!1;i.beginPath();for(const r of s){const{start:n,end:l}=r,u=h[n],o=h[ns(n,l,h)];g?(i.moveTo(u.x,u.y),g=!1):(i.lineTo(u.x,e),i.lineTo(u.x,u.y)),m=!!t.pathSegment(i,r,{move:m}),m?i.closePath():i.lineTo(o.x,e)}i.lineTo(t.first().x,e),i.closePath(),i.clip()}function dr(i,t){const{line:e,target:s,property:h,color:g,scale:m}=t,r=lu(e,s,h);for(const{source:n,target:l,start:u,end:o}of r){const{style:{backgroundColor:c=g}={}}=n,a=s!==!0;i.save(),i.fillStyle=c,Ou(i,m,a&&Ln(h,u,o)),i.beginPath();const d=!!e.pathSegment(i,n);let p;if(a){d?i.closePath():gr(i,s,o,h);const f=!!s.pathSegment(i,l,{move:d,reverse:!0});p=d&&f,p||gr(i,s,u,h)}i.closePath(),i.fill(p?"evenodd":"nonzero"),i.restore()}}function Ou(i,t,e){const{top:s,bottom:h}=t.chart.chartArea,{property:g,start:m,end:r}=e||{};g==="x"&&(i.beginPath(),i.rect(m,s,r-m,h-s),i.clip())}function gr(i,t,e,s){const h=t.interpolate(e,s);h&&i.lineTo(h.x,h.y)}var ku={id:"filler",afterDatasetsUpdate(i,t,e){const s=(i.data.datasets||[]).length,h=[];let g,m,r,n;for(m=0;m<s;++m)g=i.getDatasetMeta(m),r=g.dataset,n=null,r&&r.options&&r instanceof le&&(n={visible:i.isDatasetVisible(m),index:m,fill:uu(r,m,s),chart:i,axis:g.controller.options.indexAxis,scale:g.vScale,line:r}),g.$filler=n,h.push(n);for(m=0;m<s;++m)n=h[m],!(!n||n.fill===!1)&&(n.fill=cu(h,m,e.propagate))},beforeDraw(i,t,e){const s=e.drawTime==="beforeDraw",h=i.getSortedVisibleDatasetMetas(),g=i.chartArea;for(let m=h.length-1;m>=0;--m){const r=h[m].$filler;r&&(r.line.updateControlPoints(g,r.axis),s&&r.fill&&Cn(i.ctx,r,g))}},beforeDatasetsDraw(i,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=i.getSortedVisibleDatasetMetas();for(let h=s.length-1;h>=0;--h){const g=s[h].$filler;ur(g)&&Cn(i.ctx,g,i.chartArea)}},beforeDatasetDraw(i,t,e){const s=t.meta.$filler;!ur(s)||e.drawTime!=="beforeDatasetDraw"||Cn(i.ctx,s,i.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const pr=(i,t)=>{let{boxHeight:e=t,boxWidth:s=t}=i;return i.usePointStyle&&(e=Math.min(e,t),s=i.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},Pu=(i,t)=>i!==null&&t!==null&&i.datasetIndex===t.datasetIndex&&i.index===t.index;class mr extends re{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=vt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,h)=>t.sort(s,h,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,h=kt(s.font),g=h.size,m=this._computeTitleHeight(),{boxWidth:r,itemHeight:n}=pr(s,g);let l,u;e.font=h.string,this.isHorizontal()?(l=this.maxWidth,u=this._fitRows(m,g,r,n)+10):(u=this.maxHeight,l=this._fitCols(m,h,r,n)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(u,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,h){const{ctx:g,maxWidth:m,options:{labels:{padding:r}}}=this,n=this.legendHitBoxes=[],l=this.lineWidths=[0],u=h+r;let o=t;g.textAlign="left",g.textBaseline="middle";let c=-1,a=-u;return this.legendItems.forEach((d,p)=>{const f=s+e/2+g.measureText(d.text).width;(p===0||l[l.length-1]+f+2*r>m)&&(o+=u,l[l.length-(p>0?0:1)]=0,a+=u,c++),n[p]={left:0,top:a,row:c,width:f,height:h},l[l.length-1]+=f+r}),o}_fitCols(t,e,s,h){const{ctx:g,maxHeight:m,options:{labels:{padding:r}}}=this,n=this.legendHitBoxes=[],l=this.columnSizes=[],u=m-t;let o=r,c=0,a=0,d=0,p=0;return this.legendItems.forEach((f,v)=>{const{itemWidth:_,itemHeight:b}=Mu(s,e,g,f,h);v>0&&a+b+2*r>u&&(o+=c+r,l.push({width:c,height:a}),d+=c+r,p++,c=a=0),n[v]={left:d,top:a,col:p,width:_,height:b},c=Math.max(c,_),a+=b+r}),o+=c,l.push({width:c,height:a}),o}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:h},rtl:g}}=this,m=Re(g,this.left,this.width);if(this.isHorizontal()){let r=0,n=Mt(s,this.left+h,this.right-this.lineWidths[r]);for(const l of e)r!==l.row&&(r=l.row,n=Mt(s,this.left+h,this.right-this.lineWidths[r])),l.top+=this.top+t+h,l.left=m.leftForLtr(m.x(n),l.width),n+=l.width+h}else{let r=0,n=Mt(s,this.top+t+h,this.bottom-this.columnSizes[r].height);for(const l of e)l.col!==r&&(r=l.col,n=Mt(s,this.top+t+h,this.bottom-this.columnSizes[r].height)),l.top=n,l.left+=this.left+h,l.left=m.leftForLtr(m.x(l.left),l.width),n+=l.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;rn(t,this),this._draw(),on(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:h}=this,{align:g,labels:m}=t,r=wt.color,n=Re(t.rtl,this.left,this.width),l=kt(m.font),{padding:u}=m,o=l.size,c=o/2;let a;this.drawTitle(),h.textAlign=n.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=l.string;const{boxWidth:d,boxHeight:p,itemHeight:f}=pr(m,o),v=function(C,S,O){if(isNaN(d)||d<=0||isNaN(p)||p<0)return;h.save();const F=lt(O.lineWidth,1);if(h.fillStyle=lt(O.fillStyle,r),h.lineCap=lt(O.lineCap,"butt"),h.lineDashOffset=lt(O.lineDashOffset,0),h.lineJoin=lt(O.lineJoin,"miter"),h.lineWidth=F,h.strokeStyle=lt(O.strokeStyle,r),h.setLineDash(lt(O.lineDash,[])),m.usePointStyle){const R={radius:p*Math.SQRT2/2,pointStyle:O.pointStyle,rotation:O.rotation,borderWidth:F},z=n.xPlus(C,d/2),X=S+c;Jr(h,R,z,X,m.pointStyleWidth&&d)}else{const R=S+Math.max((o-p)/2,0),z=n.leftForLtr(C,d),X=we(O.borderRadius);h.beginPath(),Object.values(X).some(J=>J!==0)?ci(h,{x:z,y:R,w:d,h:p,radius:X}):h.rect(z,R,d,p),h.fill(),F!==0&&h.stroke()}h.restore()},_=function(C,S,O){Pe(h,O.text,C,S+f/2,l,{strikethrough:O.hidden,textAlign:n.textAlign(O.textAlign)})},b=this.isHorizontal(),y=this._computeTitleHeight();b?a={x:Mt(g,this.left+u,this.right-s[0]),y:this.top+u+y,line:0}:a={x:this.left+u,y:Mt(g,this.top+y+u,this.bottom-e[0].height),line:0},oo(this.ctx,t.textDirection);const x=f+u;this.legendItems.forEach((C,S)=>{h.strokeStyle=C.fontColor,h.fillStyle=C.fontColor;const O=h.measureText(C.text).width,F=n.textAlign(C.textAlign||(C.textAlign=m.textAlign)),R=d+c+O;let z=a.x,X=a.y;n.setWidth(this.width),b?S>0&&z+R+u>this.right&&(X=a.y+=x,a.line++,z=a.x=Mt(g,this.left+u,this.right-s[a.line])):S>0&&X+x>this.bottom&&(z=a.x=z+e[a.line].width+u,a.line++,X=a.y=Mt(g,this.top+y+u,this.bottom-e[a.line].height));const J=n.x(z);if(v(J,X,C),z=Ka(F,z+d+c,b?z+R:this.right,t.rtl),_(n.x(z),X,C),b)a.x+=R+u;else if(typeof C.text!="string"){const q=l.lineHeight;a.y+=Eo(C,q)+u}else a.y+=x}),ao(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=kt(e.font),h=Et(e.padding);if(!e.display)return;const g=Re(t.rtl,this.left,this.width),m=this.ctx,r=e.position,n=s.size/2,l=h.top+n;let u,o=this.left,c=this.width;if(this.isHorizontal())c=Math.max(...this.lineWidths),u=this.top+l,o=Mt(t.align,o,this.right-c);else{const d=this.columnSizes.reduce((p,f)=>Math.max(p,f.height),0);u=l+Mt(t.align,this.top,this.bottom-d-t.labels.padding-this._computeTitleHeight())}const a=Mt(r,o,o+c);m.textAlign=g.textAlign(qn(r)),m.textBaseline="middle",m.strokeStyle=e.color,m.fillStyle=e.color,m.font=s.string,Pe(m,e.text,a,u,s)}_computeTitleHeight(){const t=this.options.title,e=kt(t.font),s=Et(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,h,g;if(ee(t,this.left,this.right)&&ee(e,this.top,this.bottom)){for(g=this.legendHitBoxes,s=0;s<g.length;++s)if(h=g[s],ee(t,h.left,h.left+h.width)&&ee(e,h.top,h.top+h.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!Eu(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const h=this._hoveredItem,g=Pu(h,s);h&&!g&&vt(e.onLeave,[t,h,this],this),this._hoveredItem=s,s&&!g&&vt(e.onHover,[t,s,this],this)}else s&&vt(e.onClick,[t,s,this],this)}}function Mu(i,t,e,s,h){const g=Du(s,i,t,e),m=Au(h,s,t.lineHeight);return{itemWidth:g,itemHeight:m}}function Du(i,t,e,s){let h=i.text;return h&&typeof h!="string"&&(h=h.reduce((g,m)=>g.length>m.length?g:m)),t+e.size/2+s.measureText(h).width}function Au(i,t,e){let s=i;return typeof t.text!="string"&&(s=Eo(t,e)),s}function Eo(i,t){const e=i.text?i.text.length:0;return t*e}function Eu(i,t){return!!((i==="mousemove"||i==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(i==="click"||i==="mouseup"))}var Fu={id:"legend",_element:mr,start(i,t,e){const s=i.legend=new mr({ctx:i.ctx,options:e,chart:i});At.configure(i,s,e),At.addBox(i,s)},stop(i){At.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,t,e){const s=i.legend;At.configure(i,s,e),s.options=e},afterUpdate(i){const t=i.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(i,t){t.replay||i.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,t,e){const s=t.datasetIndex,h=e.chart;h.isDatasetVisible(s)?(h.hide(s),t.hidden=!0):(h.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const t=i.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:h,color:g,useBorderRadius:m,borderRadius:r}}=i.legend.options;return i._getSortedDatasetMetas().map(n=>{const l=n.controller.getStyle(e?0:void 0),u=Et(l.borderWidth);return{text:t[n.index].label,fillStyle:l.backgroundColor,fontColor:g,hidden:!n.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:l.borderColor,pointStyle:s||l.pointStyle,rotation:l.rotation,textAlign:h||l.textAlign,borderRadius:m&&(r||l.borderRadius),datasetIndex:n.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};class ss extends re{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const h=bt(s.text)?s.text.length:1;this._padding=Et(s.padding);const g=h*kt(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:h,right:g,options:m}=this,r=m.align;let n=0,l,u,o;return this.isHorizontal()?(u=Mt(r,s,g),o=e+t,l=g-s):(m.position==="left"?(u=s+t,o=Mt(r,h,e),n=xt*-.5):(u=g-t,o=Mt(r,e,h),n=xt*.5),l=h-e),{titleX:u,titleY:o,maxWidth:l,rotation:n}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=kt(e.font),g=s.lineHeight/2+this._padding.top,{titleX:m,titleY:r,maxWidth:n,rotation:l}=this._drawArgs(g);Pe(t,e.text,0,0,s,{color:e.color,maxWidth:n,rotation:l,textAlign:qn(e.align),textBaseline:"middle",translation:[m,r]})}}function Lu(i,t){const e=new ss({ctx:i.ctx,options:t,chart:i});At.configure(i,e,t),At.addBox(i,e),i.titleBlock=e}var Ru={id:"title",_element:ss,start(i,t,e){Lu(i,e)},stop(i){const t=i.titleBlock;At.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const s=i.titleBlock;At.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fi=new WeakMap;var Iu={id:"subtitle",start(i,t,e){const s=new ss({ctx:i.ctx,options:e,chart:i});At.configure(i,s,e),At.addBox(i,s),Fi.set(i,s)},stop(i){At.removeBox(i,Fi.get(i)),Fi.delete(i)},beforeUpdate(i,t,e){const s=Fi.get(i);At.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ke={average(i){if(!i.length)return!1;let t,e,s=0,h=0,g=0;for(t=0,e=i.length;t<e;++t){const m=i[t].element;if(m&&m.hasValue()){const r=m.tooltipPosition();s+=r.x,h+=r.y,++g}}return{x:s/g,y:h/g}},nearest(i,t){if(!i.length)return!1;let e=t.x,s=t.y,h=Number.POSITIVE_INFINITY,g,m,r;for(g=0,m=i.length;g<m;++g){const n=i[g].element;if(n&&n.hasValue()){const l=n.getCenterPoint(),u=On(t,l);u<h&&(h=u,r=n)}}if(r){const n=r.tooltipPosition();e=n.x,s=n.y}return{x:e,y:s}}};function Ut(i,t){return t&&(bt(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function Zt(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function Bu(i,t){const{element:e,datasetIndex:s,index:h}=t,g=i.getDatasetMeta(s).controller,{label:m,value:r}=g.getLabelAndValue(h);return{chart:i,label:m,parsed:g.getParsed(h),raw:i.data.datasets[s].data[h],formattedValue:r,dataset:g.getDataset(),dataIndex:h,datasetIndex:s,element:e}}function vr(i,t){const e=i.chart.ctx,{body:s,footer:h,title:g}=i,{boxWidth:m,boxHeight:r}=t,n=kt(t.bodyFont),l=kt(t.titleFont),u=kt(t.footerFont),o=g.length,c=h.length,a=s.length,d=Et(t.padding);let p=d.height,f=0,v=s.reduce((y,x)=>y+x.before.length+x.lines.length+x.after.length,0);if(v+=i.beforeBody.length+i.afterBody.length,o&&(p+=o*l.lineHeight+(o-1)*t.titleSpacing+t.titleMarginBottom),v){const y=t.displayColors?Math.max(r,n.lineHeight):n.lineHeight;p+=a*y+(v-a)*n.lineHeight+(v-1)*t.bodySpacing}c&&(p+=t.footerMarginTop+c*u.lineHeight+(c-1)*t.footerSpacing);let _=0;const b=function(y){f=Math.max(f,e.measureText(y).width+_)};return e.save(),e.font=l.string,pt(i.title,b),e.font=n.string,pt(i.beforeBody.concat(i.afterBody),b),_=t.displayColors?m+2+t.boxPadding:0,pt(s,y=>{pt(y.before,b),pt(y.lines,b),pt(y.after,b)}),_=0,e.font=u.string,pt(i.footer,b),e.restore(),f+=d.width,{width:f,height:p}}function ju(i,t){const{y:e,height:s}=t;return e<s/2?"top":e>i.height-s/2?"bottom":"center"}function zu(i,t,e,s){const{x:h,width:g}=s,m=e.caretSize+e.caretPadding;if(i==="left"&&h+g+m>t.width||i==="right"&&h-g-m<0)return!0}function Wu(i,t,e,s){const{x:h,width:g}=e,{width:m,chartArea:{left:r,right:n}}=i;let l="center";return s==="center"?l=h<=(r+n)/2?"left":"right":h<=g/2?l="left":h>=m-g/2&&(l="right"),zu(l,i,t,e)&&(l="center"),l}function _r(i,t,e){const s=e.yAlign||t.yAlign||ju(i,e);return{xAlign:e.xAlign||t.xAlign||Wu(i,t,e,s),yAlign:s}}function Hu(i,t){let{x:e,width:s}=i;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function Nu(i,t,e){let{y:s,height:h}=i;return t==="top"?s+=e:t==="bottom"?s-=h+e:s-=h/2,s}function br(i,t,e,s){const{caretSize:h,caretPadding:g,cornerRadius:m}=i,{xAlign:r,yAlign:n}=e,l=h+g,{topLeft:u,topRight:o,bottomLeft:c,bottomRight:a}=we(m);let d=Hu(t,r);const p=Nu(t,n,l);return n==="center"?r==="left"?d+=l:r==="right"&&(d-=l):r==="left"?d-=Math.max(u,c)+h:r==="right"&&(d+=Math.max(o,a)+h),{x:Pt(d,0,s.width-t.width),y:Pt(p,0,s.height-t.height)}}function Li(i,t,e){const s=Et(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-s.right:i.x+s.left}function yr(i){return Ut([],Zt(i))}function Vu(i,t,e){return ge(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function xr(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const Fo={beforeTitle:Jt,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Jt,beforeBody:Jt,beforeLabel:Jt,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return dt(e)||(t+=e),t},labelColor(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Jt,afterBody:Jt,beforeFooter:Jt,footer:Jt,afterFooter:Jt};function Rt(i,t,e,s){const h=i[t].call(e,s);return typeof h>"u"?Fo[t].call(e,s):h}class Rn extends re{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),h=s.enabled&&e.options.animation&&s.animations,g=new uo(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=Vu(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,h=Rt(s,"beforeTitle",this,t),g=Rt(s,"title",this,t),m=Rt(s,"afterTitle",this,t);let r=[];return r=Ut(r,Zt(h)),r=Ut(r,Zt(g)),r=Ut(r,Zt(m)),r}getBeforeBody(t,e){return yr(Rt(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,h=[];return pt(t,g=>{const m={before:[],lines:[],after:[]},r=xr(s,g);Ut(m.before,Zt(Rt(r,"beforeLabel",this,g))),Ut(m.lines,Rt(r,"label",this,g)),Ut(m.after,Zt(Rt(r,"afterLabel",this,g))),h.push(m)}),h}getAfterBody(t,e){return yr(Rt(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,h=Rt(s,"beforeFooter",this,t),g=Rt(s,"footer",this,t),m=Rt(s,"afterFooter",this,t);let r=[];return r=Ut(r,Zt(h)),r=Ut(r,Zt(g)),r=Ut(r,Zt(m)),r}_createItems(t){const e=this._active,s=this.chart.data,h=[],g=[],m=[];let r=[],n,l;for(n=0,l=e.length;n<l;++n)r.push(Bu(this.chart,e[n]));return t.filter&&(r=r.filter((u,o,c)=>t.filter(u,o,c,s))),t.itemSort&&(r=r.sort((u,o)=>t.itemSort(u,o,s))),pt(r,u=>{const o=xr(t.callbacks,u);h.push(Rt(o,"labelColor",this,u)),g.push(Rt(o,"labelPointStyle",this,u)),m.push(Rt(o,"labelTextColor",this,u))}),this.labelColors=h,this.labelPointStyles=g,this.labelTextColors=m,this.dataPoints=r,r}update(t,e){const s=this.options.setContext(this.getContext()),h=this._active;let g,m=[];if(!h.length)this.opacity!==0&&(g={opacity:0});else{const r=Ke[s.position].call(this,h,this._eventPosition);m=this._createItems(s),this.title=this.getTitle(m,s),this.beforeBody=this.getBeforeBody(m,s),this.body=this.getBody(m,s),this.afterBody=this.getAfterBody(m,s),this.footer=this.getFooter(m,s);const n=this._size=vr(this,s),l=Object.assign({},r,n),u=_r(this.chart,s,l),o=br(s,l,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,g={opacity:1,x:o.x,y:o.y,width:n.width,height:n.height,caretX:r.x,caretY:r.y}}this._tooltipItems=m,this.$context=void 0,g&&this._resolveAnimations().update(this,g),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,h){const g=this.getCaretPosition(t,s,h);e.lineTo(g.x1,g.y1),e.lineTo(g.x2,g.y2),e.lineTo(g.x3,g.y3)}getCaretPosition(t,e,s){const{xAlign:h,yAlign:g}=this,{caretSize:m,cornerRadius:r}=s,{topLeft:n,topRight:l,bottomLeft:u,bottomRight:o}=we(r),{x:c,y:a}=t,{width:d,height:p}=e;let f,v,_,b,y,x;return g==="center"?(y=a+p/2,h==="left"?(f=c,v=f-m,b=y+m,x=y-m):(f=c+d,v=f+m,b=y-m,x=y+m),_=f):(h==="left"?v=c+Math.max(n,u)+m:h==="right"?v=c+d-Math.max(l,o)-m:v=this.caretX,g==="top"?(b=a,y=b-m,f=v-m,_=v+m):(b=a+p,y=b+m,f=v+m,_=v-m),x=b),{x1:f,x2:v,x3:_,y1:b,y2:y,y3:x}}drawTitle(t,e,s){const h=this.title,g=h.length;let m,r,n;if(g){const l=Re(s.rtl,this.x,this.width);for(t.x=Li(this,s.titleAlign,s),e.textAlign=l.textAlign(s.titleAlign),e.textBaseline="middle",m=kt(s.titleFont),r=s.titleSpacing,e.fillStyle=s.titleColor,e.font=m.string,n=0;n<g;++n)e.fillText(h[n],l.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+r,n+1===g&&(t.y+=s.titleMarginBottom-r)}}_drawColorBox(t,e,s,h,g){const m=this.labelColors[s],r=this.labelPointStyles[s],{boxHeight:n,boxWidth:l}=g,u=kt(g.bodyFont),o=Li(this,"left",g),c=h.x(o),a=n<u.lineHeight?(u.lineHeight-n)/2:0,d=e.y+a;if(g.usePointStyle){const p={radius:Math.min(l,n)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},f=h.leftForLtr(c,l)+l/2,v=d+n/2;t.strokeStyle=g.multiKeyBackground,t.fillStyle=g.multiKeyBackground,Pn(t,p,f,v),t.strokeStyle=m.borderColor,t.fillStyle=m.backgroundColor,Pn(t,p,f,v)}else{t.lineWidth=ht(m.borderWidth)?Math.max(...Object.values(m.borderWidth)):m.borderWidth||1,t.strokeStyle=m.borderColor,t.setLineDash(m.borderDash||[]),t.lineDashOffset=m.borderDashOffset||0;const p=h.leftForLtr(c,l),f=h.leftForLtr(h.xPlus(c,1),l-2),v=we(m.borderRadius);Object.values(v).some(_=>_!==0)?(t.beginPath(),t.fillStyle=g.multiKeyBackground,ci(t,{x:p,y:d,w:l,h:n,radius:v}),t.fill(),t.stroke(),t.fillStyle=m.backgroundColor,t.beginPath(),ci(t,{x:f,y:d+1,w:l-2,h:n-2,radius:v}),t.fill()):(t.fillStyle=g.multiKeyBackground,t.fillRect(p,d,l,n),t.strokeRect(p,d,l,n),t.fillStyle=m.backgroundColor,t.fillRect(f,d+1,l-2,n-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:h}=this,{bodySpacing:g,bodyAlign:m,displayColors:r,boxHeight:n,boxWidth:l,boxPadding:u}=s,o=kt(s.bodyFont);let c=o.lineHeight,a=0;const d=Re(s.rtl,this.x,this.width),p=function(O){e.fillText(O,d.x(t.x+a),t.y+c/2),t.y+=c+g},f=d.textAlign(m);let v,_,b,y,x,C,S;for(e.textAlign=m,e.textBaseline="middle",e.font=o.string,t.x=Li(this,f,s),e.fillStyle=s.bodyColor,pt(this.beforeBody,p),a=r&&f!=="right"?m==="center"?l/2+u:l+2+u:0,y=0,C=h.length;y<C;++y){for(v=h[y],_=this.labelTextColors[y],e.fillStyle=_,pt(v.before,p),b=v.lines,r&&b.length&&(this._drawColorBox(e,t,y,d,s),c=Math.max(o.lineHeight,n)),x=0,S=b.length;x<S;++x)p(b[x]),c=o.lineHeight;pt(v.after,p)}a=0,c=o.lineHeight,pt(this.afterBody,p),t.y-=g}drawFooter(t,e,s){const h=this.footer,g=h.length;let m,r;if(g){const n=Re(s.rtl,this.x,this.width);for(t.x=Li(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=n.textAlign(s.footerAlign),e.textBaseline="middle",m=kt(s.footerFont),e.fillStyle=s.footerColor,e.font=m.string,r=0;r<g;++r)e.fillText(h[r],n.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+s.footerSpacing}}drawBackground(t,e,s,h){const{xAlign:g,yAlign:m}=this,{x:r,y:n}=t,{width:l,height:u}=s,{topLeft:o,topRight:c,bottomLeft:a,bottomRight:d}=we(h.cornerRadius);e.fillStyle=h.backgroundColor,e.strokeStyle=h.borderColor,e.lineWidth=h.borderWidth,e.beginPath(),e.moveTo(r+o,n),m==="top"&&this.drawCaret(t,e,s,h),e.lineTo(r+l-c,n),e.quadraticCurveTo(r+l,n,r+l,n+c),m==="center"&&g==="right"&&this.drawCaret(t,e,s,h),e.lineTo(r+l,n+u-d),e.quadraticCurveTo(r+l,n+u,r+l-d,n+u),m==="bottom"&&this.drawCaret(t,e,s,h),e.lineTo(r+a,n+u),e.quadraticCurveTo(r,n+u,r,n+u-a),m==="center"&&g==="left"&&this.drawCaret(t,e,s,h),e.lineTo(r,n+o),e.quadraticCurveTo(r,n,r+o,n),e.closePath(),e.fill(),h.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,h=s&&s.x,g=s&&s.y;if(h||g){const m=Ke[t.position].call(this,this._active,this._eventPosition);if(!m)return;const r=this._size=vr(this,t),n=Object.assign({},m,this._size),l=_r(e,t,n),u=br(t,n,l,e);(h._to!==u.x||g._to!==u.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=r.width,this.height=r.height,this.caretX=m.x,this.caretY=m.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const h={width:this.width,height:this.height},g={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const m=Et(e.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&r&&(t.save(),t.globalAlpha=s,this.drawBackground(g,t,h,e),oo(t,e.textDirection),g.y+=m.top,this.drawTitle(g,t,e),this.drawBody(g,t,e),this.drawFooter(g,t,e),ao(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,h=t.map(({datasetIndex:r,index:n})=>{const l=this.chart.getDatasetMeta(r);if(!l)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:l.data[n],index:n}}),g=!$i(s,h),m=this._positionChanged(h,e);(g||m)&&(this._active=h,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,g=this._active||[],m=this._getActiveElements(t,g,e,s),r=this._positionChanged(m,t),n=e||!$i(m,g)||r;return n&&(this._active=m,(h.enabled||h.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),n}_getActiveElements(t,e,s,h){const g=this.options;if(t.type==="mouseout")return[];if(!h)return e;const m=this.chart.getElementsAtEventForMode(t,g.mode,g,s);return g.reverse&&m.reverse(),m}_positionChanged(t,e){const{caretX:s,caretY:h,options:g}=this,m=Ke[g.position].call(this,t,e);return m!==!1&&(s!==m.x||h!==m.y)}}Z(Rn,"positioners",Ke);var Xu={id:"tooltip",_element:Rn,positioners:Ke,afterInit(i,t,e){e&&(i.tooltip=new Rn({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Fo},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Yu=Object.freeze({__proto__:null,Colors:nu,Decimation:au,Filler:ku,Legend:Fu,SubTitle:Iu,Title:Ru,Tooltip:Xu});const Uu=(i,t,e,s)=>(typeof t=="string"?(e=i.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function Gu(i,t,e,s){const h=i.indexOf(t);if(h===-1)return Uu(i,t,e,s);const g=i.lastIndexOf(t);return h!==g?e:h}const $u=(i,t)=>i===null?null:Pt(Math.round(i),0,t);function Cr(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class In extends Me{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:h,label:g}of e)s[h]===g&&s.splice(h,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(dt(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:Gu(s,t,lt(e,t),this._addedLabels),$u(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(h=this.getLabels().length-1)),this.min=s,this.max=h}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,h=[];let g=this.getLabels();g=t===0&&e===g.length-1?g:g.slice(t,e+1),this._valueRange=Math.max(g.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let m=t;m<=e;m++)h.push({value:m});return h}getLabelForValue(t){return Cr.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}Z(In,"id","category"),Z(In,"defaults",{ticks:{callback:Cr}});function qu(i,t){const e=[],{bounds:h,step:g,min:m,max:r,precision:n,count:l,maxTicks:u,maxDigits:o,includeBounds:c}=i,a=g||1,d=u-1,{min:p,max:f}=t,v=!dt(m),_=!dt(r),b=!dt(l),y=(f-p)/(o+1);let x=ms((f-p)/d/a)*a,C,S,O,F;if(x<1e-14&&!v&&!_)return[{value:p},{value:f}];F=Math.ceil(f/x)-Math.floor(p/x),F>d&&(x=ms(F*x/d/a)*a),dt(n)||(C=Math.pow(10,n),x=Math.ceil(x*C)/C),h==="ticks"?(S=Math.floor(p/x)*x,O=Math.ceil(f/x)*x):(S=p,O=f),v&&_&&g&&Va((r-m)/g,x/1e3)?(F=Math.round(Math.min((r-m)/x,u)),x=(r-m)/F,S=m,O=r):b?(S=v?m:S,O=_?r:O,F=l-1,x=(O-S)/F):(F=(O-S)/x,ti(F,Math.round(F),x/1e3)?F=Math.round(F):F=Math.ceil(F));const R=Math.max(vs(x),vs(S));C=Math.pow(10,dt(n)?R:n),S=Math.round(S*C)/C,O=Math.round(O*C)/C;let z=0;for(v&&(c&&S!==m?(e.push({value:m}),S<m&&z++,ti(Math.round((S+z*x)*C)/C,m,Sr(m,y,i))&&z++):S<m&&z++);z<F;++z){const X=Math.round((S+z*x)*C)/C;if(_&&X>r)break;e.push({value:X})}return _&&c&&O!==r?e.length&&ti(e[e.length-1].value,r,Sr(r,y,i))?e[e.length-1].value=r:e.push({value:r}):(!_||O===r)&&e.push({value:O}),e}function Sr(i,t,{horizontal:e,minRotation:s}){const h=Vt(s),g=(e?Math.sin(h):Math.cos(h))||.001,m=.75*t*(""+i).length;return Math.min(t/g,m)}class en extends Me{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return dt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:h,max:g}=this;const m=n=>h=e?h:n,r=n=>g=s?g:n;if(t){const n=qt(h),l=qt(g);n<0&&l<0?r(0):n>0&&l>0&&m(0)}if(h===g){let n=g===0?1:Math.abs(g*.05);r(g+n),t||m(h-n)}this.min=h,this.max=g}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,h;return s?(h=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),e=e||11),e&&(h=Math.min(e,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const h={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},g=this._range||this,m=qu(h,g);return t.bounds==="ticks"&&Nr(m,this,"value"),t.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const h=(s-e)/Math.max(t.length-1,1)/2;e-=h,s+=h}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return yi(t,this.chart.options.locale,this.options.ticks.format)}}class Bn extends en{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=St(t)?t:0,this.max=St(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=Vt(this.options.ticks.minRotation),h=(t?Math.sin(s):Math.cos(s))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,g.lineHeight/h))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}Z(Bn,"id","linear"),Z(Bn,"defaults",{ticks:{callback:sn.formatters.numeric}});const fi=i=>Math.floor(ae(i)),be=(i,t)=>Math.pow(10,fi(i)+t);function wr(i){return i/Math.pow(10,fi(i))===1}function Tr(i,t,e){const s=Math.pow(10,e),h=Math.floor(i/s);return Math.ceil(t/s)-h}function Ku(i,t){const e=t-i;let s=fi(e);for(;Tr(i,t,s)>10;)s++;for(;Tr(i,t,s)<10;)s--;return Math.min(s,fi(i))}function Ju(i,{min:t,max:e}){t=Bt(i.min,t);const s=[],h=fi(t);let g=Ku(t,e),m=g<0?Math.pow(10,Math.abs(g)):1;const r=Math.pow(10,g),n=h>g?Math.pow(10,h):0,l=Math.round((t-n)*m)/m,u=Math.floor((t-n)/r/10)*r*10;let o=Math.floor((l-u)/Math.pow(10,g)),c=Bt(i.min,Math.round((n+u+o*Math.pow(10,g))*m)/m);for(;c<e;)s.push({value:c,major:wr(c),significand:o}),o>=10?o=o<15?15:20:o++,o>=20&&(g++,o=2,m=g>=0?1:m),c=Math.round((n+u+o*Math.pow(10,g))*m)/m;const a=Bt(i.max,c);return s.push({value:a,major:wr(a),significand:o}),s}class jn extends Me{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=en.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return St(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=St(t)?Math.max(0,t):null,this.max=St(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!St(this._userMin)&&(this.min=t===be(this.min,0)?be(this.min,-1):be(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,h=this.max;const g=r=>s=t?s:r,m=r=>h=e?h:r;s===h&&(s<=0?(g(1),m(10)):(g(be(s,-1)),m(be(h,1)))),s<=0&&g(be(h,-1)),h<=0&&m(be(s,1)),this.min=s,this.max=h}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=Ju(e,this);return t.bounds==="ticks"&&Nr(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":yi(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=ae(t),this._valueRange=ae(this.max)-ae(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(ae(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}Z(jn,"id","logarithmic"),Z(jn,"defaults",{ticks:{callback:sn.formatters.logarithmic,major:{enabled:!0}}});function zn(i){const t=i.ticks;if(t.display&&i.display){const e=Et(t.backdropPadding);return lt(t.font&&t.font.size,wt.font.size)+e.height}return 0}function Qu(i,t,e){return e=bt(e)?e:[e],{w:ol(i,t.string,e),h:e.length*t.lineHeight}}function Or(i,t,e,s,h){return i===s||i===h?{start:t-e/2,end:t+e/2}:i<s||i>h?{start:t-e,end:t}:{start:t,end:t+e}}function Zu(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),s=[],h=[],g=i._pointLabels.length,m=i.options.pointLabels,r=m.centerPointLabels?xt/g:0;for(let n=0;n<g;n++){const l=m.setContext(i.getPointLabelContext(n));h[n]=l.padding;const u=i.getPointPosition(n,i.drawingArea+h[n],r),o=kt(l.font),c=Qu(i.ctx,o,i._pointLabels[n]);s[n]=c;const a=jt(i.getIndexAngle(n)+r),d=Math.round(Gn(a)),p=Or(d,u.x,c.w,0,180),f=Or(d,u.y,c.h,90,270);tf(e,t,a,p,f)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=sf(i,s,h)}function tf(i,t,e,s,h){const g=Math.abs(Math.sin(e)),m=Math.abs(Math.cos(e));let r=0,n=0;s.start<t.l?(r=(t.l-s.start)/g,i.l=Math.min(i.l,t.l-r)):s.end>t.r&&(r=(s.end-t.r)/g,i.r=Math.max(i.r,t.r+r)),h.start<t.t?(n=(t.t-h.start)/m,i.t=Math.min(i.t,t.t-n)):h.end>t.b&&(n=(h.end-t.b)/m,i.b=Math.max(i.b,t.b+n))}function ef(i,t,e){const s=i.drawingArea,{extra:h,additionalAngle:g,padding:m,size:r}=e,n=i.getPointPosition(t,s+h+m,g),l=Math.round(Gn(jt(n.angle+Tt))),u=af(n.y,r.h,l),o=rf(l),c=of(n.x,r.w,o);return{visible:!0,x:n.x,y:u,textAlign:o,left:c,top:u,right:c+r.w,bottom:u+r.h}}function nf(i,t){if(!t)return!0;const{left:e,top:s,right:h,bottom:g}=i;return!(ne({x:e,y:s},t)||ne({x:e,y:g},t)||ne({x:h,y:s},t)||ne({x:h,y:g},t))}function sf(i,t,e){const s=[],h=i._pointLabels.length,g=i.options,{centerPointLabels:m,display:r}=g.pointLabels,n={extra:zn(g)/2,additionalAngle:m?xt/h:0};let l;for(let u=0;u<h;u++){n.padding=e[u],n.size=t[u];const o=ef(i,u,n);s.push(o),r==="auto"&&(o.visible=nf(o,l),o.visible&&(l=o))}return s}function rf(i){return i===0||i===180?"center":i<180?"left":"right"}function of(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function af(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function lf(i,t,e){const{left:s,top:h,right:g,bottom:m}=e,{backdropColor:r}=t;if(!dt(r)){const n=we(t.borderRadius),l=Et(t.backdropPadding);i.fillStyle=r;const u=s-l.left,o=h-l.top,c=g-s+l.width,a=m-h+l.height;Object.values(n).some(d=>d!==0)?(i.beginPath(),ci(i,{x:u,y:o,w:c,h:a,radius:n}),i.fill()):i.fillRect(u,o,c,a)}}function hf(i,t){const{ctx:e,options:{pointLabels:s}}=i;for(let h=t-1;h>=0;h--){const g=i._pointLabelItems[h];if(!g.visible)continue;const m=s.setContext(i.getPointLabelContext(h));lf(e,m,g);const r=kt(m.font),{x:n,y:l,textAlign:u}=g;Pe(e,i._pointLabels[h],n,l+r.lineHeight/2,r,{color:m.color,textAlign:u,textBaseline:"middle"})}}function Lo(i,t,e,s){const{ctx:h}=i;if(e)h.arc(i.xCenter,i.yCenter,t,0,yt);else{let g=i.getPointPosition(0,t);h.moveTo(g.x,g.y);for(let m=1;m<s;m++)g=i.getPointPosition(m,t),h.lineTo(g.x,g.y)}}function cf(i,t,e,s,h){const g=i.ctx,m=t.circular,{color:r,lineWidth:n}=t;!m&&!s||!r||!n||e<0||(g.save(),g.strokeStyle=r,g.lineWidth=n,g.setLineDash(h.dash),g.lineDashOffset=h.dashOffset,g.beginPath(),Lo(i,e,m,s),g.closePath(),g.stroke(),g.restore())}function uf(i,t,e){return ge(i,{label:e,index:t,type:"pointLabel"})}class Je extends en{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Et(zn(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=St(t)&&!isNaN(t)?t:0,this.max=St(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/zn(this.options))}generateTickLabels(t){en.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const h=vt(this.options.pointLabels.callback,[e,s],this);return h||h===0?h:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?Zu(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,h){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,h))}getIndexAngle(t){const e=yt/(this._pointLabels.length||1),s=this.options.startAngle||0;return jt(t*e+Vt(s))}getDistanceFromCenterForValue(t){if(dt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(dt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return uf(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const h=this.getIndexAngle(t)-Tt+s;return{x:Math.cos(h)*e+this.xCenter,y:Math.sin(h)*e+this.yCenter,angle:h}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:h,bottom:g}=this._pointLabelItems[t];return{left:e,top:s,right:h,bottom:g}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),Lo(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:h,border:g}=e,m=this._pointLabels.length;let r,n,l;if(e.pointLabels.display&&hf(this,m),h.display&&this.ticks.forEach((u,o)=>{if(o!==0){n=this.getDistanceFromCenterForValue(u.value);const c=this.getContext(o),a=h.setContext(c),d=g.setContext(c);cf(this,a,n,m,d)}}),s.display){for(t.save(),r=m-1;r>=0;r--){const u=s.setContext(this.getPointLabelContext(r)),{color:o,lineWidth:c}=u;!c||!o||(t.lineWidth=c,t.strokeStyle=o,t.setLineDash(u.borderDash),t.lineDashOffset=u.borderDashOffset,n=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(r,n),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const h=this.getIndexAngle(0);let g,m;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(h),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((r,n)=>{if(n===0&&!e.reverse)return;const l=s.setContext(this.getContext(n)),u=kt(l.font);if(g=this.getDistanceFromCenterForValue(this.ticks[n].value),l.showLabelBackdrop){t.font=u.string,m=t.measureText(r.label).width,t.fillStyle=l.backdropColor;const o=Et(l.backdropPadding);t.fillRect(-m/2-o.left,-g-u.size/2-o.top,m+o.width,u.size+o.height)}Pe(t,r.label,0,-g,u,{color:l.color,strokeColor:l.textStrokeColor,strokeWidth:l.textStrokeWidth})}),t.restore()}drawTitle(){}}Z(Je,"id","radialLinear"),Z(Je,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:sn.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),Z(Je,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Z(Je,"descriptors",{angleLines:{_fallback:"grid"}});const ln={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},It=Object.keys(ln);function kr(i,t){return i-t}function Pr(i,t){if(dt(t))return null;const e=i._adapter,{parser:s,round:h,isoWeekday:g}=i._parseOpts;let m=t;return typeof s=="function"&&(m=s(m)),St(m)||(m=typeof s=="string"?e.parse(m,s):e.parse(m)),m===null?null:(h&&(m=h==="week"&&(Be(g)||g===!0)?e.startOf(m,"isoWeek",g):e.startOf(m,h)),+m)}function Mr(i,t,e,s){const h=It.length;for(let g=It.indexOf(i);g<h-1;++g){const m=ln[It[g]],r=m.steps?m.steps:Number.MAX_SAFE_INTEGER;if(m.common&&Math.ceil((e-t)/(r*m.size))<=s)return It[g]}return It[h-1]}function ff(i,t,e,s,h){for(let g=It.length-1;g>=It.indexOf(e);g--){const m=It[g];if(ln[m].common&&i._adapter.diff(h,s,m)>=t-1)return m}return It[e?It.indexOf(e):0]}function df(i){for(let t=It.indexOf(i)+1,e=It.length;t<e;++t)if(ln[It[t]].common)return It[t]}function Dr(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:s,hi:h}=$n(e,t),g=e[s]>=t?e[s]:e[h];i[g]=!0}}function gf(i,t,e,s){const h=i._adapter,g=+h.startOf(t[0].value,s),m=t[t.length-1].value;let r,n;for(r=g;r<=m;r=+h.add(r,1,s))n=e[r],n>=0&&(t[n].major=!0);return t}function Ar(i,t,e){const s=[],h={},g=t.length;let m,r;for(m=0;m<g;++m)r=t[m],h[r]=m,s.push({value:r,major:!1});return g===0||!e?s:gf(i,s,h,e)}class di extends Me{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),h=this._adapter=new Ch._date(t.adapters.date);h.init(e),Ze(s.displayFormats,h.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Pr(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:h,max:g,minDefined:m,maxDefined:r}=this.getUserBounds();function n(l){!m&&!isNaN(l.min)&&(h=Math.min(h,l.min)),!r&&!isNaN(l.max)&&(g=Math.max(g,l.max))}(!m||!r)&&(n(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&n(this.getMinMax(!1))),h=St(h)&&!isNaN(h)?h:+e.startOf(Date.now(),s),g=St(g)&&!isNaN(g)?g:+e.endOf(Date.now(),s)+1,this.min=Math.min(h,g-1),this.max=Math.max(h+1,g)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,h=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const g=this.min,m=this.max,r=Ga(h,g,m);return this._unit=e.unit||(s.autoSkip?Mr(e.minUnit,this.min,this.max,this._getLabelCapacity(g)):ff(this,r.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:df(this._unit),this.initOffsets(h),t.reverse&&r.reverse(),Ar(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,h,g;this.options.offset&&t.length&&(h=this.getDecimalForValue(t[0]),t.length===1?e=1-h:e=(this.getDecimalForValue(t[1])-h)/2,g=this.getDecimalForValue(t[t.length-1]),t.length===1?s=g:s=(g-this.getDecimalForValue(t[t.length-2]))/2);const m=t.length<3?.5:.25;e=Pt(e,0,m),s=Pt(s,0,m),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,h=this.options,g=h.time,m=g.unit||Mr(g.minUnit,e,s,this._getLabelCapacity(e)),r=lt(h.ticks.stepSize,1),n=m==="week"?g.isoWeekday:!1,l=Be(n)||n===!0,u={};let o=e,c,a;if(l&&(o=+t.startOf(o,"isoWeek",n)),o=+t.startOf(o,l?"day":m),t.diff(s,e,m)>1e5*r)throw new Error(e+" and "+s+" are too far apart with stepSize of "+r+" "+m);const d=h.ticks.source==="data"&&this.getDataTimestamps();for(c=o,a=0;c<s;c=+t.add(c,r,m),a++)Dr(u,c,d);return(c===s||h.bounds==="ticks"||a===1)&&Dr(u,c,d),Object.keys(u).sort(kr).map(p=>+p)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const h=this.options.time.displayFormats,g=this._unit,m=e||h[g];return this._adapter.format(t,m)}_tickFormatFunction(t,e,s,h){const g=this.options,m=g.ticks.callback;if(m)return vt(m,[t,e,s],this);const r=g.time.displayFormats,n=this._unit,l=this._majorUnit,u=n&&r[n],o=l&&r[l],c=s[e],a=l&&o&&c&&c.major;return this._adapter.format(t,h||(a?o:u))}generateTickLabels(t){let e,s,h;for(e=0,s=t.length;e<s;++e)h=t[e],h.label=this._tickFormatFunction(h.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,h=Vt(this.isHorizontal()?e.maxRotation:e.minRotation),g=Math.cos(h),m=Math.sin(h),r=this._resolveTickFontOptions(0).size;return{w:s*g+r*m,h:s*m+r*g}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,h=s[e.unit]||s.millisecond,g=this._tickFormatFunction(t,0,Ar(this,[t],this._majorUnit),h),m=this._getLabelSize(g),r=Math.floor(this.isHorizontal()?this.width/m.w:this.height/m.h)-1;return r>0?r:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(e=0,s=h.length;e<s;++e)t=t.concat(h[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const h=this.getLabels();for(e=0,s=h.length;e<s;++e)t.push(Pr(this,h[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Yr(t.sort(kr))}}Z(di,"id","time"),Z(di,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ri(i,t,e){let s=0,h=i.length-1,g,m,r,n;e?(t>=i[s].pos&&t<=i[h].pos&&({lo:s,hi:h}=ie(i,"pos",t)),{pos:g,time:r}=i[s],{pos:m,time:n}=i[h]):(t>=i[s].time&&t<=i[h].time&&({lo:s,hi:h}=ie(i,"time",t)),{time:g,pos:r}=i[s],{time:m,pos:n}=i[h]);const l=m-g;return l?r+(n-r)*(t-g)/l:r}class Wn extends di{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Ri(e,this.min),this._tableRange=Ri(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,h=[],g=[];let m,r,n,l,u;for(m=0,r=t.length;m<r;++m)l=t[m],l>=e&&l<=s&&h.push(l);if(h.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(m=0,r=h.length;m<r;++m)u=h[m+1],n=h[m-1],l=h[m],Math.round((u+n)/2)!==l&&g.push({time:l,pos:m/(r-1)});return g}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((h,g)=>h-g)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(Ri(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return Ri(this._table,s*this._tableRange+this._minPos,!0)}}Z(Wn,"id","timeseries"),Z(Wn,"defaults",di.defaults);var pf=Object.freeze({__proto__:null,CategoryScale:In,LinearScale:Bn,LogarithmicScale:jn,RadialLinearScale:Je,TimeScale:di,TimeSeriesScale:Wn});const mf=[xh,Jc,Yu,pf];$t.register(...mf);function vf(i){const t=new $t(i,{type:"line",data:{labels:[],datasets:[{label:"Training Dataset",data:[]},{label:"Testing Dataset",data:[]}]},options:{scales:{x:{type:"linear",min:0,title:{display:!0,text:"# of Iteration"}},y:{type:"linear",min:0,max:1,title:{display:!0,text:"Error Rate"}}}}});return{chart:t,append(e,s){var h;t.data.datasets.map((g,m)=>g.data.push(e[m])),(h=t.data.labels)==null||h.push(s),t.update()},reset(){t.data.datasets.forEach(e=>e.data=[]),t.data.labels=[],t.update()}}}function _f(i){const t=new $t(i,{type:"bar",data:{labels:[0,1,2,3,4,5,6,7,8,9],datasets:[{label:"Probability",data:[]}]},options:{responsive:!0,scales:{x:{type:"linear",min:0,max:9,title:{display:!0,text:"Digit"}},y:{type:"linear",min:0,max:1,title:{display:!0,text:"Confidence"}}}}});return{chart:t,update(e){t.data.datasets[0].data=e,t.update()},clear(){t.data.datasets[0].data=[],t.update()}}}function bf(i){return{sendCommand(t,e){i.postMessage({cmd:t,data:e})},handleCommand(t){i.onmessage=e=>t(e.data)},sendCommandTransfer(t,e){i.postMessage({cmd:t,data:e},[e.buffer])}}}class yf{constructor(){Z(this,"pipe");Z(this,"callbacks",{});this.pipe=bf(new Worker(new URL("/digit-recognizer/assets/wasm.worker-ea2af416.js",self.location),{type:"module"})),this.pipe.handleCommand(({cmd:t,data:e})=>{var s;switch(t){case"step":case"prediction":(s=this.callbacks[t])==null||s.call(null,e);break}})}start_training(t,e){const s={type:t,param:e};this.pipe.sendCommand("start_training",s)}stop_training(){this.pipe.sendCommand("stop_training",null)}set onstep(t){this.callbacks.step=t}predict(t){this.pipe.sendCommandTransfer("predict",t)}set onprediction(t){this.callbacks.prediction=t}}function xf(i){const t=i.getImageData(0,0,i.canvas.width,i.canvas.height),{sx:e,sy:s,sw:h,sh:g}=Cf(t);return[h,g,i.getImageData(e,s,h,g)]}function Cf(i){const t=i.width,e=i.height;let s=t,h=e,g=0,m=0;for(let r=0;r<e;r++)for(let n=0;n<t;n++){const l=(r*t+n)*4;let u=i.data[l],o=i.data[l+1],c=i.data[l+2];Math.min(u,o,c)!=255&&(n<s?s=n:n>g&&(g=n),r<h?h=r:r>m&&(m=r))}return{sx:s,sy:h,sw:1+g-s,sh:1+m-h}}function Sf(i){let t=new Float64Array(i.length/4);for(let e=0;e<i.length;e+=4){const s=255-i[e],h=255-i[e+1],g=255-i[e+2];255-i[e+3];const m=.299*s+.587*h+.114*g;t[e/4]=m}return t}function wf(i){let t,e,s,h,g;function m(n){i[8](n)}let r={};return i[0].param.perceptron!==void 0&&(r.param=i[0].param.perceptron),s=new aa({props:r}),ri.push(()=>Nn(s,"param",m)),{c(){t=ft("h3"),t.textContent="Perceptron (1-layer Neural Network) Hyperparameters",e=Dt(),nn(s.$$.fragment)},m(n,l){_t(n,t,l),_t(n,e,l),pi(s,n,l),g=!0},p(n,l){const u={};!h&&l&1&&(h=!0,u.param=n[0].param.perceptron,Hn(()=>h=!1)),s.$set(u)},i(n){g||(Oe(s.$$.fragment,n),g=!0)},o(n){Ie(s.$$.fragment,n),g=!1},d(n){n&&(mt(t),mt(e)),mi(s,n)}}}function Tf(i){let t,e,s,h,g;function m(n){i[7](n)}let r={};return i[0].param.knn!==void 0&&(r.param=i[0].param.knn),s=new sa({props:r}),ri.push(()=>Nn(s,"param",m)),{c(){t=ft("h3"),t.textContent="K Nearest Neighbors Hyperparameters",e=Dt(),nn(s.$$.fragment)},m(n,l){_t(n,t,l),_t(n,e,l),pi(s,n,l),g=!0},p(n,l){const u={};!h&&l&1&&(h=!0,u.param=n[0].param.knn,Hn(()=>h=!1)),s.$set(u)},i(n){g||(Oe(s.$$.fragment,n),g=!0)},o(n){Ie(s.$$.fragment,n),g=!1},d(n){n&&(mt(t),mt(e)),mi(s,n)}}}function Of(i){let t,e,s,h,g;function m(n){i[6](n)}let r={};return i[0].param.kmeans!==void 0&&(r.param=i[0].param.kmeans),s=new ea({props:r}),ri.push(()=>Nn(s,"param",m)),{c(){t=ft("h3"),t.textContent="K Means Hyperparameters",e=Dt(),nn(s.$$.fragment)},m(n,l){_t(n,t,l),_t(n,e,l),pi(s,n,l),g=!0},p(n,l){const u={};!h&&l&1&&(h=!0,u.param=n[0].param.kmeans,Hn(()=>h=!1)),s.$set(u)},i(n){g||(Oe(s.$$.fragment,n),g=!0)},o(n){Ie(s.$$.fragment,n),g=!1},d(n){n&&(mt(t),mt(e)),mi(s,n)}}}function kf(i){let t,e,s;return{c(){t=ft("button"),t.textContent="Stop Training"},m(h,g){_t(h,t,g),e||(s=se(t,"click",i[10]),e=!0)},p:Ht,d(h){h&&mt(t),e=!1,s()}}}function Pf(i){let t,e,s;return{c(){t=ft("button"),t.textContent="Start Training"},m(h,g){_t(h,t,g),e||(s=se(t,"click",i[9]),e=!0)},p:Ht,d(h){h&&mt(t),e=!1,s()}}}function Mf(i){let t,e,s,h,g,m,r,n,l,u,o,c,a,d,p=i[0].selected+"",f,v,_=JSON.stringify(i[0].param[i[0].selected])+"",b,y,x,C,S,O,F,R,z,X,J,q,V,Q,tt,et,w,M;const D=[Of,Tf,wf],P=[];function I(E,B){return E[0].selected=="kmeans"?0:E[0].selected=="knn"?1:E[0].selected=="perceptron"?2:-1}~(n=I(i))&&(l=P[n]=D[n](i));function k(E,B){return E[0].is_training==!1?Pf:kf}let T=k(i),A=T(i);return{c(){t=ft("label"),e=Nt(`Select a machine learning model to train:
    `),s=ft("select"),h=ft("option"),h.textContent="K Means",g=ft("option"),g.textContent="K Nearest Neighbors",m=ft("option"),m.textContent="Perceptron (1-layer Neural Network)",r=Dt(),l&&l.c(),u=Dt(),o=ft("div"),A.c(),c=Dt(),a=ft("p"),d=Nt("Training "),f=Nt(p),v=Nt(", using params: "),b=Nt(_),y=Dt(),x=ft("canvas"),C=Dt(),S=ft("div"),O=ft("div"),F=ft("p"),F.textContent="Draw a digit:",R=Dt(),z=ft("div"),z.innerHTML='<canvas id="canvas" width="300" height="300"></canvas>',X=Dt(),J=ft("button"),J.textContent="Clear",q=Dt(),V=ft("div"),V.innerHTML='<canvas id="cropped-canvas" width="28" height="28" class="svelte-1ju8fsv"></canvas> <canvas id="scaled-canvas" width="28" height="28" class="svelte-1ju8fsv"></canvas>',Q=Dt(),tt=ft("div"),tt.innerHTML='<p>Probability Result</p> <canvas id="probability_chart"></canvas>',h.__value="kmeans",zt(h,h.__value),g.__value="knn",zt(g,g.__value),m.__value="perceptron",zt(m,m.__value),i[0].selected===void 0&&Gi(()=>i[5].call(s)),Lt(o,"class","grid"),Lt(x,"id","training_chart"),Lt(z,"id","canvas-wrapper"),Lt(z,"class","svelte-1ju8fsv"),Lt(V,"class","grid"),No(V,"display","none"),Lt(S,"class","grid")},m(E,B){_t(E,t,B),ut(t,e),ut(t,s),ut(s,h),ut(s,g),ut(s,m),ls(s,i[0].selected,!0),_t(E,r,B),~n&&P[n].m(E,B),_t(E,u,B),_t(E,o,B),A.m(o,null),_t(E,c,B),_t(E,a,B),ut(a,d),ut(a,f),ut(a,v),ut(a,b),_t(E,y,B),_t(E,x,B),_t(E,C,B),_t(E,S,B),ut(S,O),ut(O,F),ut(O,R),ut(O,z),ut(O,X),ut(O,J),ut(O,q),ut(O,V),ut(S,Q),ut(S,tt),et=!0,w||(M=[se(s,"change",i[5]),se(J,"click",i[3])],w=!0)},p(E,[B]){B&1&&ls(s,E[0].selected);let j=n;n=I(E),n===j?~n&&P[n].p(E,B):(l&&(qo(),Ie(P[j],1,1,()=>{P[j]=null}),Ko()),~n?(l=P[n],l?l.p(E,B):(l=P[n]=D[n](E),l.c()),Oe(l,1),l.m(u.parentNode,u)):l=null),T===(T=k(E))&&A?A.p(E,B):(A.d(1),A=T(E),A&&(A.c(),A.m(o,null))),(!et||B&1)&&p!==(p=E[0].selected+"")&&as(f,p),(!et||B&1)&&_!==(_=JSON.stringify(E[0].param[E[0].selected])+"")&&as(b,_)},i(E){et||(Oe(l),et=!0)},o(E){Ie(l),et=!1},d(E){E&&(mt(t),mt(r),mt(u),mt(o),mt(c),mt(a),mt(y),mt(x),mt(C),mt(S)),~n&&P[n].d(E),A.d(),w=!1,de(M)}}}function Df(i,t,e){const s=new yf,h={selected:"kmeans",is_training:!1,param:{kmeans:{max_iter:100,n_clusters:10},knn:{k:10},perceptron:{max_iter:100,learning_rate:.01}}};let g,m,r;Lr(()=>{e(4,g=vf("training_chart")),r=_f("probability_chart"),m=new Ir.fabric.Canvas("canvas",{isDrawingMode:!0}),m.freeDrawingBrush.color="black",m.freeDrawingBrush.width=15,m.backgroundColor="rgba(255, 255, 255, 255)";let _,b=!1,y=!1;function x(){clearTimeout(_),_=setTimeout(()=>{y=!0,m.freeDrawingBrush._finalizeAndAddPath();const C=o(),S=Sf(C);s.predict(S),y=!1},50),y=!0}m.on("mouse:down",C=>{b=!0}),m.on("mouse:up",C=>{b=!1,x()}),m.on("mouse:move",C=>{b&&y==!1&&x()})});function n(){g.reset(),s.start_training(h.selected,h.param[h.selected])}function l(){s.stop_training()}s.onstep=_=>{console.log(`[main][step]: ${_.i}: train: ${_.training_err}, test: ${_.testing_err}`),g.append([_.training_err,_.testing_err],_.i)};function u(){m.clear(),m.backgroundColor="rgba(255, 255, 255, 255)",m.renderAll();const _=document.getElementById("canvas").getContext("2d",{willReadFrequently:!0}),b=document.getElementById("cropped-canvas").getContext("2d",{willReadFrequently:!0}),y=document.getElementById("scaled-canvas").getContext("2d",{willReadFrequently:!0});_.clearRect(0,0,_.canvas.width,_.canvas.height),b.clearRect(0,0,b.canvas.width,b.canvas.height),y.clearRect(0,0,y.canvas.width,y.canvas.height),r.clear()}function o(){const _=document.getElementById("canvas").getContext("2d",{willReadFrequently:!0}),b=document.getElementById("cropped-canvas").getContext("2d",{willReadFrequently:!0}),y=document.getElementById("scaled-canvas").getContext("2d",{willReadFrequently:!0});b.fillStyle="rgba(255, 255, 255, 255)",b.fillRect(0,0,b.canvas.width,b.canvas.height),b.save();const[x,C,S]=xf(_);b.canvas.width=Math.max(x,C)*1.2,b.canvas.height=Math.max(x,C)*1.2;const O=(b.canvas.width-x)/2,F=(b.canvas.height-C)/2;b.putImageData(S,O,F),y.save(),y.clearRect(0,0,y.canvas.height,y.canvas.width),y.fillStyle="rgba(255, 255, 255, 255)",y.fillRect(0,0,b.canvas.width,b.canvas.height),y.scale(28/b.canvas.height,28/b.canvas.width),y.drawImage(b.canvas,0,0);const{data:R}=y.getImageData(0,0,28,28);return y.restore(),R}s.onprediction=_=>{r.update(_),console.log(r.chart.data.datasets[0].data)};function c(){h.selected=Vo(this),e(0,h)}function a(_){i.$$.not_equal(h.param.kmeans,_)&&(h.param.kmeans=_,e(0,h))}function d(_){i.$$.not_equal(h.param.knn,_)&&(h.param.knn=_,e(0,h))}function p(_){i.$$.not_equal(h.param.perceptron,_)&&(h.param.perceptron=_,e(0,h))}const f=()=>{e(0,h.is_training=!0,h),n()},v=()=>{e(0,h.is_training=!1,h),l()};return i.$$.update=()=>{var _;if(i.$$.dirty&17&&g&&((_=g.chart.options.scales)==null?void 0:_.x)!=null){let b=h.param[h.selected];"max_iter"in b&&(e(4,g.chart.options.scales.x.max=b.max_iter,g),g.chart.update())}},[h,n,l,u,g,c,a,d,p,f,v]}class Af extends _i{constructor(t){super(),vi(this,t,Df,Mf,gi,{})}}function Ef(i){let t,e,s,h,g,m,r,n;return r=new Af({}),{c(){t=ft("main"),e=ft("h1"),e.textContent="Digit Recognizer",s=Dt(),h=ft("article"),g=ft("h2"),g.textContent="Train your own model!",m=Dt(),nn(r.$$.fragment),Lt(t,"class","container")},m(l,u){_t(l,t,u),ut(t,e),ut(t,s),ut(t,h),ut(h,g),ut(h,m),pi(r,h,null),n=!0},p:Ht,i(l){n||(Oe(r.$$.fragment,l),n=!0)},o(l){Ie(r.$$.fragment,l),n=!1},d(l){l&&mt(t),mi(r)}}}function Ff(i){return Lr(()=>{}),[]}class Lf extends _i{constructor(t){super(),vi(this,t,Ff,Ef,gi,{})}}new Lf({target:document.getElementById("app")});
