var H=Object.defineProperty;var G=(_,a,o)=>a in _?H(_,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):_[a]=o;var E=(_,a,o)=>(G(_,typeof a!="symbol"?a+"":a,o),o);(function(){"use strict";let _;const a=new Array(128).fill(void 0);a.push(void 0,null,!0,!1);function o(n){return a[n]}let d=a.length;function M(n){n<132||(a[n]=d,d=n)}function W(n){const t=o(n);return M(n),t}const R=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&R.decode();let p=null;function m(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(_.memory.buffer)),p}function v(n,t){return n=n>>>0,R.decode(m().subarray(n,n+t))}function i(n){d===a.length&&a.push(a.length+1);const t=d;return d=a[t],a[t]=n,t}function l(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`);return n.ptr}function S(){_.set_panic_hook()}let b=0;function k(n,t){const e=t(n.length*1,1)>>>0;return m().set(n,e/1),b=n.length,e}const T=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},U=typeof T.encodeInto=="function"?function(n,t){return T.encodeInto(n,t)}:function(n,t){const e=T.encode(n);return t.set(e),{read:n.length,written:e.length}};function z(n,t,e){if(e===void 0){const u=T.encode(n),y=t(u.length,1)>>>0;return m().subarray(y,y+u.length).set(u),b=u.length,y}let r=n.length,s=t(r,1)>>>0;const w=m();let c=0;for(;c<r;c++){const u=n.charCodeAt(c);if(u>127)break;w[s+c]=u}if(c!==r){c!==0&&(n=n.slice(c)),s=e(s,r,r=c+n.length*3,1)>>>0;const u=m().subarray(s+c,s+r),y=U(n,u);c+=y.written}return b=c,s}let h=null;function O(){return(h===null||h.byteLength===0)&&(h=new Int32Array(_.memory.buffer)),h}function g(n,t){try{return n.apply(this,t)}catch(e){_.__wbindgen_exn_store(i(e))}}class f{static __wrap(t){t=t>>>0;const e=Object.create(f.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_dataset_free(t)}}class j{static __wrap(t){t=t>>>0;const e=Object.create(j.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_kmeans_free(t)}constructor(t,e){const r=_.kmeans_new(t,e);return j.__wrap(r)}step(t){return l(t,f),_.kmeans_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return l(t,f),_.kmeans_evaluate(this.__wbg_ptr,t.__wbg_ptr)}predict(){_.kmeans_predict(this.__wbg_ptr)}}class A{static __wrap(t){t=t>>>0;const e=Object.create(A.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_knearestneighbors_free(t)}constructor(t){const e=_.knearestneighbors_new(t);return A.__wrap(e)}step(t){return l(t,f),_.knearestneighbors_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return l(t,f),_.knearestneighbors_evaluate(this.__wbg_ptr,t.__wbg_ptr)}predict(){_.knearestneighbors_predict(this.__wbg_ptr)}}class C{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_mnist_free(t)}static training_from_static(){const t=_.mnist_training_from_static();return f.__wrap(t)}static testing_from_static(){const t=_.mnist_testing_from_static();return f.__wrap(t)}static training_from_gz(t,e){const r=k(t,_.__wbindgen_malloc),s=b,w=k(e,_.__wbindgen_malloc),c=b,u=_.mnist_training_from_gz(r,s,w,c);return f.__wrap(u)}static testing_from_gz(t,e){const r=k(t,_.__wbindgen_malloc),s=b,w=k(e,_.__wbindgen_malloc),c=b,u=_.mnist_testing_from_gz(r,s,w,c);return f.__wrap(u)}}class x{static __wrap(t){t=t>>>0;const e=Object.create(x.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_perceptron_free(t)}constructor(t,e,r){const s=_.perceptron_new(t,e,r);return x.__wrap(s)}step(t){return l(t,f),_.perceptron_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return l(t,f),_.perceptron_evaluate(this.__wbg_ptr,t.__wbg_ptr)}predict(){_.perceptron_predict(this.__wbg_ptr)}}async function F(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await n.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(n,t);return e instanceof WebAssembly.Instance?{instance:e,module:n}:e}}function L(){const n={};return n.wbg={},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return i(t)},n.wbg.__wbg_stack_658279fe44541cf6=function(t,e){const r=o(e).stack,s=z(r,_.__wbindgen_malloc,_.__wbindgen_realloc),w=b;O()[t/4+1]=w,O()[t/4+0]=s},n.wbg.__wbg_error_f851667af71bcfc6=function(t,e){let r,s;try{r=t,s=e,console.error(v(t,e))}finally{_.__wbindgen_free(r,s,1)}},n.wbg.__wbindgen_object_drop_ref=function(t){W(t)},n.wbg.__wbg_randomFillSync_dc1e9a60c158336d=function(){return g(function(t,e){o(t).randomFillSync(W(e))},arguments)},n.wbg.__wbg_getRandomValues_37fa2ca9e4e07fab=function(){return g(function(t,e){o(t).getRandomValues(o(e))},arguments)},n.wbg.__wbg_crypto_c48a774b022d20ac=function(t){const e=o(t).crypto;return i(e)},n.wbg.__wbindgen_is_object=function(t){const e=o(t);return typeof e=="object"&&e!==null},n.wbg.__wbg_process_298734cf255a885d=function(t){const e=o(t).process;return i(e)},n.wbg.__wbg_versions_e2e78e134e3e5d01=function(t){const e=o(t).versions;return i(e)},n.wbg.__wbg_node_1cd7a5d853dbea79=function(t){const e=o(t).node;return i(e)},n.wbg.__wbindgen_is_string=function(t){return typeof o(t)=="string"},n.wbg.__wbg_require_8f08ceecec0f4fee=function(){return g(function(){const t=module.require;return i(t)},arguments)},n.wbg.__wbindgen_string_new=function(t,e){const r=v(t,e);return i(r)},n.wbg.__wbg_msCrypto_bcb970640f50a1e8=function(t){const e=o(t).msCrypto;return i(e)},n.wbg.__wbindgen_is_function=function(t){return typeof o(t)=="function"},n.wbg.__wbg_newnoargs_581967eacc0e2604=function(t,e){const r=new Function(v(t,e));return i(r)},n.wbg.__wbg_call_cb65541d95d71282=function(){return g(function(t,e){const r=o(t).call(o(e));return i(r)},arguments)},n.wbg.__wbg_self_1ff1d729e9aae938=function(){return g(function(){const t=self.self;return i(t)},arguments)},n.wbg.__wbg_window_5f4faef6c12b79ec=function(){return g(function(){const t=window.window;return i(t)},arguments)},n.wbg.__wbg_globalThis_1d39714405582d3c=function(){return g(function(){const t=globalThis.globalThis;return i(t)},arguments)},n.wbg.__wbg_global_651f05c6a0944d1c=function(){return g(function(){const t=global.global;return i(t)},arguments)},n.wbg.__wbindgen_is_undefined=function(t){return o(t)===void 0},n.wbg.__wbg_call_01734de55d61e11d=function(){return g(function(t,e,r){const s=o(t).call(o(e),o(r));return i(s)},arguments)},n.wbg.__wbg_buffer_085ec1f694018c4f=function(t){const e=o(t).buffer;return i(e)},n.wbg.__wbg_newwithbyteoffsetandlength_6da8e527659b86aa=function(t,e,r){const s=new Uint8Array(o(t),e>>>0,r>>>0);return i(s)},n.wbg.__wbg_new_8125e318e6245eed=function(t){const e=new Uint8Array(o(t));return i(e)},n.wbg.__wbg_set_5cf90238115182c3=function(t,e,r){o(t).set(o(e),r>>>0)},n.wbg.__wbg_newwithlength_e5d69174d6984cd7=function(t){const e=new Uint8Array(t>>>0);return i(e)},n.wbg.__wbg_subarray_13db269f57aa838d=function(t,e,r){const s=o(t).subarray(e>>>0,r>>>0);return i(s)},n.wbg.__wbindgen_object_clone_ref=function(t){const e=o(t);return i(e)},n.wbg.__wbindgen_throw=function(t,e){throw new Error(v(t,e))},n.wbg.__wbindgen_memory=function(){const t=_.memory;return i(t)},n}function D(n,t){return _=n.exports,I.__wbindgen_wasm_module=t,h=null,p=null,_}async function I(n){if(_!==void 0)return _;typeof n>"u"&&(n=new URL("/digit-recognizer/assets/mnist_bg-4f52982a.wasm",self.location));const t=L();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:r}=await F(await n,t);return D(e,r)}function q(n){return{sendCommand(t,e){n.postMessage({cmd:t,data:e})},handleCommand(t){n.onmessage=e=>t(e.data)}}}function V({type:n,param:t}){switch(n){case"kmeans":return new j(t.n_clusters,28*28);case"knn":return new A(t.k);case"perceptron":return new x(t.learning_rate,28*28,10);default:return}}class B{constructor(t){E(this,"pipe");E(this,"model");E(this,"interval_id");this.pipe=t}start_training(t,e){this.stop_training(),this.model!=null&&(this.model.free(),this.model=void 0),this.model=V(t);let r=0;this.interval_id=setInterval(()=>{var c,u;const s=(c=this.model)==null?void 0:c.step(e.training),w=(u=this.model)==null?void 0:u.evaluate(e.testing);r++,this.pipe.sendCommand("step",{i:r,training_err:s,testing_err:w}),(!("max_iter"in t.param)||r>=t.param.max_iter)&&this.stop_training()})}stop_training(){clearInterval(this.interval_id),this.interval_id=void 0}}async function $(){const n=performance.now();await I();const t=performance.now();console.log(`wasm init took ${t-n} milliseconds`),S();const e=q(self),r=new B(e),s={training:C.training_from_static(),testing:C.testing_from_static()};e.handleCommand(({cmd:w,data:c})=>{switch(w){case"start_training":console.log("[Worker] Received start training event"),console.table(c),r.start_training(c,s);break;case"stop_training":console.log("[Worker] Received stop training event"),r.stop_training();break}})}$()})();
