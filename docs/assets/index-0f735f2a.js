var po=Object.defineProperty;var mo=(i,t,e)=>t in i?po(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var nt=(i,t,e)=>(mo(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))s(f);new MutationObserver(f=>{for(const g of f)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&s(v)}).observe(document,{childList:!0,subtree:!0});function e(f){const g={};return f.integrity&&(g.integrity=f.integrity),f.referrerPolicy&&(g.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?g.credentials="include":f.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function s(f){if(f.ep)return;f.ep=!0;const g=e(f);fetch(f.href,g)}})();function Mt(){}function Be(i,t){for(const e in t)i[e]=t[e];return i}function pr(i){return i()}function qn(){return Object.create(null)}function fe(i){i.forEach(pr)}function mr(i){return typeof i=="function"}function de(i,t){return i!=i?t==t:i!==t||i&&typeof i=="object"||typeof i=="function"}function vo(i){return Object.keys(i).length===0}function Wi(i){const t={};for(const e in i)e[0]!=="$"&&(t[e]=i[e]);return t}function at(i,t){i.appendChild(t)}function ut(i,t,e){i.insertBefore(t,e||null)}function ct(i){i.parentNode&&i.parentNode.removeChild(i)}function ot(i){return document.createElement(i)}function Ni(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function Oe(i){return document.createTextNode(i)}function _t(){return Oe(" ")}function Gt(i,t,e,s){return i.addEventListener(t,e,s),()=>i.removeEventListener(t,e,s)}function xt(i,t,e){e==null?i.removeAttribute(t):i.getAttribute(t)!==e&&i.setAttribute(t,e)}function Vi(i,t){for(const e in t)xt(i,e,t[e])}function $t(i){return i===""?null:+i}function _o(i){return Array.from(i.childNodes)}function Bt(i,t){i.value=t??""}function Fe(i,t,e,s){e==null?i.style.removeProperty(t):i.style.setProperty(t,e,s?"important":"")}function Kn(i,t,e){for(let s=0;s<i.options.length;s+=1){const f=i.options[s];if(f.__value===t){f.selected=!0;return}}(!e||t!==void 0)&&(i.selectedIndex=-1)}function bo(i){const t=i.querySelector(":checked");return t&&t.__value}let si;function Qe(i){si=i}function yo(){if(!si)throw new Error("Function called outside component initialization");return si}function vr(i){yo().$$.on_mount.push(i)}const Le=[],ri=[];let Ie=[];const _n=[],xo=Promise.resolve();let bn=!1;function Co(){bn||(bn=!0,xo.then(_r))}function Xi(i){Ie.push(i)}function Fn(i){_n.push(i)}const sn=new Set;let Ae=0;function _r(){if(Ae!==0)return;const i=si;do{try{for(;Ae<Le.length;){const t=Le[Ae];Ae++,Qe(t),So(t.$$)}}catch(t){throw Le.length=0,Ae=0,t}for(Qe(null),Le.length=0,Ae=0;ri.length;)ri.pop()();for(let t=0;t<Ie.length;t+=1){const e=Ie[t];sn.has(e)||(sn.add(e),e())}Ie.length=0}while(Le.length);for(;_n.length;)_n.pop()();bn=!1,sn.clear(),Qe(i)}function So(i){if(i.fragment!==null){i.update(),fe(i.before_update);const t=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,t),i.after_update.forEach(Xi)}}function wo(i){const t=[],e=[];Ie.forEach(s=>i.indexOf(s)===-1?t.push(s):e.push(s)),e.forEach(s=>s()),Ie=t}const Ei=new Set;let we;function To(){we={r:0,c:[],p:we}}function Oo(){we.r||fe(we.c),we=we.p}function qt(i,t){i&&i.i&&(Ei.delete(i),i.i(t))}function ie(i,t,e,s){if(i&&i.o){if(Ei.has(i))return;Ei.add(i),we.c.push(()=>{Ei.delete(i),s&&(e&&i.d(1),s())}),i.o(t)}else s&&s()}function br(i,t){const e={},s={},f={$$scope:1};let g=i.length;for(;g--;){const v=i[g],a=t[g];if(a){for(const n in v)n in a||(s[n]=1);for(const n in a)f[n]||(e[n]=a[n],f[n]=1);i[g]=a}else for(const n in v)f[n]=1}for(const v in s)v in e||(e[v]=void 0);return e}function Ln(i,t,e){const s=i.$$.props[t];s!==void 0&&(i.$$.bound[s]=e,e(i.$$.ctx[s]))}function ke(i){i&&i.c()}function le(i,t,e){const{fragment:s,after_update:f}=i.$$;s&&s.m(t,e),Xi(()=>{const g=i.$$.on_mount.map(pr).filter(mr);i.$$.on_destroy?i.$$.on_destroy.push(...g):fe(g),i.$$.on_mount=[]}),f.forEach(Xi)}function he(i,t){const e=i.$$;e.fragment!==null&&(wo(e.after_update),fe(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function ko(i,t){i.$$.dirty[0]===-1&&(Le.push(i),Co(),i.$$.dirty.fill(0)),i.$$.dirty[t/31|0]|=1<<t%31}function ge(i,t,e,s,f,g,v,a=[-1]){const n=si;Qe(i);const h=i.$$={fragment:null,ctx:[],props:g,update:Mt,not_equal:f,bound:qn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(n?n.$$.context:[])),callbacks:qn(),dirty:a,skip_bound:!1,root:t.target||n.$$.root};v&&v(h.root);let u=!1;if(h.ctx=e?e(i,t.props||{},(r,l,...o)=>{const d=o.length?o[0]:l;return h.ctx&&f(h.ctx[r],h.ctx[r]=d)&&(!h.skip_bound&&h.bound[r]&&h.bound[r](d),u&&ko(i,r)),l}):[],h.update(),u=!0,fe(h.before_update),h.fragment=s?s(h.ctx):!1,t.target){if(t.hydrate){const r=_o(t.target);h.fragment&&h.fragment.l(r),r.forEach(ct)}else h.fragment&&h.fragment.c();t.intro&&qt(i.$$.fragment),le(i,t.target,t.anchor),_r()}Qe(n)}class pe{constructor(){nt(this,"$$");nt(this,"$$set")}$destroy(){he(this,1),this.$destroy=Mt}$on(t,e){if(!mr(e))return Mt;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const f=s.indexOf(e);f!==-1&&s.splice(f,1)}}$set(t){this.$$set&&!vo(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Mo="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Mo);function Po(i){let t,e,s,f,g,v,a,n,h,u,r;return{c(){t=ot("h4"),t.textContent="Hyperparameters",e=_t(),s=ot("label"),f=Oe(`Number of Clusters (K)
    `),g=ot("input"),v=_t(),a=ot("label"),n=Oe(`Max Iteration
    `),h=ot("input"),xt(g,"type","number"),xt(h,"type","number")},m(l,o){ut(l,t,o),ut(l,e,o),ut(l,s,o),at(s,f),at(s,g),Bt(g,i[0].n_clusters),ut(l,v,o),ut(l,a,o),at(a,n),at(a,h),Bt(h,i[0].max_iter),u||(r=[Gt(g,"input",i[1]),Gt(h,"input",i[2])],u=!0)},p(l,[o]){o&1&&$t(g.value)!==l[0].n_clusters&&Bt(g,l[0].n_clusters),o&1&&$t(h.value)!==l[0].max_iter&&Bt(h,l[0].max_iter)},i:Mt,o:Mt,d(l){l&&(ct(t),ct(e),ct(s),ct(v),ct(a)),u=!1,fe(r)}}}function Do(i,t,e){let{param:s}=t;function f(){s.n_clusters=$t(this.value),e(0,s)}function g(){s.max_iter=$t(this.value),e(0,s)}return i.$$set=v=>{"param"in v&&e(0,s=v.param)},[s,f,g]}class Ao extends pe{constructor(t){super(),ge(this,t,Do,Po,de,{param:0})}}function Eo(i){let t,e,s,f,g,v,a;return{c(){t=ot("h4"),t.textContent="Hyperparameters",e=_t(),s=ot("label"),f=Oe(`K
    `),g=ot("input"),xt(g,"type","number")},m(n,h){ut(n,t,h),ut(n,e,h),ut(n,s,h),at(s,f),at(s,g),Bt(g,i[0].k),v||(a=Gt(g,"input",i[1]),v=!0)},p(n,[h]){h&1&&$t(g.value)!==n[0].k&&Bt(g,n[0].k)},i:Mt,o:Mt,d(n){n&&(ct(t),ct(e),ct(s)),v=!1,a()}}}function Fo(i,t,e){let{param:s}=t;function f(){s.k=$t(this.value),e(0,s)}return i.$$set=g=>{"param"in g&&e(0,s=g.param)},[s,f]}class Lo extends pe{constructor(t){super(),ge(this,t,Fo,Eo,de,{param:0})}}function Io(i){let t,e,s,f,g,v,a,n,h,u,r;return{c(){t=ot("h4"),t.textContent="Hyperparameters",e=_t(),s=ot("label"),f=Oe(`Learning Rate
    `),g=ot("input"),v=_t(),a=ot("label"),n=Oe(`Max Iteration
    `),h=ot("input"),xt(g,"type","number"),xt(g,"min","0.0"),xt(g,"step","0.01"),xt(h,"type","number"),xt(h,"min","1")},m(l,o){ut(l,t,o),ut(l,e,o),ut(l,s,o),at(s,f),at(s,g),Bt(g,i[0].learning_rate),ut(l,v,o),ut(l,a,o),at(a,n),at(a,h),Bt(h,i[0].max_iter),u||(r=[Gt(g,"input",i[1]),Gt(h,"input",i[2])],u=!0)},p(l,[o]){o&1&&$t(g.value)!==l[0].learning_rate&&Bt(g,l[0].learning_rate),o&1&&$t(h.value)!==l[0].max_iter&&Bt(h,l[0].max_iter)},i:Mt,o:Mt,d(l){l&&(ct(t),ct(e),ct(s),ct(v),ct(a)),u=!1,fe(r)}}}function Ro(i,t,e){let{param:s}=t;function f(){s.learning_rate=$t(this.value),e(0,s)}function g(){s.max_iter=$t(this.value),e(0,s)}return i.$$set=v=>{"param"in v&&e(0,s=v.param)},[s,f,g]}class Bo extends pe{constructor(t){super(),ge(this,t,Ro,Io,de,{param:0})}}function jo(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var f=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(e,s,f.get?f:{enumerable:!0,get:function(){return i[s]}})}),e}var yr={};const zo={},Wo=Object.freeze(Object.defineProperty({__proto__:null,default:zo},Symbol.toStringTag,{value:"Module"})),rn=jo(Wo);(function(i){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(i.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var e=rn,s=new e.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=s.document,t.jsdomImplForWrapper=rn.implForWrapper,t.nodeCanvas=rn.Canvas,t.window=s,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function a(o,d){if(this.__eventListeners[o]){var p=this.__eventListeners[o];d?p[p.indexOf(d)]=!1:t.util.array.fill(p,!1)}}function n(o,d){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var p in o)this.on(p,o[p]);else this.__eventListeners[o]||(this.__eventListeners[o]=[]),this.__eventListeners[o].push(d);return this}function h(o,d){var p=(function(){d.apply(this,arguments),this.off(o,p)}).bind(this);this.on(o,p)}function u(o,d){if(arguments.length===1)for(var p in o)h.call(this,p,o[p]);else h.call(this,o,d);return this}function r(o,d){if(!this.__eventListeners)return this;if(arguments.length===0)for(o in this.__eventListeners)a.call(this,o);else if(arguments.length===1&&typeof arguments[0]=="object")for(var p in o)a.call(this,p,o[p]);else a.call(this,o,d);return this}function l(o,d){if(!this.__eventListeners)return this;var p=this.__eventListeners[o];if(!p)return this;for(var c=0,m=p.length;c<m;c++)p[c]&&p[c].call(this,d||{});return this.__eventListeners[o]=p.filter(function(_){return _!==!1}),this}t.Observable={fire:l,on:n,once:u,off:r}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,n=arguments.length;a<n;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,n,h){var u=this._objects;return h?u[n]=a:u.splice(n,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a=this._objects,n,h=!1,u=0,r=arguments.length;u<r;u++)n=a.indexOf(arguments[u]),n!==-1&&(h=!0,a.splice(n,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&h&&this.requestRenderAll(),this},forEachObject:function(a,n){for(var h=this.getObjects(),u=0,r=h.length;u<r;u++)a.call(n,h[u],u,h);return this},getObjects:function(a){return typeof a>"u"?this._objects.concat():this._objects.filter(function(n){return n.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(a,n){return this._objects.indexOf(a)>-1?!0:n?this._objects.some(function(h){return typeof h.contains=="function"&&h.contains(a,!0)}):!1},complexity:function(){return this._objects.reduce(function(a,n){return a+=n.complexity?n.complexity():0,a},0)}},t.CommonMethods={_setOptions:function(a){for(var n in a)this.set(n,a[n])},_initGradient:function(a,n){a&&a.colorStops&&!(a instanceof t.Gradient)&&this.set(n,new t.Gradient(a))},_initPattern:function(a,n,h){a&&a.source&&!(a instanceof t.Pattern)?this.set(n,new t.Pattern(a,h)):h&&h()},_setObject:function(a){for(var n in a)this._set(n,a[n])},set:function(a,n){return typeof a=="object"?this._setObject(a):this._set(a,n),this},_set:function(a,n){this[a]=n},toggle:function(a){var n=this.get(a);return typeof n=="boolean"&&this.set(a,!n),this},get:function(a){return this[a]}},function(a){var n=Math.sqrt,h=Math.atan2,u=Math.pow,r=Math.PI/180,l=Math.PI/2;t.util={cos:function(o){if(o===0)return 1;o<0&&(o=-o);var d=o/l;switch(d){case 1:case 3:return 0;case 2:return-1}return Math.cos(o)},sin:function(o){if(o===0)return 0;var d=o/l,p=1;switch(o<0&&(p=-1),d){case 1:return p;case 2:return 0;case 3:return-p}return Math.sin(o)},removeFromArray:function(o,d){var p=o.indexOf(d);return p!==-1&&o.splice(p,1),o},getRandomInt:function(o,d){return Math.floor(Math.random()*(d-o+1))+o},degreesToRadians:function(o){return o*r},radiansToDegrees:function(o){return o/r},rotatePoint:function(o,d,p){var c=new t.Point(o.x-d.x,o.y-d.y),m=t.util.rotateVector(c,p);return new t.Point(m.x,m.y).addEquals(d)},rotateVector:function(o,d){var p=t.util.sin(d),c=t.util.cos(d),m=o.x*c-o.y*p,_=o.x*p+o.y*c;return{x:m,y:_}},createVector:function(o,d){return new t.Point(d.x-o.x,d.y-o.y)},calcAngleBetweenVectors:function(o,d){return Math.acos((o.x*d.x+o.y*d.y)/(Math.hypot(o.x,o.y)*Math.hypot(d.x,d.y)))},getHatVector:function(o){return new t.Point(o.x,o.y).multiply(1/Math.hypot(o.x,o.y))},getBisector:function(o,d,p){var c=t.util.createVector(o,d),m=t.util.createVector(o,p),_=t.util.calcAngleBetweenVectors(c,m),b=t.util.calcAngleBetweenVectors(t.util.rotateVector(c,_),m),y=_*(b===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(c,y)),angle:_}},projectStrokeOnPoints:function(o,d,p){var c=[],m=d.strokeWidth/2,_=d.strokeUniform?new t.Point(1/d.scaleX,1/d.scaleY):new t.Point(1,1),b=function(y){var x=m/Math.hypot(y.x,y.y);return new t.Point(y.x*x*_.x,y.y*x*_.y)};return o.length<=1||o.forEach(function(y,x){var C=new t.Point(y.x,y.y),w,O;x===0?(O=o[x+1],w=p?b(t.util.createVector(O,C)).addEquals(C):o[o.length-1]):x===o.length-1?(w=o[x-1],O=p?b(t.util.createVector(w,C)).addEquals(C):o[0]):(w=o[x-1],O=o[x+1]);var E=t.util.getBisector(C,w,O),j=E.vector,H=E.angle,q,Q;if(d.strokeLineJoin==="miter"&&(q=-m/Math.sin(H/2),Q=new t.Point(j.x*q*_.x,j.y*q*_.y),Math.hypot(Q.x,Q.y)/m<=d.strokeMiterLimit)){c.push(C.add(Q)),c.push(C.subtract(Q));return}q=-m*Math.SQRT2,Q=new t.Point(j.x*q*_.x,j.y*q*_.y),c.push(C.add(Q)),c.push(C.subtract(Q))}),c},transformPoint:function(o,d,p){return p?new t.Point(d[0]*o.x+d[2]*o.y,d[1]*o.x+d[3]*o.y):new t.Point(d[0]*o.x+d[2]*o.y+d[4],d[1]*o.x+d[3]*o.y+d[5])},makeBoundingBoxFromPoints:function(o,d){if(d)for(var p=0;p<o.length;p++)o[p]=t.util.transformPoint(o[p],d);var c=[o[0].x,o[1].x,o[2].x,o[3].x],m=t.util.array.min(c),_=t.util.array.max(c),b=_-m,y=[o[0].y,o[1].y,o[2].y,o[3].y],x=t.util.array.min(y),C=t.util.array.max(y),w=C-x;return{left:m,top:x,width:b,height:w}},invertTransform:function(o){var d=1/(o[0]*o[3]-o[1]*o[2]),p=[d*o[3],-d*o[1],-d*o[2],d*o[0]],c=t.util.transformPoint({x:o[4],y:o[5]},p,!0);return p[4]=-c.x,p[5]=-c.y,p},toFixed:function(o,d){return parseFloat(Number(o).toFixed(d))},parseUnit:function(o,d){var p=/\D{0,2}$/.exec(o),c=parseFloat(o);switch(d||(d=t.Text.DEFAULT_SVG_FONT_SIZE),p[0]){case"mm":return c*t.DPI/25.4;case"cm":return c*t.DPI/2.54;case"in":return c*t.DPI;case"pt":return c*t.DPI/72;case"pc":return c*t.DPI/72*12;case"em":return c*d;default:return c}},falseFunction:function(){return!1},getKlass:function(o,d){return o=t.util.string.camelize(o.charAt(0).toUpperCase()+o.slice(1)),t.util.resolveNamespace(d)[o]},getSvgAttributes:function(o){var d=["instantiated_by_use","style","id","class"];switch(o){case"linearGradient":d=d.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":d=d.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":d=d.concat(["offset","stop-color","stop-opacity"]);break}return d},resolveNamespace:function(o){if(!o)return t;var d=o.split("."),p=d.length,c,m=a||t.window;for(c=0;c<p;++c)m=m[d[c]];return m},loadImage:function(o,d,p,c){if(!o){d&&d.call(p,o);return}var m=t.util.createImage(),_=function(){d&&d.call(p,m,!1),m=m.onload=m.onerror=null};m.onload=_,m.onerror=function(){t.log("Error loading "+m.src),d&&d.call(p,null,!0),m=m.onload=m.onerror=null},o.indexOf("data")!==0&&c!==void 0&&c!==null&&(m.crossOrigin=c),o.substring(0,14)==="data:image/svg"&&(m.onload=null,t.util.loadImageInDom(m,_)),m.src=o},loadImageInDom:function(o,d){var p=t.document.createElement("div");p.style.width=p.style.height="1px",p.style.left=p.style.top="-100%",p.style.position="absolute",p.appendChild(o),t.document.querySelector("body").appendChild(p),o.onload=function(){d(),p.parentNode.removeChild(p),p=null}},enlivenObjects:function(o,d,p,c){o=o||[];var m=[],_=0,b=o.length;function y(){++_===b&&d&&d(m.filter(function(x){return x}))}if(!b){d&&d(m);return}o.forEach(function(x,C){if(!x||!x.type){y();return}var w=t.util.getKlass(x.type,p);w.fromObject(x,function(O,E){E||(m[C]=O),c&&c(x,O,E),y()})})},enlivenObjectEnlivables:function(o,d,p){var c=t.Object.ENLIVEN_PROPS.filter(function(m){return!!o[m]});t.util.enlivenObjects(c.map(function(m){return o[m]}),function(m){var _={};c.forEach(function(b,y){_[b]=m[y],d&&(d[b]=m[y])}),p&&p(_)})},enlivenPatterns:function(o,d){o=o||[];function p(){++m===_&&d&&d(c)}var c=[],m=0,_=o.length;if(!_){d&&d(c);return}o.forEach(function(b,y){b&&b.source?new t.Pattern(b,function(x){c[y]=x,p()}):(c[y]=b,p())})},groupSVGElements:function(o,d,p){var c;return o&&o.length===1?(typeof p<"u"&&(o[0].sourcePath=p),o[0]):(d&&(d.width&&d.height?d.centerPoint={x:d.width/2,y:d.height/2}:(delete d.width,delete d.height)),c=new t.Group(o,d),typeof p<"u"&&(c.sourcePath=p),c)},populateWithProperties:function(o,d,p){if(p&&Array.isArray(p))for(var c=0,m=p.length;c<m;c++)p[c]in o&&(d[p[c]]=o[p[c]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(o){var d=t.util.createCanvasElement();return d.width=o.width,d.height=o.height,d.getContext("2d").drawImage(o,0,0),d},toDataURL:function(o,d,p){return o.toDataURL("image/"+d,p)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(o,d,p){return[o[0]*d[0]+o[2]*d[1],o[1]*d[0]+o[3]*d[1],o[0]*d[2]+o[2]*d[3],o[1]*d[2]+o[3]*d[3],p?0:o[0]*d[4]+o[2]*d[5]+o[4],p?0:o[1]*d[4]+o[3]*d[5]+o[5]]},qrDecompose:function(o){var d=h(o[1],o[0]),p=u(o[0],2)+u(o[1],2),c=n(p),m=(o[0]*o[3]-o[2]*o[1])/c,_=h(o[0]*o[2]+o[1]*o[3],p);return{angle:d/r,scaleX:c,scaleY:m,skewX:_/r,skewY:0,translateX:o[4],translateY:o[5]}},calcRotateMatrix:function(o){if(!o.angle)return t.iMatrix.concat();var d=t.util.degreesToRadians(o.angle),p=t.util.cos(d),c=t.util.sin(d);return[p,c,-c,p,0,0]},calcDimensionsMatrix:function(o){var d=typeof o.scaleX>"u"?1:o.scaleX,p=typeof o.scaleY>"u"?1:o.scaleY,c=[o.flipX?-d:d,0,0,o.flipY?-p:p,0,0],m=t.util.multiplyTransformMatrices,_=t.util.degreesToRadians;return o.skewX&&(c=m(c,[1,0,Math.tan(_(o.skewX)),1],!0)),o.skewY&&(c=m(c,[1,Math.tan(_(o.skewY)),0,1],!0)),c},composeMatrix:function(o){var d=[1,0,0,1,o.translateX||0,o.translateY||0],p=t.util.multiplyTransformMatrices;return o.angle&&(d=p(d,t.util.calcRotateMatrix(o))),(o.scaleX!==1||o.scaleY!==1||o.skewX||o.skewY||o.flipX||o.flipY)&&(d=p(d,t.util.calcDimensionsMatrix(o))),d},resetObjectTransform:function(o){o.scaleX=1,o.scaleY=1,o.skewX=0,o.skewY=0,o.flipX=!1,o.flipY=!1,o.rotate(0)},saveObjectTransform:function(o){return{scaleX:o.scaleX,scaleY:o.scaleY,skewX:o.skewX,skewY:o.skewY,angle:o.angle,left:o.left,flipX:o.flipX,flipY:o.flipY,top:o.top}},isTransparent:function(o,d,p,c){c>0&&(d>c?d-=c:d=0,p>c?p-=c:p=0);var m=!0,_,b,y=o.getImageData(d,p,c*2||1,c*2||1),x=y.data.length;for(_=3;_<x&&(b=y.data[_],m=b<=0,m!==!1);_+=4);return y=null,m},parsePreserveAspectRatioAttribute:function(o){var d="meet",p="Mid",c="Mid",m=o.split(" "),_;return m&&m.length&&(d=m.pop(),d!=="meet"&&d!=="slice"?(_=d,d="meet"):m.length&&(_=m.pop())),p=_!=="none"?_.slice(1,4):"none",c=_!=="none"?_.slice(5,8):"none",{meetOrSlice:d,alignX:p,alignY:c}},clearFabricFontCache:function(o){o=(o||"").toLowerCase(),o?t.charWidthsCache[o]&&delete t.charWidthsCache[o]:t.charWidthsCache={}},limitDimsByArea:function(o,d){var p=Math.sqrt(d*o),c=Math.floor(d/p);return{x:Math.floor(p),y:c}},capValue:function(o,d,p){return Math.max(o,Math.min(d,p))},findScaleToFit:function(o,d){return Math.min(d.width/o.width,d.height/o.height)},findScaleToCover:function(o,d){return Math.max(d.width/o.width,d.height/o.height)},matrixToSVG:function(o){return"matrix("+o.map(function(d){return t.util.toFixed(d,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(o,d){var p=t.util.invertTransform(d),c=t.util.multiplyTransformMatrices(p,o.calcOwnMatrix());t.util.applyTransformToObject(o,c)},addTransformToObject:function(o,d){t.util.applyTransformToObject(o,t.util.multiplyTransformMatrices(d,o.calcOwnMatrix()))},applyTransformToObject:function(o,d){var p=t.util.qrDecompose(d),c=new t.Point(p.translateX,p.translateY);o.flipX=!1,o.flipY=!1,o.set("scaleX",p.scaleX),o.set("scaleY",p.scaleY),o.skewX=p.skewX,o.skewY=p.skewY,o.angle=p.angle,o.setPositionByOrigin(c,"center","center")},sizeAfterTransform:function(o,d,p){var c=o/2,m=d/2,_=[{x:-c,y:-m},{x:c,y:-m},{x:-c,y:m},{x:c,y:m}],b=t.util.calcDimensionsMatrix(p),y=t.util.makeBoundingBoxFromPoints(_,b);return{x:y.width,y:y.height}},mergeClipPaths:function(o,d){var p=o,c=d;p.inverted&&!c.inverted&&(p=d,c=o),t.util.applyTransformToObject(c,t.util.multiplyTransformMatrices(t.util.invertTransform(p.calcTransformMatrix()),c.calcTransformMatrix()));var m=p.inverted&&c.inverted;return m&&(p.inverted=c.inverted=!1),new t.Group([p],{clipPath:c,inverted:m})},hasStyleChanged:function(o,d,p){return p=p||!1,o.fill!==d.fill||o.stroke!==d.stroke||o.strokeWidth!==d.strokeWidth||o.fontSize!==d.fontSize||o.fontFamily!==d.fontFamily||o.fontWeight!==d.fontWeight||o.fontStyle!==d.fontStyle||o.textBackgroundColor!==d.textBackgroundColor||o.deltaY!==d.deltaY||p&&(o.overline!==d.overline||o.underline!==d.underline||o.linethrough!==d.linethrough)},stylesToArray:function(p,d){for(var p=t.util.object.clone(p,!0),c=d.split(`
`),m=-1,_={},b=[],y=0;y<c.length;y++){if(!p[y]){m+=c[y].length;continue}for(var x=0;x<c[y].length;x++){m++;var C=p[y][x];if(C&&Object.keys(C).length>0){var w=t.util.hasStyleChanged(_,C,!0);w?b.push({start:m,end:m+1,style:C}):b[b.length-1].end++}_=C||{}}}return b},stylesFromArray:function(o,d){if(!Array.isArray(o))return o;for(var p=d.split(`
`),c=-1,m=0,_={},b=0;b<p.length;b++)for(var y=0;y<p[b].length;y++)c++,o[m]&&o[m].start<=c&&c<o[m].end&&(_[b]=_[b]||{},_[b][y]=Object.assign({},o[m].style),c===o[m].end-1&&m++);return _}}}(i),function(){var a=Array.prototype.join,n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};function u(S,P,D,M,I,k,T,A,L,N,R){var V=t.util.cos(S),W=t.util.sin(S),J=t.util.cos(P),B=t.util.sin(P),F=D*I*J-M*k*B+T,Y=M*I*J+D*k*B+A,U=N+L*(-D*I*W-M*k*V),z=R+L*(-M*I*W+D*k*V),$=F+L*(D*I*B+M*k*J),tt=Y+L*(M*I*B-D*k*J);return["C",U,z,$,tt,F,Y]}function r(S,P,D,M,I,k,T){var A=Math.PI,L=T*A/180,N=t.util.sin(L),R=t.util.cos(L),V=0,W=0;D=Math.abs(D),M=Math.abs(M);var J=-R*S*.5-N*P*.5,B=-R*P*.5+N*S*.5,F=D*D,Y=M*M,U=B*B,z=J*J,$=F*Y-F*U-Y*z,tt=0;if($<0){var lt=Math.sqrt(1-$/(F*Y));D*=lt,M*=lt}else tt=(I===k?-1:1)*Math.sqrt($/(F*U+Y*z));var st=tt*D*B/M,X=-tt*M*J/D,rt=R*st-N*X+S*.5,ht=N*st+R*X+P*.5,ft=l(1,0,(J-st)/D,(B-X)/M),bt=l((J-st)/D,(B-X)/M,(-J-st)/D,(-B-X)/M);k===0&&bt>0?bt-=2*A:k===1&&bt<0&&(bt+=2*A);for(var mt=Math.ceil(Math.abs(bt/A*2)),Pt=[],Tt=bt/mt,ve=8/3*Math.sin(Tt/4)*Math.sin(Tt/4)/Math.sin(Tt/2),We=ft+Tt,Xt=0;Xt<mt;Xt++)Pt[Xt]=u(ft,We,R,N,D,M,rt,ht,ve,V,W),V=Pt[Xt][5],W=Pt[Xt][6],ft=We,We+=Tt;return Pt}function l(S,P,D,M){var I=Math.atan2(P,S),k=Math.atan2(M,D);return k>=I?k-I:2*Math.PI-(I-k)}function o(S,P,D,M,I,k,T,A){var L;if(t.cachesBoundsOfCurve&&(L=a.call(arguments),t.boundsOfCurveCache[L]))return t.boundsOfCurveCache[L];var N=Math.sqrt,R=Math.min,V=Math.max,W=Math.abs,J=[],B=[[],[]],F,Y,U,z,$,tt,lt,st;Y=6*S-12*D+6*I,F=-3*S+9*D-9*I+3*T,U=3*D-3*S;for(var X=0;X<2;++X){if(X>0&&(Y=6*P-12*M+6*k,F=-3*P+9*M-9*k+3*A,U=3*M-3*P),W(F)<1e-12){if(W(Y)<1e-12)continue;z=-U/Y,0<z&&z<1&&J.push(z);continue}lt=Y*Y-4*U*F,!(lt<0)&&(st=N(lt),$=(-Y+st)/(2*F),0<$&&$<1&&J.push($),tt=(-Y-st)/(2*F),0<tt&&tt<1&&J.push(tt))}for(var rt,ht,ft=J.length,bt=ft,mt;ft--;)z=J[ft],mt=1-z,rt=mt*mt*mt*S+3*mt*mt*z*D+3*mt*z*z*I+z*z*z*T,B[0][ft]=rt,ht=mt*mt*mt*P+3*mt*mt*z*M+3*mt*z*z*k+z*z*z*A,B[1][ft]=ht;B[0][bt]=S,B[1][bt]=P,B[0][bt+1]=T,B[1][bt+1]=A;var Pt=[{x:R.apply(null,B[0]),y:R.apply(null,B[1])},{x:V.apply(null,B[0]),y:V.apply(null,B[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[L]=Pt),Pt}function d(S,P,D){for(var M=D[1],I=D[2],k=D[3],T=D[4],A=D[5],L=D[6],N=D[7],R=r(L-S,N-P,M,I,T,A,k),V=0,W=R.length;V<W;V++)R[V][1]+=S,R[V][2]+=P,R[V][3]+=S,R[V][4]+=P,R[V][5]+=S,R[V][6]+=P;return R}function p(S){var P=0,D=0,M=S.length,I=0,k=0,T,A,L,N=[],R,V,W;for(A=0;A<M;++A){switch(L=!1,T=S[A].slice(0),T[0]){case"l":T[0]="L",T[1]+=P,T[2]+=D;case"L":P=T[1],D=T[2];break;case"h":T[1]+=P;case"H":T[0]="L",T[2]=D,P=T[1];break;case"v":T[1]+=D;case"V":T[0]="L",D=T[1],T[1]=P,T[2]=D;break;case"m":T[0]="M",T[1]+=P,T[2]+=D;case"M":P=T[1],D=T[2],I=T[1],k=T[2];break;case"c":T[0]="C",T[1]+=P,T[2]+=D,T[3]+=P,T[4]+=D,T[5]+=P,T[6]+=D;case"C":V=T[3],W=T[4],P=T[5],D=T[6];break;case"s":T[0]="S",T[1]+=P,T[2]+=D,T[3]+=P,T[4]+=D;case"S":R==="C"?(V=2*P-V,W=2*D-W):(V=P,W=D),P=T[3],D=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=V,T[2]=W,V=T[3],W=T[4];break;case"q":T[0]="Q",T[1]+=P,T[2]+=D,T[3]+=P,T[4]+=D;case"Q":V=T[1],W=T[2],P=T[3],D=T[4];break;case"t":T[0]="T",T[1]+=P,T[2]+=D;case"T":R==="Q"?(V=2*P-V,W=2*D-W):(V=P,W=D),T[0]="Q",P=T[1],D=T[2],T[1]=V,T[2]=W,T[3]=P,T[4]=D;break;case"a":T[0]="A",T[6]+=P,T[7]+=D;case"A":L=!0,N=N.concat(d(P,D,T)),P=T[6],D=T[7];break;case"z":case"Z":P=I,D=k;break}L||N.push(T),R=T[0]}return N}function c(S,P,D,M){return Math.sqrt((D-S)*(D-S)+(M-P)*(M-P))}function m(S){return S*S*S}function _(S){return 3*S*S*(1-S)}function b(S){return 3*S*(1-S)*(1-S)}function y(S){return(1-S)*(1-S)*(1-S)}function x(S,P,D,M,I,k,T,A){return function(L){var N=m(L),R=_(L),V=b(L),W=y(L);return{x:T*N+I*R+D*V+S*W,y:A*N+k*R+M*V+P*W}}}function C(S,P,D,M,I,k,T,A){return function(L){var N=1-L,R=3*N*N*(D-S)+6*N*L*(I-D)+3*L*L*(T-I),V=3*N*N*(M-P)+6*N*L*(k-M)+3*L*L*(A-k);return Math.atan2(V,R)}}function w(S){return S*S}function O(S){return 2*S*(1-S)}function E(S){return(1-S)*(1-S)}function j(S,P,D,M,I,k){return function(T){var A=w(T),L=O(T),N=E(T);return{x:I*A+D*L+S*N,y:k*A+M*L+P*N}}}function H(S,P,D,M,I,k){return function(T){var A=1-T,L=2*A*(D-S)+2*T*(I-D),N=2*A*(M-P)+2*T*(k-M);return Math.atan2(N,L)}}function q(S,P,D){var M={x:P,y:D},I,k=0,T;for(T=1;T<=100;T+=1)I=S(T/100),k+=c(M.x,M.y,I.x,I.y),M=I;return k}function Q(S,P){for(var D=0,M=0,I=S.iterator,k={x:S.x,y:S.y},T,A,L=.01,N=S.angleFinder,R;M<P&&L>1e-4;)T=I(D),R=D,A=c(k.x,k.y,T.x,T.y),A+M>P?(D-=L,L/=2):(k=T,D+=L,M+=A);return T.angle=N(R),T}function K(S){for(var P=0,D=S.length,M,I=0,k=0,T=0,A=0,L=[],N,R,V,W=0;W<D;W++){switch(M=S[W],R={x:I,y:k,command:M[0]},M[0]){case"M":R.length=0,T=I=M[1],A=k=M[2];break;case"L":R.length=c(I,k,M[1],M[2]),I=M[1],k=M[2];break;case"C":N=x(I,k,M[1],M[2],M[3],M[4],M[5],M[6]),V=C(I,k,M[1],M[2],M[3],M[4],M[5],M[6]),R.iterator=N,R.angleFinder=V,R.length=q(N,I,k),I=M[5],k=M[6];break;case"Q":N=j(I,k,M[1],M[2],M[3],M[4]),V=H(I,k,M[1],M[2],M[3],M[4]),R.iterator=N,R.angleFinder=V,R.length=q(N,I,k),I=M[3],k=M[4];break;case"Z":case"z":R.destX=T,R.destY=A,R.length=c(I,k,T,A),I=T,k=A;break}P+=R.length,L.push(R)}return L.push({length:P,x:I,y:k}),L}function G(S,P,D){D||(D=K(S));for(var M=0;P-D[M].length>0&&M<D.length-2;)P-=D[M].length,M++;var I=D[M],k=P/I.length,T=I.command,A=S[M],L;switch(T){case"M":return{x:I.x,y:I.y,angle:0};case"Z":case"z":return L=new t.Point(I.x,I.y).lerp(new t.Point(I.destX,I.destY),k),L.angle=Math.atan2(I.destY-I.y,I.destX-I.x),L;case"L":return L=new t.Point(I.x,I.y).lerp(new t.Point(A[1],A[2]),k),L.angle=Math.atan2(A[2]-I.y,A[1]-I.x),L;case"C":return Q(I,P);case"Q":return Q(I,P)}}function Z(S){var P=[],D=[],M,I,k=t.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",A="("+T+")"+t.commaWsp,L="([01])"+t.commaWsp+"?",N=A+"?"+A+"?"+A+L+L+A+"?("+T+")",R=new RegExp(N,"g"),V,W,J;if(!S||!S.match)return P;J=S.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var B=0,F,Y=J.length;B<Y;B++){M=J[B],W=M.slice(1).trim(),D.length=0;var U=M.charAt(0);if(F=[U],U.toLowerCase()==="a")for(var z;z=R.exec(W);)for(var $=1;$<z.length;$++)D.push(z[$]);else for(;V=k.exec(W);)D.push(V[0]);for(var $=0,tt=D.length;$<tt;$++)I=parseFloat(D[$]),isNaN(I)||F.push(I);var lt=n[U.toLowerCase()],st=h[U]||U;if(F.length-1>lt)for(var X=1,rt=F.length;X<rt;X+=lt)P.push([U].concat(F.slice(X,X+lt))),U=st;else P.push(F)}return P}function et(S,P){var D=[],M,I=new t.Point(S[0].x,S[0].y),k=new t.Point(S[1].x,S[1].y),T=S.length,A=1,L=0,N=T>2;for(P=P||0,N&&(A=S[2].x<k.x?-1:S[2].x===k.x?0:1,L=S[2].y<k.y?-1:S[2].y===k.y?0:1),D.push(["M",I.x-A*P,I.y-L*P]),M=1;M<T;M++){if(!I.eq(k)){var R=I.midPointFrom(k);D.push(["Q",I.x,I.y,R.x,R.y])}I=S[M],M+1<S.length&&(k=S[M+1])}return N&&(A=I.x>S[M-2].x?1:I.x===S[M-2].x?0:-1,L=I.y>S[M-2].y?1:I.y===S[M-2].y?0:-1),D.push(["L",I.x+A*P,I.y+L*P]),D}function it(S,P,D){return D&&(P=t.util.multiplyTransformMatrices(P,[1,0,0,1,-D.x,-D.y])),S.map(function(M){for(var I=M.slice(0),k={},T=1;T<M.length-1;T+=2)k.x=M[T],k.y=M[T+1],k=t.util.transformPoint(k,P),I[T]=k.x,I[T+1]=k.y;return I})}t.util.joinPath=function(S){return S.map(function(P){return P.join(" ")}).join(" ")},t.util.parsePath=Z,t.util.makePathSimpler=p,t.util.getSmoothPathFromPoints=et,t.util.getPathSegmentsInfo=K,t.util.getBoundsOfCurve=o,t.util.getPointOnPath=G,t.util.transformPath=it}(),function(){var a=Array.prototype.slice;function n(o,d){for(var p=a.call(arguments,2),c=[],m=0,_=o.length;m<_;m++)c[m]=p.length?o[m][d].apply(o[m],p):o[m][d].call(o[m]);return c}function h(o,d){return l(o,d,function(p,c){return p>=c})}function u(o,d){return l(o,d,function(p,c){return p<c})}function r(o,d){for(var p=o.length;p--;)o[p]=d;return o}function l(o,d,p){if(!(!o||o.length===0)){var c=o.length-1,m=d?o[c][d]:o[c];if(d)for(;c--;)p(o[c][d],m)&&(m=o[c][d]);else for(;c--;)p(o[c],m)&&(m=o[c]);return m}}t.util.array={fill:r,invoke:n,min:u,max:h}}(),function(){function a(h,u,r){if(r)if(!t.isLikelyNode&&u instanceof Element)h=u;else if(u instanceof Array){h=[];for(var l=0,o=u.length;l<o;l++)h[l]=a({},u[l],r)}else if(u&&typeof u=="object")for(var d in u)d==="canvas"||d==="group"?h[d]=null:u.hasOwnProperty(d)&&(h[d]=a({},u[d],r));else h=u;else for(var d in u)h[d]=u[d];return h}function n(h,u){return a({},h,u)}t.util.object={extend:a,clone:n},t.util.object.extend(t.util,t.Observable)}(),function(){function a(l){return l.replace(/-+(.)?/g,function(o,d){return d?d.toUpperCase():""})}function n(l,o){return l.charAt(0).toUpperCase()+(o?l.slice(1):l.slice(1).toLowerCase())}function h(l){return l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(l){var o=0,d,p=[];for(o=0,d;o<l.length;o++)(d=r(l,o))!==!1&&p.push(d);return p}function r(l,o){var d=l.charCodeAt(o);if(isNaN(d))return"";if(d<55296||d>57343)return l.charAt(o);if(55296<=d&&d<=56319){if(l.length<=o+1)throw"High surrogate without following low surrogate";var p=l.charCodeAt(o+1);if(56320>p||p>57343)throw"High surrogate without following low surrogate";return l.charAt(o)+l.charAt(o+1)}if(o===0)throw"Low surrogate without preceding high surrogate";var c=l.charCodeAt(o-1);if(55296>c||c>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:a,capitalize:n,escapeXml:h,graphemeSplit:u}}(),function(){var a=Array.prototype.slice,n=function(){},h=function(){for(var d in{toString:1})if(d==="toString")return!1;return!0}(),u=function(d,p,c){for(var m in p)m in d.prototype&&typeof d.prototype[m]=="function"&&(p[m]+"").indexOf("callSuper")>-1?d.prototype[m]=function(_){return function(){var b=this.constructor.superclass;this.constructor.superclass=c;var y=p[_].apply(this,arguments);if(this.constructor.superclass=b,_!=="initialize")return y}}(m):d.prototype[m]=p[m],h&&(p.toString!==Object.prototype.toString&&(d.prototype.toString=p.toString),p.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=p.valueOf))};function r(){}function l(d){for(var p=null,c=this;c.constructor.superclass;){var m=c.constructor.superclass.prototype[d];if(c[d]!==m){p=m;break}c=c.constructor.superclass.prototype}return p?arguments.length>1?p.apply(this,a.call(arguments,1)):p.call(this):console.log("tried to callSuper "+d+", method not found in prototype chain",this)}function o(){var d=null,p=a.call(arguments,0);typeof p[0]=="function"&&(d=p.shift());function c(){this.initialize.apply(this,arguments)}c.superclass=d,c.subclasses=[],d&&(r.prototype=d.prototype,c.prototype=new r,d.subclasses.push(c));for(var m=0,_=p.length;m<_;m++)u(c,p[m],d);return c.prototype.initialize||(c.prototype.initialize=n),c.prototype.constructor=c,c.prototype.callSuper=l,c}t.util.createClass=o}(),function(){var a=!!t.document.createElement("div").attachEvent,n=["touchstart","touchmove","touchend"];t.util.addListener=function(u,r,l,o){u&&u.addEventListener(r,l,a?!1:o)},t.util.removeListener=function(u,r,l,o){u&&u.removeEventListener(r,l,a?!1:o)};function h(u){var r=u.changedTouches;return r&&r[0]?r[0]:u}t.util.getPointer=function(u){var r=u.target,l=t.util.getScrollLeftTop(r),o=h(u);return{x:o.clientX+l.left,y:o.clientY+l.top}},t.util.isTouchEvent=function(u){return n.indexOf(u.type)>-1||u.pointerType==="touch"}}(),function(){function a(o,d){var p=o.style;if(!p)return o;if(typeof d=="string")return o.style.cssText+=";"+d,d.indexOf("opacity")>-1?l(o,d.match(/opacity:\s*(\d?\.?\d*)/)[1]):o;for(var c in d)if(c==="opacity")l(o,d[c]);else{var m=c==="float"||c==="cssFloat"?typeof p.styleFloat>"u"?"cssFloat":"styleFloat":c;p.setProperty(m,d[c])}return o}var n=t.document.createElement("div"),h=typeof n.style.opacity=="string",u=typeof n.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,l=function(o){return o};h?l=function(o,d){return o.style.opacity=d,o}:u&&(l=function(o,d){var p=o.style;return o.currentStyle&&!o.currentStyle.hasLayout&&(p.zoom=1),r.test(p.filter)?(d=d>=.9999?"":"alpha(opacity="+d*100+")",p.filter=p.filter.replace(r,d)):p.filter+=" alpha(opacity="+d*100+")",o}),t.util.setStyle=a}(),function(){var a=Array.prototype.slice;function n(y){return typeof y=="string"?t.document.getElementById(y):y}var h,u=function(y){return a.call(y,0)};try{h=u(t.document.childNodes)instanceof Array}catch{}h||(u=function(y){for(var x=new Array(y.length),C=y.length;C--;)x[C]=y[C];return x});function r(y,x){var C=t.document.createElement(y);for(var w in x)w==="class"?C.className=x[w]:w==="for"?C.htmlFor=x[w]:C.setAttribute(w,x[w]);return C}function l(y,x){y&&(" "+y.className+" ").indexOf(" "+x+" ")===-1&&(y.className+=(y.className?" ":"")+x)}function o(y,x,C){return typeof x=="string"&&(x=r(x,C)),y.parentNode&&y.parentNode.replaceChild(x,y),x.appendChild(y),x}function d(y){for(var x=0,C=0,w=t.document.documentElement,O=t.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&(y=y.parentNode||y.host,y===t.document?(x=O.scrollLeft||w.scrollLeft||0,C=O.scrollTop||w.scrollTop||0):(x+=y.scrollLeft||0,C+=y.scrollTop||0),!(y.nodeType===1&&y.style.position==="fixed")););return{left:x,top:C}}function p(y){var x,C=y&&y.ownerDocument,w={left:0,top:0},O={left:0,top:0},E,j={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return O;for(var H in j)O[j[H]]+=parseInt(c(y,H),10)||0;return x=C.documentElement,typeof y.getBoundingClientRect<"u"&&(w=y.getBoundingClientRect()),E=d(y),{left:w.left+E.left-(x.clientLeft||0)+O.left,top:w.top+E.top-(x.clientTop||0)+O.top}}var c;t.document.defaultView&&t.document.defaultView.getComputedStyle?c=function(y,x){var C=t.document.defaultView.getComputedStyle(y,null);return C?C[x]:void 0}:c=function(y,x){var C=y.style[x];return!C&&y.currentStyle&&(C=y.currentStyle[x]),C},function(){var y=t.document.documentElement.style,x="userSelect"in y?"userSelect":"MozUserSelect"in y?"MozUserSelect":"WebkitUserSelect"in y?"WebkitUserSelect":"KhtmlUserSelect"in y?"KhtmlUserSelect":"";function C(O){return typeof O.onselectstart<"u"&&(O.onselectstart=t.util.falseFunction),x?O.style[x]="none":typeof O.unselectable=="string"&&(O.unselectable="on"),O}function w(O){return typeof O.onselectstart<"u"&&(O.onselectstart=null),x?O.style[x]="":typeof O.unselectable=="string"&&(O.unselectable=""),O}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=w}();function m(y){var x=t.jsdomImplForWrapper(y);return x._canvas||x._image}function _(y){if(t.isLikelyNode){var x=t.jsdomImplForWrapper(y);x&&(x._image=null,x._canvas=null,x._currentSrc=null,x._attributes=null,x._classList=null)}}function b(y,x){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=x}t.util.setImageSmoothing=b,t.util.getById=n,t.util.toArray=u,t.util.addClass=l,t.util.makeElement=r,t.util.wrapElement=o,t.util.getScrollLeftTop=d,t.util.getElementOffset=p,t.util.getNodeCanvas=m,t.util.cleanUpJsdomNode=_}(),function(){function a(u,r){return u+(/\?/.test(u)?"&":"?")+r}function n(){}function h(u,r){r||(r={});var l=r.method?r.method.toUpperCase():"GET",o=r.onComplete||function(){},d=new t.window.XMLHttpRequest,p=r.body||r.parameters;return d.onreadystatechange=function(){d.readyState===4&&(o(d),d.onreadystatechange=n)},l==="GET"&&(p=null,typeof r.parameters=="string"&&(u=a(u,r.parameters))),d.open(l,u,!0),(l==="POST"||l==="PUT")&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(p),d}t.util.request=h}(),t.log=console.log,t.warn=console.warn,function(){var a=t.util.object.extend,n=t.util.object.clone,h=[];t.util.object.extend(h,{cancelAll:function(){var m=this.splice(0);return m.forEach(function(_){_.cancel()}),m},cancelByCanvas:function(m){if(!m)return[];var _=this.filter(function(b){return typeof b.target=="object"&&b.target.canvas===m});return _.forEach(function(b){b.cancel()}),_},cancelByTarget:function(m){var _=this.findAnimationsByTarget(m);return _.forEach(function(b){b.cancel()}),_},findAnimationIndex:function(m){return this.indexOf(this.findAnimation(m))},findAnimation:function(m){return this.find(function(_){return _.cancel===m})},findAnimationsByTarget:function(m){return m?this.filter(function(_){return _.target===m}):[]}});function u(){return!1}function r(m,_,b,y){return-b*Math.cos(m/y*(Math.PI/2))+b+_}function l(m){m||(m={});var _=!1,b,y=function(){var x=t.runningAnimations.indexOf(b);return x>-1&&t.runningAnimations.splice(x,1)[0]};return b=a(n(m),{cancel:function(){return _=!0,y()},currentValue:"startValue"in m?m.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(b),p(function(x){var C=x||+new Date,w=m.duration||500,O=C+w,E,j=m.onChange||u,H=m.abort||u,q=m.onComplete||u,Q=m.easing||r,K="startValue"in m?m.startValue.length>0:!1,G="startValue"in m?m.startValue:0,Z="endValue"in m?m.endValue:100,et=m.byValue||(K?G.map(function(it,S){return Z[S]-G[S]}):Z-G);m.onStart&&m.onStart(),function it(S){E=S||+new Date;var P=E>O?w:E-C,D=P/w,M=K?G.map(function(k,T){return Q(P,G[T],et[T],w)}):Q(P,G,et,w),I=Math.abs(K?(M[0]-G[0])/et[0]:(M-G)/et);if(b.currentValue=K?M.slice():M,b.completionRate=I,b.durationRate=D,!_){if(H(M,I,D)){y();return}if(E>O){b.currentValue=K?Z.slice():Z,b.completionRate=1,b.durationRate=1,j(K?Z.slice():Z,1,1),q(Z,1,1),y();return}else j(M,I,D),p(it)}}(C)}),b.cancel}var o=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(m){return t.window.setTimeout(m,1e3/60)},d=t.window.cancelAnimationFrame||t.window.clearTimeout;function p(){return o.apply(t.window,arguments)}function c(){return d.apply(t.window,arguments)}t.util.animate=l,t.util.requestAnimFrame=p,t.util.cancelAnimFrame=c,t.runningAnimations=h}(),function(){function a(h,u,r){var l="rgba("+parseInt(h[0]+r*(u[0]-h[0]),10)+","+parseInt(h[1]+r*(u[1]-h[1]),10)+","+parseInt(h[2]+r*(u[2]-h[2]),10);return l+=","+(h&&u?parseFloat(h[3]+r*(u[3]-h[3])):1),l+=")",l}function n(h,u,r,l){var o=new t.Color(h).getSource(),d=new t.Color(u).getSource(),p=l.onComplete,c=l.onChange;return l=l||{},t.util.animate(t.util.object.extend(l,{duration:r||500,startValue:o,endValue:d,byValue:d,easing:function(m,_,b,y){var x=l.colorEasing?l.colorEasing(m,y):1-Math.cos(m/y*(Math.PI/2));return a(_,b,x)},onComplete:function(m,_,b){if(p)return p(a(d,d,0),_,b)},onChange:function(m,_,b){if(c){if(Array.isArray(m))return c(a(m,m,0),_,b);c(m,_,b)}}}))}t.util.animateColor=n}(),function(){function a(S,P,D,M){return S<Math.abs(P)?(S=P,M=D/4):P===0&&S===0?M=D/(2*Math.PI)*Math.asin(1):M=D/(2*Math.PI)*Math.asin(P/S),{a:S,c:P,p:D,s:M}}function n(S,P,D){return S.a*Math.pow(2,10*(P-=1))*Math.sin((P*D-S.s)*(2*Math.PI)/S.p)}function h(S,P,D,M){return D*((S=S/M-1)*S*S+1)+P}function u(S,P,D,M){return S/=M/2,S<1?D/2*S*S*S+P:D/2*((S-=2)*S*S+2)+P}function r(S,P,D,M){return D*(S/=M)*S*S*S+P}function l(S,P,D,M){return-D*((S=S/M-1)*S*S*S-1)+P}function o(S,P,D,M){return S/=M/2,S<1?D/2*S*S*S*S+P:-D/2*((S-=2)*S*S*S-2)+P}function d(S,P,D,M){return D*(S/=M)*S*S*S*S+P}function p(S,P,D,M){return D*((S=S/M-1)*S*S*S*S+1)+P}function c(S,P,D,M){return S/=M/2,S<1?D/2*S*S*S*S*S+P:D/2*((S-=2)*S*S*S*S+2)+P}function m(S,P,D,M){return-D*Math.cos(S/M*(Math.PI/2))+D+P}function _(S,P,D,M){return D*Math.sin(S/M*(Math.PI/2))+P}function b(S,P,D,M){return-D/2*(Math.cos(Math.PI*S/M)-1)+P}function y(S,P,D,M){return S===0?P:D*Math.pow(2,10*(S/M-1))+P}function x(S,P,D,M){return S===M?P+D:D*(-Math.pow(2,-10*S/M)+1)+P}function C(S,P,D,M){return S===0?P:S===M?P+D:(S/=M/2,S<1?D/2*Math.pow(2,10*(S-1))+P:D/2*(-Math.pow(2,-10*--S)+2)+P)}function w(S,P,D,M){return-D*(Math.sqrt(1-(S/=M)*S)-1)+P}function O(S,P,D,M){return D*Math.sqrt(1-(S=S/M-1)*S)+P}function E(S,P,D,M){return S/=M/2,S<1?-D/2*(Math.sqrt(1-S*S)-1)+P:D/2*(Math.sqrt(1-(S-=2)*S)+1)+P}function j(S,P,D,M){var I=1.70158,k=0,T=D;if(S===0)return P;if(S/=M,S===1)return P+D;k||(k=M*.3);var A=a(T,D,k,I);return-n(A,S,M)+P}function H(S,P,D,M){var I=1.70158,k=0,T=D;if(S===0)return P;if(S/=M,S===1)return P+D;k||(k=M*.3);var A=a(T,D,k,I);return A.a*Math.pow(2,-10*S)*Math.sin((S*M-A.s)*(2*Math.PI)/A.p)+A.c+P}function q(S,P,D,M){var I=1.70158,k=0,T=D;if(S===0)return P;if(S/=M/2,S===2)return P+D;k||(k=M*(.3*1.5));var A=a(T,D,k,I);return S<1?-.5*n(A,S,M)+P:A.a*Math.pow(2,-10*(S-=1))*Math.sin((S*M-A.s)*(2*Math.PI)/A.p)*.5+A.c+P}function Q(S,P,D,M,I){return I===void 0&&(I=1.70158),D*(S/=M)*S*((I+1)*S-I)+P}function K(S,P,D,M,I){return I===void 0&&(I=1.70158),D*((S=S/M-1)*S*((I+1)*S+I)+1)+P}function G(S,P,D,M,I){return I===void 0&&(I=1.70158),S/=M/2,S<1?D/2*(S*S*(((I*=1.525)+1)*S-I))+P:D/2*((S-=2)*S*(((I*=1.525)+1)*S+I)+2)+P}function Z(S,P,D,M){return D-et(M-S,0,D,M)+P}function et(S,P,D,M){return(S/=M)<1/2.75?D*(7.5625*S*S)+P:S<2/2.75?D*(7.5625*(S-=1.5/2.75)*S+.75)+P:S<2.5/2.75?D*(7.5625*(S-=2.25/2.75)*S+.9375)+P:D*(7.5625*(S-=2.625/2.75)*S+.984375)+P}function it(S,P,D,M){return S<M/2?Z(S*2,0,D,M)*.5+P:et(S*2-M,0,D,M)*.5+D*.5+P}t.util.ease={easeInQuad:function(S,P,D,M){return D*(S/=M)*S+P},easeOutQuad:function(S,P,D,M){return-D*(S/=M)*(S-2)+P},easeInOutQuad:function(S,P,D,M){return S/=M/2,S<1?D/2*S*S+P:-D/2*(--S*(S-2)-1)+P},easeInCubic:function(S,P,D,M){return D*(S/=M)*S*S+P},easeOutCubic:h,easeInOutCubic:u,easeInQuart:r,easeOutQuart:l,easeInOutQuart:o,easeInQuint:d,easeOutQuint:p,easeInOutQuint:c,easeInSine:m,easeOutSine:_,easeInOutSine:b,easeInExpo:y,easeOutExpo:x,easeInOutExpo:C,easeInCirc:w,easeOutCirc:O,easeInOutCirc:E,easeInElastic:j,easeOutElastic:H,easeInOutElastic:q,easeInBack:Q,easeOutBack:K,easeInOutBack:G,easeInBounce:Z,easeOutBounce:et,easeInOutBounce:it}}(),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.util.object.clone,r=n.util.toFixed,l=n.util.parseUnit,o=n.util.multiplyTransformMatrices,d=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],p=["symbol","image","marker","pattern","view","svg"],c=["pattern","defs","symbol","metadata","clipPath","mask","desc"],m=["symbol","g","a","svg","clipPath","defs"],_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},b={stroke:"strokeOpacity",fill:"fillOpacity"},y="font-size",x="clip-path";n.svgValidTagNamesRegEx=O(d),n.svgViewBoxElementsRegEx=O(p),n.svgInvalidAncestorsRegEx=O(c),n.svgValidParentsRegEx=O(m),n.cssRules={},n.gradientDefs={},n.clipPaths={};function C(k){return k in _?_[k]:k}function w(k,T,A,L){var N=Array.isArray(T),R;if((k==="fill"||k==="stroke")&&T==="none")T="";else{if(k==="strokeUniform")return T==="non-scaling-stroke";if(k==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(k==="transformMatrix")A&&A.transformMatrix?T=o(A.transformMatrix,n.parseTransformAttribute(T)):T=n.parseTransformAttribute(T);else if(k==="visible")T=T!=="none"&&T!=="hidden",A&&A.visible===!1&&(T=!1);else if(k==="opacity")T=parseFloat(T),A&&typeof A.opacity<"u"&&(T*=A.opacity);else if(k==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(k==="charSpacing")R=l(T,L)/L*1e3;else if(k==="paintFirst"){var V=T.indexOf("fill"),W=T.indexOf("stroke"),T="fill";(V>-1&&W>-1&&W<V||V===-1&&W>-1)&&(T="stroke")}else{if(k==="href"||k==="xlink:href"||k==="font")return T;if(k==="imageSmoothing")return T==="optimizeQuality";R=N?T.map(l):l(T,L)}}return!N&&isNaN(R)?T:R}function O(k){return new RegExp("^("+k.join("|")+")\\b","i")}function E(k){for(var T in b)if(!(typeof k[b[T]]>"u"||k[T]==="")){if(typeof k[T]>"u"){if(!n.Object.prototype[T])continue;k[T]=n.Object.prototype[T]}if(k[T].indexOf("url(")!==0){var A=new n.Color(k[T]);k[T]=A.setAlpha(r(A.getAlpha()*k[b[T]],2)).toRgba()}}return k}function j(k,T){var A,L=[],N,R,V;for(R=0,V=T.length;R<V;R++)A=T[R],N=k.getElementsByTagName(A),L=L.concat(Array.prototype.slice.call(N));return L}n.parseTransformAttribute=function(){function k(X,rt){var ht=n.util.cos(rt[0]),ft=n.util.sin(rt[0]),bt=0,mt=0;rt.length===3&&(bt=rt[1],mt=rt[2]),X[0]=ht,X[1]=ft,X[2]=-ft,X[3]=ht,X[4]=bt-(ht*bt-ft*mt),X[5]=mt-(ft*bt+ht*mt)}function T(X,rt){var ht=rt[0],ft=rt.length===2?rt[1]:rt[0];X[0]=ht,X[3]=ft}function A(X,rt,ht){X[ht]=Math.tan(n.util.degreesToRadians(rt[0]))}function L(X,rt){X[4]=rt[0],rt.length===2&&(X[5]=rt[1])}var N=n.iMatrix,R=n.reNum,V=n.commaWsp,W="(?:(skewX)\\s*\\(\\s*("+R+")\\s*\\))",J="(?:(skewY)\\s*\\(\\s*("+R+")\\s*\\))",B="(?:(rotate)\\s*\\(\\s*("+R+")(?:"+V+"("+R+")"+V+"("+R+"))?\\s*\\))",F="(?:(scale)\\s*\\(\\s*("+R+")(?:"+V+"("+R+"))?\\s*\\))",Y="(?:(translate)\\s*\\(\\s*("+R+")(?:"+V+"("+R+"))?\\s*\\))",U="(?:(matrix)\\s*\\(\\s*("+R+")"+V+"("+R+")"+V+"("+R+")"+V+"("+R+")"+V+"("+R+")"+V+"("+R+")\\s*\\))",z="(?:"+U+"|"+Y+"|"+F+"|"+B+"|"+W+"|"+J+")",$="(?:"+z+"(?:"+V+"*"+z+")*)",tt="^\\s*(?:"+$+"?)\\s*$",lt=new RegExp(tt),st=new RegExp(z,"g");return function(X){var rt=N.concat(),ht=[];if(!X||X&&!lt.test(X))return rt;X.replace(st,function(bt){var mt=new RegExp(z).exec(bt).filter(function(ve){return!!ve}),Pt=mt[1],Tt=mt.slice(2).map(parseFloat);switch(Pt){case"translate":L(rt,Tt);break;case"rotate":Tt[0]=n.util.degreesToRadians(Tt[0]),k(rt,Tt);break;case"scale":T(rt,Tt);break;case"skewX":A(rt,Tt,2);break;case"skewY":A(rt,Tt,1);break;case"matrix":rt=Tt;break}ht.push(rt.concat()),rt=N.concat()});for(var ft=ht[0];ht.length>1;)ht.shift(),ft=n.util.multiplyTransformMatrices(ft,ht[0]);return ft}}();function H(k,T){var A,L;k.replace(/;\s*$/,"").split(";").forEach(function(N){var R=N.split(":");A=R[0].trim().toLowerCase(),L=R[1].trim(),T[A]=L})}function q(k,T){var A,L;for(var N in k)typeof k[N]>"u"||(A=N.toLowerCase(),L=k[N],T[A]=L)}function Q(k,T){var A={};for(var L in n.cssRules[T])if(K(k,L.split(" ")))for(var N in n.cssRules[T][L])A[N]=n.cssRules[T][L][N];return A}function K(k,T){var A,L=!0;return A=Z(k,T.pop()),A&&T.length&&(L=G(k,T)),A&&L&&T.length===0}function G(k,T){for(var A,L=!0;k.parentNode&&k.parentNode.nodeType===1&&T.length;)L&&(A=T.pop()),k=k.parentNode,L=Z(k,A);return T.length===0}function Z(k,T){var A=k.nodeName,L=k.getAttribute("class"),N=k.getAttribute("id"),R,V;if(R=new RegExp("^"+A,"i"),T=T.replace(R,""),N&&T.length&&(R=new RegExp("#"+N+"(?![a-zA-Z\\-]+)","i"),T=T.replace(R,"")),L&&T.length)for(L=L.split(" "),V=L.length;V--;)R=new RegExp("\\."+L[V]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(R,"");return T.length===0}function et(k,T){var A;if(k.getElementById&&(A=k.getElementById(T)),A)return A;var L,N,R,V=k.getElementsByTagName("*");for(N=0,R=V.length;N<R;N++)if(L=V[N],T===L.getAttribute("id"))return L}function it(k){for(var T=j(k,["use","svg:use"]),A=0;T.length&&A<T.length;){var L=T[A],N=L.getAttribute("xlink:href")||L.getAttribute("href");if(N===null)return;var R=N.slice(1),V=L.getAttribute("x")||0,W=L.getAttribute("y")||0,J=et(k,R).cloneNode(!0),B=(J.getAttribute("transform")||"")+" translate("+V+", "+W+")",F,Y=T.length,U,z,$,tt,lt=n.svgNS;if(P(J),/^svg$/i.test(J.nodeName)){var st=J.ownerDocument.createElementNS(lt,"g");for(z=0,$=J.attributes,tt=$.length;z<tt;z++)U=$.item(z),st.setAttributeNS(lt,U.nodeName,U.nodeValue);for(;J.firstChild;)st.appendChild(J.firstChild);J=st}for(z=0,$=L.attributes,tt=$.length;z<tt;z++)U=$.item(z),!(U.nodeName==="x"||U.nodeName==="y"||U.nodeName==="xlink:href"||U.nodeName==="href")&&(U.nodeName==="transform"?B=U.nodeValue+" "+B:J.setAttribute(U.nodeName,U.nodeValue));J.setAttribute("transform",B),J.setAttribute("instantiated_by_use","1"),J.removeAttribute("id"),F=L.parentNode,F.replaceChild(J,L),T.length===Y&&A++}}var S=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");function P(k){if(!n.svgViewBoxElementsRegEx.test(k.nodeName))return{};var T=k.getAttribute("viewBox"),A=1,L=1,N=0,R=0,V,W,J,B,F=k.getAttribute("width"),Y=k.getAttribute("height"),U=k.getAttribute("x")||0,z=k.getAttribute("y")||0,$=k.getAttribute("preserveAspectRatio")||"",tt=!T||!(T=T.match(S)),lt=!F||!Y||F==="100%"||Y==="100%",st=tt&&lt,X={},rt="",ht=0,ft=0;if(X.width=0,X.height=0,X.toBeParsed=st,tt&&(U||z)&&k.parentNode&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+l(U)+" "+l(z)+") ",J=(k.getAttribute("transform")||"")+rt,k.setAttribute("transform",J),k.removeAttribute("x"),k.removeAttribute("y")),st)return X;if(tt)return X.width=l(F),X.height=l(Y),X;if(N=-parseFloat(T[1]),R=-parseFloat(T[2]),V=parseFloat(T[3]),W=parseFloat(T[4]),X.minX=N,X.minY=R,X.viewBoxWidth=V,X.viewBoxHeight=W,lt?(X.width=V,X.height=W):(X.width=l(F),X.height=l(Y),A=X.width/V,L=X.height/W),$=n.util.parsePreserveAspectRatioAttribute($),$.alignX!=="none"&&($.meetOrSlice==="meet"&&(L=A=A>L?L:A),$.meetOrSlice==="slice"&&(L=A=A>L?A:L),ht=X.width-V*A,ft=X.height-W*A,$.alignX==="Mid"&&(ht/=2),$.alignY==="Mid"&&(ft/=2),$.alignX==="Min"&&(ht=0),$.alignY==="Min"&&(ft=0)),A===1&&L===1&&N===0&&R===0&&U===0&&z===0)return X;if((U||z)&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+l(U)+" "+l(z)+") "),J=rt+" matrix("+A+" 0 0 "+L+" "+(N*A+ht)+" "+(R*L+ft)+") ",k.nodeName==="svg"){for(B=k.ownerDocument.createElementNS(n.svgNS,"g");k.firstChild;)B.appendChild(k.firstChild);k.appendChild(B)}else B=k,B.removeAttribute("x"),B.removeAttribute("y"),J=B.getAttribute("transform")+J;return B.setAttribute("transform",J),X}function D(k,T){for(;k&&(k=k.parentNode);)if(k.nodeName&&T.test(k.nodeName.replace("svg:",""))&&!k.getAttribute("instantiated_by_use"))return!0;return!1}n.parseSVGDocument=function(k,T,A,L){if(k){it(k);var N=n.Object.__uid++,R,V,W=P(k),J=n.util.toArray(k.getElementsByTagName("*"));if(W.crossOrigin=L&&L.crossOrigin,W.svgUid=N,J.length===0&&n.isLikelyNode){J=k.selectNodes('//*[name(.)!="svg"]');var B=[];for(R=0,V=J.length;R<V;R++)B[R]=J[R];J=B}var F=J.filter(function(U){return P(U),n.svgValidTagNamesRegEx.test(U.nodeName.replace("svg:",""))&&!D(U,n.svgInvalidAncestorsRegEx)});if(!F||F&&!F.length){T&&T([],{});return}var Y={};J.filter(function(U){return U.nodeName.replace("svg:","")==="clipPath"}).forEach(function(U){var z=U.getAttribute("id");Y[z]=n.util.toArray(U.getElementsByTagName("*")).filter(function($){return n.svgValidTagNamesRegEx.test($.nodeName.replace("svg:",""))})}),n.gradientDefs[N]=n.getGradientDefs(k),n.cssRules[N]=n.getCSSRules(k),n.clipPaths[N]=Y,n.parseElements(F,function(U,z){T&&(T(U,W,z,J),delete n.gradientDefs[N],delete n.cssRules[N],delete n.clipPaths[N])},u(W),A,L)}};function M(k,T){var A=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],L="xlink:href",N=T.getAttribute(L).slice(1),R=et(k,N);if(R&&R.getAttribute(L)&&M(k,R),A.forEach(function(W){R&&!T.hasAttribute(W)&&R.hasAttribute(W)&&T.setAttribute(W,R.getAttribute(W))}),!T.children.length)for(var V=R.cloneNode(!0);V.firstChild;)T.appendChild(V.firstChild);T.removeAttribute(L)}var I=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");h(n,{parseFontDeclaration:function(k,T){var A=k.match(I);if(A){var L=A[1],N=A[3],R=A[4],V=A[5],W=A[6];L&&(T.fontStyle=L),N&&(T.fontWeight=isNaN(parseFloat(N))?N:parseFloat(N)),R&&(T.fontSize=l(R)),W&&(T.fontFamily=W),V&&(T.lineHeight=V==="normal"?1:V)}},getGradientDefs:function(k){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],A=j(k,T),L,N=0,R={};for(N=A.length;N--;)L=A[N],L.getAttribute("xlink:href")&&M(k,L),R[L.getAttribute("id")]=L;return R},parseAttributes:function(k,T,A){if(k){var L,N={},R,V;typeof A>"u"&&(A=k.getAttribute("svgUid")),k.parentNode&&n.svgValidParentsRegEx.test(k.parentNode.nodeName)&&(N=n.parseAttributes(k.parentNode,T,A));var W=T.reduce(function($,tt){return L=k.getAttribute(tt),L&&($[tt]=L),$},{}),J=h(Q(k,A),n.parseStyleAttribute(k));W=h(W,J),J[x]&&k.setAttribute(x,J[x]),R=V=N.fontSize||n.Text.DEFAULT_SVG_FONT_SIZE,W[y]&&(W[y]=R=l(W[y],V));var B,F,Y={};for(var U in W)B=C(U),F=w(B,W[U],N,R),Y[B]=F;Y&&Y.font&&n.parseFontDeclaration(Y.font,Y);var z=h(N,Y);return n.svgValidParentsRegEx.test(k.nodeName)?z:E(z)}},parseElements:function(k,T,A,L,N){new n.ElementsParser(k,T,A,L,N).parse()},parseStyleAttribute:function(k){var T={},A=k.getAttribute("style");return A&&(typeof A=="string"?H(A,T):q(A,T)),T},parsePointsAttribute:function(k){if(!k)return null;k=k.replace(/,/g," ").trim(),k=k.split(/\s+/);var T=[],A,L;for(A=0,L=k.length;A<L;A+=2)T.push({x:parseFloat(k[A]),y:parseFloat(k[A+1])});return T},getCSSRules:function(k){var T=k.getElementsByTagName("style"),A,L,N={},R;for(A=0,L=T.length;A<L;A++){var V=T[A].textContent;V=V.replace(/\/\*[\s\S]*?\*\//g,""),V.trim()!==""&&(R=V.split("}"),R=R.filter(function(W){return W.trim()}),R.forEach(function(W){var J=W.split("{"),B={},F=J[1].trim(),Y=F.split(";").filter(function(tt){return tt.trim()});for(A=0,L=Y.length;A<L;A++){var U=Y[A].split(":"),z=U[0].trim(),$=U[1].trim();B[z]=$}W=J[0].trim(),W.split(",").forEach(function(tt){tt=tt.replace(/^svg/i,"").trim(),tt!==""&&(N[tt]?n.util.object.extend(N[tt],B):N[tt]=n.util.object.clone(B))})}))}return N},loadSVGFromURL:function(k,T,A,L){k=k.replace(/^\n\s*/,"").trim(),new n.util.request(k,{method:"get",onComplete:N});function N(R){var V=R.responseXML;if(!V||!V.documentElement)return T&&T(null),!1;n.parseSVGDocument(V.documentElement,function(W,J,B,F){T&&T(W,J,B,F)},A,L)}},loadSVGFromString:function(k,T,A,L){var N=new n.window.DOMParser,R=N.parseFromString(k.trim(),"text/xml");n.parseSVGDocument(R.documentElement,function(V,W,J,B){T(V,W,J,B)},A,L)}})}(i),t.ElementsParser=function(a,n,h,u,r,l){this.elements=a,this.callback=n,this.options=h,this.reviver=u,this.svgUid=h&&h.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=l},function(a){a.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},a.createObjects=function(){var n=this;this.elements.forEach(function(h,u){h.setAttribute("svgUid",n.svgUid),n.createObject(h,u)})},a.findTag=function(n){return t[t.util.string.capitalize(n.tagName.replace("svg:",""))]},a.createObject=function(n,h){var u=this.findTag(n);if(u&&u.fromElement)try{u.fromElement(n,this.createCallback(h,n),this.options)}catch(r){t.log(r)}else this.checkIfDone()},a.createCallback=function(n,h){var u=this;return function(r){var l;u.resolveGradient(r,h,"fill"),u.resolveGradient(r,h,"stroke"),r instanceof t.Image&&r._originalElement&&(l=r.parsePreserveAspectRatioAttribute(h)),r._removeTransformMatrix(l),u.resolveClipPath(r,h),u.reviver&&u.reviver(h,r),u.instances[n]=r,u.checkIfDone()}},a.extractPropertyDefinition=function(n,h,u){var r=n[h],l=this.regexUrl;if(l.test(r)){l.lastIndex=0;var o=l.exec(r)[1];return l.lastIndex=0,t[u][this.svgUid][o]}},a.resolveGradient=function(n,h,u){var r=this.extractPropertyDefinition(n,u,"gradientDefs");if(r){var l=h.getAttribute(u+"-opacity"),o=t.Gradient.fromElement(r,n,l,this.options);n.set(u,o)}},a.createClipPathCallback=function(n,h){return function(u){u._removeTransformMatrix(),u.fillRule=u.clipRule,h.push(u)}},a.resolveClipPath=function(n,h){var u=this.extractPropertyDefinition(n,"clipPath","clipPaths"),r,l,o,d,p,c;if(u){d=[],o=t.util.invertTransform(n.calcTransformMatrix());for(var m=u[0].parentNode,_=h;_.parentNode&&_.getAttribute("clip-path")!==n.clipPath;)_=_.parentNode;_.parentNode.appendChild(m);for(var b=0;b<u.length;b++)r=u[b],l=this.findTag(r),l.fromElement(r,this.createClipPathCallback(n,d),this.options);d.length===1?u=d[0]:u=new t.Group(d),p=t.util.multiplyTransformMatrices(o,u.calcTransformMatrix()),u.clipPath&&this.resolveClipPath(u,_);var c=t.util.qrDecompose(p);u.flipX=!1,u.flipY=!1,u.set("scaleX",c.scaleX),u.set("scaleY",c.scaleY),u.angle=c.angle,u.skewX=c.skewX,u.skewY=0,u.setPositionByOrigin({x:c.translateX,y:c.translateY},"center","center"),n.clipPath=u}else delete n.clipPath},a.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(a){var n=a.fabric||(a.fabric={});if(n.Point){n.warn("fabric.Point is already defined");return}n.Point=h;function h(u,r){this.x=u,this.y=r}h.prototype={type:"point",constructor:h,add:function(u){return new h(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new h(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new h(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new h(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new h(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new h(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new h(this.x+(u.x-this.x)*r,this.y+(u.y-this.y)*r)},distanceFrom:function(u){var r=this.x-u.x,l=this.y-u.y;return Math.sqrt(r*r+l*l)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new h(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new h(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,r){return this.x=u,this.y=r,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var r=this.x,l=this.y;this.x=u.x,this.y=u.y,u.x=r,u.y=l},clone:function(){return new h(this.x,this.y)}}}(i),function(a){var n=a.fabric||(a.fabric={});if(n.Intersection){n.warn("fabric.Intersection is already defined");return}function h(u){this.status=u,this.points=[]}n.Intersection=h,n.Intersection.prototype={constructor:h,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},n.Intersection.intersectLineLine=function(u,r,l,o){var d,p=(o.x-l.x)*(u.y-l.y)-(o.y-l.y)*(u.x-l.x),c=(r.x-u.x)*(u.y-l.y)-(r.y-u.y)*(u.x-l.x),m=(o.y-l.y)*(r.x-u.x)-(o.x-l.x)*(r.y-u.y);if(m!==0){var _=p/m,b=c/m;0<=_&&_<=1&&0<=b&&b<=1?(d=new h("Intersection"),d.appendPoint(new n.Point(u.x+_*(r.x-u.x),u.y+_*(r.y-u.y)))):d=new h}else p===0||c===0?d=new h("Coincident"):d=new h("Parallel");return d},n.Intersection.intersectLinePolygon=function(u,r,l){var o=new h,d=l.length,p,c,m,_;for(_=0;_<d;_++)p=l[_],c=l[(_+1)%d],m=h.intersectLineLine(u,r,p,c),o.appendPoints(m.points);return o.points.length>0&&(o.status="Intersection"),o},n.Intersection.intersectPolygonPolygon=function(u,r){var l=new h,o=u.length,d;for(d=0;d<o;d++){var p=u[d],c=u[(d+1)%o],m=h.intersectLinePolygon(p,c,r);l.appendPoints(m.points)}return l.points.length>0&&(l.status="Intersection"),l},n.Intersection.intersectPolygonRectangle=function(u,r,l){var o=r.min(l),d=r.max(l),p=new n.Point(d.x,o.y),c=new n.Point(o.x,d.y),m=h.intersectLinePolygon(o,p,u),_=h.intersectLinePolygon(p,d,u),b=h.intersectLinePolygon(d,c,u),y=h.intersectLinePolygon(c,o,u),x=new h;return x.appendPoints(m.points),x.appendPoints(_.points),x.appendPoints(b.points),x.appendPoints(y.points),x.points.length>0&&(x.status="Intersection"),x}}(i),function(a){var n=a.fabric||(a.fabric={});if(n.Color){n.warn("fabric.Color is already defined.");return}function h(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}n.Color=h,n.Color.prototype={_tryParsingColor:function(r){var l;r in h.colorNameMap&&(r=h.colorNameMap[r]),r==="transparent"&&(l=[255,255,255,0]),l||(l=h.sourceFromHex(r)),l||(l=h.sourceFromRgb(r)),l||(l=h.sourceFromHsl(r)),l||(l=[0,0,0,1]),l&&this.setSource(l)},_rgbToHsl:function(r,l,o){r/=255,l/=255,o/=255;var d,p,c,m=n.util.array.max([r,l,o]),_=n.util.array.min([r,l,o]);if(c=(m+_)/2,m===_)d=p=0;else{var b=m-_;switch(p=c>.5?b/(2-m-_):b/(m+_),m){case r:d=(l-o)/b+(l<o?6:0);break;case l:d=(o-r)/b+2;break;case o:d=(r-l)/b+4;break}d/=6}return[Math.round(d*360),Math.round(p*100),Math.round(c*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),l=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+l[0]+","+l[1]+"%,"+l[2]+"%)"},toHsla:function(){var r=this.getSource(),l=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+l[0]+","+l[1]+"%,"+l[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),l,o,d;return l=r[0].toString(16),l=l.length===1?"0"+l:l,o=r[1].toString(16),o=o.length===1?"0"+o:o,d=r[2].toString(16),d=d.length===1?"0"+d:d,l.toUpperCase()+o.toUpperCase()+d.toUpperCase()},toHexa:function(){var r=this.getSource(),l;return l=Math.round(r[3]*255),l=l.toString(16),l=l.length===1?"0"+l:l,this.toHex()+l.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var l=this.getSource();return l[3]=r,this.setSource(l),this},toGrayscale:function(){var r=this.getSource(),l=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),o=r[3];return this.setSource([l,l,l,o]),this},toBlackWhite:function(r){var l=this.getSource(),o=(l[0]*.3+l[1]*.59+l[2]*.11).toFixed(0),d=l[3];return r=r||127,o=Number(o)<Number(r)?0:255,this.setSource([o,o,o,d]),this},overlayWith:function(r){r instanceof h||(r=new h(r));var l=[],o=this.getAlpha(),d=.5,p=this.getSource(),c=r.getSource(),m;for(m=0;m<3;m++)l.push(Math.round(p[m]*(1-d)+c[m]*d));return l[3]=o,this.setSource(l),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,n.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function u(r,l,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?r+(l-r)*6*o:o<1/2?l:o<2/3?r+(l-r)*(2/3-o)*6:r}n.Color.fromRgb=function(r){return h.fromSource(h.sourceFromRgb(r))},n.Color.sourceFromRgb=function(r){var l=r.match(h.reRGBa);if(l){var o=parseInt(l[1],10)/(/%$/.test(l[1])?100:1)*(/%$/.test(l[1])?255:1),d=parseInt(l[2],10)/(/%$/.test(l[2])?100:1)*(/%$/.test(l[2])?255:1),p=parseInt(l[3],10)/(/%$/.test(l[3])?100:1)*(/%$/.test(l[3])?255:1);return[parseInt(o,10),parseInt(d,10),parseInt(p,10),l[4]?parseFloat(l[4]):1]}},n.Color.fromRgba=h.fromRgb,n.Color.fromHsl=function(r){return h.fromSource(h.sourceFromHsl(r))},n.Color.sourceFromHsl=function(r){var l=r.match(h.reHSLa);if(l){var o=(parseFloat(l[1])%360+360)%360/360,d=parseFloat(l[2])/(/%$/.test(l[2])?100:1),p=parseFloat(l[3])/(/%$/.test(l[3])?100:1),c,m,_;if(d===0)c=m=_=p;else{var b=p<=.5?p*(d+1):p+d-p*d,y=p*2-b;c=u(y,b,o+1/3),m=u(y,b,o),_=u(y,b,o-1/3)}return[Math.round(c*255),Math.round(m*255),Math.round(_*255),l[4]?parseFloat(l[4]):1]}},n.Color.fromHsla=h.fromHsl,n.Color.fromHex=function(r){return h.fromSource(h.sourceFromHex(r))},n.Color.sourceFromHex=function(r){if(r.match(h.reHex)){var l=r.slice(r.indexOf("#")+1),o=l.length===3||l.length===4,d=l.length===8||l.length===4,p=o?l.charAt(0)+l.charAt(0):l.substring(0,2),c=o?l.charAt(1)+l.charAt(1):l.substring(2,4),m=o?l.charAt(2)+l.charAt(2):l.substring(4,6),_=d?o?l.charAt(3)+l.charAt(3):l.substring(6,8):"FF";return[parseInt(p,16),parseInt(c,16),parseInt(m,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},n.Color.fromSource=function(r){var l=new h;return l.setSource(r),l}}(i),function(a){var n=a.fabric||(a.fabric={}),h=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],r={},l="left",o="top",d="right",p="bottom",c="center",m={top:p,bottom:o,left:d,right:l,center:c},_=n.util.radiansToDegrees,b=Math.sign||function(B){return(B>0)-(B<0)||+B};function y(B,F){var Y=B.angle+_(Math.atan2(F.y,F.x))+360;return Math.round(Y%360/45)}function x(B,F){var Y=F.transform.target,U=Y.canvas,z=n.util.object.clone(F);z.target=Y,U&&U.fire("object:"+B,z),Y.fire(B,F)}function C(B,F){var Y=F.canvas,U=Y.uniScaleKey,z=B[U];return Y.uniformScaling&&!z||!Y.uniformScaling&&z}function w(B){return B.originX===c&&B.originY===c}function O(B,F,Y){var U=B.lockScalingX,z=B.lockScalingY;return!!(U&&z||!F&&(U||z)&&Y||U&&F==="x"||z&&F==="y")}function E(B,F,Y){var U="not-allowed",z=C(B,Y),$="";if(F.x!==0&&F.y===0?$="x":F.x===0&&F.y!==0&&($="y"),O(Y,$,z))return U;var tt=y(Y,F);return h[tt]+"-resize"}function j(B,F,Y){var U="not-allowed";if(F.x!==0&&Y.lockSkewingY||F.y!==0&&Y.lockSkewingX)return U;var z=y(Y,F)%4;return u[z]+"-resize"}function H(B,F,Y){return B[Y.canvas.altActionKey]?r.skewCursorStyleHandler(B,F,Y):r.scaleCursorStyleHandler(B,F,Y)}function q(B,F,Y){var U=B[Y.canvas.altActionKey];if(F.x===0)return U?"skewX":"scaleY";if(F.y===0)return U?"skewY":"scaleX"}function Q(B,F,Y){return Y.lockRotation?"not-allowed":F.cursorStyle}function K(B,F,Y,U){return{e:B,transform:F,pointer:{x:Y,y:U}}}function G(B){return function(F,Y,U,z){var $=Y.target,tt=$.getCenterPoint(),lt=$.translateToOriginPoint(tt,Y.originX,Y.originY),st=B(F,Y,U,z);return $.setPositionByOrigin(lt,Y.originX,Y.originY),st}}function Z(B,F){return function(Y,U,z,$){var tt=F(Y,U,z,$);return tt&&x(B,K(Y,U,z,$)),tt}}function et(B,F,Y,U,z){var $=B.target,tt=$.controls[B.corner],lt=$.canvas.getZoom(),st=$.padding/lt,X=$.toLocalPoint(new n.Point(U,z),F,Y);return X.x>=st&&(X.x-=st),X.x<=-st&&(X.x+=st),X.y>=st&&(X.y-=st),X.y<=st&&(X.y+=st),X.x-=tt.offsetX,X.y-=tt.offsetY,X}function it(B){return B.flipX!==B.flipY}function S(B,F,Y,U,z){if(B[F]!==0){var $=B._getTransformedDimensions()[U],tt=z/$*B[Y];B.set(Y,tt)}}function P(B,F,Y,U){var z=F.target,$=z._getTransformedDimensions(0,z.skewY),tt=et(F,F.originX,F.originY,Y,U),lt=Math.abs(tt.x*2)-$.x,st=z.skewX,X;lt<2?X=0:(X=_(Math.atan2(lt/z.scaleX,$.y/z.scaleY)),F.originX===l&&F.originY===p&&(X=-X),F.originX===d&&F.originY===o&&(X=-X),it(z)&&(X=-X));var rt=st!==X;if(rt){var ht=z._getTransformedDimensions().y;z.set("skewX",X),S(z,"skewY","scaleY","y",ht)}return rt}function D(B,F,Y,U){var z=F.target,$=z._getTransformedDimensions(z.skewX,0),tt=et(F,F.originX,F.originY,Y,U),lt=Math.abs(tt.y*2)-$.y,st=z.skewY,X;lt<2?X=0:(X=_(Math.atan2(lt/z.scaleY,$.x/z.scaleX)),F.originX===l&&F.originY===p&&(X=-X),F.originX===d&&F.originY===o&&(X=-X),it(z)&&(X=-X));var rt=st!==X;if(rt){var ht=z._getTransformedDimensions().x;z.set("skewY",X),S(z,"skewX","scaleX","x",ht)}return rt}function M(B,F,Y,U){var z=F.target,$=z.skewX,tt,lt=F.originY;if(z.lockSkewingX)return!1;if($===0){var st=et(F,c,c,Y,U);st.x>0?tt=l:tt=d}else $>0&&(tt=lt===o?l:d),$<0&&(tt=lt===o?d:l),it(z)&&(tt=tt===l?d:l);F.originX=tt;var X=Z("skewing",G(P));return X(B,F,Y,U)}function I(B,F,Y,U){var z=F.target,$=z.skewY,tt,lt=F.originX;if(z.lockSkewingY)return!1;if($===0){var st=et(F,c,c,Y,U);st.y>0?tt=o:tt=p}else $>0&&(tt=lt===l?o:p),$<0&&(tt=lt===l?p:o),it(z)&&(tt=tt===o?p:o);F.originY=tt;var X=Z("skewing",G(D));return X(B,F,Y,U)}function k(B,F,Y,U){var z=F,$=z.target,tt=$.translateToOriginPoint($.getCenterPoint(),z.originX,z.originY);if($.lockRotation)return!1;var lt=Math.atan2(z.ey-tt.y,z.ex-tt.x),st=Math.atan2(U-tt.y,Y-tt.x),X=_(st-lt+z.theta),rt=!0;if($.snapAngle>0){var ht=$.snapAngle,ft=$.snapThreshold||ht,bt=Math.ceil(X/ht)*ht,mt=Math.floor(X/ht)*ht;Math.abs(X-mt)<ft?X=mt:Math.abs(X-bt)<ft&&(X=bt)}return X<0&&(X=360+X),X%=360,rt=$.angle!==X,$.angle=X,rt}function T(B,F,Y,U,z){z=z||{};var $=F.target,tt=$.lockScalingX,lt=$.lockScalingY,st=z.by,X,rt,ht,ft,bt=C(B,$),mt=O($,st,bt),Pt,Tt,ve=F.gestureScale;if(mt)return!1;if(ve)rt=F.scaleX*ve,ht=F.scaleY*ve;else{if(X=et(F,F.originX,F.originY,Y,U),Pt=st!=="y"?b(X.x):1,Tt=st!=="x"?b(X.y):1,F.signX||(F.signX=Pt),F.signY||(F.signY=Tt),$.lockScalingFlip&&(F.signX!==Pt||F.signY!==Tt))return!1;if(ft=$._getTransformedDimensions(),bt&&!st){var We=Math.abs(X.x)+Math.abs(X.y),Xt=F.original,uo=Math.abs(ft.x*Xt.scaleX/$.scaleX)+Math.abs(ft.y*Xt.scaleY/$.scaleY),$n=We/uo;rt=Xt.scaleX*$n,ht=Xt.scaleY*$n}else rt=Math.abs(X.x*$.scaleX/ft.x),ht=Math.abs(X.y*$.scaleY/ft.y);w(F)&&(rt*=2,ht*=2),F.signX!==Pt&&st!=="y"&&(F.originX=m[F.originX],rt*=-1,F.signX=Pt),F.signY!==Tt&&st!=="x"&&(F.originY=m[F.originY],ht*=-1,F.signY=Tt)}var fo=$.scaleX,go=$.scaleY;return st?(st==="x"&&$.set("scaleX",rt),st==="y"&&$.set("scaleY",ht)):(!tt&&$.set("scaleX",rt),!lt&&$.set("scaleY",ht)),fo!==$.scaleX||go!==$.scaleY}function A(B,F,Y,U){return T(B,F,Y,U)}function L(B,F,Y,U){return T(B,F,Y,U,{by:"x"})}function N(B,F,Y,U){return T(B,F,Y,U,{by:"y"})}function R(B,F,Y,U){return B[F.target.canvas.altActionKey]?r.skewHandlerX(B,F,Y,U):r.scalingY(B,F,Y,U)}function V(B,F,Y,U){return B[F.target.canvas.altActionKey]?r.skewHandlerY(B,F,Y,U):r.scalingX(B,F,Y,U)}function W(B,F,Y,U){var z=F.target,$=et(F,F.originX,F.originY,Y,U),tt=z.strokeWidth/(z.strokeUniform?z.scaleX:1),lt=w(F)?2:1,st=z.width,X=Math.abs($.x*lt/z.scaleX)-tt;return z.set("width",Math.max(X,0)),st!==X}function J(B,F,Y,U){var z=F.target,$=Y-F.offsetX,tt=U-F.offsetY,lt=!z.get("lockMovementX")&&z.left!==$,st=!z.get("lockMovementY")&&z.top!==tt;return lt&&z.set("left",$),st&&z.set("top",tt),(lt||st)&&x("moving",K(B,F,Y,U)),lt||st}r.scaleCursorStyleHandler=E,r.skewCursorStyleHandler=j,r.scaleSkewCursorStyleHandler=H,r.rotationWithSnapping=Z("rotating",G(k)),r.scalingEqually=Z("scaling",G(A)),r.scalingX=Z("scaling",G(L)),r.scalingY=Z("scaling",G(N)),r.scalingYOrSkewingX=R,r.scalingXOrSkewingY=V,r.changeWidth=Z("resizing",G(W)),r.skewHandlerX=M,r.skewHandlerY=I,r.dragHandler=J,r.scaleOrSkewActionName=q,r.rotationStyleHandler=Q,r.fireEvent=x,r.wrapWithFixedAnchor=G,r.wrapWithFireEvent=Z,r.getLocalPoint=et,n.controlsUtils=r}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.degreesToRadians,u=n.controlsUtils;function r(o,d,p,c,m){c=c||{};var _=this.sizeX||c.cornerSize||m.cornerSize,b=this.sizeY||c.cornerSize||m.cornerSize,y=typeof c.transparentCorners<"u"?c.transparentCorners:m.transparentCorners,x=y?"stroke":"fill",C=!y&&(c.cornerStrokeColor||m.cornerStrokeColor),w=d,O=p,E;o.save(),o.fillStyle=c.cornerColor||m.cornerColor,o.strokeStyle=c.cornerStrokeColor||m.cornerStrokeColor,_>b?(E=_,o.scale(1,b/_),O=p*_/b):b>_?(E=b,o.scale(_/b,1),w=d*b/_):E=_,o.lineWidth=1,o.beginPath(),o.arc(w,O,E/2,0,2*Math.PI,!1),o[x](),C&&o.stroke(),o.restore()}function l(o,d,p,c,m){c=c||{};var _=this.sizeX||c.cornerSize||m.cornerSize,b=this.sizeY||c.cornerSize||m.cornerSize,y=typeof c.transparentCorners<"u"?c.transparentCorners:m.transparentCorners,x=y?"stroke":"fill",C=!y&&(c.cornerStrokeColor||m.cornerStrokeColor),w=_/2,O=b/2;o.save(),o.fillStyle=c.cornerColor||m.cornerColor,o.strokeStyle=c.cornerStrokeColor||m.cornerStrokeColor,o.lineWidth=1,o.translate(d,p),o.rotate(h(m.angle)),o[x+"Rect"](-w,-O,_,b),C&&o.strokeRect(-w,-O,_,b),o.restore()}u.renderCircleControl=r,u.renderSquareControl=l}(i),function(a){var n=a.fabric||(a.fabric={});function h(u){for(var r in u)this[r]=u[r]}n.Control=h,n.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(u,r){return r.cursorStyle},getActionName:function(u,r){return r.actionName},getVisibility:function(u,r){var l=u._controlsVisibility;return l&&typeof l[r]<"u"?l[r]:this.visible},setVisibility:function(u){this.visible=u},positionHandler:function(u,r){var l=n.util.transformPoint({x:this.x*u.x+this.offsetX,y:this.y*u.y+this.offsetY},r);return l},calcCornerCoords:function(u,r,l,o,d){var p,c,m,_,b=d?this.touchSizeX:this.sizeX,y=d?this.touchSizeY:this.sizeY;if(b&&y&&b!==y){var x=Math.atan2(y,b),C=Math.sqrt(b*b+y*y)/2,w=x-n.util.degreesToRadians(u),O=Math.PI/2-x-n.util.degreesToRadians(u);p=C*n.util.cos(w),c=C*n.util.sin(w),m=C*n.util.cos(O),_=C*n.util.sin(O)}else{var E=b&&y?b:r;C=E*.7071067812;var w=n.util.degreesToRadians(45-u);p=m=C*n.util.cos(w),c=_=C*n.util.sin(w)}return{tl:{x:l-_,y:o-m},tr:{x:l+p,y:o-c},bl:{x:l-p,y:o+c},br:{x:l+_,y:o+m}}},render:function(u,r,l,o,d){switch(o=o||{},o.cornerStyle||d.cornerStyle){case"circle":n.controlsUtils.renderCircleControl.call(this,u,r,l,o,d);break;default:n.controlsUtils.renderSquareControl.call(this,u,r,l,o,d)}}}}(i),function(){function a(l,o){var d=l.getAttribute("style"),p=l.getAttribute("offset")||0,c,m,_,b;if(p=parseFloat(p)/(/%$/.test(p)?100:1),p=p<0?0:p>1?1:p,d){var y=d.split(/\s*;\s*/);for(y[y.length-1]===""&&y.pop(),b=y.length;b--;){var x=y[b].split(/\s*:\s*/),C=x[0].trim(),w=x[1].trim();C==="stop-color"?c=w:C==="stop-opacity"&&(_=w)}}return c||(c=l.getAttribute("stop-color")||"rgb(0,0,0)"),_||(_=l.getAttribute("stop-opacity")),c=new t.Color(c),m=c.getAlpha(),_=isNaN(parseFloat(_))?1:parseFloat(_),_*=m*o,{offset:p,color:c.toRgb(),opacity:_}}function n(l){return{x1:l.getAttribute("x1")||0,y1:l.getAttribute("y1")||0,x2:l.getAttribute("x2")||"100%",y2:l.getAttribute("y2")||0}}function h(l){return{x1:l.getAttribute("fx")||l.getAttribute("cx")||"50%",y1:l.getAttribute("fy")||l.getAttribute("cy")||"50%",r1:0,x2:l.getAttribute("cx")||"50%",y2:l.getAttribute("cy")||"50%",r2:l.getAttribute("r")||"50%"}}var u=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var o,d=this;Object.keys(l).forEach(function(p){d[p]=l[p]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,o={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(o.r1=l.coords.r1||0,o.r2=l.coords.r2||0),this.coords=o,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var o in l){var d=new t.Color(l[o]);this.colorStops.push({offset:parseFloat(o),color:d.toRgb(),opacity:d.getAlpha()})}return this},toObject:function(l){var o={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,o,l),o},toSVG:function(l,m){var d=u(this.coords,!0),p,c,m=m||{},_,b,y=u(this.colorStops,!0),x=d.r1>d.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),w=-this.offsetX,O=-this.offsetY,E=!!m.additionalTransform,j=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(y.sort(function(G,Z){return G.offset-Z.offset}),j==="objectBoundingBox"?(w/=l.width,O/=l.height):(w+=l.width/2,O+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(w-=l.pathOffset.x,O-=l.pathOffset.y),C[4]-=w,C[5]-=O,b='id="SVGID_'+this.id+'" gradientUnits="'+j+'"',b+=' gradientTransform="'+(E?m.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?_=["<linearGradient ",b,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`">
`]:this.type==="radial"&&(_=["<radialGradient ",b,' cx="',x?d.x1:d.x2,'" cy="',x?d.y1:d.y2,'" r="',x?d.r1:d.r2,'" fx="',x?d.x2:d.x1,'" fy="',x?d.y2:d.y1,`">
`]),this.type==="radial"){if(x)for(y=y.concat(),y.reverse(),p=0,c=y.length;p<c;p++)y[p].offset=1-y[p].offset;var H=Math.min(d.r1,d.r2);if(H>0){var q=Math.max(d.r1,d.r2),Q=H/q;for(p=0,c=y.length;p<c;p++)y[p].offset+=Q*(1-y[p].offset)}}for(p=0,c=y.length;p<c;p++){var K=y[p];_.push("<stop ",'offset="',K.offset*100+"%",'" style="stop-color:',K.color,typeof K.opacity<"u"?";stop-opacity: "+K.opacity:";",`"/>
`)}return _.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),_.join("")},toLive:function(l){var o,d=t.util.object.clone(this.coords),p,c;if(this.type){for(this.type==="linear"?o=l.createLinearGradient(d.x1,d.y1,d.x2,d.y2):this.type==="radial"&&(o=l.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2)),p=0,c=this.colorStops.length;p<c;p++){var m=this.colorStops[p].color,_=this.colorStops[p].opacity,b=this.colorStops[p].offset;typeof _<"u"&&(m=new t.Color(m).setAlpha(_).toRgba()),o.addColorStop(b,m)}return o}}}),t.util.object.extend(t.Gradient,{fromElement:function(l,o,d,p){var c=parseFloat(d)/(/%$/.test(d)?100:1);c=c<0?0:c>1?1:c,isNaN(c)&&(c=1);var m=l.getElementsByTagName("stop"),_,b=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",y=l.getAttribute("gradientTransform")||"",x=[],C,w,O=0,E=0,j;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(_="linear",C=n(l)):(_="radial",C=h(l)),w=m.length;w--;)x.push(a(m[w],c));j=t.parseTransformAttribute(y),r(o,C,p,b),b==="pixels"&&(O=-o.left,E=-o.top);var H=new t.Gradient({id:l.getAttribute("id"),type:_,coords:C,colorStops:x,gradientUnits:b,gradientTransform:j,offsetX:O,offsetY:E});return H}});function r(l,o,d,p){var c,m;Object.keys(o).forEach(function(_){c=o[_],c==="Infinity"?m=1:c==="-Infinity"?m=0:(m=parseFloat(o[_],10),typeof c=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(c)&&(m*=.01,p==="pixels"&&((_==="x1"||_==="x2"||_==="r2")&&(m*=d.viewBoxWidth||d.width),(_==="y1"||_==="y2")&&(m*=d.viewBoxHeight||d.height)))),o[_]=m})}}(),function(){var a=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(n,h){if(n||(n={}),this.id=t.Object.__uid++,this.setOptions(n),!n.source||n.source&&typeof n.source!="string"){h&&h(this);return}else{var u=this;this.source=t.util.createImage(),t.util.loadImage(n.source,function(r,l){u.source=r,h&&h(u,l)},null,this.crossOrigin)}},toObject:function(n){var h=t.Object.NUM_FRACTION_DIGITS,u,r;return typeof this.source.src=="string"?u=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(u=this.source.toDataURL()),r={type:"pattern",source:u,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:a(this.offsetX,h),offsetY:a(this.offsetY,h),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,r,n),r},toSVG:function(n){var h=typeof this.source=="function"?this.source():this.source,u=h.width/n.width,r=h.height/n.height,l=this.offsetX/n.width,o=this.offsetY/n.height,d="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,o&&(r+=Math.abs(o))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(u=1,l&&(u+=Math.abs(l))),h.src?d=h.src:h.toDataURL&&(d=h.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+l+'" y="'+o+'" width="'+u+'" height="'+r+`">
<image x="0" y="0" width="`+h.width+'" height="'+h.height+'" xlink:href="'+d+`"></image>
</pattern>
`},setOptions:function(n){for(var h in n)this[h]=n[h]},toLive:function(n){var h=this.source;return!h||typeof h.src<"u"&&(!h.complete||h.naturalWidth===0||h.naturalHeight===0)?"":n.createPattern(h,this.repeat)}})}(),function(a){var n=a.fabric||(a.fabric={}),h=n.util.toFixed;if(n.Shadow){n.warn("fabric.Shadow is already defined.");return}n.Shadow=n.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){typeof u=="string"&&(u=this._parseShadow(u));for(var r in u)this[r]=u[r];this.id=n.Object.__uid++},_parseShadow:function(u){var r=u.trim(),l=n.Shadow.reOffsetsAndBlur.exec(r)||[],o=r.replace(n.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:o.trim(),offsetX:parseFloat(l[1],10)||0,offsetY:parseFloat(l[2],10)||0,blur:parseFloat(l[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var r=40,l=40,o=n.Object.NUM_FRACTION_DIGITS,d=n.util.rotateVector({x:this.offsetX,y:this.offsetY},n.util.degreesToRadians(-u.angle)),p=20,c=new n.Color(this.color);return u.width&&u.height&&(r=h((Math.abs(d.x)+this.blur)/u.width,o)*100+p,l=h((Math.abs(d.y)+this.blur)/u.height,o)*100+p),u.flipX&&(d.x*=-1),u.flipY&&(d.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+l+'%" height="'+(100+2*l)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+h(this.blur?this.blur/2:0,o)+`"></feGaussianBlur>
	<feOffset dx="`+h(d.x,o)+'" dy="'+h(d.y,o)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+c.toRgb()+'" flood-opacity="'+c.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},r=n.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(l){this[l]!==r[l]&&(u[l]=this[l])},this),u}}),n.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(i),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var a=t.util.object.extend,n=t.util.getElementOffset,h=t.util.removeFromArray,u=t.util.toFixed,r=t.util.transformPoint,l=t.util.invertTransform,o=t.util.getNodeCanvas,d=t.util.createCanvasElement,p=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(c,m){m||(m={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(c,m)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(c,m){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(c),this._initOptions(m),this.interactive||this._initRetinaScaling(),m.overlayImage&&this.setOverlayImage(m.overlayImage,_),m.backgroundImage&&this.setBackgroundImage(m.backgroundImage,_),m.backgroundColor&&this.setBackgroundColor(m.backgroundColor,_),m.overlayColor&&this.setOverlayColor(m.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var c=t.devicePixelRatio;this.__initRetinaScaling(c,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(c,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(c,m,_){m.setAttribute("width",this.width*c),m.setAttribute("height",this.height*c),_.scale(c,c)},calcOffset:function(){return this._offset=n(this.lowerCanvasEl),this},setOverlayImage:function(c,m,_){return this.__setBgOverlayImage("overlayImage",c,m,_)},setBackgroundImage:function(c,m,_){return this.__setBgOverlayImage("backgroundImage",c,m,_)},setOverlayColor:function(c,m){return this.__setBgOverlayColor("overlayColor",c,m)},setBackgroundColor:function(c,m){return this.__setBgOverlayColor("backgroundColor",c,m)},__setBgOverlayImage:function(c,m,_,b){return typeof m=="string"?t.util.loadImage(m,function(y,x){if(y){var C=new t.Image(y,b);this[c]=C,C.canvas=this}_&&_(y,x)},this,b&&b.crossOrigin):(b&&m.setOptions(b),this[c]=m,m&&(m.canvas=this),_&&_(m,!1)),this},__setBgOverlayColor:function(c,m,_){return this[c]=m,this._initGradient(m,c),this._initPattern(m,c,_),this},_createCanvasElement:function(){var c=d();if(!c||(c.style||(c.style={}),typeof c.getContext>"u"))throw p;return c},_initOptions:function(c){var m=this.lowerCanvasEl;this._setOptions(c),this.width=this.width||parseInt(m.width,10)||0,this.height=this.height||parseInt(m.height,10)||0,this.lowerCanvasEl.style&&(m.width=this.width,m.height=this.height,m.style.width=this.width+"px",m.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(c){c&&c.getContext?this.lowerCanvasEl=c:this.lowerCanvasEl=t.util.getById(c)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(c,m){return this.setDimensions({width:c},m)},setHeight:function(c,m){return this.setDimensions({height:c},m)},setDimensions:function(c,m){var _;m=m||{};for(var b in c)_=c[b],m.cssOnly||(this._setBackstoreDimension(b,c[b]),_+="px",this.hasLostContext=!0),m.backstoreOnly||this._setCssDimension(b,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),m.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(c,m){return this.lowerCanvasEl[c]=m,this.upperCanvasEl&&(this.upperCanvasEl[c]=m),this.cacheCanvasEl&&(this.cacheCanvasEl[c]=m),this[c]=m,this},_setCssDimension:function(c,m){return this.lowerCanvasEl.style[c]=m,this.upperCanvasEl&&(this.upperCanvasEl.style[c]=m),this.wrapperEl&&(this.wrapperEl.style[c]=m),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(c){var m=this._activeObject,_=this.backgroundImage,b=this.overlayImage,y,x,C;for(this.viewportTransform=c,x=0,C=this._objects.length;x<C;x++)y=this._objects[x],y.group||y.setCoords(!0);return m&&m.setCoords(),_&&_.setCoords(!0),b&&b.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(c,m){var _=c,b=this.viewportTransform.slice(0);c=r(c,l(this.viewportTransform)),b[0]=m,b[3]=m;var y=r(c,b);return b[4]+=_.x-y.x,b[5]+=_.y-y.y,this.setViewportTransform(b)},setZoom:function(c){return this.zoomToPoint(new t.Point(0,0),c),this},absolutePan:function(c){var m=this.viewportTransform.slice(0);return m[4]=-c.x,m[5]=-c.y,this.setViewportTransform(m)},relativePan:function(c){return this.absolutePan(new t.Point(-c.x-this.viewportTransform[4],-c.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(c){this.stateful&&c.setupState(),c._set("canvas",this),c.setCoords(),this.fire("object:added",{target:c}),c.fire("added")},_onObjectRemoved:function(c){this.fire("object:removed",{target:c}),c.fire("removed"),delete c.canvas},clearContext:function(c){return c.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var c=this.contextContainer;return this.renderCanvas(c,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var c={},m=this.width,_=this.height,b=l(this.viewportTransform);return c.tl=r({x:0,y:0},b),c.br=r({x:m,y:_},b),c.tr=new t.Point(c.br.x,c.tl.y),c.bl=new t.Point(c.tl.x,c.br.y),this.vptCoords=c,c},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(c,m){var _=this.viewportTransform,b=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(c),t.util.setImageSmoothing(c,this.imageSmoothingEnabled),this.fire("before:render",{ctx:c}),this._renderBackground(c),c.save(),c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(c,m),c.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(c),b&&(b.canvas=this,b.shouldCache(),b._transformDone=!0,b.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(c)),this._renderOverlay(c),this.controlsAboveOverlay&&this.interactive&&this.drawControls(c),this.fire("after:render",{ctx:c})},drawClipPathOnCanvas:function(c){var m=this.viewportTransform,_=this.clipPath;c.save(),c.transform(m[0],m[1],m[2],m[3],m[4],m[5]),c.globalCompositeOperation="destination-in",_.transform(c),c.scale(1/_.zoomX,1/_.zoomY),c.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),c.restore()},_renderObjects:function(c,m){var _,b;for(_=0,b=m.length;_<b;++_)m[_]&&m[_].render(c)},_renderBackgroundOrOverlay:function(c,m){var _=this[m+"Color"],b=this[m+"Image"],y=this.viewportTransform,x=this[m+"Vpt"];if(!(!_&&!b)){if(_){c.save(),c.beginPath(),c.moveTo(0,0),c.lineTo(this.width,0),c.lineTo(this.width,this.height),c.lineTo(0,this.height),c.closePath(),c.fillStyle=_.toLive?_.toLive(c,this):_,x&&c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),c.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var C=_.gradientTransform||_.patternTransform;C&&c.transform(C[0],C[1],C[2],C[3],C[4],C[5]),c.fill(),c.restore()}b&&(c.save(),x&&c.transform(y[0],y[1],y[2],y[3],y[4],y[5]),b.render(c),c.restore())}},_renderBackground:function(c){this._renderBackgroundOrOverlay(c,"background")},_renderOverlay:function(c){this._renderBackgroundOrOverlay(c,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(c){return this._centerObject(c,new t.Point(this.getCenterPoint().x,c.getCenterPoint().y))},centerObjectV:function(c){return this._centerObject(c,new t.Point(c.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(c){var m=this.getCenterPoint();return this._centerObject(c,m)},viewportCenterObject:function(c){var m=this.getVpCenter();return this._centerObject(c,m)},viewportCenterObjectH:function(c){var m=this.getVpCenter();return this._centerObject(c,new t.Point(m.x,c.getCenterPoint().y)),this},viewportCenterObjectV:function(c){var m=this.getVpCenter();return this._centerObject(c,new t.Point(c.getCenterPoint().x,m.y))},getVpCenter:function(){var c=this.getCenterPoint(),m=l(this.viewportTransform);return r(c,m)},_centerObject:function(c,m){return c.setPositionByOrigin(m,"center","center"),c.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(c){return this.toDatalessObject(c)},toObject:function(c){return this._toObjectMethod("toObject",c)},toDatalessObject:function(c){return this._toObjectMethod("toDatalessObject",c)},_toObjectMethod:function(c,m){var _=this.clipPath,b={version:t.version,objects:this._toObjects(c,m)};return _&&!_.excludeFromExport&&(b.clipPath=this._toObject(this.clipPath,c,m)),a(b,this.__serializeBgOverlay(c,m)),t.util.populateWithProperties(this,b,m),b},_toObjects:function(c,m){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,c,m)},this)},_toObject:function(c,m,_){var b;this.includeDefaultValues||(b=c.includeDefaultValues,c.includeDefaultValues=!1);var y=c[m](_);return this.includeDefaultValues||(c.includeDefaultValues=b),y},__serializeBgOverlay:function(c,m){var _={},b=this.backgroundImage,y=this.overlayImage,x=this.backgroundColor,C=this.overlayColor;return x&&x.toObject?x.excludeFromExport||(_.background=x.toObject(m)):x&&(_.background=x),C&&C.toObject?C.excludeFromExport||(_.overlay=C.toObject(m)):C&&(_.overlay=C),b&&!b.excludeFromExport&&(_.backgroundImage=this._toObject(b,c,m)),y&&!y.excludeFromExport&&(_.overlayImage=this._toObject(y,c,m)),_},svgViewportTransformation:!0,toSVG:function(c,m){c||(c={}),c.reviver=m;var _=[];return this._setSVGPreamble(_,c),this._setSVGHeader(_,c),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",m),this._setSVGObjects(_,m),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",m),_.push("</svg>"),_.join("")},_setSVGPreamble:function(c,m){m.suppressPreamble||c.push('<?xml version="1.0" encoding="',m.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(c,m){var _=m.width||this.width,b=m.height||this.height,y,x='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;m.viewBox?x='viewBox="'+m.viewBox.x+" "+m.viewBox.y+" "+m.viewBox.width+" "+m.viewBox.height+'" ':this.svgViewportTransformation&&(y=this.viewportTransform,x='viewBox="'+u(-y[4]/y[0],C)+" "+u(-y[5]/y[3],C)+" "+u(this.width/y[0],C)+" "+u(this.height/y[3],C)+'" '),c.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',_,'" ','height="',b,'" ',x,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(m),`</defs>
`)},createSVGClipPathMarkup:function(c){var m=this.clipPath;return m?(m.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+m.clipPathId+`" >
`+this.clipPath.toClipPathSVG(c.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var c=this,m=["background","overlay"].map(function(_){var b=c[_+"Color"];if(b&&b.toLive){var y=c[_+"Vpt"],x=c.viewportTransform,C={width:c.width/(y?x[0]:1),height:c.height/(y?x[3]:1)};return b.toSVG(C,{additionalTransform:y?t.util.matrixToSVG(x):""})}});return m.join("")},createSVGFontFacesMarkup:function(){var c="",m={},_,b,y,x,C,w,O,E,j,H=t.fontPaths,q=[];for(this._objects.forEach(function K(G){q.push(G),G._objects&&G._objects.forEach(K)}),E=0,j=q.length;E<j;E++)if(_=q[E],b=_.fontFamily,!(_.type.indexOf("text")===-1||m[b]||!H[b])&&(m[b]=!0,!!_.styles)){y=_.styles;for(C in y){x=y[C];for(O in x)w=x[O],b=w.fontFamily,!m[b]&&H[b]&&(m[b]=!0)}}for(var Q in m)c+=[`		@font-face {
`,"			font-family: '",Q,`';
`,"			src: url('",H[Q],`');
`,`		}
`].join("");return c&&(c=['	<style type="text/css">',`<![CDATA[
`,c,"]]>",`</style>
`].join("")),c},_setSVGObjects:function(c,m){var _,b,y,x=this._objects;for(b=0,y=x.length;b<y;b++)_=x[b],!_.excludeFromExport&&this._setSVGObject(c,_,m)},_setSVGObject:function(c,m,_){c.push(m.toSVG(_))},_setSVGBgOverlayImage:function(c,m,_){this[m]&&!this[m].excludeFromExport&&this[m].toSVG&&c.push(this[m].toSVG(_))},_setSVGBgOverlayColor:function(c,m){var _=this[m+"Color"],b=this.viewportTransform,y=this.width,x=this.height;if(_)if(_.toLive){var C=_.repeat,w=t.util.invertTransform(b),O=this[m+"Vpt"],E=O?t.util.matrixToSVG(w):"";c.push('<rect transform="'+E+" translate(",y/2,",",x/2,')"',' x="',_.offsetX-y/2,'" y="',_.offsetY-x/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?_.source.width:y,'" height="',C==="repeat-x"||C==="no-repeat"?_.source.height:x,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else c.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(c){if(!c)return this;var m=this._activeObject,_,b,y;if(c===m&&c.type==="activeSelection")for(y=m._objects,_=y.length;_--;)b=y[_],h(this._objects,b),this._objects.unshift(b);else h(this._objects,c),this._objects.unshift(c);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(c){if(!c)return this;var m=this._activeObject,_,b,y;if(c===m&&c.type==="activeSelection")for(y=m._objects,_=0;_<y.length;_++)b=y[_],h(this._objects,b),this._objects.push(b);else h(this._objects,c),this._objects.push(c);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(c,m){if(!c)return this;var _=this._activeObject,b,y,x,C,w,O=0;if(c===_&&c.type==="activeSelection")for(w=_._objects,b=0;b<w.length;b++)y=w[b],x=this._objects.indexOf(y),x>0+O&&(C=x-1,h(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(c),x!==0&&(C=this._findNewLowerIndex(c,x,m),h(this._objects,c),this._objects.splice(C,0,c));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(c,m,_){var b,y;if(_)for(b=m,y=m-1;y>=0;--y){var x=c.intersectsWithObject(this._objects[y])||c.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(c);if(x){b=y;break}}else b=m-1;return b},bringForward:function(c,m){if(!c)return this;var _=this._activeObject,b,y,x,C,w,O=0;if(c===_&&c.type==="activeSelection")for(w=_._objects,b=w.length;b--;)y=w[b],x=this._objects.indexOf(y),x<this._objects.length-1-O&&(C=x+1,h(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(c),x!==this._objects.length-1&&(C=this._findNewUpperIndex(c,x,m),h(this._objects,c),this._objects.splice(C,0,c));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(c,m,_){var b,y,x;if(_)for(b=m,y=m+1,x=this._objects.length;y<x;++y){var C=c.intersectsWithObject(this._objects[y])||c.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(c);if(C){b=y;break}}else b=m+1;return b},moveTo:function(c,m){return h(this._objects,c),this._objects.splice(m,0,c),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(c){c.dispose&&c.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),a(t.StaticCanvas.prototype,t.Observable),a(t.StaticCanvas.prototype,t.Collection),a(t.StaticCanvas.prototype,t.DataURLExporter),a(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(c){var m=d();if(!m||!m.getContext)return null;var _=m.getContext("2d");if(!_)return null;switch(c){case"setLineDash":return typeof _.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var c=o(this.lowerCanvasEl);return c&&c.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(c){var m=o(this.lowerCanvasEl);return m&&m.createJPEGStream(c)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(a){a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.miterLimit=this.strokeMiterLimit,a.lineJoin=this.strokeLineJoin,a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var n=this.canvas.viewportTransform;a.save(),a.transform(n[0],n[1],n[2],n[3],n[4],n[5])},_setShadow:function(){if(this.shadow){var a=this.canvas,n=this.shadow,h=a.contextTop,u=a.getZoom();a&&a._isRetinaScaling()&&(u*=t.devicePixelRatio),h.shadowColor=n.color,h.shadowBlur=n.blur*u,h.shadowOffsetX=n.offsetX*u,h.shadowOffsetY=n.offsetY*u}},needsFullRender:function(){var a=new t.Color(this.color);return a.getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_isOutSideCanvas:function(a){return a.x<0||a.x>this.canvas.getWidth()||a.y<0||a.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(a){this.canvas=a,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(a,n,h){var u=n.midPointFrom(h);return a.quadraticCurveTo(n.x,n.y,u.x,u.y),u},onMouseDown:function(a,n){this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],this._prepareForDrawing(a),this._captureDrawingPath(a),this._render())},onMouseMove:function(a,n){if(this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a))&&this._captureDrawingPath(a)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var h=this._points,u=h.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,h[u-2],h[u-1],!0),r.stroke(),r.restore()}},onMouseUp:function(a){return this.canvas._isMainEvent(a.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(a){var n=new t.Point(a.x,a.y);this._reset(),this._addPoint(n),this.canvas.contextTop.moveTo(n.x,n.y)},_addPoint:function(a){return this._points.length>1&&a.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(a),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(a){var n=new t.Point(a.x,a.y);return this._addPoint(n)},_render:function(a){var n,h,u=this._points[0],r=this._points[1];if(a=a||this.canvas.contextTop,this._saveAndTransform(a),a.beginPath(),this._points.length===2&&u.x===r.x&&u.y===r.y){var l=this.width/1e3;u=new t.Point(u.x,u.y),r=new t.Point(r.x,r.y),u.x-=l,r.x+=l}for(a.moveTo(u.x,u.y),n=1,h=this._points.length;n<h;n++)this._drawSegment(a,u,r),u=this._points[n],r=this._points[n+1];a.lineTo(u.x,u.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var n=this.width/1e3;return t.util.getSmoothPathFromPoints(a,n)},_isEmptySVGPath:function(a){var n=t.util.joinPath(a);return n==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(a){var n=new t.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,n.shadow=new t.Shadow(this.shadow)),n},decimatePoints:function(a,n){if(a.length<=2)return a;var h=this.canvas.getZoom(),u=Math.pow(n/h,2),r,l=a.length-1,o=a[0],d=[o],p;for(r=1;r<l-1;r++)p=Math.pow(o.x-a[r].x,2)+Math.pow(o.y-a[r].y,2),p>=u&&(o=a[r],d.push(o));return d.push(a[l]),d},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var n=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(n)){this.canvas.requestRenderAll();return}var h=this.createPath(n);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.requestRenderAll(),h.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:h})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var n=this.addPoint(a),h=this.canvas.contextTop;this._saveAndTransform(h),this.dot(h,n),h.restore()},dot:function(a,n){a.fillStyle=n.fill,a.beginPath(),a.arc(n.x,n.y,n.radius,0,Math.PI*2,!1),a.closePath(),a.fill()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},_render:function(){var a=this.canvas.contextTop,n,h,u=this.points;for(this._saveAndTransform(a),n=0,h=u.length;n<h;n++)this.dot(a,u[n]);a.restore()},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(a),this._render()):this.drawDot(a))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove,n,h;this.canvas.renderOnAddRemove=!1;var u=[];for(n=0,h=this.points.length;n<h;n++){var r=this.points[n],l=new t.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(l.shadow=new t.Shadow(this.shadow)),u.push(l)}var o=new t.Group(u);o.canvas=this.canvas,this.canvas.fire("before:path:created",{path:o}),this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},addPoint:function(a){var n=new t.Point(a.x,a.y),h=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return n.radius=h,n.fill=u,this.points.push(n),n}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.addSprayChunk(a),this.render(this.sprayChunkPoints))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var n=[],h=0,u=this.sprayChunks.length;h<u;h++)for(var r=this.sprayChunks[h],l=0,o=r.length;l<o;l++){var d=new t.Rect({width:r[l].width,height:r[l].width,left:r[l].x+1,top:r[l].y+1,originX:"center",originY:"center",fill:this.color});n.push(d)}this.optimizeOverlapping&&(n=this._getOptimizedRects(n));var p=new t.Group(n);this.shadow&&p.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:p}),this.canvas.add(p),this.canvas.fire("path:created",{path:p}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var n={},h,u,r;for(u=0,r=a.length;u<r;u++)h=a[u].left+""+a[u].top,n[h]||(n[h]=a[u]);var l=[];for(h in n)l.push(n[h]);return l},render:function(a){var n=this.canvas.contextTop,h,u;for(n.fillStyle=this.color,this._saveAndTransform(n),h=0,u=a.length;h<u;h++){var r=a[h];typeof r.opacity<"u"&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var a=this.canvas.contextTop,n,h;for(a.fillStyle=this.color,this._saveAndTransform(a),n=0,h=this.sprayChunks.length;n<h;n++)this.render(this.sprayChunks[n]);a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var n,h,u,r=this.width/2,l;for(l=0;l<this.density;l++){n=t.util.getRandomInt(a.x-r,a.x+r),h=t.util.getRandomInt(a.y-r,a.y+r),this.dotWidthVariance?u=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):u=this.dotWidth;var o=new t.Point(n,h);o.width=u,this.randomOpacity&&(o.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var a=20,n=5,h=t.util.createCanvasElement(),u=h.getContext("2d");return h.width=h.height=a+n,u.fillStyle=this.color,u.beginPath(),u.arc(a/2,a/2,a/2,0,Math.PI*2,!1),u.closePath(),u.fill(),h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(a){return a.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(a){this.callSuper("_setBrushStyles",a),a.strokeStyle=this.getPattern(a)},createPath:function(a){var n=this.callSuper("createPath",a),h=n._getLeftTopCoords().scalarAdd(n.strokeWidth/2);return n.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-h.x,offsetY:-h.y}),n}}),function(){var a=t.util.getPointer,n=t.util.degreesToRadians,h=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(r,l){l||(l={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,l),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),l,o,d;if(r.length>0&&!this.preserveObjectStacking){o=[],d=[];for(var p=0,c=this._objects.length;p<c;p++)l=this._objects[p],r.indexOf(l)===-1?o.push(l):d.push(l);r.length>1&&(this._activeObject._objects=d),o.push.apply(o,d)}else o=this._objects;return o},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,l){var o=r.calcTransformMatrix(),d=t.util.invertTransform(o),p=this.restorePointerVpt(l);return t.util.transformPoint(p,d)},isTargetTransparent:function(r,l,o){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var d=this._normalizePointer(r,{x:l,y:o}),p=Math.max(r.cacheTranslationX+d.x*r.zoomX,0),c=Math.max(r.cacheTranslationY+d.y*r.zoomY,0),y=t.util.isTransparent(r._cacheContext,Math.round(p),Math.round(c),this.targetFindTolerance);return y}var m=this.contextCache,_=r.selectionBackgroundColor,b=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(b[0],b[1],b[2],b[3],b[4],b[5]),r.render(m),m.restore(),r.selectionBackgroundColor=_;var y=t.util.isTransparent(m,l,o,this.targetFindTolerance);return y},_isSelectionKeyPressed:function(r){var l=!1;return Array.isArray(this.selectionKey)?l=!!this.selectionKey.find(function(o){return r[o]===!0}):l=r[this.selectionKey],l},_shouldClearSelection:function(r,l){var o=this.getActiveObjects(),d=this._activeObject;return!l||l&&d&&o.length>1&&o.indexOf(l)===-1&&d!==l&&!this._isSelectionKeyPressed(r)||l&&!l.evented||l&&!l.selectable&&d&&d!==l},_shouldCenterTransform:function(r,l,o){if(r){var d;return l==="scale"||l==="scaleX"||l==="scaleY"||l==="resizing"?d=this.centeredScaling||r.centeredScaling:l==="rotate"&&(d=this.centeredRotation||r.centeredRotation),d?!o:o}},_getOriginFromCorner:function(r,l){var o={x:r.originX,y:r.originY};return l==="ml"||l==="tl"||l==="bl"?o.x="right":(l==="mr"||l==="tr"||l==="br")&&(o.x="left"),l==="tl"||l==="mt"||l==="tr"?o.y="bottom":(l==="bl"||l==="mb"||l==="br")&&(o.y="top"),o},_getActionFromCorner:function(r,l,o,d){if(!l||!r)return"drag";var p=d.controls[l];return p.getActionName(o,p,d)},_setupCurrentTransform:function(r,l,o){if(l){var d=this.getPointer(r),p=l.__corner,c=l.controls[p],m=o&&p?c.getActionHandler(r,l,c):t.controlsUtils.dragHandler,_=this._getActionFromCorner(o,p,r,l),b=this._getOriginFromCorner(l,p),y=r[this.centeredKey],x={target:l,action:_,actionHandler:m,corner:p,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,offsetX:d.x-l.left,offsetY:d.y-l.top,originX:b.x,originY:b.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,theta:n(l.angle),width:l.width*l.scaleX,shiftKey:r.shiftKey,altKey:y,original:t.util.saveObjectTransform(l)};this._shouldCenterTransform(l,_,y)&&(x.originX="center",x.originY="center"),x.original.originX=b.x,x.original.originY=b.y,this._currentTransform=x,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var l=this._groupSelector,o=new t.Point(l.ex,l.ey),d=t.util.transformPoint(o,this.viewportTransform),p=new t.Point(l.ex+l.left,l.ey+l.top),c=t.util.transformPoint(p,this.viewportTransform),m=Math.min(d.x,c.x),_=Math.min(d.y,c.y),b=Math.max(d.x,c.x),y=Math.max(d.y,c.y),x=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(m,_,b-m,y-_)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,m+=x,_+=x,b-=x,y-=x,t.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(m,_,b-m,y-_))},findTarget:function(r,l){if(!this.skipTargetFind){var o=!0,d=this.getPointer(r,o),p=this._activeObject,c=this.getActiveObjects(),m,_,b=h(r),y=c.length>1&&!l||c.length===1;if(this.targets=[],y&&p._findTargetCorner(d,b)||c.length>1&&!l&&p===this._searchPossibleTargets([p],d))return p;if(c.length===1&&p===this._searchPossibleTargets([p],d))if(this.preserveObjectStacking)m=p,_=this.targets,this.targets=[];else return p;var x=this._searchPossibleTargets(this._objects,d);return r[this.altSelectionKey]&&x&&m&&x!==m&&(x=m,this.targets=_),x}},_checkTarget:function(r,l,o){if(l&&l.visible&&l.evented&&l.containsPoint(r))if((this.perPixelTargetFind||l.perPixelTargetFind)&&!l.isEditing){var d=this.isTargetTransparent(l,o.x,o.y);if(!d)return!0}else return!0},_searchPossibleTargets:function(r,l){for(var o,d=r.length,p;d--;){var c=r[d],m=c.group?this._normalizePointer(c.group,l):l;if(this._checkTarget(m,c,l)){o=r[d],o.subTargetCheck&&o instanceof t.Group&&(p=this._searchPossibleTargets(o._objects,l),p&&this.targets.push(p));break}}return o},restorePointerVpt:function(r){return t.util.transformPoint(r,t.util.invertTransform(this.viewportTransform))},getPointer:function(r,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var o=a(r),d=this.upperCanvasEl,p=d.getBoundingClientRect(),c=p.width||0,m=p.height||0,_;(!c||!m)&&("top"in p&&"bottom"in p&&(m=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(c=Math.abs(p.right-p.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,l||(o=this.restorePointerVpt(o));var b=this.getRetinaScaling();return b!==1&&(o.x/=b,o.y/=b),c===0||m===0?_={width:1,height:1}:_={width:d.width/c,height:d.height/m},{x:o.x*_.width,y:o.y*_.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),l=this.lowerCanvasEl,o=this.upperCanvasEl;o?o.className="":(o=this._createCanvasElement(),this.upperCanvasEl=o),t.util.addClass(o,"upper-canvas "+r),this.wrapperEl.appendChild(o),this._copyCanvasStyle(l,o),this._applyCanvasStyle(o),this.contextTop=o.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var l=this.width||r.width,o=this.height||r.height;t.util.setStyle(r,{position:"absolute",width:l+"px",height:o+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=l,r.height=o,t.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,l){l.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,l){var o=!1,d=this.getActiveObjects(),p=[],c=[];r.forEach(function(m){d.indexOf(m)===-1&&(o=!0,m.fire("deselected",{e:l,target:m}),c.push(m))}),d.forEach(function(m){r.indexOf(m)===-1&&(o=!0,m.fire("selected",{e:l,target:m}),p.push(m))}),r.length>0&&d.length>0?o&&this.fire("selection:updated",{e:l,selected:p,deselected:c}):d.length>0?this.fire("selection:created",{e:l,selected:p}):r.length>0&&this.fire("selection:cleared",{e:l,deselected:c})},setActiveObject:function(r,l){var o=this.getActiveObjects();return this._setActiveObject(r,l),this._fireSelectionEvents(o,l),this},_setActiveObject:function(r,l){return this._activeObject===r||!this._discardActiveObject(l,r)||r.onSelect({e:l})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,l){var o=this._activeObject;if(o){if(o.onDeselect({e:r,object:l}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var l=this.getActiveObjects(),o=this.getActiveObject();return l.length&&this.fire("before:selection:cleared",{target:o,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(l,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var l=this._activeObject;l&&l._renderControls(r)},_toObject:function(r,l,o){var d=this._realizeGroupTransformOnObject(r),p=this.callSuper("_toObject",r,l,o);return this._unwindGroupTransformOnObject(r,d),p},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var l=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],o={};return l.forEach(function(d){o[d]=r[d]}),t.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),o}else return null},_unwindGroupTransformOnObject:function(r,l){l&&r.set(l)},_setSVGObject:function(r,l,o){var d=this._realizeGroupTransformOnObject(l);this.callSuper("_setSVGObject",r,l,o),this._unwindGroupTransformOnObject(l,d)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var u in t.StaticCanvas)u!=="prototype"&&(t.Canvas[u]=t.StaticCanvas[u])}(),function(){var a=t.util.addListener,n=t.util.removeListener,h=3,u=2,r=1,l={passive:!1};function o(d,p){return d.button&&d.button===p-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(a,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(d,p){var c=this.upperCanvasEl,m=this._getEventPrefix();d(t.window,"resize",this._onResize),d(c,m+"down",this._onMouseDown),d(c,m+"move",this._onMouseMove,l),d(c,m+"out",this._onMouseOut),d(c,m+"enter",this._onMouseEnter),d(c,"wheel",this._onMouseWheel),d(c,"contextmenu",this._onContextMenu),d(c,"dblclick",this._onDoubleClick),d(c,"dragover",this._onDragOver),d(c,"dragenter",this._onDragEnter),d(c,"dragleave",this._onDragLeave),d(c,"drop",this._onDrop),this.enablePointerEvents||d(c,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&p in eventjs&&(eventjs[p](c,"gesture",this._onGesture),eventjs[p](c,"drag",this._onDrag),eventjs[p](c,"orientation",this._onOrientationChange),eventjs[p](c,"shake",this._onShake),eventjs[p](c,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(n,"remove");var d=this._getEventPrefix();n(t.document,d+"up",this._onMouseUp),n(t.document,"touchend",this._onTouchEnd,l),n(t.document,d+"move",this._onMouseMove,l),n(t.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(d,p){this.__onTransformGesture&&this.__onTransformGesture(d,p)},_onDrag:function(d,p){this.__onDrag&&this.__onDrag(d,p)},_onMouseWheel:function(d){this.__onMouseWheel(d)},_onMouseOut:function(d){var p=this._hoveredTarget;this.fire("mouse:out",{target:p,e:d}),this._hoveredTarget=null,p&&p.fire("mouseout",{e:d});var c=this;this._hoveredTargets.forEach(function(m){c.fire("mouse:out",{target:p,e:d}),m&&p.fire("mouseout",{e:d})}),this._hoveredTargets=[]},_onMouseEnter:function(d){!this._currentTransform&&!this.findTarget(d)&&(this.fire("mouse:over",{target:null,e:d}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(d,p){this.__onOrientationChange&&this.__onOrientationChange(d,p)},_onShake:function(d,p){this.__onShake&&this.__onShake(d,p)},_onLongPress:function(d,p){this.__onLongPress&&this.__onLongPress(d,p)},_onDragOver:function(d){d.preventDefault();var p=this._simpleEventHandler("dragover",d);this._fireEnterLeaveEvents(p,d)},_onDrop:function(d){return this._simpleEventHandler("drop:before",d),this._simpleEventHandler("drop",d)},_onContextMenu:function(d){return this.stopContextMenu&&(d.stopPropagation(),d.preventDefault()),!1},_onDoubleClick:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"dblclick"),this._resetTransformEventData(d)},getPointerId:function(d){var p=d.changedTouches;return p?p[0]&&p[0].identifier:this.enablePointerEvents?d.pointerId:-1},_isMainEvent:function(d){return d.isPrimary===!0?!0:d.isPrimary===!1?!1:d.type==="touchend"&&d.touches.length===0?!0:d.changedTouches?d.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(d){d.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(d)),this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,c=this._getEventPrefix();a(t.document,"touchend",this._onTouchEnd,l),a(t.document,"touchmove",this._onMouseMove,l),n(p,c+"down",this._onMouseDown)},_onMouseDown:function(d){this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,c=this._getEventPrefix();n(p,c+"move",this._onMouseMove,l),a(t.document,c+"up",this._onMouseUp),a(t.document,c+"move",this._onMouseMove,l)},_onTouchEnd:function(d){if(!(d.touches.length>0)){this.__onMouseUp(d),this._resetTransformEventData(),this.mainTouchId=null;var p=this._getEventPrefix();n(t.document,"touchend",this._onTouchEnd,l),n(t.document,"touchmove",this._onMouseMove,l);var c=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){a(c.upperCanvasEl,p+"down",c._onMouseDown),c._willAddMouseDown=0},400)}},_onMouseUp:function(d){this.__onMouseUp(d),this._resetTransformEventData();var p=this.upperCanvasEl,c=this._getEventPrefix();this._isMainEvent(d)&&(n(t.document,c+"up",this._onMouseUp),n(t.document,c+"move",this._onMouseMove,l),a(p,c+"move",this._onMouseMove,l))},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(d){var p=this._activeObject;return!!p!=!!d||p&&d&&p!==d?!0:(p&&p.isEditing,!1)},__onMouseUp:function(d){var p,c=this._currentTransform,m=this._groupSelector,_=!1,b=!m||m.left===0&&m.top===0;if(this._cacheTransformEventData(d),p=this._target,this._handleEvent(d,"up:before"),o(d,h)){this.fireRightClick&&this._handleEvent(d,"up",h,b);return}if(o(d,u)){this.fireMiddleClick&&this._handleEvent(d,"up",u,b),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(d);return}if(this._isMainEvent(d)){if(c&&(this._finalizeCurrentTransform(d),_=c.actionPerformed),!b){var y=p===this._activeObject;this._maybeGroupObjects(d),_||(_=this._shouldRender(p)||!y&&p===this._activeObject)}var x,C;if(p){if(x=p._findTargetCorner(this.getPointer(d,!0),t.util.isTouchEvent(d)),p.selectable&&p!==this._activeObject&&p.activeOn==="up")this.setActiveObject(p,d),_=!0;else{var w=p.controls[x],O=w&&w.getMouseUpHandler(d,p,w);O&&(C=this.getPointer(d),O(d,c,C.x,C.y))}p.isMoving=!1}if(c&&(c.target!==p||c.corner!==x)){var E=c.target&&c.target.controls[c.corner],j=E&&E.getMouseUpHandler(d,p,w);C=C||this.getPointer(d),j&&j(d,c,C.x,C.y)}this._setCursorFromEvent(d,p),this._handleEvent(d,"up",r,b),this._groupSelector=null,this._currentTransform=null,p&&(p.__corner=0),_?this.requestRenderAll():b||this.renderTop()}},_simpleEventHandler:function(d,p){var c=this.findTarget(p),m=this.targets,_={e:p,target:c,subTargets:m};if(this.fire(d,_),c&&c.fire(d,_),!m)return c;for(var b=0;b<m.length;b++)m[b].fire(d,_);return c},_handleEvent:function(d,p,c,m){var _=this._target,b=this.targets||[],y={e:d,target:_,subTargets:b,button:c||r,isClick:m||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};p==="up"&&(y.currentTarget=this.findTarget(d),y.currentSubTargets=this.targets),this.fire("mouse:"+p,y),_&&_.fire("mouse"+p,y);for(var x=0;x<b.length;x++)b[x].fire("mouse"+p,y)},_finalizeCurrentTransform:function(d){var p=this._currentTransform,c=p.target,m={e:d,target:c,transform:p,action:p.action};c._scaling&&(c._scaling=!1),c.setCoords(),(p.actionPerformed||this.stateful&&c.hasStateChanged())&&this._fire("modified",m)},_onMouseDownInDrawingMode:function(d){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(d).requestRenderAll();var p=this.getPointer(d);this.freeDrawingBrush.onMouseDown(p,{e:d,pointer:p}),this._handleEvent(d,"down")},_onMouseMoveInDrawingMode:function(d){if(this._isCurrentlyDrawing){var p=this.getPointer(d);this.freeDrawingBrush.onMouseMove(p,{e:d,pointer:p})}this.setCursor(this.freeDrawingCursor),this._handleEvent(d,"move")},_onMouseUpInDrawingMode:function(d){var p=this.getPointer(d);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:d,pointer:p}),this._handleEvent(d,"up")},__onMouseDown:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"down:before");var p=this._target;if(o(d,h)){this.fireRightClick&&this._handleEvent(d,"down",h);return}if(o(d,u)){this.fireMiddleClick&&this._handleEvent(d,"down",u);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(d);return}if(this._isMainEvent(d)&&!this._currentTransform){var c=this._pointer;this._previousPointer=c;var m=this._shouldRender(p),_=this._shouldGroup(d,p);if(this._shouldClearSelection(d,p)?this.discardActiveObject(d):_&&(this._handleGrouping(d,p),p=this._activeObject),this.selection&&(!p||!p.selectable&&!p.isEditing&&p!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),p){var b=p===this._activeObject;p.selectable&&p.activeOn==="down"&&this.setActiveObject(p,d);var y=p._findTargetCorner(this.getPointer(d,!0),t.util.isTouchEvent(d));if(p.__corner=y,p===this._activeObject&&(y||!_)){this._setupCurrentTransform(d,p,b);var x=p.controls[y],c=this.getPointer(d),C=x&&x.getMouseDownHandler(d,p,x);C&&C(d,this._currentTransform,c.x,c.y)}}this._handleEvent(d,"down"),(m||_)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(d){this._resetTransformEventData(),this._pointer=this.getPointer(d,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(d)||null},_beforeTransform:function(d){var p=this._currentTransform;this.stateful&&p.target.saveState(),this.fire("before:transform",{e:d,transform:p})},__onMouseMove:function(d){this._handleEvent(d,"move:before"),this._cacheTransformEventData(d);var p,c;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(d);return}if(this._isMainEvent(d)){var m=this._groupSelector;m?(c=this._absolutePointer,m.left=c.x-m.ex,m.top=c.y-m.ey,this.renderTop()):this._currentTransform?this._transformObject(d):(p=this.findTarget(d)||null,this._setCursorFromEvent(d,p),this._fireOverOutEvents(p,d)),this._handleEvent(d,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(d,p){var c=this._hoveredTarget,m=this._hoveredTargets,_=this.targets,b=Math.max(m.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:c,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:m[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=d,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(d,p){var c=this._draggedoverTarget,m=this._hoveredTargets,_=this.targets,b=Math.max(m.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:c,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:m[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=d},fireSyntheticInOutEvents:function(d,p,c){var m,_,b=c.oldTarget,y,x,C=b!==d,w=c.canvasEvtIn,O=c.canvasEvtOut;C&&(m={e:p,target:d,previousTarget:b},_={e:p,target:b,nextTarget:d}),x=d&&C,y=b&&C,y&&(O&&this.fire(O,_),b.fire(c.evtOut,_)),x&&(w&&this.fire(w,m),d.fire(c.evtIn,m))},__onMouseWheel:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"wheel"),this._resetTransformEventData()},_transformObject:function(d){var p=this.getPointer(d),c=this._currentTransform;c.reset=!1,c.shiftKey=d.shiftKey,c.altKey=d[this.centeredKey],this._performTransformAction(d,c,p),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(d,p,c){var m=c.x,_=c.y,b=p.action,y=!1,x=p.actionHandler;x&&(y=x(d,p,m,_)),b==="drag"&&y&&(p.target.isMoving=!0,this.setCursor(p.target.moveCursor||this.moveCursor)),p.actionPerformed=p.actionPerformed||y},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(d,p){if(!p)return this.setCursor(this.defaultCursor),!1;var c=p.hoverCursor||this.hoverCursor,m=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,_=(!m||!m.contains(p))&&p._findTargetCorner(this.getPointer(d,!0));_?this.setCursor(this.getCornerCursor(_,p,d)):(p.subTargetCheck&&this.targets.concat().reverse().map(function(b){c=b.hoverCursor||c}),this.setCursor(c))},getCornerCursor:function(d,p,c){var m=p.controls[d];return m.cursorStyleHandler(c,m,p)}})}(),function(){var a=Math.min,n=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(h,u){var r=this._activeObject;return r&&this._isSelectionKeyPressed(h)&&u&&u.selectable&&this.selection&&(r!==u||r.type==="activeSelection")&&!u.onSelect({e:h})},_handleGrouping:function(h,u){var r=this._activeObject;r.__corner||u===r&&(u=this.findTarget(h,!0),!u||!u.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(u,h):this._createActiveSelection(u,h))},_updateActiveSelection:function(h,u){var r=this._activeObject,l=r._objects.slice(0);r.contains(h)?(r.removeWithUpdate(h),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),u)):(r.addWithUpdate(h),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(l,u)},_createActiveSelection:function(h,u){var r=this.getActiveObjects(),l=this._createGroup(h);this._hoveredTarget=l,this._setActiveObject(l,u),this._fireSelectionEvents(r,u)},_createGroup:function(h){var u=this._objects,r=u.indexOf(this._activeObject)<u.indexOf(h),l=r?[this._activeObject,h]:[h,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(h){var u=this._collectObjects(h),r;u.length===1?this.setActiveObject(u[0],h):u.length>1&&(r=new t.ActiveSelection(u.reverse(),{canvas:this}),this.setActiveObject(r,h))},_collectObjects:function(h){for(var u=[],r,l=this._groupSelector.ex,o=this._groupSelector.ey,d=l+this._groupSelector.left,p=o+this._groupSelector.top,c=new t.Point(a(l,d),a(o,p)),m=new t.Point(n(l,d),n(o,p)),_=!this.selectionFullyContained,b=l===d&&o===p,y=this._objects.length;y--&&(r=this._objects[y],!(!(!r||!r.selectable||!r.visible)&&(_&&r.intersectsWithRect(c,m,!0)||r.isContainedWithinRect(c,m,!0)||_&&r.containsPoint(c,null,!0)||_&&r.containsPoint(m,null,!0))&&(u.push(r),b))););return u.length>1&&(u=u.filter(function(x){return!x.onSelect({e:h})})),u},_maybeGroupObjects:function(h){this.selection&&this._groupSelector&&this._groupSelectedObjects(h),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var n=a.format||"png",h=a.quality||1,u=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(u,a);return t.util.toDataURL(r,n,h)},toCanvasElement:function(a,n){a=a||1,n=n||{};var h=(n.width||this.width)*a,u=(n.height||this.height)*a,r=this.getZoom(),l=this.width,o=this.height,d=r*a,p=this.viewportTransform,c=(p[4]-(n.left||0))*a,m=(p[5]-(n.top||0))*a,_=this.interactive,b=[d,0,0,d,c,m],y=this.enableRetinaScaling,x=t.util.createCanvasElement(),C=this.contextTop;return x.width=h,x.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=b,this.width=h,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(x.getContext("2d"),this._objects),this.viewportTransform=p,this.width=l,this.height=o,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=y,this.contextTop=C,x}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(a,n,h){if(a){var u=typeof a=="string"?JSON.parse(a):t.util.object.clone(a),r=this,l=u.clipPath,o=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(d){r.clear(),r._setBgOverlay(u,function(){l?r._enlivenObjects([l],function(p){r.clipPath=p[0],r.__setupCanvas.call(r,u,d,o,n)}):r.__setupCanvas.call(r,u,d,o,n)})},h),this}},__setupCanvas:function(a,n,h,u){var r=this;n.forEach(function(l,o){r.insertAt(l,o)}),this.renderOnAddRemove=h,delete a.objects,delete a.backgroundImage,delete a.overlayImage,delete a.background,delete a.overlay,this._setOptions(a),this.renderAll(),u&&u()},_setBgOverlay:function(a,n){var h={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!a.backgroundImage&&!a.overlayImage&&!a.background&&!a.overlay){n&&n();return}var u=function(){h.backgroundImage&&h.overlayImage&&h.backgroundColor&&h.overlayColor&&n&&n()};this.__setBgOverlay("backgroundImage",a.backgroundImage,h,u),this.__setBgOverlay("overlayImage",a.overlayImage,h,u),this.__setBgOverlay("backgroundColor",a.background,h,u),this.__setBgOverlay("overlayColor",a.overlay,h,u)},__setBgOverlay:function(a,n,h,u){var r=this;if(!n){h[a]=!0,u&&u();return}a==="backgroundImage"||a==="overlayImage"?t.util.enlivenObjects([n],function(l){r[a]=l[0],h[a]=!0,u&&u()}):this["set"+t.util.string.capitalize(a,!0)](n,function(){h[a]=!0,u&&u()})},_enlivenObjects:function(a,n,h){if(!a||a.length===0){n&&n([]);return}t.util.enlivenObjects(a,function(u){n&&n(u)},null,h)},_toDataURL:function(a,n){this.clone(function(h){n(h.toDataURL(a))})},_toDataURLWithMultiplier:function(a,n,h){this.clone(function(u){h(u.toDataURLWithMultiplier(a,n))})},clone:function(a,n){var h=JSON.stringify(this.toJSON(n));this.cloneWithoutData(function(u){u.loadFromJSON(h,function(){a&&a(u)})})},cloneWithoutData:function(a){var n=t.util.createCanvasElement();n.width=this.width,n.height=this.height;var h=new t.Canvas(n);this.backgroundImage?(h.setBackgroundImage(this.backgroundImage.src,function(){h.renderAll(),a&&a(h)}),h.backgroundImageOpacity=this.backgroundImageOpacity,h.backgroundImageStretch=this.backgroundImageStretch):a&&a(h)}}),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.util.object.clone,r=n.util.toFixed,l=n.util.string.capitalize,o=n.util.degreesToRadians,d=!n.isLikelyNode,p=2;n.Object||(n.Object=n.util.createClass(n.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:d,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(c){c&&this.setOptions(c)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=n.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(c){var m=n.perfLimitSizeTotal,_=c.width,b=c.height,y=n.maxCacheSideLimit,x=n.minCacheSideLimit;if(_<=y&&b<=y&&_*b<=m)return _<x&&(c.width=x),b<x&&(c.height=x),c;var C=_/b,w=n.util.limitDimsByArea(C,m),O=n.util.capValue,E=O(x,w.x,y),j=O(x,w.y,y);return _>E&&(c.zoomX/=_/E,c.width=E,c.capped=!0),b>j&&(c.zoomY/=b/j,c.height=j,c.capped=!0),c},_getCacheCanvasDimensions:function(){var c=this.getTotalObjectScaling(),m=this._getTransformedDimensions(0,0),_=m.x*c.scaleX/this.scaleX,b=m.y*c.scaleY/this.scaleY;return{width:_+p,height:b+p,zoomX:c.scaleX,zoomY:c.scaleY,x:_,y:b}},_updateCacheCanvas:function(){var c=this.canvas;if(this.noScaleCache&&c&&c._currentTransform){var m=c._currentTransform.target,_=c._currentTransform.action;if(this===m&&_.slice&&_.slice(0,5)==="scale")return!1}var b=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),x=n.minCacheSideLimit,C=y.width,w=y.height,O,E,j=y.zoomX,H=y.zoomY,q=C!==this.cacheWidth||w!==this.cacheHeight,Q=this.zoomX!==j||this.zoomY!==H,K=q||Q,G=0,Z=0,et=!1;if(q){var it=this._cacheCanvas.width,S=this._cacheCanvas.height,P=C>it||w>S,D=(C<it*.9||w<S*.9)&&it>x&&S>x;et=P||D,P&&!y.capped&&(C>x||w>x)&&(G=C*.1,Z=w*.1)}return this instanceof n.Text&&this.path&&(K=!0,et=!0,G+=this.getHeightOfLine(0)*this.zoomX,Z+=this.getHeightOfLine(0)*this.zoomY),K?(et?(b.width=Math.ceil(C+G),b.height=Math.ceil(w+Z)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,b.width,b.height)),O=y.x/2,E=y.y/2,this.cacheTranslationX=Math.round(b.width/2-O)+O,this.cacheTranslationY=Math.round(b.height/2-E)+E,this.cacheWidth=C,this.cacheHeight=w,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(j,H),this.zoomX=j,this.zoomY=H,!0):!1},setOptions:function(c){this._setOptions(c),this._initGradient(c.fill,"fill"),this._initGradient(c.stroke,"stroke"),this._initPattern(c.fill,"fill"),this._initPattern(c.stroke,"stroke")},transform:function(c){var m=this.group&&!this.group._transformDone||this.group&&this.canvas&&c===this.canvas.contextTop,_=this.calcTransformMatrix(!m);c.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(c){var m=n.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:n.version,originX:this.originX,originY:this.originY,left:r(this.left,m),top:r(this.top,m),width:r(this.width,m),height:r(this.height,m),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,m),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,m),scaleX:r(this.scaleX,m),scaleY:r(this.scaleY,m),angle:r(this.angle,m),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,m),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,m),skewY:r(this.skewY,m)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(c),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),n.util.populateWithProperties(this,_,c),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(c){return this.toObject(c)},_removeDefaultValues:function(c){var m=n.util.getKlass(c.type).prototype,_=m.stateProperties;return _.forEach(function(b){b==="left"||b==="top"||(c[b]===m[b]&&delete c[b],Array.isArray(c[b])&&Array.isArray(m[b])&&c[b].length===0&&m[b].length===0&&delete c[b])}),c},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var c=n.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(c.scaleX),scaleY:Math.abs(c.scaleY)}},getTotalObjectScaling:function(){var c=this.getObjectScaling(),m=c.scaleX,_=c.scaleY;if(this.canvas){var b=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();m*=b*y,_*=b*y}return{scaleX:m,scaleY:_}},getObjectOpacity:function(){var c=this.opacity;return this.group&&(c*=this.group.getObjectOpacity()),c},_set:function(c,m){var _=c==="scaleX"||c==="scaleY",b=this[c]!==m,y=!1;return _&&(m=this._constrainScale(m)),c==="scaleX"&&m<0?(this.flipX=!this.flipX,m*=-1):c==="scaleY"&&m<0?(this.flipY=!this.flipY,m*=-1):c==="shadow"&&m&&!(m instanceof n.Shadow)?m=new n.Shadow(m):c==="dirty"&&this.group&&this.group.set("dirty",m),this[c]=m,b&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(c)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(c)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:n.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(c){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(c.save(),this._setupCompositeOperation(c),this.drawSelectionBackground(c),this.transform(c),this._setOpacity(c),this._setShadow(c,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(c)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(c),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),c.restore())},renderCache:function(c){c=c||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,c.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(c,m){if(c.save(),m.inverted?c.globalCompositeOperation="destination-out":c.globalCompositeOperation="destination-in",m.absolutePositioned){var _=n.util.invertTransform(this.calcTransformMatrix());c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}m.transform(c),c.scale(1/m.zoomX,1/m.zoomY),c.drawImage(m._cacheCanvas,-m.cacheTranslationX,-m.cacheTranslationY),c.restore()},drawObject:function(c,m){var _=this.fill,b=this.stroke;m?(this.fill="black",this.stroke="",this._setClippingProperties(c)):this._renderBackground(c),this._render(c),this._drawClipPath(c,this.clipPath),this.fill=_,this.stroke=b},_drawClipPath:function(c,m){m&&(m.canvas=this.canvas,m.shouldCache(),m._transformDone=!0,m.renderCache({forClipping:!0}),this.drawClipPathOnCache(c,m))},drawCacheOnCanvas:function(c){c.scale(1/this.zoomX,1/this.zoomY),c.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(c){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!c&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!c){var m=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-m/2,-_/2,m,_)}return!0}return!1},_renderBackground:function(c){if(this.backgroundColor){var m=this._getNonTransformedDimensions();c.fillStyle=this.backgroundColor,c.fillRect(-m.x/2,-m.y/2,m.x,m.y),this._removeShadow(c)}},_setOpacity:function(c){this.group&&!this.group._transformDone?c.globalAlpha=this.getObjectOpacity():c.globalAlpha*=this.opacity},_setStrokeStyles:function(c,m){var _=m.stroke;_&&(c.lineWidth=m.strokeWidth,c.lineCap=m.strokeLineCap,c.lineDashOffset=m.strokeDashOffset,c.lineJoin=m.strokeLineJoin,c.miterLimit=m.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(c,_):(c.strokeStyle=_.toLive(c,this),this._applyPatternGradientTransform(c,_)):c.strokeStyle=m.stroke)},_setFillStyles:function(c,m){var _=m.fill;_&&(_.toLive?(c.fillStyle=_.toLive(c,this),this._applyPatternGradientTransform(c,m.fill)):c.fillStyle=_)},_setClippingProperties:function(c){c.globalAlpha=1,c.strokeStyle="transparent",c.fillStyle="#000000"},_setLineDash:function(c,m){!m||m.length===0||(1&m.length&&m.push.apply(m,m),c.setLineDash(m))},_renderControls:function(c,m){var _=this.getViewportTransform(),b=this.calcTransformMatrix(),y,x,C;m=m||{},x=typeof m.hasBorders<"u"?m.hasBorders:this.hasBorders,C=typeof m.hasControls<"u"?m.hasControls:this.hasControls,b=n.util.multiplyTransformMatrices(_,b),y=n.util.qrDecompose(b),c.save(),c.translate(y.translateX,y.translateY),c.lineWidth=1*this.borderScaleFactor,this.group||(c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),c.rotate(o(this.group?y.angle:this.angle)),m.forActiveSelection||this.group?x&&this.drawBordersInGroup(c,y,m):x&&this.drawBorders(c,m),C&&this.drawControls(c,m),c.restore()},_setShadow:function(c){if(this.shadow){var m=this.shadow,_=this.canvas,b,y=_&&_.viewportTransform[0]||1,x=_&&_.viewportTransform[3]||1;m.nonScaling?b={scaleX:1,scaleY:1}:b=this.getObjectScaling(),_&&_._isRetinaScaling()&&(y*=n.devicePixelRatio,x*=n.devicePixelRatio),c.shadowColor=m.color,c.shadowBlur=m.blur*n.browserShadowBlurConstant*(y+x)*(b.scaleX+b.scaleY)/4,c.shadowOffsetX=m.offsetX*y*b.scaleX,c.shadowOffsetY=m.offsetY*x*b.scaleY}},_removeShadow:function(c){this.shadow&&(c.shadowColor="",c.shadowBlur=c.shadowOffsetX=c.shadowOffsetY=0)},_applyPatternGradientTransform:function(c,m){if(!m||!m.toLive)return{offsetX:0,offsetY:0};var _=m.gradientTransform||m.patternTransform,b=-this.width/2+m.offsetX||0,y=-this.height/2+m.offsetY||0;return m.gradientUnits==="percentage"?c.transform(this.width,0,0,this.height,b,y):c.transform(1,0,0,1,b,y),_&&c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:b,offsetY:y}},_renderPaintInOrder:function(c){this.paintFirst==="stroke"?(this._renderStroke(c),this._renderFill(c)):(this._renderFill(c),this._renderStroke(c))},_render:function(){},_renderFill:function(c){this.fill&&(c.save(),this._setFillStyles(c,this),this.fillRule==="evenodd"?c.fill("evenodd"):c.fill(),c.restore())},_renderStroke:function(c){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(c),c.save(),this.strokeUniform&&this.group){var m=this.getObjectScaling();c.scale(1/m.scaleX,1/m.scaleY)}else this.strokeUniform&&c.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(c,this.strokeDashArray),this._setStrokeStyles(c,this),c.stroke(),c.restore()}},_applyPatternForTransformedGradient:function(c,m){var _=this._limitCacheSize(this._getCacheCanvasDimensions()),b=n.util.createCanvasElement(),y,x=this.canvas.getRetinaScaling(),C=_.x/this.scaleX/x,w=_.y/this.scaleY/x;b.width=C,b.height=w,y=b.getContext("2d"),y.beginPath(),y.moveTo(0,0),y.lineTo(C,0),y.lineTo(C,w),y.lineTo(0,w),y.closePath(),y.translate(C/2,w/2),y.scale(_.zoomX/this.scaleX/x,_.zoomY/this.scaleY/x),this._applyPatternGradientTransform(y,m),y.fillStyle=m.toLive(c),y.fill(),c.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),c.scale(x*this.scaleX/_.zoomX,x*this.scaleY/_.zoomY),c.strokeStyle=y.createPattern(b,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var c=n.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",c.scaleX),this.set("scaleY",c.scaleY),this.angle=c.angle,this.skewX=c.skewX,this.skewY=0}},_removeTransformMatrix:function(c){var m=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),m=n.util.transformPoint(m,this.transformMatrix)),this.transformMatrix=null,c&&(this.scaleX*=c.scaleX,this.scaleY*=c.scaleY,this.cropX=c.cropX,this.cropY=c.cropY,m.x+=c.offsetLeft,m.y+=c.offsetTop,this.width=c.width,this.height=c.height),this.setPositionByOrigin(m,"center","center")},clone:function(c,m){var _=this.toObject(m);this.constructor.fromObject?this.constructor.fromObject(_,c):n.Object._fromObject("Object",_,c)},cloneAsImage:function(c,m){var _=this.toCanvasElement(m);return c&&c(new n.Image(_)),this},toCanvasElement:function(c){c||(c={});var m=n.util,_=m.saveObjectTransform(this),b=this.group,y=this.shadow,x=Math.abs,C=(c.multiplier||1)*(c.enableRetinaScaling?n.devicePixelRatio:1);delete this.group,c.withoutTransform&&m.resetObjectTransform(this),c.withoutShadow&&(this.shadow=null);var w=n.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),E=this.shadow,j,H={x:0,y:0},q,Q,K;E&&(q=E.blur,E.nonScaling?j={scaleX:1,scaleY:1}:j=this.getObjectScaling(),H.x=2*Math.round(x(E.offsetX)+q)*x(j.scaleX),H.y=2*Math.round(x(E.offsetY)+q)*x(j.scaleY)),Q=O.width+H.x,K=O.height+H.y,w.width=Math.ceil(Q),w.height=Math.ceil(K);var G=new n.StaticCanvas(w,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});c.format==="jpeg"&&(G.backgroundColor="#fff"),this.setPositionByOrigin(new n.Point(G.width/2,G.height/2),"center","center");var Z=this.canvas;G.add(this);var et=G.toCanvasElement(C||1,c);return this.shadow=y,this.set("canvas",Z),b&&(this.group=b),this.set(_).setCoords(),G._objects=[],G.dispose(),G=null,et},toDataURL:function(c){return c||(c={}),n.util.toDataURL(this.toCanvasElement(c),c.format||"png",c.quality||1)},isType:function(c){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===c},complexity:function(){return 1},toJSON:function(c){return this.toObject(c)},rotate:function(c){var m=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return m&&this._setOriginToCenter(),this.set("angle",c),m&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(c,m){m=m||this.canvas.getPointer(c);var _=new n.Point(m.x,m.y),b=this._getLeftTopCoords();return this.angle&&(_=n.util.rotatePoint(_,b,o(-this.angle))),{x:_.x-b.x,y:_.y-b.y}},_setupCompositeOperation:function(c){this.globalCompositeOperation&&(c.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){n.runningAnimations&&n.runningAnimations.cancelByTarget(this)}}),n.util.createAccessors&&n.util.createAccessors(n.Object),h(n.Object.prototype,n.Observable),n.Object.NUM_FRACTION_DIGITS=2,n.Object.ENLIVEN_PROPS=["clipPath"],n.Object._fromObject=function(c,m,_,b){var y=n[c];m=u(m,!0),n.util.enlivenPatterns([m.fill,m.stroke],function(x){typeof x[0]<"u"&&(m.fill=x[0]),typeof x[1]<"u"&&(m.stroke=x[1]),n.util.enlivenObjectEnlivables(m,m,function(){var C=b?new y(m[b],m):new y(m);_&&_(C)})})},n.Object.__uid=0)}(i),function(){var a=t.util.degreesToRadians,n={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(u,r,l,o,d){var p=u.x,c=u.y,m,_,b;return typeof r=="string"?r=n[r]:r-=.5,typeof o=="string"?o=n[o]:o-=.5,m=o-r,typeof l=="string"?l=h[l]:l-=.5,typeof d=="string"?d=h[d]:d-=.5,_=d-l,(m||_)&&(b=this._getTransformedDimensions(),p=u.x+m*b.x,c=u.y+_*b.y),new t.Point(p,c)},translateToCenterPoint:function(u,r,l){var o=this.translateToGivenOrigin(u,r,l,"center","center");return this.angle?t.util.rotatePoint(o,u,a(this.angle)):o},translateToOriginPoint:function(u,r,l){var o=this.translateToGivenOrigin(u,"center","center",r,l);return this.angle?t.util.rotatePoint(o,u,a(this.angle)):o},getCenterPoint:function(){var u=new t.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,r){var l=this.getCenterPoint();return this.translateToOriginPoint(l,u,r)},toLocalPoint:function(u,r,l){var o=this.getCenterPoint(),d,p;return typeof r<"u"&&typeof l<"u"?d=this.translateToGivenOrigin(o,"center","center",r,l):d=new t.Point(this.left,this.top),p=new t.Point(u.x,u.y),this.angle&&(p=t.util.rotatePoint(p,o,-a(this.angle))),p.subtractEquals(d)},setPositionByOrigin:function(u,r,l){var o=this.translateToCenterPoint(u,r,l),d=this.translateToOriginPoint(o,this.originX,this.originY);this.set("left",d.x),this.set("top",d.y)},adjustPosition:function(u){var r=a(this.angle),l=this.getScaledWidth(),o=t.util.cos(r)*l,d=t.util.sin(r)*l,p,c;typeof this.originX=="string"?p=n[this.originX]:p=this.originX-.5,typeof u=="string"?c=n[u]:c=u-.5,this.left+=o*(c-p),this.top+=d*(c-p),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function a(l){return[new t.Point(l.tl.x,l.tl.y),new t.Point(l.tr.x,l.tr.y),new t.Point(l.br.x,l.br.y),new t.Point(l.bl.x,l.bl.y)]}var n=t.util,h=n.degreesToRadians,u=n.multiplyTransformMatrices,r=n.transformPoint;n.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(l,o){return o?l?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),l?this.aCoords:this.lineCoords)},getCoords:function(l,o){return a(this._getCoords(l,o))},intersectsWithRect:function(l,o,d,p){var c=this.getCoords(d,p),m=t.Intersection.intersectPolygonRectangle(c,l,o);return m.status==="Intersection"},intersectsWithObject:function(l,o,d){var p=t.Intersection.intersectPolygonPolygon(this.getCoords(o,d),l.getCoords(o,d));return p.status==="Intersection"||l.isContainedWithinObject(this,o,d)||this.isContainedWithinObject(l,o,d)},isContainedWithinObject:function(l,o,d){for(var p=this.getCoords(o,d),c=o?l.aCoords:l.lineCoords,m=0,_=l._getImageLines(c);m<4;m++)if(!l.containsPoint(p[m],_))return!1;return!0},isContainedWithinRect:function(l,o,d,p){var c=this.getBoundingRect(d,p);return c.left>=l.x&&c.left+c.width<=o.x&&c.top>=l.y&&c.top+c.height<=o.y},containsPoint:function(l,m,d,p){var c=this._getCoords(d,p),m=m||this._getImageLines(c),_=this._findCrossPoints(l,m);return _!==0&&_%2===1},isOnScreen:function(l){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br,p=this.getCoords(!0,l);return p.some(function(c){return c.x<=d.x&&c.x>=o.x&&c.y<=d.y&&c.y>=o.y})||this.intersectsWithRect(o,d,!0,l)?!0:this._containsCenterOfCanvas(o,d,l)},_containsCenterOfCanvas:function(l,o,d){var p={x:(l.x+o.x)/2,y:(l.y+o.y)/2};return!!this.containsPoint(p,null,!0,d)},isPartiallyOnScreen:function(l){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br;if(this.intersectsWithRect(o,d,!0,l))return!0;var p=this.getCoords(!0,l).every(function(c){return(c.x>=d.x||c.x<=o.x)&&(c.y>=d.y||c.y<=o.y)});return p&&this._containsCenterOfCanvas(o,d,l)},_getImageLines:function(l){var o={topline:{o:l.tl,d:l.tr},rightline:{o:l.tr,d:l.br},bottomline:{o:l.br,d:l.bl},leftline:{o:l.bl,d:l.tl}};return o},_findCrossPoints:function(l,o){var d,p,c,m,_,b=0,y;for(var x in o)if(y=o[x],!(y.o.y<l.y&&y.d.y<l.y)&&!(y.o.y>=l.y&&y.d.y>=l.y)&&(y.o.x===y.d.x&&y.o.x>=l.x?_=y.o.x:(d=0,p=(y.d.y-y.o.y)/(y.d.x-y.o.x),c=l.y-d*l.x,m=y.o.y-p*y.o.x,_=-(c-m)/(d-p)),_>=l.x&&(b+=1),b===2))break;return b},getBoundingRect:function(l,o){var d=this.getCoords(l,o);return n.makeBoundingBoxFromPoints(d)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(l){return Math.abs(l)<this.minScaleLimit?l<0?-this.minScaleLimit:this.minScaleLimit:l===0?1e-4:l},scale:function(l){return this._set("scaleX",l),this._set("scaleY",l),this.setCoords()},scaleToWidth:function(l,o){var d=this.getBoundingRect(o).width/this.getScaledWidth();return this.scale(l/this.width/d)},scaleToHeight:function(l,o){var d=this.getBoundingRect(o).height/this.getScaledHeight();return this.scale(l/this.height/d)},calcLineCoords:function(){var l=this.getViewportTransform(),o=this.padding,d=h(this.angle),p=n.cos(d),c=n.sin(d),m=p*o,_=c*o,b=m+_,y=m-_,x=this.calcACoords(),C={tl:r(x.tl,l),tr:r(x.tr,l),bl:r(x.bl,l),br:r(x.br,l)};return o&&(C.tl.x-=y,C.tl.y-=b,C.tr.x+=b,C.tr.y-=y,C.bl.x-=b,C.bl.y+=y,C.br.x+=y,C.br.y+=b),C},calcOCoords:function(){var l=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),d=this.getViewportTransform(),p=u(d,o),c=u(p,l),c=u(c,[1/d[0],0,0,1/d[3],0,0]),m=this._calculateCurrentDimensions(),_={};return this.forEachControl(function(b,y,x){_[y]=b.positionHandler(m,c,x)}),_},calcACoords:function(){var l=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),d=u(o,l),p=this._getTransformedDimensions(),c=p.x/2,m=p.y/2;return{tl:r({x:-c,y:-m},d),tr:r({x:c,y:-m},d),bl:r({x:-c,y:m},d),br:r({x:c,y:m},d)}},setCoords:function(l){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),l?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return n.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var l=this.getCenterPoint();return[1,0,0,1,l.x,l.y]},transformMatrixKey:function(l){var o="_",d="";return!l&&this.group&&(d=this.group.transformMatrixKey(l)+o),d+this.top+o+this.left+o+this.scaleX+o+this.scaleY+o+this.skewX+o+this.skewY+o+this.angle+o+this.originX+o+this.originY+o+this.width+o+this.height+o+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(l){var o=this.calcOwnMatrix();if(l||!this.group)return o;var d=this.transformMatrixKey(l),p=this.matrixCache||(this.matrixCache={});return p.key===d?p.value:(this.group&&(o=u(this.group.calcTransformMatrix(!1),o)),p.key=d,p.value=o,o)},calcOwnMatrix:function(){var l=this.transformMatrixKey(!0),o=this.ownMatrixCache||(this.ownMatrixCache={});if(o.key===l)return o.value;var d=this._calcTranslateMatrix(),p={angle:this.angle,translateX:d[4],translateY:d[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return o.key=l,o.value=n.composeMatrix(p),o.value},_getNonTransformedDimensions:function(){var l=this.strokeWidth,o=this.width+l,d=this.height+l;return{x:o,y:d}},_getTransformedDimensions:function(l,o){typeof l>"u"&&(l=this.skewX),typeof o>"u"&&(o=this.skewY);var d,p,c,m=l===0&&o===0;if(this.strokeUniform?(p=this.width,c=this.height):(d=this._getNonTransformedDimensions(),p=d.x,c=d.y),m)return this._finalizeDimensions(p*this.scaleX,c*this.scaleY);var _=n.sizeAfterTransform(p,c,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:l,skewY:o});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(l,o){return this.strokeUniform?{x:l+this.strokeWidth,y:o+this.strokeWidth}:{x:l,y:o}},_calculateCurrentDimensions:function(){var l=this.getViewportTransform(),o=this._getTransformedDimensions(),d=r(o,l,!0);return d.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas&&this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas&&this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas&&this.canvas.moveTo(this,a),this}}),function(){function a(h,u){if(u){if(u.toLive)return h+": url(#SVGID_"+u.id+"); ";var r=new t.Color(u),l=h+": "+r.toRgb()+"; ",o=r.getAlpha();return o!==1&&(l+=h+"-opacity: "+o.toString()+"; "),l}else return h+": none; "}var n=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(h){var u=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",l=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeDashOffset?this.strokeDashOffset:"0",d=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",m=typeof this.opacity<"u"?this.opacity:"1",_=this.visible?"":" visibility: hidden;",b=h?"":this.getSvgFilter(),y=a("fill",this.fill),x=a("stroke",this.stroke);return[x,"stroke-width: ",r,"; ","stroke-dasharray: ",l,"; ","stroke-linecap: ",d,"; ","stroke-dashoffset: ",o,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",c,"; ",y,"fill-rule: ",u,"; ","opacity: ",m,";",b,_].join("")},getSvgSpanStyles:function(h,u){var r="; ",o=h.fontFamily?"font-family: "+(h.fontFamily.indexOf("'")===-1&&h.fontFamily.indexOf('"')===-1?"'"+h.fontFamily+"'":h.fontFamily)+r:"",l=h.strokeWidth?"stroke-width: "+h.strokeWidth+r:"",o=o,d=h.fontSize?"font-size: "+h.fontSize+"px"+r:"",p=h.fontStyle?"font-style: "+h.fontStyle+r:"",c=h.fontWeight?"font-weight: "+h.fontWeight+r:"",m=h.fill?a("fill",h.fill):"",_=h.stroke?a("stroke",h.stroke):"",b=this.getSvgTextDecoration(h),y=h.deltaY?"baseline-shift: "+-h.deltaY+"; ":"";return b&&(b="text-decoration: "+b+r),[_,l,o,d,p,c,b,m,y,u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(h){return["overline","underline","line-through"].filter(function(u){return h[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(h,u){var r=h?this.calcTransformMatrix():this.calcOwnMatrix(),l='transform="'+t.util.matrixToSVG(r);return l+(u||"")+'" '},_setSVGBg:function(h){if(this.backgroundColor){var u=t.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,u),'" y="',n(-this.height/2,u),'" width="',n(this.width,u),'" height="',n(this.height,u),`"></rect>
`)}},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(h),{reviver:h})},toClipPathSVG:function(h){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(h),{reviver:h})},_createBaseClipPathSVGMarkup:function(h,u){u=u||{};var r=u.reviver,l=u.additionalTransform||"",o=[this.getSvgTransform(!0,l),this.getSvgCommons()].join(""),d=h.indexOf("COMMON_PARTS");return h[d]=o,r?r(h.join("")):h.join("")},_createBaseSVGMarkup:function(h,u){u=u||{};var r=u.noStyle,l=u.reviver,o=r?"":'style="'+this.getSvgStyles()+'" ',d=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",p=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",m=p&&p.absolutePositioned,_=this.stroke,b=this.fill,y=this.shadow,x,C=[],w,O=h.indexOf("COMMON_PARTS"),E=u.additionalTransform;return p&&(p.clipPathId="CLIPPATH_"+t.Object.__uid++,w='<clipPath id="'+p.clipPathId+`" >
`+p.toClipPathSVG(l)+`</clipPath>
`),m&&C.push("<g ",d,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),m?"":d+this.getSvgCommons(),` >
`),x=[o,c,r?"":this.addPaintOrder()," ",E?'transform="'+E+'" ':""].join(""),h[O]=x,b&&b.toLive&&C.push(b.toSVG(this)),_&&_.toLive&&C.push(_.toSVG(this)),y&&C.push(y.toSVG(this)),p&&C.push(w),C.push(h.join("")),C.push(`</g>
`),m&&C.push(`</g>
`),l?l(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var a=t.util.object.extend,n="stateProperties";function h(r,l,o){var d={},p=!0;o.forEach(function(c){d[c]=r[c]}),a(r[l],d,p)}function u(r,l,o){if(r===l)return!0;if(Array.isArray(r)){if(!Array.isArray(l)||r.length!==l.length)return!1;for(var d=0,p=r.length;d<p;d++)if(!u(r[d],l[d]))return!1;return!0}else if(r&&typeof r=="object"){var c=Object.keys(r),m;if(!l||typeof l!="object"||!o&&c.length!==Object.keys(l).length)return!1;for(var d=0,p=c.length;d<p;d++)if(m=c[d],!(m==="canvas"||m==="group")&&!u(r[m],l[m]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(r){r=r||n;var l="_"+r;return Object.keys(this[l]).length<this[r].length?!0:!u(this[l],this,!0)},saveState:function(r){var l=r&&r.propertySet||n,o="_"+l;return this[o]?(h(this,o,this[l]),r&&r.stateProperties&&h(this,o,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var l=r.propertySet||n;return r.propertySet=l,this["_"+l]={},this.saveState(r),this}})}(),function(){var a=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(n,h){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u=n.x,r=n.y,l,o,d=Object.keys(this.oCoords),p=d.length-1,c;for(this.__corner=0;p>=0;p--)if(c=d[p],!!this.isControlVisible(c)&&(o=this._getImageLines(h?this.oCoords[c].touchCorner:this.oCoords[c].corner),l=this._findCrossPoints({x:u,y:r},o),l!==0&&l%2===1))return this.__corner=c,c;return!1},forEachControl:function(n){for(var h in this.controls)n(this.controls[h],h,this)},_setCornerCoords:function(){var n=this.oCoords;for(var h in n){var u=this.controls[h];n[h].corner=u.calcCornerCoords(this.angle,this.cornerSize,n[h].x,n[h].y,!1),n[h].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,n[h].x,n[h].y,!0)}},drawSelectionBackground:function(n){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;n.save();var h=this.getCenterPoint(),u=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return n.translate(h.x,h.y),n.scale(1/r[0],1/r[3]),n.rotate(a(this.angle)),n.fillStyle=this.selectionBackgroundColor,n.fillRect(-u.x/2,-u.y/2,u.x,u.y),n.restore(),this},drawBorders:function(n,h){h=h||{};var u=this._calculateCurrentDimensions(),r=this.borderScaleFactor,l=u.x+r,o=u.y+r,d=typeof h.hasControls<"u"?h.hasControls:this.hasControls,p=!1;return n.save(),n.strokeStyle=h.borderColor||this.borderColor,this._setLineDash(n,h.borderDashArray||this.borderDashArray),n.strokeRect(-l/2,-o/2,l,o),d&&(n.beginPath(),this.forEachControl(function(c,m,_){c.withConnection&&c.getVisibility(_,m)&&(p=!0,n.moveTo(c.x*l,c.y*o),n.lineTo(c.x*l+c.offsetX,c.y*o+c.offsetY))}),p&&n.stroke()),n.restore(),this},drawBordersInGroup:function(n,h,u){u=u||{};var r=t.util.sizeAfterTransform(this.width,this.height,h),l=this.strokeWidth,o=this.strokeUniform,d=this.borderScaleFactor,p=r.x+l*(o?this.canvas.getZoom():h.scaleX)+d,c=r.y+l*(o?this.canvas.getZoom():h.scaleY)+d;return n.save(),this._setLineDash(n,u.borderDashArray||this.borderDashArray),n.strokeStyle=u.borderColor||this.borderColor,n.strokeRect(-p/2,-c/2,p,c),n.restore(),this},drawControls:function(n,h){h=h||{},n.save();var u=this.canvas.getRetinaScaling(),r,l;return n.setTransform(u,0,0,u,0,0),n.strokeStyle=n.fillStyle=h.cornerColor||this.cornerColor,this.transparentCorners||(n.strokeStyle=h.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(n,h.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(o,d,p){l=p.oCoords[d],o.getVisibility(p,d)&&(r&&(l=t.util.transformPoint(l,r)),o.render(n,l.x,l.y,h,p))}),n.restore(),this},isControlVisible:function(n){return this.controls[n]&&this.controls[n].getVisibility(this,n)},setControlVisible:function(n,h){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[n]=h,this},setControlsVisibility:function(n){n||(n={});for(var h in n)this.setControlVisible(h,n[h]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,n){n=n||{};var h=function(){},u=n.onComplete||h,r=n.onChange||h,l=this;return t.util.animate({target:this,startValue:a.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(o){a.set("left",o),l.requestRenderAll(),r()},onComplete:function(){a.setCoords(),u()}})},fxCenterObjectV:function(a,n){n=n||{};var h=function(){},u=n.onComplete||h,r=n.onChange||h,l=this;return t.util.animate({target:this,startValue:a.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(o){a.set("top",o),l.requestRenderAll(),r()},onComplete:function(){a.setCoords(),u()}})},fxRemove:function(a,n){n=n||{};var h=function(){},u=n.onComplete||h,r=n.onChange||h,l=this;return t.util.animate({target:this,startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(o){a.set("opacity",o),l.requestRenderAll(),r()},onComplete:function(){l.remove(a),u()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var a=[],n,h,u=[];for(n in arguments[0])a.push(n);for(var r=0,l=a.length;r<l;r++)n=a[r],h=r!==l-1,u.push(this._animate(n,arguments[0][n],arguments[1],h));return u}else return this._animate.apply(this,arguments)},_animate:function(a,n,h,u){var r=this,l;n=n.toString(),h?h=t.util.object.clone(h):h={},~a.indexOf(".")&&(l=a.split("."));var o=r.colorProperties.indexOf(a)>-1||l&&r.colorProperties.indexOf(l[1])>-1,d=l?this.get(l[0])[l[1]]:this.get(a);"from"in h||(h.from=d),o||(~n.indexOf("=")?n=d+parseFloat(n.replace("=","")):n=parseFloat(n));var p={target:this,startValue:h.from,endValue:n,byValue:h.by,easing:h.easing,duration:h.duration,abort:h.abort&&function(c,m,_){return h.abort.call(r,c,m,_)},onChange:function(c,m,_){l?r[l[0]][l[1]]=c:r.set(a,c),!u&&h.onChange&&h.onChange(c,m,_)},onComplete:function(c,m,_){u||(r.setCoords(),h.onComplete&&h.onComplete(c,m,_))}};return o?t.util.animateColor(p.startValue,p.endValue,p.duration,p):t.util.animate(p)}}),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(n.Line){n.warn("fabric.Line is already defined");return}n.Line=n.util.createClass(n.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:n.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(o,d){o||(o=[0,0,0,0]),this.callSuper("initialize",d),this.set("x1",o[0]),this.set("y1",o[1]),this.set("x2",o[2]),this.set("y2",o[3]),this._setWidthHeight(d)},_setWidthHeight:function(o){o||(o={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in o?o.left:this._getLeftToOriginX(),this.top="top"in o?o.top:this._getTopToOriginY()},_set:function(o,d){return this.callSuper("_set",o,d),typeof r[o]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:l({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:l({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(o){o.beginPath();var d=this.calcLinePoints();o.moveTo(d.x1,d.y1),o.lineTo(d.x2,d.y2),o.lineWidth=this.strokeWidth;var p=o.strokeStyle;o.strokeStyle=this.stroke||o.fillStyle,this.stroke&&this._renderStroke(o),o.strokeStyle=p},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(o){return h(this.callSuper("toObject",o),this.calcLinePoints())},_getNonTransformedDimensions:function(){var o=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(o.y-=this.strokeWidth),this.height===0&&(o.x-=this.strokeWidth)),o},calcLinePoints:function(){var o=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,p=o*this.width*.5,c=d*this.height*.5,m=o*this.width*-.5,_=d*this.height*-.5;return{x1:p,x2:m,y1:c,y2:_}},_toSVG:function(){var o=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`" />
`]}}),n.Line.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),n.Line.fromElement=function(o,d,p){p=p||{};var c=n.parseAttributes(o,n.Line.ATTRIBUTE_NAMES),m=[c.x1||0,c.y1||0,c.x2||0,c.y2||0];d(new n.Line(m,h(c,p)))},n.Line.fromObject=function(o,d){function p(m){delete m.points,d&&d(m)}var c=u(o,!0);c.points=[o.x1,o.y1,o.x2,o.y2],n.Object._fromObject("Line",c,p,"points")};function l(o,d){var p=o.origin,c=o.axis1,m=o.axis2,_=o.dimension,b=d.nearest,y=d.center,x=d.farthest;return function(){switch(this.get(p)){case b:return Math.min(this.get(c),this.get(m));case y:return Math.min(this.get(c),this.get(m))+.5*this.get(_);case x:return Math.max(this.get(c),this.get(m))}}}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.degreesToRadians;if(n.Circle){n.warn("fabric.Circle is already defined.");return}n.Circle=n.util.createClass(n.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:n.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,l){return this.callSuper("_set",r,l),r==="radius"&&this.setRadius(l),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,l=0,o=0,d=(this.endAngle-this.startAngle)%360;if(d===0)r=["<circle ","COMMON_PARTS",'cx="'+l+'" cy="'+o+'" ','r="',this.radius,`" />
`];else{var p=h(this.startAngle),c=h(this.endAngle),m=this.radius,_=n.util.cos(p)*m,b=n.util.sin(p)*m,y=n.util.cos(c)*m,x=n.util.sin(c)*m,C=d>180?"1":"0";r=['<path d="M '+_+" "+b," A "+m+" "+m," 0 ",+C+" 1"," "+y+" "+x,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,h(this.startAngle),h(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),n.Circle.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),n.Circle.fromElement=function(r,l){var o=n.parseAttributes(r,n.Circle.ATTRIBUTE_NAMES);if(!u(o))throw new Error("value of `r` attribute is required and can not be negative");o.left=(o.left||0)-o.radius,o.top=(o.top||0)-o.radius,l(new n.Circle(o))};function u(r){return"radius"in r&&r.radius>=0}n.Circle.fromObject=function(r,l){n.Object._fromObject("Circle",r,l)}}(i),function(a){var n=a.fabric||(a.fabric={});if(n.Triangle){n.warn("fabric.Triangle is already defined");return}n.Triangle=n.util.createClass(n.Object,{type:"triangle",width:100,height:100,_render:function(h){var u=this.width/2,r=this.height/2;h.beginPath(),h.moveTo(-u,r),h.lineTo(0,-r),h.lineTo(u,r),h.closePath(),this._renderPaintInOrder(h)},_toSVG:function(){var h=this.width/2,u=this.height/2,r=[-h+" "+u,"0 "+-u,h+" "+u].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),n.Triangle.fromObject=function(h,u){return n.Object._fromObject("Triangle",h,u)}}(i),function(a){var n=a.fabric||(a.fabric={}),h=Math.PI*2;if(n.Ellipse){n.warn("fabric.Ellipse is already defined.");return}n.Ellipse=n.util.createClass(n.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,r){switch(this.callSuper("_set",u,r),u){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,h,!1),u.restore(),this._renderPaintInOrder(u)}}),n.Ellipse.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),n.Ellipse.fromElement=function(u,r){var l=n.parseAttributes(u,n.Ellipse.ATTRIBUTE_NAMES);l.left=(l.left||0)-l.rx,l.top=(l.top||0)-l.ry,r(new n.Ellipse(l))},n.Ellipse.fromObject=function(u,r){n.Object._fromObject("Ellipse",u,r)}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend;if(n.Rect){n.warn("fabric.Rect is already defined");return}n.Rect=n.util.createClass(n.Object,{stateProperties:n.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var r=this.rx?Math.min(this.rx,this.width/2):0,l=this.ry?Math.min(this.ry,this.height/2):0,o=this.width,d=this.height,p=-this.width/2,c=-this.height/2,m=r!==0||l!==0,_=1-.5522847498;u.beginPath(),u.moveTo(p+r,c),u.lineTo(p+o-r,c),m&&u.bezierCurveTo(p+o-_*r,c,p+o,c+_*l,p+o,c+l),u.lineTo(p+o,c+d-l),m&&u.bezierCurveTo(p+o,c+d-_*l,p+o-_*r,c+d,p+o-r,c+d),u.lineTo(p+r,c+d),m&&u.bezierCurveTo(p+_*r,c+d,p,c+d-_*l,p,c+d-l),u.lineTo(p,c+l),m&&u.bezierCurveTo(p,c+_*l,p+_*r,c,p+r,c),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){var u=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',u,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),n.Rect.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),n.Rect.fromElement=function(u,r,l){if(!u)return r(null);l=l||{};var o=n.parseAttributes(u,n.Rect.ATTRIBUTE_NAMES);o.left=o.left||0,o.top=o.top||0,o.height=o.height||0,o.width=o.width||0;var d=new n.Rect(h(l?n.util.object.clone(l):{},o));d.visible=d.visible&&d.width>0&&d.height>0,r(d)},n.Rect.fromObject=function(u,r){return n.Object._fromObject("Rect",u,r)}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.util.array.min,r=n.util.array.max,l=n.util.toFixed,o=n.util.projectStrokeOnPoints;if(n.Polyline){n.warn("fabric.Polyline is already defined");return}n.Polyline=n.util.createClass(n.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:n.Object.prototype.cacheProperties.concat("points"),initialize:function(d,p){p=p||{},this.points=d||[],this.callSuper("initialize",p),this._setPositionDimensions(p)},_projectStrokeOnPoints:function(){return o(this.points,this,!0)},_setPositionDimensions:function(d){var p=this._calcDimensions(d),c,m=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-m,this.height=p.height-m,d.fromSVG||(c=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+m/2,y:p.top-this.strokeWidth/2+m/2},"left","top",this.originX,this.originY)),typeof d.left>"u"&&(this.left=d.fromSVG?p.left:c.x),typeof d.top>"u"&&(this.top=d.fromSVG?p.top:c.y),this.pathOffset={x:p.left+this.width/2+m/2,y:p.top+this.height/2+m/2}},_calcDimensions:function(){var d=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,p=u(d,"x")||0,c=u(d,"y")||0,m=r(d,"x")||0,_=r(d,"y")||0,b=m-p,y=_-c;return{left:p,top:c,width:b,height:y}},toObject:function(d){return h(this.callSuper("toObject",d),{points:this.points.concat()})},_toSVG:function(){for(var d=[],p=this.pathOffset.x,c=this.pathOffset.y,m=n.Object.NUM_FRACTION_DIGITS,_=0,b=this.points.length;_<b;_++)d.push(l(this.points[_].x-p,m),",",l(this.points[_].y-c,m)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',d.join(""),`" />
`]},commonRender:function(d){var p,c=this.points.length,m=this.pathOffset.x,_=this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;d.beginPath(),d.moveTo(this.points[0].x-m,this.points[0].y-_);for(var b=0;b<c;b++)p=this.points[b],d.lineTo(p.x-m,p.y-_);return!0},_render:function(d){this.commonRender(d)&&this._renderPaintInOrder(d)},complexity:function(){return this.get("points").length}}),n.Polyline.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polyline.fromElementGenerator=function(d){return function(p,c,m){if(!p)return c(null);m||(m={});var _=n.parsePointsAttribute(p.getAttribute("points")),b=n.parseAttributes(p,n[d].ATTRIBUTE_NAMES);b.fromSVG=!0,c(new n[d](_,h(b,m)))}},n.Polyline.fromElement=n.Polyline.fromElementGenerator("Polyline"),n.Polyline.fromObject=function(d,p){return n.Object._fromObject("Polyline",d,p,"points")}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.projectStrokeOnPoints;if(n.Polygon){n.warn("fabric.Polygon is already defined");return}n.Polygon=n.util.createClass(n.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return h(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),n.Polygon.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polygon.fromElement=n.Polyline.fromElementGenerator("Polygon"),n.Polygon.fromObject=function(u,r){n.Object._fromObject("Polygon",u,r,"points")}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.array.min,u=n.util.array.max,r=n.util.object.extend,l=n.util.object.clone,o=n.util.toFixed;if(n.Path){n.warn("fabric.Path is already defined");return}n.Path=n.util.createClass(n.Object,{type:"path",path:null,cacheProperties:n.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:n.Object.prototype.stateProperties.concat("path"),initialize:function(d,p){p=l(p||{}),delete p.path,this.callSuper("initialize",p),this._setPath(d||[],p)},_setPath:function(d,p){this.path=n.util.makePathSimpler(Array.isArray(d)?d:n.util.parsePath(d)),n.Polyline.prototype._setPositionDimensions.call(this,p||{})},_renderPathCommands:function(d){var p,c=0,m=0,_=0,b=0,y=0,x=0,C=-this.pathOffset.x,w=-this.pathOffset.y;d.beginPath();for(var O=0,E=this.path.length;O<E;++O)switch(p=this.path[O],p[0]){case"L":_=p[1],b=p[2],d.lineTo(_+C,b+w);break;case"M":_=p[1],b=p[2],c=_,m=b,d.moveTo(_+C,b+w);break;case"C":_=p[5],b=p[6],y=p[3],x=p[4],d.bezierCurveTo(p[1]+C,p[2]+w,y+C,x+w,_+C,b+w);break;case"Q":d.quadraticCurveTo(p[1]+C,p[2]+w,p[3]+C,p[4]+w),_=p[3],b=p[4],y=p[1],x=p[2];break;case"z":case"Z":_=c,b=m,d.closePath();break}},_render:function(d){this._renderPathCommands(d),this._renderPaintInOrder(d)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(d){return r(this.callSuper("toObject",d),{path:this.path.map(function(p){return p.slice()})})},toDatalessObject:function(d){var p=this.toObject(["sourcePath"].concat(d));return p.sourcePath&&delete p.path,p},_toSVG:function(){var d=n.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',d,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var d=n.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,d)+", "+o(-this.pathOffset.y,d)+")"},toClipPathSVG:function(d){var p=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},toSVG:function(d){var p=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var d=[],p=[],c,m=0,_=0,b=0,y=0,x,C=0,w=this.path.length;C<w;++C){switch(c=this.path[C],c[0]){case"L":b=c[1],y=c[2],x=[];break;case"M":b=c[1],y=c[2],m=b,_=y,x=[];break;case"C":x=n.util.getBoundsOfCurve(b,y,c[1],c[2],c[3],c[4],c[5],c[6]),b=c[5],y=c[6];break;case"Q":x=n.util.getBoundsOfCurve(b,y,c[1],c[2],c[1],c[2],c[3],c[4]),b=c[3],y=c[4];break;case"z":case"Z":b=m,y=_;break}x.forEach(function(K){d.push(K.x),p.push(K.y)}),d.push(b),p.push(y)}var O=h(d)||0,E=h(p)||0,j=u(d)||0,H=u(p)||0,q=j-O,Q=H-E;return{left:O,top:E,width:q,height:Q}}}),n.Path.fromObject=function(d,p){if(typeof d.sourcePath=="string"){var c=d.sourcePath;n.loadSVGFromURL(c,function(m){var _=m[0];_.setOptions(d),d.clipPath?n.util.enlivenObjects([d.clipPath],function(b){_.clipPath=b[0],p&&p(_)}):p&&p(_)})}else n.Object._fromObject("Path",d,p,"path")},n.Path.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(["d"]),n.Path.fromElement=function(d,p,c){var m=n.parseAttributes(d,n.Path.ATTRIBUTE_NAMES);m.fromSVG=!0,p(new n.Path(m.d,r(m,c)))}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.array.min,u=n.util.array.max;n.Group||(n.Group=n.util.createClass(n.Object,n.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,l,o){l=l||{},this._objects=[],o&&this.callSuper("initialize",l),this._objects=r||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(o)this._updateObjectsACoords();else{var p=l&&l.centerPoint;l.originX!==void 0&&(this.originX=l.originX),l.originY!==void 0&&(this.originY=l.originY),p||this._calcBounds(),this._updateObjectsCoords(p),delete l.centerPoint,this.callSuper("initialize",l)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,l=this._objects.length;l--;)this._objects[l].setCoords(r)},_updateObjectsCoords:function(l){for(var l=l||this.getCenterPoint(),o=this._objects.length;o--;)this._updateObjectCoords(this._objects[o],l)},_updateObjectCoords:function(r,l){var o=r.left,d=r.top,p=!0;r.set({left:o-l.x,top:d-l.y}),r.group=this,r.setCoords(p)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var l=!!this.group;return this._restoreObjectsState(),n.util.resetObjectTransform(this),r&&(l&&n.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,l?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),n.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,l){var o=this._objects.length;if(this.useSetOnGroup)for(;o--;)this._objects[o].setOnGroup(r,l);if(r==="canvas")for(;o--;)this._objects[o]._set(r,l);n.Object.prototype._set.call(this,r,l)},toObject:function(r){var l=this.includeDefaultValues,o=this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){var c=p.includeDefaultValues;p.includeDefaultValues=l;var m=p.toObject(r);return p.includeDefaultValues=c,m}),d=n.Object.prototype.toObject.call(this,r);return d.objects=o,d},toDatalessObject:function(r){var l,o=this.sourcePath;if(o)l=o;else{var d=this.includeDefaultValues;l=this._objects.map(function(c){var m=c.includeDefaultValues;c.includeDefaultValues=d;var _=c.toDatalessObject(r);return c.includeDefaultValues=m,_})}var p=n.Object.prototype.toDatalessObject.call(this,r);return p.objects=l,p},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=n.Object.prototype.shouldCache.call(this);if(r){for(var l=0,o=this._objects.length;l<o;l++)if(this._objects[l].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(n.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,l=this._objects.length;r<l;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var l=0,o=this._objects.length;l<o;l++)this._objects[l].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var l=0,o=this._objects.length;l<o;l++)if(this._objects[l].isCacheDirty(!0)){if(this._cacheCanvas){var d=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-p/2,d,p)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(l){n.util.addTransformToObject(l,r),delete l.group,l.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,l=this.canvas;this._objects=[];var o=this.toObject();delete o.objects;var d=new n.ActiveSelection([]);return d.set(o),d.type="activeSelection",l.remove(this),r.forEach(function(p){p.group=d,p.dirty=!0,l.add(p)}),d.canvas=l,d._objects=r,l._activeObject=d,d.setCoords(),d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(l){l.setCoords(r)}),this},_calcBounds:function(r){for(var l=[],o=[],d,p,c,m=["tr","br","bl","tl"],_=0,b=this._objects.length,y,x=m.length;_<b;++_){for(d=this._objects[_],c=d.calcACoords(),y=0;y<x;y++)p=m[y],l.push(c[p].x),o.push(c[p].y);d.aCoords=c}this._getBounds(l,o,r)},_getBounds:function(r,l,o){var d=new n.Point(h(r),h(l)),p=new n.Point(u(r),u(l)),c=d.y||0,m=d.x||0,_=p.x-d.x||0,b=p.y-d.y||0;this.width=_,this.height=b,o||this.setPositionByOrigin({x:m,y:c},"left","top")},_toSVG:function(r){for(var l=["<g ","COMMON_PARTS",` >
`],o=0,d=this._objects.length;o<d;o++)l.push("		",this._objects[o].toSVG(r));return l.push(`</g>
`),l},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",l=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),l].join("")},toClipPathSVG:function(r){for(var l=[],o=0,d=this._objects.length;o<d;o++)l.push("	",this._objects[o].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(l,{reviver:r})}}),n.Group.fromObject=function(r,l){var o=r.objects,d=n.util.object.clone(r,!0);if(delete d.objects,typeof o=="string"){n.loadSVGFromURL(o,function(p){var c=n.util.groupSVGElements(p,r,o),m=d.clipPath;delete d.clipPath,c.set(d),m?n.util.enlivenObjects([m],function(_){c.clipPath=_[0],l&&l(c)}):l&&l(c)});return}n.util.enlivenObjects(o,function(p){n.util.enlivenObjectEnlivables(r,d,function(){l&&l(new n.Group(p,d,!0))})})})}(i),function(a){var n=a.fabric||(a.fabric={});n.ActiveSelection||(n.ActiveSelection=n.util.createClass(n.Group,{type:"activeSelection",initialize:function(h,u){u=u||{},this._objects=h||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),n.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var h=this._objects.concat();this._objects=[];var u=n.Object.prototype.toObject.call(this),r=new n.Group([]);if(delete u.type,r.set(u),h.forEach(function(o){o.canvas.remove(o),o.group=r}),r._objects=h,!this.canvas)return r;var l=this.canvas;return l.add(r),l._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(h,u,r){h.save(),h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",h,u),r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var l=0,o=this._objects.length;l<o;l++)this._objects[l]._renderControls(h,r);h.restore()}}),n.ActiveSelection.fromObject=function(h,u){n.util.enlivenObjects(h.objects,function(r){delete h.objects,u&&u(new n.ActiveSelection(r,h,!0))})})}(i),function(a){var n=t.util.object.extend;if(a.fabric||(a.fabric={}),a.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(h,u){u||(u={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",u),this._initElement(h,u)},getElement:function(){return this._element||{}},setElement:function(h,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=h,this._originalElement=h,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(h){var u=t.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(h)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(h){t.util.cleanUpJsdomNode(this[h]),this[h]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var h=this.getElement();return{width:h.naturalWidth||h.width,height:h.naturalHeight||h.height}},_stroke:function(h){if(!(!this.stroke||this.strokeWidth===0)){var u=this.width/2,r=this.height/2;h.beginPath(),h.moveTo(-u,-r),h.lineTo(u,-r),h.lineTo(u,r),h.lineTo(-u,r),h.lineTo(-u,-r),h.closePath()}},toObject:function(h){var u=[];this.filters.forEach(function(l){l&&u.push(l.toObject())});var r=n(this.callSuper("toObject",["cropX","cropY"].concat(h)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var h=[],u=[],r,l=this._element,o=-this.width/2,d=-this.height/2,p="",c="";if(!l)return[];if(this.hasCrop()){var m=t.Object.__uid++;h.push('<clipPath id="imageCrop_'+m+`">
`,'	<rect x="'+o+'" y="'+d+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),p=' clip-path="url(#imageCrop_'+m+')" '}if(this.imageSmoothing||(c='" image-rendering="optimizeSpeed'),u.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',o-this.cropX,'" y="',d-this.cropY,'" width="',l.width||l.naturalWidth,'" height="',l.height||l.height,c,'"',p,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,r=["	<rect ",'x="',o,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?h=h.concat(r,u):h=h.concat(u,r),h},getSrc:function(h){var u=h?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(h,u,r){return t.util.loadImage(h,function(l,o){this.setElement(l,r),this._setWidthHeight(),u&&u(this,o)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var h=this.resizeFilter,u=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),l=r.scaleX,o=r.scaleY,d=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!h||l>u&&o>u){this._element=d,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=l,this._lastScaleY=o;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var p=t.util.createCanvasElement(),c=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,m=d.width,_=d.height;p.width=m,p.height=_,this._element=p,this._lastScaleX=h.scaleX=l,this._lastScaleY=h.scaleY=o,t.filterBackend.applyFilters([h],d,m,_,this._element,c),this._filterScalingX=p.width/this._originalElement.width,this._filterScalingY=p.height/this._originalElement.height},applyFilters:function(h){if(h=h||this.filters||[],h=h.filter(function(d){return d&&!d.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),h.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,r=u.naturalWidth||u.width,l=u.naturalHeight||u.height;if(this._element===this._originalElement){var o=t.util.createCanvasElement();o.width=r,o.height=l,this._element=o,this._filteredEl=o}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,l),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(h,this._originalElement,r,l,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(h){t.util.setImageSmoothing(h,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(h),this._renderPaintInOrder(h)},drawCacheOnCanvas:function(h){t.util.setImageSmoothing(h,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,h)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(h){var u=this._element;if(u){var r=this._filterScalingX,l=this._filterScalingY,o=this.width,d=this.height,p=Math.min,c=Math.max,m=c(this.cropX,0),_=c(this.cropY,0),b=u.naturalWidth||u.width,y=u.naturalHeight||u.height,x=m*r,C=_*l,w=p(o*r,b-x),O=p(d*l,y-C),E=-o/2,j=-d/2,H=p(o,b/r-m),q=p(d,y/l-_);u&&h.drawImage(u,x,C,w,O,E,j,H,q)}},_needsResize:function(){var h=this.getTotalObjectScaling();return h.scaleX!==this._lastScaleX||h.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(h,u){this.setElement(t.util.getById(h),u),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(h){h||(h={}),this.setOptions(h),this._setWidthHeight(h)},_initFilters:function(h,u){h&&h.length?t.util.enlivenObjects(h,function(r){u&&u(r)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(h){h||(h={});var u=this.getElement();this.width=h.width||u.naturalWidth||u.width||0,this.height=h.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var h=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),u=this._element.width,r=this._element.height,l=1,o=1,d=0,p=0,c=0,m=0,_,b=this.width,y=this.height,x={width:b,height:y};return h&&(h.alignX!=="none"||h.alignY!=="none")?(h.meetOrSlice==="meet"&&(l=o=t.util.findScaleToFit(this._element,x),_=(b-u*l)/2,h.alignX==="Min"&&(d=-_),h.alignX==="Max"&&(d=_),_=(y-r*o)/2,h.alignY==="Min"&&(p=-_),h.alignY==="Max"&&(p=_)),h.meetOrSlice==="slice"&&(l=o=t.util.findScaleToCover(this._element,x),_=u-b/l,h.alignX==="Mid"&&(c=_/2),h.alignX==="Max"&&(c=_),_=r-y/o,h.alignY==="Mid"&&(m=_/2),h.alignY==="Max"&&(m=_),u=b/l,r=y/o)):(l=b/u,o=y/r),{width:u,height:r,scaleX:l,scaleY:o,offsetLeft:d,offsetTop:p,cropX:c,cropY:m}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(h,u){var r=t.util.object.clone(h);t.util.loadImage(r.src,function(l,o){if(o){u&&u(null,!0);return}t.Image.prototype._initFilters.call(r,r.filters,function(d){r.filters=d||[],t.Image.prototype._initFilters.call(r,[r.resizeFilter],function(p){r.resizeFilter=p[0],t.util.enlivenObjectEnlivables(r,r,function(){var c=new t.Image(l,r);u(c,!1)})})})},null,r.crossOrigin)},t.Image.fromURL=function(h,u,r){t.util.loadImage(h,function(l,o){u&&u(new t.Image(l,r),o)},null,r&&r.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(h,u,r){var l=t.parseAttributes(h,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(l["xlink:href"],u,n(r?t.util.object.clone(r):{},l))}}(i),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;return a>0?Math.round((a-1)/90)*90:Math.round(a/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(a){a=a||{};var n=function(){},h=a.onComplete||n,u=a.onChange||n,r=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(l){r.rotate(l),u()},onComplete:function(){r.setCoords(),h()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function a(h,u){var r="precision "+u+` float;
void main(){}`,l=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(l,r),h.compileShader(l),!!h.getShaderParameter(l,h.COMPILE_STATUS)}t.isWebglSupported=function(h){if(t.isLikelyNode)return!1;h=h||t.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),r=u.getContext("webgl")||u.getContext("experimental-webgl"),l=!1;if(r){t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),l=t.maxTextureSize>=h;for(var o=["highp","mediump","lowp"],d=0;d<3;d++)if(a(r,o[d])){t.webGlPrecision=o[d];break}}return this.isSupported=l,l},t.WebglFilterBackend=n;function n(h){h&&h.tileSize&&(this.tileSize=h.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}n.prototype={tileSize:2048,resources:{},setupGLContext:function(h,u){this.dispose(),this.createWebGLCanvas(h,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(h,u)},chooseFastestCopyGLTo2DMethod:function(h,u){var r=typeof window.performance<"u",l;try{new ImageData(1,1),l=!0}catch{l=!1}var o=typeof ArrayBuffer<"u",d=typeof Uint8ClampedArray<"u";if(r&&l&&o&&d){var p=t.util.createCanvasElement(),c=new ArrayBuffer(h*u*4);if(t.forceGLPutImageData){this.imageBuffer=c,this.copyGLTo2D=v;return}var m={imageBuffer:c,destinationWidth:h,destinationHeight:u,targetCanvas:p},_,b,y;p.width=h,p.height=u,_=window.performance.now(),g.call(m,this.gl,m),b=window.performance.now()-_,_=window.performance.now(),v.call(m,this.gl,m),y=window.performance.now()-_,b>y?(this.imageBuffer=c,this.copyGLTo2D=v):this.copyGLTo2D=g}},createWebGLCanvas:function(h,u){var r=t.util.createCanvasElement();r.width=h,r.height=u;var l={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},o=r.getContext("webgl",l);o||(o=r.getContext("experimental-webgl",l)),o&&(o.clearColor(0,0,0,0),this.canvas=r,this.gl=o)},applyFilters:function(h,u,r,l,o,d){var p=this.gl,c;d&&(c=this.getCachedTexture(d,u));var m={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:r,sourceHeight:l,destinationWidth:r,destinationHeight:l,context:p,sourceTexture:this.createTexture(p,r,l,!c&&u),targetTexture:this.createTexture(p,r,l),originalTexture:c||this.createTexture(p,r,l,!c&&u),passes:h.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:o},_=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,_),h.forEach(function(b){b&&b.applyTo(m)}),f(m),this.copyGLTo2D(p,m),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(m.sourceTexture),p.deleteTexture(m.targetTexture),p.deleteFramebuffer(_),o.getContext("2d").setTransform(1,0,0,1,0,0),m},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(h,u,r,l,o){var d=h.createTexture();return h.bindTexture(h.TEXTURE_2D,d),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,o||h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,o||h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),l?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,l):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,u,r,0,h.RGBA,h.UNSIGNED_BYTE,null),d},getCachedTexture:function(h,u){if(this.textureCache[h])return this.textureCache[h];var r=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[h]=r,r},evictCachesForKey:function(h){this.textureCache[h]&&(this.gl.deleteTexture(this.textureCache[h]),delete this.textureCache[h])},copyGLTo2D:g,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var h=this.gl,u={renderer:"",vendor:""};if(!h)return u;var r=h.getExtension("WEBGL_debug_renderer_info");if(r){var l=h.getParameter(r.UNMASKED_RENDERER_WEBGL),o=h.getParameter(r.UNMASKED_VENDOR_WEBGL);l&&(u.renderer=l.toLowerCase()),o&&(u.vendor=o.toLowerCase())}return this.gpuInfo=u,u}}}();function f(a){var n=a.targetCanvas,h=n.width,u=n.height,r=a.destinationWidth,l=a.destinationHeight;(h!==r||u!==l)&&(n.width=r,n.height=l)}function g(a,n){var h=a.canvas,u=n.targetCanvas,r=u.getContext("2d");r.translate(0,u.height),r.scale(1,-1);var l=h.height-u.height;r.drawImage(h,0,l,u.width,u.height,0,0,u.width,u.height)}function v(a,n){var h=n.targetCanvas,u=h.getContext("2d"),r=n.destinationWidth,l=n.destinationHeight,o=r*l*4,d=new Uint8Array(this.imageBuffer,0,o),p=new Uint8ClampedArray(this.imageBuffer,0,o);a.readPixels(0,0,r,l,a.RGBA,a.UNSIGNED_BYTE,d);var c=new ImageData(p,r,l);u.putImageData(c,0,0)}(function(){var a=function(){};t.Canvas2dFilterBackend=n;function n(){}n.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(h,u,r,l,o){var d=o.getContext("2d");d.drawImage(u,0,0,r,l);var p=d.getImageData(0,0,r,l),c=d.getImageData(0,0,r,l),m={sourceWidth:r,sourceHeight:l,imageData:p,originalEl:u,originalImageData:c,canvasEl:o,ctx:d,filterBackend:this};return h.forEach(function(_){_.applyTo(m)}),(m.imageData.width!==r||m.imageData.height!==l)&&(o.width=m.imageData.width,o.height=m.imageData.height),d.putImageData(m.imageData,0,0),m}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var n in a)this[n]=a[n]},createProgram:function(a,n,h){n=n||this.fragmentSource,h=h||this.vertexSource,t.webGlPrecision!=="highp"&&(n=n.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var u=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(u,h),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+a.getShaderInfoLog(u));var r=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(r,n),a.compileShader(r),!a.getShaderParameter(r,a.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+a.getShaderInfoLog(r));var l=a.createProgram();if(a.attachShader(l,u),a.attachShader(l,r),a.linkProgram(l),!a.getProgramParameter(l,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(l));var o=this.getAttributeLocations(a,l),d=this.getUniformLocations(a,l)||{};return d.uStepW=a.getUniformLocation(l,"uStepW"),d.uStepH=a.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:o,uniformLocations:d}},getAttributeLocations:function(a,n){return{aPosition:a.getAttribLocation(n,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(a,n,h){var u=n.aPosition,r=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r),a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,h,a.STATIC_DRAW)},_setupFrameBuffer:function(a){var n=a.context,h,u;a.passes>1?(h=a.destinationWidth,u=a.destinationHeight,(a.sourceWidth!==h||a.sourceHeight!==u)&&(n.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(n,h,u)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(a){a.passes--,a.pass++;var n=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=n},isNeutralState:function(){var a=this.mainParameter,n=t.Image.filters[this.type].prototype;if(a)if(Array.isArray(n[a])){for(var h=n[a].length;h--;)if(this[a][h]!==n[a][h])return!1;return!0}else return n[a]===this[a];else return!1},applyTo:function(a){a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var n=a.context,h=this.retrieveShader(a);a.pass===0&&a.originalTexture?n.bindTexture(n.TEXTURE_2D,a.originalTexture):n.bindTexture(n.TEXTURE_2D,a.sourceTexture),n.useProgram(h.program),this.sendAttributeData(n,h.attributeLocations,a.aPosition),n.uniform1f(h.uniformLocations.uStepW,1/a.sourceWidth),n.uniform1f(h.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(n,h.uniformLocations),n.viewport(0,0,a.destinationWidth,a.destinationHeight),n.drawArrays(n.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,n,h){a.activeTexture(h),a.bindTexture(a.TEXTURE_2D,n),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,n){a.activeTexture(n),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var n=document.createElement("canvas");n.width=a.sourceWidth,n.height=a.sourceHeight,a.helpLayer=n}},toObject:function(){var a={type:this.type},n=this.mainParameter;return n&&(a[n]=this[n]),a},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(a,n){var h=new t.Image.filters[a.type](a);return n&&n(h),h},function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.ColorMatrix=u(h.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var l=r.imageData,o=l.data,d=o.length,p=this.matrix,c,m,_,b,y,x=this.colorsOnly;for(y=0;y<d;y+=4)c=o[y],m=o[y+1],_=o[y+2],x?(o[y]=c*p[0]+m*p[1]+_*p[2]+p[4]*255,o[y+1]=c*p[5]+m*p[6]+_*p[7]+p[9]*255,o[y+2]=c*p[10]+m*p[11]+_*p[12]+p[14]*255):(b=o[y+3],o[y]=c*p[0]+m*p[1]+_*p[2]+b*p[3]+p[4]*255,o[y+1]=c*p[5]+m*p[6]+_*p[7]+b*p[8]+p[9]*255,o[y+2]=c*p[10]+m*p[11]+_*p[12]+b*p[13]+p[14]*255,o[y+3]=c*p[15]+m*p[16]+_*p[17]+b*p[18]+p[19]*255)},getUniformLocations:function(r,l){return{uColorMatrix:r.getUniformLocation(l,"uColorMatrix"),uConstants:r.getUniformLocation(l,"uConstants")}},sendUniformData:function(r,l){var o=this.matrix,d=[o[0],o[1],o[2],o[3],o[5],o[6],o[7],o[8],o[10],o[11],o[12],o[13],o[15],o[16],o[17],o[18]],p=[o[4],o[9],o[14],o[19]];r.uniformMatrix4fv(l.uColorMatrix,!1,d),r.uniform4fv(l.uConstants,p)}}),n.Image.filters.ColorMatrix.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Brightness=u(h.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var l=r.imageData,o=l.data,d,p=o.length,c=Math.round(this.brightness*255);for(d=0;d<p;d+=4)o[d]=o[d]+c,o[d+1]=o[d+1]+c,o[d+2]=o[d+2]+c}},getUniformLocations:function(r,l){return{uBrightness:r.getUniformLocation(l,"uBrightness")}},sendUniformData:function(r,l){r.uniform1f(l.uBrightness,this.brightness)}}),n.Image.filters.Brightness.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.Convolute=r(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(l){var o=Math.sqrt(this.matrix.length),d=this.type+"_"+o+"_"+(this.opaque?1:0),p=this.fragmentSource[d];return l.programCache.hasOwnProperty(d)||(l.programCache[d]=this.createProgram(l.context,p)),l.programCache[d]},applyTo2d:function(l){var o=l.imageData,d=o.data,p=this.matrix,c=Math.round(Math.sqrt(p.length)),m=Math.floor(c/2),_=o.width,b=o.height,y=l.ctx.createImageData(_,b),x=y.data,C=this.opaque?1:0,w,O,E,j,H,q,Q,K,G,Z,et,it,S;for(et=0;et<b;et++)for(Z=0;Z<_;Z++){for(H=(et*_+Z)*4,w=0,O=0,E=0,j=0,S=0;S<c;S++)for(it=0;it<c;it++)Q=et+S-m,q=Z+it-m,!(Q<0||Q>=b||q<0||q>=_)&&(K=(Q*_+q)*4,G=p[S*c+it],w+=d[K]*G,O+=d[K+1]*G,E+=d[K+2]*G,C||(j+=d[K+3]*G));x[H]=w,x[H+1]=O,x[H+2]=E,C?x[H+3]=d[H+3]:x[H+3]=j}l.imageData=y},getUniformLocations:function(l,o){return{uMatrix:l.getUniformLocation(o,"uMatrix"),uOpaque:l.getUniformLocation(o,"uOpaque"),uHalfSize:l.getUniformLocation(o,"uHalfSize"),uSize:l.getUniformLocation(o,"uSize")}},sendUniformData:function(l,o){l.uniform1fv(o.uMatrix,this.matrix)},toObject:function(){return h(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),n.Image.filters.Convolute.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Grayscale=u(h.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var l=r.imageData,o=l.data,d,p=o.length,c,m=this.mode;for(d=0;d<p;d+=4)m==="average"?c=(o[d]+o[d+1]+o[d+2])/3:m==="lightness"?c=(Math.min(o[d],o[d+1],o[d+2])+Math.max(o[d],o[d+1],o[d+2]))/2:m==="luminosity"&&(c=.21*o[d]+.72*o[d+1]+.07*o[d+2]),o[d]=c,o[d+1]=c,o[d+2]=c},retrieveShader:function(r){var l=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(l)){var o=this.fragmentSource[this.mode];r.programCache[l]=this.createProgram(r.context,o)}return r.programCache[l]},getUniformLocations:function(r,l){return{uMode:r.getUniformLocation(l,"uMode")}},sendUniformData:function(r,l){var o=1;r.uniform1i(l.uMode,o)},isNeutralState:function(){return!1}}),n.Image.filters.Grayscale.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Invert=u(h.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var l=r.imageData,o=l.data,d,p=o.length;for(d=0;d<p;d+=4)o[d]=255-o[d],o[d+1]=255-o[d+1],o[d+2]=255-o[d+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,l){return{uInvert:r.getUniformLocation(l,"uInvert")}},sendUniformData:function(r,l){r.uniform1i(l.uInvert,this.invert)}}),n.Image.filters.Invert.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.Noise=r(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(l){if(this.noise!==0){var o=l.imageData,d=o.data,p,c=d.length,m=this.noise,_;for(p=0,c=d.length;p<c;p+=4)_=(.5-Math.random())*m,d[p]+=_,d[p+1]+=_,d[p+2]+=_}},getUniformLocations:function(l,o){return{uNoise:l.getUniformLocation(o,"uNoise"),uSeed:l.getUniformLocation(o,"uSeed")}},sendUniformData:function(l,o){l.uniform1f(o.uNoise,this.noise/255),l.uniform1f(o.uSeed,Math.random())},toObject:function(){return h(this.callSuper("toObject"),{noise:this.noise})}}),n.Image.filters.Noise.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Pixelate=u(h.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var l=r.imageData,o=l.data,d=l.height,p=l.width,c,m,_,b,y,x,C,w,O,E,j;for(m=0;m<d;m+=this.blocksize)for(_=0;_<p;_+=this.blocksize)for(c=m*4*p+_*4,b=o[c],y=o[c+1],x=o[c+2],C=o[c+3],E=Math.min(m+this.blocksize,d),j=Math.min(_+this.blocksize,p),w=m;w<E;w++)for(O=_;O<j;O++)c=w*4*p+O*4,o[c]=b,o[c+1]=y,o[c+2]=x,o[c+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,l){return{uBlocksize:r.getUniformLocation(l,"uBlocksize"),uStepW:r.getUniformLocation(l,"uStepW"),uStepH:r.getUniformLocation(l,"uStepH")}},sendUniformData:function(r,l){r.uniform1f(l.uBlocksize,this.blocksize)}}),n.Image.filters.Pixelate.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.RemoveColor=r(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(l){var o=l.imageData,d=o.data,p,c=this.distance*255,m,_,b,y=new n.Color(this.color).getSource(),x=[y[0]-c,y[1]-c,y[2]-c],C=[y[0]+c,y[1]+c,y[2]+c];for(p=0;p<d.length;p+=4)m=d[p],_=d[p+1],b=d[p+2],m>x[0]&&_>x[1]&&b>x[2]&&m<C[0]&&_<C[1]&&b<C[2]&&(d[p+3]=0)},getUniformLocations:function(l,o){return{uLow:l.getUniformLocation(o,"uLow"),uHigh:l.getUniformLocation(o,"uHigh")}},sendUniformData:function(l,o){var d=new n.Color(this.color).getSource(),p=parseFloat(this.distance),c=[0+d[0]/255-p,0+d[1]/255-p,0+d[2]/255-p,1],m=[d[0]/255+p,d[1]/255+p,d[2]/255+p,1];l.uniform4fv(o.uLow,c),l.uniform4fv(o.uHigh,m)},toObject:function(){return h(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),n.Image.filters.RemoveColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var l in r)h[l]=u(h.ColorMatrix,{type:l,matrix:r[l],mainParameter:!1,colorsOnly:!0}),n.Image.filters[l].fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric,h=n.Image.filters,u=n.util.createClass;h.BlendColor=u(h.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var l=this.type+"_"+this.mode,o;return r.programCache.hasOwnProperty(l)||(o=this.buildSource(this.mode),r.programCache[l]=this.createProgram(r.context,o)),r.programCache[l]},applyTo2d:function(r){var l=r.imageData,o=l.data,d=o.length,p,c,m,_,b,y,x,C=1-this.alpha;x=new n.Color(this.color).getSource(),p=x[0]*this.alpha,c=x[1]*this.alpha,m=x[2]*this.alpha;for(var w=0;w<d;w+=4)switch(_=o[w],b=o[w+1],y=o[w+2],this.mode){case"multiply":o[w]=_*p/255,o[w+1]=b*c/255,o[w+2]=y*m/255;break;case"screen":o[w]=255-(255-_)*(255-p)/255,o[w+1]=255-(255-b)*(255-c)/255,o[w+2]=255-(255-y)*(255-m)/255;break;case"add":o[w]=_+p,o[w+1]=b+c,o[w+2]=y+m;break;case"diff":case"difference":o[w]=Math.abs(_-p),o[w+1]=Math.abs(b-c),o[w+2]=Math.abs(y-m);break;case"subtract":o[w]=_-p,o[w+1]=b-c,o[w+2]=y-m;break;case"darken":o[w]=Math.min(_,p),o[w+1]=Math.min(b,c),o[w+2]=Math.min(y,m);break;case"lighten":o[w]=Math.max(_,p),o[w+1]=Math.max(b,c),o[w+2]=Math.max(y,m);break;case"overlay":o[w]=p<128?2*_*p/255:255-2*(255-_)*(255-p)/255,o[w+1]=c<128?2*b*c/255:255-2*(255-b)*(255-c)/255,o[w+2]=m<128?2*y*m/255:255-2*(255-y)*(255-m)/255;break;case"exclusion":o[w]=p+_-2*p*_/255,o[w+1]=c+b-2*c*b/255,o[w+2]=m+y-2*m*y/255;break;case"tint":o[w]=p+_*C,o[w+1]=c+b*C,o[w+2]=m+y*C}},getUniformLocations:function(r,l){return{uColor:r.getUniformLocation(l,"uColor")}},sendUniformData:function(r,l){var o=new n.Color(this.color).getSource();o[0]=this.alpha*o[0]/255,o[1]=this.alpha*o[1]/255,o[2]=this.alpha*o[2]/255,o[3]=this.alpha,r.uniform4fv(l.uColor,o)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric,h=n.Image.filters,u=n.util.createClass;h.BlendImage=u(h.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var l=this.type+"_"+this.mode,o=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(l)||(r.programCache[l]=this.createProgram(r.context,o)),r.programCache[l]},applyToWebGL:function(r){var l=r.context,o=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(l,o,l.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(l,l.TEXTURE1)},createTexture:function(r,l){return r.getCachedTexture(l.cacheKey,l._element)},calculateMatrix:function(){var r=this.image,l=r._element.width,o=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/l,-r.top/o,1]},applyTo2d:function(r){var l=r.imageData,o=r.filterBackend.resources,d=l.data,p=d.length,c=l.width,m=l.height,_,b,y,x,C,w,O,E,j,H,q=this.image,Q;o.blendImage||(o.blendImage=n.util.createCanvasElement()),j=o.blendImage,H=j.getContext("2d"),j.width!==c||j.height!==m?(j.width=c,j.height=m):H.clearRect(0,0,c,m),H.setTransform(q.scaleX,0,0,q.scaleY,q.left,q.top),H.drawImage(q._element,0,0,c,m),Q=H.getImageData(0,0,c,m).data;for(var K=0;K<p;K+=4)switch(C=d[K],w=d[K+1],O=d[K+2],E=d[K+3],_=Q[K],b=Q[K+1],y=Q[K+2],x=Q[K+3],this.mode){case"multiply":d[K]=C*_/255,d[K+1]=w*b/255,d[K+2]=O*y/255,d[K+3]=E*x/255;break;case"mask":d[K+3]=x;break}},getUniformLocations:function(r,l){return{uTransformMatrix:r.getUniformLocation(l,"uTransformMatrix"),uImage:r.getUniformLocation(l,"uImage")}},sendUniformData:function(r,l){var o=this.calculateMatrix();r.uniform1i(l.uImage,1),r.uniformMatrix3fv(l.uTransformMatrix,!1,o)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendImage.fromObject=function(r,l){n.Image.fromObject(r.image,function(o){var d=n.util.object.clone(r);d.image=o,l(new n.Image.filters.BlendImage(d))})}}(i),function(a){var n=a.fabric||(a.fabric={}),h=Math.pow,u=Math.floor,r=Math.sqrt,l=Math.abs,o=Math.round,d=Math.sin,p=Math.ceil,c=n.Image.filters,m=n.util.createClass;c.Resize=m(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,b){return{uDelta:_.getUniformLocation(b,"uDelta"),uTaps:_.getUniformLocation(b,"uTaps")}},sendUniformData:function(_,b){_.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(b.uTaps,this.taps)},retrieveShader:function(_){var b=this.getFilterWindow(),y=this.type+"_"+b;if(!_.programCache.hasOwnProperty(y)){var x=this.generateShader(b);_.programCache[y]=this.createProgram(_.context,x)}return _.programCache[y]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,y=this.getFilterWindow(),x=new Array(y),C=1;C<=y;C++)x[C-1]=_(C*b);return x},generateShader:function(x){for(var b=new Array(x),y=this.fragmentSourceTOP,x,C=1;C<=x;C++)b[C-1]=C+".0 * uDelta";return y+="uniform float uTaps["+x+`];
`,y+=`void main() {
`,y+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,y+=`  float sum = 1.0;
`,b.forEach(function(w,O){y+="  color += texture2D(uTexture, vTexCoord + "+w+") * uTaps["+O+`];
`,y+="  color += texture2D(uTexture, vTexCoord - "+w+") * uTaps["+O+`];
`,y+="  sum += 2.0 * uTaps["+O+`];
`}),y+=`  gl_FragColor = color / sum;
`,y+="}",y},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(b){if(b>=_||b<=-_)return 0;if(b<11920929e-14&&b>-11920929e-14)return 1;b*=Math.PI;var y=b/_;return d(b)/b*d(y)/y}},applyTo2d:function(_){var b=_.imageData,y=this.scaleX,x=this.scaleY;this.rcpScaleX=1/y,this.rcpScaleY=1/x;var C=b.width,w=b.height,O=o(C*y),E=o(w*x),j;this.resizeType==="sliceHack"?j=this.sliceByTwo(_,C,w,O,E):this.resizeType==="hermite"?j=this.hermiteFastResize(_,C,w,O,E):this.resizeType==="bilinear"?j=this.bilinearFiltering(_,C,w,O,E):this.resizeType==="lanczos"&&(j=this.lanczosResize(_,C,w,O,E)),_.imageData=j},sliceByTwo:function(_,b,y,x,C){var w=_.imageData,O=.5,E=!1,j=!1,H=b*O,q=y*O,Q=n.filterBackend.resources,K,G,Z=0,et=0,it=b,S=0;for(Q.sliceByTwo||(Q.sliceByTwo=document.createElement("canvas")),K=Q.sliceByTwo,(K.width<b*1.5||K.height<y)&&(K.width=b*1.5,K.height=y),G=K.getContext("2d"),G.clearRect(0,0,b*1.5,y),G.putImageData(w,0,0),x=u(x),C=u(C);!E||!j;)b=H,y=q,x<u(H*O)?H=u(H*O):(H=x,E=!0),C<u(q*O)?q=u(q*O):(q=C,j=!0),G.drawImage(K,Z,et,b,y,it,S,H,q),Z=it,et=S,S+=q;return G.getImageData(Z,et,x,C)},lanczosResize:function(_,b,y,x,C){function w(D){var M,I,k,T,A,L,N,R,V,W,J;for(S.x=(D+.5)*q,P.x=u(S.x),M=0;M<C;M++){for(S.y=(M+.5)*Q,P.y=u(S.y),A=0,L=0,N=0,R=0,V=0,I=P.x-Z;I<=P.x+Z;I++)if(!(I<0||I>=b)){W=u(1e3*l(I-S.x)),it[W]||(it[W]={});for(var B=P.y-et;B<=P.y+et;B++)B<0||B>=y||(J=u(1e3*l(B-S.y)),it[W][J]||(it[W][J]=H(r(h(W*K,2)+h(J*G,2))/1e3)),k=it[W][J],k>0&&(T=(B*b+I)*4,A+=k,L+=k*O[T],N+=k*O[T+1],R+=k*O[T+2],V+=k*O[T+3]))}T=(M*x+D)*4,j[T]=L/A,j[T+1]=N/A,j[T+2]=R/A,j[T+3]=V/A}return++D<x?w(D):E}var O=_.imageData.data,E=_.ctx.createImageData(x,C),j=E.data,H=this.lanczosCreate(this.lanczosLobes),q=this.rcpScaleX,Q=this.rcpScaleY,K=2/this.rcpScaleX,G=2/this.rcpScaleY,Z=p(q*this.lanczosLobes/2),et=p(Q*this.lanczosLobes/2),it={},S={},P={};return w(0)},bilinearFiltering:function(_,b,y,x,C){var w,O,E,j,H,q,Q,K,G,Z,et,it,S=0,P,D=this.rcpScaleX,M=this.rcpScaleY,I=4*(b-1),k=_.imageData,T=k.data,A=_.ctx.createImageData(x,C),L=A.data;for(Q=0;Q<C;Q++)for(K=0;K<x;K++)for(H=u(D*K),q=u(M*Q),G=D*K-H,Z=M*Q-q,P=4*(q*b+H),et=0;et<4;et++)w=T[P+et],O=T[P+4+et],E=T[P+I+et],j=T[P+I+4+et],it=w*(1-G)*(1-Z)+O*G*(1-Z)+E*Z*(1-G)+j*G*Z,L[S++]=it;return A},hermiteFastResize:function(_,b,y,x,C){for(var w=this.rcpScaleX,O=this.rcpScaleY,E=p(w/2),j=p(O/2),H=_.imageData,q=H.data,Q=_.ctx.createImageData(x,C),K=Q.data,G=0;G<C;G++)for(var Z=0;Z<x;Z++){for(var et=(Z+G*x)*4,it=0,S=0,P=0,D=0,M=0,I=0,k=0,T=(G+.5)*O,A=u(G*O);A<(G+1)*O;A++)for(var L=l(T-(A+.5))/j,N=(Z+.5)*w,R=L*L,V=u(Z*w);V<(Z+1)*w;V++){var W=l(N-(V+.5))/E,J=r(R+W*W);J>1&&J<-1||(it=2*J*J*J-3*J*J+1,it>0&&(W=4*(V+A*b),k+=it*q[W+3],P+=it,q[W+3]<255&&(it=it*q[W+3]/250),D+=it*q[W],M+=it*q[W+1],I+=it*q[W+2],S+=it))}K[et]=D/S,K[et+1]=M/S,K[et+2]=I/S,K[et+3]=k/P}return Q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),n.Image.filters.Resize.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Contrast=u(h.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var l=r.imageData,o,p,d=l.data,p=d.length,c=Math.floor(this.contrast*255),m=259*(c+255)/(255*(259-c));for(o=0;o<p;o+=4)d[o]=m*(d[o]-128)+128,d[o+1]=m*(d[o+1]-128)+128,d[o+2]=m*(d[o+2]-128)+128}},getUniformLocations:function(r,l){return{uContrast:r.getUniformLocation(l,"uContrast")}},sendUniformData:function(r,l){r.uniform1f(l.uContrast,this.contrast)}}),n.Image.filters.Contrast.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Saturation=u(h.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var l=r.imageData,o=l.data,d=o.length,p=-this.saturation,c,m;for(c=0;c<d;c+=4)m=Math.max(o[c],o[c+1],o[c+2]),o[c]+=m!==o[c]?(m-o[c])*p:0,o[c+1]+=m!==o[c+1]?(m-o[c+1])*p:0,o[c+2]+=m!==o[c+2]?(m-o[c+2])*p:0}},getUniformLocations:function(r,l){return{uSaturation:r.getUniformLocation(l,"uSaturation")}},sendUniformData:function(r,l){r.uniform1f(l.uSaturation,-this.saturation)}}),n.Image.filters.Saturation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Vibrance=u(h.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var l=r.imageData,o=l.data,d=o.length,p=-this.vibrance,c,m,_,b;for(c=0;c<d;c+=4)m=Math.max(o[c],o[c+1],o[c+2]),_=(o[c]+o[c+1]+o[c+2])/3,b=Math.abs(m-_)*2/255*p,o[c]+=m!==o[c]?(m-o[c])*b:0,o[c+1]+=m!==o[c+1]?(m-o[c+1])*b:0,o[c+2]+=m!==o[c+2]?(m-o[c+2])*b:0}},getUniformLocations:function(r,l){return{uVibrance:r.getUniformLocation(l,"uVibrance")}},sendUniformData:function(r,l){r.uniform1f(l.uVibrance,-this.vibrance)}}),n.Image.filters.Vibrance.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Blur=u(h.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var l=r.filterBackend.resources,o,d,p=r.imageData.width,c=r.imageData.height;l.blurLayer1||(l.blurLayer1=n.util.createCanvasElement(),l.blurLayer2=n.util.createCanvasElement()),o=l.blurLayer1,d=l.blurLayer2,(o.width!==p||o.height!==c)&&(d.width=o.width=p,d.height=o.height=c);var m=o.getContext("2d"),_=d.getContext("2d"),b=15,y,x,C,w,O=this.blur*.06*.5;for(m.putImageData(r.imageData,0,0),_.clearRect(0,0,p,c),w=-b;w<=b;w++)y=(Math.random()-.5)/4,x=w/b,C=O*x*p+y,_.globalAlpha=1-Math.abs(x),_.drawImage(o,C,y),m.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);for(w=-b;w<=b;w++)y=(Math.random()-.5)/4,x=w/b,C=O*x*c+y,_.globalAlpha=1-Math.abs(x),_.drawImage(o,y,C),m.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);r.ctx.drawImage(o,0,0);var E=r.ctx.getImageData(0,0,o.width,o.height);return m.globalAlpha=1,m.clearRect(0,0,o.width,o.height),E},getUniformLocations:function(r,l){return{delta:r.getUniformLocation(l,"uDelta")}},sendUniformData:function(r,l){var o=this.chooseRightDelta();r.uniform2fv(l.delta,o)},chooseRightDelta:function(){var r=1,l=[0,0],o;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),o=r*this.blur*.12,this.horizontal?l[0]=o:l[1]=o,l}}),h.Blur.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Gamma=u(h.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],h.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var l=r.imageData,o=l.data,d=this.gamma,p=o.length,c=1/d[0],m=1/d[1],_=1/d[2],b;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),b=0,p=256;b<p;b++)this.rVals[b]=Math.pow(b/255,c)*255,this.gVals[b]=Math.pow(b/255,m)*255,this.bVals[b]=Math.pow(b/255,_)*255;for(b=0,p=o.length;b<p;b+=4)o[b]=this.rVals[o[b]],o[b+1]=this.gVals[o[b+1]],o[b+2]=this.bVals[o[b+2]]},getUniformLocations:function(r,l){return{uGamma:r.getUniformLocation(l,"uGamma")}},sendUniformData:function(r,l){r.uniform3fv(l.uGamma,this.gamma)}}),n.Image.filters.Gamma.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.Composed=u(h.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(l){l.applyTo(r)})},toObject:function(){return n.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),n.Image.filters.Composed.fromObject=function(r,l){var o=r.subFilters||[],d=o.map(function(c){return new n.Image.filters[c.type](c)}),p=new n.Image.filters.Composed({subFilters:d});return l&&l(p),p}}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.Image.filters,u=n.util.createClass;h.HueRotation=u(h.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,l=n.util.cos(r),o=n.util.sin(r),d=1/3,p=Math.sqrt(d)*o,c=1-l;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=l+c/3,this.matrix[1]=d*c-p,this.matrix[2]=d*c+p,this.matrix[5]=d*c+p,this.matrix[6]=l+d*c,this.matrix[7]=d*c-p,this.matrix[10]=d*c-p,this.matrix[11]=d*c+p,this.matrix[12]=l+d*c},isNeutralState:function(r){return this.calculateMatrix(),h.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),h.BaseFilter.prototype.applyTo.call(this,r)}}),n.Image.filters.HueRotation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(a){var n=a.fabric||(a.fabric={}),h=n.util.object.clone;if(n.Text){n.warn("fabric.Text is already defined");return}var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");n.Text=n.util.createClass(n.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:n.Object.prototype.stateProperties.concat(u),cacheProperties:n.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,l){this.styles=l?l.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",l),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=n.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return n._measuringContext||(n._measuringContext=this.canvas&&this.canvas.contextCache||n.util.createCanvasElement().getContext("2d")),n._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,l,o,d,p,c,m,_=0,b=this._textLines.length;_<b;_++)if(!(this.textAlign!=="justify"&&(_===b-1||this.isEndOfWrapping(_)))&&(d=0,p=this._textLines[_],l=this.getLineWidth(_),l<this.width&&(m=this.textLines[_].match(this._reSpacesAndTabs)))){o=m.length,r=(this.width-l)/o;for(var y=0,x=p.length;y<=x;y++)c=this.__charBounds[_][y],this._reSpaceAndTab.test(p[y])?(c.width+=r,c.kernedWidth+=r,c.left+=d,d+=r):c.left+=d}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),l=this.fontSize;return r.width+=l*r.zoomX,r.height+=l*r.zoomY,r},_render:function(r){var l=this.path;l&&!l.isNotVisible()&&l._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,l,o){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(l,o)},calcTextWidth:function(){for(var r=this.getLineWidth(0),l=1,o=this._textLines.length;l<o;l++){var d=this.getLineWidth(l);d>r&&(r=d)}return r},_renderTextLine:function(r,l,o,d,p,c){this._renderChars(r,l,o,d,p,c)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var l,o,d=r.fillStyle,p,c,m=this._getLeftOffset(),_=this._getTopOffset(),b=0,y=0,x,C,w=this.path,O,E=0,j=this._textLines.length;E<j;E++){if(l=this.getHeightOfLine(E),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",E)){_+=l;continue}p=this._textLines[E],o=this._getLineLeftOffset(E),y=0,b=0,c=this.getValueOfPropertyAt(E,0,"textBackgroundColor");for(var H=0,q=p.length;H<q;H++)x=this.__charBounds[E][H],C=this.getValueOfPropertyAt(E,H,"textBackgroundColor"),w?(r.save(),r.translate(x.renderLeft,x.renderTop),r.rotate(x.angle),r.fillStyle=C,C&&r.fillRect(-x.width/2,-l/this.lineHeight*(1-this._fontSizeFraction),x.width,l/this.lineHeight),r.restore()):C!==c?(O=m+o+b,this.direction==="rtl"&&(O=this.width-O-y),r.fillStyle=c,c&&r.fillRect(O,_,y,l/this.lineHeight),b=x.left,y=x.width,c=C):y+=x.kernedWidth;C&&!w&&(O=m+o+b,this.direction==="rtl"&&(O=this.width-O-y),r.fillStyle=C,r.fillRect(O,_,y,l/this.lineHeight)),_+=l}r.fillStyle=d,this._removeShadow(r)}},getFontCache:function(r){var l=r.fontFamily.toLowerCase();n.charWidthsCache[l]||(n.charWidthsCache[l]={});var o=n.charWidthsCache[l],d=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return o[d]||(o[d]={}),o[d]},_measureChar:function(r,l,o,d){var p=this.getFontCache(l),c=this._getFontDeclaration(l),m=this._getFontDeclaration(d),_=o+r,b=c===m,y,x,C,w=l.fontSize/this.CACHE_FONT_SIZE,O;if(o&&p[o]!==void 0&&(C=p[o]),p[r]!==void 0&&(O=y=p[r]),b&&p[_]!==void 0&&(x=p[_],O=x-C),y===void 0||C===void 0||x===void 0){var E=this.getMeasuringContext();this._setTextStyles(E,l,!0)}return y===void 0&&(O=y=E.measureText(r).width,p[r]=y),C===void 0&&b&&o&&(C=E.measureText(o).width,p[o]=C),b&&x===void 0&&(x=E.measureText(_).width,p[_]=x,O=x-C),{width:y*w,kernedWidth:O*w}},getHeightOfChar:function(r,l){return this.getValueOfPropertyAt(r,l,"fontSize")},measureLine:function(r){var l=this._measureLine(r);return this.charSpacing!==0&&(l.width-=this._getWidthOfCharSpacing()),l.width<0&&(l.width=0),l},_measureLine:function(r){var l=0,o,d,p=this._textLines[r],c,m,_=0,b=new Array(p.length),y=0,x,C,w=this.path,O=this.pathSide==="right";for(this.__charBounds[r]=b,o=0;o<p.length;o++)d=p[o],m=this._getGraphemeBox(d,r,o,c),b[o]=m,l+=m.kernedWidth,c=d;if(b[o]={left:m?m.left+m.width:0,width:0,kernedWidth:0,height:this.fontSize},w){switch(C=w.segmentsInfo[w.segmentsInfo.length-1].length,x=n.util.getPointOnPath(w.path,0,w.segmentsInfo),x.x+=w.pathOffset.x,x.y+=w.pathOffset.y,this.textAlign){case"left":y=O?C-l:0;break;case"center":y=(C-l)/2;break;case"right":y=O?0:C-l;break}for(y+=this.pathStartOffset*(O?-1:1),o=O?p.length-1:0;O?o>=0:o<p.length;O?o--:o++)m=b[o],y>C?y%=C:y<0&&(y+=C),this._setGraphemeOnPath(y,m,x),y+=m.kernedWidth}return{width:l,numOfSpaces:_}},_setGraphemeOnPath:function(r,l,o){var d=r+l.kernedWidth/2,p=this.path,c=n.util.getPointOnPath(p.path,d,p.segmentsInfo);l.renderLeft=c.x-o.x,l.renderTop=c.y-o.y,l.angle=c.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,l,o,d,p){var c=this.getCompleteStyleDeclaration(l,o),m=d?this.getCompleteStyleDeclaration(l,o-1):{},_=this._measureChar(r,c,d,m),b=_.kernedWidth,y=_.width,x;this.charSpacing!==0&&(x=this._getWidthOfCharSpacing(),y+=x,b+=x);var C={width:y,left:0,height:c.fontSize,kernedWidth:b,deltaY:c.deltaY};if(o>0&&!p){var w=this.__charBounds[l][o-1];C.left=w.left+w.width+_.kernedWidth-_.width}return C},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var l=this._textLines[r],o=this.getHeightOfChar(r,0),d=1,p=l.length;d<p;d++)o=Math.max(this.getHeightOfChar(r,d),o);return this.__lineHeights[r]=o*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,l=0,o=0,d=this._textLines.length;o<d;o++)r=this.getHeightOfLine(o),l+=o===d-1?r/this.lineHeight:r;return l},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,l){r.save();for(var o=0,d=this._getLeftOffset(),p=this._getTopOffset(),c=0,m=this._textLines.length;c<m;c++){var _=this.getHeightOfLine(c),b=_/this.lineHeight,y=this._getLineLeftOffset(c);this._renderTextLine(l,r,this._textLines[c],d+y,p+o+b,c),o+=_}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,l,o,d,p,c){var m=this.getHeightOfLine(c),_=this.textAlign.indexOf("justify")!==-1,b,y,x="",C,w=0,O,E=this.path,j=!_&&this.charSpacing===0&&this.isEmptyStyles(c)&&!E,H=this.direction==="ltr",q=this.direction==="ltr"?1:-1,Q,K=l.canvas.getAttribute("dir");if(l.save(),K!==this.direction&&(l.canvas.setAttribute("dir",H?"ltr":"rtl"),l.direction=H?"ltr":"rtl",l.textAlign=H?"left":"right"),p-=m*this._fontSizeFraction/this.lineHeight,j){this._renderChar(r,l,c,0,o.join(""),d,p,m),l.restore();return}for(var G=0,Z=o.length-1;G<=Z;G++)O=G===Z||this.charSpacing||E,x+=o[G],C=this.__charBounds[c][G],w===0?(d+=q*(C.kernedWidth-C.width),w+=C.width):w+=C.kernedWidth,_&&!O&&this._reSpaceAndTab.test(o[G])&&(O=!0),O||(b=b||this.getCompleteStyleDeclaration(c,G),y=this.getCompleteStyleDeclaration(c,G+1),O=n.util.hasStyleChanged(b,y,!1)),O&&(E?(l.save(),l.translate(C.renderLeft,C.renderTop),l.rotate(C.angle),this._renderChar(r,l,c,G,x,-w/2,0,m),l.restore()):(Q=d,this._renderChar(r,l,c,G,x,Q,p,m)),x="",b=y,d+=q*w,w=0);l.restore()},_applyPatternGradientTransformText:function(r){var l=n.util.createCanvasElement(),o,d=this.width+this.strokeWidth,p=this.height+this.strokeWidth;return l.width=d,l.height=p,o=l.getContext("2d"),o.beginPath(),o.moveTo(0,0),o.lineTo(d,0),o.lineTo(d,p),o.lineTo(0,p),o.closePath(),o.translate(d/2,p/2),o.fillStyle=r.toLive(o),this._applyPatternGradientTransform(o,r),o.fill(),o.createPattern(l,"no-repeat")},handleFiller:function(r,l,o){var d,p;return o.toLive?o.gradientUnits==="percentage"||o.gradientTransform||o.patternTransform?(d=-this.width/2,p=-this.height/2,r.translate(d,p),r[l]=this._applyPatternGradientTransformText(o),{offsetX:d,offsetY:p}):(r[l]=o.toLive(r,this),this._applyPatternGradientTransform(r,o)):(r[l]=o,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,l){return r.lineWidth=l.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",l.stroke)},_setFillStyles:function(r,l){return this.handleFiller(r,"fillStyle",l.fill)},_renderChar:function(r,l,o,d,p,c,m){var _=this._getStyleDeclaration(o,d),b=this.getCompleteStyleDeclaration(o,d),y=r==="fillText"&&b.fill,x=r==="strokeText"&&b.stroke&&b.strokeWidth,C,w;!x&&!y||(l.save(),y&&(C=this._setFillStyles(l,b)),x&&(w=this._setStrokeStyles(l,b)),l.font=this._getFontDeclaration(b),_&&_.textBackgroundColor&&this._removeShadow(l),_&&_.deltaY&&(m+=_.deltaY),y&&l.fillText(p,c-C.offsetX,m-C.offsetY),x&&l.strokeText(p,c-w.offsetX,m-w.offsetY),l.restore())},setSuperscript:function(r,l){return this._setScript(r,l,this.superscript)},setSubscript:function(r,l){return this._setScript(r,l,this.subscript)},_setScript:function(r,l,o){var d=this.get2DCursorLocation(r,!0),p=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),c=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),m={fontSize:p*o.size,deltaY:c+p*o.baseline};return this.setSelectionStyles(m,r,l),this},_getLineLeftOffset:function(r){var l=this.getLineWidth(r),o=this.width-l,d=this.textAlign,p=this.direction,m,c=0,m=this.isEndOfWrapping(r);return d==="justify"||d==="justify-center"&&!m||d==="justify-right"&&!m||d==="justify-left"&&!m?0:(d==="center"&&(c=o/2),d==="right"&&(c=o),d==="justify-center"&&(c=o/2),d==="justify-right"&&(c=o),p==="rtl"&&(c-=o),c)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var l=this.measureLine(r),o=l.width;return this.__lineWidths[r]=o,o},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,l,o){var d=this._getStyleDeclaration(r,l);return d&&typeof d[o]<"u"?d[o]:this[o]},_renderTextDecoration:function(r,l){if(!(!this[l]&&!this.styleHas(l))){for(var o,d,p,c,m,_,b,y,x=this._getLeftOffset(),C=this._getTopOffset(),w,O,E,j,H,q,Q,K,G=this.path,Z=this._getWidthOfCharSpacing(),et=this.offsets[l],it=0,S=this._textLines.length;it<S;it++){if(o=this.getHeightOfLine(it),!this[l]&&!this.styleHas(l,it)){C+=o;continue}b=this._textLines[it],q=o/this.lineHeight,c=this._getLineLeftOffset(it),O=0,E=0,y=this.getValueOfPropertyAt(it,0,l),K=this.getValueOfPropertyAt(it,0,"fill"),w=C+q*(1-this._fontSizeFraction),d=this.getHeightOfChar(it,0),m=this.getValueOfPropertyAt(it,0,"deltaY");for(var P=0,D=b.length;P<D;P++)if(j=this.__charBounds[it][P],H=this.getValueOfPropertyAt(it,P,l),Q=this.getValueOfPropertyAt(it,P,"fill"),p=this.getHeightOfChar(it,P),_=this.getValueOfPropertyAt(it,P,"deltaY"),G&&H&&Q)r.save(),r.fillStyle=K,r.translate(j.renderLeft,j.renderTop),r.rotate(j.angle),r.fillRect(-j.kernedWidth/2,et*p+_,j.kernedWidth,this.fontSize/15),r.restore();else if((H!==y||Q!==K||p!==d||_!==m)&&E>0){var M=x+c+O;this.direction==="rtl"&&(M=this.width-M-E),y&&K&&(r.fillStyle=K,r.fillRect(M,w+et*d+m,E,this.fontSize/15)),O=j.left,E=j.width,y=H,K=Q,d=p,m=_}else E+=j.kernedWidth;var M=x+c+O;this.direction==="rtl"&&(M=this.width-M-E),r.fillStyle=Q,H&&Q&&r.fillRect(M,w+et*d+m,E-Z,this.fontSize/15),C+=o}this._removeShadow(r)}},_getFontDeclaration:function(r,l){var o=r||this,d=this.fontFamily,p=n.Text.genericFonts.indexOf(d.toLowerCase())>-1,c=d===void 0||d.indexOf("'")>-1||d.indexOf(",")>-1||d.indexOf('"')>-1||p?o.fontFamily:'"'+o.fontFamily+'"';return[n.isLikelyNode?o.fontWeight:o.fontStyle,n.isLikelyNode?o.fontStyle:o.fontWeight,l?this.CACHE_FONT_SIZE+"px":o.fontSize+"px",c].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var l=r.split(this._reNewline),o=new Array(l.length),d=[`
`],p=[],c=0;c<l.length;c++)o[c]=n.util.string.graphemeSplit(l[c]),p=p.concat(o[c],d);return p.pop(),{_unwrappedLines:o,lines:l,graphemeText:p,graphemeLines:o}},toObject:function(r){var l=u.concat(r),o=this.callSuper("toObject",l);return o.styles=n.util.stylesToArray(this.styles,this.text),o.path&&(o.path=this.path.toObject()),o},set:function(r,l){this.callSuper("set",r,l);var o=!1,d=!1;if(typeof r=="object")for(var p in r)p==="path"&&this.setPathInfo(),o=o||this._dimensionAffectingProps.indexOf(p)!==-1,d=d||p==="path";else o=this._dimensionAffectingProps.indexOf(r)!==-1,d=r==="path";return d&&this.setPathInfo(),o&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),n.Text.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),n.Text.DEFAULT_SVG_FONT_SIZE=16,n.Text.fromElement=function(r,l,o){if(!r)return l(null);var d=n.parseAttributes(r,n.Text.ATTRIBUTE_NAMES),p=d.textAnchor||"left";if(o=n.util.object.extend(o?h(o):{},d),o.top=o.top||0,o.left=o.left||0,d.textDecoration){var c=d.textDecoration;c.indexOf("underline")!==-1&&(o.underline=!0),c.indexOf("overline")!==-1&&(o.overline=!0),c.indexOf("line-through")!==-1&&(o.linethrough=!0),delete o.textDecoration}"dx"in d&&(o.left+=d.dx),"dy"in d&&(o.top+=d.dy),"fontSize"in o||(o.fontSize=n.Text.DEFAULT_SVG_FONT_SIZE);var m="";"textContent"in r?m=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(m=r.firstChild.data),m=m.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=o.strokeWidth;o.strokeWidth=0;var b=new n.Text(m,o),y=b.getScaledHeight()/b.height,x=(b.height+b.strokeWidth)*b.lineHeight-b.height,C=x*y,w=b.getScaledHeight()+C,O=0;p==="center"&&(O=b.getScaledWidth()/2),p==="right"&&(O=b.getScaledWidth()),b.set({left:b.left-O,top:b.top-(w-b.fontSize*(.07+b._fontSizeFraction))/b.lineHeight,strokeWidth:typeof _<"u"?_:1}),l(b)},n.Text.fromObject=function(r,l){var o=h(r),d=r.path;return delete o.path,n.Object._fromObject("Text",o,function(p){p.styles=n.util.stylesFromArray(r.styles,r.text),d?n.Object._fromObject("Path",d,function(c){p.set("path",c),l(p)},"path"):l(p)},"text")},n.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],n.util.createAccessors&&n.util.createAccessors(n.Text)}(i),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(a){if(!this.styles||typeof a<"u"&&!this.styles[a])return!0;var n=typeof a>"u"?this.styles:{line:this.styles[a]};for(var h in n)for(var u in n[h])for(var r in n[h][u])return!1;return!0},styleHas:function(a,n){if(!this.styles||!a||a===""||typeof n<"u"&&!this.styles[n])return!1;var h=typeof n>"u"?this.styles:{0:this.styles[n]};for(var u in h)for(var r in h[u])if(typeof h[u][r][a]<"u")return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||a==="")return!1;var n=this.styles,h=0,u,r,l=!0,o=0,d;for(var p in n){u=0;for(var c in n[p]){var d=n[p][c],m=d.hasOwnProperty(a);h++,m?(r?d[a]!==r&&(l=!1):r=d[a],d[a]===this[a]&&delete d[a]):l=!1,Object.keys(d).length!==0?u++:delete n[p][c]}u===0&&delete n[p]}for(var _=0;_<this._textLines.length;_++)o+=this._textLines[_].length;l&&h===o&&(this[a]=r,this.removeStyle(a))},removeStyle:function(a){if(!(!this.styles||!a||a==="")){var n=this.styles,h,u,r;for(u in n){h=n[u];for(r in h)delete h[r][a],Object.keys(h[r]).length===0&&delete h[r];Object.keys(h).length===0&&delete n[u]}}},_extendStyles:function(a,n){var h=this.get2DCursorLocation(a);this._getLineStyle(h.lineIndex)||this._setLineStyle(h.lineIndex),this._getStyleDeclaration(h.lineIndex,h.charIndex)||this._setStyleDeclaration(h.lineIndex,h.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(h.lineIndex,h.charIndex),n)},get2DCursorLocation:function(a,n){typeof a>"u"&&(a=this.selectionStart);for(var h=n?this._unwrappedTextLines:this._textLines,u=h.length,r=0;r<u;r++){if(a<=h[r].length)return{lineIndex:r,charIndex:a};a-=h[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:h[r-1].length<a?h[r-1].length:a}},getSelectionStyles:function(a,n,h){typeof a>"u"&&(a=this.selectionStart||0),typeof n>"u"&&(n=this.selectionEnd||a);for(var u=[],r=a;r<n;r++)u.push(this.getStyleAtPosition(r,h));return u},getStyleAtPosition:function(a,n){var h=this.get2DCursorLocation(a),u=n?this.getCompleteStyleDeclaration(h.lineIndex,h.charIndex):this._getStyleDeclaration(h.lineIndex,h.charIndex);return u||{}},setSelectionStyles:function(a,n,h){typeof n>"u"&&(n=this.selectionStart||0),typeof h>"u"&&(h=this.selectionEnd||n);for(var u=n;u<h;u++)this._extendStyles(u,a);return this._forceClearCache=!0,this},_getStyleDeclaration:function(a,n){var h=this.styles&&this.styles[a];return h?h[n]:null},getCompleteStyleDeclaration:function(a,n){for(var h=this._getStyleDeclaration(a,n)||{},u={},r,l=0;l<this._styleProperties.length;l++)r=this._styleProperties[l],u[r]=typeof h[r]>"u"?this[r]:h[r];return u},_setStyleDeclaration:function(a,n,h){this.styles[a][n]=h},_deleteStyleDeclaration:function(a,n){delete this.styles[a][n]},_getLineStyle:function(a){return!!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}})}(),function(){function a(n){n.textDecoration&&(n.textDecoration.indexOf("underline")>-1&&(n.underline=!0),n.textDecoration.indexOf("line-through")>-1&&(n.linethrough=!0),n.textDecoration.indexOf("overline")>-1&&(n.overline=!0),delete n.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(n,h){this.callSuper("initialize",n,h),this.initBehavior()},setSelectionStart:function(n){n=Math.max(n,0),this._updateAndFire("selectionStart",n)},setSelectionEnd:function(n){n=Math.min(n,this.text.length),this._updateAndFire("selectionEnd",n)},_updateAndFire:function(n,h){this[n]!==h&&(this._fireSelectionChanged(),this[n]=h),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(n){this.clearContextTop(),this.callSuper("render",n),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(n){this.callSuper("_render",n)},clearContextTop:function(n){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var h=this.canvas.contextTop,u=this.canvas.viewportTransform;h.save(),h.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(h),this._clearTextArea(h),n||h.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var n=this._getCursorBoundaries(),h=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(n,h):this.renderSelection(n,h),h.restore()}},_clearTextArea:function(n){var h=this.width+4,u=this.height+4;n.clearRect(-h/2,-u/2,h,u)},_getCursorBoundaries:function(n){typeof n>"u"&&(n=this.selectionStart);var h=this._getLeftOffset(),u=this._getTopOffset(),r=this._getCursorBoundariesOffsets(n);return{left:h,top:u,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(n){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var h,u,r,l=0,o=0,d,p=this.get2DCursorLocation(n);r=p.charIndex,u=p.lineIndex;for(var c=0;c<u;c++)l+=this.getHeightOfLine(c);h=this._getLineLeftOffset(u);var m=this.__charBounds[u][r];return m&&(o=m.left),this.charSpacing!==0&&r===this._textLines[u].length&&(o-=this._getWidthOfCharSpacing()),d={top:l,left:h+(o>0?o:0)},this.direction==="rtl"&&(d.left*=-1),this.cursorOffsetCache=d,this.cursorOffsetCache},renderCursor:function(n,h){var u=this.get2DCursorLocation(),r=u.lineIndex,l=u.charIndex>0?u.charIndex-1:0,o=this.getValueOfPropertyAt(r,l,"fontSize"),d=this.scaleX*this.canvas.getZoom(),p=this.cursorWidth/d,c=n.topOffset,m=this.getValueOfPropertyAt(r,l,"deltaY");c+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-o*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(n,h),h.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,l,"fill"),h.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,h.fillRect(n.left+n.leftOffset-p/2,c+n.top+m,p,o)},renderSelection:function(n,h){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,l=this.textAlign.indexOf("justify")!==-1,o=this.get2DCursorLocation(u),d=this.get2DCursorLocation(r),p=o.lineIndex,c=d.lineIndex,m=o.charIndex<0?0:o.charIndex,_=d.charIndex<0?0:d.charIndex,b=p;b<=c;b++){var y=this._getLineLeftOffset(b)||0,x=this.getHeightOfLine(b),C=0,w=0,O=0;if(b===p&&(w=this.__charBounds[p][m].left),b>=p&&b<c)O=l&&!this.isEndOfWrapping(b)?this.width:this.getLineWidth(b)||5;else if(b===c)if(_===0)O=this.__charBounds[c][_].left;else{var E=this._getWidthOfCharSpacing();O=this.__charBounds[c][_-1].left+this.__charBounds[c][_-1].width-E}C=x,(this.lineHeight<1||b===c&&this.lineHeight>1)&&(x/=this.lineHeight);var j=n.left+y+w,H=O-w,q=x,Q=0;this.inCompositionMode?(h.fillStyle=this.compositionColor||"black",q=1,Q=x):h.fillStyle=this.selectionColor,this.direction==="rtl"&&(j=this.width-j-H),h.fillRect(j,n.top+n.topOffset+Q,H,q),n.topOffset+=C}},getCurrentCharFontSize:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fontSize")},getCurrentCharColor:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fill")},_getCurrentCharIndex:function(){var n=this.get2DCursorLocation(this.selectionStart,!0),h=n.charIndex>0?n.charIndex-1:0;return{l:n.lineIndex,c:h}}}),t.IText.fromObject=function(n,h){var u=t.util.stylesFromArray(n.styles,n.text),r=Object.assign({},n,{styles:u});if(a(r),r.styles)for(var l in r.styles)for(var o in r.styles[l])a(r.styles[l][o]);t.Object._fromObject("IText",r,h,"text")}}(),function(){var a=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var n=this;this.on("added",function(){var h=n.canvas;h&&(h._hasITextHandlers||(h._hasITextHandlers=!0,n._initCanvasHandlers(h)),h._iTextInstances=h._iTextInstances||[],h._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){var h=n.canvas;h&&(h._iTextInstances=h._iTextInstances||[],t.util.removeFromArray(h._iTextInstances,n),h._iTextInstances.length===0&&(h._hasITextHandlers=!1,n._removeCanvasHandlers(h)))})},_initCanvasHandlers:function(n){n._mouseUpITextHandler=function(){n._iTextInstances&&n._iTextInstances.forEach(function(h){h.__isMousedown=!1})},n.on("mouse:up",n._mouseUpITextHandler)},_removeCanvasHandlers:function(n){n.off("mouse:up",n._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,h,u,r){var l;return l={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",h,{duration:u,onComplete:function(){l.isAborted||n[r]()},onChange:function(){n.canvas&&n.selectionStart===n.selectionEnd&&n.renderCursorOrSelection()},abort:function(){return l.isAborted}}),l},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var h=this,u=n?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){h._tick()},u)},abortCursorAnimation:function(){var n=this._currentTickState||this._currentTickCompleteState,h=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,n&&h&&h.clearContext(h.contextTop||h.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(n){var h=0,u=n-1;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)h++,u--;for(;/\S/.test(this._text[u])&&u>-1;)h++,u--;return n-h},findWordBoundaryRight:function(n){var h=0,u=n;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)h++,u++;for(;/\S/.test(this._text[u])&&u<this._text.length;)h++,u++;return n+h},findLineBoundaryLeft:function(n){for(var h=0,u=n-1;!/\n/.test(this._text[u])&&u>-1;)h++,u--;return n-h},findLineBoundaryRight:function(n){for(var h=0,u=n;!/\n/.test(this._text[u])&&u<this._text.length;)h++,u++;return n+h},searchWordBoundary:function(n,h){for(var u=this._text,r=this._reSpace.test(u[n])?n-1:n,l=u[r],o=t.reNonWord;!o.test(l)&&r>0&&r<u.length;)r+=h,l=u[r];return o.test(l)&&(r+=h===1?0:1),r},selectWord:function(n){n=n||this.selectionStart;var h=this.searchWordBoundary(n,-1),u=this.searchWordBoundary(n,1);this.selectionStart=h,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(n){n=n||this.selectionStart;var h=this.findLineBoundaryLeft(n),u=this.findLineBoundaryRight(n);return this.selectionStart=h,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(n){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(n),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(h){h.selected=!1,h.isEditing&&h.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(n){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var h=this.getSelectionStartFromPointer(n.e),u=this.selectionStart,r=this.selectionEnd;(h!==this.__selectionStartOnMouseDown||u===r)&&(u===h||r===h)||(h>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=h):(this.selectionStart=h,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==u||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(n,h,u){var r=u.slice(0,n),l=t.util.string.graphemeSplit(r).length;if(n===h)return{selectionStart:l,selectionEnd:l};var o=u.slice(n,h),d=t.util.string.graphemeSplit(o).length;return{selectionStart:l,selectionEnd:l+d}},fromGraphemeToStringSelection:function(n,h,u){var r=u.slice(0,n),l=r.join("").length;if(n===h)return{selectionStart:l,selectionEnd:l};var o=u.slice(n,h),d=o.join("").length;return{selectionStart:l,selectionEnd:l+d}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var n=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=n.selectionStart,this.hiddenTextarea.selectionEnd=n.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var n=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=n.selectionEnd,this.inCompositionMode||(this.selectionStart=n.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var n=this._calcTextareaPosition();this.hiddenTextarea.style.left=n.left,this.hiddenTextarea.style.top=n.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var n=this.inCompositionMode?this.compositionStart:this.selectionStart,h=this._getCursorBoundaries(n),u=this.get2DCursorLocation(n),r=u.lineIndex,l=u.charIndex,o=this.getValueOfPropertyAt(r,l,"fontSize")*this.lineHeight,d=h.leftOffset,p=this.calcTransformMatrix(),c={x:h.left+d,y:h.top+h.topOffset+o},m=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,b=_.width/m,y=_.height/m,x=b-o,C=y-o,w=_.clientWidth/b,O=_.clientHeight/y;return c=t.util.transformPoint(c,p),c=t.util.transformPoint(c,this.canvas.viewportTransform),c.x*=w,c.y*=O,c.x<0&&(c.x=0),c.x>x&&(c.x=x),c.y<0&&(c.y=0),c.y>C&&(c.y=C),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var n=this._textBeforeEdit!==this.text,h=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,h&&(h.blur&&h.blur(),h.parentNode&&h.parentNode.removeChild(h)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),n&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),n&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},removeStyleFromTo:function(n,h){var u=this.get2DCursorLocation(n,!0),r=this.get2DCursorLocation(h,!0),l=u.lineIndex,o=u.charIndex,d=r.lineIndex,p=r.charIndex,c,m;if(l!==d){if(this.styles[l])for(c=o;c<this._unwrappedTextLines[l].length;c++)delete this.styles[l][c];if(this.styles[d])for(c=p;c<this._unwrappedTextLines[d].length;c++)m=this.styles[d][c],m&&(this.styles[l]||(this.styles[l]={}),this.styles[l][o+c-p]=m);for(c=l+1;c<=d;c++)delete this.styles[c];this.shiftLineStyles(d,l-d)}else if(this.styles[l]){m=this.styles[l];var _=p-o,b,y;for(c=o;c<p;c++)delete m[c];for(y in this.styles[l])b=parseInt(y,10),b>=p&&(m[b-_]=m[y],delete m[y])}},shiftLineStyles:function(n,h){var u=a(this.styles);for(var r in this.styles){var l=parseInt(r,10);l>n&&(this.styles[l+h]=u[l],u[l-h]||delete this.styles[l])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(n,h,u,r){var l,o={},d=!1,p=this._unwrappedTextLines[n].length===h;u||(u=1),this.shiftLineStyles(n,u),this.styles[n]&&(l=this.styles[n][h===0?h:h-1]);for(var c in this.styles[n]){var m=parseInt(c,10);m>=h&&(d=!0,o[m-h]=this.styles[n][c],p&&h===0||delete this.styles[n][c])}var _=!1;for(d&&!p&&(this.styles[n+u]=o,_=!0),_&&u--;u>0;)r&&r[u-1]?this.styles[n+u]={0:a(r[u-1])}:l?this.styles[n+u]={0:a(l)}:delete this.styles[n+u],u--;this._forceClearCache=!0},insertCharStyleObject:function(n,h,u,r){this.styles||(this.styles={});var l=this.styles[n],o=l?a(l):{};u||(u=1);for(var d in o){var p=parseInt(d,10);p>=h&&(l[p+u]=o[p],o[p-u]||delete l[p])}if(this._forceClearCache=!0,r){for(;u--;)Object.keys(r[u]).length&&(this.styles[n]||(this.styles[n]={}),this.styles[n][h+u]=a(r[u]));return}if(l)for(var c=l[h?h-1:1];c&&u--;)this.styles[n][h+u]=a(c)},insertNewStyleBlock:function(n,h,u){for(var r=this.get2DCursorLocation(h,!0),l=[0],o=0,d=0;d<n.length;d++)n[d]===`
`?(o++,l[o]=0):l[o]++;l[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,l[0],u),u=u&&u.slice(l[0]+1)),o&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+l[0],o);for(var d=1;d<o;d++)l[d]>0?this.insertCharStyleObject(r.lineIndex+d,0,l[d],u):u&&this.styles[r.lineIndex+d]&&u[0]&&(this.styles[r.lineIndex+d][0]=u[0]),u=u&&u.slice(l[d]+1);l[d]>0&&this.insertCharStyleObject(r.lineIndex+d,0,l[d],u)},setSelectionStartEndWithShift:function(n,h,u){u<=n?(h===n?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=n),this.selectionStart=u):u>n&&u<h?this._selectionDirection==="right"?this.selectionEnd=u:this.selectionStart=u:(h===n?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=h),this.selectionEnd=u)},setSelectionInBoundaries:function(){var n=this.text.length;this.selectionStart>n?this.selectionStart=n:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>n?this.selectionEnd=n:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(this.canvas){this.__newClickTime=+new Date;var n=a.pointer;this.isTripleClick(n)&&(this.fire("tripleclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=n,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(a){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(a.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){if(this.__isMousedown=!1,!(!this.editable||this.group||a.transform&&a.transform.actionPerformed||a.e.button&&a.e.button!==1)){if(this.canvas){var n=this.canvas._activeObject;if(n&&n!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(a){var n=this.getSelectionStartFromPointer(a),h=this.selectionStart,u=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(h,u,n):(this.selectionStart=n,this.selectionEnd=n),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var n=this.getLocalPointer(a),h=0,u=0,r=0,l=0,o=0,d,p,c=0,m=this._textLines.length;c<m&&r<=n.y;c++)r+=this.getHeightOfLine(c)*this.scaleY,o=c,c>0&&(l+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));d=this._getLineLeftOffset(o),u=d*this.scaleX,p=this._textLines[o],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+u);for(var _=0,b=p.length;_<b&&(h=u,u+=this.__charBounds[o][_].kernedWidth*this.scaleX,u<=n.x);_++)l++;return this._getNewSelectionStartFromOffset(n,h,u,l,b)},_getNewSelectionStartFromOffset:function(a,n,h,u,r){var l=a.x-n,o=h-a.x,d=o>l||o<0?0:1,p=u+d;return this.flipX&&(p=r-p),p>this._text.length&&(p=this._text.length),p}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+a.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){var n=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(a.keyCode in n)this[n[a.keyCode]](a);else if(a.keyCode in this.ctrlKeysMapDown&&(a.ctrlKey||a.metaKey))this[this.ctrlKeysMapDown[a.keyCode]](a);else return;a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey))this[this.ctrlKeysMapUp[a.keyCode]](a);else return;a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(a){var n=this.fromPaste;if(this.fromPaste=!1,a&&a.stopPropagation(),!!this.isEditing){var h=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,u=this._text.length,r=h.length,l,o,d=r-u,p=this.selectionStart,c=this.selectionEnd,m=p!==c,_,b,y;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var x=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=p>x.selectionStart;m?(l=this._text.slice(p,c),d+=c-p):r<u&&(C?l=this._text.slice(c+d,c):l=this._text.slice(p,p-d)),o=h.slice(x.selectionEnd-d,x.selectionEnd),l&&l.length&&(o.length&&(_=this.getSelectionStyles(p,p+1,!1),_=o.map(function(){return _[0]})),m?(b=p,y=c):C?(b=c-l.length,y=c):(b=c,y=c+l.length),this.removeStyleFromTo(b,y)),o.length&&(n&&o.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(_=t.copiedTextStyle),this.insertNewStyleBlock(o,p,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart,this.compositionEnd=a.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(a){return a&&a.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(a,n){var h=this._getLineLeftOffset(a),u;return n>0&&(u=this.__charBounds[a][n-1],h+=u.left+u.width),h},getDownCursorOffset:function(a,n){var h=this._getSelectionForOffset(a,n),u=this.get2DCursorLocation(h),r=u.lineIndex;if(r===this._textLines.length-1||a.metaKey||a.keyCode===34)return this._text.length-h;var l=u.charIndex,o=this._getWidthBeforeCursor(r,l),d=this._getIndexOnLine(r+1,o),p=this._textLines[r].slice(l);return p.length+d+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(a,n){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&n?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,n){var h=this._getSelectionForOffset(a,n),u=this.get2DCursorLocation(h),r=u.lineIndex;if(r===0||a.metaKey||a.keyCode===33)return-h;var l=u.charIndex,o=this._getWidthBeforeCursor(r,l),d=this._getIndexOnLine(r-1,o),p=this._textLines[r].slice(0,l),c=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+d-p.length+(1-c)},_getIndexOnLine:function(a,n){for(var h=this._textLines[a],u=this._getLineLeftOffset(a),r=u,l=0,o,d,p=0,c=h.length;p<c;p++)if(o=this.__charBounds[a][p].width,r+=o,r>n){d=!0;var m=r-o,_=r,b=Math.abs(m-n),y=Math.abs(_-n);l=y<b?p:p-1;break}return d||(l=h.length-1),l},moveCursorDown:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,n){var h="get"+a+"CursorOffset",u=this[h](n,this._selectionDirection==="right");n.shiftKey?this.moveCursorWithShift(u):this.moveCursorWithoutShift(u),u!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var n=this._selectionDirection==="left"?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,n),a!==0},moveCursorWithoutShift:function(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),a!==0},moveCursorLeft:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",a)},_move:function(a,n,h){var u;if(a.altKey)u=this["findWordBoundary"+h](this[n]);else if(a.metaKey||a.keyCode===35||a.keyCode===36)u=this["findLineBoundary"+h](this[n]);else return this[n]+=h==="Left"?-1:1,!0;if(typeof u<"u"&&this[n]!==u)return this[n]=u,!0},_moveLeft:function(a,n){return this._move(a,n,"Left")},_moveRight:function(a,n){return this._move(a,n,"Right")},moveCursorLeftWithoutShift:function(a){var n=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(n=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,n},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(a,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(a,"selectionStart")},moveCursorRight:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,n){var h="moveCursor"+a+"With";this._currentCursorOpacity=1,n.shiftKey?h+="Shift":h+="outShift",this[h](n)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(a,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(a,"selectionEnd")},moveCursorRightWithoutShift:function(a){var n=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(n=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,n},removeChars:function(a,n){typeof n>"u"&&(n=a+1),this.removeStyleFromTo(a,n),this._text.splice(a,n-a),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(a,n,h,u){typeof u>"u"&&(u=h),u>h&&this.removeStyleFromTo(h,u);var r=t.util.string.graphemeSplit(a);this.insertNewStyleBlock(r,h,n),this._text=[].concat(this._text.slice(0,h),r,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var a=t.util.toFixed,n=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var h=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(h.textTop,h.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(h){var u=!0,r=this.getSvgTextDecoration(this);return[h.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",r?'text-decoration="'+r+'" ':"",'style="',this.getSvgStyles(u),'"',this.addPaintOrder()," >",h.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(h,u){var r=[],l=[],o=h,d;this._setSVGBg(l);for(var p=0,c=this._textLines.length;p<c;p++)d=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(l,p,u+d,o),this._setSVGTextLineText(r,p,u+d,o),o+=this.getHeightOfLine(p);return{textSpans:r,textBgRects:l}},_createTextCharSpan:function(h,u,r,l){var o=h!==h.trim()||h.match(n),d=this.getSvgSpanStyles(u,o),p=d?'style="'+d+'"':"",c=u.deltaY,m="",_=t.Object.NUM_FRACTION_DIGITS;return c&&(m=' dy="'+a(c,_)+'" '),['<tspan x="',a(r,_),'" y="',a(l,_),'" ',m,p,">",t.util.string.escapeXml(h),"</tspan>"].join("")},_setSVGTextLineText:function(h,u,r,l){var o=this.getHeightOfLine(u),d=this.textAlign.indexOf("justify")!==-1,p,c,m="",_,b,y=0,x=this._textLines[u],C;l+=o*(1-this._fontSizeFraction)/this.lineHeight;for(var w=0,O=x.length-1;w<=O;w++)C=w===O||this.charSpacing,m+=x[w],_=this.__charBounds[u][w],y===0?(r+=_.kernedWidth-_.width,y+=_.width):y+=_.kernedWidth,d&&!C&&this._reSpaceAndTab.test(x[w])&&(C=!0),C||(p=p||this.getCompleteStyleDeclaration(u,w),c=this.getCompleteStyleDeclaration(u,w+1),C=t.util.hasStyleChanged(p,c,!0)),C&&(b=this._getStyleDeclaration(u,w)||{},h.push(this._createTextCharSpan(m,b,r,l)),m="",p=c,r+=y,y=0)},_pushTextBgRect:function(h,u,r,l,o,d){var p=t.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(u),' x="',a(r,p),'" y="',a(l,p),'" width="',a(o,p),'" height="',a(d,p),`"></rect>
`)},_setSVGTextLineBg:function(h,u,r,l){for(var o=this._textLines[u],d=this.getHeightOfLine(u)/this.lineHeight,p=0,c=0,m,_,b=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),y=0,x=o.length;y<x;y++)m=this.__charBounds[u][y],_=this.getValueOfPropertyAt(u,y,"textBackgroundColor"),_!==b?(b&&this._pushTextBgRect(h,b,r+c,l,p,d),c=m.left,p=m.width,b=_):p+=m.kernedWidth;_&&this._pushTextBgRect(h,_,r+c,l,p,d)},_getFillAttributes:function(h){var u=h&&typeof h=="string"?new t.Color(h):"";return!u||!u.getSource()||u.getAlpha()===1?'fill="'+h+'"':'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(h){for(var u=0,r=0,l=0;l<h;l++)u+=this.getHeightOfLine(l);return r=this.getHeightOfLine(l),{lineTop:u,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(h){var u=t.Object.prototype.getSvgStyles.call(this,h);return u+" white-space: pre;"}})}(),function(a){var n=a.fabric||(a.fabric={});n.Textbox=n.util.createClass(n.IText,n.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:n.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(h){for(var u=0,r=0,l=0,o={},d=0;d<h.graphemeLines.length;d++)h.graphemeText[l]===`
`&&d>0?(r=0,l++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(h.graphemeText[l])&&d>0&&(r++,l++),o[d]={line:u,offset:r},l+=h.graphemeLines[d].length,r+=h.graphemeLines[d].length;return o},styleHas:function(h,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];r&&(u=r.line)}return n.Text.prototype.styleHas.call(this,h,u)},isEmptyStyles:function(h){if(!this.styles)return!0;var u=0,r=h+1,l,o,d=!1,p=this._styleMap[h],c=this._styleMap[h+1];p&&(h=p.line,u=p.offset),c&&(r=c.line,d=r===h,l=c.offset),o=typeof h>"u"?this.styles:{line:this.styles[h]};for(var m in o)for(var _ in o[m])if(_>=u&&(!d||_<l))for(var b in o[m][_])return!1;return!0},_getStyleDeclaration:function(h,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[h];if(!r)return null;h=r.line,u=r.offset+u}return this.callSuper("_getStyleDeclaration",h,u)},_setStyleDeclaration:function(h,u,r){var l=this._styleMap[h];h=l.line,u=l.offset+u,this.styles[h][u]=r},_deleteStyleDeclaration:function(h,u){var r=this._styleMap[h];h=r.line,u=r.offset+u,delete this.styles[h][u]},_getLineStyle:function(h){var u=this._styleMap[h];return!!this.styles[u.line]},_setLineStyle:function(h){var u=this._styleMap[h];this.styles[u.line]={}},_wrapText:function(h,u){var r=[],l;for(this.isWrapping=!0,l=0;l<h.length;l++)r=r.concat(this._wrapLine(h[l],l,u));return this.isWrapping=!1,r},_measureWord:function(h,u,r){var l=0,o,d=!0;r=r||0;for(var p=0,c=h.length;p<c;p++){var m=this._getGraphemeBox(h[p],u,p+r,o,d);l+=m.kernedWidth,o=h[p]}return l},_wrapLine:function(h,u,r,j){var o=0,d=this.splitByGrapheme,p=[],c=[],m=d?n.util.string.graphemeSplit(h):h.split(this._wordJoiners),_="",b=0,y=d?"":" ",x=0,C=0,w=0,O=!0,E=this._getWidthOfCharSpacing(),j=j||0;m.length===0&&m.push([]),r-=j;for(var H=0;H<m.length;H++)_=d?m[H]:n.util.string.graphemeSplit(m[H]),x=this._measureWord(_,u,b),b+=_.length,o+=C+x-E,o>r&&!O?(p.push(c),c=[],o=x,O=!0):o+=E,!O&&!d&&c.push(y),c=c.concat(_),C=d?0:this._measureWord([y],u,b),b++,O=!1,x>w&&(w=x);return H&&p.push(c),w+j>this.dynamicMinWidth&&(this.dynamicMinWidth=w-E+j),p},isEndOfWrapping:function(h){return!this._styleMap[h+1]||this._styleMap[h+1].line!==this._styleMap[h].line},missingNewlineOffset:function(h){return this.splitByGrapheme?this.isEndOfWrapping(h)?1:0:1},_splitTextIntoLines:function(h){for(var u=n.Text.prototype._splitTextIntoLines.call(this,h),r=this._wrapText(u.lines,this.width),l=new Array(r.length),o=0;o<r.length;o++)l[o]=r[o].join("");return u.lines=l,u.graphemeLines=r,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var h={};for(var u in this._styleMap)this._textLines[u]&&(h[this._styleMap[u].line]=1);for(var u in this.styles)h[u]||delete this.styles[u]},toObject:function(h){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(h))}}),n.Textbox.fromObject=function(h,u){var r=n.util.stylesFromArray(h.styles,h.text),l=Object.assign({},h,{styles:r});return n.Object._fromObject("Textbox",l,u,"text")}}(i),function(){var a=t.controlsUtils,n=a.scaleSkewCursorStyleHandler,h=a.scaleCursorStyleHandler,u=a.scalingEqually,r=a.scalingYOrSkewingX,l=a.scalingXOrSkewingY,o=a.scaleOrSkewActionName,d=t.Object.prototype.controls;if(d.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:n,actionHandler:l,getActionName:o}),d.mr=new t.Control({x:.5,y:0,cursorStyleHandler:n,actionHandler:l,getActionName:o}),d.mb=new t.Control({x:0,y:.5,cursorStyleHandler:n,actionHandler:r,getActionName:o}),d.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:n,actionHandler:r,getActionName:o}),d.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:h,actionHandler:u}),d.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:h,actionHandler:u}),d.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:h,actionHandler:u}),d.br=new t.Control({x:.5,y:.5,cursorStyleHandler:h,actionHandler:u}),d.mtr=new t.Control({x:0,y:-.5,actionHandler:a.rotationWithSnapping,cursorStyleHandler:a.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var p=t.Textbox.prototype.controls={};p.mtr=d.mtr,p.tr=d.tr,p.br=d.br,p.tl=d.tl,p.bl=d.bl,p.mt=d.mt,p.mb=d.mb,p.mr=new t.Control({x:.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:n,actionName:"resizing"}),p.ml=new t.Control({x:-.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:n,actionName:"resizing"})}}()})(yr);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function di(i){return i+.5|0}const ne=(i,t,e)=>Math.max(Math.min(i,e),t);function Ue(i){return ne(di(i*2.55),0,255)}function oe(i){return ne(di(i*255),0,255)}function Zt(i){return ne(di(i/2.55)/100,0,1)}function Jn(i){return ne(di(i*100),0,100)}const zt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},yn=[..."0123456789ABCDEF"],No=i=>yn[i&15],Vo=i=>yn[(i&240)>>4]+yn[i&15],mi=i=>(i&240)>>4===(i&15),Xo=i=>mi(i.r)&&mi(i.g)&&mi(i.b)&&mi(i.a);function Yo(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&zt[i[1]]*17,g:255&zt[i[2]]*17,b:255&zt[i[3]]*17,a:t===5?zt[i[4]]*17:255}:(t===7||t===9)&&(e={r:zt[i[1]]<<4|zt[i[2]],g:zt[i[3]]<<4|zt[i[4]],b:zt[i[5]]<<4|zt[i[6]],a:t===9?zt[i[7]]<<4|zt[i[8]]:255})),e}const Ho=(i,t)=>i<255?t(i):"";function Uo(i){var t=Xo(i)?No:Vo;return i?"#"+t(i.r)+t(i.g)+t(i.b)+Ho(i.a,t):void 0}const Go=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function xr(i,t,e){const s=t*Math.min(e,1-e),f=(g,v=(g+i/30)%12)=>e-s*Math.max(Math.min(v-3,9-v,1),-1);return[f(0),f(8),f(4)]}function $o(i,t,e){const s=(f,g=(f+i/60)%6)=>e-e*t*Math.max(Math.min(g,4-g,1),0);return[s(5),s(3),s(1)]}function qo(i,t,e){const s=xr(i,1,.5);let f;for(t+e>1&&(f=1/(t+e),t*=f,e*=f),f=0;f<3;f++)s[f]*=1-t-e,s[f]+=t;return s}function Ko(i,t,e,s,f){return i===f?(t-e)/s+(t<e?6:0):t===f?(e-i)/s+2:(i-t)/s+4}function In(i){const e=i.r/255,s=i.g/255,f=i.b/255,g=Math.max(e,s,f),v=Math.min(e,s,f),a=(g+v)/2;let n,h,u;return g!==v&&(u=g-v,h=a>.5?u/(2-g-v):u/(g+v),n=Ko(e,s,f,u,g),n=n*60+.5),[n|0,h||0,a]}function Rn(i,t,e,s){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,s)).map(oe)}function Bn(i,t,e){return Rn(xr,i,t,e)}function Jo(i,t,e){return Rn(qo,i,t,e)}function Qo(i,t,e){return Rn($o,i,t,e)}function Cr(i){return(i%360+360)%360}function Zo(i){const t=Go.exec(i);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?Ue(+t[5]):oe(+t[5]));const f=Cr(+t[2]),g=+t[3]/100,v=+t[4]/100;return t[1]==="hwb"?s=Jo(f,g,v):t[1]==="hsv"?s=Qo(f,g,v):s=Bn(f,g,v),{r:s[0],g:s[1],b:s[2],a:e}}function ta(i,t){var e=In(i);e[0]=Cr(e[0]+t),e=Bn(e),i.r=e[0],i.g=e[1],i.b=e[2]}function ea(i){if(!i)return;const t=In(i),e=t[0],s=Jn(t[1]),f=Jn(t[2]);return i.a<255?`hsla(${e}, ${s}%, ${f}%, ${Zt(i.a)})`:`hsl(${e}, ${s}%, ${f}%)`}const Qn={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Zn={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ia(){const i={},t=Object.keys(Zn),e=Object.keys(Qn);let s,f,g,v,a;for(s=0;s<t.length;s++){for(v=a=t[s],f=0;f<e.length;f++)g=e[f],a=a.replace(g,Qn[g]);g=parseInt(Zn[v],16),i[a]=[g>>16&255,g>>8&255,g&255]}return i}let vi;function na(i){vi||(vi=ia(),vi.transparent=[0,0,0,0]);const t=vi[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const sa=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function ra(i){const t=sa.exec(i);let e=255,s,f,g;if(t){if(t[7]!==s){const v=+t[7];e=t[8]?Ue(v):ne(v*255,0,255)}return s=+t[1],f=+t[3],g=+t[5],s=255&(t[2]?Ue(s):ne(s,0,255)),f=255&(t[4]?Ue(f):ne(f,0,255)),g=255&(t[6]?Ue(g):ne(g,0,255)),{r:s,g:f,b:g,a:e}}}function oa(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${Zt(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const on=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,Ee=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function aa(i,t,e){const s=Ee(Zt(i.r)),f=Ee(Zt(i.g)),g=Ee(Zt(i.b));return{r:oe(on(s+e*(Ee(Zt(t.r))-s))),g:oe(on(f+e*(Ee(Zt(t.g))-f))),b:oe(on(g+e*(Ee(Zt(t.b))-g))),a:i.a+e*(t.a-i.a)}}function _i(i,t,e){if(i){let s=In(i);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=Bn(s),i.r=s[0],i.g=s[1],i.b=s[2]}}function Sr(i,t){return i&&Object.assign(t||{},i)}function ts(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=oe(i[3]))):(t=Sr(i,{r:0,g:0,b:0,a:1}),t.a=oe(t.a)),t}function la(i){return i.charAt(0)==="r"?ra(i):Zo(i)}class oi{constructor(t){if(t instanceof oi)return t;const e=typeof t;let s;e==="object"?s=ts(t):e==="string"&&(s=Yo(t)||na(t)||la(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=Sr(this._rgb);return t&&(t.a=Zt(t.a)),t}set rgb(t){this._rgb=ts(t)}rgbString(){return this._valid?oa(this._rgb):void 0}hexString(){return this._valid?Uo(this._rgb):void 0}hslString(){return this._valid?ea(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,f=t.rgb;let g;const v=e===g?.5:e,a=2*v-1,n=s.a-f.a,h=((a*n===-1?a:(a+n)/(1+a*n))+1)/2;g=1-h,s.r=255&h*s.r+g*f.r+.5,s.g=255&h*s.g+g*f.g+.5,s.b=255&h*s.b+g*f.b+.5,s.a=v*s.a+(1-v)*f.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=aa(this._rgb,t._rgb,e)),this}clone(){return new oi(this.rgb)}alpha(t){return this._rgb.a=oe(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=di(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return _i(this._rgb,2,t),this}darken(t){return _i(this._rgb,2,-t),this}saturate(t){return _i(this._rgb,1,t),this}desaturate(t){return _i(this._rgb,1,-t),this}rotate(t){return ta(this._rgb,t),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function Kt(){}const ha=(()=>{let i=0;return()=>i++})();function gt(i){return i===null||typeof i>"u"}function yt(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function dt(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function Ot(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function It(i,t){return Ot(i)?i:t}function pt(i,t){return typeof i>"u"?t:i}const ca=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,wr=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function St(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function vt(i,t,e,s){let f,g,v;if(yt(i))if(g=i.length,s)for(f=g-1;f>=0;f--)t.call(e,i[f],f);else for(f=0;f<g;f++)t.call(e,i[f],f);else if(dt(i))for(v=Object.keys(i),g=v.length,f=0;f<g;f++)t.call(e,i[v[f]],v[f])}function Yi(i,t){let e,s,f,g;if(!i||!t||i.length!==t.length)return!1;for(e=0,s=i.length;e<s;++e)if(f=i[e],g=t[e],f.datasetIndex!==g.datasetIndex||f.index!==g.index)return!1;return!0}function Hi(i){if(yt(i))return i.map(Hi);if(dt(i)){const t=Object.create(null),e=Object.keys(i),s=e.length;let f=0;for(;f<s;++f)t[e[f]]=Hi(i[e[f]]);return t}return i}function Tr(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function ua(i,t,e,s){if(!Tr(i))return;const f=t[i],g=e[i];dt(f)&&dt(g)?ai(f,g,s):t[i]=Hi(g)}function ai(i,t,e){const s=yt(t)?t:[t],f=s.length;if(!dt(i))return i;e=e||{};const g=e.merger||ua;let v;for(let a=0;a<f;++a){if(v=s[a],!dt(v))continue;const n=Object.keys(v);for(let h=0,u=n.length;h<u;++h)g(n[h],i,v,e)}return i}function Ze(i,t){return ai(i,t,{merger:fa})}function fa(i,t,e){if(!Tr(i))return;const s=t[i],f=e[i];dt(s)&&dt(f)?Ze(s,f):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=Hi(f))}const es={"":i=>i,x:i=>i.x,y:i=>i.y};function da(i){const t=i.split("."),e=[];let s="";for(const f of t)s+=f,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function ga(i){const t=da(i);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function ce(i,t){return(es[t]||(es[t]=ga(t)))(i)}function jn(i){return i.charAt(0).toUpperCase()+i.slice(1)}const li=i=>typeof i<"u",ue=i=>typeof i=="function",is=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function pa(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const Ct=Math.PI,kt=2*Ct,ma=kt+Ct,Ui=Number.POSITIVE_INFINITY,va=Ct/180,Dt=Ct/2,_e=Ct/4,ns=Ct*2/3,se=Math.log10,Ut=Math.sign;function ti(i,t,e){return Math.abs(i-t)<e}function ss(i){const t=Math.round(i);i=ti(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(se(i))),s=i/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function _a(i){const t=[],e=Math.sqrt(i);let s;for(s=1;s<e;s++)i%s===0&&(t.push(s),t.push(i/s));return e===(e|0)&&t.push(e),t.sort((f,g)=>f-g).pop(),t}function hi(i){return!isNaN(parseFloat(i))&&isFinite(i)}function ba(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function Or(i,t,e){let s,f,g;for(s=0,f=i.length;s<f;s++)g=i[s][e],isNaN(g)||(t.min=Math.min(t.min,g),t.max=Math.max(t.max,g))}function Vt(i){return i*(Ct/180)}function zn(i){return i*(180/Ct)}function rs(i){if(!Ot(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function ya(i,t){const e=t.x-i.x,s=t.y-i.y,f=Math.sqrt(e*e+s*s);let g=Math.atan2(s,e);return g<-.5*Ct&&(g+=kt),{angle:g,distance:f}}function xn(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function xa(i,t){return(i-t+ma)%kt-Ct}function Nt(i){return(i%kt+kt)%kt}function Gi(i,t,e,s){const f=Nt(i),g=Nt(t),v=Nt(e),a=Nt(g-f),n=Nt(v-f),h=Nt(f-g),u=Nt(f-v);return f===g||f===v||s&&g===v||a>n&&h<u}function At(i,t,e){return Math.max(t,Math.min(e,i))}function Ca(i){return At(i,-32768,32767)}function Cn(i,t,e,s=1e-6){return i>=Math.min(t,e)-s&&i<=Math.max(t,e)+s}function Wn(i,t,e){e=e||(v=>i[v]<t);let s=i.length-1,f=0,g;for(;s-f>1;)g=f+s>>1,e(g)?f=g:s=g;return{lo:f,hi:s}}const te=(i,t,e,s)=>Wn(i,e,s?f=>{const g=i[f][t];return g<e||g===e&&i[f+1][t]===e}:f=>i[f][t]<e),Sa=(i,t,e)=>Wn(i,e,s=>i[s][t]>=e);function wa(i,t,e){let s=0,f=i.length;for(;s<f&&i[s]<t;)s++;for(;f>s&&i[f-1]>e;)f--;return s>0||f<i.length?i.slice(s,f):i}const kr=["push","pop","shift","splice","unshift"];function Ta(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),kr.forEach(e=>{const s="_onData"+jn(e),f=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...g){const v=f.apply(this,g);return i._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...g)}),v}})})}function os(i,t){const e=i._chartjs;if(!e)return;const s=e.listeners,f=s.indexOf(t);f!==-1&&s.splice(f,1),!(s.length>0)&&(kr.forEach(g=>{delete i[g]}),delete i._chartjs)}function Mr(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const Pr=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function Dr(i,t){let e=[],s=!1;return function(...f){e=f,s||(s=!0,Pr.call(window,()=>{s=!1,i.apply(t,e)}))}}function Oa(i,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(i,t,s)):i.apply(this,s),t}}const Ar=i=>i==="start"?"left":i==="end"?"right":"center",ei=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2;function ka(i,t,e){const s=t.length;let f=0,g=s;if(i._sorted){const{iScale:v,_parsed:a}=i,n=v.axis,{min:h,max:u,minDefined:r,maxDefined:l}=v.getUserBounds();r&&(f=At(Math.min(te(a,n,h).lo,e?s:te(t,n,v.getPixelForValue(h)).lo),0,s-1)),l?g=At(Math.max(te(a,v.axis,u,!0).hi+1,e?0:te(t,n,v.getPixelForValue(u),!0).hi+1),f,s)-f:g=s-f}return{start:f,count:g}}function Ma(i){const{xScale:t,yScale:e,_scaleRanges:s}=i,f={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return i._scaleRanges=f,!0;const g=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,f),g}const bi=i=>i===0||i===1,as=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*kt/e)),ls=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*kt/e)+1,ii={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*Dt)+1,easeOutSine:i=>Math.sin(i*Dt),easeInOutSine:i=>-.5*(Math.cos(Ct*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>bi(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>bi(i)?i:as(i,.075,.3),easeOutElastic:i=>bi(i)?i:ls(i,.075,.3),easeInOutElastic(i){return bi(i)?i:i<.5?.5*as(i*2,.1125,.45):.5+.5*ls(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-ii.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?ii.easeInBounce(i*2)*.5:ii.easeOutBounce(i*2-1)*.5+.5};function Nn(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function hs(i){return Nn(i)?i:new oi(i)}function an(i){return Nn(i)?i:new oi(i).saturate(.5).darken(.1).hexString()}const Pa=["x","y","borderWidth","radius","tension"],Da=["color","borderColor","backgroundColor"];function Aa(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:Da},numbers:{type:"number",properties:Pa}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Ea(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const cs=new Map;function Fa(i,t){t=t||{};const e=i+JSON.stringify(t);let s=cs.get(e);return s||(s=new Intl.NumberFormat(i,t),cs.set(e,s)),s}function gi(i,t,e){return Fa(t,e).format(i)}const Er={values(i){return yt(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const s=this.chart.options.locale;let f,g=i;if(e.length>1){const h=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(h<1e-4||h>1e15)&&(f="scientific"),g=La(i,e)}const v=se(Math.abs(g)),a=isNaN(v)?1:Math.max(Math.min(-1*Math.floor(v),20),0),n={notation:f,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(n,this.options.ticks.format),gi(i,s,n)},logarithmic(i,t,e){if(i===0)return"0";const s=e[t].significand||i/Math.pow(10,Math.floor(se(i)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?Er.numeric.call(this,i,t,e):""}};function La(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var tn={formatters:Er};function Ia(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:tn.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Me=Object.create(null),Sn=Object.create(null);function ni(i,t){if(!t)return i;const e=t.split(".");for(let s=0,f=e.length;s<f;++s){const g=e[s];i=i[g]||(i[g]=Object.create(null))}return i}function ln(i,t,e){return typeof t=="string"?ai(ni(i,t),e):ai(ni(i,""),t)}class Ra{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,f)=>an(f.backgroundColor),this.hoverBorderColor=(s,f)=>an(f.borderColor),this.hoverColor=(s,f)=>an(f.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return ln(this,t,e)}get(t){return ni(this,t)}describe(t,e){return ln(Sn,t,e)}override(t,e){return ln(Me,t,e)}route(t,e,s,f){const g=ni(this,t),v=ni(this,s),a="_"+e;Object.defineProperties(g,{[a]:{value:g[e],writable:!0},[e]:{enumerable:!0,get(){const n=this[a],h=v[f];return dt(n)?Object.assign({},h,n):pt(n,h)},set(n){this[a]=n}}})}apply(t){t.forEach(e=>e(this))}}var wt=new Ra({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Aa,Ea,Ia]);function Ba(i){return!i||gt(i.size)||gt(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function $i(i,t,e,s,f){let g=t[f];return g||(g=t[f]=i.measureText(f).width,e.push(f)),g>s&&(s=g),s}function ja(i,t,e,s){s=s||{};let f=s.data=s.data||{},g=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(f=s.data={},g=s.garbageCollect=[],s.font=t),i.save(),i.font=t;let v=0;const a=e.length;let n,h,u,r,l;for(n=0;n<a;n++)if(r=e[n],r!=null&&!yt(r))v=$i(i,f,g,v,r);else if(yt(r))for(h=0,u=r.length;h<u;h++)l=r[h],l!=null&&!yt(l)&&(v=$i(i,f,g,v,l));i.restore();const o=g.length/2;if(o>e.length){for(n=0;n<o;n++)delete f[g[n]];g.splice(0,o)}return v}function be(i,t,e){const s=i.currentDevicePixelRatio,f=e!==0?Math.max(e/2,.5):0;return Math.round((t-f)*s)/s+f}function us(i,t){t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore()}function wn(i,t,e,s){za(i,t,e,s,null)}function za(i,t,e,s,f){let g,v,a,n,h,u,r,l;const o=t.pointStyle,d=t.rotation,p=t.radius;let c=(d||0)*va;if(o&&typeof o=="object"&&(g=o.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){i.save(),i.translate(e,s),i.rotate(c),i.drawImage(o,-o.width/2,-o.height/2,o.width,o.height),i.restore();return}if(!(isNaN(p)||p<=0)){switch(i.beginPath(),o){default:f?i.ellipse(e,s,f/2,p,0,0,kt):i.arc(e,s,p,0,kt),i.closePath();break;case"triangle":u=f?f/2:p,i.moveTo(e+Math.sin(c)*u,s-Math.cos(c)*p),c+=ns,i.lineTo(e+Math.sin(c)*u,s-Math.cos(c)*p),c+=ns,i.lineTo(e+Math.sin(c)*u,s-Math.cos(c)*p),i.closePath();break;case"rectRounded":h=p*.516,n=p-h,v=Math.cos(c+_e)*n,r=Math.cos(c+_e)*(f?f/2-h:n),a=Math.sin(c+_e)*n,l=Math.sin(c+_e)*(f?f/2-h:n),i.arc(e-r,s-a,h,c-Ct,c-Dt),i.arc(e+l,s-v,h,c-Dt,c),i.arc(e+r,s+a,h,c,c+Dt),i.arc(e-l,s+v,h,c+Dt,c+Ct),i.closePath();break;case"rect":if(!d){n=Math.SQRT1_2*p,u=f?f/2:n,i.rect(e-u,s-n,2*u,2*n);break}c+=_e;case"rectRot":r=Math.cos(c)*(f?f/2:p),v=Math.cos(c)*p,a=Math.sin(c)*p,l=Math.sin(c)*(f?f/2:p),i.moveTo(e-r,s-a),i.lineTo(e+l,s-v),i.lineTo(e+r,s+a),i.lineTo(e-l,s+v),i.closePath();break;case"crossRot":c+=_e;case"cross":r=Math.cos(c)*(f?f/2:p),v=Math.cos(c)*p,a=Math.sin(c)*p,l=Math.sin(c)*(f?f/2:p),i.moveTo(e-r,s-a),i.lineTo(e+r,s+a),i.moveTo(e+l,s-v),i.lineTo(e-l,s+v);break;case"star":r=Math.cos(c)*(f?f/2:p),v=Math.cos(c)*p,a=Math.sin(c)*p,l=Math.sin(c)*(f?f/2:p),i.moveTo(e-r,s-a),i.lineTo(e+r,s+a),i.moveTo(e+l,s-v),i.lineTo(e-l,s+v),c+=_e,r=Math.cos(c)*(f?f/2:p),v=Math.cos(c)*p,a=Math.sin(c)*p,l=Math.sin(c)*(f?f/2:p),i.moveTo(e-r,s-a),i.lineTo(e+r,s+a),i.moveTo(e+l,s-v),i.lineTo(e-l,s+v);break;case"line":v=f?f/2:Math.cos(c)*p,a=Math.sin(c)*p,i.moveTo(e-v,s-a),i.lineTo(e+v,s+a);break;case"dash":i.moveTo(e,s),i.lineTo(e+Math.cos(c)*(f?f/2:p),s+Math.sin(c)*p);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function ee(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function Fr(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function Lr(i){i.restore()}function Wa(i,t,e,s,f){if(!t)return i.lineTo(e.x,e.y);if(f==="middle"){const g=(t.x+e.x)/2;i.lineTo(g,t.y),i.lineTo(g,e.y)}else f==="after"!=!!s?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function Na(i,t,e,s){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function Va(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),gt(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function Xa(i,t,e,s,f){if(f.strikethrough||f.underline){const g=i.measureText(s),v=t-g.actualBoundingBoxLeft,a=t+g.actualBoundingBoxRight,n=e-g.actualBoundingBoxAscent,h=e+g.actualBoundingBoxDescent,u=f.strikethrough?(n+h)/2:h;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=f.decorationWidth||2,i.moveTo(v,u),i.lineTo(a,u),i.stroke()}}function Ya(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function ci(i,t,e,s,f,g={}){const v=yt(t)?t:[t],a=g.strokeWidth>0&&g.strokeColor!=="";let n,h;for(i.save(),i.font=f.string,Va(i,g),n=0;n<v.length;++n)h=v[n],g.backdrop&&Ya(i,g.backdrop),a&&(g.strokeColor&&(i.strokeStyle=g.strokeColor),gt(g.strokeWidth)||(i.lineWidth=g.strokeWidth),i.strokeText(h,e,s,g.maxWidth)),i.fillText(h,e,s,g.maxWidth),Xa(i,e,s,h,g),s+=Number(f.lineHeight);i.restore()}function qi(i,t){const{x:e,y:s,w:f,h:g,radius:v}=t;i.arc(e+v.topLeft,s+v.topLeft,v.topLeft,1.5*Ct,Ct,!0),i.lineTo(e,s+g-v.bottomLeft),i.arc(e+v.bottomLeft,s+g-v.bottomLeft,v.bottomLeft,Ct,Dt,!0),i.lineTo(e+f-v.bottomRight,s+g),i.arc(e+f-v.bottomRight,s+g-v.bottomRight,v.bottomRight,Dt,0,!0),i.lineTo(e+f,s+v.topRight),i.arc(e+f-v.topRight,s+v.topRight,v.topRight,0,-Dt,!0),i.lineTo(e+v.topLeft,s)}const Ha=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Ua=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Ga(i,t){const e=(""+i).match(Ha);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const $a=i=>+i||0;function Ir(i,t){const e={},s=dt(t),f=s?Object.keys(t):t,g=dt(i)?s?v=>pt(i[v],i[t[v]]):v=>i[v]:()=>i;for(const v of f)e[v]=$a(g(v));return e}function Rr(i){return Ir(i,{top:"y",right:"x",bottom:"y",left:"x"})}function Re(i){return Ir(i,["topLeft","topRight","bottomLeft","bottomRight"])}function jt(i){const t=Rr(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Et(i,t){i=i||{},t=t||wt.font;let e=pt(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=pt(i.style,t.style);s&&!(""+s).match(Ua)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const f={family:pt(i.family,t.family),lineHeight:Ga(pt(i.lineHeight,t.lineHeight),e),size:e,style:s,weight:pt(i.weight,t.weight),string:""};return f.string=Ba(f),f}function Ge(i,t,e,s){let f=!0,g,v,a;for(g=0,v=i.length;g<v;++g)if(a=i[g],a!==void 0&&(t!==void 0&&typeof a=="function"&&(a=a(t),f=!1),e!==void 0&&yt(a)&&(a=a[e%a.length],f=!1),a!==void 0))return s&&!f&&(s.cacheable=!1),a}function qa(i,t,e){const{min:s,max:f}=i,g=wr(t,(f-s)/2),v=(a,n)=>e&&a===0?0:a+n;return{min:v(s,-Math.abs(g)),max:v(f,g)}}function me(i,t){return Object.assign(Object.create(i),t)}function Vn(i,t=[""],e,s,f=()=>i[0]){const g=e||i;typeof s>"u"&&(s=Wr("_fallback",i));const v={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:g,_fallback:s,_getTarget:f,override:a=>Vn([a,...i],t,g,s)};return new Proxy(v,{deleteProperty(a,n){return delete a[n],delete a._keys,delete i[0][n],!0},get(a,n){return jr(a,n,()=>nl(n,t,i,a))},getOwnPropertyDescriptor(a,n){return Reflect.getOwnPropertyDescriptor(a._scopes[0],n)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(a,n){return ds(a).includes(n)},ownKeys(a){return ds(a)},set(a,n,h){const u=a._storage||(a._storage=f());return a[n]=u[n]=h,delete a._keys,!0}})}function je(i,t,e,s){const f={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:Br(i,s),setContext:g=>je(i,g,e,s),override:g=>je(i.override(g),t,e,s)};return new Proxy(f,{deleteProperty(g,v){return delete g[v],delete i[v],!0},get(g,v,a){return jr(g,v,()=>Ja(g,v,a))},getOwnPropertyDescriptor(g,v){return g._descriptors.allKeys?Reflect.has(i,v)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,v)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(g,v){return Reflect.has(i,v)},ownKeys(){return Reflect.ownKeys(i)},set(g,v,a){return i[v]=a,delete g[v],!0}})}function Br(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:f=t.allKeys}=i;return{allKeys:f,scriptable:e,indexable:s,isScriptable:ue(e)?e:()=>e,isIndexable:ue(s)?s:()=>s}}const Ka=(i,t)=>i?i+jn(t):t,Xn=(i,t)=>dt(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function jr(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t))return i[t];const s=e();return i[t]=s,s}function Ja(i,t,e){const{_proxy:s,_context:f,_subProxy:g,_descriptors:v}=i;let a=s[t];return ue(a)&&v.isScriptable(t)&&(a=Qa(t,a,i,e)),yt(a)&&a.length&&(a=Za(t,a,i,v.isIndexable)),Xn(t,a)&&(a=je(a,f,g&&g[t],v)),a}function Qa(i,t,e,s){const{_proxy:f,_context:g,_subProxy:v,_stack:a}=e;if(a.has(i))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+i);a.add(i);let n=t(g,v||s);return a.delete(i),Xn(i,n)&&(n=Yn(f._scopes,f,i,n)),n}function Za(i,t,e,s){const{_proxy:f,_context:g,_subProxy:v,_descriptors:a}=e;if(typeof g.index<"u"&&s(i))return t[g.index%t.length];if(dt(t[0])){const n=t,h=f._scopes.filter(u=>u!==n);t=[];for(const u of n){const r=Yn(h,f,i,u);t.push(je(r,g,v&&v[i],a))}}return t}function zr(i,t,e){return ue(i)?i(t,e):i}const tl=(i,t)=>i===!0?t:typeof i=="string"?ce(t,i):void 0;function el(i,t,e,s,f){for(const g of t){const v=tl(e,g);if(v){i.add(v);const a=zr(v._fallback,e,f);if(typeof a<"u"&&a!==e&&a!==s)return a}else if(v===!1&&typeof s<"u"&&e!==s)return null}return!1}function Yn(i,t,e,s){const f=t._rootScopes,g=zr(t._fallback,e,s),v=[...i,...f],a=new Set;a.add(s);let n=fs(a,v,e,g||e,s);return n===null||typeof g<"u"&&g!==e&&(n=fs(a,v,g,n,s),n===null)?!1:Vn(Array.from(a),[""],f,g,()=>il(t,e,s))}function fs(i,t,e,s,f){for(;e;)e=el(i,t,e,s,f);return e}function il(i,t,e){const s=i._getTarget();t in s||(s[t]={});const f=s[t];return yt(f)&&dt(e)?e:f||{}}function nl(i,t,e,s){let f;for(const g of t)if(f=Wr(Ka(g,i),e),typeof f<"u")return Xn(i,f)?Yn(e,s,i,f):f}function Wr(i,t){for(const e of t){if(!e)continue;const s=e[i];if(typeof s<"u")return s}}function ds(i){let t=i._keys;return t||(t=i._keys=sl(i._scopes)),t}function sl(i){const t=new Set;for(const e of i)for(const s of Object.keys(e).filter(f=>!f.startsWith("_")))t.add(s);return Array.from(t)}function rl(i,t,e,s){const{iScale:f}=i,{key:g="r"}=this._parsing,v=new Array(s);let a,n,h,u;for(a=0,n=s;a<n;++a)h=a+e,u=t[h],v[a]={r:f.parse(ce(u,g),h)};return v}const ol=Number.EPSILON||1e-14,ze=(i,t)=>t<i.length&&!i[t].skip&&i[t],Nr=i=>i==="x"?"y":"x";function al(i,t,e,s){const f=i.skip?t:i,g=t,v=e.skip?t:e,a=xn(g,f),n=xn(v,g);let h=a/(a+n),u=n/(a+n);h=isNaN(h)?0:h,u=isNaN(u)?0:u;const r=s*h,l=s*u;return{previous:{x:g.x-r*(v.x-f.x),y:g.y-r*(v.y-f.y)},next:{x:g.x+l*(v.x-f.x),y:g.y+l*(v.y-f.y)}}}function ll(i,t,e){const s=i.length;let f,g,v,a,n,h=ze(i,0);for(let u=0;u<s-1;++u)if(n=h,h=ze(i,u+1),!(!n||!h)){if(ti(t[u],0,ol)){e[u]=e[u+1]=0;continue}f=e[u]/t[u],g=e[u+1]/t[u],a=Math.pow(f,2)+Math.pow(g,2),!(a<=9)&&(v=3/Math.sqrt(a),e[u]=f*v*t[u],e[u+1]=g*v*t[u])}}function hl(i,t,e="x"){const s=Nr(e),f=i.length;let g,v,a,n=ze(i,0);for(let h=0;h<f;++h){if(v=a,a=n,n=ze(i,h+1),!a)continue;const u=a[e],r=a[s];v&&(g=(u-v[e])/3,a[`cp1${e}`]=u-g,a[`cp1${s}`]=r-g*t[h]),n&&(g=(n[e]-u)/3,a[`cp2${e}`]=u+g,a[`cp2${s}`]=r+g*t[h])}}function cl(i,t="x"){const e=Nr(t),s=i.length,f=Array(s).fill(0),g=Array(s);let v,a,n,h=ze(i,0);for(v=0;v<s;++v)if(a=n,n=h,h=ze(i,v+1),!!n){if(h){const u=h[t]-n[t];f[v]=u!==0?(h[e]-n[e])/u:0}g[v]=a?h?Ut(f[v-1])!==Ut(f[v])?0:(f[v-1]+f[v])/2:f[v-1]:f[v]}ll(i,f,g),hl(i,g,t)}function yi(i,t,e){return Math.max(Math.min(i,e),t)}function ul(i,t){let e,s,f,g,v,a=ee(i[0],t);for(e=0,s=i.length;e<s;++e)v=g,g=a,a=e<s-1&&ee(i[e+1],t),g&&(f=i[e],v&&(f.cp1x=yi(f.cp1x,t.left,t.right),f.cp1y=yi(f.cp1y,t.top,t.bottom)),a&&(f.cp2x=yi(f.cp2x,t.left,t.right),f.cp2y=yi(f.cp2y,t.top,t.bottom)))}function fl(i,t,e,s,f){let g,v,a,n;if(t.spanGaps&&(i=i.filter(h=>!h.skip)),t.cubicInterpolationMode==="monotone")cl(i,f);else{let h=s?i[i.length-1]:i[0];for(g=0,v=i.length;g<v;++g)a=i[g],n=al(h,a,i[Math.min(g+1,v-(s?0:1))%v],t.tension),a.cp1x=n.previous.x,a.cp1y=n.previous.y,a.cp2x=n.next.x,a.cp2y=n.next.y,h=a}t.capBezierPoints&&ul(i,e)}function Vr(){return typeof window<"u"&&typeof document<"u"}function Hn(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Ki(i,t,e){let s;return typeof i=="string"?(s=parseInt(i,10),i.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=i,s}const en=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function dl(i,t){return en(i).getPropertyValue(t)}const gl=["top","right","bottom","left"];function Te(i,t,e){const s={};e=e?"-"+e:"";for(let f=0;f<4;f++){const g=gl[f];s[g]=parseFloat(i[t+"-"+g+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const pl=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function ml(i,t){const e=i.touches,s=e&&e.length?e[0]:i,{offsetX:f,offsetY:g}=s;let v=!1,a,n;if(pl(f,g,i.target))a=f,n=g;else{const h=t.getBoundingClientRect();a=s.clientX-h.left,n=s.clientY-h.top,v=!0}return{x:a,y:n,box:v}}function Ce(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:s}=t,f=en(e),g=f.boxSizing==="border-box",v=Te(f,"padding"),a=Te(f,"border","width"),{x:n,y:h,box:u}=ml(i,e),r=v.left+(u&&a.left),l=v.top+(u&&a.top);let{width:o,height:d}=t;return g&&(o-=v.width+a.width,d-=v.height+a.height),{x:Math.round((n-r)/o*e.width/s),y:Math.round((h-l)/d*e.height/s)}}function vl(i,t,e){let s,f;if(t===void 0||e===void 0){const g=Hn(i);if(!g)t=i.clientWidth,e=i.clientHeight;else{const v=g.getBoundingClientRect(),a=en(g),n=Te(a,"border","width"),h=Te(a,"padding");t=v.width-h.width-n.width,e=v.height-h.height-n.height,s=Ki(a.maxWidth,g,"clientWidth"),f=Ki(a.maxHeight,g,"clientHeight")}}return{width:t,height:e,maxWidth:s||Ui,maxHeight:f||Ui}}const xi=i=>Math.round(i*10)/10;function _l(i,t,e,s){const f=en(i),g=Te(f,"margin"),v=Ki(f.maxWidth,i,"clientWidth")||Ui,a=Ki(f.maxHeight,i,"clientHeight")||Ui,n=vl(i,t,e);let{width:h,height:u}=n;if(f.boxSizing==="content-box"){const l=Te(f,"border","width"),o=Te(f,"padding");h-=o.width+l.width,u-=o.height+l.height}return h=Math.max(0,h-g.width),u=Math.max(0,s?h/s:u-g.height),h=xi(Math.min(h,v,n.maxWidth)),u=xi(Math.min(u,a,n.maxHeight)),h&&!u&&(u=xi(h/2)),(t!==void 0||e!==void 0)&&s&&n.height&&u>n.height&&(u=n.height,h=xi(Math.floor(u*s))),{width:h,height:u}}function gs(i,t,e){const s=t||1,f=Math.floor(i.height*s),g=Math.floor(i.width*s);i.height=Math.floor(i.height),i.width=Math.floor(i.width);const v=i.canvas;return v.style&&(e||!v.style.height&&!v.style.width)&&(v.style.height=`${i.height}px`,v.style.width=`${i.width}px`),i.currentDevicePixelRatio!==s||v.height!==f||v.width!==g?(i.currentDevicePixelRatio=s,v.height=f,v.width=g,i.ctx.setTransform(s,0,0,s,0,0),!0):!1}const bl=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch{}return i}();function ps(i,t){const e=dl(i,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function Se(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function yl(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:s==="middle"?e<.5?i.y:t.y:s==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function xl(i,t,e,s){const f={x:i.cp2x,y:i.cp2y},g={x:t.cp1x,y:t.cp1y},v=Se(i,f,e),a=Se(f,g,e),n=Se(g,t,e),h=Se(v,a,e),u=Se(a,n,e);return Se(h,u,e)}const Cl=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},Sl=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function hn(i,t,e){return i?Cl(t,e):Sl()}function wl(i,t){let e,s;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=s)}function Tl(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function Xr(i){return i==="angle"?{between:Gi,compare:xa,normalize:Nt}:{between:Cn,compare:(t,e)=>t-e,normalize:t=>t}}function ms({start:i,end:t,count:e,loop:s,style:f}){return{start:i%e,end:t%e,loop:s&&(t-i+1)%e===0,style:f}}function Ol(i,t,e){const{property:s,start:f,end:g}=e,{between:v,normalize:a}=Xr(s),n=t.length;let{start:h,end:u,loop:r}=i,l,o;if(r){for(h+=n,u+=n,l=0,o=n;l<o&&v(a(t[h%n][s]),f,g);++l)h--,u--;h%=n,u%=n}return u<h&&(u+=n),{start:h,end:u,loop:r,style:i.style}}function kl(i,t,e){if(!e)return[i];const{property:s,start:f,end:g}=e,v=t.length,{compare:a,between:n,normalize:h}=Xr(s),{start:u,end:r,loop:l,style:o}=Ol(i,t,e),d=[];let p=!1,c=null,m,_,b;const y=()=>n(f,b,m)&&a(f,b)!==0,x=()=>a(g,m)===0||n(g,b,m),C=()=>p||y(),w=()=>!p||x();for(let O=u,E=u;O<=r;++O)_=t[O%v],!_.skip&&(m=h(_[s]),m!==b&&(p=n(m,f,g),c===null&&C()&&(c=a(m,f)===0?O:E),c!==null&&w()&&(d.push(ms({start:c,end:O,loop:l,count:v,style:o})),c=null),E=O,b=m));return c!==null&&d.push(ms({start:c,end:r,loop:l,count:v,style:o})),d}function Ml(i,t){const e=[],s=i.segments;for(let f=0;f<s.length;f++){const g=kl(s[f],i.points,t);g.length&&e.push(...g)}return e}function Pl(i,t,e,s){let f=0,g=t-1;if(e&&!s)for(;f<t&&!i[f].skip;)f++;for(;f<t&&i[f].skip;)f++;for(f%=t,e&&(g+=f);g>f&&i[g%t].skip;)g--;return g%=t,{start:f,end:g}}function Dl(i,t,e,s){const f=i.length,g=[];let v=t,a=i[t],n;for(n=t+1;n<=e;++n){const h=i[n%f];h.skip||h.stop?a.skip||(s=!1,g.push({start:t%f,end:(n-1)%f,loop:s}),t=v=h.stop?n:null):(v=n,a.skip&&(t=n)),a=h}return v!==null&&g.push({start:t%f,end:v%f,loop:s}),g}function Al(i,t){const e=i.points,s=i.options.spanGaps,f=e.length;if(!f)return[];const g=!!i._loop,{start:v,end:a}=Pl(e,f,g,s);if(s===!0)return vs(i,[{start:v,end:a,loop:g}],e,t);const n=a<v?a+f:a,h=!!i._fullLoop&&v===0&&a===f-1;return vs(i,Dl(e,v,n,h),e,t)}function vs(i,t,e,s){return!s||!s.setContext||!e?t:El(i,t,e,s)}function El(i,t,e,s){const f=i._chart.getContext(),g=_s(i.options),{_datasetIndex:v,options:{spanGaps:a}}=i,n=e.length,h=[];let u=g,r=t[0].start,l=r;function o(d,p,c,m){const _=a?-1:1;if(d!==p){for(d+=n;e[d%n].skip;)d-=_;for(;e[p%n].skip;)p+=_;d%n!==p%n&&(h.push({start:d%n,end:p%n,loop:c,style:m}),u=m,r=p%n)}}for(const d of t){r=a?r:d.start;let p=e[r%n],c;for(l=r+1;l<=d.end;l++){const m=e[l%n];c=_s(s.setContext(me(f,{type:"segment",p0:p,p1:m,p0DataIndex:(l-1)%n,p1DataIndex:l%n,datasetIndex:v}))),Fl(c,u)&&o(r,l-1,d.loop,u),p=m,u=c}r<l-1&&o(r,l-1,d.loop,u)}return h}function _s(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function Fl(i,t){if(!t)return!1;const e=[],s=function(f,g){return Nn(g)?(e.includes(g)||e.push(g),e.indexOf(g)):g};return JSON.stringify(i,s)!==JSON.stringify(t,s)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class Ll{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,f){const g=e.listeners[f],v=e.duration;g.forEach(a=>a({chart:t,initial:e.initial,numSteps:v,currentStep:Math.min(s-e.start,v)}))}_refresh(){this._request||(this._running=!0,this._request=Pr.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,f)=>{if(!s.running||!s.items.length)return;const g=s.items;let v=g.length-1,a=!1,n;for(;v>=0;--v)n=g[v],n._active?(n._total>s.duration&&(s.duration=n._total),n.tick(t),a=!0):(g[v]=g[g.length-1],g.pop());a&&(f.draw(),this._notify(f,s,t,"progress")),g.length||(s.running=!1,this._notify(f,s,t,"complete"),s.initial=!1),e+=g.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,f)=>Math.max(s,f._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let f=s.length-1;for(;f>=0;--f)s[f].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Jt=new Ll;const bs="transparent",Il={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const s=hs(i||bs),f=s.valid&&hs(t||bs);return f&&f.valid?f.mix(s,e).hexString():t},number(i,t,e){return i+(t-i)*e}};class Rl{constructor(t,e,s,f){const g=e[s];f=Ge([t.to,f,g,t.from]);const v=Ge([t.from,g,f]);this._active=!0,this._fn=t.fn||Il[t.type||typeof v],this._easing=ii[t.easing]||ii.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=v,this._to=f,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const f=this._target[this._prop],g=s-this._start,v=this._duration-g;this._start=s,this._duration=Math.floor(Math.max(v,t.duration)),this._total+=g,this._loop=!!t.loop,this._to=Ge([t.to,e,f,t.from]),this._from=Ge([t.from,f,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,f=this._prop,g=this._from,v=this._loop,a=this._to;let n;if(this._active=g!==a&&(v||e<s),!this._active){this._target[f]=a,this._notify(!0);return}if(e<0){this._target[f]=g;return}n=e/s%2,n=v&&n>1?2-n:n,n=this._easing(Math.min(1,Math.max(0,n))),this._target[f]=this._fn(g,a,n)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let f=0;f<s.length;f++)s[f][e]()}}class Yr{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!dt(t))return;const e=Object.keys(wt.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(f=>{const g=t[f];if(!dt(g))return;const v={};for(const a of e)v[a]=g[a];(yt(g.properties)&&g.properties||[f]).forEach(a=>{(a===f||!s.has(a))&&s.set(a,v)})})}_animateOptions(t,e){const s=e.options,f=jl(t,s);if(!f)return[];const g=this._createAnimations(f,s);return s.$shared&&Bl(t.options.$animations,s).then(()=>{t.options=s},()=>{}),g}_createAnimations(t,e){const s=this._properties,f=[],g=t.$animations||(t.$animations={}),v=Object.keys(e),a=Date.now();let n;for(n=v.length-1;n>=0;--n){const h=v[n];if(h.charAt(0)==="$")continue;if(h==="options"){f.push(...this._animateOptions(t,e));continue}const u=e[h];let r=g[h];const l=s.get(h);if(r)if(l&&r.active()){r.update(l,u,a);continue}else r.cancel();if(!l||!l.duration){t[h]=u;continue}g[h]=r=new Rl(l,t,h,u),f.push(r)}return f}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return Jt.add(this._chart,s),!0}}function Bl(i,t){const e=[],s=Object.keys(t);for(let f=0;f<s.length;f++){const g=i[s[f]];g&&g.active()&&e.push(g.wait())}return Promise.all(e)}function jl(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function ys(i,t){const e=i&&i.options||{},s=e.reverse,f=e.min===void 0?t:0,g=e.max===void 0?t:0;return{start:s?g:f,end:s?f:g}}function zl(i,t,e){if(e===!1)return!1;const s=ys(i,e),f=ys(t,e);return{top:f.end,right:s.end,bottom:f.start,left:s.start}}function Wl(i){let t,e,s,f;return dt(i)?(t=i.top,e=i.right,s=i.bottom,f=i.left):t=e=s=f=i,{top:t,right:e,bottom:s,left:f,disabled:i===!1}}function Hr(i,t){const e=[],s=i._getSortedDatasetMetas(t);let f,g;for(f=0,g=s.length;f<g;++f)e.push(s[f].index);return e}function xs(i,t,e,s={}){const f=i.keys,g=s.mode==="single";let v,a,n,h;if(t!==null){for(v=0,a=f.length;v<a;++v){if(n=+f[v],n===e){if(s.all)continue;break}h=i.values[n],Ot(h)&&(g||t===0||Ut(t)===Ut(h))&&(t+=h)}return t}}function Nl(i){const t=Object.keys(i),e=new Array(t.length);let s,f,g;for(s=0,f=t.length;s<f;++s)g=t[s],e[s]={x:g,y:i[g]};return e}function Cs(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function Vl(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function Xl(i){const{min:t,max:e,minDefined:s,maxDefined:f}=i.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:f?e:Number.POSITIVE_INFINITY}}function Yl(i,t,e){const s=i[t]||(i[t]={});return s[e]||(s[e]={})}function Ss(i,t,e,s){for(const f of t.getMatchingVisibleMetas(s).reverse()){const g=i[f.index];if(e&&g>0||!e&&g<0)return f.index}return null}function ws(i,t){const{chart:e,_cachedMeta:s}=i,f=e._stacks||(e._stacks={}),{iScale:g,vScale:v,index:a}=s,n=g.axis,h=v.axis,u=Vl(g,v,s),r=t.length;let l;for(let o=0;o<r;++o){const d=t[o],{[n]:p,[h]:c}=d,m=d._stacks||(d._stacks={});l=m[h]=Yl(f,u,p),l[a]=c,l._top=Ss(l,v,!0,s.type),l._bottom=Ss(l,v,!1,s.type);const _=l._visualValues||(l._visualValues={});_[a]=c}}function cn(i,t){const e=i.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function Hl(i,t){return me(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Ul(i,t,e){return me(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Ne(i,t){const e=i.controller.index,s=i.vScale&&i.vScale.axis;if(s){t=t||i._parsed;for(const f of t){const g=f._stacks;if(!g||g[s]===void 0||g[s][e]===void 0)return;delete g[s][e],g[s]._visualValues!==void 0&&g[s]._visualValues[e]!==void 0&&delete g[s]._visualValues[e]}}}const un=i=>i==="reset"||i==="none",Ts=(i,t)=>t?i:Object.assign({},i),Gl=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:Hr(e,!0),values:null};class ae{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Cs(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Ne(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),f=(r,l,o,d)=>r==="x"?l:r==="r"?d:o,g=e.xAxisID=pt(s.xAxisID,cn(t,"x")),v=e.yAxisID=pt(s.yAxisID,cn(t,"y")),a=e.rAxisID=pt(s.rAxisID,cn(t,"r")),n=e.indexAxis,h=e.iAxisID=f(n,g,v,a),u=e.vAxisID=f(n,v,g,a);e.xScale=this.getScaleForId(g),e.yScale=this.getScaleForId(v),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(h),e.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&os(this._data,this),t._stacked&&Ne(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(dt(e))this._data=Nl(e);else if(s!==e){if(s){os(s,this);const f=this._cachedMeta;Ne(f),f._parsed=[]}e&&Object.isExtensible(e)&&Ta(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let f=!1;this._dataCheck();const g=e._stacked;e._stacked=Cs(e.vScale,e),e.stack!==s.stack&&(f=!0,Ne(e),e.stack=s.stack),this._resyncElements(t),(f||g!==e._stacked)&&ws(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:f}=this,{iScale:g,_stacked:v}=s,a=g.axis;let n=t===0&&e===f.length?!0:s._sorted,h=t>0&&s._parsed[t-1],u,r,l;if(this._parsing===!1)s._parsed=f,s._sorted=!0,l=f;else{yt(f[t])?l=this.parseArrayData(s,f,t,e):dt(f[t])?l=this.parseObjectData(s,f,t,e):l=this.parsePrimitiveData(s,f,t,e);const o=()=>r[a]===null||h&&r[a]<h[a];for(u=0;u<e;++u)s._parsed[u+t]=r=l[u],n&&(o()&&(n=!1),h=r);s._sorted=n}v&&ws(this,l)}parsePrimitiveData(t,e,s,f){const{iScale:g,vScale:v}=t,a=g.axis,n=v.axis,h=g.getLabels(),u=g===v,r=new Array(f);let l,o,d;for(l=0,o=f;l<o;++l)d=l+s,r[l]={[a]:u||g.parse(h[d],d),[n]:v.parse(e[d],d)};return r}parseArrayData(t,e,s,f){const{xScale:g,yScale:v}=t,a=new Array(f);let n,h,u,r;for(n=0,h=f;n<h;++n)u=n+s,r=e[u],a[n]={x:g.parse(r[0],u),y:v.parse(r[1],u)};return a}parseObjectData(t,e,s,f){const{xScale:g,yScale:v}=t,{xAxisKey:a="x",yAxisKey:n="y"}=this._parsing,h=new Array(f);let u,r,l,o;for(u=0,r=f;u<r;++u)l=u+s,o=e[l],h[u]={x:g.parse(ce(o,a),l),y:v.parse(ce(o,n),l)};return h}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const f=this.chart,g=this._cachedMeta,v=e[t.axis],a={keys:Hr(f,!0),values:e._stacks[t.axis]._visualValues};return xs(a,v,g.index,{mode:s})}updateRangeFromParsed(t,e,s,f){const g=s[e.axis];let v=g===null?NaN:g;const a=f&&s._stacks[e.axis];f&&a&&(f.values=a,v=xs(f,g,this._cachedMeta.index)),t.min=Math.min(t.min,v),t.max=Math.max(t.max,v)}getMinMax(t,e){const s=this._cachedMeta,f=s._parsed,g=s._sorted&&t===s.iScale,v=f.length,a=this._getOtherScale(t),n=Gl(e,s,this.chart),h={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:r}=Xl(a);let l,o;function d(){o=f[l];const p=o[a.axis];return!Ot(o[t.axis])||u>p||r<p}for(l=0;l<v&&!(!d()&&(this.updateRangeFromParsed(h,t,o,n),g));++l);if(g){for(l=v-1;l>=0;--l)if(!d()){this.updateRangeFromParsed(h,t,o,n);break}}return h}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let f,g,v;for(f=0,g=e.length;f<g;++f)v=e[f][t.axis],Ot(v)&&s.push(v);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,f=e.vScale,g=this.getParsed(t);return{label:s?""+s.getLabelForValue(g[s.axis]):"",value:f?""+f.getLabelForValue(g[f.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Wl(pt(this.options.clip,zl(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,f=s.data||[],g=e.chartArea,v=[],a=this._drawStart||0,n=this._drawCount||f.length-a,h=this.options.drawActiveElementsOnTop;let u;for(s.dataset&&s.dataset.draw(t,g,a,n),u=a;u<a+n;++u){const r=f[u];r.hidden||(r.active&&h?v.push(r):r.draw(t,g))}for(u=0;u<v.length;++u)v[u].draw(t,g)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const f=this.getDataset();let g;if(t>=0&&t<this._cachedMeta.data.length){const v=this._cachedMeta.data[t];g=v.$context||(v.$context=Ul(this.getContext(),t,v)),g.parsed=this.getParsed(t),g.raw=f.data[t],g.index=g.dataIndex=t}else g=this.$context||(this.$context=Hl(this.chart.getContext(),this.index)),g.dataset=f,g.index=g.datasetIndex=this.index;return g.active=!!e,g.mode=s,g}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const f=e==="active",g=this._cachedDataOpts,v=t+"-"+e,a=g[v],n=this.enableOptionSharing&&li(s);if(a)return Ts(a,n);const h=this.chart.config,u=h.datasetElementScopeKeys(this._type,t),r=f?[`${t}Hover`,"hover",t,""]:[t,""],l=h.getOptionScopes(this.getDataset(),u),o=Object.keys(wt.elements[t]),d=()=>this.getContext(s,f,e),p=h.resolveNamedOptions(l,o,d,r);return p.$shared&&(p.$shared=n,g[v]=Object.freeze(Ts(p,n))),p}_resolveAnimations(t,e,s){const f=this.chart,g=this._cachedDataOpts,v=`animation-${e}`,a=g[v];if(a)return a;let n;if(f.options.animation!==!1){const u=this.chart.config,r=u.datasetAnimationScopeKeys(this._type,e),l=u.getOptionScopes(this.getDataset(),r);n=u.createResolver(l,this.getContext(t,s,e))}const h=new Yr(f,n&&n.animations);return n&&n._cacheable&&(g[v]=Object.freeze(h)),h}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||un(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),f=this._sharedOptions,g=this.getSharedOptions(s),v=this.includeOptions(e,g)||g!==f;return this.updateSharedOptions(g,e,s),{sharedOptions:g,includeOptions:v}}updateElement(t,e,s,f){un(f)?Object.assign(t,s):this._resolveAnimations(e,f).update(t,s)}updateSharedOptions(t,e,s){t&&!un(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,f){t.active=f;const g=this.getStyle(e,f);this._resolveAnimations(e,s,f).update(t,{options:!f&&this.getSharedOptions(g)||g})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[a,n,h]of this._syncList)this[a](n,h);this._syncList=[];const f=s.length,g=e.length,v=Math.min(g,f);v&&this.parse(0,v),g>f?this._insertElements(f,g-f,t):g<f&&this._removeElements(g,f-g)}_insertElements(t,e,s=!0){const f=this._cachedMeta,g=f.data,v=t+e;let a;const n=h=>{for(h.length+=e,a=h.length-1;a>=v;a--)h[a]=h[a-e]};for(n(g),a=t;a<v;++a)g[a]=new this.dataElementType;this._parsing&&n(f._parsed),this.parse(t,e),s&&this.updateElements(g,t,e,"reset")}updateElements(t,e,s,f){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const f=s._parsed.splice(t,e);s._stacked&&Ne(s,f)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,f]=t;this[e](s,f)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}nt(ae,"defaults",{}),nt(ae,"datasetElementType",null),nt(ae,"dataElementType",null);function $l(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let s=[];for(let f=0,g=e.length;f<g;f++)s=s.concat(e[f].controller.getAllParsedValues(i));i._cache.$bar=Mr(s.sort((f,g)=>f-g))}return i._cache.$bar}function ql(i){const t=i.iScale,e=$l(t,i.type);let s=t._length,f,g,v,a;const n=()=>{v===32767||v===-32768||(li(a)&&(s=Math.min(s,Math.abs(v-a)||s)),a=v)};for(f=0,g=e.length;f<g;++f)v=t.getPixelForValue(e[f]),n();for(a=void 0,f=0,g=t.ticks.length;f<g;++f)v=t.getPixelForTick(f),n();return s}function Kl(i,t,e,s){const f=e.barThickness;let g,v;return gt(f)?(g=t.min*e.categoryPercentage,v=e.barPercentage):(g=f*s,v=1),{chunk:g/s,ratio:v,start:t.pixels[i]-g/2}}function Jl(i,t,e,s){const f=t.pixels,g=f[i];let v=i>0?f[i-1]:null,a=i<f.length-1?f[i+1]:null;const n=e.categoryPercentage;v===null&&(v=g-(a===null?t.end-t.start:a-g)),a===null&&(a=g+g-v);const h=g-(g-Math.min(v,a))/2*n;return{chunk:Math.abs(a-v)/2*n/s,ratio:e.barPercentage,start:h}}function Ql(i,t,e,s){const f=e.parse(i[0],s),g=e.parse(i[1],s),v=Math.min(f,g),a=Math.max(f,g);let n=v,h=a;Math.abs(v)>Math.abs(a)&&(n=a,h=v),t[e.axis]=h,t._custom={barStart:n,barEnd:h,start:f,end:g,min:v,max:a}}function Ur(i,t,e,s){return yt(i)?Ql(i,t,e,s):t[e.axis]=e.parse(i,s),t}function Os(i,t,e,s){const f=i.iScale,g=i.vScale,v=f.getLabels(),a=f===g,n=[];let h,u,r,l;for(h=e,u=e+s;h<u;++h)l=t[h],r={},r[f.axis]=a||f.parse(v[h],h),n.push(Ur(l,r,g,h));return n}function fn(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function Zl(i,t,e){return i!==0?Ut(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function th(i){let t,e,s,f,g;return i.horizontal?(t=i.base>i.x,e="left",s="right"):(t=i.base<i.y,e="bottom",s="top"),t?(f="end",g="start"):(f="start",g="end"),{start:e,end:s,reverse:t,top:f,bottom:g}}function eh(i,t,e,s){let f=t.borderSkipped;const g={};if(!f){i.borderSkipped=g;return}if(f===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:v,end:a,reverse:n,top:h,bottom:u}=th(i);f==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===s?f=h:(e._bottom||0)===s?f=u:(g[ks(u,v,a,n)]=!0,f=h)),g[ks(f,v,a,n)]=!0,i.borderSkipped=g}function ks(i,t,e,s){return s?(i=ih(i,t,e),i=Ms(i,e,t)):i=Ms(i,t,e),i}function ih(i,t,e){return i===t?e:i===e?t:i}function Ms(i,t,e){return i==="start"?t:i==="end"?e:i}function nh(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class Fi extends ae{parsePrimitiveData(t,e,s,f){return Os(t,e,s,f)}parseArrayData(t,e,s,f){return Os(t,e,s,f)}parseObjectData(t,e,s,f){const{iScale:g,vScale:v}=t,{xAxisKey:a="x",yAxisKey:n="y"}=this._parsing,h=g.axis==="x"?a:n,u=v.axis==="x"?a:n,r=[];let l,o,d,p;for(l=s,o=s+f;l<o;++l)p=e[l],d={},d[g.axis]=g.parse(ce(p,h),l),r.push(Ur(ce(p,u),d,v,l));return r}updateRangeFromParsed(t,e,s,f){super.updateRangeFromParsed(t,e,s,f);const g=s._custom;g&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,g.min),t.max=Math.max(t.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:f}=e,g=this.getParsed(t),v=g._custom,a=fn(v)?"["+v.start+", "+v.end+"]":""+f.getLabelForValue(g[f.axis]);return{label:""+s.getLabelForValue(g[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,f){const g=f==="reset",{index:v,_cachedMeta:{vScale:a}}=this,n=a.getBasePixel(),h=a.isHorizontal(),u=this._getRuler(),{sharedOptions:r,includeOptions:l}=this._getSharedOptions(e,f);for(let o=e;o<e+s;o++){const d=this.getParsed(o),p=g||gt(d[a.axis])?{base:n,head:n}:this._calculateBarValuePixels(o),c=this._calculateBarIndexPixels(o,u),m=(d._stacks||{})[a.axis],_={horizontal:h,base:p.base,enableBorderRadius:!m||fn(d._custom)||v===m._top||v===m._bottom,x:h?p.head:c.center,y:h?c.center:p.head,height:h?c.size:Math.abs(p.size),width:h?Math.abs(p.size):c.size};l&&(_.options=r||this.resolveDataElementOptions(o,t[o].active?"active":f));const b=_.options||t[o].options;eh(_,b,m,v),nh(_,b,u.ratio),this.updateElement(t[o],o,_,f)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,f=s.getMatchingVisibleMetas(this._type).filter(n=>n.controller.options.grouped),g=s.options.stacked,v=[],a=n=>{const h=n.controller.getParsed(e),u=h&&h[n.vScale.axis];if(gt(u)||isNaN(u))return!0};for(const n of f)if(!(e!==void 0&&a(n))&&((g===!1||v.indexOf(n.stack)===-1||g===void 0&&n.stack===void 0)&&v.push(n.stack),n.index===t))break;return v.length||v.push(void 0),v}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,s){const f=this._getStacks(t,s),g=e!==void 0?f.indexOf(e):-1;return g===-1?f.length-1:g}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,f=[];let g,v;for(g=0,v=e.data.length;g<v;++g)f.push(s.getPixelForValue(this.getParsed(g)[s.axis],g));const a=t.barThickness;return{min:a||ql(e),pixels:f,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:f},options:{base:g,minBarLength:v}}=this,a=g||0,n=this.getParsed(t),h=n._custom,u=fn(h);let r=n[e.axis],l=0,o=s?this.applyStack(e,n,s):r,d,p;o!==r&&(l=o-r,o=r),u&&(r=h.barStart,o=h.barEnd-h.barStart,r!==0&&Ut(r)!==Ut(h.barEnd)&&(l=0),l+=r);const c=!gt(g)&&!u?g:l;let m=e.getPixelForValue(c);if(this.chart.getDataVisibility(t)?d=e.getPixelForValue(l+o):d=m,p=d-m,Math.abs(p)<v){p=Zl(p,e,a)*v,r===a&&(m-=p/2);const _=e.getPixelForDecimal(0),b=e.getPixelForDecimal(1),y=Math.min(_,b),x=Math.max(_,b);m=Math.max(Math.min(m,x),y),d=m+p,s&&!u&&(n._stacks[e.axis]._visualValues[f]=e.getValueForPixel(d)-e.getValueForPixel(m))}if(m===e.getPixelForValue(a)){const _=Ut(p)*e.getLineWidthForValue(a)/2;m+=_,p-=_}return{size:p,base:m,head:d,center:d+p/2}}_calculateBarIndexPixels(t,e){const s=e.scale,f=this.options,g=f.skipNull,v=pt(f.maxBarThickness,1/0);let a,n;if(e.grouped){const h=g?this._getStackCount(t):e.stackCount,u=f.barThickness==="flex"?Jl(t,e,f,h):Kl(t,e,f,h),r=this._getStackIndex(this.index,this._cachedMeta.stack,g?t:void 0);a=u.start+u.chunk*r+u.chunk/2,n=Math.min(v,u.chunk*u.ratio)}else a=s.getPixelForValue(this.getParsed(t)[s.axis],t),n=Math.min(v,e.min*e.ratio);return{base:a-n/2,head:a+n/2,center:a,size:n}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,f=s.length;let g=0;for(;g<f;++g)this.getParsed(g)[e.axis]!==null&&s[g].draw(this._ctx)}}nt(Fi,"id","bar"),nt(Fi,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),nt(Fi,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function sh(i,t,e){let s=1,f=1,g=0,v=0;if(t<kt){const a=i,n=a+t,h=Math.cos(a),u=Math.sin(a),r=Math.cos(n),l=Math.sin(n),o=(b,y,x)=>Gi(b,a,n,!0)?1:Math.max(y,y*e,x,x*e),d=(b,y,x)=>Gi(b,a,n,!0)?-1:Math.min(y,y*e,x,x*e),p=o(0,h,r),c=o(Dt,u,l),m=d(Ct,h,r),_=d(Ct+Dt,u,l);s=(p-m)/2,f=(c-_)/2,g=-(p+m)/2,v=-(c+_)/2}return{ratioX:s,ratioY:f,offsetX:g,offsetY:v}}class $e extends ae{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,f=this._cachedMeta;if(this._parsing===!1)f._parsed=s;else{let g=n=>+s[n];if(dt(s[t])){const{key:n="value"}=this._parsing;g=h=>+ce(s[h],n)}let v,a;for(v=t,a=t+e;v<a;++v)f._parsed[v]=g(v)}}_getRotation(){return Vt(this.options.rotation-90)}_getCircumference(){return Vt(this.options.circumference)}_getRotationExtents(){let t=kt,e=-kt;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const f=this.chart.getDatasetMeta(s).controller,g=f._getRotation(),v=f._getCircumference();t=Math.min(t,g),e=Math.max(e,g+v)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,f=this._cachedMeta,g=f.data,v=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-v)/2,0),n=Math.min(ca(this.options.cutout,a),1),h=this._getRingWeight(this.index),{circumference:u,rotation:r}=this._getRotationExtents(),{ratioX:l,ratioY:o,offsetX:d,offsetY:p}=sh(r,u,n),c=(s.width-v)/l,m=(s.height-v)/o,_=Math.max(Math.min(c,m)/2,0),b=wr(this.options.radius,_),y=Math.max(b*n,0),x=(b-y)/this._getVisibleDatasetWeightTotal();this.offsetX=d*b,this.offsetY=p*b,f.total=this.calculateTotal(),this.outerRadius=b-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*h,0),this.updateElements(g,0,g.length,t)}_circumference(t,e){const s=this.options,f=this._cachedMeta,g=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||f._parsed[t]===null||f.data[t].hidden?0:this.calculateCircumference(f._parsed[t]*g/kt)}updateElements(t,e,s,f){const g=f==="reset",v=this.chart,a=v.chartArea,h=v.options.animation,u=(a.left+a.right)/2,r=(a.top+a.bottom)/2,l=g&&h.animateScale,o=l?0:this.innerRadius,d=l?0:this.outerRadius,{sharedOptions:p,includeOptions:c}=this._getSharedOptions(e,f);let m=this._getRotation(),_;for(_=0;_<e;++_)m+=this._circumference(_,g);for(_=e;_<e+s;++_){const b=this._circumference(_,g),y=t[_],x={x:u+this.offsetX,y:r+this.offsetY,startAngle:m,endAngle:m+b,circumference:b,outerRadius:d,innerRadius:o};c&&(x.options=p||this.resolveDataElementOptions(_,y.active?"active":f)),m+=b,this.updateElement(y,_,x,f)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,f;for(f=0;f<e.length;f++){const g=t._parsed[f];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(f)&&!e[f].hidden&&(s+=Math.abs(g))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?kt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,f=s.data.labels||[],g=gi(e._parsed[t],s.options.locale);return{label:f[t]||"",value:g}}getMaxBorderWidth(t){let e=0;const s=this.chart;let f,g,v,a,n;if(!t){for(f=0,g=s.data.datasets.length;f<g;++f)if(s.isDatasetVisible(f)){v=s.getDatasetMeta(f),t=v.data,a=v.controller;break}}if(!t)return 0;for(f=0,g=t.length;f<g;++f)n=a.resolveDataElementOptions(f),n.borderAlign!=="inner"&&(e=Math.max(e,n.borderWidth||0,n.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,f=t.length;s<f;++s){const g=this.resolveDataElementOptions(s);e=Math.max(e,g.offset||0,g.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(pt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}nt($e,"id","doughnut"),nt($e,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),nt($e,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),nt($e,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:f}}=t.legend.options;return e.labels.map((g,v)=>{const n=t.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:f,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(v),index:v}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class Li extends ae{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:f=[],_dataset:g}=e,v=this.chart._animationsDisabled;let{start:a,count:n}=ka(e,f,v);this._drawStart=a,this._drawCount=n,Ma(e)&&(a=0,n=f.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!g._decimated,s.points=f;const h=this.resolveDatasetElementOptions(t);this.options.showLine||(h.borderWidth=0),h.segment=this.options.segment,this.updateElement(s,void 0,{animated:!v,options:h},t),this.updateElements(f,a,n,t)}updateElements(t,e,s,f){const g=f==="reset",{iScale:v,vScale:a,_stacked:n,_dataset:h}=this._cachedMeta,{sharedOptions:u,includeOptions:r}=this._getSharedOptions(e,f),l=v.axis,o=a.axis,{spanGaps:d,segment:p}=this.options,c=hi(d)?d:Number.POSITIVE_INFINITY,m=this.chart._animationsDisabled||g||f==="none",_=e+s,b=t.length;let y=e>0&&this.getParsed(e-1);for(let x=0;x<b;++x){const C=t[x],w=m?C:{};if(x<e||x>=_){w.skip=!0;continue}const O=this.getParsed(x),E=gt(O[o]),j=w[l]=v.getPixelForValue(O[l],x),H=w[o]=g||E?a.getBasePixel():a.getPixelForValue(n?this.applyStack(a,O,n):O[o],x);w.skip=isNaN(j)||isNaN(H)||E,w.stop=x>0&&Math.abs(O[l]-y[l])>c,p&&(w.parsed=O,w.raw=h.data[x]),r&&(w.options=u||this.resolveDataElementOptions(x,C.active?"active":f)),m||this.updateElement(C,x,w,f),y=O}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,f=t.data||[];if(!f.length)return s;const g=f[0].size(this.resolveDataElementOptions(0)),v=f[f.length-1].size(this.resolveDataElementOptions(f.length-1));return Math.max(s,g,v)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}nt(Li,"id","line"),nt(Li,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),nt(Li,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Ii extends ae{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,f=s.data.labels||[],g=gi(e._parsed[t].r,s.options.locale);return{label:f[t]||"",value:g}}parseObjectData(t,e,s,f){return rl.bind(this)(t,e,s,f)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,f)=>{const g=this.getParsed(f).r;!isNaN(g)&&this.chart.getDataVisibility(f)&&(g<e.min&&(e.min=g),g>e.max&&(e.max=g))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,f=Math.min(e.right-e.left,e.bottom-e.top),g=Math.max(f/2,0),v=Math.max(s.cutoutPercentage?g/100*s.cutoutPercentage:1,0),a=(g-v)/t.getVisibleDatasetCount();this.outerRadius=g-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,s,f){const g=f==="reset",v=this.chart,n=v.options.animation,h=this._cachedMeta.rScale,u=h.xCenter,r=h.yCenter,l=h.getIndexAngle(0)-.5*Ct;let o=l,d;const p=360/this.countVisibleElements();for(d=0;d<e;++d)o+=this._computeAngle(d,f,p);for(d=e;d<e+s;d++){const c=t[d];let m=o,_=o+this._computeAngle(d,f,p),b=v.getDataVisibility(d)?h.getDistanceFromCenterForValue(this.getParsed(d).r):0;o=_,g&&(n.animateScale&&(b=0),n.animateRotate&&(m=_=l));const y={x:u,y:r,innerRadius:0,outerRadius:b,startAngle:m,endAngle:_,options:this.resolveDataElementOptions(d,c.active?"active":f)};this.updateElement(c,d,y,f)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,f)=>{!isNaN(this.getParsed(f).r)&&this.chart.getDataVisibility(f)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?Vt(this.resolveDataElementOptions(t,e).angle||s):0}}nt(Ii,"id","polarArea"),nt(Ii,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),nt(Ii,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:f}}=t.legend.options;return e.labels.map((g,v)=>{const n=t.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:f,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(v),index:v}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});function ye(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Un{constructor(t){nt(this,"options");this.options=t||{}}static override(t){Object.assign(Un.prototype,t)}init(){}formats(){return ye()}parse(){return ye()}format(){return ye()}add(){return ye()}diff(){return ye()}startOf(){return ye()}endOf(){return ye()}}var rh={_date:Un};function oh(i,t,e,s){const{controller:f,data:g,_sorted:v}=i,a=f._cachedMeta.iScale;if(a&&t===a.axis&&t!=="r"&&v&&g.length){const n=a._reversePixels?Sa:te;if(s){if(f._sharedOptions){const h=g[0],u=typeof h.getRange=="function"&&h.getRange(t);if(u){const r=n(g,t,e-u),l=n(g,t,e+u);return{lo:r.lo,hi:l.hi}}}}else return n(g,t,e)}return{lo:0,hi:g.length-1}}function pi(i,t,e,s,f){const g=i.getSortedVisibleDatasetMetas(),v=e[t];for(let a=0,n=g.length;a<n;++a){const{index:h,data:u}=g[a],{lo:r,hi:l}=oh(g[a],t,v,f);for(let o=r;o<=l;++o){const d=u[o];d.skip||s(d,h,o)}}}function ah(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(s,f){const g=t?Math.abs(s.x-f.x):0,v=e?Math.abs(s.y-f.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(v,2))}}function dn(i,t,e,s,f){const g=[];return!f&&!i.isPointInArea(t)||pi(i,e,t,function(a,n,h){!f&&!ee(a,i.chartArea,0)||a.inRange(t.x,t.y,s)&&g.push({element:a,datasetIndex:n,index:h})},!0),g}function lh(i,t,e,s){let f=[];function g(v,a,n){const{startAngle:h,endAngle:u}=v.getProps(["startAngle","endAngle"],s),{angle:r}=ya(v,{x:t.x,y:t.y});Gi(r,h,u)&&f.push({element:v,datasetIndex:a,index:n})}return pi(i,e,t,g),f}function hh(i,t,e,s,f,g){let v=[];const a=ah(e);let n=Number.POSITIVE_INFINITY;function h(u,r,l){const o=u.inRange(t.x,t.y,f);if(s&&!o)return;const d=u.getCenterPoint(f);if(!(!!g||i.isPointInArea(d))&&!o)return;const c=a(t,d);c<n?(v=[{element:u,datasetIndex:r,index:l}],n=c):c===n&&v.push({element:u,datasetIndex:r,index:l})}return pi(i,e,t,h),v}function gn(i,t,e,s,f,g){return!g&&!i.isPointInArea(t)?[]:e==="r"&&!s?lh(i,t,e,f):hh(i,t,e,s,f,g)}function Ps(i,t,e,s,f){const g=[],v=e==="x"?"inXRange":"inYRange";let a=!1;return pi(i,e,t,(n,h,u)=>{n[v](t[e],f)&&(g.push({element:n,datasetIndex:h,index:u}),a=a||n.inRange(t.x,t.y,f))}),s&&!a?[]:g}var ch={evaluateInteractionItems:pi,modes:{index(i,t,e,s){const f=Ce(t,i),g=e.axis||"x",v=e.includeInvisible||!1,a=e.intersect?dn(i,f,g,s,v):gn(i,f,g,!1,s,v),n=[];return a.length?(i.getSortedVisibleDatasetMetas().forEach(h=>{const u=a[0].index,r=h.data[u];r&&!r.skip&&n.push({element:r,datasetIndex:h.index,index:u})}),n):[]},dataset(i,t,e,s){const f=Ce(t,i),g=e.axis||"xy",v=e.includeInvisible||!1;let a=e.intersect?dn(i,f,g,s,v):gn(i,f,g,!1,s,v);if(a.length>0){const n=a[0].datasetIndex,h=i.getDatasetMeta(n).data;a=[];for(let u=0;u<h.length;++u)a.push({element:h[u],datasetIndex:n,index:u})}return a},point(i,t,e,s){const f=Ce(t,i),g=e.axis||"xy",v=e.includeInvisible||!1;return dn(i,f,g,s,v)},nearest(i,t,e,s){const f=Ce(t,i),g=e.axis||"xy",v=e.includeInvisible||!1;return gn(i,f,g,e.intersect,s,v)},x(i,t,e,s){const f=Ce(t,i);return Ps(i,f,"x",e.intersect,s)},y(i,t,e,s){const f=Ce(t,i);return Ps(i,f,"y",e.intersect,s)}}};const Gr=["left","top","right","bottom"];function Ve(i,t){return i.filter(e=>e.pos===t)}function Ds(i,t){return i.filter(e=>Gr.indexOf(e.pos)===-1&&e.box.axis===t)}function Xe(i,t){return i.sort((e,s)=>{const f=t?s:e,g=t?e:s;return f.weight===g.weight?f.index-g.index:f.weight-g.weight})}function uh(i){const t=[];let e,s,f,g,v,a;for(e=0,s=(i||[]).length;e<s;++e)f=i[e],{position:g,options:{stack:v,stackWeight:a=1}}=f,t.push({index:e,box:f,pos:g,horizontal:f.isHorizontal(),weight:f.weight,stack:v&&g+v,stackWeight:a});return t}function fh(i){const t={};for(const e of i){const{stack:s,pos:f,stackWeight:g}=e;if(!s||!Gr.includes(f))continue;const v=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});v.count++,v.weight+=g}return t}function dh(i,t){const e=fh(i),{vBoxMaxWidth:s,hBoxMaxHeight:f}=t;let g,v,a;for(g=0,v=i.length;g<v;++g){a=i[g];const{fullSize:n}=a.box,h=e[a.stack],u=h&&a.stackWeight/h.weight;a.horizontal?(a.width=u?u*s:n&&t.availableWidth,a.height=f):(a.width=s,a.height=u?u*f:n&&t.availableHeight)}return e}function gh(i){const t=uh(i),e=Xe(t.filter(h=>h.box.fullSize),!0),s=Xe(Ve(t,"left"),!0),f=Xe(Ve(t,"right")),g=Xe(Ve(t,"top"),!0),v=Xe(Ve(t,"bottom")),a=Ds(t,"x"),n=Ds(t,"y");return{fullSize:e,leftAndTop:s.concat(g),rightAndBottom:f.concat(n).concat(v).concat(a),chartArea:Ve(t,"chartArea"),vertical:s.concat(f).concat(n),horizontal:g.concat(v).concat(a)}}function As(i,t,e,s){return Math.max(i[e],t[e])+Math.max(i[s],t[s])}function $r(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function ph(i,t,e,s){const{pos:f,box:g}=e,v=i.maxPadding;if(!dt(f)){e.size&&(i[f]-=e.size);const r=s[e.stack]||{size:0,count:1};r.size=Math.max(r.size,e.horizontal?g.height:g.width),e.size=r.size/r.count,i[f]+=e.size}g.getPadding&&$r(v,g.getPadding());const a=Math.max(0,t.outerWidth-As(v,i,"left","right")),n=Math.max(0,t.outerHeight-As(v,i,"top","bottom")),h=a!==i.w,u=n!==i.h;return i.w=a,i.h=n,e.horizontal?{same:h,other:u}:{same:u,other:h}}function mh(i){const t=i.maxPadding;function e(s){const f=Math.max(t[s]-i[s],0);return i[s]+=f,f}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function vh(i,t){const e=t.maxPadding;function s(f){const g={left:0,top:0,right:0,bottom:0};return f.forEach(v=>{g[v]=Math.max(t[v],e[v])}),g}return s(i?["left","right"]:["top","bottom"])}function qe(i,t,e,s){const f=[];let g,v,a,n,h,u;for(g=0,v=i.length,h=0;g<v;++g){a=i[g],n=a.box,n.update(a.width||t.w,a.height||t.h,vh(a.horizontal,t));const{same:r,other:l}=ph(t,e,a,s);h|=r&&f.length,u=u||l,n.fullSize||f.push(a)}return h&&qe(f,t,e,s)||u}function Ci(i,t,e,s,f){i.top=e,i.left=t,i.right=t+s,i.bottom=e+f,i.width=s,i.height=f}function Es(i,t,e,s){const f=e.padding;let{x:g,y:v}=t;for(const a of i){const n=a.box,h=s[a.stack]||{count:1,placed:0,weight:1},u=a.stackWeight/h.weight||1;if(a.horizontal){const r=t.w*u,l=h.size||n.height;li(h.start)&&(v=h.start),n.fullSize?Ci(n,f.left,v,e.outerWidth-f.right-f.left,l):Ci(n,t.left+h.placed,v,r,l),h.start=v,h.placed+=r,v=n.bottom}else{const r=t.h*u,l=h.size||n.width;li(h.start)&&(g=h.start),n.fullSize?Ci(n,g,f.top,l,e.outerHeight-f.bottom-f.top):Ci(n,g,t.top+h.placed,l,r),h.start=g,h.placed+=r,g=n.right}}t.x=g,t.y=v}var Wt={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,s){if(!i)return;const f=jt(i.options.layout.padding),g=Math.max(t-f.width,0),v=Math.max(e-f.height,0),a=gh(i.boxes),n=a.vertical,h=a.horizontal;vt(i.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const u=n.reduce((p,c)=>c.box.options&&c.box.options.display===!1?p:p+1,0)||1,r=Object.freeze({outerWidth:t,outerHeight:e,padding:f,availableWidth:g,availableHeight:v,vBoxMaxWidth:g/2/u,hBoxMaxHeight:v/2}),l=Object.assign({},f);$r(l,jt(s));const o=Object.assign({maxPadding:l,w:g,h:v,x:f.left,y:f.top},f),d=dh(n.concat(h),r);qe(a.fullSize,o,r,d),qe(n,o,r,d),qe(h,o,r,d)&&qe(n,o,r,d),mh(o),Es(a.leftAndTop,o,r,d),o.x+=o.w,o.y+=o.h,Es(a.rightAndBottom,o,r,d),i.chartArea={left:o.left,top:o.top,right:o.left+o.w,bottom:o.top+o.h,height:o.h,width:o.w},vt(a.chartArea,p=>{const c=p.box;Object.assign(c,i.chartArea),c.update(o.w,o.h,{left:0,top:0,right:0,bottom:0})})}};class qr{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,f){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,f?Math.floor(e/f):s)}}isAttached(t){return!0}updateConfig(t){}}class _h extends qr{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Ri="$chartjs",bh={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Fs=i=>i===null||i==="";function yh(i,t){const e=i.style,s=i.getAttribute("height"),f=i.getAttribute("width");if(i[Ri]={initial:{height:s,width:f,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Fs(f)){const g=ps(i,"width");g!==void 0&&(i.width=g)}if(Fs(s))if(i.style.height==="")i.height=i.width/(t||2);else{const g=ps(i,"height");g!==void 0&&(i.height=g)}return i}const Kr=bl?{passive:!0}:!1;function xh(i,t,e){i.addEventListener(t,e,Kr)}function Ch(i,t,e){i.canvas.removeEventListener(t,e,Kr)}function Sh(i,t){const e=bh[i.type]||i.type,{x:s,y:f}=Ce(i,t);return{type:e,chart:t,native:i,x:s!==void 0?s:null,y:f!==void 0?f:null}}function Ji(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function wh(i,t,e){const s=i.canvas,f=new MutationObserver(g=>{let v=!1;for(const a of g)v=v||Ji(a.addedNodes,s),v=v&&!Ji(a.removedNodes,s);v&&e()});return f.observe(document,{childList:!0,subtree:!0}),f}function Th(i,t,e){const s=i.canvas,f=new MutationObserver(g=>{let v=!1;for(const a of g)v=v||Ji(a.removedNodes,s),v=v&&!Ji(a.addedNodes,s);v&&e()});return f.observe(document,{childList:!0,subtree:!0}),f}const ui=new Map;let Ls=0;function Jr(){const i=window.devicePixelRatio;i!==Ls&&(Ls=i,ui.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function Oh(i,t){ui.size||window.addEventListener("resize",Jr),ui.set(i,t)}function kh(i){ui.delete(i),ui.size||window.removeEventListener("resize",Jr)}function Mh(i,t,e){const s=i.canvas,f=s&&Hn(s);if(!f)return;const g=Dr((a,n)=>{const h=f.clientWidth;e(a,n),h<f.clientWidth&&e()},window),v=new ResizeObserver(a=>{const n=a[0],h=n.contentRect.width,u=n.contentRect.height;h===0&&u===0||g(h,u)});return v.observe(f),Oh(i,g),v}function pn(i,t,e){e&&e.disconnect(),t==="resize"&&kh(i)}function Ph(i,t,e){const s=i.canvas,f=Dr(g=>{i.ctx!==null&&e(Sh(g,i))},i);return xh(s,t,f),f}class Dh extends qr{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(yh(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[Ri])return!1;const s=e[Ri].initial;["height","width"].forEach(g=>{const v=s[g];gt(v)?e.removeAttribute(g):e.setAttribute(g,v)});const f=s.style||{};return Object.keys(f).forEach(g=>{e.style[g]=f[g]}),e.width=e.width,delete e[Ri],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const f=t.$proxies||(t.$proxies={}),v={attach:wh,detach:Th,resize:Mh}[e]||Ph;f[e]=v(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),f=s[e];if(!f)return;({attach:pn,detach:pn,resize:pn}[e]||Ch)(t,e,f),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,f){return _l(t,e,s,f)}isAttached(t){const e=Hn(t);return!!(e&&e.isConnected)}}function Ah(i){return!Vr()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?_h:Dh}var Ai;let Pe=(Ai=class{constructor(){nt(this,"x");nt(this,"y");nt(this,"active",!1);nt(this,"options");nt(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return hi(this.x)&&hi(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const f={};return t.forEach(g=>{f[g]=s[g]&&s[g].active()?s[g]._to:this[g]}),f}},nt(Ai,"defaults",{}),nt(Ai,"defaultRoutes"),Ai);function Eh(i,t){const e=i.options.ticks,s=Fh(i),f=Math.min(e.maxTicksLimit||s,s),g=e.major.enabled?Ih(t):[],v=g.length,a=g[0],n=g[v-1],h=[];if(v>f)return Rh(t,h,g,v/f),h;const u=Lh(g,t,f);if(v>0){let r,l;const o=v>1?Math.round((n-a)/(v-1)):null;for(Si(t,h,u,gt(o)?0:a-o,a),r=0,l=v-1;r<l;r++)Si(t,h,u,g[r],g[r+1]);return Si(t,h,u,n,gt(o)?t.length:n+o),h}return Si(t,h,u),h}function Fh(i){const t=i.options.offset,e=i._tickSize(),s=i._length/e+(t?0:1),f=i._maxLength/e;return Math.floor(Math.min(s,f))}function Lh(i,t,e){const s=Bh(i),f=t.length/e;if(!s)return Math.max(f,1);const g=_a(s);for(let v=0,a=g.length-1;v<a;v++){const n=g[v];if(n>f)return n}return Math.max(f,1)}function Ih(i){const t=[];let e,s;for(e=0,s=i.length;e<s;e++)i[e].major&&t.push(e);return t}function Rh(i,t,e,s){let f=0,g=e[0],v;for(s=Math.ceil(s),v=0;v<i.length;v++)v===g&&(t.push(i[v]),f++,g=e[f*s])}function Si(i,t,e,s,f){const g=pt(s,0),v=Math.min(pt(f,i.length),i.length);let a=0,n,h,u;for(e=Math.ceil(e),f&&(n=f-s,e=n/Math.floor(n/e)),u=g;u<0;)a++,u=Math.round(g+a*e);for(h=Math.max(g,0);h<v;h++)h===u&&(t.push(i[h]),a++,u=Math.round(g+a*e))}function Bh(i){const t=i.length;let e,s;if(t<2)return!1;for(s=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==s)return!1;return s}const jh=i=>i==="left"?"right":i==="right"?"left":i,Is=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,Rs=(i,t)=>Math.min(t||i,i);function Bs(i,t){const e=[],s=i.length/t,f=i.length;let g=0;for(;g<f;g+=s)e.push(i[Math.floor(g)]);return e}function zh(i,t,e){const s=i.ticks.length,f=Math.min(t,s-1),g=i._startPixel,v=i._endPixel,a=1e-6;let n=i.getPixelForTick(f),h;if(!(e&&(s===1?h=Math.max(n-g,v-n):t===0?h=(i.getPixelForTick(1)-n)/2:h=(n-i.getPixelForTick(f-1))/2,n+=f<t?h:-h,n<g-a||n>v+a)))return n}function Wh(i,t){vt(i,e=>{const s=e.gc,f=s.length/2;let g;if(f>t){for(g=0;g<f;++g)delete e.data[s[g]];s.splice(0,f)}})}function Ye(i){return i.drawTicks?i.tickLength:0}function js(i,t){if(!i.display)return 0;const e=Et(i.font,t),s=jt(i.padding);return(yt(i.text)?i.text.length:1)*e.lineHeight+s.height}function Nh(i,t){return me(i,{scale:t,type:"scale"})}function Vh(i,t,e){return me(i,{tick:e,index:t,type:"tick"})}function Xh(i,t,e){let s=Ar(i);return(e&&t!=="right"||!e&&t==="right")&&(s=jh(s)),s}function Yh(i,t,e,s){const{top:f,left:g,bottom:v,right:a,chart:n}=i,{chartArea:h,scales:u}=n;let r=0,l,o,d;const p=v-f,c=a-g;if(i.isHorizontal()){if(o=ei(s,g,a),dt(e)){const m=Object.keys(e)[0],_=e[m];d=u[m].getPixelForValue(_)+p-t}else e==="center"?d=(h.bottom+h.top)/2+p-t:d=Is(i,e,t);l=a-g}else{if(dt(e)){const m=Object.keys(e)[0],_=e[m];o=u[m].getPixelForValue(_)-c+t}else e==="center"?o=(h.left+h.right)/2-c+t:o=Is(i,e,t);d=ei(s,v,f),r=e==="left"?-Dt:Dt}return{titleX:o,titleY:d,maxWidth:l,rotation:r}}class De extends Pe{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:f}=this;return t=It(t,Number.POSITIVE_INFINITY),e=It(e,Number.NEGATIVE_INFINITY),s=It(s,Number.POSITIVE_INFINITY),f=It(f,Number.NEGATIVE_INFINITY),{min:It(t,s),max:It(e,f),minDefined:Ot(t),maxDefined:Ot(e)}}getMinMax(t){let{min:e,max:s,minDefined:f,maxDefined:g}=this.getUserBounds(),v;if(f&&g)return{min:e,max:s};const a=this.getMatchingVisibleMetas();for(let n=0,h=a.length;n<h;++n)v=a[n].controller.getMinMax(this,t),f||(e=Math.min(e,v.min)),g||(s=Math.max(s,v.max));return e=g&&e>s?s:e,s=f&&e>s?e:s,{min:It(e,It(s,e)),max:It(s,It(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){St(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:f,grace:g,ticks:v}=this.options,a=v.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=qa(this,g,f),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const n=a<this.ticks.length;this._convertTicksToLabels(n?Bs(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),v.display&&(v.autoSkip||v.source==="auto")&&(this.ticks=Eh(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),n&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){St(this.options.afterUpdate,[this])}beforeSetDimensions(){St(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){St(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),St(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){St(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,f,g;for(s=0,f=t.length;s<f;s++)g=t[s],g.label=St(e.callback,[g.value,s,t],this)}afterTickToLabelConversion(){St(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){St(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=Rs(this.ticks.length,t.ticks.maxTicksLimit),f=e.minRotation||0,g=e.maxRotation;let v=f,a,n,h;if(!this._isVisible()||!e.display||f>=g||s<=1||!this.isHorizontal()){this.labelRotation=f;return}const u=this._getLabelSizes(),r=u.widest.width,l=u.highest.height,o=At(this.chart.width-r,0,this.maxWidth);a=t.offset?this.maxWidth/s:o/(s-1),r+6>a&&(a=o/(s-(t.offset?.5:1)),n=this.maxHeight-Ye(t.grid)-e.padding-js(t.title,this.chart.options.font),h=Math.sqrt(r*r+l*l),v=zn(Math.min(Math.asin(At((u.highest.height+6)/a,-1,1)),Math.asin(At(n/h,-1,1))-Math.asin(At(l/h,-1,1)))),v=Math.max(f,Math.min(g,v))),this.labelRotation=v}afterCalculateLabelRotation(){St(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){St(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:f,grid:g}}=this,v=this._isVisible(),a=this.isHorizontal();if(v){const n=js(f,e.options.font);if(a?(t.width=this.maxWidth,t.height=Ye(g)+n):(t.height=this.maxHeight,t.width=Ye(g)+n),s.display&&this.ticks.length){const{first:h,last:u,widest:r,highest:l}=this._getLabelSizes(),o=s.padding*2,d=Vt(this.labelRotation),p=Math.cos(d),c=Math.sin(d);if(a){const m=s.mirror?0:c*r.width+p*l.height;t.height=Math.min(this.maxHeight,t.height+m+o)}else{const m=s.mirror?0:p*r.width+c*l.height;t.width=Math.min(this.maxWidth,t.width+m+o)}this._calculatePadding(h,u,c,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,f){const{ticks:{align:g,padding:v},position:a}=this.options,n=this.labelRotation!==0,h=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,r=this.right-this.getPixelForTick(this.ticks.length-1);let l=0,o=0;n?h?(l=f*t.width,o=s*e.height):(l=s*t.height,o=f*e.width):g==="start"?o=e.width:g==="end"?l=t.width:g!=="inner"&&(l=t.width/2,o=e.width/2),this.paddingLeft=Math.max((l-u+v)*this.width/(this.width-u),0),this.paddingRight=Math.max((o-r+v)*this.width/(this.width-r),0)}else{let u=e.height/2,r=t.height/2;g==="start"?(u=0,r=t.height):g==="end"&&(u=e.height,r=0),this.paddingTop=u+v,this.paddingBottom=r+v}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){St(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)gt(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=Bs(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:f,_longestTextCache:g}=this,v=[],a=[],n=Math.floor(e/Rs(e,s));let h=0,u=0,r,l,o,d,p,c,m,_,b,y,x;for(r=0;r<e;r+=n){if(d=t[r].label,p=this._resolveTickFontOptions(r),f.font=c=p.string,m=g[c]=g[c]||{data:{},gc:[]},_=p.lineHeight,b=y=0,!gt(d)&&!yt(d))b=$i(f,m.data,m.gc,b,d),y=_;else if(yt(d))for(l=0,o=d.length;l<o;++l)x=d[l],!gt(x)&&!yt(x)&&(b=$i(f,m.data,m.gc,b,x),y+=_);v.push(b),a.push(y),h=Math.max(b,h),u=Math.max(y,u)}Wh(g,e);const C=v.indexOf(h),w=a.indexOf(u),O=E=>({width:v[E]||0,height:a[E]||0});return{first:O(0),last:O(e-1),widest:O(C),highest:O(w),widths:v,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Ca(this._alignToPixels?be(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=Vh(this.getContext(),t,s))}return this.$context||(this.$context=Nh(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Vt(this.labelRotation),s=Math.abs(Math.cos(e)),f=Math.abs(Math.sin(e)),g=this._getLabelSizes(),v=t.autoSkipPadding||0,a=g?g.widest.width+v:0,n=g?g.highest.height+v:0;return this.isHorizontal()?n*s>a*f?a/s:n/f:n*f<a*s?n/s:a/f}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,f=this.options,{grid:g,position:v,border:a}=f,n=g.offset,h=this.isHorizontal(),r=this.ticks.length+(n?1:0),l=Ye(g),o=[],d=a.setContext(this.getContext()),p=d.display?d.width:0,c=p/2,m=function(Z){return be(s,Z,p)};let _,b,y,x,C,w,O,E,j,H,q,Q;if(v==="top")_=m(this.bottom),w=this.bottom-l,E=_-c,H=m(t.top)+c,Q=t.bottom;else if(v==="bottom")_=m(this.top),H=t.top,Q=m(t.bottom)-c,w=_+c,E=this.top+l;else if(v==="left")_=m(this.right),C=this.right-l,O=_-c,j=m(t.left)+c,q=t.right;else if(v==="right")_=m(this.left),j=t.left,q=m(t.right)-c,C=_+c,O=this.left+l;else if(e==="x"){if(v==="center")_=m((t.top+t.bottom)/2+.5);else if(dt(v)){const Z=Object.keys(v)[0],et=v[Z];_=m(this.chart.scales[Z].getPixelForValue(et))}H=t.top,Q=t.bottom,w=_+c,E=w+l}else if(e==="y"){if(v==="center")_=m((t.left+t.right)/2);else if(dt(v)){const Z=Object.keys(v)[0],et=v[Z];_=m(this.chart.scales[Z].getPixelForValue(et))}C=_-c,O=C-l,j=t.left,q=t.right}const K=pt(f.ticks.maxTicksLimit,r),G=Math.max(1,Math.ceil(r/K));for(b=0;b<r;b+=G){const Z=this.getContext(b),et=g.setContext(Z),it=a.setContext(Z),S=et.lineWidth,P=et.color,D=it.dash||[],M=it.dashOffset,I=et.tickWidth,k=et.tickColor,T=et.tickBorderDash||[],A=et.tickBorderDashOffset;y=zh(this,b,n),y!==void 0&&(x=be(s,y,S),h?C=O=j=q=x:w=E=H=Q=x,o.push({tx1:C,ty1:w,tx2:O,ty2:E,x1:j,y1:H,x2:q,y2:Q,width:S,color:P,borderDash:D,borderDashOffset:M,tickWidth:I,tickColor:k,tickBorderDash:T,tickBorderDashOffset:A}))}return this._ticksLength=r,this._borderValue=_,o}_computeLabelItems(t){const e=this.axis,s=this.options,{position:f,ticks:g}=s,v=this.isHorizontal(),a=this.ticks,{align:n,crossAlign:h,padding:u,mirror:r}=g,l=Ye(s.grid),o=l+u,d=r?-u:o,p=-Vt(this.labelRotation),c=[];let m,_,b,y,x,C,w,O,E,j,H,q,Q="middle";if(f==="top")C=this.bottom-d,w=this._getXAxisLabelAlignment();else if(f==="bottom")C=this.top+d,w=this._getXAxisLabelAlignment();else if(f==="left"){const G=this._getYAxisLabelAlignment(l);w=G.textAlign,x=G.x}else if(f==="right"){const G=this._getYAxisLabelAlignment(l);w=G.textAlign,x=G.x}else if(e==="x"){if(f==="center")C=(t.top+t.bottom)/2+o;else if(dt(f)){const G=Object.keys(f)[0],Z=f[G];C=this.chart.scales[G].getPixelForValue(Z)+o}w=this._getXAxisLabelAlignment()}else if(e==="y"){if(f==="center")x=(t.left+t.right)/2-o;else if(dt(f)){const G=Object.keys(f)[0],Z=f[G];x=this.chart.scales[G].getPixelForValue(Z)}w=this._getYAxisLabelAlignment(l).textAlign}e==="y"&&(n==="start"?Q="top":n==="end"&&(Q="bottom"));const K=this._getLabelSizes();for(m=0,_=a.length;m<_;++m){b=a[m],y=b.label;const G=g.setContext(this.getContext(m));O=this.getPixelForTick(m)+g.labelOffset,E=this._resolveTickFontOptions(m),j=E.lineHeight,H=yt(y)?y.length:1;const Z=H/2,et=G.color,it=G.textStrokeColor,S=G.textStrokeWidth;let P=w;v?(x=O,w==="inner"&&(m===_-1?P=this.options.reverse?"left":"right":m===0?P=this.options.reverse?"right":"left":P="center"),f==="top"?h==="near"||p!==0?q=-H*j+j/2:h==="center"?q=-K.highest.height/2-Z*j+j:q=-K.highest.height+j/2:h==="near"||p!==0?q=j/2:h==="center"?q=K.highest.height/2-Z*j:q=K.highest.height-H*j,r&&(q*=-1),p!==0&&!G.showLabelBackdrop&&(x+=j/2*Math.sin(p))):(C=O,q=(1-H)*j/2);let D;if(G.showLabelBackdrop){const M=jt(G.backdropPadding),I=K.heights[m],k=K.widths[m];let T=q-M.top,A=0-M.left;switch(Q){case"middle":T-=I/2;break;case"bottom":T-=I;break}switch(w){case"center":A-=k/2;break;case"right":A-=k;break}D={left:A,top:T,width:k+M.width,height:I+M.height,color:G.backdropColor}}c.push({label:y,font:E,textOffset:q,options:{rotation:p,color:et,strokeColor:it,strokeWidth:S,textAlign:P,textBaseline:Q,translation:[x,C],backdrop:D}})}return c}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Vt(this.labelRotation))return t==="top"?"left":"right";let f="center";return e.align==="start"?f="left":e.align==="end"?f="right":e.align==="inner"&&(f="inner"),f}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:f,padding:g}}=this.options,v=this._getLabelSizes(),a=t+g,n=v.widest.width;let h,u;return e==="left"?f?(u=this.right+g,s==="near"?h="left":s==="center"?(h="center",u+=n/2):(h="right",u+=n)):(u=this.right-a,s==="near"?h="right":s==="center"?(h="center",u-=n/2):(h="left",u=this.left)):e==="right"?f?(u=this.left+g,s==="near"?h="right":s==="center"?(h="center",u-=n/2):(h="left",u-=n)):(u=this.left+a,s==="near"?h="left":s==="center"?(h="center",u+=n/2):(h="right",u=this.right)):h="right",{textAlign:h,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:f,width:g,height:v}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,f,g,v),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const f=this.ticks.findIndex(g=>g.value===t);return f>=0?e.setContext(this.getContext(f)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,f=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let g,v;const a=(n,h,u)=>{!u.width||!u.color||(s.save(),s.lineWidth=u.width,s.strokeStyle=u.color,s.setLineDash(u.borderDash||[]),s.lineDashOffset=u.borderDashOffset,s.beginPath(),s.moveTo(n.x,n.y),s.lineTo(h.x,h.y),s.stroke(),s.restore())};if(e.display)for(g=0,v=f.length;g<v;++g){const n=f[g];e.drawOnChartArea&&a({x:n.x1,y:n.y1},{x:n.x2,y:n.y2},n),e.drawTicks&&a({x:n.tx1,y:n.ty1},{x:n.tx2,y:n.ty2},{color:n.tickColor,width:n.tickWidth,borderDash:n.tickBorderDash,borderDashOffset:n.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:f}}=this,g=s.setContext(this.getContext()),v=s.display?g.width:0;if(!v)return;const a=f.setContext(this.getContext(0)).lineWidth,n=this._borderValue;let h,u,r,l;this.isHorizontal()?(h=be(t,this.left,v)-v/2,u=be(t,this.right,a)+a/2,r=l=n):(r=be(t,this.top,v)-v/2,l=be(t,this.bottom,a)+a/2,h=u=n),e.save(),e.lineWidth=g.width,e.strokeStyle=g.color,e.beginPath(),e.moveTo(h,r),e.lineTo(u,l),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,f=this._computeLabelArea();f&&Fr(s,f);const g=this.getLabelItems(t);for(const v of g){const a=v.options,n=v.font,h=v.label,u=v.textOffset;ci(s,h,0,u,n,a)}f&&Lr(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:f}}=this;if(!s.display)return;const g=Et(s.font),v=jt(s.padding),a=s.align;let n=g.lineHeight/2;e==="bottom"||e==="center"||dt(e)?(n+=v.bottom,yt(s.text)&&(n+=g.lineHeight*(s.text.length-1))):n+=v.top;const{titleX:h,titleY:u,maxWidth:r,rotation:l}=Yh(this,n,e,a);ci(t,s.text,0,0,g,{color:s.color,maxWidth:r,rotation:l,textAlign:Xh(a,e,f),textBaseline:"middle",translation:[h,u]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=pt(t.grid&&t.grid.z,-1),f=pt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==De.prototype.draw?[{z:e,draw:g=>{this.draw(g)}}]:[{z:s,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:f,draw:()=>{this.drawBorder()}},{z:e,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",f=[];let g,v;for(g=0,v=e.length;g<v;++g){const a=e[g];a[s]===this.id&&(!t||a.type===t)&&f.push(a)}return f}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Et(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class wi{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;Gh(e)&&(s=this.register(e));const f=this.items,g=t.id,v=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+t);return g in f||(f[g]=t,Hh(t,v,s),this.override&&wt.override(t.id,t.overrides)),v}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,f=this.scope;s in e&&delete e[s],f&&s in wt[f]&&(delete wt[f][s],this.override&&delete Me[s])}}function Hh(i,t,e){const s=ai(Object.create(null),[e?wt.get(e):{},wt.get(t),i.defaults]);wt.set(t,s),i.defaultRoutes&&Uh(t,i.defaultRoutes),i.descriptors&&wt.describe(t,i.descriptors)}function Uh(i,t){Object.keys(t).forEach(e=>{const s=e.split("."),f=s.pop(),g=[i].concat(s).join("."),v=t[e].split("."),a=v.pop(),n=v.join(".");wt.route(g,f,n,a)})}function Gh(i){return"id"in i&&"defaults"in i}class $h{constructor(){this.controllers=new wi(ae,"datasets",!0),this.elements=new wi(Pe,"elements"),this.plugins=new wi(Object,"plugins"),this.scales=new wi(De,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(f=>{const g=s||this._getRegistryForType(f);s||g.isForType(f)||g===this.plugins&&f.id?this._exec(t,g,f):vt(f,v=>{const a=s||this._getRegistryForType(v);this._exec(t,a,v)})})}_exec(t,e,s){const f=jn(t);St(s["before"+f],[],s),e[t](s),St(s["after"+f],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const f=e.get(t);if(f===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return f}}var Ht=new $h;class qh{constructor(){this._init=[]}notify(t,e,s,f){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const g=f?this._descriptors(t).filter(f):this._descriptors(t),v=this._notify(g,t,e,s);return e==="afterDestroy"&&(this._notify(g,t,"stop"),this._notify(this._init,t,"uninstall")),v}_notify(t,e,s,f){f=f||{};for(const g of t){const v=g.plugin,a=v[s],n=[e,f,g.options];if(St(a,n,v)===!1&&f.cancelable)return!1}return!0}invalidate(){gt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,f=pt(s.options&&s.options.plugins,{}),g=Kh(s);return f===!1&&!e?[]:Qh(t,g,f,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,f=(g,v)=>g.filter(a=>!v.some(n=>a.plugin.id===n.plugin.id));this._notify(f(e,s),t,"stop"),this._notify(f(s,e),t,"start")}}function Kh(i){const t={},e=[],s=Object.keys(Ht.plugins.items);for(let g=0;g<s.length;g++)e.push(Ht.getPlugin(s[g]));const f=i.plugins||[];for(let g=0;g<f.length;g++){const v=f[g];e.indexOf(v)===-1&&(e.push(v),t[v.id]=!0)}return{plugins:e,localIds:t}}function Jh(i,t){return!t&&i===!1?null:i===!0?{}:i}function Qh(i,{plugins:t,localIds:e},s,f){const g=[],v=i.getContext();for(const a of t){const n=a.id,h=Jh(s[n],f);h!==null&&g.push({plugin:a,options:Zh(i.config,{plugin:a,local:e[n]},h,v)})}return g}function Zh(i,{plugin:t,local:e},s,f){const g=i.pluginScopeKeys(t),v=i.getOptionScopes(s,g);return e&&t.defaults&&v.push(t.defaults),i.createResolver(v,f,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Tn(i,t){const e=wt.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function tc(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function ec(i,t){return i===t?"_index_":"_value_"}function zs(i){if(i==="x"||i==="y"||i==="r")return i}function ic(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function On(i,...t){if(zs(i))return i;for(const e of t){const s=e.axis||ic(e.position)||i.length>1&&zs(i[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function Ws(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function nc(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===i||s.yAxisID===i);if(e.length)return Ws(i,"x",e[0])||Ws(i,"y",e[0])}return{}}function sc(i,t){const e=Me[i.type]||{scales:{}},s=t.scales||{},f=Tn(i.type,t),g=Object.create(null);return Object.keys(s).forEach(v=>{const a=s[v];if(!dt(a))return console.error(`Invalid scale configuration for scale: ${v}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${v}`);const n=On(v,a,nc(v,i),wt.scales[a.type]),h=ec(n,f),u=e.scales||{};g[v]=Ze(Object.create(null),[{axis:n},a,u[n],u[h]])}),i.data.datasets.forEach(v=>{const a=v.type||i.type,n=v.indexAxis||Tn(a,t),u=(Me[a]||{}).scales||{};Object.keys(u).forEach(r=>{const l=tc(r,n),o=v[l+"AxisID"]||l;g[o]=g[o]||Object.create(null),Ze(g[o],[{axis:l},s[o],u[r]])})}),Object.keys(g).forEach(v=>{const a=g[v];Ze(a,[wt.scales[a.type],wt.scale])}),g}function Qr(i){const t=i.options||(i.options={});t.plugins=pt(t.plugins,{}),t.scales=sc(i,t)}function Zr(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function rc(i){return i=i||{},i.data=Zr(i.data),Qr(i),i}const Ns=new Map,to=new Set;function Ti(i,t){let e=Ns.get(i);return e||(e=t(),Ns.set(i,e),to.add(e)),e}const He=(i,t,e)=>{const s=ce(t,e);s!==void 0&&i.add(s)};class oc{constructor(t){this._config=rc(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Zr(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Qr(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ti(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Ti(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Ti(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return Ti(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let f=s.get(t);return(!f||e)&&(f=new Map,s.set(t,f)),f}getOptionScopes(t,e,s){const{options:f,type:g}=this,v=this._cachedScopes(t,s),a=v.get(e);if(a)return a;const n=new Set;e.forEach(u=>{t&&(n.add(t),u.forEach(r=>He(n,t,r))),u.forEach(r=>He(n,f,r)),u.forEach(r=>He(n,Me[g]||{},r)),u.forEach(r=>He(n,wt,r)),u.forEach(r=>He(n,Sn,r))});const h=Array.from(n);return h.length===0&&h.push(Object.create(null)),to.has(e)&&v.set(e,h),h}chartOptionScopes(){const{options:t,type:e}=this;return[t,Me[e]||{},wt.datasets[e]||{},{type:e},wt,Sn]}resolveNamedOptions(t,e,s,f=[""]){const g={$shared:!0},{resolver:v,subPrefixes:a}=Vs(this._resolverCache,t,f);let n=v;if(lc(v,e)){g.$shared=!1,s=ue(s)?s():s;const h=this.createResolver(t,s,a);n=je(v,s,h)}for(const h of e)g[h]=n[h];return g}createResolver(t,e,s=[""],f){const{resolver:g}=Vs(this._resolverCache,t,s);return dt(e)?je(g,e,void 0,f):g}}function Vs(i,t,e){let s=i.get(t);s||(s=new Map,i.set(t,s));const f=e.join();let g=s.get(f);return g||(g={resolver:Vn(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},s.set(f,g)),g}const ac=i=>dt(i)&&Object.getOwnPropertyNames(i).reduce((t,e)=>t||ue(i[e]),!1);function lc(i,t){const{isScriptable:e,isIndexable:s}=Br(i);for(const f of t){const g=e(f),v=s(f),a=(v||g)&&i[f];if(g&&(ue(a)||ac(a))||v&&yt(a))return!0}return!1}var hc="4.4.0";const cc=["top","bottom","left","right","chartArea"];function Xs(i,t){return i==="top"||i==="bottom"||cc.indexOf(i)===-1&&t==="x"}function Ys(i,t){return function(e,s){return e[i]===s[i]?e[t]-s[t]:e[i]-s[i]}}function Hs(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),St(e&&e.onComplete,[i],t)}function uc(i){const t=i.chart,e=t.options.animation;St(e&&e.onProgress,[i],t)}function eo(i){return Vr()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const Bi={},Us=i=>{const t=eo(i);return Object.values(Bi).filter(e=>e.canvas===t).pop()};function fc(i,t,e){const s=Object.keys(i);for(const f of s){const g=+f;if(g>=t){const v=i[f];delete i[f],(e>0||g>t)&&(i[g+e]=v)}}}function dc(i,t,e,s){return!e||i.type==="mouseout"?null:s?t:i}function Oi(i,t,e){return i.options.clip?i[e]:t[e]}function gc(i,t){const{xScale:e,yScale:s}=i;return e&&s?{left:Oi(e,t,"left"),right:Oi(e,t,"right"),top:Oi(s,t,"top"),bottom:Oi(s,t,"bottom")}:t}class Rt{static register(...t){Ht.add(...t),Gs()}static unregister(...t){Ht.remove(...t),Gs()}constructor(t,e){const s=this.config=new oc(e),f=eo(t),g=Us(f);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const v=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||Ah(f)),this.platform.updateConfig(s);const a=this.platform.acquireContext(f,v.aspectRatio),n=a&&a.canvas,h=n&&n.height,u=n&&n.width;if(this.id=ha(),this.ctx=a,this.canvas=n,this.width=u,this.height=h,this._options=v,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new qh,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Oa(r=>this.update(r),v.resizeDelay||0),this._dataChanges=[],Bi[this.id]=this,!a||!n){console.error("Failed to create chart: can't acquire context from the given item");return}Jt.listen(this,"complete",Hs),Jt.listen(this,"progress",uc),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:f,_aspectRatio:g}=this;return gt(t)?e&&g?g:f?s/f:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Ht}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():gs(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return us(this.canvas,this.ctx),this}stop(){return Jt.stop(this),this}resize(t,e){Jt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,f=this.canvas,g=s.maintainAspectRatio&&this.aspectRatio,v=this.platform.getMaximumSize(f,t,e,g),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),n=this.width?"resize":"attach";this.width=v.width,this.height=v.height,this._aspectRatio=this.aspectRatio,gs(this,a,!0)&&(this.notifyPlugins("resize",{size:v}),St(s.onResize,[this,v],this),this.attached&&this._doResize(n)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};vt(e,(s,f)=>{s.id=f})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,f=Object.keys(s).reduce((v,a)=>(v[a]=!1,v),{});let g=[];e&&(g=g.concat(Object.keys(e).map(v=>{const a=e[v],n=On(v,a),h=n==="r",u=n==="x";return{options:a,dposition:h?"chartArea":u?"bottom":"left",dtype:h?"radialLinear":u?"category":"linear"}}))),vt(g,v=>{const a=v.options,n=a.id,h=On(n,a),u=pt(a.type,v.dtype);(a.position===void 0||Xs(a.position,h)!==Xs(v.dposition))&&(a.position=v.dposition),f[n]=!0;let r=null;if(n in s&&s[n].type===u)r=s[n];else{const l=Ht.getScale(u);r=new l({id:n,type:u,ctx:this.ctx,chart:this}),s[r.id]=r}r.init(a,t)}),vt(f,(v,a)=>{v||delete s[a]}),vt(s,v=>{Wt.configure(this,v,v.options),Wt.addBox(this,v)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((f,g)=>f.index-g.index),s>e){for(let f=e;f<s;++f)this._destroyDatasetMeta(f);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(Ys("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,f)=>{e.filter(g=>g===s._dataset).length===0&&this._destroyDatasetMeta(f)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,f;for(this._removeUnreferencedMetasets(),s=0,f=e.length;s<f;s++){const g=e[s];let v=this.getDatasetMeta(s);const a=g.type||this.config.type;if(v.type&&v.type!==a&&(this._destroyDatasetMeta(s),v=this.getDatasetMeta(s)),v.type=a,v.indexAxis=g.indexAxis||Tn(a,this.options),v.order=g.order||0,v.index=s,v.label=""+g.label,v.visible=this.isDatasetVisible(s),v.controller)v.controller.updateIndex(s),v.controller.linkScales();else{const n=Ht.getController(a),{datasetElementType:h,dataElementType:u}=wt.datasets[a];Object.assign(n,{dataElementType:Ht.getElement(u),datasetElementType:h&&Ht.getElement(h)}),v.controller=new n(this,s),t.push(v.controller)}}return this._updateMetasets(),t}_resetElements(){vt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),f=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let v=0;for(let h=0,u=this.data.datasets.length;h<u;h++){const{controller:r}=this.getDatasetMeta(h),l=!f&&g.indexOf(r)===-1;r.buildOrUpdateElements(l),v=Math.max(+r.getMaxOverflow(),v)}v=this._minPadding=s.layout.autoPadding?v:0,this._updateLayout(v),f||vt(g,h=>{h.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Ys("z","_idx"));const{_active:a,_lastEvent:n}=this;n?this._eventHandler(n,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){vt(this.scales,t=>{Wt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!is(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:f,count:g}of e){const v=s==="_removeElements"?-g:g;fc(t,f,v)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=g=>new Set(t.filter(v=>v[0]===g).map((v,a)=>a+","+v.splice(1).join(","))),f=s(0);for(let g=1;g<e;g++)if(!is(f,s(g)))return;return Array.from(f).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Wt.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],vt(this.boxes,f=>{s&&f.position==="chartArea"||(f.configure&&f.configure(),this._layers.push(...f._layers()))},this),this._layers.forEach((f,g)=>{f._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,ue(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),f={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",f)!==!1&&(s.controller._update(e),f.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",f))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Jt.has(this)?this.attached&&!Jt.running(this)&&Jt.start(this):(this.draw(),Hs({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:f}=this._resizeBeforeDraw;this._resize(s,f),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let f,g;for(f=0,g=e.length;f<g;++f){const v=e[f];(!t||v.visible)&&s.push(v)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s=t._clip,f=!s.disabled,g=gc(t,this.chartArea),v={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",v)!==!1&&(f&&Fr(e,{left:s.left===!1?0:g.left-s.left,right:s.right===!1?this.width:g.right+s.right,top:s.top===!1?0:g.top-s.top,bottom:s.bottom===!1?this.height:g.bottom+s.bottom}),t.controller.draw(),f&&Lr(e),v.cancelable=!1,this.notifyPlugins("afterDatasetDraw",v))}isPointInArea(t){return ee(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,f){const g=ch.modes[e];return typeof g=="function"?g(this,t,s,f):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let f=s.filter(g=>g&&g._dataset===e).pop();return f||(f={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(f)),f}getContext(){return this.$context||(this.$context=me(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const f=s?"show":"hide",g=this.getDatasetMeta(t),v=g.controller._resolveAnimations(void 0,f);li(e)?(g.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),v.update(g,{visible:s}),this.update(a=>a.datasetIndex===t?f:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Jt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),us(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Bi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(g,v)=>{e.addEventListener(this,g,v),t[g]=v},f=(g,v,a)=>{g.offsetX=v,g.offsetY=a,this._eventHandler(g)};vt(this.options.events,g=>s(g,f))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(n,h)=>{e.addEventListener(this,n,h),t[n]=h},f=(n,h)=>{t[n]&&(e.removeEventListener(this,n,h),delete t[n])},g=(n,h)=>{this.canvas&&this.resize(n,h)};let v;const a=()=>{f("attach",a),this.attached=!0,this.resize(),s("resize",g),s("detach",v)};v=()=>{this.attached=!1,f("resize",g),this._stop(),this._resize(0,0),s("attach",a)},e.isAttached(this.canvas)?a():v()}unbindEvents(){vt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},vt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const f=s?"set":"remove";let g,v,a,n;for(e==="dataset"&&(g=this.getDatasetMeta(t[0].datasetIndex),g.controller["_"+f+"DatasetHoverStyle"]()),a=0,n=t.length;a<n;++a){v=t[a];const h=v&&this.getDatasetMeta(v.datasetIndex).controller;h&&h[f+"HoverStyle"](v.element,v.datasetIndex,v.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:g,index:v})=>{const a=this.getDatasetMeta(g);if(!a)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:a.data[v],index:v}});!Yi(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const f=this.options.hover,g=(n,h)=>n.filter(u=>!h.some(r=>u.datasetIndex===r.datasetIndex&&u.index===r.index)),v=g(e,t),a=s?t:g(t,e);v.length&&this.updateHoverStyle(v,f.mode,!1),a.length&&f.mode&&this.updateHoverStyle(a,f.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},f=v=>(v.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,f)===!1)return;const g=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,f),(g||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:f=[],options:g}=this,v=e,a=this._getActiveElements(t,f,s,v),n=pa(t),h=dc(t,this._lastEvent,s,n);s&&(this._lastEvent=null,St(g.onHover,[t,a,this],this),n&&St(g.onClick,[t,a,this],this));const u=!Yi(a,f);return(u||e)&&(this._active=a,this._updateHoverStyles(a,f,e)),this._lastEvent=h,u}_getActiveElements(t,e,s,f){if(t.type==="mouseout")return[];if(!s)return e;const g=this.options.hover;return this.getElementsAtEventForMode(t,g.mode,g,f)}}nt(Rt,"defaults",wt),nt(Rt,"instances",Bi),nt(Rt,"overrides",Me),nt(Rt,"registry",Ht),nt(Rt,"version",hc),nt(Rt,"getChart",Us);function Gs(){return vt(Rt.instances,i=>i._plugins.invalidate())}function io(i,t,e=t){i.lineCap=pt(e.borderCapStyle,t.borderCapStyle),i.setLineDash(pt(e.borderDash,t.borderDash)),i.lineDashOffset=pt(e.borderDashOffset,t.borderDashOffset),i.lineJoin=pt(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=pt(e.borderWidth,t.borderWidth),i.strokeStyle=pt(e.borderColor,t.borderColor)}function pc(i,t,e){i.lineTo(e.x,e.y)}function mc(i){return i.stepped?Wa:i.tension||i.cubicInterpolationMode==="monotone"?Na:pc}function no(i,t,e={}){const s=i.length,{start:f=0,end:g=s-1}=e,{start:v,end:a}=t,n=Math.max(f,v),h=Math.min(g,a),u=f<v&&g<v||f>a&&g>a;return{count:s,start:n,loop:t.loop,ilen:h<n&&!u?s+h-n:h-n}}function vc(i,t,e,s){const{points:f,options:g}=t,{count:v,start:a,loop:n,ilen:h}=no(f,e,s),u=mc(g);let{move:r=!0,reverse:l}=s||{},o,d,p;for(o=0;o<=h;++o)d=f[(a+(l?h-o:o))%v],!d.skip&&(r?(i.moveTo(d.x,d.y),r=!1):u(i,p,d,l,g.stepped),p=d);return n&&(d=f[(a+(l?h:0))%v],u(i,p,d,l,g.stepped)),!!n}function _c(i,t,e,s){const f=t.points,{count:g,start:v,ilen:a}=no(f,e,s),{move:n=!0,reverse:h}=s||{};let u=0,r=0,l,o,d,p,c,m;const _=y=>(v+(h?a-y:y))%g,b=()=>{p!==c&&(i.lineTo(u,c),i.lineTo(u,p),i.lineTo(u,m))};for(n&&(o=f[_(0)],i.moveTo(o.x,o.y)),l=0;l<=a;++l){if(o=f[_(l)],o.skip)continue;const y=o.x,x=o.y,C=y|0;C===d?(x<p?p=x:x>c&&(c=x),u=(r*u+y)/++r):(b(),i.lineTo(y,x),d=C,r=0,p=c=x),m=x}b()}function kn(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?_c:vc}function bc(i){return i.stepped?yl:i.tension||i.cubicInterpolationMode==="monotone"?xl:Se}function yc(i,t,e,s){let f=t._path;f||(f=t._path=new Path2D,t.path(f,e,s)&&f.closePath()),io(i,t.options),i.stroke(f)}function xc(i,t,e,s){const{segments:f,options:g}=t,v=kn(t);for(const a of f)io(i,g,a.style),i.beginPath(),v(i,t,a,{start:e,end:e+s-1})&&i.closePath(),i.stroke()}const Cc=typeof Path2D=="function";function Sc(i,t,e,s){Cc&&!t.options.segment?yc(i,t,e,s):xc(i,t,e,s)}class Ke extends Pe{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const f=s.spanGaps?this._loop:this._fullLoop;fl(this._points,s,t,f,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Al(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,f=t[e],g=this.points,v=Ml(this,{property:e,start:f,end:f});if(!v.length)return;const a=[],n=bc(s);let h,u;for(h=0,u=v.length;h<u;++h){const{start:r,end:l}=v[h],o=g[r],d=g[l];if(o===d){a.push(o);continue}const p=Math.abs((f-o[e])/(d[e]-o[e])),c=n(o,d,p,s.stepped);c[e]=t[e],a.push(c)}return a.length===1?a[0]:a}pathSegment(t,e,s){return kn(this)(t,this,e,s)}path(t,e,s){const f=this.segments,g=kn(this);let v=this._loop;e=e||0,s=s||this.points.length-e;for(const a of f)v&=g(t,this,a,{start:e,end:e+s-1});return!!v}draw(t,e,s,f){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(t.save(),Sc(t,this,s,f),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}nt(Ke,"id","line"),nt(Ke,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),nt(Ke,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),nt(Ke,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function $s(i,t,e,s){const f=i.options,{[e]:g}=i.getProps([e],s);return Math.abs(t-g)<f.radius+f.hitRadius}class ji extends Pe{constructor(e){super();nt(this,"parsed");nt(this,"skip");nt(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,f){const g=this.options,{x:v,y:a}=this.getProps(["x","y"],f);return Math.pow(e-v,2)+Math.pow(s-a,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(e,s){return $s(this,e,"x",s)}inYRange(e,s){return $s(this,e,"y",s)}getCenterPoint(e){const{x:s,y:f}=this.getProps(["x","y"],e);return{x:s,y:f}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const f=s&&e.borderWidth||0;return(s+f)*2}draw(e,s){const f=this.options;this.skip||f.radius<.1||!ee(this,s,this.size(f)/2)||(e.strokeStyle=f.borderColor,e.lineWidth=f.borderWidth,e.fillStyle=f.backgroundColor,wn(e,f,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}nt(ji,"id","point"),nt(ji,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),nt(ji,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function so(i,t){const{x:e,y:s,base:f,width:g,height:v}=i.getProps(["x","y","base","width","height"],t);let a,n,h,u,r;return i.horizontal?(r=v/2,a=Math.min(e,f),n=Math.max(e,f),h=s-r,u=s+r):(r=g/2,a=e-r,n=e+r,h=Math.min(s,f),u=Math.max(s,f)),{left:a,top:h,right:n,bottom:u}}function re(i,t,e,s){return i?0:At(t,e,s)}function wc(i,t,e){const s=i.options.borderWidth,f=i.borderSkipped,g=Rr(s);return{t:re(f.top,g.top,0,e),r:re(f.right,g.right,0,t),b:re(f.bottom,g.bottom,0,e),l:re(f.left,g.left,0,t)}}function Tc(i,t,e){const{enableBorderRadius:s}=i.getProps(["enableBorderRadius"]),f=i.options.borderRadius,g=Re(f),v=Math.min(t,e),a=i.borderSkipped,n=s||dt(f);return{topLeft:re(!n||a.top||a.left,g.topLeft,0,v),topRight:re(!n||a.top||a.right,g.topRight,0,v),bottomLeft:re(!n||a.bottom||a.left,g.bottomLeft,0,v),bottomRight:re(!n||a.bottom||a.right,g.bottomRight,0,v)}}function Oc(i){const t=so(i),e=t.right-t.left,s=t.bottom-t.top,f=wc(i,e/2,s/2),g=Tc(i,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:g},inner:{x:t.left+f.l,y:t.top+f.t,w:e-f.l-f.r,h:s-f.t-f.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(f.t,f.l)),topRight:Math.max(0,g.topRight-Math.max(f.t,f.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(f.b,f.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(f.b,f.r))}}}}function mn(i,t,e,s){const f=t===null,g=e===null,a=i&&!(f&&g)&&so(i,s);return a&&(f||Cn(t,a.left,a.right))&&(g||Cn(e,a.top,a.bottom))}function kc(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function Mc(i,t){i.rect(t.x,t.y,t.w,t.h)}function vn(i,t,e={}){const s=i.x!==e.x?-t:0,f=i.y!==e.y?-t:0,g=(i.x+i.w!==e.x+e.w?t:0)-s,v=(i.y+i.h!==e.y+e.h?t:0)-f;return{x:i.x+s,y:i.y+f,w:i.w+g,h:i.h+v,radius:i.radius}}class zi extends Pe{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:f}}=this,{inner:g,outer:v}=Oc(this),a=kc(v.radius)?qi:Mc;t.save(),(v.w!==g.w||v.h!==g.h)&&(t.beginPath(),a(t,vn(v,e,g)),t.clip(),a(t,vn(g,-e,v)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),a(t,vn(g,e)),t.fillStyle=f,t.fill(),t.restore()}inRange(t,e,s){return mn(this,t,e,s)}inXRange(t,e){return mn(this,t,null,e)}inYRange(t,e){return mn(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:f,horizontal:g}=this.getProps(["x","y","base","horizontal"],t);return{x:g?(e+f)/2:e,y:g?s:(s+f)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}nt(zi,"id","bar"),nt(zi,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),nt(zi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const Mn=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],qs=Mn.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function ro(i){return Mn[i%Mn.length]}function oo(i){return qs[i%qs.length]}function Pc(i,t){return i.borderColor=ro(t),i.backgroundColor=oo(t),++t}function Dc(i,t){return i.backgroundColor=i.data.map(()=>ro(t++)),t}function Ac(i,t){return i.backgroundColor=i.data.map(()=>oo(t++)),t}function Ec(i){let t=0;return(e,s)=>{const f=i.getDatasetMeta(s).controller;f instanceof $e?t=Dc(e,t):f instanceof Ii?t=Ac(e,t):f&&(t=Pc(e,t))}}function Ks(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function Fc(i){return i&&(i.borderColor||i.backgroundColor)}var Lc={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:s},options:f}=i.config,{elements:g}=f;if(!e.forceOverride&&(Ks(s)||Fc(f)||g&&Ks(g)))return;const v=Ec(i);s.forEach(v)}};function Ic(i,t,e,s,f){const g=f.samples||s;if(g>=e)return i.slice(t,t+e);const v=[],a=(e-2)/(g-2);let n=0;const h=t+e-1;let u=t,r,l,o,d,p;for(v[n++]=i[u],r=0;r<g-2;r++){let c=0,m=0,_;const b=Math.floor((r+1)*a)+1+t,y=Math.min(Math.floor((r+2)*a)+1,e)+t,x=y-b;for(_=b;_<y;_++)c+=i[_].x,m+=i[_].y;c/=x,m/=x;const C=Math.floor(r*a)+1+t,w=Math.min(Math.floor((r+1)*a)+1,e)+t,{x:O,y:E}=i[u];for(o=d=-1,_=C;_<w;_++)d=.5*Math.abs((O-c)*(i[_].y-E)-(O-i[_].x)*(m-E)),d>o&&(o=d,l=i[_],p=_);v[n++]=l,u=p}return v[n++]=i[h],v}function Rc(i,t,e,s){let f=0,g=0,v,a,n,h,u,r,l,o,d,p;const c=[],m=t+e-1,_=i[t].x,y=i[m].x-_;for(v=t;v<t+e;++v){a=i[v],n=(a.x-_)/y*s,h=a.y;const x=n|0;if(x===u)h<d?(d=h,r=v):h>p&&(p=h,l=v),f=(g*f+a.x)/++g;else{const C=v-1;if(!gt(r)&&!gt(l)){const w=Math.min(r,l),O=Math.max(r,l);w!==o&&w!==C&&c.push({...i[w],x:f}),O!==o&&O!==C&&c.push({...i[O],x:f})}v>0&&C!==o&&c.push(i[C]),c.push(a),u=x,g=0,d=p=h,r=l=o=v}}return c}function ao(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Js(i){i.data.datasets.forEach(t=>{ao(t)})}function Bc(i,t){const e=t.length;let s=0,f;const{iScale:g}=i,{min:v,max:a,minDefined:n,maxDefined:h}=g.getUserBounds();return n&&(s=At(te(t,g.axis,v).lo,0,e-1)),h?f=At(te(t,g.axis,a).hi+1,s,e)-s:f=e-s,{start:s,count:f}}var jc={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){Js(i);return}const s=i.width;i.data.datasets.forEach((f,g)=>{const{_data:v,indexAxis:a}=f,n=i.getDatasetMeta(g),h=v||f.data;if(Ge([a,i.options.indexAxis])==="y"||!n.controller.supportsDecimation)return;const u=i.scales[n.xAxisID];if(u.type!=="linear"&&u.type!=="time"||i.options.parsing)return;let{start:r,count:l}=Bc(n,h);const o=e.threshold||4*s;if(l<=o){ao(f);return}gt(v)&&(f._data=h,delete f.data,Object.defineProperty(f,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let d;switch(e.algorithm){case"lttb":d=Ic(h,r,l,s,e);break;case"min-max":d=Rc(h,r,l,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}f._decimated=d})},destroy(i){Js(i)}};class Gn extends Pe{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const f=yt(s.text)?s.text.length:1;this._padding=jt(s.padding);const g=f*Et(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:f,right:g,options:v}=this,a=v.align;let n=0,h,u,r;return this.isHorizontal()?(u=ei(a,s,g),r=e+t,h=g-s):(v.position==="left"?(u=s+t,r=ei(a,f,e),n=Ct*-.5):(u=g-t,r=ei(a,e,f),n=Ct*.5),h=f-e),{titleX:u,titleY:r,maxWidth:h,rotation:n}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=Et(e.font),g=s.lineHeight/2+this._padding.top,{titleX:v,titleY:a,maxWidth:n,rotation:h}=this._drawArgs(g);ci(t,e.text,0,0,s,{color:e.color,maxWidth:n,rotation:h,textAlign:Ar(e.align),textBaseline:"middle",translation:[v,a]})}}function zc(i,t){const e=new Gn({ctx:i.ctx,options:t,chart:i});Wt.configure(i,e,t),Wt.addBox(i,e),i.titleBlock=e}var Wc={id:"title",_element:Gn,start(i,t,e){zc(i,e)},stop(i){const t=i.titleBlock;Wt.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const s=i.titleBlock;Wt.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ki=new WeakMap;var Nc={id:"subtitle",start(i,t,e){const s=new Gn({ctx:i.ctx,options:e,chart:i});Wt.configure(i,s,e),Wt.addBox(i,s),ki.set(i,s)},stop(i){Wt.removeBox(i,ki.get(i)),ki.delete(i)},beforeUpdate(i,t,e){const s=ki.get(i);Wt.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Je={average(i){if(!i.length)return!1;let t,e,s=0,f=0,g=0;for(t=0,e=i.length;t<e;++t){const v=i[t].element;if(v&&v.hasValue()){const a=v.tooltipPosition();s+=a.x,f+=a.y,++g}}return{x:s/g,y:f/g}},nearest(i,t){if(!i.length)return!1;let e=t.x,s=t.y,f=Number.POSITIVE_INFINITY,g,v,a;for(g=0,v=i.length;g<v;++g){const n=i[g].element;if(n&&n.hasValue()){const h=n.getCenterPoint(),u=xn(t,h);u<f&&(f=u,a=n)}}if(a){const n=a.tooltipPosition();e=n.x,s=n.y}return{x:e,y:s}}};function Yt(i,t){return t&&(yt(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function Qt(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function Vc(i,t){const{element:e,datasetIndex:s,index:f}=t,g=i.getDatasetMeta(s).controller,{label:v,value:a}=g.getLabelAndValue(f);return{chart:i,label:v,parsed:g.getParsed(f),raw:i.data.datasets[s].data[f],formattedValue:a,dataset:g.getDataset(),dataIndex:f,datasetIndex:s,element:e}}function Qs(i,t){const e=i.chart.ctx,{body:s,footer:f,title:g}=i,{boxWidth:v,boxHeight:a}=t,n=Et(t.bodyFont),h=Et(t.titleFont),u=Et(t.footerFont),r=g.length,l=f.length,o=s.length,d=jt(t.padding);let p=d.height,c=0,m=s.reduce((y,x)=>y+x.before.length+x.lines.length+x.after.length,0);if(m+=i.beforeBody.length+i.afterBody.length,r&&(p+=r*h.lineHeight+(r-1)*t.titleSpacing+t.titleMarginBottom),m){const y=t.displayColors?Math.max(a,n.lineHeight):n.lineHeight;p+=o*y+(m-o)*n.lineHeight+(m-1)*t.bodySpacing}l&&(p+=t.footerMarginTop+l*u.lineHeight+(l-1)*t.footerSpacing);let _=0;const b=function(y){c=Math.max(c,e.measureText(y).width+_)};return e.save(),e.font=h.string,vt(i.title,b),e.font=n.string,vt(i.beforeBody.concat(i.afterBody),b),_=t.displayColors?v+2+t.boxPadding:0,vt(s,y=>{vt(y.before,b),vt(y.lines,b),vt(y.after,b)}),_=0,e.font=u.string,vt(i.footer,b),e.restore(),c+=d.width,{width:c,height:p}}function Xc(i,t){const{y:e,height:s}=t;return e<s/2?"top":e>i.height-s/2?"bottom":"center"}function Yc(i,t,e,s){const{x:f,width:g}=s,v=e.caretSize+e.caretPadding;if(i==="left"&&f+g+v>t.width||i==="right"&&f-g-v<0)return!0}function Hc(i,t,e,s){const{x:f,width:g}=e,{width:v,chartArea:{left:a,right:n}}=i;let h="center";return s==="center"?h=f<=(a+n)/2?"left":"right":f<=g/2?h="left":f>=v-g/2&&(h="right"),Yc(h,i,t,e)&&(h="center"),h}function Zs(i,t,e){const s=e.yAlign||t.yAlign||Xc(i,e);return{xAlign:e.xAlign||t.xAlign||Hc(i,t,e,s),yAlign:s}}function Uc(i,t){let{x:e,width:s}=i;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function Gc(i,t,e){let{y:s,height:f}=i;return t==="top"?s+=e:t==="bottom"?s-=f+e:s-=f/2,s}function tr(i,t,e,s){const{caretSize:f,caretPadding:g,cornerRadius:v}=i,{xAlign:a,yAlign:n}=e,h=f+g,{topLeft:u,topRight:r,bottomLeft:l,bottomRight:o}=Re(v);let d=Uc(t,a);const p=Gc(t,n,h);return n==="center"?a==="left"?d+=h:a==="right"&&(d-=h):a==="left"?d-=Math.max(u,l)+f:a==="right"&&(d+=Math.max(r,o)+f),{x:At(d,0,s.width-t.width),y:At(p,0,s.height-t.height)}}function Mi(i,t,e){const s=jt(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-s.right:i.x+s.left}function er(i){return Yt([],Qt(i))}function $c(i,t,e){return me(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function ir(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const lo={beforeTitle:Kt,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Kt,beforeBody:Kt,beforeLabel:Kt,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return gt(e)||(t+=e),t},labelColor(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Kt,afterBody:Kt,beforeFooter:Kt,footer:Kt,afterFooter:Kt};function Ft(i,t,e,s){const f=i[t].call(e,s);return typeof f>"u"?lo[t].call(e,s):f}class Pn extends Pe{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),f=s.enabled&&e.options.animation&&s.animations,g=new Yr(this.chart,f);return f._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=$c(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,f=Ft(s,"beforeTitle",this,t),g=Ft(s,"title",this,t),v=Ft(s,"afterTitle",this,t);let a=[];return a=Yt(a,Qt(f)),a=Yt(a,Qt(g)),a=Yt(a,Qt(v)),a}getBeforeBody(t,e){return er(Ft(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,f=[];return vt(t,g=>{const v={before:[],lines:[],after:[]},a=ir(s,g);Yt(v.before,Qt(Ft(a,"beforeLabel",this,g))),Yt(v.lines,Ft(a,"label",this,g)),Yt(v.after,Qt(Ft(a,"afterLabel",this,g))),f.push(v)}),f}getAfterBody(t,e){return er(Ft(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,f=Ft(s,"beforeFooter",this,t),g=Ft(s,"footer",this,t),v=Ft(s,"afterFooter",this,t);let a=[];return a=Yt(a,Qt(f)),a=Yt(a,Qt(g)),a=Yt(a,Qt(v)),a}_createItems(t){const e=this._active,s=this.chart.data,f=[],g=[],v=[];let a=[],n,h;for(n=0,h=e.length;n<h;++n)a.push(Vc(this.chart,e[n]));return t.filter&&(a=a.filter((u,r,l)=>t.filter(u,r,l,s))),t.itemSort&&(a=a.sort((u,r)=>t.itemSort(u,r,s))),vt(a,u=>{const r=ir(t.callbacks,u);f.push(Ft(r,"labelColor",this,u)),g.push(Ft(r,"labelPointStyle",this,u)),v.push(Ft(r,"labelTextColor",this,u))}),this.labelColors=f,this.labelPointStyles=g,this.labelTextColors=v,this.dataPoints=a,a}update(t,e){const s=this.options.setContext(this.getContext()),f=this._active;let g,v=[];if(!f.length)this.opacity!==0&&(g={opacity:0});else{const a=Je[s.position].call(this,f,this._eventPosition);v=this._createItems(s),this.title=this.getTitle(v,s),this.beforeBody=this.getBeforeBody(v,s),this.body=this.getBody(v,s),this.afterBody=this.getAfterBody(v,s),this.footer=this.getFooter(v,s);const n=this._size=Qs(this,s),h=Object.assign({},a,n),u=Zs(this.chart,s,h),r=tr(s,h,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,g={opacity:1,x:r.x,y:r.y,width:n.width,height:n.height,caretX:a.x,caretY:a.y}}this._tooltipItems=v,this.$context=void 0,g&&this._resolveAnimations().update(this,g),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,f){const g=this.getCaretPosition(t,s,f);e.lineTo(g.x1,g.y1),e.lineTo(g.x2,g.y2),e.lineTo(g.x3,g.y3)}getCaretPosition(t,e,s){const{xAlign:f,yAlign:g}=this,{caretSize:v,cornerRadius:a}=s,{topLeft:n,topRight:h,bottomLeft:u,bottomRight:r}=Re(a),{x:l,y:o}=t,{width:d,height:p}=e;let c,m,_,b,y,x;return g==="center"?(y=o+p/2,f==="left"?(c=l,m=c-v,b=y+v,x=y-v):(c=l+d,m=c+v,b=y-v,x=y+v),_=c):(f==="left"?m=l+Math.max(n,u)+v:f==="right"?m=l+d-Math.max(h,r)-v:m=this.caretX,g==="top"?(b=o,y=b-v,c=m-v,_=m+v):(b=o+p,y=b+v,c=m+v,_=m-v),x=b),{x1:c,x2:m,x3:_,y1:b,y2:y,y3:x}}drawTitle(t,e,s){const f=this.title,g=f.length;let v,a,n;if(g){const h=hn(s.rtl,this.x,this.width);for(t.x=Mi(this,s.titleAlign,s),e.textAlign=h.textAlign(s.titleAlign),e.textBaseline="middle",v=Et(s.titleFont),a=s.titleSpacing,e.fillStyle=s.titleColor,e.font=v.string,n=0;n<g;++n)e.fillText(f[n],h.x(t.x),t.y+v.lineHeight/2),t.y+=v.lineHeight+a,n+1===g&&(t.y+=s.titleMarginBottom-a)}}_drawColorBox(t,e,s,f,g){const v=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:n,boxWidth:h}=g,u=Et(g.bodyFont),r=Mi(this,"left",g),l=f.x(r),o=n<u.lineHeight?(u.lineHeight-n)/2:0,d=e.y+o;if(g.usePointStyle){const p={radius:Math.min(h,n)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},c=f.leftForLtr(l,h)+h/2,m=d+n/2;t.strokeStyle=g.multiKeyBackground,t.fillStyle=g.multiKeyBackground,wn(t,p,c,m),t.strokeStyle=v.borderColor,t.fillStyle=v.backgroundColor,wn(t,p,c,m)}else{t.lineWidth=dt(v.borderWidth)?Math.max(...Object.values(v.borderWidth)):v.borderWidth||1,t.strokeStyle=v.borderColor,t.setLineDash(v.borderDash||[]),t.lineDashOffset=v.borderDashOffset||0;const p=f.leftForLtr(l,h),c=f.leftForLtr(f.xPlus(l,1),h-2),m=Re(v.borderRadius);Object.values(m).some(_=>_!==0)?(t.beginPath(),t.fillStyle=g.multiKeyBackground,qi(t,{x:p,y:d,w:h,h:n,radius:m}),t.fill(),t.stroke(),t.fillStyle=v.backgroundColor,t.beginPath(),qi(t,{x:c,y:d+1,w:h-2,h:n-2,radius:m}),t.fill()):(t.fillStyle=g.multiKeyBackground,t.fillRect(p,d,h,n),t.strokeRect(p,d,h,n),t.fillStyle=v.backgroundColor,t.fillRect(c,d+1,h-2,n-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:f}=this,{bodySpacing:g,bodyAlign:v,displayColors:a,boxHeight:n,boxWidth:h,boxPadding:u}=s,r=Et(s.bodyFont);let l=r.lineHeight,o=0;const d=hn(s.rtl,this.x,this.width),p=function(O){e.fillText(O,d.x(t.x+o),t.y+l/2),t.y+=l+g},c=d.textAlign(v);let m,_,b,y,x,C,w;for(e.textAlign=v,e.textBaseline="middle",e.font=r.string,t.x=Mi(this,c,s),e.fillStyle=s.bodyColor,vt(this.beforeBody,p),o=a&&c!=="right"?v==="center"?h/2+u:h+2+u:0,y=0,C=f.length;y<C;++y){for(m=f[y],_=this.labelTextColors[y],e.fillStyle=_,vt(m.before,p),b=m.lines,a&&b.length&&(this._drawColorBox(e,t,y,d,s),l=Math.max(r.lineHeight,n)),x=0,w=b.length;x<w;++x)p(b[x]),l=r.lineHeight;vt(m.after,p)}o=0,l=r.lineHeight,vt(this.afterBody,p),t.y-=g}drawFooter(t,e,s){const f=this.footer,g=f.length;let v,a;if(g){const n=hn(s.rtl,this.x,this.width);for(t.x=Mi(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=n.textAlign(s.footerAlign),e.textBaseline="middle",v=Et(s.footerFont),e.fillStyle=s.footerColor,e.font=v.string,a=0;a<g;++a)e.fillText(f[a],n.x(t.x),t.y+v.lineHeight/2),t.y+=v.lineHeight+s.footerSpacing}}drawBackground(t,e,s,f){const{xAlign:g,yAlign:v}=this,{x:a,y:n}=t,{width:h,height:u}=s,{topLeft:r,topRight:l,bottomLeft:o,bottomRight:d}=Re(f.cornerRadius);e.fillStyle=f.backgroundColor,e.strokeStyle=f.borderColor,e.lineWidth=f.borderWidth,e.beginPath(),e.moveTo(a+r,n),v==="top"&&this.drawCaret(t,e,s,f),e.lineTo(a+h-l,n),e.quadraticCurveTo(a+h,n,a+h,n+l),v==="center"&&g==="right"&&this.drawCaret(t,e,s,f),e.lineTo(a+h,n+u-d),e.quadraticCurveTo(a+h,n+u,a+h-d,n+u),v==="bottom"&&this.drawCaret(t,e,s,f),e.lineTo(a+o,n+u),e.quadraticCurveTo(a,n+u,a,n+u-o),v==="center"&&g==="left"&&this.drawCaret(t,e,s,f),e.lineTo(a,n+r),e.quadraticCurveTo(a,n,a+r,n),e.closePath(),e.fill(),f.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,f=s&&s.x,g=s&&s.y;if(f||g){const v=Je[t.position].call(this,this._active,this._eventPosition);if(!v)return;const a=this._size=Qs(this,t),n=Object.assign({},v,this._size),h=Zs(e,t,n),u=tr(t,n,h,e);(f._to!==u.x||g._to!==u.y)&&(this.xAlign=h.xAlign,this.yAlign=h.yAlign,this.width=a.width,this.height=a.height,this.caretX=v.x,this.caretY=v.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const f={width:this.width,height:this.height},g={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const v=jt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=s,this.drawBackground(g,t,f,e),wl(t,e.textDirection),g.y+=v.top,this.drawTitle(g,t,e),this.drawBody(g,t,e),this.drawFooter(g,t,e),Tl(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,f=t.map(({datasetIndex:a,index:n})=>{const h=this.chart.getDatasetMeta(a);if(!h)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:h.data[n],index:n}}),g=!Yi(s,f),v=this._positionChanged(f,e);(g||v)&&(this._active=f,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const f=this.options,g=this._active||[],v=this._getActiveElements(t,g,e,s),a=this._positionChanged(v,t),n=e||!Yi(v,g)||a;return n&&(this._active=v,(f.enabled||f.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),n}_getActiveElements(t,e,s,f){const g=this.options;if(t.type==="mouseout")return[];if(!f)return e;const v=this.chart.getElementsAtEventForMode(t,g.mode,g,s);return g.reverse&&v.reverse(),v}_positionChanged(t,e){const{caretX:s,caretY:f,options:g}=this,v=Je[g.position].call(this,t,e);return v!==!1&&(s!==v.x||f!==v.y)}}nt(Pn,"positioners",Je);var qc={id:"tooltip",_element:Pn,positioners:Je,afterInit(i,t,e){e&&(i.tooltip=new Pn({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:lo},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Kc=(i,t,e,s)=>(typeof t=="string"?(e=i.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function Jc(i,t,e,s){const f=i.indexOf(t);if(f===-1)return Kc(i,t,e,s);const g=i.lastIndexOf(t);return f!==g?e:f}const Qc=(i,t)=>i===null?null:At(Math.round(i),0,t);function nr(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class Dn extends De{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:f,label:g}of e)s[f]===g&&s.splice(f,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(gt(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:Jc(s,t,pt(e,t),this._addedLabels),Qc(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:f}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(f=this.getLabels().length-1)),this.min=s,this.max=f}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,f=[];let g=this.getLabels();g=t===0&&e===g.length-1?g:g.slice(t,e+1),this._valueRange=Math.max(g.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let v=t;v<=e;v++)f.push({value:v});return f}getLabelForValue(t){return nr.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}nt(Dn,"id","category"),nt(Dn,"defaults",{ticks:{callback:nr}});function Zc(i,t){const e=[],{bounds:f,step:g,min:v,max:a,precision:n,count:h,maxTicks:u,maxDigits:r,includeBounds:l}=i,o=g||1,d=u-1,{min:p,max:c}=t,m=!gt(v),_=!gt(a),b=!gt(h),y=(c-p)/(r+1);let x=ss((c-p)/d/o)*o,C,w,O,E;if(x<1e-14&&!m&&!_)return[{value:p},{value:c}];E=Math.ceil(c/x)-Math.floor(p/x),E>d&&(x=ss(E*x/d/o)*o),gt(n)||(C=Math.pow(10,n),x=Math.ceil(x*C)/C),f==="ticks"?(w=Math.floor(p/x)*x,O=Math.ceil(c/x)*x):(w=p,O=c),m&&_&&g&&ba((a-v)/g,x/1e3)?(E=Math.round(Math.min((a-v)/x,u)),x=(a-v)/E,w=v,O=a):b?(w=m?v:w,O=_?a:O,E=h-1,x=(O-w)/E):(E=(O-w)/x,ti(E,Math.round(E),x/1e3)?E=Math.round(E):E=Math.ceil(E));const j=Math.max(rs(x),rs(w));C=Math.pow(10,gt(n)?j:n),w=Math.round(w*C)/C,O=Math.round(O*C)/C;let H=0;for(m&&(l&&w!==v?(e.push({value:v}),w<v&&H++,ti(Math.round((w+H*x)*C)/C,v,sr(v,y,i))&&H++):w<v&&H++);H<E;++H){const q=Math.round((w+H*x)*C)/C;if(_&&q>a)break;e.push({value:q})}return _&&l&&O!==a?e.length&&ti(e[e.length-1].value,a,sr(a,y,i))?e[e.length-1].value=a:e.push({value:a}):(!_||O===a)&&e.push({value:O}),e}function sr(i,t,{horizontal:e,minRotation:s}){const f=Vt(s),g=(e?Math.sin(f):Math.cos(f))||.001,v=.75*t*(""+i).length;return Math.min(t/g,v)}class Qi extends De{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return gt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:f,max:g}=this;const v=n=>f=e?f:n,a=n=>g=s?g:n;if(t){const n=Ut(f),h=Ut(g);n<0&&h<0?a(0):n>0&&h>0&&v(0)}if(f===g){let n=g===0?1:Math.abs(g*.05);a(g+n),t||v(f-n)}this.min=f,this.max=g}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,f;return s?(f=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,f>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${f} ticks. Limiting to 1000.`),f=1e3)):(f=this.computeTickLimit(),e=e||11),e&&(f=Math.min(e,f)),f}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const f={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},g=this._range||this,v=Zc(f,g);return t.bounds==="ticks"&&Or(v,this,"value"),t.reverse?(v.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),v}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const f=(s-e)/Math.max(t.length-1,1)/2;e-=f,s+=f}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return gi(t,this.chart.options.locale,this.options.ticks.format)}}class An extends Qi{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Ot(t)?t:0,this.max=Ot(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=Vt(this.options.ticks.minRotation),f=(t?Math.sin(s):Math.cos(s))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,g.lineHeight/f))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}nt(An,"id","linear"),nt(An,"defaults",{ticks:{callback:tn.formatters.numeric}});const fi=i=>Math.floor(se(i)),xe=(i,t)=>Math.pow(10,fi(i)+t);function rr(i){return i/Math.pow(10,fi(i))===1}function or(i,t,e){const s=Math.pow(10,e),f=Math.floor(i/s);return Math.ceil(t/s)-f}function tu(i,t){const e=t-i;let s=fi(e);for(;or(i,t,s)>10;)s++;for(;or(i,t,s)<10;)s--;return Math.min(s,fi(i))}function eu(i,{min:t,max:e}){t=It(i.min,t);const s=[],f=fi(t);let g=tu(t,e),v=g<0?Math.pow(10,Math.abs(g)):1;const a=Math.pow(10,g),n=f>g?Math.pow(10,f):0,h=Math.round((t-n)*v)/v,u=Math.floor((t-n)/a/10)*a*10;let r=Math.floor((h-u)/Math.pow(10,g)),l=It(i.min,Math.round((n+u+r*Math.pow(10,g))*v)/v);for(;l<e;)s.push({value:l,major:rr(l),significand:r}),r>=10?r=r<15?15:20:r++,r>=20&&(g++,r=2,v=g>=0?1:v),l=Math.round((n+u+r*Math.pow(10,g))*v)/v;const o=It(i.max,l);return s.push({value:o,major:rr(o),significand:r}),s}class ar extends De{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=Qi.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return Ot(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Ot(t)?Math.max(0,t):null,this.max=Ot(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Ot(this._userMin)&&(this.min=t===xe(this.min,0)?xe(this.min,-1):xe(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,f=this.max;const g=a=>s=t?s:a,v=a=>f=e?f:a;s===f&&(s<=0?(g(1),v(10)):(g(xe(s,-1)),v(xe(f,1)))),s<=0&&g(xe(f,-1)),f<=0&&v(xe(s,1)),this.min=s,this.max=f}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=eu(e,this);return t.bounds==="ticks"&&Or(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":gi(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=se(t),this._valueRange=se(this.max)-se(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(se(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}nt(ar,"id","logarithmic"),nt(ar,"defaults",{ticks:{callback:tn.formatters.logarithmic,major:{enabled:!0}}});function En(i){const t=i.ticks;if(t.display&&i.display){const e=jt(t.backdropPadding);return pt(t.font&&t.font.size,wt.font.size)+e.height}return 0}function iu(i,t,e){return e=yt(e)?e:[e],{w:ja(i,t.string,e),h:e.length*t.lineHeight}}function lr(i,t,e,s,f){return i===s||i===f?{start:t-e/2,end:t+e/2}:i<s||i>f?{start:t-e,end:t}:{start:t,end:t+e}}function nu(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),s=[],f=[],g=i._pointLabels.length,v=i.options.pointLabels,a=v.centerPointLabels?Ct/g:0;for(let n=0;n<g;n++){const h=v.setContext(i.getPointLabelContext(n));f[n]=h.padding;const u=i.getPointPosition(n,i.drawingArea+f[n],a),r=Et(h.font),l=iu(i.ctx,r,i._pointLabels[n]);s[n]=l;const o=Nt(i.getIndexAngle(n)+a),d=Math.round(zn(o)),p=lr(d,u.x,l.w,0,180),c=lr(d,u.y,l.h,90,270);su(e,t,o,p,c)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=au(i,s,f)}function su(i,t,e,s,f){const g=Math.abs(Math.sin(e)),v=Math.abs(Math.cos(e));let a=0,n=0;s.start<t.l?(a=(t.l-s.start)/g,i.l=Math.min(i.l,t.l-a)):s.end>t.r&&(a=(s.end-t.r)/g,i.r=Math.max(i.r,t.r+a)),f.start<t.t?(n=(t.t-f.start)/v,i.t=Math.min(i.t,t.t-n)):f.end>t.b&&(n=(f.end-t.b)/v,i.b=Math.max(i.b,t.b+n))}function ru(i,t,e){const s=i.drawingArea,{extra:f,additionalAngle:g,padding:v,size:a}=e,n=i.getPointPosition(t,s+f+v,g),h=Math.round(zn(Nt(n.angle+Dt))),u=cu(n.y,a.h,h),r=lu(h),l=hu(n.x,a.w,r);return{visible:!0,x:n.x,y:u,textAlign:r,left:l,top:u,right:l+a.w,bottom:u+a.h}}function ou(i,t){if(!t)return!0;const{left:e,top:s,right:f,bottom:g}=i;return!(ee({x:e,y:s},t)||ee({x:e,y:g},t)||ee({x:f,y:s},t)||ee({x:f,y:g},t))}function au(i,t,e){const s=[],f=i._pointLabels.length,g=i.options,{centerPointLabels:v,display:a}=g.pointLabels,n={extra:En(g)/2,additionalAngle:v?Ct/f:0};let h;for(let u=0;u<f;u++){n.padding=e[u],n.size=t[u];const r=ru(i,u,n);s.push(r),a==="auto"&&(r.visible=ou(r,h),r.visible&&(h=r))}return s}function lu(i){return i===0||i===180?"center":i<180?"left":"right"}function hu(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function cu(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function uu(i,t,e){const{left:s,top:f,right:g,bottom:v}=e,{backdropColor:a}=t;if(!gt(a)){const n=Re(t.borderRadius),h=jt(t.backdropPadding);i.fillStyle=a;const u=s-h.left,r=f-h.top,l=g-s+h.width,o=v-f+h.height;Object.values(n).some(d=>d!==0)?(i.beginPath(),qi(i,{x:u,y:r,w:l,h:o,radius:n}),i.fill()):i.fillRect(u,r,l,o)}}function fu(i,t){const{ctx:e,options:{pointLabels:s}}=i;for(let f=t-1;f>=0;f--){const g=i._pointLabelItems[f];if(!g.visible)continue;const v=s.setContext(i.getPointLabelContext(f));uu(e,v,g);const a=Et(v.font),{x:n,y:h,textAlign:u}=g;ci(e,i._pointLabels[f],n,h+a.lineHeight/2,a,{color:v.color,textAlign:u,textBaseline:"middle"})}}function ho(i,t,e,s){const{ctx:f}=i;if(e)f.arc(i.xCenter,i.yCenter,t,0,kt);else{let g=i.getPointPosition(0,t);f.moveTo(g.x,g.y);for(let v=1;v<s;v++)g=i.getPointPosition(v,t),f.lineTo(g.x,g.y)}}function du(i,t,e,s,f){const g=i.ctx,v=t.circular,{color:a,lineWidth:n}=t;!v&&!s||!a||!n||e<0||(g.save(),g.strokeStyle=a,g.lineWidth=n,g.setLineDash(f.dash),g.lineDashOffset=f.dashOffset,g.beginPath(),ho(i,e,v,s),g.closePath(),g.stroke(),g.restore())}function gu(i,t,e){return me(i,{label:e,index:t,type:"pointLabel"})}class Pi extends Qi{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=jt(En(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=Ot(t)&&!isNaN(t)?t:0,this.max=Ot(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/En(this.options))}generateTickLabels(t){Qi.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const f=St(this.options.pointLabels.callback,[e,s],this);return f||f===0?f:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?nu(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,f){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-f)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,f))}getIndexAngle(t){const e=kt/(this._pointLabels.length||1),s=this.options.startAngle||0;return Nt(t*e+Vt(s))}getDistanceFromCenterForValue(t){if(gt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(gt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return gu(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const f=this.getIndexAngle(t)-Dt+s;return{x:Math.cos(f)*e+this.xCenter,y:Math.sin(f)*e+this.yCenter,angle:f}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:f,bottom:g}=this._pointLabelItems[t];return{left:e,top:s,right:f,bottom:g}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),ho(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:f,border:g}=e,v=this._pointLabels.length;let a,n,h;if(e.pointLabels.display&&fu(this,v),f.display&&this.ticks.forEach((u,r)=>{if(r!==0){n=this.getDistanceFromCenterForValue(u.value);const l=this.getContext(r),o=f.setContext(l),d=g.setContext(l);du(this,o,n,v,d)}}),s.display){for(t.save(),a=v-1;a>=0;a--){const u=s.setContext(this.getPointLabelContext(a)),{color:r,lineWidth:l}=u;!l||!r||(t.lineWidth=l,t.strokeStyle=r,t.setLineDash(u.borderDash),t.lineDashOffset=u.borderDashOffset,n=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),h=this.getPointPosition(a,n),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(h.x,h.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const f=this.getIndexAngle(0);let g,v;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(f),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,n)=>{if(n===0&&!e.reverse)return;const h=s.setContext(this.getContext(n)),u=Et(h.font);if(g=this.getDistanceFromCenterForValue(this.ticks[n].value),h.showLabelBackdrop){t.font=u.string,v=t.measureText(a.label).width,t.fillStyle=h.backdropColor;const r=jt(h.backdropPadding);t.fillRect(-v/2-r.left,-g-u.size/2-r.top,v+r.width,u.size+r.height)}ci(t,a.label,0,-g,u,{color:h.color,strokeColor:h.textStrokeColor,strokeWidth:h.textStrokeWidth})}),t.restore()}drawTitle(){}}nt(Pi,"id","radialLinear"),nt(Pi,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:tn.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),nt(Pi,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),nt(Pi,"descriptors",{angleLines:{_fallback:"grid"}});const nn={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Lt=Object.keys(nn);function hr(i,t){return i-t}function cr(i,t){if(gt(t))return null;const e=i._adapter,{parser:s,round:f,isoWeekday:g}=i._parseOpts;let v=t;return typeof s=="function"&&(v=s(v)),Ot(v)||(v=typeof s=="string"?e.parse(v,s):e.parse(v)),v===null?null:(f&&(v=f==="week"&&(hi(g)||g===!0)?e.startOf(v,"isoWeek",g):e.startOf(v,f)),+v)}function ur(i,t,e,s){const f=Lt.length;for(let g=Lt.indexOf(i);g<f-1;++g){const v=nn[Lt[g]],a=v.steps?v.steps:Number.MAX_SAFE_INTEGER;if(v.common&&Math.ceil((e-t)/(a*v.size))<=s)return Lt[g]}return Lt[f-1]}function pu(i,t,e,s,f){for(let g=Lt.length-1;g>=Lt.indexOf(e);g--){const v=Lt[g];if(nn[v].common&&i._adapter.diff(f,s,v)>=t-1)return v}return Lt[e?Lt.indexOf(e):0]}function mu(i){for(let t=Lt.indexOf(i)+1,e=Lt.length;t<e;++t)if(nn[Lt[t]].common)return Lt[t]}function fr(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:s,hi:f}=Wn(e,t),g=e[s]>=t?e[s]:e[f];i[g]=!0}}function vu(i,t,e,s){const f=i._adapter,g=+f.startOf(t[0].value,s),v=t[t.length-1].value;let a,n;for(a=g;a<=v;a=+f.add(a,1,s))n=e[a],n>=0&&(t[n].major=!0);return t}function dr(i,t,e){const s=[],f={},g=t.length;let v,a;for(v=0;v<g;++v)a=t[v],f[a]=v,s.push({value:a,major:!1});return g===0||!e?s:vu(i,s,f,e)}class Zi extends De{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),f=this._adapter=new rh._date(t.adapters.date);f.init(e),Ze(s.displayFormats,f.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:cr(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:f,max:g,minDefined:v,maxDefined:a}=this.getUserBounds();function n(h){!v&&!isNaN(h.min)&&(f=Math.min(f,h.min)),!a&&!isNaN(h.max)&&(g=Math.max(g,h.max))}(!v||!a)&&(n(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&n(this.getMinMax(!1))),f=Ot(f)&&!isNaN(f)?f:+e.startOf(Date.now(),s),g=Ot(g)&&!isNaN(g)?g:+e.endOf(Date.now(),s)+1,this.min=Math.min(f,g-1),this.max=Math.max(f+1,g)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,f=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&f.length&&(this.min=this._userMin||f[0],this.max=this._userMax||f[f.length-1]);const g=this.min,v=this.max,a=wa(f,g,v);return this._unit=e.unit||(s.autoSkip?ur(e.minUnit,this.min,this.max,this._getLabelCapacity(g)):pu(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:mu(this._unit),this.initOffsets(f),t.reverse&&a.reverse(),dr(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,f,g;this.options.offset&&t.length&&(f=this.getDecimalForValue(t[0]),t.length===1?e=1-f:e=(this.getDecimalForValue(t[1])-f)/2,g=this.getDecimalForValue(t[t.length-1]),t.length===1?s=g:s=(g-this.getDecimalForValue(t[t.length-2]))/2);const v=t.length<3?.5:.25;e=At(e,0,v),s=At(s,0,v),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,f=this.options,g=f.time,v=g.unit||ur(g.minUnit,e,s,this._getLabelCapacity(e)),a=pt(f.ticks.stepSize,1),n=v==="week"?g.isoWeekday:!1,h=hi(n)||n===!0,u={};let r=e,l,o;if(h&&(r=+t.startOf(r,"isoWeek",n)),r=+t.startOf(r,h?"day":v),t.diff(s,e,v)>1e5*a)throw new Error(e+" and "+s+" are too far apart with stepSize of "+a+" "+v);const d=f.ticks.source==="data"&&this.getDataTimestamps();for(l=r,o=0;l<s;l=+t.add(l,a,v),o++)fr(u,l,d);return(l===s||f.bounds==="ticks"||o===1)&&fr(u,l,d),Object.keys(u).sort(hr).map(p=>+p)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const f=this.options.time.displayFormats,g=this._unit,v=e||f[g];return this._adapter.format(t,v)}_tickFormatFunction(t,e,s,f){const g=this.options,v=g.ticks.callback;if(v)return St(v,[t,e,s],this);const a=g.time.displayFormats,n=this._unit,h=this._majorUnit,u=n&&a[n],r=h&&a[h],l=s[e],o=h&&r&&l&&l.major;return this._adapter.format(t,f||(o?r:u))}generateTickLabels(t){let e,s,f;for(e=0,s=t.length;e<s;++e)f=t[e],f.label=this._tickFormatFunction(f.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,f=Vt(this.isHorizontal()?e.maxRotation:e.minRotation),g=Math.cos(f),v=Math.sin(f),a=this._resolveTickFontOptions(0).size;return{w:s*g+a*v,h:s*v+a*g}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,f=s[e.unit]||s.millisecond,g=this._tickFormatFunction(t,0,dr(this,[t],this._majorUnit),f),v=this._getLabelSize(g),a=Math.floor(this.isHorizontal()?this.width/v.w:this.height/v.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const f=this.getMatchingVisibleMetas();if(this._normalized&&f.length)return this._cache.data=f[0].controller.getAllParsedValues(this);for(e=0,s=f.length;e<s;++e)t=t.concat(f[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const f=this.getLabels();for(e=0,s=f.length;e<s;++e)t.push(cr(this,f[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Mr(t.sort(hr))}}nt(Zi,"id","time"),nt(Zi,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Di(i,t,e){let s=0,f=i.length-1,g,v,a,n;e?(t>=i[s].pos&&t<=i[f].pos&&({lo:s,hi:f}=te(i,"pos",t)),{pos:g,time:a}=i[s],{pos:v,time:n}=i[f]):(t>=i[s].time&&t<=i[f].time&&({lo:s,hi:f}=te(i,"time",t)),{time:g,pos:a}=i[s],{time:v,pos:n}=i[f]);const h=v-g;return h?a+(n-a)*(t-g)/h:a}class gr extends Zi{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Di(e,this.min),this._tableRange=Di(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,f=[],g=[];let v,a,n,h,u;for(v=0,a=t.length;v<a;++v)h=t[v],h>=e&&h<=s&&f.push(h);if(f.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(v=0,a=f.length;v<a;++v)u=f[v+1],n=f[v-1],h=f[v],Math.round((u+n)/2)!==h&&g.push({time:h,pos:v/(a-1)});return g}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((f,g)=>f-g)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(Di(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return Di(this._table,s*this._tableRange+this._minPos,!0)}}nt(gr,"id","timeseries"),nt(gr,"defaults",Zi.defaults);Rt.register(Li,An,Ke,ji,Fi,zi,Dn,Lc,qc,Wc,Nc,jc);function co(i){return getComputedStyle(document.body).getPropertyValue(i)}Rt.defaults.color=()=>co("--color");Rt.defaults.borderColor=()=>co("--muted-color");function _u(i){const t=new Rt(i,{type:"line",data:{labels:[],datasets:[{label:"Training Dataset",data:[]}]},options:{responsive:!0,scales:{x:{type:"linear",min:1,suggestedMax:10,title:{display:!0,text:"# of Iteration"}},y:{type:"linear",min:0,max:1,title:{display:!0,text:"Error Rate"}}},plugins:{title:{text:"Training Progress",display:!0},subtitle:{text:"Iteration: 0, Error Rate: 100%",display:!0}}}});return{chart:t,append(e,s){var f;t.data.datasets.map((g,v)=>g.data.push(e[v])),(f=t.data.labels)==null||f.push(s),t.update()},reset(){t.data.datasets.forEach(e=>e.data=[]),t.data.labels=[],t.update()}}}function bu(i){const t=new Rt(i,{type:"bar",data:{labels:[0,1,2,3,4,5,6,7,8,9],datasets:[{label:"Probability",data:[]}]},options:{responsive:!0,scales:{x:{type:"category",title:{display:!0,text:"Digit"},grid:{display:!1}},y:{type:"linear",min:0,max:1,title:{display:!0,text:"Confidence"},grid:{display:!1}}}}});return{chart:t,update(e){t.data.datasets[0].data=e,t.update()},clear(){t.data.datasets[0].data=[],t.update()}}}function yu(i){return{sendCommand(t,e){i.postMessage({cmd:t,data:e})},handleCommand(t){i.onmessage=e=>t(e.data)},sendCommandTransfer(t,e){i.postMessage({cmd:t,data:e},[e.buffer])}}}class xu{constructor(){nt(this,"pipe");nt(this,"callbacks",{});this.pipe=yu(new Worker(new URL("/digit-recognizer/assets/wasm.worker-58fd59a2.js",self.location),{type:"module"})),this.pipe.handleCommand(({cmd:t,data:e})=>{var s;switch(t){case"step":case"prediction":(s=this.callbacks[t])==null||s.call(null,e);break}})}start_training(t,e){const s={type:t,param:e};this.pipe.sendCommand("start_training",s)}stop_training(){this.pipe.sendCommand("stop_training",null)}set onstep(t){this.callbacks.step=t}predict(t){this.pipe.sendCommandTransfer("predict",t)}set onprediction(t){this.callbacks.prediction=t}}function Cu(i){const t=i.getImageData(0,0,i.canvas.width,i.canvas.height),{sx:e,sy:s,sw:f,sh:g}=Su(t);return[f,g,i.getImageData(e,s,f,g)]}function Su(i){const t=i.width,e=i.height;let s=t,f=e,g=0,v=0;for(let a=0;a<e;a++)for(let n=0;n<t;n++){const h=(a*t+n)*4;let u=i.data[h],r=i.data[h+1],l=i.data[h+2];Math.min(u,r,l)!=255&&(n<s?s=n:n>g&&(g=n),a<f?f=a:a>v&&(v=a))}return{sx:s,sy:f,sw:1+g-s,sh:1+v-f}}function wu(i){let t=new Float64Array(i.length/4);for(let e=0;e<i.length;e+=4){const s=255-i[e],f=255-i[e+1],g=255-i[e+2];255-i[e+3];const v=.299*s+.587*f+.114*g;t[e/4]=v}return t}function Tu(i){let t,e,s,f,g;function v(n){i[7](n)}let a={};return i[0].param.perceptron!==void 0&&(a.param=i[0].param.perceptron),s=new Bo({props:a}),ri.push(()=>Ln(s,"param",v)),{c(){t=ot("h3"),t.textContent="Perceptron (1-layer Neural Network)",e=_t(),ke(s.$$.fragment)},m(n,h){ut(n,t,h),ut(n,e,h),le(s,n,h),g=!0},p(n,h){const u={};!f&&h&1&&(f=!0,u.param=n[0].param.perceptron,Fn(()=>f=!1)),s.$set(u)},i(n){g||(qt(s.$$.fragment,n),g=!0)},o(n){ie(s.$$.fragment,n),g=!1},d(n){n&&(ct(t),ct(e)),he(s,n)}}}function Ou(i){let t,e,s,f,g;function v(n){i[6](n)}let a={};return i[0].param.knn!==void 0&&(a.param=i[0].param.knn),s=new Lo({props:a}),ri.push(()=>Ln(s,"param",v)),{c(){t=ot("h3"),t.textContent="K Nearest Neighbors",e=_t(),ke(s.$$.fragment)},m(n,h){ut(n,t,h),ut(n,e,h),le(s,n,h),g=!0},p(n,h){const u={};!f&&h&1&&(f=!0,u.param=n[0].param.knn,Fn(()=>f=!1)),s.$set(u)},i(n){g||(qt(s.$$.fragment,n),g=!0)},o(n){ie(s.$$.fragment,n),g=!1},d(n){n&&(ct(t),ct(e)),he(s,n)}}}function ku(i){let t,e,s,f,g,v,a;function n(u){i[5](u)}let h={};return i[0].param.kmeans!==void 0&&(h.param=i[0].param.kmeans),g=new Ao({props:h}),ri.push(()=>Ln(g,"param",n)),{c(){t=ot("h3"),t.textContent="K Means Clustering",e=_t(),s=ot("p"),s.innerHTML=`The K Means clustering is an algorithm that groups data into <i>K</i> number
        of clusters by assigning each observation to a cluster with the closest centroid
        (center of cluster).`,f=_t(),ke(g.$$.fragment)},m(u,r){ut(u,t,r),ut(u,e,r),ut(u,s,r),ut(u,f,r),le(g,u,r),a=!0},p(u,r){const l={};!v&&r&1&&(v=!0,l.param=u[0].param.kmeans,Fn(()=>v=!1)),g.$set(l)},i(u){a||(qt(g.$$.fragment,u),a=!0)},o(u){ie(g.$$.fragment,u),a=!1},d(u){u&&(ct(t),ct(e),ct(s),ct(f)),he(g,u)}}}function Mu(i){let t,e,s;return{c(){t=ot("button"),t.textContent="Stop Training"},m(f,g){ut(f,t,g),e||(s=Gt(t,"click",i[9]),e=!0)},p:Mt,d(f){f&&ct(t),e=!1,s()}}}function Pu(i){let t,e,s;return{c(){t=ot("button"),t.textContent="Start Training"},m(f,g){ut(f,t,g),e||(s=Gt(t,"click",i[8]),e=!0)},p:Mt,d(f){f&&ct(t),e=!1,s()}}}function Du(i){let t,e,s,f,g,v,a,n,h,u,r,l,o,d,p,c,m,_,b,y,x,C,w,O,E,j,H,q,Q,K,G,Z,et,it,S,P,D,M,I,k;const T=[ku,Ou,Tu],A=[];function L(W,J){return W[0].selected=="kmeans"?0:W[0].selected=="knn"?1:W[0].selected=="perceptron"?2:-1}~(r=L(i))&&(l=A[r]=T[r](i));function N(W,J){return W[0].is_training==!1?Pu:Mu}let R=N(i),V=R(i);return{c(){t=ot("header"),e=ot("h1"),e.textContent="Train your own AI locally in your browser!",s=_t(),f=ot("label"),g=Oe(`Select a model type to train:
        `),v=ot("select"),a=ot("option"),a.textContent="K Means Clustering",n=ot("option"),n.textContent="K Nearest Neighbors",h=ot("option"),h.textContent="Perceptron (1-layer Neural Network)",u=_t(),l&&l.c(),o=_t(),d=ot("div"),d.innerHTML='<canvas id="training_chart"></canvas>',p=_t(),c=ot("div"),V.c(),m=_t(),_=ot("footer"),b=ot("h5"),b.textContent="Evaluate the model using MNSIT testing dataset (10,000 observations):",y=_t(),x=ot("p"),x.textContent="Error Rate:",C=_t(),w=ot("p"),w.textContent="Actual vs Predicted Matrix",O=_t(),E=ot("button"),E.textContent="Evaluate",j=_t(),H=ot("h5"),H.textContent="Test the model by drawing a digit yourself:",q=_t(),Q=ot("div"),K=ot("div"),G=ot("div"),G.innerHTML='<canvas id="canvas" width="300" height="300"></canvas>',Z=_t(),et=ot("button"),et.textContent="Clear",it=_t(),S=ot("div"),S.innerHTML='<canvas id="cropped-canvas" width="28" height="28" class="svelte-1ju8fsv"></canvas> <canvas id="scaled-canvas" width="28" height="28" class="svelte-1ju8fsv"></canvas>',P=_t(),D=ot("div"),D.innerHTML='<p>Your model is &quot;00&quot;% sure this is a &quot;digit&quot;</p> <canvas id="probability_chart"></canvas>',a.__value="kmeans",Bt(a,a.__value),n.__value="knn",Bt(n,n.__value),h.__value="perceptron",Bt(h,h.__value),i[0].selected===void 0&&Xi(()=>i[4].call(v)),xt(c,"class","grid"),xt(G,"id","canvas-wrapper"),xt(G,"class","svelte-1ju8fsv"),xt(S,"class","grid"),Fe(S,"display","none"),xt(Q,"class","grid")},m(W,J){ut(W,t,J),at(t,e),at(t,s),at(t,f),at(f,g),at(f,v),at(v,a),at(v,n),at(v,h),Kn(v,i[0].selected,!0),ut(W,u,J),~r&&A[r].m(W,J),ut(W,o,J),ut(W,d,J),ut(W,p,J),ut(W,c,J),V.m(c,null),ut(W,m,J),ut(W,_,J),at(_,b),at(_,y),at(_,x),at(_,C),at(_,w),at(_,O),at(_,E),at(_,j),at(_,H),at(_,q),at(_,Q),at(Q,K),at(K,G),at(K,Z),at(K,et),at(K,it),at(K,S),at(Q,P),at(Q,D),M=!0,I||(k=[Gt(v,"change",i[4]),Gt(et,"click",i[3])],I=!0)},p(W,[J]){J&1&&Kn(v,W[0].selected);let B=r;r=L(W),r===B?~r&&A[r].p(W,J):(l&&(To(),ie(A[B],1,1,()=>{A[B]=null}),Oo()),~r?(l=A[r],l?l.p(W,J):(l=A[r]=T[r](W),l.c()),qt(l,1),l.m(o.parentNode,o)):l=null),R===(R=N(W))&&V?V.p(W,J):(V.d(1),V=R(W),V&&(V.c(),V.m(c,null)))},i(W){M||(qt(l),M=!0)},o(W){ie(l),M=!1},d(W){W&&(ct(t),ct(u),ct(o),ct(d),ct(p),ct(c),ct(m),ct(_)),~r&&A[r].d(W),V.d(),I=!1,fe(k)}}}function Au(i,t,e){const s=new xu,f={selected:"kmeans",is_training:!1,param:{kmeans:{max_iter:100,n_clusters:10},knn:{k:10},perceptron:{max_iter:100,learning_rate:.01}}};let g,v,a;vr(()=>{g=_u("training_chart"),a=bu("probability_chart"),v=new yr.fabric.Canvas("canvas",{isDrawingMode:!0}),v.freeDrawingBrush.color="black",v.freeDrawingBrush.width=15,v.backgroundColor="rgba(255, 255, 255, 255)";let _,b=!1,y=!1;function x(){clearTimeout(_),_=setTimeout(()=>{y=!0,v.freeDrawingBrush._finalizeAndAddPath();const C=r(),w=wu(C);s.predict(w),y=!1},50),y=!0}v.on("mouse:down",C=>{b=!0}),v.on("mouse:up",C=>{b=!1,x()}),v.on("mouse:move",C=>{b&&y==!1&&x()})});function n(){g.reset(),s.start_training(f.selected,f.param[f.selected])}function h(){s.stop_training()}s.onstep=_=>{var b,y;if(console.log(`[main][step]: ${_.i}: train: ${_.training_err}, test: ${_.testing_err}`),g.append([_.training_err,0],_.i),(y=(b=g.chart.options.plugins)==null?void 0:b.subtitle)!=null&&y.text){const x=Math.trunc(_.training_err*100);g.chart.options.plugins.subtitle.text=`Iteration: ${_.i}, Error Rate: ${x}%`}};function u(){v.clear(),v.backgroundColor="rgba(255, 255, 255, 255)",v.renderAll();const _=document.getElementById("canvas").getContext("2d",{willReadFrequently:!0}),b=document.getElementById("cropped-canvas").getContext("2d",{willReadFrequently:!0}),y=document.getElementById("scaled-canvas").getContext("2d",{willReadFrequently:!0});_.clearRect(0,0,_.canvas.width,_.canvas.height),b.clearRect(0,0,b.canvas.width,b.canvas.height),y.clearRect(0,0,y.canvas.width,y.canvas.height),a.clear()}function r(){const _=document.getElementById("canvas").getContext("2d",{willReadFrequently:!0}),b=document.getElementById("cropped-canvas").getContext("2d",{willReadFrequently:!0}),y=document.getElementById("scaled-canvas").getContext("2d",{willReadFrequently:!0});b.fillStyle="rgba(255, 255, 255, 255)",b.fillRect(0,0,b.canvas.width,b.canvas.height),b.save();const[x,C,w]=Cu(_);b.canvas.width=Math.max(x,C)*1.2,b.canvas.height=Math.max(x,C)*1.2;const O=(b.canvas.width-x)/2,E=(b.canvas.height-C)/2;b.putImageData(w,O,E),y.save(),y.clearRect(0,0,y.canvas.height,y.canvas.width),y.fillStyle="rgba(255, 255, 255, 255)",y.fillRect(0,0,b.canvas.width,b.canvas.height),y.scale(28/b.canvas.height,28/b.canvas.width),y.drawImage(b.canvas,0,0);const{data:j}=y.getImageData(0,0,28,28);return y.restore(),j}s.onprediction=_=>{a.update(_)};function l(){f.selected=bo(this),e(0,f)}function o(_){i.$$.not_equal(f.param.kmeans,_)&&(f.param.kmeans=_,e(0,f))}function d(_){i.$$.not_equal(f.param.knn,_)&&(f.param.knn=_,e(0,f))}function p(_){i.$$.not_equal(f.param.perceptron,_)&&(f.param.perceptron=_,e(0,f))}return[f,n,h,u,l,o,d,p,()=>{e(0,f.is_training=!0,f),n()},()=>{e(0,f.is_training=!1,f),h()}]}class Eu extends pe{constructor(t){super(),ge(this,t,Au,Du,de,{})}}function Fu(i){let t,e,s=[{xmlns:"http://www.w3.org/2000/svg"},{width:"1em"},{height:"1em"},{viewBox:"0 0 98 98"},i[0]],f={};for(let g=0;g<s.length;g+=1)f=Be(f,s[g]);return{c(){t=Ni("svg"),e=Ni("path"),xt(e,"fill-rule","evenodd"),xt(e,"clip-rule","evenodd"),xt(e,"d","M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"),xt(e,"fill","currentColor"),Vi(t,f)},m(g,v){ut(g,t,v),at(t,e)},p(g,[v]){Vi(t,f=br(s,[{xmlns:"http://www.w3.org/2000/svg"},{width:"1em"},{height:"1em"},{viewBox:"0 0 98 98"},v&1&&g[0]]))},i:Mt,o:Mt,d(g){g&&ct(t)}}}function Lu(i,t,e){return i.$$set=s=>{e(0,t=Be(Be({},t),Wi(s)))},t=Wi(t),[t]}class Iu extends pe{constructor(t){super(),ge(this,t,Lu,Fu,de,{})}}function Ru(i){let t,e,s=[{xmlns:"http://www.w3.org/2000/svg"},{width:"1em"},{height:"1em"},{viewBox:"0 0 24 24"},i[0]],f={};for(let g=0;g<s.length;g+=1)f=Be(f,s[g]);return{c(){t=Ni("svg"),e=Ni("path"),xt(e,"fill","currentColor"),xt(e,"d","M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10Zm0-2V4a8 8 0 1 1 0 16Z"),Vi(t,f)},m(g,v){ut(g,t,v),at(t,e)},p(g,[v]){Vi(t,f=br(s,[{xmlns:"http://www.w3.org/2000/svg"},{width:"1em"},{height:"1em"},{viewBox:"0 0 24 24"},v&1&&g[0]]))},i:Mt,o:Mt,d(g){g&&ct(t)}}}function Bu(i,t,e){return i.$$set=s=>{e(0,t=Be(Be({},t),Wi(s)))},t=Wi(t),[t]}class ju extends pe{constructor(t){super(),ge(this,t,Bu,Ru,de,{})}}function zu(i){let t,e,s,f,g,v,a,n,h,u,r,l,o,d;return a=new Iu({}),r=new ju({}),{c(){t=ot("nav"),e=ot("ul"),e.innerHTML="<li><strong>Digit Recognizer</strong></li>",s=_t(),f=ot("ul"),g=ot("li"),v=ot("a"),ke(a.$$.fragment),n=_t(),h=ot("li"),u=ot("button"),ke(r.$$.fragment),xt(v,"class","contrast"),xt(v,"href","https://github.com/Jgansaown/digit-recognizer"),Fe(u,"padding","0"),Fe(u,"background","none"),Fe(u,"border","none"),Fe(u,"box-shadow","none"),Fe(u,"color","inherit"),xt(t,"class","svelte-10k1ie")},m(p,c){ut(p,t,c),at(t,e),at(t,s),at(t,f),at(f,g),at(g,v),le(a,v,null),at(f,n),at(f,h),at(h,u),le(r,u,null),l=!0,o||(d=Gt(u,"click",i[0]),o=!0)},p:Mt,i(p){l||(qt(a.$$.fragment,p),qt(r.$$.fragment,p),l=!0)},o(p){ie(a.$$.fragment,p),ie(r.$$.fragment,p),l=!1},d(p){p&&ct(t),he(a),he(r),o=!1,d()}}}function Wu(){if(typeof window.localStorage<"u"){const i=window.localStorage.getItem("data-theme");if(i=="dark"||i=="light")return i}}function Nu(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Vu(i){let t="dark";vr(()=>{const f=Wu();f!=null?t=f:t=Nu(),s(t)});function e(){t=t=="dark"?"light":"dark",s(t)}function s(f){document.documentElement.setAttribute("data-theme",f),window.localStorage.setItem("data-theme",f),Object.values(Rt.instances).forEach(g=>g.update())}return[e]}class Xu extends pe{constructor(t){super(),ge(this,t,Vu,zu,de,{})}}function Yu(i){let t,e,s,f,g;return t=new Xu({}),f=new Eu({}),{c(){ke(t.$$.fragment),e=_t(),s=ot("article"),ke(f.$$.fragment)},m(v,a){le(t,v,a),ut(v,e,a),ut(v,s,a),le(f,s,null),g=!0},p:Mt,i(v){g||(qt(t.$$.fragment,v),qt(f.$$.fragment,v),g=!0)},o(v){ie(t.$$.fragment,v),ie(f.$$.fragment,v),g=!1},d(v){v&&(ct(e),ct(s)),he(t,v),he(f)}}}class Hu extends pe{constructor(t){super(),ge(this,t,null,Yu,de,{})}}new Hu({target:document.getElementById("app")});
