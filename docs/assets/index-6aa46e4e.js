var Mo=Object.defineProperty;var Po=(i,t,e)=>t in i?Mo(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Z=(i,t,e)=>(Po(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const g of c)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function e(c){const g={};return c.integrity&&(g.integrity=c.integrity),c.referrerPolicy&&(g.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?g.credentials="include":c.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function s(c){if(c.ep)return;c.ep=!0;const g=e(c);fetch(c.href,g)}})();function Ze(){}function xr(i){return i()}function $n(){return Object.create(null)}function Fe(i){i.forEach(xr)}function Cr(i){return typeof i=="function"}function Do(i,t){return i!=i?t==t:i!==t||i&&typeof i=="object"||typeof i=="function"}function Ao(i){return Object.keys(i).length===0}function ot(i,t){i.appendChild(t)}function Gi(i,t,e){i.insertBefore(t,e||null)}function ci(i){i.parentNode&&i.parentNode.removeChild(i)}function ut(i){return document.createElement(i)}function te(i){return document.createTextNode(i)}function Ft(){return te(" ")}function oe(i,t,e,s){return i.addEventListener(t,e,s),()=>i.removeEventListener(t,e,s)}function kt(i,t,e){e==null?i.removeAttribute(t):i.getAttribute(t)!==e&&i.setAttribute(t,e)}function Rt(i){return i===""?null:+i}function Eo(i){return Array.from(i.childNodes)}function Ot(i,t){i.value=t??""}function qn(i,t,e){for(let s=0;s<i.options.length;s+=1){const c=i.options[s];if(c.__value===t){c.selected=!0;return}}(!e||t!==void 0)&&(i.selectedIndex=-1)}function Fo(i){const t=i.querySelector(":checked");return t&&t.__value}let ti;function Ge(i){ti=i}function Lo(){if(!ti)throw new Error("Function called outside component initialization");return ti}function Ro(i){Lo().$$.on_mount.push(i)}const ke=[],Kn=[];let Me=[];const Qn=[],Io=Promise.resolve();let gn=!1;function Bo(){gn||(gn=!0,Io.then(Sr))}function ji(i){Me.push(i)}const Zi=new Set;let we=0;function Sr(){if(we!==0)return;const i=ti;do{try{for(;we<ke.length;){const t=ke[we];we++,Ge(t),jo(t.$$)}}catch(t){throw ke.length=0,we=0,t}for(Ge(null),ke.length=0,we=0;Kn.length;)Kn.pop()();for(let t=0;t<Me.length;t+=1){const e=Me[t];Zi.has(e)||(Zi.add(e),e())}Me.length=0}while(ke.length);for(;Qn.length;)Qn.pop()();gn=!1,Zi.clear(),Ge(i)}function jo(i){if(i.fragment!==null){i.update(),Fe(i.before_update);const t=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,t),i.after_update.forEach(ji)}}function zo(i){const t=[],e=[];Me.forEach(s=>i.indexOf(s)===-1?t.push(s):e.push(s)),e.forEach(s=>s()),Me=t}const Wo=new Set;function Ho(i,t){i&&i.i&&(Wo.delete(i),i.i(t))}function Vo(i,t,e){const{fragment:s,after_update:c}=i.$$;s&&s.m(t,e),ji(()=>{const g=i.$$.on_mount.map(xr).filter(Cr);i.$$.on_destroy?i.$$.on_destroy.push(...g):Fe(g),i.$$.on_mount=[]}),c.forEach(ji)}function No(i,t){const e=i.$$;e.fragment!==null&&(zo(e.after_update),Fe(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Yo(i,t){i.$$.dirty[0]===-1&&(ke.push(i),Bo(),i.$$.dirty.fill(0)),i.$$.dirty[t/31|0]|=1<<t%31}function Xo(i,t,e,s,c,g,m,o=[-1]){const n=ti;Ge(i);const l=i.$$={fragment:null,ctx:[],props:g,update:Ze,not_equal:c,bound:$n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(n?n.$$.context:[])),callbacks:$n(),dirty:o,skip_bound:!1,root:t.target||n.$$.root};m&&m(l.root);let u=!1;if(l.ctx=e?e(i,t.props||{},(r,h,...a)=>{const d=a.length?a[0]:h;return l.ctx&&c(l.ctx[r],l.ctx[r]=d)&&(!l.skip_bound&&l.bound[r]&&l.bound[r](d),u&&Yo(i,r)),h}):[],l.update(),u=!0,Fe(l.before_update),l.fragment=s?s(l.ctx):!1,t.target){if(t.hydrate){const r=Eo(t.target);l.fragment&&l.fragment.l(r),r.forEach(ci)}else l.fragment&&l.fragment.c();t.intro&&Ho(i.$$.fragment),Vo(i,t.target,t.anchor),Sr()}Ge(n)}class Uo{constructor(){Z(this,"$$");Z(this,"$$set")}$destroy(){No(this,1),this.$destroy=Ze}$on(t,e){if(!Cr(e))return Ze;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const c=s.indexOf(e);c!==-1&&s.splice(c,1)}}$set(t){this.$$set&&!Ao(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Go="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Go);let ei;const wr=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&wr.decode();let We=null;function $o(){return(We===null||We.byteLength===0)&&(We=new Uint8Array(ei.memory.buffer)),We}function qo(i,t){return i=i>>>0,wr.decode($o().subarray(i,i+t))}async function Ko(i,t){if(typeof Response=="function"&&i instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(i,t)}catch(s){if(i.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const e=await i.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(i,t);return e instanceof WebAssembly.Instance?{instance:e,module:i}:e}}function Qo(){const i={};return i.wbg={},i.wbg.__wbg_alert_e63a4c41bbd7a3e9=function(t,e){alert(qo(t,e))},i}function Jo(i,t){return ei=i.exports,Tr.__wbindgen_wasm_module=t,We=null,ei}async function Tr(i){if(ei!==void 0)return ei;typeof i>"u"&&(i=new URL("data:application/wasm;base64,AGFzbQEAAAABCQJgAn9/AGAAAAIkAQN3YmccX193YmdfYWxlcnRfZTYzYTRjNDFiYmQ3YTNlOQAAAwIBAQUDAQARBxICBm1lbW9yeQIABWdyZWV0AAEKDQELAEGAgMAAQQwQAAsLFQEAQYCAwAALDEhlbGxvLCB3YXNtIQB7CXByb2R1Y2VycwIIbGFuZ3VhZ2UBBFJ1c3QADHByb2Nlc3NlZC1ieQMFcnVzdGMdMS43MS4xIChlYjI2Mjk2YjUgMjAyMy0wOC0wMykGd2FscnVzBjAuMTkuMAx3YXNtLWJpbmRnZW4SMC4yLjg3IChmMGE4YWUzYjkpACwPdGFyZ2V0X2ZlYXR1cmVzAisPbXV0YWJsZS1nbG9iYWxzKwhzaWduLWV4dA==",self.location));const t=Qo();(typeof i=="string"||typeof Request=="function"&&i instanceof Request||typeof URL=="function"&&i instanceof URL)&&(i=fetch(i));const{instance:e,module:s}=await Ko(await i,t);return Jo(e,s)}function Zo(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(e,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}),e}var Or={};const ta={},ea=Object.freeze(Object.defineProperty({__proto__:null,default:ta},Symbol.toStringTag,{value:"Module"})),tn=Zo(ea);(function(i){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(i.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var e=tn,s=new e.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=s.document,t.jsdomImplForWrapper=tn.implForWrapper,t.nodeCanvas=tn.Canvas,t.window=s,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function o(a,d){if(this.__eventListeners[a]){var p=this.__eventListeners[a];d?p[p.indexOf(d)]=!1:t.util.array.fill(p,!1)}}function n(a,d){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var p in a)this.on(p,a[p]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(d);return this}function l(a,d){var p=(function(){d.apply(this,arguments),this.off(a,p)}).bind(this);this.on(a,p)}function u(a,d){if(arguments.length===1)for(var p in a)l.call(this,p,a[p]);else l.call(this,a,d);return this}function r(a,d){if(!this.__eventListeners)return this;if(arguments.length===0)for(a in this.__eventListeners)o.call(this,a);else if(arguments.length===1&&typeof arguments[0]=="object")for(var p in a)o.call(this,p,a[p]);else o.call(this,a,d);return this}function h(a,d){if(!this.__eventListeners)return this;var p=this.__eventListeners[a];if(!p)return this;for(var f=0,v=p.length;f<v;f++)p[f]&&p[f].call(this,d||{});return this.__eventListeners[a]=p.filter(function(_){return _!==!1}),this}t.Observable={fire:h,on:n,once:u,off:r}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var o=0,n=arguments.length;o<n;o++)this._onObjectAdded(arguments[o]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(o,n,l){var u=this._objects;return l?u[n]=o:u.splice(n,0,o),this._onObjectAdded&&this._onObjectAdded(o),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var o=this._objects,n,l=!1,u=0,r=arguments.length;u<r;u++)n=o.indexOf(arguments[u]),n!==-1&&(l=!0,o.splice(n,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(o,n){for(var l=this.getObjects(),u=0,r=l.length;u<r;u++)o.call(n,l[u],u,l);return this},getObjects:function(o){return typeof o>"u"?this._objects.concat():this._objects.filter(function(n){return n.type===o})},item:function(o){return this._objects[o]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(o,n){return this._objects.indexOf(o)>-1?!0:n?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(o,!0)}):!1},complexity:function(){return this._objects.reduce(function(o,n){return o+=n.complexity?n.complexity():0,o},0)}},t.CommonMethods={_setOptions:function(o){for(var n in o)this.set(n,o[n])},_initGradient:function(o,n){o&&o.colorStops&&!(o instanceof t.Gradient)&&this.set(n,new t.Gradient(o))},_initPattern:function(o,n,l){o&&o.source&&!(o instanceof t.Pattern)?this.set(n,new t.Pattern(o,l)):l&&l()},_setObject:function(o){for(var n in o)this._set(n,o[n])},set:function(o,n){return typeof o=="object"?this._setObject(o):this._set(o,n),this},_set:function(o,n){this[o]=n},toggle:function(o){var n=this.get(o);return typeof n=="boolean"&&this.set(o,!n),this},get:function(o){return this[o]}},function(o){var n=Math.sqrt,l=Math.atan2,u=Math.pow,r=Math.PI/180,h=Math.PI/2;t.util={cos:function(a){if(a===0)return 1;a<0&&(a=-a);var d=a/h;switch(d){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(a===0)return 0;var d=a/h,p=1;switch(a<0&&(p=-1),d){case 1:return p;case 2:return 0;case 3:return-p}return Math.sin(a)},removeFromArray:function(a,d){var p=a.indexOf(d);return p!==-1&&a.splice(p,1),a},getRandomInt:function(a,d){return Math.floor(Math.random()*(d-a+1))+a},degreesToRadians:function(a){return a*r},radiansToDegrees:function(a){return a/r},rotatePoint:function(a,d,p){var f=new t.Point(a.x-d.x,a.y-d.y),v=t.util.rotateVector(f,p);return new t.Point(v.x,v.y).addEquals(d)},rotateVector:function(a,d){var p=t.util.sin(d),f=t.util.cos(d),v=a.x*f-a.y*p,_=a.x*p+a.y*f;return{x:v,y:_}},createVector:function(a,d){return new t.Point(d.x-a.x,d.y-a.y)},calcAngleBetweenVectors:function(a,d){return Math.acos((a.x*d.x+a.y*d.y)/(Math.hypot(a.x,a.y)*Math.hypot(d.x,d.y)))},getHatVector:function(a){return new t.Point(a.x,a.y).multiply(1/Math.hypot(a.x,a.y))},getBisector:function(a,d,p){var f=t.util.createVector(a,d),v=t.util.createVector(a,p),_=t.util.calcAngleBetweenVectors(f,v),b=t.util.calcAngleBetweenVectors(t.util.rotateVector(f,_),v),y=_*(b===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(f,y)),angle:_}},projectStrokeOnPoints:function(a,d,p){var f=[],v=d.strokeWidth/2,_=d.strokeUniform?new t.Point(1/d.scaleX,1/d.scaleY):new t.Point(1,1),b=function(y){var x=v/Math.hypot(y.x,y.y);return new t.Point(y.x*x*_.x,y.y*x*_.y)};return a.length<=1||a.forEach(function(y,x){var C=new t.Point(y.x,y.y),S,O;x===0?(O=a[x+1],S=p?b(t.util.createVector(O,C)).addEquals(C):a[a.length-1]):x===a.length-1?(S=a[x-1],O=p?b(t.util.createVector(S,C)).addEquals(C):a[0]):(S=a[x-1],O=a[x+1]);var E=t.util.getBisector(C,S,O),R=E.vector,z=E.angle,V,K;if(d.strokeLineJoin==="miter"&&(V=-v/Math.sin(z/2),K=new t.Point(R.x*V*_.x,R.y*V*_.y),Math.hypot(K.x,K.y)/v<=d.strokeMiterLimit)){f.push(C.add(K)),f.push(C.subtract(K));return}V=-v*Math.SQRT2,K=new t.Point(R.x*V*_.x,R.y*V*_.y),f.push(C.add(K)),f.push(C.subtract(K))}),f},transformPoint:function(a,d,p){return p?new t.Point(d[0]*a.x+d[2]*a.y,d[1]*a.x+d[3]*a.y):new t.Point(d[0]*a.x+d[2]*a.y+d[4],d[1]*a.x+d[3]*a.y+d[5])},makeBoundingBoxFromPoints:function(a,d){if(d)for(var p=0;p<a.length;p++)a[p]=t.util.transformPoint(a[p],d);var f=[a[0].x,a[1].x,a[2].x,a[3].x],v=t.util.array.min(f),_=t.util.array.max(f),b=_-v,y=[a[0].y,a[1].y,a[2].y,a[3].y],x=t.util.array.min(y),C=t.util.array.max(y),S=C-x;return{left:v,top:x,width:b,height:S}},invertTransform:function(a){var d=1/(a[0]*a[3]-a[1]*a[2]),p=[d*a[3],-d*a[1],-d*a[2],d*a[0]],f=t.util.transformPoint({x:a[4],y:a[5]},p,!0);return p[4]=-f.x,p[5]=-f.y,p},toFixed:function(a,d){return parseFloat(Number(a).toFixed(d))},parseUnit:function(a,d){var p=/\D{0,2}$/.exec(a),f=parseFloat(a);switch(d||(d=t.Text.DEFAULT_SVG_FONT_SIZE),p[0]){case"mm":return f*t.DPI/25.4;case"cm":return f*t.DPI/2.54;case"in":return f*t.DPI;case"pt":return f*t.DPI/72;case"pc":return f*t.DPI/72*12;case"em":return f*d;default:return f}},falseFunction:function(){return!1},getKlass:function(a,d){return a=t.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),t.util.resolveNamespace(d)[a]},getSvgAttributes:function(a){var d=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":d=d.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":d=d.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":d=d.concat(["offset","stop-color","stop-opacity"]);break}return d},resolveNamespace:function(a){if(!a)return t;var d=a.split("."),p=d.length,f,v=o||t.window;for(f=0;f<p;++f)v=v[d[f]];return v},loadImage:function(a,d,p,f){if(!a){d&&d.call(p,a);return}var v=t.util.createImage(),_=function(){d&&d.call(p,v,!1),v=v.onload=v.onerror=null};v.onload=_,v.onerror=function(){t.log("Error loading "+v.src),d&&d.call(p,null,!0),v=v.onload=v.onerror=null},a.indexOf("data")!==0&&f!==void 0&&f!==null&&(v.crossOrigin=f),a.substring(0,14)==="data:image/svg"&&(v.onload=null,t.util.loadImageInDom(v,_)),v.src=a},loadImageInDom:function(a,d){var p=t.document.createElement("div");p.style.width=p.style.height="1px",p.style.left=p.style.top="-100%",p.style.position="absolute",p.appendChild(a),t.document.querySelector("body").appendChild(p),a.onload=function(){d(),p.parentNode.removeChild(p),p=null}},enlivenObjects:function(a,d,p,f){a=a||[];var v=[],_=0,b=a.length;function y(){++_===b&&d&&d(v.filter(function(x){return x}))}if(!b){d&&d(v);return}a.forEach(function(x,C){if(!x||!x.type){y();return}var S=t.util.getKlass(x.type,p);S.fromObject(x,function(O,E){E||(v[C]=O),f&&f(x,O,E),y()})})},enlivenObjectEnlivables:function(a,d,p){var f=t.Object.ENLIVEN_PROPS.filter(function(v){return!!a[v]});t.util.enlivenObjects(f.map(function(v){return a[v]}),function(v){var _={};f.forEach(function(b,y){_[b]=v[y],d&&(d[b]=v[y])}),p&&p(_)})},enlivenPatterns:function(a,d){a=a||[];function p(){++v===_&&d&&d(f)}var f=[],v=0,_=a.length;if(!_){d&&d(f);return}a.forEach(function(b,y){b&&b.source?new t.Pattern(b,function(x){f[y]=x,p()}):(f[y]=b,p())})},groupSVGElements:function(a,d,p){var f;return a&&a.length===1?(typeof p<"u"&&(a[0].sourcePath=p),a[0]):(d&&(d.width&&d.height?d.centerPoint={x:d.width/2,y:d.height/2}:(delete d.width,delete d.height)),f=new t.Group(a,d),typeof p<"u"&&(f.sourcePath=p),f)},populateWithProperties:function(a,d,p){if(p&&Array.isArray(p))for(var f=0,v=p.length;f<v;f++)p[f]in a&&(d[p[f]]=a[p[f]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(a){var d=t.util.createCanvasElement();return d.width=a.width,d.height=a.height,d.getContext("2d").drawImage(a,0,0),d},toDataURL:function(a,d,p){return a.toDataURL("image/"+d,p)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(a,d,p){return[a[0]*d[0]+a[2]*d[1],a[1]*d[0]+a[3]*d[1],a[0]*d[2]+a[2]*d[3],a[1]*d[2]+a[3]*d[3],p?0:a[0]*d[4]+a[2]*d[5]+a[4],p?0:a[1]*d[4]+a[3]*d[5]+a[5]]},qrDecompose:function(a){var d=l(a[1],a[0]),p=u(a[0],2)+u(a[1],2),f=n(p),v=(a[0]*a[3]-a[2]*a[1])/f,_=l(a[0]*a[2]+a[1]*a[3],p);return{angle:d/r,scaleX:f,scaleY:v,skewX:_/r,skewY:0,translateX:a[4],translateY:a[5]}},calcRotateMatrix:function(a){if(!a.angle)return t.iMatrix.concat();var d=t.util.degreesToRadians(a.angle),p=t.util.cos(d),f=t.util.sin(d);return[p,f,-f,p,0,0]},calcDimensionsMatrix:function(a){var d=typeof a.scaleX>"u"?1:a.scaleX,p=typeof a.scaleY>"u"?1:a.scaleY,f=[a.flipX?-d:d,0,0,a.flipY?-p:p,0,0],v=t.util.multiplyTransformMatrices,_=t.util.degreesToRadians;return a.skewX&&(f=v(f,[1,0,Math.tan(_(a.skewX)),1],!0)),a.skewY&&(f=v(f,[1,Math.tan(_(a.skewY)),0,1],!0)),f},composeMatrix:function(a){var d=[1,0,0,1,a.translateX||0,a.translateY||0],p=t.util.multiplyTransformMatrices;return a.angle&&(d=p(d,t.util.calcRotateMatrix(a))),(a.scaleX!==1||a.scaleY!==1||a.skewX||a.skewY||a.flipX||a.flipY)&&(d=p(d,t.util.calcDimensionsMatrix(a))),d},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},isTransparent:function(a,d,p,f){f>0&&(d>f?d-=f:d=0,p>f?p-=f:p=0);var v=!0,_,b,y=a.getImageData(d,p,f*2||1,f*2||1),x=y.data.length;for(_=3;_<x&&(b=y.data[_],v=b<=0,v!==!1);_+=4);return y=null,v},parsePreserveAspectRatioAttribute:function(a){var d="meet",p="Mid",f="Mid",v=a.split(" "),_;return v&&v.length&&(d=v.pop(),d!=="meet"&&d!=="slice"?(_=d,d="meet"):v.length&&(_=v.pop())),p=_!=="none"?_.slice(1,4):"none",f=_!=="none"?_.slice(5,8):"none",{meetOrSlice:d,alignX:p,alignY:f}},clearFabricFontCache:function(a){a=(a||"").toLowerCase(),a?t.charWidthsCache[a]&&delete t.charWidthsCache[a]:t.charWidthsCache={}},limitDimsByArea:function(a,d){var p=Math.sqrt(d*a),f=Math.floor(d/p);return{x:Math.floor(p),y:f}},capValue:function(a,d,p){return Math.max(a,Math.min(d,p))},findScaleToFit:function(a,d){return Math.min(d.width/a.width,d.height/a.height)},findScaleToCover:function(a,d){return Math.max(d.width/a.width,d.height/a.height)},matrixToSVG:function(a){return"matrix("+a.map(function(d){return t.util.toFixed(d,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(a,d){var p=t.util.invertTransform(d),f=t.util.multiplyTransformMatrices(p,a.calcOwnMatrix());t.util.applyTransformToObject(a,f)},addTransformToObject:function(a,d){t.util.applyTransformToObject(a,t.util.multiplyTransformMatrices(d,a.calcOwnMatrix()))},applyTransformToObject:function(a,d){var p=t.util.qrDecompose(d),f=new t.Point(p.translateX,p.translateY);a.flipX=!1,a.flipY=!1,a.set("scaleX",p.scaleX),a.set("scaleY",p.scaleY),a.skewX=p.skewX,a.skewY=p.skewY,a.angle=p.angle,a.setPositionByOrigin(f,"center","center")},sizeAfterTransform:function(a,d,p){var f=a/2,v=d/2,_=[{x:-f,y:-v},{x:f,y:-v},{x:-f,y:v},{x:f,y:v}],b=t.util.calcDimensionsMatrix(p),y=t.util.makeBoundingBoxFromPoints(_,b);return{x:y.width,y:y.height}},mergeClipPaths:function(a,d){var p=a,f=d;p.inverted&&!f.inverted&&(p=d,f=a),t.util.applyTransformToObject(f,t.util.multiplyTransformMatrices(t.util.invertTransform(p.calcTransformMatrix()),f.calcTransformMatrix()));var v=p.inverted&&f.inverted;return v&&(p.inverted=f.inverted=!1),new t.Group([p],{clipPath:f,inverted:v})},hasStyleChanged:function(a,d,p){return p=p||!1,a.fill!==d.fill||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth||a.fontSize!==d.fontSize||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.textBackgroundColor!==d.textBackgroundColor||a.deltaY!==d.deltaY||p&&(a.overline!==d.overline||a.underline!==d.underline||a.linethrough!==d.linethrough)},stylesToArray:function(p,d){for(var p=t.util.object.clone(p,!0),f=d.split(`
`),v=-1,_={},b=[],y=0;y<f.length;y++){if(!p[y]){v+=f[y].length;continue}for(var x=0;x<f[y].length;x++){v++;var C=p[y][x];if(C&&Object.keys(C).length>0){var S=t.util.hasStyleChanged(_,C,!0);S?b.push({start:v,end:v+1,style:C}):b[b.length-1].end++}_=C||{}}}return b},stylesFromArray:function(a,d){if(!Array.isArray(a))return a;for(var p=d.split(`
`),f=-1,v=0,_={},b=0;b<p.length;b++)for(var y=0;y<p[b].length;y++)f++,a[v]&&a[v].start<=f&&f<a[v].end&&(_[b]=_[b]||{},_[b][y]=Object.assign({},a[v].style),f===a[v].end-1&&v++);return _}}}(i),function(){var o=Array.prototype.join,n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function u(w,P,D,M,I,k,T,A,L,H,B){var $=t.util.cos(w),Q=t.util.sin(w),tt=t.util.cos(P),j=t.util.sin(P),F=D*I*tt-M*k*j+T,X=M*I*tt+D*k*j+A,U=H+L*(-D*I*Q-M*k*$),W=B+L*(-M*I*Q+D*k*$),q=F+L*(D*I*j+M*k*tt),it=X+L*(M*I*j-D*k*tt);return["C",U,W,q,it,F,X]}function r(w,P,D,M,I,k,T){var A=Math.PI,L=T*A/180,H=t.util.sin(L),B=t.util.cos(L),$=0,Q=0;D=Math.abs(D),M=Math.abs(M);var tt=-B*w*.5-H*P*.5,j=-B*P*.5+H*w*.5,F=D*D,X=M*M,U=j*j,W=tt*tt,q=F*X-F*U-X*W,it=0;if(q<0){var at=Math.sqrt(1-q/(F*X));D*=at,M*=at}else it=(I===k?-1:1)*Math.sqrt(q/(F*U+X*W));var st=it*D*j/M,N=-it*M*tt/D,rt=B*st-H*N+w*.5,lt=H*st+B*N+P*.5,ft=h(1,0,(tt-st)/D,(j-N)/M),yt=h((tt-st)/D,(j-N)/M,(-tt-st)/D,(-j-N)/M);k===0&&yt>0?yt-=2*A:k===1&&yt<0&&(yt+=2*A);for(var gt=Math.ceil(Math.abs(yt/A*2)),Et=[],wt=yt/gt,ue=8/3*Math.sin(wt/4)*Math.sin(wt/4)/Math.sin(wt/2),Le=ft+wt,Vt=0;Vt<gt;Vt++)Et[Vt]=u(ft,Le,B,H,D,M,rt,lt,ue,$,Q),$=Et[Vt][5],Q=Et[Vt][6],ft=Le,Le+=wt;return Et}function h(w,P,D,M){var I=Math.atan2(P,w),k=Math.atan2(M,D);return k>=I?k-I:2*Math.PI-(I-k)}function a(w,P,D,M,I,k,T,A){var L;if(t.cachesBoundsOfCurve&&(L=o.call(arguments),t.boundsOfCurveCache[L]))return t.boundsOfCurveCache[L];var H=Math.sqrt,B=Math.min,$=Math.max,Q=Math.abs,tt=[],j=[[],[]],F,X,U,W,q,it,at,st;X=6*w-12*D+6*I,F=-3*w+9*D-9*I+3*T,U=3*D-3*w;for(var N=0;N<2;++N){if(N>0&&(X=6*P-12*M+6*k,F=-3*P+9*M-9*k+3*A,U=3*M-3*P),Q(F)<1e-12){if(Q(X)<1e-12)continue;W=-U/X,0<W&&W<1&&tt.push(W);continue}at=X*X-4*U*F,!(at<0)&&(st=H(at),q=(-X+st)/(2*F),0<q&&q<1&&tt.push(q),it=(-X-st)/(2*F),0<it&&it<1&&tt.push(it))}for(var rt,lt,ft=tt.length,yt=ft,gt;ft--;)W=tt[ft],gt=1-W,rt=gt*gt*gt*w+3*gt*gt*W*D+3*gt*W*W*I+W*W*W*T,j[0][ft]=rt,lt=gt*gt*gt*P+3*gt*gt*W*M+3*gt*W*W*k+W*W*W*A,j[1][ft]=lt;j[0][yt]=w,j[1][yt]=P,j[0][yt+1]=T,j[1][yt+1]=A;var Et=[{x:B.apply(null,j[0]),y:B.apply(null,j[1])},{x:$.apply(null,j[0]),y:$.apply(null,j[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[L]=Et),Et}function d(w,P,D){for(var M=D[1],I=D[2],k=D[3],T=D[4],A=D[5],L=D[6],H=D[7],B=r(L-w,H-P,M,I,T,A,k),$=0,Q=B.length;$<Q;$++)B[$][1]+=w,B[$][2]+=P,B[$][3]+=w,B[$][4]+=P,B[$][5]+=w,B[$][6]+=P;return B}function p(w){var P=0,D=0,M=w.length,I=0,k=0,T,A,L,H=[],B,$,Q;for(A=0;A<M;++A){switch(L=!1,T=w[A].slice(0),T[0]){case"l":T[0]="L",T[1]+=P,T[2]+=D;case"L":P=T[1],D=T[2];break;case"h":T[1]+=P;case"H":T[0]="L",T[2]=D,P=T[1];break;case"v":T[1]+=D;case"V":T[0]="L",D=T[1],T[1]=P,T[2]=D;break;case"m":T[0]="M",T[1]+=P,T[2]+=D;case"M":P=T[1],D=T[2],I=T[1],k=T[2];break;case"c":T[0]="C",T[1]+=P,T[2]+=D,T[3]+=P,T[4]+=D,T[5]+=P,T[6]+=D;case"C":$=T[3],Q=T[4],P=T[5],D=T[6];break;case"s":T[0]="S",T[1]+=P,T[2]+=D,T[3]+=P,T[4]+=D;case"S":B==="C"?($=2*P-$,Q=2*D-Q):($=P,Q=D),P=T[3],D=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=$,T[2]=Q,$=T[3],Q=T[4];break;case"q":T[0]="Q",T[1]+=P,T[2]+=D,T[3]+=P,T[4]+=D;case"Q":$=T[1],Q=T[2],P=T[3],D=T[4];break;case"t":T[0]="T",T[1]+=P,T[2]+=D;case"T":B==="Q"?($=2*P-$,Q=2*D-Q):($=P,Q=D),T[0]="Q",P=T[1],D=T[2],T[1]=$,T[2]=Q,T[3]=P,T[4]=D;break;case"a":T[0]="A",T[6]+=P,T[7]+=D;case"A":L=!0,H=H.concat(d(P,D,T)),P=T[6],D=T[7];break;case"z":case"Z":P=I,D=k;break}L||H.push(T),B=T[0]}return H}function f(w,P,D,M){return Math.sqrt((D-w)*(D-w)+(M-P)*(M-P))}function v(w){return w*w*w}function _(w){return 3*w*w*(1-w)}function b(w){return 3*w*(1-w)*(1-w)}function y(w){return(1-w)*(1-w)*(1-w)}function x(w,P,D,M,I,k,T,A){return function(L){var H=v(L),B=_(L),$=b(L),Q=y(L);return{x:T*H+I*B+D*$+w*Q,y:A*H+k*B+M*$+P*Q}}}function C(w,P,D,M,I,k,T,A){return function(L){var H=1-L,B=3*H*H*(D-w)+6*H*L*(I-D)+3*L*L*(T-I),$=3*H*H*(M-P)+6*H*L*(k-M)+3*L*L*(A-k);return Math.atan2($,B)}}function S(w){return w*w}function O(w){return 2*w*(1-w)}function E(w){return(1-w)*(1-w)}function R(w,P,D,M,I,k){return function(T){var A=S(T),L=O(T),H=E(T);return{x:I*A+D*L+w*H,y:k*A+M*L+P*H}}}function z(w,P,D,M,I,k){return function(T){var A=1-T,L=2*A*(D-w)+2*T*(I-D),H=2*A*(M-P)+2*T*(k-M);return Math.atan2(H,L)}}function V(w,P,D){var M={x:P,y:D},I,k=0,T;for(T=1;T<=100;T+=1)I=w(T/100),k+=f(M.x,M.y,I.x,I.y),M=I;return k}function K(w,P){for(var D=0,M=0,I=w.iterator,k={x:w.x,y:w.y},T,A,L=.01,H=w.angleFinder,B;M<P&&L>1e-4;)T=I(D),B=D,A=f(k.x,k.y,T.x,T.y),A+M>P?(D-=L,L/=2):(k=T,D+=L,M+=A);return T.angle=H(B),T}function G(w){for(var P=0,D=w.length,M,I=0,k=0,T=0,A=0,L=[],H,B,$,Q=0;Q<D;Q++){switch(M=w[Q],B={x:I,y:k,command:M[0]},M[0]){case"M":B.length=0,T=I=M[1],A=k=M[2];break;case"L":B.length=f(I,k,M[1],M[2]),I=M[1],k=M[2];break;case"C":H=x(I,k,M[1],M[2],M[3],M[4],M[5],M[6]),$=C(I,k,M[1],M[2],M[3],M[4],M[5],M[6]),B.iterator=H,B.angleFinder=$,B.length=V(H,I,k),I=M[5],k=M[6];break;case"Q":H=R(I,k,M[1],M[2],M[3],M[4]),$=z(I,k,M[1],M[2],M[3],M[4]),B.iterator=H,B.angleFinder=$,B.length=V(H,I,k),I=M[3],k=M[4];break;case"Z":case"z":B.destX=T,B.destY=A,B.length=f(I,k,T,A),I=T,k=A;break}P+=B.length,L.push(B)}return L.push({length:P,x:I,y:k}),L}function Y(w,P,D){D||(D=G(w));for(var M=0;P-D[M].length>0&&M<D.length-2;)P-=D[M].length,M++;var I=D[M],k=P/I.length,T=I.command,A=w[M],L;switch(T){case"M":return{x:I.x,y:I.y,angle:0};case"Z":case"z":return L=new t.Point(I.x,I.y).lerp(new t.Point(I.destX,I.destY),k),L.angle=Math.atan2(I.destY-I.y,I.destX-I.x),L;case"L":return L=new t.Point(I.x,I.y).lerp(new t.Point(A[1],A[2]),k),L.angle=Math.atan2(A[2]-I.y,A[1]-I.x),L;case"C":return K(I,P);case"Q":return K(I,P)}}function J(w){var P=[],D=[],M,I,k=t.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",A="("+T+")"+t.commaWsp,L="([01])"+t.commaWsp+"?",H=A+"?"+A+"?"+A+L+L+A+"?("+T+")",B=new RegExp(H,"g"),$,Q,tt;if(!w||!w.match)return P;tt=w.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var j=0,F,X=tt.length;j<X;j++){M=tt[j],Q=M.slice(1).trim(),D.length=0;var U=M.charAt(0);if(F=[U],U.toLowerCase()==="a")for(var W;W=B.exec(Q);)for(var q=1;q<W.length;q++)D.push(W[q]);else for(;$=k.exec(Q);)D.push($[0]);for(var q=0,it=D.length;q<it;q++)I=parseFloat(D[q]),isNaN(I)||F.push(I);var at=n[U.toLowerCase()],st=l[U]||U;if(F.length-1>at)for(var N=1,rt=F.length;N<rt;N+=at)P.push([U].concat(F.slice(N,N+at))),U=st;else P.push(F)}return P}function et(w,P){var D=[],M,I=new t.Point(w[0].x,w[0].y),k=new t.Point(w[1].x,w[1].y),T=w.length,A=1,L=0,H=T>2;for(P=P||0,H&&(A=w[2].x<k.x?-1:w[2].x===k.x?0:1,L=w[2].y<k.y?-1:w[2].y===k.y?0:1),D.push(["M",I.x-A*P,I.y-L*P]),M=1;M<T;M++){if(!I.eq(k)){var B=I.midPointFrom(k);D.push(["Q",I.x,I.y,B.x,B.y])}I=w[M],M+1<w.length&&(k=w[M+1])}return H&&(A=I.x>w[M-2].x?1:I.x===w[M-2].x?0:-1,L=I.y>w[M-2].y?1:I.y===w[M-2].y?0:-1),D.push(["L",I.x+A*P,I.y+L*P]),D}function nt(w,P,D){return D&&(P=t.util.multiplyTransformMatrices(P,[1,0,0,1,-D.x,-D.y])),w.map(function(M){for(var I=M.slice(0),k={},T=1;T<M.length-1;T+=2)k.x=M[T],k.y=M[T+1],k=t.util.transformPoint(k,P),I[T]=k.x,I[T+1]=k.y;return I})}t.util.joinPath=function(w){return w.map(function(P){return P.join(" ")}).join(" ")},t.util.parsePath=J,t.util.makePathSimpler=p,t.util.getSmoothPathFromPoints=et,t.util.getPathSegmentsInfo=G,t.util.getBoundsOfCurve=a,t.util.getPointOnPath=Y,t.util.transformPath=nt}(),function(){var o=Array.prototype.slice;function n(a,d){for(var p=o.call(arguments,2),f=[],v=0,_=a.length;v<_;v++)f[v]=p.length?a[v][d].apply(a[v],p):a[v][d].call(a[v]);return f}function l(a,d){return h(a,d,function(p,f){return p>=f})}function u(a,d){return h(a,d,function(p,f){return p<f})}function r(a,d){for(var p=a.length;p--;)a[p]=d;return a}function h(a,d,p){if(!(!a||a.length===0)){var f=a.length-1,v=d?a[f][d]:a[f];if(d)for(;f--;)p(a[f][d],v)&&(v=a[f][d]);else for(;f--;)p(a[f],v)&&(v=a[f]);return v}}t.util.array={fill:r,invoke:n,min:u,max:l}}(),function(){function o(l,u,r){if(r)if(!t.isLikelyNode&&u instanceof Element)l=u;else if(u instanceof Array){l=[];for(var h=0,a=u.length;h<a;h++)l[h]=o({},u[h],r)}else if(u&&typeof u=="object")for(var d in u)d==="canvas"||d==="group"?l[d]=null:u.hasOwnProperty(d)&&(l[d]=o({},u[d],r));else l=u;else for(var d in u)l[d]=u[d];return l}function n(l,u){return o({},l,u)}t.util.object={extend:o,clone:n},t.util.object.extend(t.util,t.Observable)}(),function(){function o(h){return h.replace(/-+(.)?/g,function(a,d){return d?d.toUpperCase():""})}function n(h,a){return h.charAt(0).toUpperCase()+(a?h.slice(1):h.slice(1).toLowerCase())}function l(h){return h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(h){var a=0,d,p=[];for(a=0,d;a<h.length;a++)(d=r(h,a))!==!1&&p.push(d);return p}function r(h,a){var d=h.charCodeAt(a);if(isNaN(d))return"";if(d<55296||d>57343)return h.charAt(a);if(55296<=d&&d<=56319){if(h.length<=a+1)throw"High surrogate without following low surrogate";var p=h.charCodeAt(a+1);if(56320>p||p>57343)throw"High surrogate without following low surrogate";return h.charAt(a)+h.charAt(a+1)}if(a===0)throw"Low surrogate without preceding high surrogate";var f=h.charCodeAt(a-1);if(55296>f||f>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:o,capitalize:n,escapeXml:l,graphemeSplit:u}}(),function(){var o=Array.prototype.slice,n=function(){},l=function(){for(var d in{toString:1})if(d==="toString")return!1;return!0}(),u=function(d,p,f){for(var v in p)v in d.prototype&&typeof d.prototype[v]=="function"&&(p[v]+"").indexOf("callSuper")>-1?d.prototype[v]=function(_){return function(){var b=this.constructor.superclass;this.constructor.superclass=f;var y=p[_].apply(this,arguments);if(this.constructor.superclass=b,_!=="initialize")return y}}(v):d.prototype[v]=p[v],l&&(p.toString!==Object.prototype.toString&&(d.prototype.toString=p.toString),p.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=p.valueOf))};function r(){}function h(d){for(var p=null,f=this;f.constructor.superclass;){var v=f.constructor.superclass.prototype[d];if(f[d]!==v){p=v;break}f=f.constructor.superclass.prototype}return p?arguments.length>1?p.apply(this,o.call(arguments,1)):p.call(this):console.log("tried to callSuper "+d+", method not found in prototype chain",this)}function a(){var d=null,p=o.call(arguments,0);typeof p[0]=="function"&&(d=p.shift());function f(){this.initialize.apply(this,arguments)}f.superclass=d,f.subclasses=[],d&&(r.prototype=d.prototype,f.prototype=new r,d.subclasses.push(f));for(var v=0,_=p.length;v<_;v++)u(f,p[v],d);return f.prototype.initialize||(f.prototype.initialize=n),f.prototype.constructor=f,f.prototype.callSuper=h,f}t.util.createClass=a}(),function(){var o=!!t.document.createElement("div").attachEvent,n=["touchstart","touchmove","touchend"];t.util.addListener=function(u,r,h,a){u&&u.addEventListener(r,h,o?!1:a)},t.util.removeListener=function(u,r,h,a){u&&u.removeEventListener(r,h,o?!1:a)};function l(u){var r=u.changedTouches;return r&&r[0]?r[0]:u}t.util.getPointer=function(u){var r=u.target,h=t.util.getScrollLeftTop(r),a=l(u);return{x:a.clientX+h.left,y:a.clientY+h.top}},t.util.isTouchEvent=function(u){return n.indexOf(u.type)>-1||u.pointerType==="touch"}}(),function(){function o(a,d){var p=a.style;if(!p)return a;if(typeof d=="string")return a.style.cssText+=";"+d,d.indexOf("opacity")>-1?h(a,d.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var f in d)if(f==="opacity")h(a,d[f]);else{var v=f==="float"||f==="cssFloat"?typeof p.styleFloat>"u"?"cssFloat":"styleFloat":f;p.setProperty(v,d[f])}return a}var n=t.document.createElement("div"),l=typeof n.style.opacity=="string",u=typeof n.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,h=function(a){return a};l?h=function(a,d){return a.style.opacity=d,a}:u&&(h=function(a,d){var p=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(p.zoom=1),r.test(p.filter)?(d=d>=.9999?"":"alpha(opacity="+d*100+")",p.filter=p.filter.replace(r,d)):p.filter+=" alpha(opacity="+d*100+")",a}),t.util.setStyle=o}(),function(){var o=Array.prototype.slice;function n(y){return typeof y=="string"?t.document.getElementById(y):y}var l,u=function(y){return o.call(y,0)};try{l=u(t.document.childNodes)instanceof Array}catch{}l||(u=function(y){for(var x=new Array(y.length),C=y.length;C--;)x[C]=y[C];return x});function r(y,x){var C=t.document.createElement(y);for(var S in x)S==="class"?C.className=x[S]:S==="for"?C.htmlFor=x[S]:C.setAttribute(S,x[S]);return C}function h(y,x){y&&(" "+y.className+" ").indexOf(" "+x+" ")===-1&&(y.className+=(y.className?" ":"")+x)}function a(y,x,C){return typeof x=="string"&&(x=r(x,C)),y.parentNode&&y.parentNode.replaceChild(x,y),x.appendChild(y),x}function d(y){for(var x=0,C=0,S=t.document.documentElement,O=t.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&(y=y.parentNode||y.host,y===t.document?(x=O.scrollLeft||S.scrollLeft||0,C=O.scrollTop||S.scrollTop||0):(x+=y.scrollLeft||0,C+=y.scrollTop||0),!(y.nodeType===1&&y.style.position==="fixed")););return{left:x,top:C}}function p(y){var x,C=y&&y.ownerDocument,S={left:0,top:0},O={left:0,top:0},E,R={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return O;for(var z in R)O[R[z]]+=parseInt(f(y,z),10)||0;return x=C.documentElement,typeof y.getBoundingClientRect<"u"&&(S=y.getBoundingClientRect()),E=d(y),{left:S.left+E.left-(x.clientLeft||0)+O.left,top:S.top+E.top-(x.clientTop||0)+O.top}}var f;t.document.defaultView&&t.document.defaultView.getComputedStyle?f=function(y,x){var C=t.document.defaultView.getComputedStyle(y,null);return C?C[x]:void 0}:f=function(y,x){var C=y.style[x];return!C&&y.currentStyle&&(C=y.currentStyle[x]),C},function(){var y=t.document.documentElement.style,x="userSelect"in y?"userSelect":"MozUserSelect"in y?"MozUserSelect":"WebkitUserSelect"in y?"WebkitUserSelect":"KhtmlUserSelect"in y?"KhtmlUserSelect":"";function C(O){return typeof O.onselectstart<"u"&&(O.onselectstart=t.util.falseFunction),x?O.style[x]="none":typeof O.unselectable=="string"&&(O.unselectable="on"),O}function S(O){return typeof O.onselectstart<"u"&&(O.onselectstart=null),x?O.style[x]="":typeof O.unselectable=="string"&&(O.unselectable=""),O}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=S}();function v(y){var x=t.jsdomImplForWrapper(y);return x._canvas||x._image}function _(y){if(t.isLikelyNode){var x=t.jsdomImplForWrapper(y);x&&(x._image=null,x._canvas=null,x._currentSrc=null,x._attributes=null,x._classList=null)}}function b(y,x){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=x}t.util.setImageSmoothing=b,t.util.getById=n,t.util.toArray=u,t.util.addClass=h,t.util.makeElement=r,t.util.wrapElement=a,t.util.getScrollLeftTop=d,t.util.getElementOffset=p,t.util.getNodeCanvas=v,t.util.cleanUpJsdomNode=_}(),function(){function o(u,r){return u+(/\?/.test(u)?"&":"?")+r}function n(){}function l(u,r){r||(r={});var h=r.method?r.method.toUpperCase():"GET",a=r.onComplete||function(){},d=new t.window.XMLHttpRequest,p=r.body||r.parameters;return d.onreadystatechange=function(){d.readyState===4&&(a(d),d.onreadystatechange=n)},h==="GET"&&(p=null,typeof r.parameters=="string"&&(u=o(u,r.parameters))),d.open(h,u,!0),(h==="POST"||h==="PUT")&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(p),d}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var o=t.util.object.extend,n=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var v=this.splice(0);return v.forEach(function(_){_.cancel()}),v},cancelByCanvas:function(v){if(!v)return[];var _=this.filter(function(b){return typeof b.target=="object"&&b.target.canvas===v});return _.forEach(function(b){b.cancel()}),_},cancelByTarget:function(v){var _=this.findAnimationsByTarget(v);return _.forEach(function(b){b.cancel()}),_},findAnimationIndex:function(v){return this.indexOf(this.findAnimation(v))},findAnimation:function(v){return this.find(function(_){return _.cancel===v})},findAnimationsByTarget:function(v){return v?this.filter(function(_){return _.target===v}):[]}});function u(){return!1}function r(v,_,b,y){return-b*Math.cos(v/y*(Math.PI/2))+b+_}function h(v){v||(v={});var _=!1,b,y=function(){var x=t.runningAnimations.indexOf(b);return x>-1&&t.runningAnimations.splice(x,1)[0]};return b=o(n(v),{cancel:function(){return _=!0,y()},currentValue:"startValue"in v?v.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(b),p(function(x){var C=x||+new Date,S=v.duration||500,O=C+S,E,R=v.onChange||u,z=v.abort||u,V=v.onComplete||u,K=v.easing||r,G="startValue"in v?v.startValue.length>0:!1,Y="startValue"in v?v.startValue:0,J="endValue"in v?v.endValue:100,et=v.byValue||(G?Y.map(function(nt,w){return J[w]-Y[w]}):J-Y);v.onStart&&v.onStart(),function nt(w){E=w||+new Date;var P=E>O?S:E-C,D=P/S,M=G?Y.map(function(k,T){return K(P,Y[T],et[T],S)}):K(P,Y,et,S),I=Math.abs(G?(M[0]-Y[0])/et[0]:(M-Y)/et);if(b.currentValue=G?M.slice():M,b.completionRate=I,b.durationRate=D,!_){if(z(M,I,D)){y();return}if(E>O){b.currentValue=G?J.slice():J,b.completionRate=1,b.durationRate=1,R(G?J.slice():J,1,1),V(J,1,1),y();return}else R(M,I,D),p(nt)}}(C)}),b.cancel}var a=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(v){return t.window.setTimeout(v,1e3/60)},d=t.window.cancelAnimationFrame||t.window.clearTimeout;function p(){return a.apply(t.window,arguments)}function f(){return d.apply(t.window,arguments)}t.util.animate=h,t.util.requestAnimFrame=p,t.util.cancelAnimFrame=f,t.runningAnimations=l}(),function(){function o(l,u,r){var h="rgba("+parseInt(l[0]+r*(u[0]-l[0]),10)+","+parseInt(l[1]+r*(u[1]-l[1]),10)+","+parseInt(l[2]+r*(u[2]-l[2]),10);return h+=","+(l&&u?parseFloat(l[3]+r*(u[3]-l[3])):1),h+=")",h}function n(l,u,r,h){var a=new t.Color(l).getSource(),d=new t.Color(u).getSource(),p=h.onComplete,f=h.onChange;return h=h||{},t.util.animate(t.util.object.extend(h,{duration:r||500,startValue:a,endValue:d,byValue:d,easing:function(v,_,b,y){var x=h.colorEasing?h.colorEasing(v,y):1-Math.cos(v/y*(Math.PI/2));return o(_,b,x)},onComplete:function(v,_,b){if(p)return p(o(d,d,0),_,b)},onChange:function(v,_,b){if(f){if(Array.isArray(v))return f(o(v,v,0),_,b);f(v,_,b)}}}))}t.util.animateColor=n}(),function(){function o(w,P,D,M){return w<Math.abs(P)?(w=P,M=D/4):P===0&&w===0?M=D/(2*Math.PI)*Math.asin(1):M=D/(2*Math.PI)*Math.asin(P/w),{a:w,c:P,p:D,s:M}}function n(w,P,D){return w.a*Math.pow(2,10*(P-=1))*Math.sin((P*D-w.s)*(2*Math.PI)/w.p)}function l(w,P,D,M){return D*((w=w/M-1)*w*w+1)+P}function u(w,P,D,M){return w/=M/2,w<1?D/2*w*w*w+P:D/2*((w-=2)*w*w+2)+P}function r(w,P,D,M){return D*(w/=M)*w*w*w+P}function h(w,P,D,M){return-D*((w=w/M-1)*w*w*w-1)+P}function a(w,P,D,M){return w/=M/2,w<1?D/2*w*w*w*w+P:-D/2*((w-=2)*w*w*w-2)+P}function d(w,P,D,M){return D*(w/=M)*w*w*w*w+P}function p(w,P,D,M){return D*((w=w/M-1)*w*w*w*w+1)+P}function f(w,P,D,M){return w/=M/2,w<1?D/2*w*w*w*w*w+P:D/2*((w-=2)*w*w*w*w+2)+P}function v(w,P,D,M){return-D*Math.cos(w/M*(Math.PI/2))+D+P}function _(w,P,D,M){return D*Math.sin(w/M*(Math.PI/2))+P}function b(w,P,D,M){return-D/2*(Math.cos(Math.PI*w/M)-1)+P}function y(w,P,D,M){return w===0?P:D*Math.pow(2,10*(w/M-1))+P}function x(w,P,D,M){return w===M?P+D:D*(-Math.pow(2,-10*w/M)+1)+P}function C(w,P,D,M){return w===0?P:w===M?P+D:(w/=M/2,w<1?D/2*Math.pow(2,10*(w-1))+P:D/2*(-Math.pow(2,-10*--w)+2)+P)}function S(w,P,D,M){return-D*(Math.sqrt(1-(w/=M)*w)-1)+P}function O(w,P,D,M){return D*Math.sqrt(1-(w=w/M-1)*w)+P}function E(w,P,D,M){return w/=M/2,w<1?-D/2*(Math.sqrt(1-w*w)-1)+P:D/2*(Math.sqrt(1-(w-=2)*w)+1)+P}function R(w,P,D,M){var I=1.70158,k=0,T=D;if(w===0)return P;if(w/=M,w===1)return P+D;k||(k=M*.3);var A=o(T,D,k,I);return-n(A,w,M)+P}function z(w,P,D,M){var I=1.70158,k=0,T=D;if(w===0)return P;if(w/=M,w===1)return P+D;k||(k=M*.3);var A=o(T,D,k,I);return A.a*Math.pow(2,-10*w)*Math.sin((w*M-A.s)*(2*Math.PI)/A.p)+A.c+P}function V(w,P,D,M){var I=1.70158,k=0,T=D;if(w===0)return P;if(w/=M/2,w===2)return P+D;k||(k=M*(.3*1.5));var A=o(T,D,k,I);return w<1?-.5*n(A,w,M)+P:A.a*Math.pow(2,-10*(w-=1))*Math.sin((w*M-A.s)*(2*Math.PI)/A.p)*.5+A.c+P}function K(w,P,D,M,I){return I===void 0&&(I=1.70158),D*(w/=M)*w*((I+1)*w-I)+P}function G(w,P,D,M,I){return I===void 0&&(I=1.70158),D*((w=w/M-1)*w*((I+1)*w+I)+1)+P}function Y(w,P,D,M,I){return I===void 0&&(I=1.70158),w/=M/2,w<1?D/2*(w*w*(((I*=1.525)+1)*w-I))+P:D/2*((w-=2)*w*(((I*=1.525)+1)*w+I)+2)+P}function J(w,P,D,M){return D-et(M-w,0,D,M)+P}function et(w,P,D,M){return(w/=M)<1/2.75?D*(7.5625*w*w)+P:w<2/2.75?D*(7.5625*(w-=1.5/2.75)*w+.75)+P:w<2.5/2.75?D*(7.5625*(w-=2.25/2.75)*w+.9375)+P:D*(7.5625*(w-=2.625/2.75)*w+.984375)+P}function nt(w,P,D,M){return w<M/2?J(w*2,0,D,M)*.5+P:et(w*2-M,0,D,M)*.5+D*.5+P}t.util.ease={easeInQuad:function(w,P,D,M){return D*(w/=M)*w+P},easeOutQuad:function(w,P,D,M){return-D*(w/=M)*(w-2)+P},easeInOutQuad:function(w,P,D,M){return w/=M/2,w<1?D/2*w*w+P:-D/2*(--w*(w-2)-1)+P},easeInCubic:function(w,P,D,M){return D*(w/=M)*w*w+P},easeOutCubic:l,easeInOutCubic:u,easeInQuart:r,easeOutQuart:h,easeInOutQuart:a,easeInQuint:d,easeOutQuint:p,easeInOutQuint:f,easeInSine:v,easeOutSine:_,easeInOutSine:b,easeInExpo:y,easeOutExpo:x,easeInOutExpo:C,easeInCirc:S,easeOutCirc:O,easeInOutCirc:E,easeInElastic:R,easeOutElastic:z,easeInOutElastic:V,easeInBack:K,easeOutBack:G,easeInOutBack:Y,easeInBounce:J,easeOutBounce:et,easeInOutBounce:nt}}(),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.object.clone,r=n.util.toFixed,h=n.util.parseUnit,a=n.util.multiplyTransformMatrices,d=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],p=["symbol","image","marker","pattern","view","svg"],f=["pattern","defs","symbol","metadata","clipPath","mask","desc"],v=["symbol","g","a","svg","clipPath","defs"],_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},b={stroke:"strokeOpacity",fill:"fillOpacity"},y="font-size",x="clip-path";n.svgValidTagNamesRegEx=O(d),n.svgViewBoxElementsRegEx=O(p),n.svgInvalidAncestorsRegEx=O(f),n.svgValidParentsRegEx=O(v),n.cssRules={},n.gradientDefs={},n.clipPaths={};function C(k){return k in _?_[k]:k}function S(k,T,A,L){var H=Array.isArray(T),B;if((k==="fill"||k==="stroke")&&T==="none")T="";else{if(k==="strokeUniform")return T==="non-scaling-stroke";if(k==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(k==="transformMatrix")A&&A.transformMatrix?T=a(A.transformMatrix,n.parseTransformAttribute(T)):T=n.parseTransformAttribute(T);else if(k==="visible")T=T!=="none"&&T!=="hidden",A&&A.visible===!1&&(T=!1);else if(k==="opacity")T=parseFloat(T),A&&typeof A.opacity<"u"&&(T*=A.opacity);else if(k==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(k==="charSpacing")B=h(T,L)/L*1e3;else if(k==="paintFirst"){var $=T.indexOf("fill"),Q=T.indexOf("stroke"),T="fill";($>-1&&Q>-1&&Q<$||$===-1&&Q>-1)&&(T="stroke")}else{if(k==="href"||k==="xlink:href"||k==="font")return T;if(k==="imageSmoothing")return T==="optimizeQuality";B=H?T.map(h):h(T,L)}}return!H&&isNaN(B)?T:B}function O(k){return new RegExp("^("+k.join("|")+")\\b","i")}function E(k){for(var T in b)if(!(typeof k[b[T]]>"u"||k[T]==="")){if(typeof k[T]>"u"){if(!n.Object.prototype[T])continue;k[T]=n.Object.prototype[T]}if(k[T].indexOf("url(")!==0){var A=new n.Color(k[T]);k[T]=A.setAlpha(r(A.getAlpha()*k[b[T]],2)).toRgba()}}return k}function R(k,T){var A,L=[],H,B,$;for(B=0,$=T.length;B<$;B++)A=T[B],H=k.getElementsByTagName(A),L=L.concat(Array.prototype.slice.call(H));return L}n.parseTransformAttribute=function(){function k(N,rt){var lt=n.util.cos(rt[0]),ft=n.util.sin(rt[0]),yt=0,gt=0;rt.length===3&&(yt=rt[1],gt=rt[2]),N[0]=lt,N[1]=ft,N[2]=-ft,N[3]=lt,N[4]=yt-(lt*yt-ft*gt),N[5]=gt-(ft*yt+lt*gt)}function T(N,rt){var lt=rt[0],ft=rt.length===2?rt[1]:rt[0];N[0]=lt,N[3]=ft}function A(N,rt,lt){N[lt]=Math.tan(n.util.degreesToRadians(rt[0]))}function L(N,rt){N[4]=rt[0],rt.length===2&&(N[5]=rt[1])}var H=n.iMatrix,B=n.reNum,$=n.commaWsp,Q="(?:(skewX)\\s*\\(\\s*("+B+")\\s*\\))",tt="(?:(skewY)\\s*\\(\\s*("+B+")\\s*\\))",j="(?:(rotate)\\s*\\(\\s*("+B+")(?:"+$+"("+B+")"+$+"("+B+"))?\\s*\\))",F="(?:(scale)\\s*\\(\\s*("+B+")(?:"+$+"("+B+"))?\\s*\\))",X="(?:(translate)\\s*\\(\\s*("+B+")(?:"+$+"("+B+"))?\\s*\\))",U="(?:(matrix)\\s*\\(\\s*("+B+")"+$+"("+B+")"+$+"("+B+")"+$+"("+B+")"+$+"("+B+")"+$+"("+B+")\\s*\\))",W="(?:"+U+"|"+X+"|"+F+"|"+j+"|"+Q+"|"+tt+")",q="(?:"+W+"(?:"+$+"*"+W+")*)",it="^\\s*(?:"+q+"?)\\s*$",at=new RegExp(it),st=new RegExp(W,"g");return function(N){var rt=H.concat(),lt=[];if(!N||N&&!at.test(N))return rt;N.replace(st,function(yt){var gt=new RegExp(W).exec(yt).filter(function(ue){return!!ue}),Et=gt[1],wt=gt.slice(2).map(parseFloat);switch(Et){case"translate":L(rt,wt);break;case"rotate":wt[0]=n.util.degreesToRadians(wt[0]),k(rt,wt);break;case"scale":T(rt,wt);break;case"skewX":A(rt,wt,2);break;case"skewY":A(rt,wt,1);break;case"matrix":rt=wt;break}lt.push(rt.concat()),rt=H.concat()});for(var ft=lt[0];lt.length>1;)lt.shift(),ft=n.util.multiplyTransformMatrices(ft,lt[0]);return ft}}();function z(k,T){var A,L;k.replace(/;\s*$/,"").split(";").forEach(function(H){var B=H.split(":");A=B[0].trim().toLowerCase(),L=B[1].trim(),T[A]=L})}function V(k,T){var A,L;for(var H in k)typeof k[H]>"u"||(A=H.toLowerCase(),L=k[H],T[A]=L)}function K(k,T){var A={};for(var L in n.cssRules[T])if(G(k,L.split(" ")))for(var H in n.cssRules[T][L])A[H]=n.cssRules[T][L][H];return A}function G(k,T){var A,L=!0;return A=J(k,T.pop()),A&&T.length&&(L=Y(k,T)),A&&L&&T.length===0}function Y(k,T){for(var A,L=!0;k.parentNode&&k.parentNode.nodeType===1&&T.length;)L&&(A=T.pop()),k=k.parentNode,L=J(k,A);return T.length===0}function J(k,T){var A=k.nodeName,L=k.getAttribute("class"),H=k.getAttribute("id"),B,$;if(B=new RegExp("^"+A,"i"),T=T.replace(B,""),H&&T.length&&(B=new RegExp("#"+H+"(?![a-zA-Z\\-]+)","i"),T=T.replace(B,"")),L&&T.length)for(L=L.split(" "),$=L.length;$--;)B=new RegExp("\\."+L[$]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(B,"");return T.length===0}function et(k,T){var A;if(k.getElementById&&(A=k.getElementById(T)),A)return A;var L,H,B,$=k.getElementsByTagName("*");for(H=0,B=$.length;H<B;H++)if(L=$[H],T===L.getAttribute("id"))return L}function nt(k){for(var T=R(k,["use","svg:use"]),A=0;T.length&&A<T.length;){var L=T[A],H=L.getAttribute("xlink:href")||L.getAttribute("href");if(H===null)return;var B=H.slice(1),$=L.getAttribute("x")||0,Q=L.getAttribute("y")||0,tt=et(k,B).cloneNode(!0),j=(tt.getAttribute("transform")||"")+" translate("+$+", "+Q+")",F,X=T.length,U,W,q,it,at=n.svgNS;if(P(tt),/^svg$/i.test(tt.nodeName)){var st=tt.ownerDocument.createElementNS(at,"g");for(W=0,q=tt.attributes,it=q.length;W<it;W++)U=q.item(W),st.setAttributeNS(at,U.nodeName,U.nodeValue);for(;tt.firstChild;)st.appendChild(tt.firstChild);tt=st}for(W=0,q=L.attributes,it=q.length;W<it;W++)U=q.item(W),!(U.nodeName==="x"||U.nodeName==="y"||U.nodeName==="xlink:href"||U.nodeName==="href")&&(U.nodeName==="transform"?j=U.nodeValue+" "+j:tt.setAttribute(U.nodeName,U.nodeValue));tt.setAttribute("transform",j),tt.setAttribute("instantiated_by_use","1"),tt.removeAttribute("id"),F=L.parentNode,F.replaceChild(tt,L),T.length===X&&A++}}var w=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");function P(k){if(!n.svgViewBoxElementsRegEx.test(k.nodeName))return{};var T=k.getAttribute("viewBox"),A=1,L=1,H=0,B=0,$,Q,tt,j,F=k.getAttribute("width"),X=k.getAttribute("height"),U=k.getAttribute("x")||0,W=k.getAttribute("y")||0,q=k.getAttribute("preserveAspectRatio")||"",it=!T||!(T=T.match(w)),at=!F||!X||F==="100%"||X==="100%",st=it&&at,N={},rt="",lt=0,ft=0;if(N.width=0,N.height=0,N.toBeParsed=st,it&&(U||W)&&k.parentNode&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+h(U)+" "+h(W)+") ",tt=(k.getAttribute("transform")||"")+rt,k.setAttribute("transform",tt),k.removeAttribute("x"),k.removeAttribute("y")),st)return N;if(it)return N.width=h(F),N.height=h(X),N;if(H=-parseFloat(T[1]),B=-parseFloat(T[2]),$=parseFloat(T[3]),Q=parseFloat(T[4]),N.minX=H,N.minY=B,N.viewBoxWidth=$,N.viewBoxHeight=Q,at?(N.width=$,N.height=Q):(N.width=h(F),N.height=h(X),A=N.width/$,L=N.height/Q),q=n.util.parsePreserveAspectRatioAttribute(q),q.alignX!=="none"&&(q.meetOrSlice==="meet"&&(L=A=A>L?L:A),q.meetOrSlice==="slice"&&(L=A=A>L?A:L),lt=N.width-$*A,ft=N.height-Q*A,q.alignX==="Mid"&&(lt/=2),q.alignY==="Mid"&&(ft/=2),q.alignX==="Min"&&(lt=0),q.alignY==="Min"&&(ft=0)),A===1&&L===1&&H===0&&B===0&&U===0&&W===0)return N;if((U||W)&&k.parentNode.nodeName!=="#document"&&(rt=" translate("+h(U)+" "+h(W)+") "),tt=rt+" matrix("+A+" 0 0 "+L+" "+(H*A+lt)+" "+(B*L+ft)+") ",k.nodeName==="svg"){for(j=k.ownerDocument.createElementNS(n.svgNS,"g");k.firstChild;)j.appendChild(k.firstChild);k.appendChild(j)}else j=k,j.removeAttribute("x"),j.removeAttribute("y"),tt=j.getAttribute("transform")+tt;return j.setAttribute("transform",tt),N}function D(k,T){for(;k&&(k=k.parentNode);)if(k.nodeName&&T.test(k.nodeName.replace("svg:",""))&&!k.getAttribute("instantiated_by_use"))return!0;return!1}n.parseSVGDocument=function(k,T,A,L){if(k){nt(k);var H=n.Object.__uid++,B,$,Q=P(k),tt=n.util.toArray(k.getElementsByTagName("*"));if(Q.crossOrigin=L&&L.crossOrigin,Q.svgUid=H,tt.length===0&&n.isLikelyNode){tt=k.selectNodes('//*[name(.)!="svg"]');var j=[];for(B=0,$=tt.length;B<$;B++)j[B]=tt[B];tt=j}var F=tt.filter(function(U){return P(U),n.svgValidTagNamesRegEx.test(U.nodeName.replace("svg:",""))&&!D(U,n.svgInvalidAncestorsRegEx)});if(!F||F&&!F.length){T&&T([],{});return}var X={};tt.filter(function(U){return U.nodeName.replace("svg:","")==="clipPath"}).forEach(function(U){var W=U.getAttribute("id");X[W]=n.util.toArray(U.getElementsByTagName("*")).filter(function(q){return n.svgValidTagNamesRegEx.test(q.nodeName.replace("svg:",""))})}),n.gradientDefs[H]=n.getGradientDefs(k),n.cssRules[H]=n.getCSSRules(k),n.clipPaths[H]=X,n.parseElements(F,function(U,W){T&&(T(U,Q,W,tt),delete n.gradientDefs[H],delete n.cssRules[H],delete n.clipPaths[H])},u(Q),A,L)}};function M(k,T){var A=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],L="xlink:href",H=T.getAttribute(L).slice(1),B=et(k,H);if(B&&B.getAttribute(L)&&M(k,B),A.forEach(function(Q){B&&!T.hasAttribute(Q)&&B.hasAttribute(Q)&&T.setAttribute(Q,B.getAttribute(Q))}),!T.children.length)for(var $=B.cloneNode(!0);$.firstChild;)T.appendChild($.firstChild);T.removeAttribute(L)}var I=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");l(n,{parseFontDeclaration:function(k,T){var A=k.match(I);if(A){var L=A[1],H=A[3],B=A[4],$=A[5],Q=A[6];L&&(T.fontStyle=L),H&&(T.fontWeight=isNaN(parseFloat(H))?H:parseFloat(H)),B&&(T.fontSize=h(B)),Q&&(T.fontFamily=Q),$&&(T.lineHeight=$==="normal"?1:$)}},getGradientDefs:function(k){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],A=R(k,T),L,H=0,B={};for(H=A.length;H--;)L=A[H],L.getAttribute("xlink:href")&&M(k,L),B[L.getAttribute("id")]=L;return B},parseAttributes:function(k,T,A){if(k){var L,H={},B,$;typeof A>"u"&&(A=k.getAttribute("svgUid")),k.parentNode&&n.svgValidParentsRegEx.test(k.parentNode.nodeName)&&(H=n.parseAttributes(k.parentNode,T,A));var Q=T.reduce(function(q,it){return L=k.getAttribute(it),L&&(q[it]=L),q},{}),tt=l(K(k,A),n.parseStyleAttribute(k));Q=l(Q,tt),tt[x]&&k.setAttribute(x,tt[x]),B=$=H.fontSize||n.Text.DEFAULT_SVG_FONT_SIZE,Q[y]&&(Q[y]=B=h(Q[y],$));var j,F,X={};for(var U in Q)j=C(U),F=S(j,Q[U],H,B),X[j]=F;X&&X.font&&n.parseFontDeclaration(X.font,X);var W=l(H,X);return n.svgValidParentsRegEx.test(k.nodeName)?W:E(W)}},parseElements:function(k,T,A,L,H){new n.ElementsParser(k,T,A,L,H).parse()},parseStyleAttribute:function(k){var T={},A=k.getAttribute("style");return A&&(typeof A=="string"?z(A,T):V(A,T)),T},parsePointsAttribute:function(k){if(!k)return null;k=k.replace(/,/g," ").trim(),k=k.split(/\s+/);var T=[],A,L;for(A=0,L=k.length;A<L;A+=2)T.push({x:parseFloat(k[A]),y:parseFloat(k[A+1])});return T},getCSSRules:function(k){var T=k.getElementsByTagName("style"),A,L,H={},B;for(A=0,L=T.length;A<L;A++){var $=T[A].textContent;$=$.replace(/\/\*[\s\S]*?\*\//g,""),$.trim()!==""&&(B=$.split("}"),B=B.filter(function(Q){return Q.trim()}),B.forEach(function(Q){var tt=Q.split("{"),j={},F=tt[1].trim(),X=F.split(";").filter(function(it){return it.trim()});for(A=0,L=X.length;A<L;A++){var U=X[A].split(":"),W=U[0].trim(),q=U[1].trim();j[W]=q}Q=tt[0].trim(),Q.split(",").forEach(function(it){it=it.replace(/^svg/i,"").trim(),it!==""&&(H[it]?n.util.object.extend(H[it],j):H[it]=n.util.object.clone(j))})}))}return H},loadSVGFromURL:function(k,T,A,L){k=k.replace(/^\n\s*/,"").trim(),new n.util.request(k,{method:"get",onComplete:H});function H(B){var $=B.responseXML;if(!$||!$.documentElement)return T&&T(null),!1;n.parseSVGDocument($.documentElement,function(Q,tt,j,F){T&&T(Q,tt,j,F)},A,L)}},loadSVGFromString:function(k,T,A,L){var H=new n.window.DOMParser,B=H.parseFromString(k.trim(),"text/xml");n.parseSVGDocument(B.documentElement,function($,Q,tt,j){T($,Q,tt,j)},A,L)}})}(i),t.ElementsParser=function(o,n,l,u,r,h){this.elements=o,this.callback=n,this.options=l,this.reviver=u,this.svgUid=l&&l.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=h},function(o){o.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},o.createObjects=function(){var n=this;this.elements.forEach(function(l,u){l.setAttribute("svgUid",n.svgUid),n.createObject(l,u)})},o.findTag=function(n){return t[t.util.string.capitalize(n.tagName.replace("svg:",""))]},o.createObject=function(n,l){var u=this.findTag(n);if(u&&u.fromElement)try{u.fromElement(n,this.createCallback(l,n),this.options)}catch(r){t.log(r)}else this.checkIfDone()},o.createCallback=function(n,l){var u=this;return function(r){var h;u.resolveGradient(r,l,"fill"),u.resolveGradient(r,l,"stroke"),r instanceof t.Image&&r._originalElement&&(h=r.parsePreserveAspectRatioAttribute(l)),r._removeTransformMatrix(h),u.resolveClipPath(r,l),u.reviver&&u.reviver(l,r),u.instances[n]=r,u.checkIfDone()}},o.extractPropertyDefinition=function(n,l,u){var r=n[l],h=this.regexUrl;if(h.test(r)){h.lastIndex=0;var a=h.exec(r)[1];return h.lastIndex=0,t[u][this.svgUid][a]}},o.resolveGradient=function(n,l,u){var r=this.extractPropertyDefinition(n,u,"gradientDefs");if(r){var h=l.getAttribute(u+"-opacity"),a=t.Gradient.fromElement(r,n,h,this.options);n.set(u,a)}},o.createClipPathCallback=function(n,l){return function(u){u._removeTransformMatrix(),u.fillRule=u.clipRule,l.push(u)}},o.resolveClipPath=function(n,l){var u=this.extractPropertyDefinition(n,"clipPath","clipPaths"),r,h,a,d,p,f;if(u){d=[],a=t.util.invertTransform(n.calcTransformMatrix());for(var v=u[0].parentNode,_=l;_.parentNode&&_.getAttribute("clip-path")!==n.clipPath;)_=_.parentNode;_.parentNode.appendChild(v);for(var b=0;b<u.length;b++)r=u[b],h=this.findTag(r),h.fromElement(r,this.createClipPathCallback(n,d),this.options);d.length===1?u=d[0]:u=new t.Group(d),p=t.util.multiplyTransformMatrices(a,u.calcTransformMatrix()),u.clipPath&&this.resolveClipPath(u,_);var f=t.util.qrDecompose(p);u.flipX=!1,u.flipY=!1,u.set("scaleX",f.scaleX),u.set("scaleY",f.scaleY),u.angle=f.angle,u.skewX=f.skewX,u.skewY=0,u.setPositionByOrigin({x:f.translateX,y:f.translateY},"center","center"),n.clipPath=u}else delete n.clipPath},o.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(o){var n=o.fabric||(o.fabric={});if(n.Point){n.warn("fabric.Point is already defined");return}n.Point=l;function l(u,r){this.x=u,this.y=r}l.prototype={type:"point",constructor:l,add:function(u){return new l(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new l(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new l(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new l(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new l(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new l(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new l(this.x+(u.x-this.x)*r,this.y+(u.y-this.y)*r)},distanceFrom:function(u){var r=this.x-u.x,h=this.y-u.y;return Math.sqrt(r*r+h*h)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new l(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new l(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,r){return this.x=u,this.y=r,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var r=this.x,h=this.y;this.x=u.x,this.y=u.y,u.x=r,u.y=h},clone:function(){return new l(this.x,this.y)}}}(i),function(o){var n=o.fabric||(o.fabric={});if(n.Intersection){n.warn("fabric.Intersection is already defined");return}function l(u){this.status=u,this.points=[]}n.Intersection=l,n.Intersection.prototype={constructor:l,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},n.Intersection.intersectLineLine=function(u,r,h,a){var d,p=(a.x-h.x)*(u.y-h.y)-(a.y-h.y)*(u.x-h.x),f=(r.x-u.x)*(u.y-h.y)-(r.y-u.y)*(u.x-h.x),v=(a.y-h.y)*(r.x-u.x)-(a.x-h.x)*(r.y-u.y);if(v!==0){var _=p/v,b=f/v;0<=_&&_<=1&&0<=b&&b<=1?(d=new l("Intersection"),d.appendPoint(new n.Point(u.x+_*(r.x-u.x),u.y+_*(r.y-u.y)))):d=new l}else p===0||f===0?d=new l("Coincident"):d=new l("Parallel");return d},n.Intersection.intersectLinePolygon=function(u,r,h){var a=new l,d=h.length,p,f,v,_;for(_=0;_<d;_++)p=h[_],f=h[(_+1)%d],v=l.intersectLineLine(u,r,p,f),a.appendPoints(v.points);return a.points.length>0&&(a.status="Intersection"),a},n.Intersection.intersectPolygonPolygon=function(u,r){var h=new l,a=u.length,d;for(d=0;d<a;d++){var p=u[d],f=u[(d+1)%a],v=l.intersectLinePolygon(p,f,r);h.appendPoints(v.points)}return h.points.length>0&&(h.status="Intersection"),h},n.Intersection.intersectPolygonRectangle=function(u,r,h){var a=r.min(h),d=r.max(h),p=new n.Point(d.x,a.y),f=new n.Point(a.x,d.y),v=l.intersectLinePolygon(a,p,u),_=l.intersectLinePolygon(p,d,u),b=l.intersectLinePolygon(d,f,u),y=l.intersectLinePolygon(f,a,u),x=new l;return x.appendPoints(v.points),x.appendPoints(_.points),x.appendPoints(b.points),x.appendPoints(y.points),x.points.length>0&&(x.status="Intersection"),x}}(i),function(o){var n=o.fabric||(o.fabric={});if(n.Color){n.warn("fabric.Color is already defined.");return}function l(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}n.Color=l,n.Color.prototype={_tryParsingColor:function(r){var h;r in l.colorNameMap&&(r=l.colorNameMap[r]),r==="transparent"&&(h=[255,255,255,0]),h||(h=l.sourceFromHex(r)),h||(h=l.sourceFromRgb(r)),h||(h=l.sourceFromHsl(r)),h||(h=[0,0,0,1]),h&&this.setSource(h)},_rgbToHsl:function(r,h,a){r/=255,h/=255,a/=255;var d,p,f,v=n.util.array.max([r,h,a]),_=n.util.array.min([r,h,a]);if(f=(v+_)/2,v===_)d=p=0;else{var b=v-_;switch(p=f>.5?b/(2-v-_):b/(v+_),v){case r:d=(h-a)/b+(h<a?6:0);break;case h:d=(a-r)/b+2;break;case a:d=(r-h)/b+4;break}d/=6}return[Math.round(d*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),h=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+h[0]+","+h[1]+"%,"+h[2]+"%)"},toHsla:function(){var r=this.getSource(),h=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+h[0]+","+h[1]+"%,"+h[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),h,a,d;return h=r[0].toString(16),h=h.length===1?"0"+h:h,a=r[1].toString(16),a=a.length===1?"0"+a:a,d=r[2].toString(16),d=d.length===1?"0"+d:d,h.toUpperCase()+a.toUpperCase()+d.toUpperCase()},toHexa:function(){var r=this.getSource(),h;return h=Math.round(r[3]*255),h=h.toString(16),h=h.length===1?"0"+h:h,this.toHex()+h.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var h=this.getSource();return h[3]=r,this.setSource(h),this},toGrayscale:function(){var r=this.getSource(),h=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),a=r[3];return this.setSource([h,h,h,a]),this},toBlackWhite:function(r){var h=this.getSource(),a=(h[0]*.3+h[1]*.59+h[2]*.11).toFixed(0),d=h[3];return r=r||127,a=Number(a)<Number(r)?0:255,this.setSource([a,a,a,d]),this},overlayWith:function(r){r instanceof l||(r=new l(r));var h=[],a=this.getAlpha(),d=.5,p=this.getSource(),f=r.getSource(),v;for(v=0;v<3;v++)h.push(Math.round(p[v]*(1-d)+f[v]*d));return h[3]=a,this.setSource(h),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,n.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function u(r,h,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?r+(h-r)*6*a:a<1/2?h:a<2/3?r+(h-r)*(2/3-a)*6:r}n.Color.fromRgb=function(r){return l.fromSource(l.sourceFromRgb(r))},n.Color.sourceFromRgb=function(r){var h=r.match(l.reRGBa);if(h){var a=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),d=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),p=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(a,10),parseInt(d,10),parseInt(p,10),h[4]?parseFloat(h[4]):1]}},n.Color.fromRgba=l.fromRgb,n.Color.fromHsl=function(r){return l.fromSource(l.sourceFromHsl(r))},n.Color.sourceFromHsl=function(r){var h=r.match(l.reHSLa);if(h){var a=(parseFloat(h[1])%360+360)%360/360,d=parseFloat(h[2])/(/%$/.test(h[2])?100:1),p=parseFloat(h[3])/(/%$/.test(h[3])?100:1),f,v,_;if(d===0)f=v=_=p;else{var b=p<=.5?p*(d+1):p+d-p*d,y=p*2-b;f=u(y,b,a+1/3),v=u(y,b,a),_=u(y,b,a-1/3)}return[Math.round(f*255),Math.round(v*255),Math.round(_*255),h[4]?parseFloat(h[4]):1]}},n.Color.fromHsla=l.fromHsl,n.Color.fromHex=function(r){return l.fromSource(l.sourceFromHex(r))},n.Color.sourceFromHex=function(r){if(r.match(l.reHex)){var h=r.slice(r.indexOf("#")+1),a=h.length===3||h.length===4,d=h.length===8||h.length===4,p=a?h.charAt(0)+h.charAt(0):h.substring(0,2),f=a?h.charAt(1)+h.charAt(1):h.substring(2,4),v=a?h.charAt(2)+h.charAt(2):h.substring(4,6),_=d?a?h.charAt(3)+h.charAt(3):h.substring(6,8):"FF";return[parseInt(p,16),parseInt(f,16),parseInt(v,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},n.Color.fromSource=function(r){var h=new l;return h.setSource(r),h}}(i),function(o){var n=o.fabric||(o.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],r={},h="left",a="top",d="right",p="bottom",f="center",v={top:p,bottom:a,left:d,right:h,center:f},_=n.util.radiansToDegrees,b=Math.sign||function(j){return(j>0)-(j<0)||+j};function y(j,F){var X=j.angle+_(Math.atan2(F.y,F.x))+360;return Math.round(X%360/45)}function x(j,F){var X=F.transform.target,U=X.canvas,W=n.util.object.clone(F);W.target=X,U&&U.fire("object:"+j,W),X.fire(j,F)}function C(j,F){var X=F.canvas,U=X.uniScaleKey,W=j[U];return X.uniformScaling&&!W||!X.uniformScaling&&W}function S(j){return j.originX===f&&j.originY===f}function O(j,F,X){var U=j.lockScalingX,W=j.lockScalingY;return!!(U&&W||!F&&(U||W)&&X||U&&F==="x"||W&&F==="y")}function E(j,F,X){var U="not-allowed",W=C(j,X),q="";if(F.x!==0&&F.y===0?q="x":F.x===0&&F.y!==0&&(q="y"),O(X,q,W))return U;var it=y(X,F);return l[it]+"-resize"}function R(j,F,X){var U="not-allowed";if(F.x!==0&&X.lockSkewingY||F.y!==0&&X.lockSkewingX)return U;var W=y(X,F)%4;return u[W]+"-resize"}function z(j,F,X){return j[X.canvas.altActionKey]?r.skewCursorStyleHandler(j,F,X):r.scaleCursorStyleHandler(j,F,X)}function V(j,F,X){var U=j[X.canvas.altActionKey];if(F.x===0)return U?"skewX":"scaleY";if(F.y===0)return U?"skewY":"scaleX"}function K(j,F,X){return X.lockRotation?"not-allowed":F.cursorStyle}function G(j,F,X,U){return{e:j,transform:F,pointer:{x:X,y:U}}}function Y(j){return function(F,X,U,W){var q=X.target,it=q.getCenterPoint(),at=q.translateToOriginPoint(it,X.originX,X.originY),st=j(F,X,U,W);return q.setPositionByOrigin(at,X.originX,X.originY),st}}function J(j,F){return function(X,U,W,q){var it=F(X,U,W,q);return it&&x(j,G(X,U,W,q)),it}}function et(j,F,X,U,W){var q=j.target,it=q.controls[j.corner],at=q.canvas.getZoom(),st=q.padding/at,N=q.toLocalPoint(new n.Point(U,W),F,X);return N.x>=st&&(N.x-=st),N.x<=-st&&(N.x+=st),N.y>=st&&(N.y-=st),N.y<=st&&(N.y+=st),N.x-=it.offsetX,N.y-=it.offsetY,N}function nt(j){return j.flipX!==j.flipY}function w(j,F,X,U,W){if(j[F]!==0){var q=j._getTransformedDimensions()[U],it=W/q*j[X];j.set(X,it)}}function P(j,F,X,U){var W=F.target,q=W._getTransformedDimensions(0,W.skewY),it=et(F,F.originX,F.originY,X,U),at=Math.abs(it.x*2)-q.x,st=W.skewX,N;at<2?N=0:(N=_(Math.atan2(at/W.scaleX,q.y/W.scaleY)),F.originX===h&&F.originY===p&&(N=-N),F.originX===d&&F.originY===a&&(N=-N),nt(W)&&(N=-N));var rt=st!==N;if(rt){var lt=W._getTransformedDimensions().y;W.set("skewX",N),w(W,"skewY","scaleY","y",lt)}return rt}function D(j,F,X,U){var W=F.target,q=W._getTransformedDimensions(W.skewX,0),it=et(F,F.originX,F.originY,X,U),at=Math.abs(it.y*2)-q.y,st=W.skewY,N;at<2?N=0:(N=_(Math.atan2(at/W.scaleY,q.x/W.scaleX)),F.originX===h&&F.originY===p&&(N=-N),F.originX===d&&F.originY===a&&(N=-N),nt(W)&&(N=-N));var rt=st!==N;if(rt){var lt=W._getTransformedDimensions().x;W.set("skewY",N),w(W,"skewX","scaleX","x",lt)}return rt}function M(j,F,X,U){var W=F.target,q=W.skewX,it,at=F.originY;if(W.lockSkewingX)return!1;if(q===0){var st=et(F,f,f,X,U);st.x>0?it=h:it=d}else q>0&&(it=at===a?h:d),q<0&&(it=at===a?d:h),nt(W)&&(it=it===h?d:h);F.originX=it;var N=J("skewing",Y(P));return N(j,F,X,U)}function I(j,F,X,U){var W=F.target,q=W.skewY,it,at=F.originX;if(W.lockSkewingY)return!1;if(q===0){var st=et(F,f,f,X,U);st.y>0?it=a:it=p}else q>0&&(it=at===h?a:p),q<0&&(it=at===h?p:a),nt(W)&&(it=it===a?p:a);F.originY=it;var N=J("skewing",Y(D));return N(j,F,X,U)}function k(j,F,X,U){var W=F,q=W.target,it=q.translateToOriginPoint(q.getCenterPoint(),W.originX,W.originY);if(q.lockRotation)return!1;var at=Math.atan2(W.ey-it.y,W.ex-it.x),st=Math.atan2(U-it.y,X-it.x),N=_(st-at+W.theta),rt=!0;if(q.snapAngle>0){var lt=q.snapAngle,ft=q.snapThreshold||lt,yt=Math.ceil(N/lt)*lt,gt=Math.floor(N/lt)*lt;Math.abs(N-gt)<ft?N=gt:Math.abs(N-yt)<ft&&(N=yt)}return N<0&&(N=360+N),N%=360,rt=q.angle!==N,q.angle=N,rt}function T(j,F,X,U,W){W=W||{};var q=F.target,it=q.lockScalingX,at=q.lockScalingY,st=W.by,N,rt,lt,ft,yt=C(j,q),gt=O(q,st,yt),Et,wt,ue=F.gestureScale;if(gt)return!1;if(ue)rt=F.scaleX*ue,lt=F.scaleY*ue;else{if(N=et(F,F.originX,F.originY,X,U),Et=st!=="y"?b(N.x):1,wt=st!=="x"?b(N.y):1,F.signX||(F.signX=Et),F.signY||(F.signY=wt),q.lockScalingFlip&&(F.signX!==Et||F.signY!==wt))return!1;if(ft=q._getTransformedDimensions(),yt&&!st){var Le=Math.abs(N.x)+Math.abs(N.y),Vt=F.original,To=Math.abs(ft.x*Vt.scaleX/q.scaleX)+Math.abs(ft.y*Vt.scaleY/q.scaleY),Gn=Le/To;rt=Vt.scaleX*Gn,lt=Vt.scaleY*Gn}else rt=Math.abs(N.x*q.scaleX/ft.x),lt=Math.abs(N.y*q.scaleY/ft.y);S(F)&&(rt*=2,lt*=2),F.signX!==Et&&st!=="y"&&(F.originX=v[F.originX],rt*=-1,F.signX=Et),F.signY!==wt&&st!=="x"&&(F.originY=v[F.originY],lt*=-1,F.signY=wt)}var Oo=q.scaleX,ko=q.scaleY;return st?(st==="x"&&q.set("scaleX",rt),st==="y"&&q.set("scaleY",lt)):(!it&&q.set("scaleX",rt),!at&&q.set("scaleY",lt)),Oo!==q.scaleX||ko!==q.scaleY}function A(j,F,X,U){return T(j,F,X,U)}function L(j,F,X,U){return T(j,F,X,U,{by:"x"})}function H(j,F,X,U){return T(j,F,X,U,{by:"y"})}function B(j,F,X,U){return j[F.target.canvas.altActionKey]?r.skewHandlerX(j,F,X,U):r.scalingY(j,F,X,U)}function $(j,F,X,U){return j[F.target.canvas.altActionKey]?r.skewHandlerY(j,F,X,U):r.scalingX(j,F,X,U)}function Q(j,F,X,U){var W=F.target,q=et(F,F.originX,F.originY,X,U),it=W.strokeWidth/(W.strokeUniform?W.scaleX:1),at=S(F)?2:1,st=W.width,N=Math.abs(q.x*at/W.scaleX)-it;return W.set("width",Math.max(N,0)),st!==N}function tt(j,F,X,U){var W=F.target,q=X-F.offsetX,it=U-F.offsetY,at=!W.get("lockMovementX")&&W.left!==q,st=!W.get("lockMovementY")&&W.top!==it;return at&&W.set("left",q),st&&W.set("top",it),(at||st)&&x("moving",G(j,F,X,U)),at||st}r.scaleCursorStyleHandler=E,r.skewCursorStyleHandler=R,r.scaleSkewCursorStyleHandler=z,r.rotationWithSnapping=J("rotating",Y(k)),r.scalingEqually=J("scaling",Y(A)),r.scalingX=J("scaling",Y(L)),r.scalingY=J("scaling",Y(H)),r.scalingYOrSkewingX=B,r.scalingXOrSkewingY=$,r.changeWidth=J("resizing",Y(Q)),r.skewHandlerX=M,r.skewHandlerY=I,r.dragHandler=tt,r.scaleOrSkewActionName=V,r.rotationStyleHandler=K,r.fireEvent=x,r.wrapWithFixedAnchor=Y,r.wrapWithFireEvent=J,r.getLocalPoint=et,n.controlsUtils=r}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.degreesToRadians,u=n.controlsUtils;function r(a,d,p,f,v){f=f||{};var _=this.sizeX||f.cornerSize||v.cornerSize,b=this.sizeY||f.cornerSize||v.cornerSize,y=typeof f.transparentCorners<"u"?f.transparentCorners:v.transparentCorners,x=y?"stroke":"fill",C=!y&&(f.cornerStrokeColor||v.cornerStrokeColor),S=d,O=p,E;a.save(),a.fillStyle=f.cornerColor||v.cornerColor,a.strokeStyle=f.cornerStrokeColor||v.cornerStrokeColor,_>b?(E=_,a.scale(1,b/_),O=p*_/b):b>_?(E=b,a.scale(_/b,1),S=d*b/_):E=_,a.lineWidth=1,a.beginPath(),a.arc(S,O,E/2,0,2*Math.PI,!1),a[x](),C&&a.stroke(),a.restore()}function h(a,d,p,f,v){f=f||{};var _=this.sizeX||f.cornerSize||v.cornerSize,b=this.sizeY||f.cornerSize||v.cornerSize,y=typeof f.transparentCorners<"u"?f.transparentCorners:v.transparentCorners,x=y?"stroke":"fill",C=!y&&(f.cornerStrokeColor||v.cornerStrokeColor),S=_/2,O=b/2;a.save(),a.fillStyle=f.cornerColor||v.cornerColor,a.strokeStyle=f.cornerStrokeColor||v.cornerStrokeColor,a.lineWidth=1,a.translate(d,p),a.rotate(l(v.angle)),a[x+"Rect"](-S,-O,_,b),C&&a.strokeRect(-S,-O,_,b),a.restore()}u.renderCircleControl=r,u.renderSquareControl=h}(i),function(o){var n=o.fabric||(o.fabric={});function l(u){for(var r in u)this[r]=u[r]}n.Control=l,n.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(u,r){return r.cursorStyle},getActionName:function(u,r){return r.actionName},getVisibility:function(u,r){var h=u._controlsVisibility;return h&&typeof h[r]<"u"?h[r]:this.visible},setVisibility:function(u){this.visible=u},positionHandler:function(u,r){var h=n.util.transformPoint({x:this.x*u.x+this.offsetX,y:this.y*u.y+this.offsetY},r);return h},calcCornerCoords:function(u,r,h,a,d){var p,f,v,_,b=d?this.touchSizeX:this.sizeX,y=d?this.touchSizeY:this.sizeY;if(b&&y&&b!==y){var x=Math.atan2(y,b),C=Math.sqrt(b*b+y*y)/2,S=x-n.util.degreesToRadians(u),O=Math.PI/2-x-n.util.degreesToRadians(u);p=C*n.util.cos(S),f=C*n.util.sin(S),v=C*n.util.cos(O),_=C*n.util.sin(O)}else{var E=b&&y?b:r;C=E*.7071067812;var S=n.util.degreesToRadians(45-u);p=v=C*n.util.cos(S),f=_=C*n.util.sin(S)}return{tl:{x:h-_,y:a-v},tr:{x:h+p,y:a-f},bl:{x:h-p,y:a+f},br:{x:h+_,y:a+v}}},render:function(u,r,h,a,d){switch(a=a||{},a.cornerStyle||d.cornerStyle){case"circle":n.controlsUtils.renderCircleControl.call(this,u,r,h,a,d);break;default:n.controlsUtils.renderSquareControl.call(this,u,r,h,a,d)}}}}(i),function(){function o(h,a){var d=h.getAttribute("style"),p=h.getAttribute("offset")||0,f,v,_,b;if(p=parseFloat(p)/(/%$/.test(p)?100:1),p=p<0?0:p>1?1:p,d){var y=d.split(/\s*;\s*/);for(y[y.length-1]===""&&y.pop(),b=y.length;b--;){var x=y[b].split(/\s*:\s*/),C=x[0].trim(),S=x[1].trim();C==="stop-color"?f=S:C==="stop-opacity"&&(_=S)}}return f||(f=h.getAttribute("stop-color")||"rgb(0,0,0)"),_||(_=h.getAttribute("stop-opacity")),f=new t.Color(f),v=f.getAlpha(),_=isNaN(parseFloat(_))?1:parseFloat(_),_*=v*a,{offset:p,color:f.toRgb(),opacity:_}}function n(h){return{x1:h.getAttribute("x1")||0,y1:h.getAttribute("y1")||0,x2:h.getAttribute("x2")||"100%",y2:h.getAttribute("y2")||0}}function l(h){return{x1:h.getAttribute("fx")||h.getAttribute("cx")||"50%",y1:h.getAttribute("fy")||h.getAttribute("cy")||"50%",r1:0,x2:h.getAttribute("cx")||"50%",y2:h.getAttribute("cy")||"50%",r2:h.getAttribute("r")||"50%"}}var u=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(h){h||(h={}),h.coords||(h.coords={});var a,d=this;Object.keys(h).forEach(function(p){d[p]=h[p]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,a={x1:h.coords.x1||0,y1:h.coords.y1||0,x2:h.coords.x2||0,y2:h.coords.y2||0},this.type==="radial"&&(a.r1=h.coords.r1||0,a.r2=h.coords.r2||0),this.coords=a,this.colorStops=h.colorStops.slice()},addColorStop:function(h){for(var a in h){var d=new t.Color(h[a]);this.colorStops.push({offset:parseFloat(a),color:d.toRgb(),opacity:d.getAlpha()})}return this},toObject:function(h){var a={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,a,h),a},toSVG:function(h,v){var d=u(this.coords,!0),p,f,v=v||{},_,b,y=u(this.colorStops,!0),x=d.r1>d.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,O=-this.offsetY,E=!!v.additionalTransform,R=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(y.sort(function(Y,J){return Y.offset-J.offset}),R==="objectBoundingBox"?(S/=h.width,O/=h.height):(S+=h.width/2,O+=h.height/2),h.type==="path"&&this.gradientUnits!=="percentage"&&(S-=h.pathOffset.x,O-=h.pathOffset.y),C[4]-=S,C[5]-=O,b='id="SVGID_'+this.id+'" gradientUnits="'+R+'"',b+=' gradientTransform="'+(E?v.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?_=["<linearGradient ",b,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`">
`]:this.type==="radial"&&(_=["<radialGradient ",b,' cx="',x?d.x1:d.x2,'" cy="',x?d.y1:d.y2,'" r="',x?d.r1:d.r2,'" fx="',x?d.x2:d.x1,'" fy="',x?d.y2:d.y1,`">
`]),this.type==="radial"){if(x)for(y=y.concat(),y.reverse(),p=0,f=y.length;p<f;p++)y[p].offset=1-y[p].offset;var z=Math.min(d.r1,d.r2);if(z>0){var V=Math.max(d.r1,d.r2),K=z/V;for(p=0,f=y.length;p<f;p++)y[p].offset+=K*(1-y[p].offset)}}for(p=0,f=y.length;p<f;p++){var G=y[p];_.push("<stop ",'offset="',G.offset*100+"%",'" style="stop-color:',G.color,typeof G.opacity<"u"?";stop-opacity: "+G.opacity:";",`"/>
`)}return _.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),_.join("")},toLive:function(h){var a,d=t.util.object.clone(this.coords),p,f;if(this.type){for(this.type==="linear"?a=h.createLinearGradient(d.x1,d.y1,d.x2,d.y2):this.type==="radial"&&(a=h.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2)),p=0,f=this.colorStops.length;p<f;p++){var v=this.colorStops[p].color,_=this.colorStops[p].opacity,b=this.colorStops[p].offset;typeof _<"u"&&(v=new t.Color(v).setAlpha(_).toRgba()),a.addColorStop(b,v)}return a}}}),t.util.object.extend(t.Gradient,{fromElement:function(h,a,d,p){var f=parseFloat(d)/(/%$/.test(d)?100:1);f=f<0?0:f>1?1:f,isNaN(f)&&(f=1);var v=h.getElementsByTagName("stop"),_,b=h.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",y=h.getAttribute("gradientTransform")||"",x=[],C,S,O=0,E=0,R;for(h.nodeName==="linearGradient"||h.nodeName==="LINEARGRADIENT"?(_="linear",C=n(h)):(_="radial",C=l(h)),S=v.length;S--;)x.push(o(v[S],f));R=t.parseTransformAttribute(y),r(a,C,p,b),b==="pixels"&&(O=-a.left,E=-a.top);var z=new t.Gradient({id:h.getAttribute("id"),type:_,coords:C,colorStops:x,gradientUnits:b,gradientTransform:R,offsetX:O,offsetY:E});return z}});function r(h,a,d,p){var f,v;Object.keys(a).forEach(function(_){f=a[_],f==="Infinity"?v=1:f==="-Infinity"?v=0:(v=parseFloat(a[_],10),typeof f=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(f)&&(v*=.01,p==="pixels"&&((_==="x1"||_==="x2"||_==="r2")&&(v*=d.viewBoxWidth||d.width),(_==="y1"||_==="y2")&&(v*=d.viewBoxHeight||d.height)))),a[_]=v})}}(),function(){var o=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(n,l){if(n||(n={}),this.id=t.Object.__uid++,this.setOptions(n),!n.source||n.source&&typeof n.source!="string"){l&&l(this);return}else{var u=this;this.source=t.util.createImage(),t.util.loadImage(n.source,function(r,h){u.source=r,l&&l(u,h)},null,this.crossOrigin)}},toObject:function(n){var l=t.Object.NUM_FRACTION_DIGITS,u,r;return typeof this.source.src=="string"?u=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(u=this.source.toDataURL()),r={type:"pattern",source:u,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:o(this.offsetX,l),offsetY:o(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,r,n),r},toSVG:function(n){var l=typeof this.source=="function"?this.source():this.source,u=l.width/n.width,r=l.height/n.height,h=this.offsetX/n.width,a=this.offsetY/n.height,d="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,a&&(r+=Math.abs(a))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(u=1,h&&(u+=Math.abs(h))),l.src?d=l.src:l.toDataURL&&(d=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+h+'" y="'+a+'" width="'+u+'" height="'+r+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+d+`"></image>
</pattern>
`},setOptions:function(n){for(var l in n)this[l]=n[l]},toLive:function(n){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":n.createPattern(l,this.repeat)}})}(),function(o){var n=o.fabric||(o.fabric={}),l=n.util.toFixed;if(n.Shadow){n.warn("fabric.Shadow is already defined.");return}n.Shadow=n.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){typeof u=="string"&&(u=this._parseShadow(u));for(var r in u)this[r]=u[r];this.id=n.Object.__uid++},_parseShadow:function(u){var r=u.trim(),h=n.Shadow.reOffsetsAndBlur.exec(r)||[],a=r.replace(n.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:a.trim(),offsetX:parseFloat(h[1],10)||0,offsetY:parseFloat(h[2],10)||0,blur:parseFloat(h[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var r=40,h=40,a=n.Object.NUM_FRACTION_DIGITS,d=n.util.rotateVector({x:this.offsetX,y:this.offsetY},n.util.degreesToRadians(-u.angle)),p=20,f=new n.Color(this.color);return u.width&&u.height&&(r=l((Math.abs(d.x)+this.blur)/u.width,a)*100+p,h=l((Math.abs(d.y)+this.blur)/u.height,a)*100+p),u.flipX&&(d.x*=-1),u.flipY&&(d.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+h+'%" height="'+(100+2*h)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,a)+`"></feGaussianBlur>
	<feOffset dx="`+l(d.x,a)+'" dy="'+l(d.y,a)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+f.toRgb()+'" flood-opacity="'+f.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},r=n.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(h){this[h]!==r[h]&&(u[h]=this[h])},this),u}}),n.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(i),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var o=t.util.object.extend,n=t.util.getElementOffset,l=t.util.removeFromArray,u=t.util.toFixed,r=t.util.transformPoint,h=t.util.invertTransform,a=t.util.getNodeCanvas,d=t.util.createCanvasElement,p=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(f,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(f,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(f,v){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(f),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,_),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,_),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,_),v.overlayColor&&this.setOverlayColor(v.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var f=t.devicePixelRatio;this.__initRetinaScaling(f,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(f,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(f,v,_){v.setAttribute("width",this.width*f),v.setAttribute("height",this.height*f),_.scale(f,f)},calcOffset:function(){return this._offset=n(this.lowerCanvasEl),this},setOverlayImage:function(f,v,_){return this.__setBgOverlayImage("overlayImage",f,v,_)},setBackgroundImage:function(f,v,_){return this.__setBgOverlayImage("backgroundImage",f,v,_)},setOverlayColor:function(f,v){return this.__setBgOverlayColor("overlayColor",f,v)},setBackgroundColor:function(f,v){return this.__setBgOverlayColor("backgroundColor",f,v)},__setBgOverlayImage:function(f,v,_,b){return typeof v=="string"?t.util.loadImage(v,function(y,x){if(y){var C=new t.Image(y,b);this[f]=C,C.canvas=this}_&&_(y,x)},this,b&&b.crossOrigin):(b&&v.setOptions(b),this[f]=v,v&&(v.canvas=this),_&&_(v,!1)),this},__setBgOverlayColor:function(f,v,_){return this[f]=v,this._initGradient(v,f),this._initPattern(v,f,_),this},_createCanvasElement:function(){var f=d();if(!f||(f.style||(f.style={}),typeof f.getContext>"u"))throw p;return f},_initOptions:function(f){var v=this.lowerCanvasEl;this._setOptions(f),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(f){f&&f.getContext?this.lowerCanvasEl=f:this.lowerCanvasEl=t.util.getById(f)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f,v){return this.setDimensions({width:f},v)},setHeight:function(f,v){return this.setDimensions({height:f},v)},setDimensions:function(f,v){var _;v=v||{};for(var b in f)_=f[b],v.cssOnly||(this._setBackstoreDimension(b,f[b]),_+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(b,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(f,v){return this.lowerCanvasEl[f]=v,this.upperCanvasEl&&(this.upperCanvasEl[f]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[f]=v),this[f]=v,this},_setCssDimension:function(f,v){return this.lowerCanvasEl.style[f]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[f]=v),this.wrapperEl&&(this.wrapperEl.style[f]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(f){var v=this._activeObject,_=this.backgroundImage,b=this.overlayImage,y,x,C;for(this.viewportTransform=f,x=0,C=this._objects.length;x<C;x++)y=this._objects[x],y.group||y.setCoords(!0);return v&&v.setCoords(),_&&_.setCoords(!0),b&&b.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(f,v){var _=f,b=this.viewportTransform.slice(0);f=r(f,h(this.viewportTransform)),b[0]=v,b[3]=v;var y=r(f,b);return b[4]+=_.x-y.x,b[5]+=_.y-y.y,this.setViewportTransform(b)},setZoom:function(f){return this.zoomToPoint(new t.Point(0,0),f),this},absolutePan:function(f){var v=this.viewportTransform.slice(0);return v[4]=-f.x,v[5]=-f.y,this.setViewportTransform(v)},relativePan:function(f){return this.absolutePan(new t.Point(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(f){this.stateful&&f.setupState(),f._set("canvas",this),f.setCoords(),this.fire("object:added",{target:f}),f.fire("added")},_onObjectRemoved:function(f){this.fire("object:removed",{target:f}),f.fire("removed"),delete f.canvas},clearContext:function(f){return f.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var f=this.contextContainer;return this.renderCanvas(f,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var f={},v=this.width,_=this.height,b=h(this.viewportTransform);return f.tl=r({x:0,y:0},b),f.br=r({x:v,y:_},b),f.tr=new t.Point(f.br.x,f.tl.y),f.bl=new t.Point(f.tl.x,f.br.y),this.vptCoords=f,f},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(f,v){var _=this.viewportTransform,b=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(f),t.util.setImageSmoothing(f,this.imageSmoothingEnabled),this.fire("before:render",{ctx:f}),this._renderBackground(f),f.save(),f.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(f,v),f.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),b&&(b.canvas=this,b.shouldCache(),b._transformDone=!0,b.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(f)),this._renderOverlay(f),this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),this.fire("after:render",{ctx:f})},drawClipPathOnCanvas:function(f){var v=this.viewportTransform,_=this.clipPath;f.save(),f.transform(v[0],v[1],v[2],v[3],v[4],v[5]),f.globalCompositeOperation="destination-in",_.transform(f),f.scale(1/_.zoomX,1/_.zoomY),f.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),f.restore()},_renderObjects:function(f,v){var _,b;for(_=0,b=v.length;_<b;++_)v[_]&&v[_].render(f)},_renderBackgroundOrOverlay:function(f,v){var _=this[v+"Color"],b=this[v+"Image"],y=this.viewportTransform,x=this[v+"Vpt"];if(!(!_&&!b)){if(_){f.save(),f.beginPath(),f.moveTo(0,0),f.lineTo(this.width,0),f.lineTo(this.width,this.height),f.lineTo(0,this.height),f.closePath(),f.fillStyle=_.toLive?_.toLive(f,this):_,x&&f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),f.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var C=_.gradientTransform||_.patternTransform;C&&f.transform(C[0],C[1],C[2],C[3],C[4],C[5]),f.fill(),f.restore()}b&&(f.save(),x&&f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),b.render(f),f.restore())}},_renderBackground:function(f){this._renderBackgroundOrOverlay(f,"background")},_renderOverlay:function(f){this._renderBackgroundOrOverlay(f,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(f){return this._centerObject(f,new t.Point(this.getCenterPoint().x,f.getCenterPoint().y))},centerObjectV:function(f){return this._centerObject(f,new t.Point(f.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(f){var v=this.getCenterPoint();return this._centerObject(f,v)},viewportCenterObject:function(f){var v=this.getVpCenter();return this._centerObject(f,v)},viewportCenterObjectH:function(f){var v=this.getVpCenter();return this._centerObject(f,new t.Point(v.x,f.getCenterPoint().y)),this},viewportCenterObjectV:function(f){var v=this.getVpCenter();return this._centerObject(f,new t.Point(f.getCenterPoint().x,v.y))},getVpCenter:function(){var f=this.getCenterPoint(),v=h(this.viewportTransform);return r(f,v)},_centerObject:function(f,v){return f.setPositionByOrigin(v,"center","center"),f.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,v){var _=this.clipPath,b={version:t.version,objects:this._toObjects(f,v)};return _&&!_.excludeFromExport&&(b.clipPath=this._toObject(this.clipPath,f,v)),o(b,this.__serializeBgOverlay(f,v)),t.util.populateWithProperties(this,b,v),b},_toObjects:function(f,v){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,f,v)},this)},_toObject:function(f,v,_){var b;this.includeDefaultValues||(b=f.includeDefaultValues,f.includeDefaultValues=!1);var y=f[v](_);return this.includeDefaultValues||(f.includeDefaultValues=b),y},__serializeBgOverlay:function(f,v){var _={},b=this.backgroundImage,y=this.overlayImage,x=this.backgroundColor,C=this.overlayColor;return x&&x.toObject?x.excludeFromExport||(_.background=x.toObject(v)):x&&(_.background=x),C&&C.toObject?C.excludeFromExport||(_.overlay=C.toObject(v)):C&&(_.overlay=C),b&&!b.excludeFromExport&&(_.backgroundImage=this._toObject(b,f,v)),y&&!y.excludeFromExport&&(_.overlayImage=this._toObject(y,f,v)),_},svgViewportTransformation:!0,toSVG:function(f,v){f||(f={}),f.reviver=v;var _=[];return this._setSVGPreamble(_,f),this._setSVGHeader(_,f),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",v),this._setSVGObjects(_,v),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",v),_.push("</svg>"),_.join("")},_setSVGPreamble:function(f,v){v.suppressPreamble||f.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(f,v){var _=v.width||this.width,b=v.height||this.height,y,x='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;v.viewBox?x='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(y=this.viewportTransform,x='viewBox="'+u(-y[4]/y[0],C)+" "+u(-y[5]/y[3],C)+" "+u(this.width/y[0],C)+" "+u(this.height/y[3],C)+'" '),f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',_,'" ','height="',b,'" ',x,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(f){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(f.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var f=this,v=["background","overlay"].map(function(_){var b=f[_+"Color"];if(b&&b.toLive){var y=f[_+"Vpt"],x=f.viewportTransform,C={width:f.width/(y?x[0]:1),height:f.height/(y?x[3]:1)};return b.toSVG(C,{additionalTransform:y?t.util.matrixToSVG(x):""})}});return v.join("")},createSVGFontFacesMarkup:function(){var f="",v={},_,b,y,x,C,S,O,E,R,z=t.fontPaths,V=[];for(this._objects.forEach(function G(Y){V.push(Y),Y._objects&&Y._objects.forEach(G)}),E=0,R=V.length;E<R;E++)if(_=V[E],b=_.fontFamily,!(_.type.indexOf("text")===-1||v[b]||!z[b])&&(v[b]=!0,!!_.styles)){y=_.styles;for(C in y){x=y[C];for(O in x)S=x[O],b=S.fontFamily,!v[b]&&z[b]&&(v[b]=!0)}}for(var K in v)f+=[`		@font-face {
`,"			font-family: '",K,`';
`,"			src: url('",z[K],`');
`,`		}
`].join("");return f&&(f=['	<style type="text/css">',`<![CDATA[
`,f,"]]>",`</style>
`].join("")),f},_setSVGObjects:function(f,v){var _,b,y,x=this._objects;for(b=0,y=x.length;b<y;b++)_=x[b],!_.excludeFromExport&&this._setSVGObject(f,_,v)},_setSVGObject:function(f,v,_){f.push(v.toSVG(_))},_setSVGBgOverlayImage:function(f,v,_){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&f.push(this[v].toSVG(_))},_setSVGBgOverlayColor:function(f,v){var _=this[v+"Color"],b=this.viewportTransform,y=this.width,x=this.height;if(_)if(_.toLive){var C=_.repeat,S=t.util.invertTransform(b),O=this[v+"Vpt"],E=O?t.util.matrixToSVG(S):"";f.push('<rect transform="'+E+" translate(",y/2,",",x/2,')"',' x="',_.offsetX-y/2,'" y="',_.offsetY-x/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?_.source.width:y,'" height="',C==="repeat-x"||C==="no-repeat"?_.source.height:x,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else f.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(f){if(!f)return this;var v=this._activeObject,_,b,y;if(f===v&&f.type==="activeSelection")for(y=v._objects,_=y.length;_--;)b=y[_],l(this._objects,b),this._objects.unshift(b);else l(this._objects,f),this._objects.unshift(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(f){if(!f)return this;var v=this._activeObject,_,b,y;if(f===v&&f.type==="activeSelection")for(y=v._objects,_=0;_<y.length;_++)b=y[_],l(this._objects,b),this._objects.push(b);else l(this._objects,f),this._objects.push(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(f,v){if(!f)return this;var _=this._activeObject,b,y,x,C,S,O=0;if(f===_&&f.type==="activeSelection")for(S=_._objects,b=0;b<S.length;b++)y=S[b],x=this._objects.indexOf(y),x>0+O&&(C=x-1,l(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(f),x!==0&&(C=this._findNewLowerIndex(f,x,v),l(this._objects,f),this._objects.splice(C,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(f,v,_){var b,y;if(_)for(b=v,y=v-1;y>=0;--y){var x=f.intersectsWithObject(this._objects[y])||f.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(f);if(x){b=y;break}}else b=v-1;return b},bringForward:function(f,v){if(!f)return this;var _=this._activeObject,b,y,x,C,S,O=0;if(f===_&&f.type==="activeSelection")for(S=_._objects,b=S.length;b--;)y=S[b],x=this._objects.indexOf(y),x<this._objects.length-1-O&&(C=x+1,l(this._objects,y),this._objects.splice(C,0,y)),O++;else x=this._objects.indexOf(f),x!==this._objects.length-1&&(C=this._findNewUpperIndex(f,x,v),l(this._objects,f),this._objects.splice(C,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(f,v,_){var b,y,x;if(_)for(b=v,y=v+1,x=this._objects.length;y<x;++y){var C=f.intersectsWithObject(this._objects[y])||f.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(f);if(C){b=y;break}}else b=v+1;return b},moveTo:function(f,v){return l(this._objects,f),this._objects.splice(v,0,f),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),o(t.StaticCanvas.prototype,t.Observable),o(t.StaticCanvas.prototype,t.Collection),o(t.StaticCanvas.prototype,t.DataURLExporter),o(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(f){var v=d();if(!v||!v.getContext)return null;var _=v.getContext("2d");if(!_)return null;switch(f){case"setLineDash":return typeof _.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var f=a(this.lowerCanvasEl);return f&&f.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(f){var v=a(this.lowerCanvasEl);return v&&v.createJPEGStream(f)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(o){o.strokeStyle=this.color,o.lineWidth=this.width,o.lineCap=this.strokeLineCap,o.miterLimit=this.strokeMiterLimit,o.lineJoin=this.strokeLineJoin,o.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(o){var n=this.canvas.viewportTransform;o.save(),o.transform(n[0],n[1],n[2],n[3],n[4],n[5])},_setShadow:function(){if(this.shadow){var o=this.canvas,n=this.shadow,l=o.contextTop,u=o.getZoom();o&&o._isRetinaScaling()&&(u*=t.devicePixelRatio),l.shadowColor=n.color,l.shadowBlur=n.blur*u,l.shadowOffsetX=n.offsetX*u,l.shadowOffsetY=n.offsetY*u}},needsFullRender:function(){var o=new t.Color(this.color);return o.getAlpha()<1||!!this.shadow},_resetShadow:function(){var o=this.canvas.contextTop;o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0},_isOutSideCanvas:function(o){return o.x<0||o.x>this.canvas.getWidth()||o.y<0||o.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(o){this.canvas=o,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(o,n,l){var u=n.midPointFrom(l);return o.quadraticCurveTo(n.x,n.y,u.x,u.y),u},onMouseDown:function(o,n){this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],this._prepareForDrawing(o),this._captureDrawingPath(o),this._render())},onMouseMove:function(o,n){if(this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o))&&this._captureDrawingPath(o)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,u=l.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,l[u-2],l[u-1],!0),r.stroke(),r.restore()}},onMouseUp:function(o){return this.canvas._isMainEvent(o.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(o){var n=new t.Point(o.x,o.y);this._reset(),this._addPoint(n),this.canvas.contextTop.moveTo(n.x,n.y)},_addPoint:function(o){return this._points.length>1&&o.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(o),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(o){var n=new t.Point(o.x,o.y);return this._addPoint(n)},_render:function(o){var n,l,u=this._points[0],r=this._points[1];if(o=o||this.canvas.contextTop,this._saveAndTransform(o),o.beginPath(),this._points.length===2&&u.x===r.x&&u.y===r.y){var h=this.width/1e3;u=new t.Point(u.x,u.y),r=new t.Point(r.x,r.y),u.x-=h,r.x+=h}for(o.moveTo(u.x,u.y),n=1,l=this._points.length;n<l;n++)this._drawSegment(o,u,r),u=this._points[n],r=this._points[n+1];o.lineTo(u.x,u.y),o.stroke(),o.restore()},convertPointsToSVGPath:function(o){var n=this.width/1e3;return t.util.getSmoothPathFromPoints(o,n)},_isEmptySVGPath:function(o){var n=t.util.joinPath(o);return n==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(o){var n=new t.Path(o,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,n.shadow=new t.Shadow(this.shadow)),n},decimatePoints:function(o,n){if(o.length<=2)return o;var l=this.canvas.getZoom(),u=Math.pow(n/l,2),r,h=o.length-1,a=o[0],d=[a],p;for(r=1;r<h-1;r++)p=Math.pow(a.x-o[r].x,2)+Math.pow(a.y-o[r].y,2),p>=u&&(a=o[r],d.push(a));return d.push(o[h]),d},_finalizeAndAddPath:function(){var o=this.canvas.contextTop;o.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var n=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(n)){this.canvas.requestRenderAll();return}var l=this.createPath(n);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(o){this.canvas=o,this.points=[]},drawDot:function(o){var n=this.addPoint(o),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,n),l.restore()},dot:function(o,n){o.fillStyle=n.fill,o.beginPath(),o.arc(n.x,n.y,n.radius,0,Math.PI*2,!1),o.closePath(),o.fill()},onMouseDown:function(o){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(o)},_render:function(){var o=this.canvas.contextTop,n,l,u=this.points;for(this._saveAndTransform(o),n=0,l=u.length;n<l;n++)this.dot(o,u[n]);o.restore()},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(o),this._render()):this.drawDot(o))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove,n,l;this.canvas.renderOnAddRemove=!1;var u=[];for(n=0,l=this.points.length;n<l;n++){var r=this.points[n],h=new t.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(h.shadow=new t.Shadow(this.shadow)),u.push(h)}var a=new t.Group(u);a.canvas=this.canvas,this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},addPoint:function(o){var n=new t.Point(o.x,o.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return n.radius=l,n.fill=u,this.points.push(n),n}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(o){this.canvas=o,this.sprayChunks=[]},onMouseDown:function(o){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(o),this.render(this.sprayChunkPoints)},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.addSprayChunk(o),this.render(this.sprayChunkPoints))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var n=[],l=0,u=this.sprayChunks.length;l<u;l++)for(var r=this.sprayChunks[l],h=0,a=r.length;h<a;h++){var d=new t.Rect({width:r[h].width,height:r[h].width,left:r[h].x+1,top:r[h].y+1,originX:"center",originY:"center",fill:this.color});n.push(d)}this.optimizeOverlapping&&(n=this._getOptimizedRects(n));var p=new t.Group(n);this.shadow&&p.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:p}),this.canvas.add(p),this.canvas.fire("path:created",{path:p}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},_getOptimizedRects:function(o){var n={},l,u,r;for(u=0,r=o.length;u<r;u++)l=o[u].left+""+o[u].top,n[l]||(n[l]=o[u]);var h=[];for(l in n)h.push(n[l]);return h},render:function(o){var n=this.canvas.contextTop,l,u;for(n.fillStyle=this.color,this._saveAndTransform(n),l=0,u=o.length;l<u;l++){var r=o[l];typeof r.opacity<"u"&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var o=this.canvas.contextTop,n,l;for(o.fillStyle=this.color,this._saveAndTransform(o),n=0,l=this.sprayChunks.length;n<l;n++)this.render(this.sprayChunks[n]);o.restore()},addSprayChunk:function(o){this.sprayChunkPoints=[];var n,l,u,r=this.width/2,h;for(h=0;h<this.density;h++){n=t.util.getRandomInt(o.x-r,o.x+r),l=t.util.getRandomInt(o.y-r,o.y+r),this.dotWidthVariance?u=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):u=this.dotWidth;var a=new t.Point(n,l);a.width=u,this.randomOpacity&&(a.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var o=20,n=5,l=t.util.createCanvasElement(),u=l.getContext("2d");return l.width=l.height=o+n,u.fillStyle=this.color,u.beginPath(),u.arc(o/2,o/2,o/2,0,Math.PI*2,!1),u.closePath(),u.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(o){return o.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(o){this.callSuper("_setBrushStyles",o),o.strokeStyle=this.getPattern(o)},createPath:function(o){var n=this.callSuper("createPath",o),l=n._getLeftTopCoords().scalarAdd(n.strokeWidth/2);return n.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),n}}),function(){var o=t.util.getPointer,n=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(r,h){h||(h={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,h),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),h,a,d;if(r.length>0&&!this.preserveObjectStacking){a=[],d=[];for(var p=0,f=this._objects.length;p<f;p++)h=this._objects[p],r.indexOf(h)===-1?a.push(h):d.push(h);r.length>1&&(this._activeObject._objects=d),a.push.apply(a,d)}else a=this._objects;return a},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,h){var a=r.calcTransformMatrix(),d=t.util.invertTransform(a),p=this.restorePointerVpt(h);return t.util.transformPoint(p,d)},isTargetTransparent:function(r,h,a){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var d=this._normalizePointer(r,{x:h,y:a}),p=Math.max(r.cacheTranslationX+d.x*r.zoomX,0),f=Math.max(r.cacheTranslationY+d.y*r.zoomY,0),y=t.util.isTransparent(r._cacheContext,Math.round(p),Math.round(f),this.targetFindTolerance);return y}var v=this.contextCache,_=r.selectionBackgroundColor,b=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(b[0],b[1],b[2],b[3],b[4],b[5]),r.render(v),v.restore(),r.selectionBackgroundColor=_;var y=t.util.isTransparent(v,h,a,this.targetFindTolerance);return y},_isSelectionKeyPressed:function(r){var h=!1;return Array.isArray(this.selectionKey)?h=!!this.selectionKey.find(function(a){return r[a]===!0}):h=r[this.selectionKey],h},_shouldClearSelection:function(r,h){var a=this.getActiveObjects(),d=this._activeObject;return!h||h&&d&&a.length>1&&a.indexOf(h)===-1&&d!==h&&!this._isSelectionKeyPressed(r)||h&&!h.evented||h&&!h.selectable&&d&&d!==h},_shouldCenterTransform:function(r,h,a){if(r){var d;return h==="scale"||h==="scaleX"||h==="scaleY"||h==="resizing"?d=this.centeredScaling||r.centeredScaling:h==="rotate"&&(d=this.centeredRotation||r.centeredRotation),d?!a:a}},_getOriginFromCorner:function(r,h){var a={x:r.originX,y:r.originY};return h==="ml"||h==="tl"||h==="bl"?a.x="right":(h==="mr"||h==="tr"||h==="br")&&(a.x="left"),h==="tl"||h==="mt"||h==="tr"?a.y="bottom":(h==="bl"||h==="mb"||h==="br")&&(a.y="top"),a},_getActionFromCorner:function(r,h,a,d){if(!h||!r)return"drag";var p=d.controls[h];return p.getActionName(a,p,d)},_setupCurrentTransform:function(r,h,a){if(h){var d=this.getPointer(r),p=h.__corner,f=h.controls[p],v=a&&p?f.getActionHandler(r,h,f):t.controlsUtils.dragHandler,_=this._getActionFromCorner(a,p,r,h),b=this._getOriginFromCorner(h,p),y=r[this.centeredKey],x={target:h,action:_,actionHandler:v,corner:p,scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX,skewY:h.skewY,offsetX:d.x-h.left,offsetY:d.y-h.top,originX:b.x,originY:b.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,theta:n(h.angle),width:h.width*h.scaleX,shiftKey:r.shiftKey,altKey:y,original:t.util.saveObjectTransform(h)};this._shouldCenterTransform(h,_,y)&&(x.originX="center",x.originY="center"),x.original.originX=b.x,x.original.originY=b.y,this._currentTransform=x,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var h=this._groupSelector,a=new t.Point(h.ex,h.ey),d=t.util.transformPoint(a,this.viewportTransform),p=new t.Point(h.ex+h.left,h.ey+h.top),f=t.util.transformPoint(p,this.viewportTransform),v=Math.min(d.x,f.x),_=Math.min(d.y,f.y),b=Math.max(d.x,f.x),y=Math.max(d.y,f.y),x=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(v,_,b-v,y-_)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,v+=x,_+=x,b-=x,y-=x,t.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(v,_,b-v,y-_))},findTarget:function(r,h){if(!this.skipTargetFind){var a=!0,d=this.getPointer(r,a),p=this._activeObject,f=this.getActiveObjects(),v,_,b=l(r),y=f.length>1&&!h||f.length===1;if(this.targets=[],y&&p._findTargetCorner(d,b)||f.length>1&&!h&&p===this._searchPossibleTargets([p],d))return p;if(f.length===1&&p===this._searchPossibleTargets([p],d))if(this.preserveObjectStacking)v=p,_=this.targets,this.targets=[];else return p;var x=this._searchPossibleTargets(this._objects,d);return r[this.altSelectionKey]&&x&&v&&x!==v&&(x=v,this.targets=_),x}},_checkTarget:function(r,h,a){if(h&&h.visible&&h.evented&&h.containsPoint(r))if((this.perPixelTargetFind||h.perPixelTargetFind)&&!h.isEditing){var d=this.isTargetTransparent(h,a.x,a.y);if(!d)return!0}else return!0},_searchPossibleTargets:function(r,h){for(var a,d=r.length,p;d--;){var f=r[d],v=f.group?this._normalizePointer(f.group,h):h;if(this._checkTarget(v,f,h)){a=r[d],a.subTargetCheck&&a instanceof t.Group&&(p=this._searchPossibleTargets(a._objects,h),p&&this.targets.push(p));break}}return a},restorePointerVpt:function(r){return t.util.transformPoint(r,t.util.invertTransform(this.viewportTransform))},getPointer:function(r,h){if(this._absolutePointer&&!h)return this._absolutePointer;if(this._pointer&&h)return this._pointer;var a=o(r),d=this.upperCanvasEl,p=d.getBoundingClientRect(),f=p.width||0,v=p.height||0,_;(!f||!v)&&("top"in p&&"bottom"in p&&(v=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(f=Math.abs(p.right-p.left))),this.calcOffset(),a.x=a.x-this._offset.left,a.y=a.y-this._offset.top,h||(a=this.restorePointerVpt(a));var b=this.getRetinaScaling();return b!==1&&(a.x/=b,a.y/=b),f===0||v===0?_={width:1,height:1}:_={width:d.width/f,height:d.height/v},{x:a.x*_.width,y:a.y*_.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),h=this.lowerCanvasEl,a=this.upperCanvasEl;a?a.className="":(a=this._createCanvasElement(),this.upperCanvasEl=a),t.util.addClass(a,"upper-canvas "+r),this.wrapperEl.appendChild(a),this._copyCanvasStyle(h,a),this._applyCanvasStyle(a),this.contextTop=a.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var h=this.width||r.width,a=this.height||r.height;t.util.setStyle(r,{position:"absolute",width:h+"px",height:a+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=h,r.height=a,t.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,h){h.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,h){var a=!1,d=this.getActiveObjects(),p=[],f=[];r.forEach(function(v){d.indexOf(v)===-1&&(a=!0,v.fire("deselected",{e:h,target:v}),f.push(v))}),d.forEach(function(v){r.indexOf(v)===-1&&(a=!0,v.fire("selected",{e:h,target:v}),p.push(v))}),r.length>0&&d.length>0?a&&this.fire("selection:updated",{e:h,selected:p,deselected:f}):d.length>0?this.fire("selection:created",{e:h,selected:p}):r.length>0&&this.fire("selection:cleared",{e:h,deselected:f})},setActiveObject:function(r,h){var a=this.getActiveObjects();return this._setActiveObject(r,h),this._fireSelectionEvents(a,h),this},_setActiveObject:function(r,h){return this._activeObject===r||!this._discardActiveObject(h,r)||r.onSelect({e:h})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,h){var a=this._activeObject;if(a){if(a.onDeselect({e:r,object:h}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var h=this.getActiveObjects(),a=this.getActiveObject();return h.length&&this.fire("before:selection:cleared",{target:a,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(h,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(h){t.util.cleanUpJsdomNode(this[h]),this[h]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var h=this._activeObject;h&&h._renderControls(r)},_toObject:function(r,h,a){var d=this._realizeGroupTransformOnObject(r),p=this.callSuper("_toObject",r,h,a);return this._unwindGroupTransformOnObject(r,d),p},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var h=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],a={};return h.forEach(function(d){a[d]=r[d]}),t.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),a}else return null},_unwindGroupTransformOnObject:function(r,h){h&&r.set(h)},_setSVGObject:function(r,h,a){var d=this._realizeGroupTransformOnObject(h);this.callSuper("_setSVGObject",r,h,a),this._unwindGroupTransformOnObject(h,d)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var u in t.StaticCanvas)u!=="prototype"&&(t.Canvas[u]=t.StaticCanvas[u])}(),function(){var o=t.util.addListener,n=t.util.removeListener,l=3,u=2,r=1,h={passive:!1};function a(d,p){return d.button&&d.button===p-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(o,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(d,p){var f=this.upperCanvasEl,v=this._getEventPrefix();d(t.window,"resize",this._onResize),d(f,v+"down",this._onMouseDown),d(f,v+"move",this._onMouseMove,h),d(f,v+"out",this._onMouseOut),d(f,v+"enter",this._onMouseEnter),d(f,"wheel",this._onMouseWheel),d(f,"contextmenu",this._onContextMenu),d(f,"dblclick",this._onDoubleClick),d(f,"dragover",this._onDragOver),d(f,"dragenter",this._onDragEnter),d(f,"dragleave",this._onDragLeave),d(f,"drop",this._onDrop),this.enablePointerEvents||d(f,"touchstart",this._onTouchStart,h),typeof eventjs<"u"&&p in eventjs&&(eventjs[p](f,"gesture",this._onGesture),eventjs[p](f,"drag",this._onDrag),eventjs[p](f,"orientation",this._onOrientationChange),eventjs[p](f,"shake",this._onShake),eventjs[p](f,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(n,"remove");var d=this._getEventPrefix();n(t.document,d+"up",this._onMouseUp),n(t.document,"touchend",this._onTouchEnd,h),n(t.document,d+"move",this._onMouseMove,h),n(t.document,"touchmove",this._onMouseMove,h)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(d,p){this.__onTransformGesture&&this.__onTransformGesture(d,p)},_onDrag:function(d,p){this.__onDrag&&this.__onDrag(d,p)},_onMouseWheel:function(d){this.__onMouseWheel(d)},_onMouseOut:function(d){var p=this._hoveredTarget;this.fire("mouse:out",{target:p,e:d}),this._hoveredTarget=null,p&&p.fire("mouseout",{e:d});var f=this;this._hoveredTargets.forEach(function(v){f.fire("mouse:out",{target:p,e:d}),v&&p.fire("mouseout",{e:d})}),this._hoveredTargets=[]},_onMouseEnter:function(d){!this._currentTransform&&!this.findTarget(d)&&(this.fire("mouse:over",{target:null,e:d}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(d,p){this.__onOrientationChange&&this.__onOrientationChange(d,p)},_onShake:function(d,p){this.__onShake&&this.__onShake(d,p)},_onLongPress:function(d,p){this.__onLongPress&&this.__onLongPress(d,p)},_onDragOver:function(d){d.preventDefault();var p=this._simpleEventHandler("dragover",d);this._fireEnterLeaveEvents(p,d)},_onDrop:function(d){return this._simpleEventHandler("drop:before",d),this._simpleEventHandler("drop",d)},_onContextMenu:function(d){return this.stopContextMenu&&(d.stopPropagation(),d.preventDefault()),!1},_onDoubleClick:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"dblclick"),this._resetTransformEventData(d)},getPointerId:function(d){var p=d.changedTouches;return p?p[0]&&p[0].identifier:this.enablePointerEvents?d.pointerId:-1},_isMainEvent:function(d){return d.isPrimary===!0?!0:d.isPrimary===!1?!1:d.type==="touchend"&&d.touches.length===0?!0:d.changedTouches?d.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(d){d.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(d)),this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,f=this._getEventPrefix();o(t.document,"touchend",this._onTouchEnd,h),o(t.document,"touchmove",this._onMouseMove,h),n(p,f+"down",this._onMouseDown)},_onMouseDown:function(d){this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,f=this._getEventPrefix();n(p,f+"move",this._onMouseMove,h),o(t.document,f+"up",this._onMouseUp),o(t.document,f+"move",this._onMouseMove,h)},_onTouchEnd:function(d){if(!(d.touches.length>0)){this.__onMouseUp(d),this._resetTransformEventData(),this.mainTouchId=null;var p=this._getEventPrefix();n(t.document,"touchend",this._onTouchEnd,h),n(t.document,"touchmove",this._onMouseMove,h);var f=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){o(f.upperCanvasEl,p+"down",f._onMouseDown),f._willAddMouseDown=0},400)}},_onMouseUp:function(d){this.__onMouseUp(d),this._resetTransformEventData();var p=this.upperCanvasEl,f=this._getEventPrefix();this._isMainEvent(d)&&(n(t.document,f+"up",this._onMouseUp),n(t.document,f+"move",this._onMouseMove,h),o(p,f+"move",this._onMouseMove,h))},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(d){var p=this._activeObject;return!!p!=!!d||p&&d&&p!==d?!0:(p&&p.isEditing,!1)},__onMouseUp:function(d){var p,f=this._currentTransform,v=this._groupSelector,_=!1,b=!v||v.left===0&&v.top===0;if(this._cacheTransformEventData(d),p=this._target,this._handleEvent(d,"up:before"),a(d,l)){this.fireRightClick&&this._handleEvent(d,"up",l,b);return}if(a(d,u)){this.fireMiddleClick&&this._handleEvent(d,"up",u,b),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(d);return}if(this._isMainEvent(d)){if(f&&(this._finalizeCurrentTransform(d),_=f.actionPerformed),!b){var y=p===this._activeObject;this._maybeGroupObjects(d),_||(_=this._shouldRender(p)||!y&&p===this._activeObject)}var x,C;if(p){if(x=p._findTargetCorner(this.getPointer(d,!0),t.util.isTouchEvent(d)),p.selectable&&p!==this._activeObject&&p.activeOn==="up")this.setActiveObject(p,d),_=!0;else{var S=p.controls[x],O=S&&S.getMouseUpHandler(d,p,S);O&&(C=this.getPointer(d),O(d,f,C.x,C.y))}p.isMoving=!1}if(f&&(f.target!==p||f.corner!==x)){var E=f.target&&f.target.controls[f.corner],R=E&&E.getMouseUpHandler(d,p,S);C=C||this.getPointer(d),R&&R(d,f,C.x,C.y)}this._setCursorFromEvent(d,p),this._handleEvent(d,"up",r,b),this._groupSelector=null,this._currentTransform=null,p&&(p.__corner=0),_?this.requestRenderAll():b||this.renderTop()}},_simpleEventHandler:function(d,p){var f=this.findTarget(p),v=this.targets,_={e:p,target:f,subTargets:v};if(this.fire(d,_),f&&f.fire(d,_),!v)return f;for(var b=0;b<v.length;b++)v[b].fire(d,_);return f},_handleEvent:function(d,p,f,v){var _=this._target,b=this.targets||[],y={e:d,target:_,subTargets:b,button:f||r,isClick:v||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};p==="up"&&(y.currentTarget=this.findTarget(d),y.currentSubTargets=this.targets),this.fire("mouse:"+p,y),_&&_.fire("mouse"+p,y);for(var x=0;x<b.length;x++)b[x].fire("mouse"+p,y)},_finalizeCurrentTransform:function(d){var p=this._currentTransform,f=p.target,v={e:d,target:f,transform:p,action:p.action};f._scaling&&(f._scaling=!1),f.setCoords(),(p.actionPerformed||this.stateful&&f.hasStateChanged())&&this._fire("modified",v)},_onMouseDownInDrawingMode:function(d){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(d).requestRenderAll();var p=this.getPointer(d);this.freeDrawingBrush.onMouseDown(p,{e:d,pointer:p}),this._handleEvent(d,"down")},_onMouseMoveInDrawingMode:function(d){if(this._isCurrentlyDrawing){var p=this.getPointer(d);this.freeDrawingBrush.onMouseMove(p,{e:d,pointer:p})}this.setCursor(this.freeDrawingCursor),this._handleEvent(d,"move")},_onMouseUpInDrawingMode:function(d){var p=this.getPointer(d);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:d,pointer:p}),this._handleEvent(d,"up")},__onMouseDown:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"down:before");var p=this._target;if(a(d,l)){this.fireRightClick&&this._handleEvent(d,"down",l);return}if(a(d,u)){this.fireMiddleClick&&this._handleEvent(d,"down",u);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(d);return}if(this._isMainEvent(d)&&!this._currentTransform){var f=this._pointer;this._previousPointer=f;var v=this._shouldRender(p),_=this._shouldGroup(d,p);if(this._shouldClearSelection(d,p)?this.discardActiveObject(d):_&&(this._handleGrouping(d,p),p=this._activeObject),this.selection&&(!p||!p.selectable&&!p.isEditing&&p!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),p){var b=p===this._activeObject;p.selectable&&p.activeOn==="down"&&this.setActiveObject(p,d);var y=p._findTargetCorner(this.getPointer(d,!0),t.util.isTouchEvent(d));if(p.__corner=y,p===this._activeObject&&(y||!_)){this._setupCurrentTransform(d,p,b);var x=p.controls[y],f=this.getPointer(d),C=x&&x.getMouseDownHandler(d,p,x);C&&C(d,this._currentTransform,f.x,f.y)}}this._handleEvent(d,"down"),(v||_)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(d){this._resetTransformEventData(),this._pointer=this.getPointer(d,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(d)||null},_beforeTransform:function(d){var p=this._currentTransform;this.stateful&&p.target.saveState(),this.fire("before:transform",{e:d,transform:p})},__onMouseMove:function(d){this._handleEvent(d,"move:before"),this._cacheTransformEventData(d);var p,f;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(d);return}if(this._isMainEvent(d)){var v=this._groupSelector;v?(f=this._absolutePointer,v.left=f.x-v.ex,v.top=f.y-v.ey,this.renderTop()):this._currentTransform?this._transformObject(d):(p=this.findTarget(d)||null,this._setCursorFromEvent(d,p),this._fireOverOutEvents(p,d)),this._handleEvent(d,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(d,p){var f=this._hoveredTarget,v=this._hoveredTargets,_=this.targets,b=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:f,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:v[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=d,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(d,p){var f=this._draggedoverTarget,v=this._hoveredTargets,_=this.targets,b=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:f,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<b;y++)this.fireSyntheticInOutEvents(_[y],p,{oldTarget:v[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=d},fireSyntheticInOutEvents:function(d,p,f){var v,_,b=f.oldTarget,y,x,C=b!==d,S=f.canvasEvtIn,O=f.canvasEvtOut;C&&(v={e:p,target:d,previousTarget:b},_={e:p,target:b,nextTarget:d}),x=d&&C,y=b&&C,y&&(O&&this.fire(O,_),b.fire(f.evtOut,_)),x&&(S&&this.fire(S,v),d.fire(f.evtIn,v))},__onMouseWheel:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"wheel"),this._resetTransformEventData()},_transformObject:function(d){var p=this.getPointer(d),f=this._currentTransform;f.reset=!1,f.shiftKey=d.shiftKey,f.altKey=d[this.centeredKey],this._performTransformAction(d,f,p),f.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(d,p,f){var v=f.x,_=f.y,b=p.action,y=!1,x=p.actionHandler;x&&(y=x(d,p,v,_)),b==="drag"&&y&&(p.target.isMoving=!0,this.setCursor(p.target.moveCursor||this.moveCursor)),p.actionPerformed=p.actionPerformed||y},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(d,p){if(!p)return this.setCursor(this.defaultCursor),!1;var f=p.hoverCursor||this.hoverCursor,v=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,_=(!v||!v.contains(p))&&p._findTargetCorner(this.getPointer(d,!0));_?this.setCursor(this.getCornerCursor(_,p,d)):(p.subTargetCheck&&this.targets.concat().reverse().map(function(b){f=b.hoverCursor||f}),this.setCursor(f))},getCornerCursor:function(d,p,f){var v=p.controls[d];return v.cursorStyleHandler(f,v,p)}})}(),function(){var o=Math.min,n=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,u){var r=this._activeObject;return r&&this._isSelectionKeyPressed(l)&&u&&u.selectable&&this.selection&&(r!==u||r.type==="activeSelection")&&!u.onSelect({e:l})},_handleGrouping:function(l,u){var r=this._activeObject;r.__corner||u===r&&(u=this.findTarget(l,!0),!u||!u.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(u,l):this._createActiveSelection(u,l))},_updateActiveSelection:function(l,u){var r=this._activeObject,h=r._objects.slice(0);r.contains(l)?(r.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),u)):(r.addWithUpdate(l),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(h,u)},_createActiveSelection:function(l,u){var r=this.getActiveObjects(),h=this._createGroup(l);this._hoveredTarget=h,this._setActiveObject(h,u),this._fireSelectionEvents(r,u)},_createGroup:function(l){var u=this._objects,r=u.indexOf(this._activeObject)<u.indexOf(l),h=r?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(h,{canvas:this})},_groupSelectedObjects:function(l){var u=this._collectObjects(l),r;u.length===1?this.setActiveObject(u[0],l):u.length>1&&(r=new t.ActiveSelection(u.reverse(),{canvas:this}),this.setActiveObject(r,l))},_collectObjects:function(l){for(var u=[],r,h=this._groupSelector.ex,a=this._groupSelector.ey,d=h+this._groupSelector.left,p=a+this._groupSelector.top,f=new t.Point(o(h,d),o(a,p)),v=new t.Point(n(h,d),n(a,p)),_=!this.selectionFullyContained,b=h===d&&a===p,y=this._objects.length;y--&&(r=this._objects[y],!(!(!r||!r.selectable||!r.visible)&&(_&&r.intersectsWithRect(f,v,!0)||r.isContainedWithinRect(f,v,!0)||_&&r.containsPoint(f,null,!0)||_&&r.containsPoint(v,null,!0))&&(u.push(r),b))););return u.length>1&&(u=u.filter(function(x){return!x.onSelect({e:l})})),u},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(o){o||(o={});var n=o.format||"png",l=o.quality||1,u=(o.multiplier||1)*(o.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(u,o);return t.util.toDataURL(r,n,l)},toCanvasElement:function(o,n){o=o||1,n=n||{};var l=(n.width||this.width)*o,u=(n.height||this.height)*o,r=this.getZoom(),h=this.width,a=this.height,d=r*o,p=this.viewportTransform,f=(p[4]-(n.left||0))*o,v=(p[5]-(n.top||0))*o,_=this.interactive,b=[d,0,0,d,f,v],y=this.enableRetinaScaling,x=t.util.createCanvasElement(),C=this.contextTop;return x.width=l,x.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=b,this.width=l,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(x.getContext("2d"),this._objects),this.viewportTransform=p,this.width=h,this.height=a,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=y,this.contextTop=C,x}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(o,n,l){if(o){var u=typeof o=="string"?JSON.parse(o):t.util.object.clone(o),r=this,h=u.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(d){r.clear(),r._setBgOverlay(u,function(){h?r._enlivenObjects([h],function(p){r.clipPath=p[0],r.__setupCanvas.call(r,u,d,a,n)}):r.__setupCanvas.call(r,u,d,a,n)})},l),this}},__setupCanvas:function(o,n,l,u){var r=this;n.forEach(function(h,a){r.insertAt(h,a)}),this.renderOnAddRemove=l,delete o.objects,delete o.backgroundImage,delete o.overlayImage,delete o.background,delete o.overlay,this._setOptions(o),this.renderAll(),u&&u()},_setBgOverlay:function(o,n){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!o.backgroundImage&&!o.overlayImage&&!o.background&&!o.overlay){n&&n();return}var u=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&n&&n()};this.__setBgOverlay("backgroundImage",o.backgroundImage,l,u),this.__setBgOverlay("overlayImage",o.overlayImage,l,u),this.__setBgOverlay("backgroundColor",o.background,l,u),this.__setBgOverlay("overlayColor",o.overlay,l,u)},__setBgOverlay:function(o,n,l,u){var r=this;if(!n){l[o]=!0,u&&u();return}o==="backgroundImage"||o==="overlayImage"?t.util.enlivenObjects([n],function(h){r[o]=h[0],l[o]=!0,u&&u()}):this["set"+t.util.string.capitalize(o,!0)](n,function(){l[o]=!0,u&&u()})},_enlivenObjects:function(o,n,l){if(!o||o.length===0){n&&n([]);return}t.util.enlivenObjects(o,function(u){n&&n(u)},null,l)},_toDataURL:function(o,n){this.clone(function(l){n(l.toDataURL(o))})},_toDataURLWithMultiplier:function(o,n,l){this.clone(function(u){l(u.toDataURLWithMultiplier(o,n))})},clone:function(o,n){var l=JSON.stringify(this.toJSON(n));this.cloneWithoutData(function(u){u.loadFromJSON(l,function(){o&&o(u)})})},cloneWithoutData:function(o){var n=t.util.createCanvasElement();n.width=this.width,n.height=this.height;var l=new t.Canvas(n);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),o&&o(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):o&&o(l)}}),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.object.clone,r=n.util.toFixed,h=n.util.string.capitalize,a=n.util.degreesToRadians,d=!n.isLikelyNode,p=2;n.Object||(n.Object=n.util.createClass(n.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:d,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(f){f&&this.setOptions(f)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=n.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(f){var v=n.perfLimitSizeTotal,_=f.width,b=f.height,y=n.maxCacheSideLimit,x=n.minCacheSideLimit;if(_<=y&&b<=y&&_*b<=v)return _<x&&(f.width=x),b<x&&(f.height=x),f;var C=_/b,S=n.util.limitDimsByArea(C,v),O=n.util.capValue,E=O(x,S.x,y),R=O(x,S.y,y);return _>E&&(f.zoomX/=_/E,f.width=E,f.capped=!0),b>R&&(f.zoomY/=b/R,f.height=R,f.capped=!0),f},_getCacheCanvasDimensions:function(){var f=this.getTotalObjectScaling(),v=this._getTransformedDimensions(0,0),_=v.x*f.scaleX/this.scaleX,b=v.y*f.scaleY/this.scaleY;return{width:_+p,height:b+p,zoomX:f.scaleX,zoomY:f.scaleY,x:_,y:b}},_updateCacheCanvas:function(){var f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){var v=f._currentTransform.target,_=f._currentTransform.action;if(this===v&&_.slice&&_.slice(0,5)==="scale")return!1}var b=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),x=n.minCacheSideLimit,C=y.width,S=y.height,O,E,R=y.zoomX,z=y.zoomY,V=C!==this.cacheWidth||S!==this.cacheHeight,K=this.zoomX!==R||this.zoomY!==z,G=V||K,Y=0,J=0,et=!1;if(V){var nt=this._cacheCanvas.width,w=this._cacheCanvas.height,P=C>nt||S>w,D=(C<nt*.9||S<w*.9)&&nt>x&&w>x;et=P||D,P&&!y.capped&&(C>x||S>x)&&(Y=C*.1,J=S*.1)}return this instanceof n.Text&&this.path&&(G=!0,et=!0,Y+=this.getHeightOfLine(0)*this.zoomX,J+=this.getHeightOfLine(0)*this.zoomY),G?(et?(b.width=Math.ceil(C+Y),b.height=Math.ceil(S+J)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,b.width,b.height)),O=y.x/2,E=y.y/2,this.cacheTranslationX=Math.round(b.width/2-O)+O,this.cacheTranslationY=Math.round(b.height/2-E)+E,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(R,z),this.zoomX=R,this.zoomY=z,!0):!1},setOptions:function(f){this._setOptions(f),this._initGradient(f.fill,"fill"),this._initGradient(f.stroke,"stroke"),this._initPattern(f.fill,"fill"),this._initPattern(f.stroke,"stroke")},transform:function(f){var v=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,_=this.calcTransformMatrix(!v);f.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(f){var v=n.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:n.version,originX:this.originX,originY:this.originY,left:r(this.left,v),top:r(this.top,v),width:r(this.width,v),height:r(this.height,v),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,v),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,v),scaleX:r(this.scaleX,v),scaleY:r(this.scaleY,v),angle:r(this.angle,v),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,v),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,v),skewY:r(this.skewY,v)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(f),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),n.util.populateWithProperties(this,_,f),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var v=n.util.getKlass(f.type).prototype,_=v.stateProperties;return _.forEach(function(b){b==="left"||b==="top"||(f[b]===v[b]&&delete f[b],Array.isArray(f[b])&&Array.isArray(v[b])&&f[b].length===0&&v[b].length===0&&delete f[b])}),f},toString:function(){return"#<fabric."+h(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var f=n.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(f.scaleX),scaleY:Math.abs(f.scaleY)}},getTotalObjectScaling:function(){var f=this.getObjectScaling(),v=f.scaleX,_=f.scaleY;if(this.canvas){var b=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();v*=b*y,_*=b*y}return{scaleX:v,scaleY:_}},getObjectOpacity:function(){var f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f},_set:function(f,v){var _=f==="scaleX"||f==="scaleY",b=this[f]!==v,y=!1;return _&&(v=this._constrainScale(v)),f==="scaleX"&&v<0?(this.flipX=!this.flipX,v*=-1):f==="scaleY"&&v<0?(this.flipY=!this.flipY,v*=-1):f==="shadow"&&v&&!(v instanceof n.Shadow)?v=new n.Shadow(v):f==="dirty"&&this.group&&this.group.set("dirty",v),this[f]=v,b&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(f)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(f)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:n.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(f),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),f.restore())},renderCache:function(f){f=f||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,f.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(f,v){if(f.save(),v.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",v.absolutePositioned){var _=n.util.invertTransform(this.calcTransformMatrix());f.transform(_[0],_[1],_[2],_[3],_[4],_[5])}v.transform(f),f.scale(1/v.zoomX,1/v.zoomY),f.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),f.restore()},drawObject:function(f,v){var _=this.fill,b=this.stroke;v?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath),this.fill=_,this.stroke=b},_drawClipPath:function(f,v){v&&(v.canvas=this.canvas,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCache(f,v))},drawCacheOnCanvas:function(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(f){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!f&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!f){var v=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-v/2,-_/2,v,_)}return!0}return!1},_renderBackground:function(f){if(this.backgroundColor){var v=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-v.x/2,-v.y/2,v.x,v.y),this._removeShadow(f)}},_setOpacity:function(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity},_setStrokeStyles:function(f,v){var _=v.stroke;_&&(f.lineWidth=v.strokeWidth,f.lineCap=v.strokeLineCap,f.lineDashOffset=v.strokeDashOffset,f.lineJoin=v.strokeLineJoin,f.miterLimit=v.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(f,_):(f.strokeStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,_)):f.strokeStyle=v.stroke)},_setFillStyles:function(f,v){var _=v.fill;_&&(_.toLive?(f.fillStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,v.fill)):f.fillStyle=_)},_setClippingProperties:function(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"},_setLineDash:function(f,v){!v||v.length===0||(1&v.length&&v.push.apply(v,v),f.setLineDash(v))},_renderControls:function(f,v){var _=this.getViewportTransform(),b=this.calcTransformMatrix(),y,x,C;v=v||{},x=typeof v.hasBorders<"u"?v.hasBorders:this.hasBorders,C=typeof v.hasControls<"u"?v.hasControls:this.hasControls,b=n.util.multiplyTransformMatrices(_,b),y=n.util.qrDecompose(b),f.save(),f.translate(y.translateX,y.translateY),f.lineWidth=1*this.borderScaleFactor,this.group||(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),f.rotate(a(this.group?y.angle:this.angle)),v.forActiveSelection||this.group?x&&this.drawBordersInGroup(f,y,v):x&&this.drawBorders(f,v),C&&this.drawControls(f,v),f.restore()},_setShadow:function(f){if(this.shadow){var v=this.shadow,_=this.canvas,b,y=_&&_.viewportTransform[0]||1,x=_&&_.viewportTransform[3]||1;v.nonScaling?b={scaleX:1,scaleY:1}:b=this.getObjectScaling(),_&&_._isRetinaScaling()&&(y*=n.devicePixelRatio,x*=n.devicePixelRatio),f.shadowColor=v.color,f.shadowBlur=v.blur*n.browserShadowBlurConstant*(y+x)*(b.scaleX+b.scaleY)/4,f.shadowOffsetX=v.offsetX*y*b.scaleX,f.shadowOffsetY=v.offsetY*x*b.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_applyPatternGradientTransform:function(f,v){if(!v||!v.toLive)return{offsetX:0,offsetY:0};var _=v.gradientTransform||v.patternTransform,b=-this.width/2+v.offsetX||0,y=-this.height/2+v.offsetY||0;return v.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,b,y):f.transform(1,0,0,1,b,y),_&&f.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:b,offsetY:y}},_renderPaintInOrder:function(f){this.paintFirst==="stroke"?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))},_render:function(){},_renderFill:function(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform&&this.group){var v=this.getObjectScaling();f.scale(1/v.scaleX,1/v.scaleY)}else this.strokeUniform&&f.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}},_applyPatternForTransformedGradient:function(f,v){var _=this._limitCacheSize(this._getCacheCanvasDimensions()),b=n.util.createCanvasElement(),y,x=this.canvas.getRetinaScaling(),C=_.x/this.scaleX/x,S=_.y/this.scaleY/x;b.width=C,b.height=S,y=b.getContext("2d"),y.beginPath(),y.moveTo(0,0),y.lineTo(C,0),y.lineTo(C,S),y.lineTo(0,S),y.closePath(),y.translate(C/2,S/2),y.scale(_.zoomX/this.scaleX/x,_.zoomY/this.scaleY/x),this._applyPatternGradientTransform(y,v),y.fillStyle=v.toLive(f),y.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(x*this.scaleX/_.zoomX,x*this.scaleY/_.zoomY),f.strokeStyle=y.createPattern(b,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var f=n.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",f.scaleX),this.set("scaleY",f.scaleY),this.angle=f.angle,this.skewX=f.skewX,this.skewY=0}},_removeTransformMatrix:function(f){var v=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),v=n.util.transformPoint(v,this.transformMatrix)),this.transformMatrix=null,f&&(this.scaleX*=f.scaleX,this.scaleY*=f.scaleY,this.cropX=f.cropX,this.cropY=f.cropY,v.x+=f.offsetLeft,v.y+=f.offsetTop,this.width=f.width,this.height=f.height),this.setPositionByOrigin(v,"center","center")},clone:function(f,v){var _=this.toObject(v);this.constructor.fromObject?this.constructor.fromObject(_,f):n.Object._fromObject("Object",_,f)},cloneAsImage:function(f,v){var _=this.toCanvasElement(v);return f&&f(new n.Image(_)),this},toCanvasElement:function(f){f||(f={});var v=n.util,_=v.saveObjectTransform(this),b=this.group,y=this.shadow,x=Math.abs,C=(f.multiplier||1)*(f.enableRetinaScaling?n.devicePixelRatio:1);delete this.group,f.withoutTransform&&v.resetObjectTransform(this),f.withoutShadow&&(this.shadow=null);var S=n.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),E=this.shadow,R,z={x:0,y:0},V,K,G;E&&(V=E.blur,E.nonScaling?R={scaleX:1,scaleY:1}:R=this.getObjectScaling(),z.x=2*Math.round(x(E.offsetX)+V)*x(R.scaleX),z.y=2*Math.round(x(E.offsetY)+V)*x(R.scaleY)),K=O.width+z.x,G=O.height+z.y,S.width=Math.ceil(K),S.height=Math.ceil(G);var Y=new n.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});f.format==="jpeg"&&(Y.backgroundColor="#fff"),this.setPositionByOrigin(new n.Point(Y.width/2,Y.height/2),"center","center");var J=this.canvas;Y.add(this);var et=Y.toCanvasElement(C||1,f);return this.shadow=y,this.set("canvas",J),b&&(this.group=b),this.set(_).setCoords(),Y._objects=[],Y.dispose(),Y=null,et},toDataURL:function(f){return f||(f={}),n.util.toDataURL(this.toCanvasElement(f),f.format||"png",f.quality||1)},isType:function(f){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===f},complexity:function(){return 1},toJSON:function(f){return this.toObject(f)},rotate:function(f){var v=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return v&&this._setOriginToCenter(),this.set("angle",f),v&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(f,v){v=v||this.canvas.getPointer(f);var _=new n.Point(v.x,v.y),b=this._getLeftTopCoords();return this.angle&&(_=n.util.rotatePoint(_,b,a(-this.angle))),{x:_.x-b.x,y:_.y-b.y}},_setupCompositeOperation:function(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){n.runningAnimations&&n.runningAnimations.cancelByTarget(this)}}),n.util.createAccessors&&n.util.createAccessors(n.Object),l(n.Object.prototype,n.Observable),n.Object.NUM_FRACTION_DIGITS=2,n.Object.ENLIVEN_PROPS=["clipPath"],n.Object._fromObject=function(f,v,_,b){var y=n[f];v=u(v,!0),n.util.enlivenPatterns([v.fill,v.stroke],function(x){typeof x[0]<"u"&&(v.fill=x[0]),typeof x[1]<"u"&&(v.stroke=x[1]),n.util.enlivenObjectEnlivables(v,v,function(){var C=b?new y(v[b],v):new y(v);_&&_(C)})})},n.Object.__uid=0)}(i),function(){var o=t.util.degreesToRadians,n={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(u,r,h,a,d){var p=u.x,f=u.y,v,_,b;return typeof r=="string"?r=n[r]:r-=.5,typeof a=="string"?a=n[a]:a-=.5,v=a-r,typeof h=="string"?h=l[h]:h-=.5,typeof d=="string"?d=l[d]:d-=.5,_=d-h,(v||_)&&(b=this._getTransformedDimensions(),p=u.x+v*b.x,f=u.y+_*b.y),new t.Point(p,f)},translateToCenterPoint:function(u,r,h){var a=this.translateToGivenOrigin(u,r,h,"center","center");return this.angle?t.util.rotatePoint(a,u,o(this.angle)):a},translateToOriginPoint:function(u,r,h){var a=this.translateToGivenOrigin(u,"center","center",r,h);return this.angle?t.util.rotatePoint(a,u,o(this.angle)):a},getCenterPoint:function(){var u=new t.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,r){var h=this.getCenterPoint();return this.translateToOriginPoint(h,u,r)},toLocalPoint:function(u,r,h){var a=this.getCenterPoint(),d,p;return typeof r<"u"&&typeof h<"u"?d=this.translateToGivenOrigin(a,"center","center",r,h):d=new t.Point(this.left,this.top),p=new t.Point(u.x,u.y),this.angle&&(p=t.util.rotatePoint(p,a,-o(this.angle))),p.subtractEquals(d)},setPositionByOrigin:function(u,r,h){var a=this.translateToCenterPoint(u,r,h),d=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",d.x),this.set("top",d.y)},adjustPosition:function(u){var r=o(this.angle),h=this.getScaledWidth(),a=t.util.cos(r)*h,d=t.util.sin(r)*h,p,f;typeof this.originX=="string"?p=n[this.originX]:p=this.originX-.5,typeof u=="string"?f=n[u]:f=u-.5,this.left+=a*(f-p),this.top+=d*(f-p),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function o(h){return[new t.Point(h.tl.x,h.tl.y),new t.Point(h.tr.x,h.tr.y),new t.Point(h.br.x,h.br.y),new t.Point(h.bl.x,h.bl.y)]}var n=t.util,l=n.degreesToRadians,u=n.multiplyTransformMatrices,r=n.transformPoint;n.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(h,a){return a?h?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),h?this.aCoords:this.lineCoords)},getCoords:function(h,a){return o(this._getCoords(h,a))},intersectsWithRect:function(h,a,d,p){var f=this.getCoords(d,p),v=t.Intersection.intersectPolygonRectangle(f,h,a);return v.status==="Intersection"},intersectsWithObject:function(h,a,d){var p=t.Intersection.intersectPolygonPolygon(this.getCoords(a,d),h.getCoords(a,d));return p.status==="Intersection"||h.isContainedWithinObject(this,a,d)||this.isContainedWithinObject(h,a,d)},isContainedWithinObject:function(h,a,d){for(var p=this.getCoords(a,d),f=a?h.aCoords:h.lineCoords,v=0,_=h._getImageLines(f);v<4;v++)if(!h.containsPoint(p[v],_))return!1;return!0},isContainedWithinRect:function(h,a,d,p){var f=this.getBoundingRect(d,p);return f.left>=h.x&&f.left+f.width<=a.x&&f.top>=h.y&&f.top+f.height<=a.y},containsPoint:function(h,v,d,p){var f=this._getCoords(d,p),v=v||this._getImageLines(f),_=this._findCrossPoints(h,v);return _!==0&&_%2===1},isOnScreen:function(h){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br,p=this.getCoords(!0,h);return p.some(function(f){return f.x<=d.x&&f.x>=a.x&&f.y<=d.y&&f.y>=a.y})||this.intersectsWithRect(a,d,!0,h)?!0:this._containsCenterOfCanvas(a,d,h)},_containsCenterOfCanvas:function(h,a,d){var p={x:(h.x+a.x)/2,y:(h.y+a.y)/2};return!!this.containsPoint(p,null,!0,d)},isPartiallyOnScreen:function(h){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br;if(this.intersectsWithRect(a,d,!0,h))return!0;var p=this.getCoords(!0,h).every(function(f){return(f.x>=d.x||f.x<=a.x)&&(f.y>=d.y||f.y<=a.y)});return p&&this._containsCenterOfCanvas(a,d,h)},_getImageLines:function(h){var a={topline:{o:h.tl,d:h.tr},rightline:{o:h.tr,d:h.br},bottomline:{o:h.br,d:h.bl},leftline:{o:h.bl,d:h.tl}};return a},_findCrossPoints:function(h,a){var d,p,f,v,_,b=0,y;for(var x in a)if(y=a[x],!(y.o.y<h.y&&y.d.y<h.y)&&!(y.o.y>=h.y&&y.d.y>=h.y)&&(y.o.x===y.d.x&&y.o.x>=h.x?_=y.o.x:(d=0,p=(y.d.y-y.o.y)/(y.d.x-y.o.x),f=h.y-d*h.x,v=y.o.y-p*y.o.x,_=-(f-v)/(d-p)),_>=h.x&&(b+=1),b===2))break;return b},getBoundingRect:function(h,a){var d=this.getCoords(h,a);return n.makeBoundingBoxFromPoints(d)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(h){return Math.abs(h)<this.minScaleLimit?h<0?-this.minScaleLimit:this.minScaleLimit:h===0?1e-4:h},scale:function(h){return this._set("scaleX",h),this._set("scaleY",h),this.setCoords()},scaleToWidth:function(h,a){var d=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(h/this.width/d)},scaleToHeight:function(h,a){var d=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(h/this.height/d)},calcLineCoords:function(){var h=this.getViewportTransform(),a=this.padding,d=l(this.angle),p=n.cos(d),f=n.sin(d),v=p*a,_=f*a,b=v+_,y=v-_,x=this.calcACoords(),C={tl:r(x.tl,h),tr:r(x.tr,h),bl:r(x.bl,h),br:r(x.br,h)};return a&&(C.tl.x-=y,C.tl.y-=b,C.tr.x+=b,C.tr.y-=y,C.bl.x-=b,C.bl.y+=y,C.br.x+=y,C.br.y+=b),C},calcOCoords:function(){var h=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),d=this.getViewportTransform(),p=u(d,a),f=u(p,h),f=u(f,[1/d[0],0,0,1/d[3],0,0]),v=this._calculateCurrentDimensions(),_={};return this.forEachControl(function(b,y,x){_[y]=b.positionHandler(v,f,x)}),_},calcACoords:function(){var h=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),d=u(a,h),p=this._getTransformedDimensions(),f=p.x/2,v=p.y/2;return{tl:r({x:-f,y:-v},d),tr:r({x:f,y:-v},d),bl:r({x:-f,y:v},d),br:r({x:f,y:v},d)}},setCoords:function(h){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),h?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return n.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var h=this.getCenterPoint();return[1,0,0,1,h.x,h.y]},transformMatrixKey:function(h){var a="_",d="";return!h&&this.group&&(d=this.group.transformMatrixKey(h)+a),d+this.top+a+this.left+a+this.scaleX+a+this.scaleY+a+this.skewX+a+this.skewY+a+this.angle+a+this.originX+a+this.originY+a+this.width+a+this.height+a+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(h){var a=this.calcOwnMatrix();if(h||!this.group)return a;var d=this.transformMatrixKey(h),p=this.matrixCache||(this.matrixCache={});return p.key===d?p.value:(this.group&&(a=u(this.group.calcTransformMatrix(!1),a)),p.key=d,p.value=a,a)},calcOwnMatrix:function(){var h=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===h)return a.value;var d=this._calcTranslateMatrix(),p={angle:this.angle,translateX:d[4],translateY:d[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return a.key=h,a.value=n.composeMatrix(p),a.value},_getNonTransformedDimensions:function(){var h=this.strokeWidth,a=this.width+h,d=this.height+h;return{x:a,y:d}},_getTransformedDimensions:function(h,a){typeof h>"u"&&(h=this.skewX),typeof a>"u"&&(a=this.skewY);var d,p,f,v=h===0&&a===0;if(this.strokeUniform?(p=this.width,f=this.height):(d=this._getNonTransformedDimensions(),p=d.x,f=d.y),v)return this._finalizeDimensions(p*this.scaleX,f*this.scaleY);var _=n.sizeAfterTransform(p,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:h,skewY:a});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(h,a){return this.strokeUniform?{x:h+this.strokeWidth,y:a+this.strokeWidth}:{x:h,y:a}},_calculateCurrentDimensions:function(){var h=this.getViewportTransform(),a=this._getTransformedDimensions(),d=r(a,h,!0);return d.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(o){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,o):this.canvas&&this.canvas.sendBackwards(this,o),this},bringForward:function(o){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,o):this.canvas&&this.canvas.bringForward(this,o),this},moveTo:function(o){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,o):this.canvas&&this.canvas.moveTo(this,o),this}}),function(){function o(l,u){if(u){if(u.toLive)return l+": url(#SVGID_"+u.id+"); ";var r=new t.Color(u),h=l+": "+r.toRgb()+"; ",a=r.getAlpha();return a!==1&&(h+=l+"-opacity: "+a.toString()+"; "),h}else return l+": none; "}var n=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var u=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",h=this.strokeDashArray?this.strokeDashArray.join(" "):"none",a=this.strokeDashOffset?this.strokeDashOffset:"0",d=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=typeof this.opacity<"u"?this.opacity:"1",_=this.visible?"":" visibility: hidden;",b=l?"":this.getSvgFilter(),y=o("fill",this.fill),x=o("stroke",this.stroke);return[x,"stroke-width: ",r,"; ","stroke-dasharray: ",h,"; ","stroke-linecap: ",d,"; ","stroke-dashoffset: ",a,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",f,"; ",y,"fill-rule: ",u,"; ","opacity: ",v,";",b,_].join("")},getSvgSpanStyles:function(l,u){var r="; ",a=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+r:"",h=l.strokeWidth?"stroke-width: "+l.strokeWidth+r:"",a=a,d=l.fontSize?"font-size: "+l.fontSize+"px"+r:"",p=l.fontStyle?"font-style: "+l.fontStyle+r:"",f=l.fontWeight?"font-weight: "+l.fontWeight+r:"",v=l.fill?o("fill",l.fill):"",_=l.stroke?o("stroke",l.stroke):"",b=this.getSvgTextDecoration(l),y=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return b&&(b="text-decoration: "+b+r),[_,h,a,d,p,f,b,v,y,u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(u){return l[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,u){var r=l?this.calcTransformMatrix():this.calcOwnMatrix(),h='transform="'+t.util.matrixToSVG(r);return h+(u||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var u=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,u),'" y="',n(-this.height/2,u),'" width="',n(this.width,u),'" height="',n(this.height,u),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,u){u=u||{};var r=u.reviver,h=u.additionalTransform||"",a=[this.getSvgTransform(!0,h),this.getSvgCommons()].join(""),d=l.indexOf("COMMON_PARTS");return l[d]=a,r?r(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,u){u=u||{};var r=u.noStyle,h=u.reviver,a=r?"":'style="'+this.getSvgStyles()+'" ',d=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",p=this.clipPath,f=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",v=p&&p.absolutePositioned,_=this.stroke,b=this.fill,y=this.shadow,x,C=[],S,O=l.indexOf("COMMON_PARTS"),E=u.additionalTransform;return p&&(p.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+p.clipPathId+`" >
`+p.toClipPathSVG(h)+`</clipPath>
`),v&&C.push("<g ",d,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),v?"":d+this.getSvgCommons(),` >
`),x=[a,f,r?"":this.addPaintOrder()," ",E?'transform="'+E+'" ':""].join(""),l[O]=x,b&&b.toLive&&C.push(b.toSVG(this)),_&&_.toLive&&C.push(_.toSVG(this)),y&&C.push(y.toSVG(this)),p&&C.push(S),C.push(l.join("")),C.push(`</g>
`),v&&C.push(`</g>
`),h?h(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var o=t.util.object.extend,n="stateProperties";function l(r,h,a){var d={},p=!0;a.forEach(function(f){d[f]=r[f]}),o(r[h],d,p)}function u(r,h,a){if(r===h)return!0;if(Array.isArray(r)){if(!Array.isArray(h)||r.length!==h.length)return!1;for(var d=0,p=r.length;d<p;d++)if(!u(r[d],h[d]))return!1;return!0}else if(r&&typeof r=="object"){var f=Object.keys(r),v;if(!h||typeof h!="object"||!a&&f.length!==Object.keys(h).length)return!1;for(var d=0,p=f.length;d<p;d++)if(v=f[d],!(v==="canvas"||v==="group")&&!u(r[v],h[v]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(r){r=r||n;var h="_"+r;return Object.keys(this[h]).length<this[r].length?!0:!u(this[h],this,!0)},saveState:function(r){var h=r&&r.propertySet||n,a="_"+h;return this[a]?(l(this,a,this[h]),r&&r.stateProperties&&l(this,a,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var h=r.propertySet||n;return r.propertySet=h,this["_"+h]={},this.saveState(r),this}})}(),function(){var o=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(n,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u=n.x,r=n.y,h,a,d=Object.keys(this.oCoords),p=d.length-1,f;for(this.__corner=0;p>=0;p--)if(f=d[p],!!this.isControlVisible(f)&&(a=this._getImageLines(l?this.oCoords[f].touchCorner:this.oCoords[f].corner),h=this._findCrossPoints({x:u,y:r},a),h!==0&&h%2===1))return this.__corner=f,f;return!1},forEachControl:function(n){for(var l in this.controls)n(this.controls[l],l,this)},_setCornerCoords:function(){var n=this.oCoords;for(var l in n){var u=this.controls[l];n[l].corner=u.calcCornerCoords(this.angle,this.cornerSize,n[l].x,n[l].y,!1),n[l].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,n[l].x,n[l].y,!0)}},drawSelectionBackground:function(n){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;n.save();var l=this.getCenterPoint(),u=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return n.translate(l.x,l.y),n.scale(1/r[0],1/r[3]),n.rotate(o(this.angle)),n.fillStyle=this.selectionBackgroundColor,n.fillRect(-u.x/2,-u.y/2,u.x,u.y),n.restore(),this},drawBorders:function(n,l){l=l||{};var u=this._calculateCurrentDimensions(),r=this.borderScaleFactor,h=u.x+r,a=u.y+r,d=typeof l.hasControls<"u"?l.hasControls:this.hasControls,p=!1;return n.save(),n.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(n,l.borderDashArray||this.borderDashArray),n.strokeRect(-h/2,-a/2,h,a),d&&(n.beginPath(),this.forEachControl(function(f,v,_){f.withConnection&&f.getVisibility(_,v)&&(p=!0,n.moveTo(f.x*h,f.y*a),n.lineTo(f.x*h+f.offsetX,f.y*a+f.offsetY))}),p&&n.stroke()),n.restore(),this},drawBordersInGroup:function(n,l,u){u=u||{};var r=t.util.sizeAfterTransform(this.width,this.height,l),h=this.strokeWidth,a=this.strokeUniform,d=this.borderScaleFactor,p=r.x+h*(a?this.canvas.getZoom():l.scaleX)+d,f=r.y+h*(a?this.canvas.getZoom():l.scaleY)+d;return n.save(),this._setLineDash(n,u.borderDashArray||this.borderDashArray),n.strokeStyle=u.borderColor||this.borderColor,n.strokeRect(-p/2,-f/2,p,f),n.restore(),this},drawControls:function(n,l){l=l||{},n.save();var u=this.canvas.getRetinaScaling(),r,h;return n.setTransform(u,0,0,u,0,0),n.strokeStyle=n.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(n.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(n,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(a,d,p){h=p.oCoords[d],a.getVisibility(p,d)&&(r&&(h=t.util.transformPoint(h,r)),a.render(n,h.x,h.y,l,p))}),n.restore(),this},isControlVisible:function(n){return this.controls[n]&&this.controls[n].getVisibility(this,n)},setControlVisible:function(n,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[n]=l,this},setControlsVisibility:function(n){n||(n={});for(var l in n)this.setControlVisible(l,n[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(o,n){n=n||{};var l=function(){},u=n.onComplete||l,r=n.onChange||l,h=this;return t.util.animate({target:this,startValue:o.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(a){o.set("left",a),h.requestRenderAll(),r()},onComplete:function(){o.setCoords(),u()}})},fxCenterObjectV:function(o,n){n=n||{};var l=function(){},u=n.onComplete||l,r=n.onChange||l,h=this;return t.util.animate({target:this,startValue:o.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(a){o.set("top",a),h.requestRenderAll(),r()},onComplete:function(){o.setCoords(),u()}})},fxRemove:function(o,n){n=n||{};var l=function(){},u=n.onComplete||l,r=n.onChange||l,h=this;return t.util.animate({target:this,startValue:o.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(a){o.set("opacity",a),h.requestRenderAll(),r()},onComplete:function(){h.remove(o),u()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var o=[],n,l,u=[];for(n in arguments[0])o.push(n);for(var r=0,h=o.length;r<h;r++)n=o[r],l=r!==h-1,u.push(this._animate(n,arguments[0][n],arguments[1],l));return u}else return this._animate.apply(this,arguments)},_animate:function(o,n,l,u){var r=this,h;n=n.toString(),l?l=t.util.object.clone(l):l={},~o.indexOf(".")&&(h=o.split("."));var a=r.colorProperties.indexOf(o)>-1||h&&r.colorProperties.indexOf(h[1])>-1,d=h?this.get(h[0])[h[1]]:this.get(o);"from"in l||(l.from=d),a||(~n.indexOf("=")?n=d+parseFloat(n.replace("=","")):n=parseFloat(n));var p={target:this,startValue:l.from,endValue:n,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(f,v,_){return l.abort.call(r,f,v,_)},onChange:function(f,v,_){h?r[h[0]][h[1]]=f:r.set(o,f),!u&&l.onChange&&l.onChange(f,v,_)},onComplete:function(f,v,_){u||(r.setCoords(),l.onComplete&&l.onComplete(f,v,_))}};return a?t.util.animateColor(p.startValue,p.endValue,p.duration,p):t.util.animate(p)}}),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(n.Line){n.warn("fabric.Line is already defined");return}n.Line=n.util.createClass(n.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:n.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,d){a||(a=[0,0,0,0]),this.callSuper("initialize",d),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(d)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,d){return this.callSuper("_set",a,d),typeof r[a]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:h({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:h({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){a.beginPath();var d=this.calcLinePoints();a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2),a.lineWidth=this.strokeWidth;var p=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=p},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(a){return l(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(a.y-=this.strokeWidth),this.height===0&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,p=a*this.width*.5,f=d*this.height*.5,v=a*this.width*-.5,_=d*this.height*-.5;return{x1:p,x2:v,y1:f,y2:_}},_toSVG:function(){var a=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`" />
`]}}),n.Line.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),n.Line.fromElement=function(a,d,p){p=p||{};var f=n.parseAttributes(a,n.Line.ATTRIBUTE_NAMES),v=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];d(new n.Line(v,l(f,p)))},n.Line.fromObject=function(a,d){function p(v){delete v.points,d&&d(v)}var f=u(a,!0);f.points=[a.x1,a.y1,a.x2,a.y2],n.Object._fromObject("Line",f,p,"points")};function h(a,d){var p=a.origin,f=a.axis1,v=a.axis2,_=a.dimension,b=d.nearest,y=d.center,x=d.farthest;return function(){switch(this.get(p)){case b:return Math.min(this.get(f),this.get(v));case y:return Math.min(this.get(f),this.get(v))+.5*this.get(_);case x:return Math.max(this.get(f),this.get(v))}}}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.degreesToRadians;if(n.Circle){n.warn("fabric.Circle is already defined.");return}n.Circle=n.util.createClass(n.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:n.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,h){return this.callSuper("_set",r,h),r==="radius"&&this.setRadius(h),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,h=0,a=0,d=(this.endAngle-this.startAngle)%360;if(d===0)r=["<circle ","COMMON_PARTS",'cx="'+h+'" cy="'+a+'" ','r="',this.radius,`" />
`];else{var p=l(this.startAngle),f=l(this.endAngle),v=this.radius,_=n.util.cos(p)*v,b=n.util.sin(p)*v,y=n.util.cos(f)*v,x=n.util.sin(f)*v,C=d>180?"1":"0";r=['<path d="M '+_+" "+b," A "+v+" "+v," 0 ",+C+" 1"," "+y+" "+x,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),n.Circle.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),n.Circle.fromElement=function(r,h){var a=n.parseAttributes(r,n.Circle.ATTRIBUTE_NAMES);if(!u(a))throw new Error("value of `r` attribute is required and can not be negative");a.left=(a.left||0)-a.radius,a.top=(a.top||0)-a.radius,h(new n.Circle(a))};function u(r){return"radius"in r&&r.radius>=0}n.Circle.fromObject=function(r,h){n.Object._fromObject("Circle",r,h)}}(i),function(o){var n=o.fabric||(o.fabric={});if(n.Triangle){n.warn("fabric.Triangle is already defined");return}n.Triangle=n.util.createClass(n.Object,{type:"triangle",width:100,height:100,_render:function(l){var u=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-u,r),l.lineTo(0,-r),l.lineTo(u,r),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,u=this.height/2,r=[-l+" "+u,"0 "+-u,l+" "+u].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),n.Triangle.fromObject=function(l,u){return n.Object._fromObject("Triangle",l,u)}}(i),function(o){var n=o.fabric||(o.fabric={}),l=Math.PI*2;if(n.Ellipse){n.warn("fabric.Ellipse is already defined.");return}n.Ellipse=n.util.createClass(n.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,r){switch(this.callSuper("_set",u,r),u){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,l,!1),u.restore(),this._renderPaintInOrder(u)}}),n.Ellipse.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),n.Ellipse.fromElement=function(u,r){var h=n.parseAttributes(u,n.Ellipse.ATTRIBUTE_NAMES);h.left=(h.left||0)-h.rx,h.top=(h.top||0)-h.ry,r(new n.Ellipse(h))},n.Ellipse.fromObject=function(u,r){n.Object._fromObject("Ellipse",u,r)}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend;if(n.Rect){n.warn("fabric.Rect is already defined");return}n.Rect=n.util.createClass(n.Object,{stateProperties:n.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var r=this.rx?Math.min(this.rx,this.width/2):0,h=this.ry?Math.min(this.ry,this.height/2):0,a=this.width,d=this.height,p=-this.width/2,f=-this.height/2,v=r!==0||h!==0,_=1-.5522847498;u.beginPath(),u.moveTo(p+r,f),u.lineTo(p+a-r,f),v&&u.bezierCurveTo(p+a-_*r,f,p+a,f+_*h,p+a,f+h),u.lineTo(p+a,f+d-h),v&&u.bezierCurveTo(p+a,f+d-_*h,p+a-_*r,f+d,p+a-r,f+d),u.lineTo(p+r,f+d),v&&u.bezierCurveTo(p+_*r,f+d,p,f+d-_*h,p,f+d-h),u.lineTo(p,f+h),v&&u.bezierCurveTo(p,f+_*h,p+_*r,f,p+r,f),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){var u=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',u,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),n.Rect.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),n.Rect.fromElement=function(u,r,h){if(!u)return r(null);h=h||{};var a=n.parseAttributes(u,n.Rect.ATTRIBUTE_NAMES);a.left=a.left||0,a.top=a.top||0,a.height=a.height||0,a.width=a.width||0;var d=new n.Rect(l(h?n.util.object.clone(h):{},a));d.visible=d.visible&&d.width>0&&d.height>0,r(d)},n.Rect.fromObject=function(u,r){return n.Object._fromObject("Rect",u,r)}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.util.array.min,r=n.util.array.max,h=n.util.toFixed,a=n.util.projectStrokeOnPoints;if(n.Polyline){n.warn("fabric.Polyline is already defined");return}n.Polyline=n.util.createClass(n.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:n.Object.prototype.cacheProperties.concat("points"),initialize:function(d,p){p=p||{},this.points=d||[],this.callSuper("initialize",p),this._setPositionDimensions(p)},_projectStrokeOnPoints:function(){return a(this.points,this,!0)},_setPositionDimensions:function(d){var p=this._calcDimensions(d),f,v=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-v,this.height=p.height-v,d.fromSVG||(f=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+v/2,y:p.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),typeof d.left>"u"&&(this.left=d.fromSVG?p.left:f.x),typeof d.top>"u"&&(this.top=d.fromSVG?p.top:f.y),this.pathOffset={x:p.left+this.width/2+v/2,y:p.top+this.height/2+v/2}},_calcDimensions:function(){var d=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,p=u(d,"x")||0,f=u(d,"y")||0,v=r(d,"x")||0,_=r(d,"y")||0,b=v-p,y=_-f;return{left:p,top:f,width:b,height:y}},toObject:function(d){return l(this.callSuper("toObject",d),{points:this.points.concat()})},_toSVG:function(){for(var d=[],p=this.pathOffset.x,f=this.pathOffset.y,v=n.Object.NUM_FRACTION_DIGITS,_=0,b=this.points.length;_<b;_++)d.push(h(this.points[_].x-p,v),",",h(this.points[_].y-f,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',d.join(""),`" />
`]},commonRender:function(d){var p,f=this.points.length,v=this.pathOffset.x,_=this.pathOffset.y;if(!f||isNaN(this.points[f-1].y))return!1;d.beginPath(),d.moveTo(this.points[0].x-v,this.points[0].y-_);for(var b=0;b<f;b++)p=this.points[b],d.lineTo(p.x-v,p.y-_);return!0},_render:function(d){this.commonRender(d)&&this._renderPaintInOrder(d)},complexity:function(){return this.get("points").length}}),n.Polyline.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polyline.fromElementGenerator=function(d){return function(p,f,v){if(!p)return f(null);v||(v={});var _=n.parsePointsAttribute(p.getAttribute("points")),b=n.parseAttributes(p,n[d].ATTRIBUTE_NAMES);b.fromSVG=!0,f(new n[d](_,l(b,v)))}},n.Polyline.fromElement=n.Polyline.fromElementGenerator("Polyline"),n.Polyline.fromObject=function(d,p){return n.Object._fromObject("Polyline",d,p,"points")}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.projectStrokeOnPoints;if(n.Polygon){n.warn("fabric.Polygon is already defined");return}n.Polygon=n.util.createClass(n.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),n.Polygon.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polygon.fromElement=n.Polyline.fromElementGenerator("Polygon"),n.Polygon.fromObject=function(u,r){n.Object._fromObject("Polygon",u,r,"points")}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.array.min,u=n.util.array.max,r=n.util.object.extend,h=n.util.object.clone,a=n.util.toFixed;if(n.Path){n.warn("fabric.Path is already defined");return}n.Path=n.util.createClass(n.Object,{type:"path",path:null,cacheProperties:n.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:n.Object.prototype.stateProperties.concat("path"),initialize:function(d,p){p=h(p||{}),delete p.path,this.callSuper("initialize",p),this._setPath(d||[],p)},_setPath:function(d,p){this.path=n.util.makePathSimpler(Array.isArray(d)?d:n.util.parsePath(d)),n.Polyline.prototype._setPositionDimensions.call(this,p||{})},_renderPathCommands:function(d){var p,f=0,v=0,_=0,b=0,y=0,x=0,C=-this.pathOffset.x,S=-this.pathOffset.y;d.beginPath();for(var O=0,E=this.path.length;O<E;++O)switch(p=this.path[O],p[0]){case"L":_=p[1],b=p[2],d.lineTo(_+C,b+S);break;case"M":_=p[1],b=p[2],f=_,v=b,d.moveTo(_+C,b+S);break;case"C":_=p[5],b=p[6],y=p[3],x=p[4],d.bezierCurveTo(p[1]+C,p[2]+S,y+C,x+S,_+C,b+S);break;case"Q":d.quadraticCurveTo(p[1]+C,p[2]+S,p[3]+C,p[4]+S),_=p[3],b=p[4],y=p[1],x=p[2];break;case"z":case"Z":_=f,b=v,d.closePath();break}},_render:function(d){this._renderPathCommands(d),this._renderPaintInOrder(d)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(d){return r(this.callSuper("toObject",d),{path:this.path.map(function(p){return p.slice()})})},toDatalessObject:function(d){var p=this.toObject(["sourcePath"].concat(d));return p.sourcePath&&delete p.path,p},_toSVG:function(){var d=n.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',d,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var d=n.Object.NUM_FRACTION_DIGITS;return" translate("+a(-this.pathOffset.x,d)+", "+a(-this.pathOffset.y,d)+")"},toClipPathSVG:function(d){var p=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},toSVG:function(d){var p=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var d=[],p=[],f,v=0,_=0,b=0,y=0,x,C=0,S=this.path.length;C<S;++C){switch(f=this.path[C],f[0]){case"L":b=f[1],y=f[2],x=[];break;case"M":b=f[1],y=f[2],v=b,_=y,x=[];break;case"C":x=n.util.getBoundsOfCurve(b,y,f[1],f[2],f[3],f[4],f[5],f[6]),b=f[5],y=f[6];break;case"Q":x=n.util.getBoundsOfCurve(b,y,f[1],f[2],f[1],f[2],f[3],f[4]),b=f[3],y=f[4];break;case"z":case"Z":b=v,y=_;break}x.forEach(function(G){d.push(G.x),p.push(G.y)}),d.push(b),p.push(y)}var O=l(d)||0,E=l(p)||0,R=u(d)||0,z=u(p)||0,V=R-O,K=z-E;return{left:O,top:E,width:V,height:K}}}),n.Path.fromObject=function(d,p){if(typeof d.sourcePath=="string"){var f=d.sourcePath;n.loadSVGFromURL(f,function(v){var _=v[0];_.setOptions(d),d.clipPath?n.util.enlivenObjects([d.clipPath],function(b){_.clipPath=b[0],p&&p(_)}):p&&p(_)})}else n.Object._fromObject("Path",d,p,"path")},n.Path.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(["d"]),n.Path.fromElement=function(d,p,f){var v=n.parseAttributes(d,n.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,p(new n.Path(v.d,r(v,f)))}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.array.min,u=n.util.array.max;n.Group||(n.Group=n.util.createClass(n.Object,n.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,h,a){h=h||{},this._objects=[],a&&this.callSuper("initialize",h),this._objects=r||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(a)this._updateObjectsACoords();else{var p=h&&h.centerPoint;h.originX!==void 0&&(this.originX=h.originX),h.originY!==void 0&&(this.originY=h.originY),p||this._calcBounds(),this._updateObjectsCoords(p),delete h.centerPoint,this.callSuper("initialize",h)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,h=this._objects.length;h--;)this._objects[h].setCoords(r)},_updateObjectsCoords:function(h){for(var h=h||this.getCenterPoint(),a=this._objects.length;a--;)this._updateObjectCoords(this._objects[a],h)},_updateObjectCoords:function(r,h){var a=r.left,d=r.top,p=!0;r.set({left:a-h.x,top:d-h.y}),r.group=this,r.setCoords(p)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var h=!!this.group;return this._restoreObjectsState(),n.util.resetObjectTransform(this),r&&(h&&n.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,h?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),n.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,h){var a=this._objects.length;if(this.useSetOnGroup)for(;a--;)this._objects[a].setOnGroup(r,h);if(r==="canvas")for(;a--;)this._objects[a]._set(r,h);n.Object.prototype._set.call(this,r,h)},toObject:function(r){var h=this.includeDefaultValues,a=this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){var f=p.includeDefaultValues;p.includeDefaultValues=h;var v=p.toObject(r);return p.includeDefaultValues=f,v}),d=n.Object.prototype.toObject.call(this,r);return d.objects=a,d},toDatalessObject:function(r){var h,a=this.sourcePath;if(a)h=a;else{var d=this.includeDefaultValues;h=this._objects.map(function(f){var v=f.includeDefaultValues;f.includeDefaultValues=d;var _=f.toDatalessObject(r);return f.includeDefaultValues=v,_})}var p=n.Object.prototype.toDatalessObject.call(this,r);return p.objects=h,p},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=n.Object.prototype.shouldCache.call(this);if(r){for(var h=0,a=this._objects.length;h<a;h++)if(this._objects[h].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(n.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,h=this._objects.length;r<h;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var h=0,a=this._objects.length;h<a;h++)this._objects[h].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var h=0,a=this._objects.length;h<a;h++)if(this._objects[h].isCacheDirty(!0)){if(this._cacheCanvas){var d=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-p/2,d,p)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(h){n.util.addTransformToObject(h,r),delete h.group,h.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,h=this.canvas;this._objects=[];var a=this.toObject();delete a.objects;var d=new n.ActiveSelection([]);return d.set(a),d.type="activeSelection",h.remove(this),r.forEach(function(p){p.group=d,p.dirty=!0,h.add(p)}),d.canvas=h,d._objects=r,h._activeObject=d,d.setCoords(),d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(h){h.setCoords(r)}),this},_calcBounds:function(r){for(var h=[],a=[],d,p,f,v=["tr","br","bl","tl"],_=0,b=this._objects.length,y,x=v.length;_<b;++_){for(d=this._objects[_],f=d.calcACoords(),y=0;y<x;y++)p=v[y],h.push(f[p].x),a.push(f[p].y);d.aCoords=f}this._getBounds(h,a,r)},_getBounds:function(r,h,a){var d=new n.Point(l(r),l(h)),p=new n.Point(u(r),u(h)),f=d.y||0,v=d.x||0,_=p.x-d.x||0,b=p.y-d.y||0;this.width=_,this.height=b,a||this.setPositionByOrigin({x:v,y:f},"left","top")},_toSVG:function(r){for(var h=["<g ","COMMON_PARTS",` >
`],a=0,d=this._objects.length;a<d;a++)h.push("		",this._objects[a].toSVG(r));return h.push(`</g>
`),h},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",h=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),h].join("")},toClipPathSVG:function(r){for(var h=[],a=0,d=this._objects.length;a<d;a++)h.push("	",this._objects[a].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(h,{reviver:r})}}),n.Group.fromObject=function(r,h){var a=r.objects,d=n.util.object.clone(r,!0);if(delete d.objects,typeof a=="string"){n.loadSVGFromURL(a,function(p){var f=n.util.groupSVGElements(p,r,a),v=d.clipPath;delete d.clipPath,f.set(d),v?n.util.enlivenObjects([v],function(_){f.clipPath=_[0],h&&h(f)}):h&&h(f)});return}n.util.enlivenObjects(a,function(p){n.util.enlivenObjectEnlivables(r,d,function(){h&&h(new n.Group(p,d,!0))})})})}(i),function(o){var n=o.fabric||(o.fabric={});n.ActiveSelection||(n.ActiveSelection=n.util.createClass(n.Group,{type:"activeSelection",initialize:function(l,u){u=u||{},this._objects=l||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),n.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var u=n.Object.prototype.toObject.call(this),r=new n.Group([]);if(delete u.type,r.set(u),l.forEach(function(a){a.canvas.remove(a),a.group=r}),r._objects=l,!this.canvas)return r;var h=this.canvas;return h.add(r),h._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,u,r){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,u),r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var h=0,a=this._objects.length;h<a;h++)this._objects[h]._renderControls(l,r);l.restore()}}),n.ActiveSelection.fromObject=function(l,u){n.util.enlivenObjects(l.objects,function(r){delete l.objects,u&&u(new n.ActiveSelection(r,l,!0))})})}(i),function(o){var n=t.util.object.extend;if(o.fabric||(o.fabric={}),o.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,u){u||(u={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",u),this._initElement(l,u)},getElement:function(){return this._element||{}},setElement:function(l,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var u=t.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var u=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-u,-r),l.lineTo(u,-r),l.lineTo(u,r),l.lineTo(-u,r),l.lineTo(-u,-r),l.closePath()}},toObject:function(l){var u=[];this.filters.forEach(function(h){h&&u.push(h.toObject())});var r=n(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],u=[],r,h=this._element,a=-this.width/2,d=-this.height/2,p="",f="";if(!h)return[];if(this.hasCrop()){var v=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+a+'" y="'+d+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),p=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(f='" image-rendering="optimizeSpeed'),u.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',a-this.cropX,'" y="',d-this.cropY,'" width="',h.width||h.naturalWidth,'" height="',h.height||h.height,f,'"',p,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,r=["	<rect ",'x="',a,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?l=l.concat(r,u):l=l.concat(u,r),l},getSrc:function(l){var u=l?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(l,u,r){return t.util.loadImage(l,function(h,a){this.setElement(h,r),this._setWidthHeight(),u&&u(this,a)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,u=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),h=r.scaleX,a=r.scaleY,d=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||h>u&&a>u){this._element=d,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=h,this._lastScaleY=a;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var p=t.util.createCanvasElement(),f=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=d.width,_=d.height;p.width=v,p.height=_,this._element=p,this._lastScaleX=l.scaleX=h,this._lastScaleY=l.scaleY=a,t.filterBackend.applyFilters([l],d,v,_,this._element,f),this._filterScalingX=p.width/this._originalElement.width,this._filterScalingY=p.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(d){return d&&!d.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,r=u.naturalWidth||u.width,h=u.naturalHeight||u.height;if(this._element===this._originalElement){var a=t.util.createCanvasElement();a.width=r,a.height=h,this._element=a,this._filteredEl=a}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,h),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,r,h,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var u=this._element;if(u){var r=this._filterScalingX,h=this._filterScalingY,a=this.width,d=this.height,p=Math.min,f=Math.max,v=f(this.cropX,0),_=f(this.cropY,0),b=u.naturalWidth||u.width,y=u.naturalHeight||u.height,x=v*r,C=_*h,S=p(a*r,b-x),O=p(d*h,y-C),E=-a/2,R=-d/2,z=p(a,b/r-v),V=p(d,y/h-_);u&&l.drawImage(u,x,C,S,O,E,R,z,V)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,u){this.setElement(t.util.getById(l),u),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,u){l&&l.length?t.util.enlivenObjects(l,function(r){u&&u(r)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(l){l||(l={});var u=this.getElement();this.width=l.width||u.naturalWidth||u.width||0,this.height=l.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),u=this._element.width,r=this._element.height,h=1,a=1,d=0,p=0,f=0,v=0,_,b=this.width,y=this.height,x={width:b,height:y};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(h=a=t.util.findScaleToFit(this._element,x),_=(b-u*h)/2,l.alignX==="Min"&&(d=-_),l.alignX==="Max"&&(d=_),_=(y-r*a)/2,l.alignY==="Min"&&(p=-_),l.alignY==="Max"&&(p=_)),l.meetOrSlice==="slice"&&(h=a=t.util.findScaleToCover(this._element,x),_=u-b/h,l.alignX==="Mid"&&(f=_/2),l.alignX==="Max"&&(f=_),_=r-y/a,l.alignY==="Mid"&&(v=_/2),l.alignY==="Max"&&(v=_),u=b/h,r=y/a)):(h=b/u,a=y/r),{width:u,height:r,scaleX:h,scaleY:a,offsetLeft:d,offsetTop:p,cropX:f,cropY:v}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,u){var r=t.util.object.clone(l);t.util.loadImage(r.src,function(h,a){if(a){u&&u(null,!0);return}t.Image.prototype._initFilters.call(r,r.filters,function(d){r.filters=d||[],t.Image.prototype._initFilters.call(r,[r.resizeFilter],function(p){r.resizeFilter=p[0],t.util.enlivenObjectEnlivables(r,r,function(){var f=new t.Image(h,r);u(f,!1)})})})},null,r.crossOrigin)},t.Image.fromURL=function(l,u,r){t.util.loadImage(l,function(h,a){u&&u(new t.Image(h,r),a)},null,r&&r.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,u,r){var h=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(h["xlink:href"],u,n(r?t.util.object.clone(r):{},h))}}(i),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var o=this.angle%360;return o>0?Math.round((o-1)/90)*90:Math.round(o/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(o){o=o||{};var n=function(){},l=o.onComplete||n,u=o.onChange||n,r=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(h){r.rotate(h),u()},onComplete:function(){r.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(o){return o.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(o){return o.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function o(l,u){var r="precision "+u+` float;
void main(){}`,h=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(h,r),l.compileShader(h),!!l.getShaderParameter(h,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),r=u.getContext("webgl")||u.getContext("experimental-webgl"),h=!1;if(r){t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),h=t.maxTextureSize>=l;for(var a=["highp","mediump","lowp"],d=0;d<3;d++)if(o(r,a[d])){t.webGlPrecision=a[d];break}}return this.isSupported=h,h},t.WebglFilterBackend=n;function n(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}n.prototype={tileSize:2048,resources:{},setupGLContext:function(l,u){this.dispose(),this.createWebGLCanvas(l,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,u)},chooseFastestCopyGLTo2DMethod:function(l,u){var r=typeof window.performance<"u",h;try{new ImageData(1,1),h=!0}catch{h=!1}var a=typeof ArrayBuffer<"u",d=typeof Uint8ClampedArray<"u";if(r&&h&&a&&d){var p=t.util.createCanvasElement(),f=new ArrayBuffer(l*u*4);if(t.forceGLPutImageData){this.imageBuffer=f,this.copyGLTo2D=m;return}var v={imageBuffer:f,destinationWidth:l,destinationHeight:u,targetCanvas:p},_,b,y;p.width=l,p.height=u,_=window.performance.now(),g.call(v,this.gl,v),b=window.performance.now()-_,_=window.performance.now(),m.call(v,this.gl,v),y=window.performance.now()-_,b>y?(this.imageBuffer=f,this.copyGLTo2D=m):this.copyGLTo2D=g}},createWebGLCanvas:function(l,u){var r=t.util.createCanvasElement();r.width=l,r.height=u;var h={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},a=r.getContext("webgl",h);a||(a=r.getContext("experimental-webgl",h)),a&&(a.clearColor(0,0,0,0),this.canvas=r,this.gl=a)},applyFilters:function(l,u,r,h,a,d){var p=this.gl,f;d&&(f=this.getCachedTexture(d,u));var v={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:r,sourceHeight:h,destinationWidth:r,destinationHeight:h,context:p,sourceTexture:this.createTexture(p,r,h,!f&&u),targetTexture:this.createTexture(p,r,h),originalTexture:f||this.createTexture(p,r,h,!f&&u),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:a},_=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,_),l.forEach(function(b){b&&b.applyTo(v)}),c(v),this.copyGLTo2D(p,v),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(v.sourceTexture),p.deleteTexture(v.targetTexture),p.deleteFramebuffer(_),a.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,u,r,h,a){var d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,a||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,a||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),h?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,h):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,u,r,0,l.RGBA,l.UNSIGNED_BYTE,null),d},getCachedTexture:function(l,u){if(this.textureCache[l])return this.textureCache[l];var r=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[l]=r,r},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:g,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,u={renderer:"",vendor:""};if(!l)return u;var r=l.getExtension("WEBGL_debug_renderer_info");if(r){var h=l.getParameter(r.UNMASKED_RENDERER_WEBGL),a=l.getParameter(r.UNMASKED_VENDOR_WEBGL);h&&(u.renderer=h.toLowerCase()),a&&(u.vendor=a.toLowerCase())}return this.gpuInfo=u,u}}}();function c(o){var n=o.targetCanvas,l=n.width,u=n.height,r=o.destinationWidth,h=o.destinationHeight;(l!==r||u!==h)&&(n.width=r,n.height=h)}function g(o,n){var l=o.canvas,u=n.targetCanvas,r=u.getContext("2d");r.translate(0,u.height),r.scale(1,-1);var h=l.height-u.height;r.drawImage(l,0,h,u.width,u.height,0,0,u.width,u.height)}function m(o,n){var l=n.targetCanvas,u=l.getContext("2d"),r=n.destinationWidth,h=n.destinationHeight,a=r*h*4,d=new Uint8Array(this.imageBuffer,0,a),p=new Uint8ClampedArray(this.imageBuffer,0,a);o.readPixels(0,0,r,h,o.RGBA,o.UNSIGNED_BYTE,d);var f=new ImageData(p,r,h);u.putImageData(f,0,0)}(function(){var o=function(){};t.Canvas2dFilterBackend=n;function n(){}n.prototype={evictCachesForKey:o,dispose:o,clearWebGLCaches:o,resources:{},applyFilters:function(l,u,r,h,a){var d=a.getContext("2d");d.drawImage(u,0,0,r,h);var p=d.getImageData(0,0,r,h),f=d.getImageData(0,0,r,h),v={sourceWidth:r,sourceHeight:h,imageData:p,originalEl:u,originalImageData:f,canvasEl:a,ctx:d,filterBackend:this};return l.forEach(function(_){_.applyTo(v)}),(v.imageData.width!==r||v.imageData.height!==h)&&(a.width=v.imageData.width,a.height=v.imageData.height),d.putImageData(v.imageData,0,0),v}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(o){o&&this.setOptions(o)},setOptions:function(o){for(var n in o)this[n]=o[n]},createProgram:function(o,n,l){n=n||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(n=n.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var u=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(u,l),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+o.getShaderInfoLog(u));var r=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(r,n),o.compileShader(r),!o.getShaderParameter(r,o.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+o.getShaderInfoLog(r));var h=o.createProgram();if(o.attachShader(h,u),o.attachShader(h,r),o.linkProgram(h),!o.getProgramParameter(h,o.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+o.getProgramInfoLog(h));var a=this.getAttributeLocations(o,h),d=this.getUniformLocations(o,h)||{};return d.uStepW=o.getUniformLocation(h,"uStepW"),d.uStepH=o.getUniformLocation(h,"uStepH"),{program:h,attributeLocations:a,uniformLocations:d}},getAttributeLocations:function(o,n){return{aPosition:o.getAttribLocation(n,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(o,n,l){var u=n.aPosition,r=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,r),o.enableVertexAttribArray(u),o.vertexAttribPointer(u,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,l,o.STATIC_DRAW)},_setupFrameBuffer:function(o){var n=o.context,l,u;o.passes>1?(l=o.destinationWidth,u=o.destinationHeight,(o.sourceWidth!==l||o.sourceHeight!==u)&&(n.deleteTexture(o.targetTexture),o.targetTexture=o.filterBackend.createTexture(n,l,u)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(o){o.passes--,o.pass++;var n=o.targetTexture;o.targetTexture=o.sourceTexture,o.sourceTexture=n},isNeutralState:function(){var o=this.mainParameter,n=t.Image.filters[this.type].prototype;if(o)if(Array.isArray(n[o])){for(var l=n[o].length;l--;)if(this[o][l]!==n[o][l])return!1;return!0}else return n[o]===this[o];else return!1},applyTo:function(o){o.webgl?(this._setupFrameBuffer(o),this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},retrieveShader:function(o){return o.programCache.hasOwnProperty(this.type)||(o.programCache[this.type]=this.createProgram(o.context)),o.programCache[this.type]},applyToWebGL:function(o){var n=o.context,l=this.retrieveShader(o);o.pass===0&&o.originalTexture?n.bindTexture(n.TEXTURE_2D,o.originalTexture):n.bindTexture(n.TEXTURE_2D,o.sourceTexture),n.useProgram(l.program),this.sendAttributeData(n,l.attributeLocations,o.aPosition),n.uniform1f(l.uniformLocations.uStepW,1/o.sourceWidth),n.uniform1f(l.uniformLocations.uStepH,1/o.sourceHeight),this.sendUniformData(n,l.uniformLocations),n.viewport(0,0,o.destinationWidth,o.destinationHeight),n.drawArrays(n.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(o,n,l){o.activeTexture(l),o.bindTexture(o.TEXTURE_2D,n),o.activeTexture(o.TEXTURE0)},unbindAdditionalTexture:function(o,n){o.activeTexture(n),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(o){this[this.mainParameter]=o},sendUniformData:function(){},createHelpLayer:function(o){if(!o.helpLayer){var n=document.createElement("canvas");n.width=o.sourceWidth,n.height=o.sourceHeight,o.helpLayer=n}},toObject:function(){var o={type:this.type},n=this.mainParameter;return n&&(o[n]=this[n]),o},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(o,n){var l=new t.Image.filters[o.type](o);return n&&n(l),l},function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.ColorMatrix=u(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var h=r.imageData,a=h.data,d=a.length,p=this.matrix,f,v,_,b,y,x=this.colorsOnly;for(y=0;y<d;y+=4)f=a[y],v=a[y+1],_=a[y+2],x?(a[y]=f*p[0]+v*p[1]+_*p[2]+p[4]*255,a[y+1]=f*p[5]+v*p[6]+_*p[7]+p[9]*255,a[y+2]=f*p[10]+v*p[11]+_*p[12]+p[14]*255):(b=a[y+3],a[y]=f*p[0]+v*p[1]+_*p[2]+b*p[3]+p[4]*255,a[y+1]=f*p[5]+v*p[6]+_*p[7]+b*p[8]+p[9]*255,a[y+2]=f*p[10]+v*p[11]+_*p[12]+b*p[13]+p[14]*255,a[y+3]=f*p[15]+v*p[16]+_*p[17]+b*p[18]+p[19]*255)},getUniformLocations:function(r,h){return{uColorMatrix:r.getUniformLocation(h,"uColorMatrix"),uConstants:r.getUniformLocation(h,"uConstants")}},sendUniformData:function(r,h){var a=this.matrix,d=[a[0],a[1],a[2],a[3],a[5],a[6],a[7],a[8],a[10],a[11],a[12],a[13],a[15],a[16],a[17],a[18]],p=[a[4],a[9],a[14],a[19]];r.uniformMatrix4fv(h.uColorMatrix,!1,d),r.uniform4fv(h.uConstants,p)}}),n.Image.filters.ColorMatrix.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Brightness=u(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var h=r.imageData,a=h.data,d,p=a.length,f=Math.round(this.brightness*255);for(d=0;d<p;d+=4)a[d]=a[d]+f,a[d+1]=a[d+1]+f,a[d+2]=a[d+2]+f}},getUniformLocations:function(r,h){return{uBrightness:r.getUniformLocation(h,"uBrightness")}},sendUniformData:function(r,h){r.uniform1f(h.uBrightness,this.brightness)}}),n.Image.filters.Brightness.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.Convolute=r(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(h){var a=Math.sqrt(this.matrix.length),d=this.type+"_"+a+"_"+(this.opaque?1:0),p=this.fragmentSource[d];return h.programCache.hasOwnProperty(d)||(h.programCache[d]=this.createProgram(h.context,p)),h.programCache[d]},applyTo2d:function(h){var a=h.imageData,d=a.data,p=this.matrix,f=Math.round(Math.sqrt(p.length)),v=Math.floor(f/2),_=a.width,b=a.height,y=h.ctx.createImageData(_,b),x=y.data,C=this.opaque?1:0,S,O,E,R,z,V,K,G,Y,J,et,nt,w;for(et=0;et<b;et++)for(J=0;J<_;J++){for(z=(et*_+J)*4,S=0,O=0,E=0,R=0,w=0;w<f;w++)for(nt=0;nt<f;nt++)K=et+w-v,V=J+nt-v,!(K<0||K>=b||V<0||V>=_)&&(G=(K*_+V)*4,Y=p[w*f+nt],S+=d[G]*Y,O+=d[G+1]*Y,E+=d[G+2]*Y,C||(R+=d[G+3]*Y));x[z]=S,x[z+1]=O,x[z+2]=E,C?x[z+3]=d[z+3]:x[z+3]=R}h.imageData=y},getUniformLocations:function(h,a){return{uMatrix:h.getUniformLocation(a,"uMatrix"),uOpaque:h.getUniformLocation(a,"uOpaque"),uHalfSize:h.getUniformLocation(a,"uHalfSize"),uSize:h.getUniformLocation(a,"uSize")}},sendUniformData:function(h,a){h.uniform1fv(a.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),n.Image.filters.Convolute.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Grayscale=u(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var h=r.imageData,a=h.data,d,p=a.length,f,v=this.mode;for(d=0;d<p;d+=4)v==="average"?f=(a[d]+a[d+1]+a[d+2])/3:v==="lightness"?f=(Math.min(a[d],a[d+1],a[d+2])+Math.max(a[d],a[d+1],a[d+2]))/2:v==="luminosity"&&(f=.21*a[d]+.72*a[d+1]+.07*a[d+2]),a[d]=f,a[d+1]=f,a[d+2]=f},retrieveShader:function(r){var h=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(h)){var a=this.fragmentSource[this.mode];r.programCache[h]=this.createProgram(r.context,a)}return r.programCache[h]},getUniformLocations:function(r,h){return{uMode:r.getUniformLocation(h,"uMode")}},sendUniformData:function(r,h){var a=1;r.uniform1i(h.uMode,a)},isNeutralState:function(){return!1}}),n.Image.filters.Grayscale.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Invert=u(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var h=r.imageData,a=h.data,d,p=a.length;for(d=0;d<p;d+=4)a[d]=255-a[d],a[d+1]=255-a[d+1],a[d+2]=255-a[d+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,h){return{uInvert:r.getUniformLocation(h,"uInvert")}},sendUniformData:function(r,h){r.uniform1i(h.uInvert,this.invert)}}),n.Image.filters.Invert.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.Noise=r(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(h){if(this.noise!==0){var a=h.imageData,d=a.data,p,f=d.length,v=this.noise,_;for(p=0,f=d.length;p<f;p+=4)_=(.5-Math.random())*v,d[p]+=_,d[p+1]+=_,d[p+2]+=_}},getUniformLocations:function(h,a){return{uNoise:h.getUniformLocation(a,"uNoise"),uSeed:h.getUniformLocation(a,"uSeed")}},sendUniformData:function(h,a){h.uniform1f(a.uNoise,this.noise/255),h.uniform1f(a.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),n.Image.filters.Noise.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Pixelate=u(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var h=r.imageData,a=h.data,d=h.height,p=h.width,f,v,_,b,y,x,C,S,O,E,R;for(v=0;v<d;v+=this.blocksize)for(_=0;_<p;_+=this.blocksize)for(f=v*4*p+_*4,b=a[f],y=a[f+1],x=a[f+2],C=a[f+3],E=Math.min(v+this.blocksize,d),R=Math.min(_+this.blocksize,p),S=v;S<E;S++)for(O=_;O<R;O++)f=S*4*p+O*4,a[f]=b,a[f+1]=y,a[f+2]=x,a[f+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,h){return{uBlocksize:r.getUniformLocation(h,"uBlocksize"),uStepW:r.getUniformLocation(h,"uStepW"),uStepH:r.getUniformLocation(h,"uStepH")}},sendUniformData:function(r,h){r.uniform1f(h.uBlocksize,this.blocksize)}}),n.Image.filters.Pixelate.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.extend,u=n.Image.filters,r=n.util.createClass;u.RemoveColor=r(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(h){var a=h.imageData,d=a.data,p,f=this.distance*255,v,_,b,y=new n.Color(this.color).getSource(),x=[y[0]-f,y[1]-f,y[2]-f],C=[y[0]+f,y[1]+f,y[2]+f];for(p=0;p<d.length;p+=4)v=d[p],_=d[p+1],b=d[p+2],v>x[0]&&_>x[1]&&b>x[2]&&v<C[0]&&_<C[1]&&b<C[2]&&(d[p+3]=0)},getUniformLocations:function(h,a){return{uLow:h.getUniformLocation(a,"uLow"),uHigh:h.getUniformLocation(a,"uHigh")}},sendUniformData:function(h,a){var d=new n.Color(this.color).getSource(),p=parseFloat(this.distance),f=[0+d[0]/255-p,0+d[1]/255-p,0+d[2]/255-p,1],v=[d[0]/255+p,d[1]/255+p,d[2]/255+p,1];h.uniform4fv(a.uLow,f),h.uniform4fv(a.uHigh,v)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),n.Image.filters.RemoveColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var h in r)l[h]=u(l.ColorMatrix,{type:h,matrix:r[h],mainParameter:!1,colorsOnly:!0}),n.Image.filters[h].fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric,l=n.Image.filters,u=n.util.createClass;l.BlendColor=u(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var h=this.type+"_"+this.mode,a;return r.programCache.hasOwnProperty(h)||(a=this.buildSource(this.mode),r.programCache[h]=this.createProgram(r.context,a)),r.programCache[h]},applyTo2d:function(r){var h=r.imageData,a=h.data,d=a.length,p,f,v,_,b,y,x,C=1-this.alpha;x=new n.Color(this.color).getSource(),p=x[0]*this.alpha,f=x[1]*this.alpha,v=x[2]*this.alpha;for(var S=0;S<d;S+=4)switch(_=a[S],b=a[S+1],y=a[S+2],this.mode){case"multiply":a[S]=_*p/255,a[S+1]=b*f/255,a[S+2]=y*v/255;break;case"screen":a[S]=255-(255-_)*(255-p)/255,a[S+1]=255-(255-b)*(255-f)/255,a[S+2]=255-(255-y)*(255-v)/255;break;case"add":a[S]=_+p,a[S+1]=b+f,a[S+2]=y+v;break;case"diff":case"difference":a[S]=Math.abs(_-p),a[S+1]=Math.abs(b-f),a[S+2]=Math.abs(y-v);break;case"subtract":a[S]=_-p,a[S+1]=b-f,a[S+2]=y-v;break;case"darken":a[S]=Math.min(_,p),a[S+1]=Math.min(b,f),a[S+2]=Math.min(y,v);break;case"lighten":a[S]=Math.max(_,p),a[S+1]=Math.max(b,f),a[S+2]=Math.max(y,v);break;case"overlay":a[S]=p<128?2*_*p/255:255-2*(255-_)*(255-p)/255,a[S+1]=f<128?2*b*f/255:255-2*(255-b)*(255-f)/255,a[S+2]=v<128?2*y*v/255:255-2*(255-y)*(255-v)/255;break;case"exclusion":a[S]=p+_-2*p*_/255,a[S+1]=f+b-2*f*b/255,a[S+2]=v+y-2*v*y/255;break;case"tint":a[S]=p+_*C,a[S+1]=f+b*C,a[S+2]=v+y*C}},getUniformLocations:function(r,h){return{uColor:r.getUniformLocation(h,"uColor")}},sendUniformData:function(r,h){var a=new n.Color(this.color).getSource();a[0]=this.alpha*a[0]/255,a[1]=this.alpha*a[1]/255,a[2]=this.alpha*a[2]/255,a[3]=this.alpha,r.uniform4fv(h.uColor,a)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendColor.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric,l=n.Image.filters,u=n.util.createClass;l.BlendImage=u(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var h=this.type+"_"+this.mode,a=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(h)||(r.programCache[h]=this.createProgram(r.context,a)),r.programCache[h]},applyToWebGL:function(r){var h=r.context,a=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(h,a,h.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(h,h.TEXTURE1)},createTexture:function(r,h){return r.getCachedTexture(h.cacheKey,h._element)},calculateMatrix:function(){var r=this.image,h=r._element.width,a=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/h,-r.top/a,1]},applyTo2d:function(r){var h=r.imageData,a=r.filterBackend.resources,d=h.data,p=d.length,f=h.width,v=h.height,_,b,y,x,C,S,O,E,R,z,V=this.image,K;a.blendImage||(a.blendImage=n.util.createCanvasElement()),R=a.blendImage,z=R.getContext("2d"),R.width!==f||R.height!==v?(R.width=f,R.height=v):z.clearRect(0,0,f,v),z.setTransform(V.scaleX,0,0,V.scaleY,V.left,V.top),z.drawImage(V._element,0,0,f,v),K=z.getImageData(0,0,f,v).data;for(var G=0;G<p;G+=4)switch(C=d[G],S=d[G+1],O=d[G+2],E=d[G+3],_=K[G],b=K[G+1],y=K[G+2],x=K[G+3],this.mode){case"multiply":d[G]=C*_/255,d[G+1]=S*b/255,d[G+2]=O*y/255,d[G+3]=E*x/255;break;case"mask":d[G+3]=x;break}},getUniformLocations:function(r,h){return{uTransformMatrix:r.getUniformLocation(h,"uTransformMatrix"),uImage:r.getUniformLocation(h,"uImage")}},sendUniformData:function(r,h){var a=this.calculateMatrix();r.uniform1i(h.uImage,1),r.uniformMatrix3fv(h.uTransformMatrix,!1,a)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendImage.fromObject=function(r,h){n.Image.fromObject(r.image,function(a){var d=n.util.object.clone(r);d.image=a,h(new n.Image.filters.BlendImage(d))})}}(i),function(o){var n=o.fabric||(o.fabric={}),l=Math.pow,u=Math.floor,r=Math.sqrt,h=Math.abs,a=Math.round,d=Math.sin,p=Math.ceil,f=n.Image.filters,v=n.util.createClass;f.Resize=v(f.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,b){return{uDelta:_.getUniformLocation(b,"uDelta"),uTaps:_.getUniformLocation(b,"uTaps")}},sendUniformData:function(_,b){_.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(b.uTaps,this.taps)},retrieveShader:function(_){var b=this.getFilterWindow(),y=this.type+"_"+b;if(!_.programCache.hasOwnProperty(y)){var x=this.generateShader(b);_.programCache[y]=this.createProgram(_.context,x)}return _.programCache[y]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,y=this.getFilterWindow(),x=new Array(y),C=1;C<=y;C++)x[C-1]=_(C*b);return x},generateShader:function(x){for(var b=new Array(x),y=this.fragmentSourceTOP,x,C=1;C<=x;C++)b[C-1]=C+".0 * uDelta";return y+="uniform float uTaps["+x+`];
`,y+=`void main() {
`,y+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,y+=`  float sum = 1.0;
`,b.forEach(function(S,O){y+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+O+`];
`,y+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+O+`];
`,y+="  sum += 2.0 * uTaps["+O+`];
`}),y+=`  gl_FragColor = color / sum;
`,y+="}",y},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(b){if(b>=_||b<=-_)return 0;if(b<11920929e-14&&b>-11920929e-14)return 1;b*=Math.PI;var y=b/_;return d(b)/b*d(y)/y}},applyTo2d:function(_){var b=_.imageData,y=this.scaleX,x=this.scaleY;this.rcpScaleX=1/y,this.rcpScaleY=1/x;var C=b.width,S=b.height,O=a(C*y),E=a(S*x),R;this.resizeType==="sliceHack"?R=this.sliceByTwo(_,C,S,O,E):this.resizeType==="hermite"?R=this.hermiteFastResize(_,C,S,O,E):this.resizeType==="bilinear"?R=this.bilinearFiltering(_,C,S,O,E):this.resizeType==="lanczos"&&(R=this.lanczosResize(_,C,S,O,E)),_.imageData=R},sliceByTwo:function(_,b,y,x,C){var S=_.imageData,O=.5,E=!1,R=!1,z=b*O,V=y*O,K=n.filterBackend.resources,G,Y,J=0,et=0,nt=b,w=0;for(K.sliceByTwo||(K.sliceByTwo=document.createElement("canvas")),G=K.sliceByTwo,(G.width<b*1.5||G.height<y)&&(G.width=b*1.5,G.height=y),Y=G.getContext("2d"),Y.clearRect(0,0,b*1.5,y),Y.putImageData(S,0,0),x=u(x),C=u(C);!E||!R;)b=z,y=V,x<u(z*O)?z=u(z*O):(z=x,E=!0),C<u(V*O)?V=u(V*O):(V=C,R=!0),Y.drawImage(G,J,et,b,y,nt,w,z,V),J=nt,et=w,w+=V;return Y.getImageData(J,et,x,C)},lanczosResize:function(_,b,y,x,C){function S(D){var M,I,k,T,A,L,H,B,$,Q,tt;for(w.x=(D+.5)*V,P.x=u(w.x),M=0;M<C;M++){for(w.y=(M+.5)*K,P.y=u(w.y),A=0,L=0,H=0,B=0,$=0,I=P.x-J;I<=P.x+J;I++)if(!(I<0||I>=b)){Q=u(1e3*h(I-w.x)),nt[Q]||(nt[Q]={});for(var j=P.y-et;j<=P.y+et;j++)j<0||j>=y||(tt=u(1e3*h(j-w.y)),nt[Q][tt]||(nt[Q][tt]=z(r(l(Q*G,2)+l(tt*Y,2))/1e3)),k=nt[Q][tt],k>0&&(T=(j*b+I)*4,A+=k,L+=k*O[T],H+=k*O[T+1],B+=k*O[T+2],$+=k*O[T+3]))}T=(M*x+D)*4,R[T]=L/A,R[T+1]=H/A,R[T+2]=B/A,R[T+3]=$/A}return++D<x?S(D):E}var O=_.imageData.data,E=_.ctx.createImageData(x,C),R=E.data,z=this.lanczosCreate(this.lanczosLobes),V=this.rcpScaleX,K=this.rcpScaleY,G=2/this.rcpScaleX,Y=2/this.rcpScaleY,J=p(V*this.lanczosLobes/2),et=p(K*this.lanczosLobes/2),nt={},w={},P={};return S(0)},bilinearFiltering:function(_,b,y,x,C){var S,O,E,R,z,V,K,G,Y,J,et,nt,w=0,P,D=this.rcpScaleX,M=this.rcpScaleY,I=4*(b-1),k=_.imageData,T=k.data,A=_.ctx.createImageData(x,C),L=A.data;for(K=0;K<C;K++)for(G=0;G<x;G++)for(z=u(D*G),V=u(M*K),Y=D*G-z,J=M*K-V,P=4*(V*b+z),et=0;et<4;et++)S=T[P+et],O=T[P+4+et],E=T[P+I+et],R=T[P+I+4+et],nt=S*(1-Y)*(1-J)+O*Y*(1-J)+E*J*(1-Y)+R*Y*J,L[w++]=nt;return A},hermiteFastResize:function(_,b,y,x,C){for(var S=this.rcpScaleX,O=this.rcpScaleY,E=p(S/2),R=p(O/2),z=_.imageData,V=z.data,K=_.ctx.createImageData(x,C),G=K.data,Y=0;Y<C;Y++)for(var J=0;J<x;J++){for(var et=(J+Y*x)*4,nt=0,w=0,P=0,D=0,M=0,I=0,k=0,T=(Y+.5)*O,A=u(Y*O);A<(Y+1)*O;A++)for(var L=h(T-(A+.5))/R,H=(J+.5)*S,B=L*L,$=u(J*S);$<(J+1)*S;$++){var Q=h(H-($+.5))/E,tt=r(B+Q*Q);tt>1&&tt<-1||(nt=2*tt*tt*tt-3*tt*tt+1,nt>0&&(Q=4*($+A*b),k+=nt*V[Q+3],P+=nt,V[Q+3]<255&&(nt=nt*V[Q+3]/250),D+=nt*V[Q],M+=nt*V[Q+1],I+=nt*V[Q+2],w+=nt))}G[et]=D/w,G[et+1]=M/w,G[et+2]=I/w,G[et+3]=k/P}return K},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),n.Image.filters.Resize.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Contrast=u(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var h=r.imageData,a,p,d=h.data,p=d.length,f=Math.floor(this.contrast*255),v=259*(f+255)/(255*(259-f));for(a=0;a<p;a+=4)d[a]=v*(d[a]-128)+128,d[a+1]=v*(d[a+1]-128)+128,d[a+2]=v*(d[a+2]-128)+128}},getUniformLocations:function(r,h){return{uContrast:r.getUniformLocation(h,"uContrast")}},sendUniformData:function(r,h){r.uniform1f(h.uContrast,this.contrast)}}),n.Image.filters.Contrast.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Saturation=u(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var h=r.imageData,a=h.data,d=a.length,p=-this.saturation,f,v;for(f=0;f<d;f+=4)v=Math.max(a[f],a[f+1],a[f+2]),a[f]+=v!==a[f]?(v-a[f])*p:0,a[f+1]+=v!==a[f+1]?(v-a[f+1])*p:0,a[f+2]+=v!==a[f+2]?(v-a[f+2])*p:0}},getUniformLocations:function(r,h){return{uSaturation:r.getUniformLocation(h,"uSaturation")}},sendUniformData:function(r,h){r.uniform1f(h.uSaturation,-this.saturation)}}),n.Image.filters.Saturation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Vibrance=u(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var h=r.imageData,a=h.data,d=a.length,p=-this.vibrance,f,v,_,b;for(f=0;f<d;f+=4)v=Math.max(a[f],a[f+1],a[f+2]),_=(a[f]+a[f+1]+a[f+2])/3,b=Math.abs(v-_)*2/255*p,a[f]+=v!==a[f]?(v-a[f])*b:0,a[f+1]+=v!==a[f+1]?(v-a[f+1])*b:0,a[f+2]+=v!==a[f+2]?(v-a[f+2])*b:0}},getUniformLocations:function(r,h){return{uVibrance:r.getUniformLocation(h,"uVibrance")}},sendUniformData:function(r,h){r.uniform1f(h.uVibrance,-this.vibrance)}}),n.Image.filters.Vibrance.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Blur=u(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var h=r.filterBackend.resources,a,d,p=r.imageData.width,f=r.imageData.height;h.blurLayer1||(h.blurLayer1=n.util.createCanvasElement(),h.blurLayer2=n.util.createCanvasElement()),a=h.blurLayer1,d=h.blurLayer2,(a.width!==p||a.height!==f)&&(d.width=a.width=p,d.height=a.height=f);var v=a.getContext("2d"),_=d.getContext("2d"),b=15,y,x,C,S,O=this.blur*.06*.5;for(v.putImageData(r.imageData,0,0),_.clearRect(0,0,p,f),S=-b;S<=b;S++)y=(Math.random()-.5)/4,x=S/b,C=O*x*p+y,_.globalAlpha=1-Math.abs(x),_.drawImage(a,C,y),v.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);for(S=-b;S<=b;S++)y=(Math.random()-.5)/4,x=S/b,C=O*x*f+y,_.globalAlpha=1-Math.abs(x),_.drawImage(a,y,C),v.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);r.ctx.drawImage(a,0,0);var E=r.ctx.getImageData(0,0,a.width,a.height);return v.globalAlpha=1,v.clearRect(0,0,a.width,a.height),E},getUniformLocations:function(r,h){return{delta:r.getUniformLocation(h,"uDelta")}},sendUniformData:function(r,h){var a=this.chooseRightDelta();r.uniform2fv(h.delta,a)},chooseRightDelta:function(){var r=1,h=[0,0],a;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),a=r*this.blur*.12,this.horizontal?h[0]=a:h[1]=a,h}}),l.Blur.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Gamma=u(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var h=r.imageData,a=h.data,d=this.gamma,p=a.length,f=1/d[0],v=1/d[1],_=1/d[2],b;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),b=0,p=256;b<p;b++)this.rVals[b]=Math.pow(b/255,f)*255,this.gVals[b]=Math.pow(b/255,v)*255,this.bVals[b]=Math.pow(b/255,_)*255;for(b=0,p=a.length;b<p;b+=4)a[b]=this.rVals[a[b]],a[b+1]=this.gVals[a[b+1]],a[b+2]=this.bVals[a[b+2]]},getUniformLocations:function(r,h){return{uGamma:r.getUniformLocation(h,"uGamma")}},sendUniformData:function(r,h){r.uniform3fv(h.uGamma,this.gamma)}}),n.Image.filters.Gamma.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.Composed=u(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(h){h.applyTo(r)})},toObject:function(){return n.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),n.Image.filters.Composed.fromObject=function(r,h){var a=r.subFilters||[],d=a.map(function(f){return new n.Image.filters[f.type](f)}),p=new n.Image.filters.Composed({subFilters:d});return h&&h(p),p}}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.Image.filters,u=n.util.createClass;l.HueRotation=u(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,h=n.util.cos(r),a=n.util.sin(r),d=1/3,p=Math.sqrt(d)*a,f=1-h;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=h+f/3,this.matrix[1]=d*f-p,this.matrix[2]=d*f+p,this.matrix[5]=d*f+p,this.matrix[6]=h+d*f,this.matrix[7]=d*f-p,this.matrix[10]=d*f-p,this.matrix[11]=d*f+p,this.matrix[12]=h+d*f},isNeutralState:function(r){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,r)}}),n.Image.filters.HueRotation.fromObject=n.Image.filters.BaseFilter.fromObject}(i),function(o){var n=o.fabric||(o.fabric={}),l=n.util.object.clone;if(n.Text){n.warn("fabric.Text is already defined");return}var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");n.Text=n.util.createClass(n.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:n.Object.prototype.stateProperties.concat(u),cacheProperties:n.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,h){this.styles=h?h.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",h),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=n.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return n._measuringContext||(n._measuringContext=this.canvas&&this.canvas.contextCache||n.util.createCanvasElement().getContext("2d")),n._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,h,a,d,p,f,v,_=0,b=this._textLines.length;_<b;_++)if(!(this.textAlign!=="justify"&&(_===b-1||this.isEndOfWrapping(_)))&&(d=0,p=this._textLines[_],h=this.getLineWidth(_),h<this.width&&(v=this.textLines[_].match(this._reSpacesAndTabs)))){a=v.length,r=(this.width-h)/a;for(var y=0,x=p.length;y<=x;y++)f=this.__charBounds[_][y],this._reSpaceAndTab.test(p[y])?(f.width+=r,f.kernedWidth+=r,f.left+=d,d+=r):f.left+=d}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),h=this.fontSize;return r.width+=h*r.zoomX,r.height+=h*r.zoomY,r},_render:function(r){var h=this.path;h&&!h.isNotVisible()&&h._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,h,a){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(h,a)},calcTextWidth:function(){for(var r=this.getLineWidth(0),h=1,a=this._textLines.length;h<a;h++){var d=this.getLineWidth(h);d>r&&(r=d)}return r},_renderTextLine:function(r,h,a,d,p,f){this._renderChars(r,h,a,d,p,f)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var h,a,d=r.fillStyle,p,f,v=this._getLeftOffset(),_=this._getTopOffset(),b=0,y=0,x,C,S=this.path,O,E=0,R=this._textLines.length;E<R;E++){if(h=this.getHeightOfLine(E),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",E)){_+=h;continue}p=this._textLines[E],a=this._getLineLeftOffset(E),y=0,b=0,f=this.getValueOfPropertyAt(E,0,"textBackgroundColor");for(var z=0,V=p.length;z<V;z++)x=this.__charBounds[E][z],C=this.getValueOfPropertyAt(E,z,"textBackgroundColor"),S?(r.save(),r.translate(x.renderLeft,x.renderTop),r.rotate(x.angle),r.fillStyle=C,C&&r.fillRect(-x.width/2,-h/this.lineHeight*(1-this._fontSizeFraction),x.width,h/this.lineHeight),r.restore()):C!==f?(O=v+a+b,this.direction==="rtl"&&(O=this.width-O-y),r.fillStyle=f,f&&r.fillRect(O,_,y,h/this.lineHeight),b=x.left,y=x.width,f=C):y+=x.kernedWidth;C&&!S&&(O=v+a+b,this.direction==="rtl"&&(O=this.width-O-y),r.fillStyle=C,r.fillRect(O,_,y,h/this.lineHeight)),_+=h}r.fillStyle=d,this._removeShadow(r)}},getFontCache:function(r){var h=r.fontFamily.toLowerCase();n.charWidthsCache[h]||(n.charWidthsCache[h]={});var a=n.charWidthsCache[h],d=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return a[d]||(a[d]={}),a[d]},_measureChar:function(r,h,a,d){var p=this.getFontCache(h),f=this._getFontDeclaration(h),v=this._getFontDeclaration(d),_=a+r,b=f===v,y,x,C,S=h.fontSize/this.CACHE_FONT_SIZE,O;if(a&&p[a]!==void 0&&(C=p[a]),p[r]!==void 0&&(O=y=p[r]),b&&p[_]!==void 0&&(x=p[_],O=x-C),y===void 0||C===void 0||x===void 0){var E=this.getMeasuringContext();this._setTextStyles(E,h,!0)}return y===void 0&&(O=y=E.measureText(r).width,p[r]=y),C===void 0&&b&&a&&(C=E.measureText(a).width,p[a]=C),b&&x===void 0&&(x=E.measureText(_).width,p[_]=x,O=x-C),{width:y*S,kernedWidth:O*S}},getHeightOfChar:function(r,h){return this.getValueOfPropertyAt(r,h,"fontSize")},measureLine:function(r){var h=this._measureLine(r);return this.charSpacing!==0&&(h.width-=this._getWidthOfCharSpacing()),h.width<0&&(h.width=0),h},_measureLine:function(r){var h=0,a,d,p=this._textLines[r],f,v,_=0,b=new Array(p.length),y=0,x,C,S=this.path,O=this.pathSide==="right";for(this.__charBounds[r]=b,a=0;a<p.length;a++)d=p[a],v=this._getGraphemeBox(d,r,a,f),b[a]=v,h+=v.kernedWidth,f=d;if(b[a]={left:v?v.left+v.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(C=S.segmentsInfo[S.segmentsInfo.length-1].length,x=n.util.getPointOnPath(S.path,0,S.segmentsInfo),x.x+=S.pathOffset.x,x.y+=S.pathOffset.y,this.textAlign){case"left":y=O?C-h:0;break;case"center":y=(C-h)/2;break;case"right":y=O?0:C-h;break}for(y+=this.pathStartOffset*(O?-1:1),a=O?p.length-1:0;O?a>=0:a<p.length;O?a--:a++)v=b[a],y>C?y%=C:y<0&&(y+=C),this._setGraphemeOnPath(y,v,x),y+=v.kernedWidth}return{width:h,numOfSpaces:_}},_setGraphemeOnPath:function(r,h,a){var d=r+h.kernedWidth/2,p=this.path,f=n.util.getPointOnPath(p.path,d,p.segmentsInfo);h.renderLeft=f.x-a.x,h.renderTop=f.y-a.y,h.angle=f.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,h,a,d,p){var f=this.getCompleteStyleDeclaration(h,a),v=d?this.getCompleteStyleDeclaration(h,a-1):{},_=this._measureChar(r,f,d,v),b=_.kernedWidth,y=_.width,x;this.charSpacing!==0&&(x=this._getWidthOfCharSpacing(),y+=x,b+=x);var C={width:y,left:0,height:f.fontSize,kernedWidth:b,deltaY:f.deltaY};if(a>0&&!p){var S=this.__charBounds[h][a-1];C.left=S.left+S.width+_.kernedWidth-_.width}return C},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var h=this._textLines[r],a=this.getHeightOfChar(r,0),d=1,p=h.length;d<p;d++)a=Math.max(this.getHeightOfChar(r,d),a);return this.__lineHeights[r]=a*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,h=0,a=0,d=this._textLines.length;a<d;a++)r=this.getHeightOfLine(a),h+=a===d-1?r/this.lineHeight:r;return h},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,h){r.save();for(var a=0,d=this._getLeftOffset(),p=this._getTopOffset(),f=0,v=this._textLines.length;f<v;f++){var _=this.getHeightOfLine(f),b=_/this.lineHeight,y=this._getLineLeftOffset(f);this._renderTextLine(h,r,this._textLines[f],d+y,p+a+b,f),a+=_}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,h,a,d,p,f){var v=this.getHeightOfLine(f),_=this.textAlign.indexOf("justify")!==-1,b,y,x="",C,S=0,O,E=this.path,R=!_&&this.charSpacing===0&&this.isEmptyStyles(f)&&!E,z=this.direction==="ltr",V=this.direction==="ltr"?1:-1,K,G=h.canvas.getAttribute("dir");if(h.save(),G!==this.direction&&(h.canvas.setAttribute("dir",z?"ltr":"rtl"),h.direction=z?"ltr":"rtl",h.textAlign=z?"left":"right"),p-=v*this._fontSizeFraction/this.lineHeight,R){this._renderChar(r,h,f,0,a.join(""),d,p,v),h.restore();return}for(var Y=0,J=a.length-1;Y<=J;Y++)O=Y===J||this.charSpacing||E,x+=a[Y],C=this.__charBounds[f][Y],S===0?(d+=V*(C.kernedWidth-C.width),S+=C.width):S+=C.kernedWidth,_&&!O&&this._reSpaceAndTab.test(a[Y])&&(O=!0),O||(b=b||this.getCompleteStyleDeclaration(f,Y),y=this.getCompleteStyleDeclaration(f,Y+1),O=n.util.hasStyleChanged(b,y,!1)),O&&(E?(h.save(),h.translate(C.renderLeft,C.renderTop),h.rotate(C.angle),this._renderChar(r,h,f,Y,x,-S/2,0,v),h.restore()):(K=d,this._renderChar(r,h,f,Y,x,K,p,v)),x="",b=y,d+=V*S,S=0);h.restore()},_applyPatternGradientTransformText:function(r){var h=n.util.createCanvasElement(),a,d=this.width+this.strokeWidth,p=this.height+this.strokeWidth;return h.width=d,h.height=p,a=h.getContext("2d"),a.beginPath(),a.moveTo(0,0),a.lineTo(d,0),a.lineTo(d,p),a.lineTo(0,p),a.closePath(),a.translate(d/2,p/2),a.fillStyle=r.toLive(a),this._applyPatternGradientTransform(a,r),a.fill(),a.createPattern(h,"no-repeat")},handleFiller:function(r,h,a){var d,p;return a.toLive?a.gradientUnits==="percentage"||a.gradientTransform||a.patternTransform?(d=-this.width/2,p=-this.height/2,r.translate(d,p),r[h]=this._applyPatternGradientTransformText(a),{offsetX:d,offsetY:p}):(r[h]=a.toLive(r,this),this._applyPatternGradientTransform(r,a)):(r[h]=a,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,h){return r.lineWidth=h.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",h.stroke)},_setFillStyles:function(r,h){return this.handleFiller(r,"fillStyle",h.fill)},_renderChar:function(r,h,a,d,p,f,v){var _=this._getStyleDeclaration(a,d),b=this.getCompleteStyleDeclaration(a,d),y=r==="fillText"&&b.fill,x=r==="strokeText"&&b.stroke&&b.strokeWidth,C,S;!x&&!y||(h.save(),y&&(C=this._setFillStyles(h,b)),x&&(S=this._setStrokeStyles(h,b)),h.font=this._getFontDeclaration(b),_&&_.textBackgroundColor&&this._removeShadow(h),_&&_.deltaY&&(v+=_.deltaY),y&&h.fillText(p,f-C.offsetX,v-C.offsetY),x&&h.strokeText(p,f-S.offsetX,v-S.offsetY),h.restore())},setSuperscript:function(r,h){return this._setScript(r,h,this.superscript)},setSubscript:function(r,h){return this._setScript(r,h,this.subscript)},_setScript:function(r,h,a){var d=this.get2DCursorLocation(r,!0),p=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),f=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),v={fontSize:p*a.size,deltaY:f+p*a.baseline};return this.setSelectionStyles(v,r,h),this},_getLineLeftOffset:function(r){var h=this.getLineWidth(r),a=this.width-h,d=this.textAlign,p=this.direction,v,f=0,v=this.isEndOfWrapping(r);return d==="justify"||d==="justify-center"&&!v||d==="justify-right"&&!v||d==="justify-left"&&!v?0:(d==="center"&&(f=a/2),d==="right"&&(f=a),d==="justify-center"&&(f=a/2),d==="justify-right"&&(f=a),p==="rtl"&&(f-=a),f)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var h=this.measureLine(r),a=h.width;return this.__lineWidths[r]=a,a},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,h,a){var d=this._getStyleDeclaration(r,h);return d&&typeof d[a]<"u"?d[a]:this[a]},_renderTextDecoration:function(r,h){if(!(!this[h]&&!this.styleHas(h))){for(var a,d,p,f,v,_,b,y,x=this._getLeftOffset(),C=this._getTopOffset(),S,O,E,R,z,V,K,G,Y=this.path,J=this._getWidthOfCharSpacing(),et=this.offsets[h],nt=0,w=this._textLines.length;nt<w;nt++){if(a=this.getHeightOfLine(nt),!this[h]&&!this.styleHas(h,nt)){C+=a;continue}b=this._textLines[nt],V=a/this.lineHeight,f=this._getLineLeftOffset(nt),O=0,E=0,y=this.getValueOfPropertyAt(nt,0,h),G=this.getValueOfPropertyAt(nt,0,"fill"),S=C+V*(1-this._fontSizeFraction),d=this.getHeightOfChar(nt,0),v=this.getValueOfPropertyAt(nt,0,"deltaY");for(var P=0,D=b.length;P<D;P++)if(R=this.__charBounds[nt][P],z=this.getValueOfPropertyAt(nt,P,h),K=this.getValueOfPropertyAt(nt,P,"fill"),p=this.getHeightOfChar(nt,P),_=this.getValueOfPropertyAt(nt,P,"deltaY"),Y&&z&&K)r.save(),r.fillStyle=G,r.translate(R.renderLeft,R.renderTop),r.rotate(R.angle),r.fillRect(-R.kernedWidth/2,et*p+_,R.kernedWidth,this.fontSize/15),r.restore();else if((z!==y||K!==G||p!==d||_!==v)&&E>0){var M=x+f+O;this.direction==="rtl"&&(M=this.width-M-E),y&&G&&(r.fillStyle=G,r.fillRect(M,S+et*d+v,E,this.fontSize/15)),O=R.left,E=R.width,y=z,G=K,d=p,v=_}else E+=R.kernedWidth;var M=x+f+O;this.direction==="rtl"&&(M=this.width-M-E),r.fillStyle=K,z&&K&&r.fillRect(M,S+et*d+v,E-J,this.fontSize/15),C+=a}this._removeShadow(r)}},_getFontDeclaration:function(r,h){var a=r||this,d=this.fontFamily,p=n.Text.genericFonts.indexOf(d.toLowerCase())>-1,f=d===void 0||d.indexOf("'")>-1||d.indexOf(",")>-1||d.indexOf('"')>-1||p?a.fontFamily:'"'+a.fontFamily+'"';return[n.isLikelyNode?a.fontWeight:a.fontStyle,n.isLikelyNode?a.fontStyle:a.fontWeight,h?this.CACHE_FONT_SIZE+"px":a.fontSize+"px",f].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var h=r.split(this._reNewline),a=new Array(h.length),d=[`
`],p=[],f=0;f<h.length;f++)a[f]=n.util.string.graphemeSplit(h[f]),p=p.concat(a[f],d);return p.pop(),{_unwrappedLines:a,lines:h,graphemeText:p,graphemeLines:a}},toObject:function(r){var h=u.concat(r),a=this.callSuper("toObject",h);return a.styles=n.util.stylesToArray(this.styles,this.text),a.path&&(a.path=this.path.toObject()),a},set:function(r,h){this.callSuper("set",r,h);var a=!1,d=!1;if(typeof r=="object")for(var p in r)p==="path"&&this.setPathInfo(),a=a||this._dimensionAffectingProps.indexOf(p)!==-1,d=d||p==="path";else a=this._dimensionAffectingProps.indexOf(r)!==-1,d=r==="path";return d&&this.setPathInfo(),a&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),n.Text.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),n.Text.DEFAULT_SVG_FONT_SIZE=16,n.Text.fromElement=function(r,h,a){if(!r)return h(null);var d=n.parseAttributes(r,n.Text.ATTRIBUTE_NAMES),p=d.textAnchor||"left";if(a=n.util.object.extend(a?l(a):{},d),a.top=a.top||0,a.left=a.left||0,d.textDecoration){var f=d.textDecoration;f.indexOf("underline")!==-1&&(a.underline=!0),f.indexOf("overline")!==-1&&(a.overline=!0),f.indexOf("line-through")!==-1&&(a.linethrough=!0),delete a.textDecoration}"dx"in d&&(a.left+=d.dx),"dy"in d&&(a.top+=d.dy),"fontSize"in a||(a.fontSize=n.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in r?v=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(v=r.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=a.strokeWidth;a.strokeWidth=0;var b=new n.Text(v,a),y=b.getScaledHeight()/b.height,x=(b.height+b.strokeWidth)*b.lineHeight-b.height,C=x*y,S=b.getScaledHeight()+C,O=0;p==="center"&&(O=b.getScaledWidth()/2),p==="right"&&(O=b.getScaledWidth()),b.set({left:b.left-O,top:b.top-(S-b.fontSize*(.07+b._fontSizeFraction))/b.lineHeight,strokeWidth:typeof _<"u"?_:1}),h(b)},n.Text.fromObject=function(r,h){var a=l(r),d=r.path;return delete a.path,n.Object._fromObject("Text",a,function(p){p.styles=n.util.stylesFromArray(r.styles,r.text),d?n.Object._fromObject("Path",d,function(f){p.set("path",f),h(p)},"path"):h(p)},"text")},n.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],n.util.createAccessors&&n.util.createAccessors(n.Text)}(i),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(o){if(!this.styles||typeof o<"u"&&!this.styles[o])return!0;var n=typeof o>"u"?this.styles:{line:this.styles[o]};for(var l in n)for(var u in n[l])for(var r in n[l][u])return!1;return!0},styleHas:function(o,n){if(!this.styles||!o||o===""||typeof n<"u"&&!this.styles[n])return!1;var l=typeof n>"u"?this.styles:{0:this.styles[n]};for(var u in l)for(var r in l[u])if(typeof l[u][r][o]<"u")return!0;return!1},cleanStyle:function(o){if(!this.styles||!o||o==="")return!1;var n=this.styles,l=0,u,r,h=!0,a=0,d;for(var p in n){u=0;for(var f in n[p]){var d=n[p][f],v=d.hasOwnProperty(o);l++,v?(r?d[o]!==r&&(h=!1):r=d[o],d[o]===this[o]&&delete d[o]):h=!1,Object.keys(d).length!==0?u++:delete n[p][f]}u===0&&delete n[p]}for(var _=0;_<this._textLines.length;_++)a+=this._textLines[_].length;h&&l===a&&(this[o]=r,this.removeStyle(o))},removeStyle:function(o){if(!(!this.styles||!o||o==="")){var n=this.styles,l,u,r;for(u in n){l=n[u];for(r in l)delete l[r][o],Object.keys(l[r]).length===0&&delete l[r];Object.keys(l).length===0&&delete n[u]}}},_extendStyles:function(o,n){var l=this.get2DCursorLocation(o);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),n)},get2DCursorLocation:function(o,n){typeof o>"u"&&(o=this.selectionStart);for(var l=n?this._unwrappedTextLines:this._textLines,u=l.length,r=0;r<u;r++){if(o<=l[r].length)return{lineIndex:r,charIndex:o};o-=l[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:l[r-1].length<o?l[r-1].length:o}},getSelectionStyles:function(o,n,l){typeof o>"u"&&(o=this.selectionStart||0),typeof n>"u"&&(n=this.selectionEnd||o);for(var u=[],r=o;r<n;r++)u.push(this.getStyleAtPosition(r,l));return u},getStyleAtPosition:function(o,n){var l=this.get2DCursorLocation(o),u=n?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return u||{}},setSelectionStyles:function(o,n,l){typeof n>"u"&&(n=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||n);for(var u=n;u<l;u++)this._extendStyles(u,o);return this._forceClearCache=!0,this},_getStyleDeclaration:function(o,n){var l=this.styles&&this.styles[o];return l?l[n]:null},getCompleteStyleDeclaration:function(o,n){for(var l=this._getStyleDeclaration(o,n)||{},u={},r,h=0;h<this._styleProperties.length;h++)r=this._styleProperties[h],u[r]=typeof l[r]>"u"?this[r]:l[r];return u},_setStyleDeclaration:function(o,n,l){this.styles[o][n]=l},_deleteStyleDeclaration:function(o,n){delete this.styles[o][n]},_getLineStyle:function(o){return!!this.styles[o]},_setLineStyle:function(o){this.styles[o]={}},_deleteLineStyle:function(o){delete this.styles[o]}})}(),function(){function o(n){n.textDecoration&&(n.textDecoration.indexOf("underline")>-1&&(n.underline=!0),n.textDecoration.indexOf("line-through")>-1&&(n.linethrough=!0),n.textDecoration.indexOf("overline")>-1&&(n.overline=!0),delete n.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(n,l){this.callSuper("initialize",n,l),this.initBehavior()},setSelectionStart:function(n){n=Math.max(n,0),this._updateAndFire("selectionStart",n)},setSelectionEnd:function(n){n=Math.min(n,this.text.length),this._updateAndFire("selectionEnd",n)},_updateAndFire:function(n,l){this[n]!==l&&(this._fireSelectionChanged(),this[n]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(n){this.clearContextTop(),this.callSuper("render",n),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(n){this.callSuper("_render",n)},clearContextTop:function(n){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,u=this.canvas.viewportTransform;l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(l),this._clearTextArea(l),n||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var n=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(n,l):this.renderSelection(n,l),l.restore()}},_clearTextArea:function(n){var l=this.width+4,u=this.height+4;n.clearRect(-l/2,-u/2,l,u)},_getCursorBoundaries:function(n){typeof n>"u"&&(n=this.selectionStart);var l=this._getLeftOffset(),u=this._getTopOffset(),r=this._getCursorBoundariesOffsets(n);return{left:l,top:u,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(n){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,u,r,h=0,a=0,d,p=this.get2DCursorLocation(n);r=p.charIndex,u=p.lineIndex;for(var f=0;f<u;f++)h+=this.getHeightOfLine(f);l=this._getLineLeftOffset(u);var v=this.__charBounds[u][r];return v&&(a=v.left),this.charSpacing!==0&&r===this._textLines[u].length&&(a-=this._getWidthOfCharSpacing()),d={top:h,left:l+(a>0?a:0)},this.direction==="rtl"&&(d.left*=-1),this.cursorOffsetCache=d,this.cursorOffsetCache},renderCursor:function(n,l){var u=this.get2DCursorLocation(),r=u.lineIndex,h=u.charIndex>0?u.charIndex-1:0,a=this.getValueOfPropertyAt(r,h,"fontSize"),d=this.scaleX*this.canvas.getZoom(),p=this.cursorWidth/d,f=n.topOffset,v=this.getValueOfPropertyAt(r,h,"deltaY");f+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-a*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(n,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,h,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(n.left+n.leftOffset-p/2,f+n.top+v,p,a)},renderSelection:function(n,l){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,h=this.textAlign.indexOf("justify")!==-1,a=this.get2DCursorLocation(u),d=this.get2DCursorLocation(r),p=a.lineIndex,f=d.lineIndex,v=a.charIndex<0?0:a.charIndex,_=d.charIndex<0?0:d.charIndex,b=p;b<=f;b++){var y=this._getLineLeftOffset(b)||0,x=this.getHeightOfLine(b),C=0,S=0,O=0;if(b===p&&(S=this.__charBounds[p][v].left),b>=p&&b<f)O=h&&!this.isEndOfWrapping(b)?this.width:this.getLineWidth(b)||5;else if(b===f)if(_===0)O=this.__charBounds[f][_].left;else{var E=this._getWidthOfCharSpacing();O=this.__charBounds[f][_-1].left+this.__charBounds[f][_-1].width-E}C=x,(this.lineHeight<1||b===f&&this.lineHeight>1)&&(x/=this.lineHeight);var R=n.left+y+S,z=O-S,V=x,K=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",V=1,K=x):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(R=this.width-R-z),l.fillRect(R,n.top+n.topOffset+K,z,V),n.topOffset+=C}},getCurrentCharFontSize:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fontSize")},getCurrentCharColor:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fill")},_getCurrentCharIndex:function(){var n=this.get2DCursorLocation(this.selectionStart,!0),l=n.charIndex>0?n.charIndex-1:0;return{l:n.lineIndex,c:l}}}),t.IText.fromObject=function(n,l){var u=t.util.stylesFromArray(n.styles,n.text),r=Object.assign({},n,{styles:u});if(o(r),r.styles)for(var h in r.styles)for(var a in r.styles[h])o(r.styles[h][a]);t.Object._fromObject("IText",r,l,"text")}}(),function(){var o=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var n=this;this.on("added",function(){var l=n.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,n._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){var l=n.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,n),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,n._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(n){n._mouseUpITextHandler=function(){n._iTextInstances&&n._iTextInstances.forEach(function(l){l.__isMousedown=!1})},n.on("mouse:up",n._mouseUpITextHandler)},_removeCanvasHandlers:function(n){n.off("mouse:up",n._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,l,u,r){var h;return h={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",l,{duration:u,onComplete:function(){h.isAborted||n[r]()},onChange:function(){n.canvas&&n.selectionStart===n.selectionEnd&&n.renderCursorOrSelection()},abort:function(){return h.isAborted}}),h},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var l=this,u=n?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},u)},abortCursorAnimation:function(){var n=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,n&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(n){var l=0,u=n-1;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u--;for(;/\S/.test(this._text[u])&&u>-1;)l++,u--;return n-l},findWordBoundaryRight:function(n){var l=0,u=n;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u++;for(;/\S/.test(this._text[u])&&u<this._text.length;)l++,u++;return n+l},findLineBoundaryLeft:function(n){for(var l=0,u=n-1;!/\n/.test(this._text[u])&&u>-1;)l++,u--;return n-l},findLineBoundaryRight:function(n){for(var l=0,u=n;!/\n/.test(this._text[u])&&u<this._text.length;)l++,u++;return n+l},searchWordBoundary:function(n,l){for(var u=this._text,r=this._reSpace.test(u[n])?n-1:n,h=u[r],a=t.reNonWord;!a.test(h)&&r>0&&r<u.length;)r+=l,h=u[r];return a.test(h)&&(r+=l===1?0:1),r},selectWord:function(n){n=n||this.selectionStart;var l=this.searchWordBoundary(n,-1),u=this.searchWordBoundary(n,1);this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(n){n=n||this.selectionStart;var l=this.findLineBoundaryLeft(n),u=this.findLineBoundaryRight(n);return this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(n){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(n),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(n){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(n.e),u=this.selectionStart,r=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||u===r)&&(u===l||r===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==u||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(n,l,u){var r=u.slice(0,n),h=t.util.string.graphemeSplit(r).length;if(n===l)return{selectionStart:h,selectionEnd:h};var a=u.slice(n,l),d=t.util.string.graphemeSplit(a).length;return{selectionStart:h,selectionEnd:h+d}},fromGraphemeToStringSelection:function(n,l,u){var r=u.slice(0,n),h=r.join("").length;if(n===l)return{selectionStart:h,selectionEnd:h};var a=u.slice(n,l),d=a.join("").length;return{selectionStart:h,selectionEnd:h+d}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var n=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=n.selectionStart,this.hiddenTextarea.selectionEnd=n.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var n=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=n.selectionEnd,this.inCompositionMode||(this.selectionStart=n.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var n=this._calcTextareaPosition();this.hiddenTextarea.style.left=n.left,this.hiddenTextarea.style.top=n.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var n=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(n),u=this.get2DCursorLocation(n),r=u.lineIndex,h=u.charIndex,a=this.getValueOfPropertyAt(r,h,"fontSize")*this.lineHeight,d=l.leftOffset,p=this.calcTransformMatrix(),f={x:l.left+d,y:l.top+l.topOffset+a},v=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,b=_.width/v,y=_.height/v,x=b-a,C=y-a,S=_.clientWidth/b,O=_.clientHeight/y;return f=t.util.transformPoint(f,p),f=t.util.transformPoint(f,this.canvas.viewportTransform),f.x*=S,f.y*=O,f.x<0&&(f.x=0),f.x>x&&(f.x=x),f.y<0&&(f.y=0),f.y>C&&(f.y=C),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:f.x+"px",top:f.y+"px",fontSize:a+"px",charHeight:a}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var n=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),n&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),n&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},removeStyleFromTo:function(n,l){var u=this.get2DCursorLocation(n,!0),r=this.get2DCursorLocation(l,!0),h=u.lineIndex,a=u.charIndex,d=r.lineIndex,p=r.charIndex,f,v;if(h!==d){if(this.styles[h])for(f=a;f<this._unwrappedTextLines[h].length;f++)delete this.styles[h][f];if(this.styles[d])for(f=p;f<this._unwrappedTextLines[d].length;f++)v=this.styles[d][f],v&&(this.styles[h]||(this.styles[h]={}),this.styles[h][a+f-p]=v);for(f=h+1;f<=d;f++)delete this.styles[f];this.shiftLineStyles(d,h-d)}else if(this.styles[h]){v=this.styles[h];var _=p-a,b,y;for(f=a;f<p;f++)delete v[f];for(y in this.styles[h])b=parseInt(y,10),b>=p&&(v[b-_]=v[y],delete v[y])}},shiftLineStyles:function(n,l){var u=o(this.styles);for(var r in this.styles){var h=parseInt(r,10);h>n&&(this.styles[h+l]=u[h],u[h-l]||delete this.styles[h])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(n,l,u,r){var h,a={},d=!1,p=this._unwrappedTextLines[n].length===l;u||(u=1),this.shiftLineStyles(n,u),this.styles[n]&&(h=this.styles[n][l===0?l:l-1]);for(var f in this.styles[n]){var v=parseInt(f,10);v>=l&&(d=!0,a[v-l]=this.styles[n][f],p&&l===0||delete this.styles[n][f])}var _=!1;for(d&&!p&&(this.styles[n+u]=a,_=!0),_&&u--;u>0;)r&&r[u-1]?this.styles[n+u]={0:o(r[u-1])}:h?this.styles[n+u]={0:o(h)}:delete this.styles[n+u],u--;this._forceClearCache=!0},insertCharStyleObject:function(n,l,u,r){this.styles||(this.styles={});var h=this.styles[n],a=h?o(h):{};u||(u=1);for(var d in a){var p=parseInt(d,10);p>=l&&(h[p+u]=a[p],a[p-u]||delete h[p])}if(this._forceClearCache=!0,r){for(;u--;)Object.keys(r[u]).length&&(this.styles[n]||(this.styles[n]={}),this.styles[n][l+u]=o(r[u]));return}if(h)for(var f=h[l?l-1:1];f&&u--;)this.styles[n][l+u]=o(f)},insertNewStyleBlock:function(n,l,u){for(var r=this.get2DCursorLocation(l,!0),h=[0],a=0,d=0;d<n.length;d++)n[d]===`
`?(a++,h[a]=0):h[a]++;h[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,h[0],u),u=u&&u.slice(h[0]+1)),a&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+h[0],a);for(var d=1;d<a;d++)h[d]>0?this.insertCharStyleObject(r.lineIndex+d,0,h[d],u):u&&this.styles[r.lineIndex+d]&&u[0]&&(this.styles[r.lineIndex+d][0]=u[0]),u=u&&u.slice(h[d]+1);h[d]>0&&this.insertCharStyleObject(r.lineIndex+d,0,h[d],u)},setSelectionStartEndWithShift:function(n,l,u){u<=n?(l===n?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=n),this.selectionStart=u):u>n&&u<l?this._selectionDirection==="right"?this.selectionEnd=u:this.selectionStart=u:(l===n?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=u)},setSelectionInBoundaries:function(){var n=this.text.length;this.selectionStart>n?this.selectionStart=n:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>n?this.selectionEnd=n:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(o){if(this.canvas){this.__newClickTime=+new Date;var n=o.pointer;this.isTripleClick(n)&&(this.fire("tripleclick",o),this._stopEvent(o.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=n,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(o){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===o.x&&this.__lastPointer.y===o.y},_stopEvent:function(o){o.preventDefault&&o.preventDefault(),o.stopPropagation&&o.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(o){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(o.e))},tripleClickHandler:function(o){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(o.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(o.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(o){if(this.__isMousedown=!1,!(!this.editable||this.group||o.transform&&o.transform.actionPerformed||o.e.button&&o.e.button!==1)){if(this.canvas){var n=this.canvas._activeObject;if(n&&n!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(o.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(o){var n=this.getSelectionStartFromPointer(o),l=this.selectionStart,u=this.selectionEnd;o.shiftKey?this.setSelectionStartEndWithShift(l,u,n):(this.selectionStart=n,this.selectionEnd=n),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(o){for(var n=this.getLocalPointer(o),l=0,u=0,r=0,h=0,a=0,d,p,f=0,v=this._textLines.length;f<v&&r<=n.y;f++)r+=this.getHeightOfLine(f)*this.scaleY,a=f,f>0&&(h+=this._textLines[f-1].length+this.missingNewlineOffset(f-1));d=this._getLineLeftOffset(a),u=d*this.scaleX,p=this._textLines[a],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+u);for(var _=0,b=p.length;_<b&&(l=u,u+=this.__charBounds[a][_].kernedWidth*this.scaleX,u<=n.x);_++)h++;return this._getNewSelectionStartFromOffset(n,l,u,h,b)},_getNewSelectionStartFromOffset:function(o,n,l,u,r){var h=o.x-n,a=l-o.x,d=a>h||a<0?0:1,p=u+d;return this.flipX&&(p=r-p),p>this._text.length&&(p=this._text.length),p}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var o=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+o.top+"; left: "+o.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+o.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(o){if(this.isEditing){var n=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(o.keyCode in n)this[n[o.keyCode]](o);else if(o.keyCode in this.ctrlKeysMapDown&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapDown[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),o.keyCode>=33&&o.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(o){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(o.keyCode in this.ctrlKeysMapUp&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapUp[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(o){var n=this.fromPaste;if(this.fromPaste=!1,o&&o.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,u=this._text.length,r=l.length,h,a,d=r-u,p=this.selectionStart,f=this.selectionEnd,v=p!==f,_,b,y;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var x=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=p>x.selectionStart;v?(h=this._text.slice(p,f),d+=f-p):r<u&&(C?h=this._text.slice(f+d,f):h=this._text.slice(p,p-d)),a=l.slice(x.selectionEnd-d,x.selectionEnd),h&&h.length&&(a.length&&(_=this.getSelectionStyles(p,p+1,!1),_=a.map(function(){return _[0]})),v?(b=p,y=f):C?(b=f-h.length,y=f):(b=f,y=f+h.length),this.removeStyleFromTo(b,y)),a.length&&(n&&a.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(_=t.copiedTextStyle),this.insertNewStyleBlock(a,p,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(o){this.compositionStart=o.target.selectionStart,this.compositionEnd=o.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(o){return o&&o.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(o,n){var l=this._getLineLeftOffset(o),u;return n>0&&(u=this.__charBounds[o][n-1],l+=u.left+u.width),l},getDownCursorOffset:function(o,n){var l=this._getSelectionForOffset(o,n),u=this.get2DCursorLocation(l),r=u.lineIndex;if(r===this._textLines.length-1||o.metaKey||o.keyCode===34)return this._text.length-l;var h=u.charIndex,a=this._getWidthBeforeCursor(r,h),d=this._getIndexOnLine(r+1,a),p=this._textLines[r].slice(h);return p.length+d+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(o,n){return o.shiftKey&&this.selectionStart!==this.selectionEnd&&n?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(o,n){var l=this._getSelectionForOffset(o,n),u=this.get2DCursorLocation(l),r=u.lineIndex;if(r===0||o.metaKey||o.keyCode===33)return-l;var h=u.charIndex,a=this._getWidthBeforeCursor(r,h),d=this._getIndexOnLine(r-1,a),p=this._textLines[r].slice(0,h),f=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+d-p.length+(1-f)},_getIndexOnLine:function(o,n){for(var l=this._textLines[o],u=this._getLineLeftOffset(o),r=u,h=0,a,d,p=0,f=l.length;p<f;p++)if(a=this.__charBounds[o][p].width,r+=a,r>n){d=!0;var v=r-a,_=r,b=Math.abs(v-n),y=Math.abs(_-n);h=y<b?p:p-1;break}return d||(h=l.length-1),h},moveCursorDown:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",o)},moveCursorUp:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",o)},_moveCursorUpOrDown:function(o,n){var l="get"+o+"CursorOffset",u=this[l](n,this._selectionDirection==="right");n.shiftKey?this.moveCursorWithShift(u):this.moveCursorWithoutShift(u),u!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(o){var n=this._selectionDirection==="left"?this.selectionStart+o:this.selectionEnd+o;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,n),o!==0},moveCursorWithoutShift:function(o){return o<0?(this.selectionStart+=o,this.selectionEnd=this.selectionStart):(this.selectionEnd+=o,this.selectionStart=this.selectionEnd),o!==0},moveCursorLeft:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",o)},_move:function(o,n,l){var u;if(o.altKey)u=this["findWordBoundary"+l](this[n]);else if(o.metaKey||o.keyCode===35||o.keyCode===36)u=this["findLineBoundary"+l](this[n]);else return this[n]+=l==="Left"?-1:1,!0;if(typeof u<"u"&&this[n]!==u)return this[n]=u,!0},_moveLeft:function(o,n){return this._move(o,n,"Left")},_moveRight:function(o,n){return this._move(o,n,"Right")},moveCursorLeftWithoutShift:function(o){var n=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(n=this._moveLeft(o,"selectionStart")),this.selectionEnd=this.selectionStart,n},moveCursorLeftWithShift:function(o){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(o,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(o,"selectionStart")},moveCursorRight:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",o)},_moveCursorLeftOrRight:function(o,n){var l="moveCursor"+o+"With";this._currentCursorOpacity=1,n.shiftKey?l+="Shift":l+="outShift",this[l](n)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(o){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(o,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(o,"selectionEnd")},moveCursorRightWithoutShift:function(o){var n=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(n=this._moveRight(o,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,n},removeChars:function(o,n){typeof n>"u"&&(n=o+1),this.removeStyleFromTo(o,n),this._text.splice(o,n-o),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(o,n,l,u){typeof u>"u"&&(u=l),u>l&&this.removeStyleFromTo(l,u);var r=t.util.string.graphemeSplit(o);this.insertNewStyleBlock(r,l,n),this._text=[].concat(this._text.slice(0,l),r,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var o=t.util.toFixed,n=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=!0,r=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",r?'text-decoration="'+r+'" ':"",'style="',this.getSvgStyles(u),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var r=[],h=[],a=l,d;this._setSVGBg(h);for(var p=0,f=this._textLines.length;p<f;p++)d=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(h,p,u+d,a),this._setSVGTextLineText(r,p,u+d,a),a+=this.getHeightOfLine(p);return{textSpans:r,textBgRects:h}},_createTextCharSpan:function(l,u,r,h){var a=l!==l.trim()||l.match(n),d=this.getSvgSpanStyles(u,a),p=d?'style="'+d+'"':"",f=u.deltaY,v="",_=t.Object.NUM_FRACTION_DIGITS;return f&&(v=' dy="'+o(f,_)+'" '),['<tspan x="',o(r,_),'" y="',o(h,_),'" ',v,p,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,r,h){var a=this.getHeightOfLine(u),d=this.textAlign.indexOf("justify")!==-1,p,f,v="",_,b,y=0,x=this._textLines[u],C;h+=a*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,O=x.length-1;S<=O;S++)C=S===O||this.charSpacing,v+=x[S],_=this.__charBounds[u][S],y===0?(r+=_.kernedWidth-_.width,y+=_.width):y+=_.kernedWidth,d&&!C&&this._reSpaceAndTab.test(x[S])&&(C=!0),C||(p=p||this.getCompleteStyleDeclaration(u,S),f=this.getCompleteStyleDeclaration(u,S+1),C=t.util.hasStyleChanged(p,f,!0)),C&&(b=this._getStyleDeclaration(u,S)||{},l.push(this._createTextCharSpan(v,b,r,h)),v="",p=f,r+=y,y=0)},_pushTextBgRect:function(l,u,r,h,a,d){var p=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',o(r,p),'" y="',o(h,p),'" width="',o(a,p),'" height="',o(d,p),`"></rect>
`)},_setSVGTextLineBg:function(l,u,r,h){for(var a=this._textLines[u],d=this.getHeightOfLine(u)/this.lineHeight,p=0,f=0,v,_,b=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),y=0,x=a.length;y<x;y++)v=this.__charBounds[u][y],_=this.getValueOfPropertyAt(u,y,"textBackgroundColor"),_!==b?(b&&this._pushTextBgRect(l,b,r+f,h,p,d),f=v.left,p=v.width,b=_):p+=v.kernedWidth;_&&this._pushTextBgRect(l,_,r+f,h,p,d)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new t.Color(l):"";return!u||!u.getSource()||u.getAlpha()===1?'fill="'+l+'"':'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var u=0,r=0,h=0;h<l;h++)u+=this.getHeightOfLine(h);return r=this.getHeightOfLine(h),{lineTop:u,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var u=t.Object.prototype.getSvgStyles.call(this,l);return u+" white-space: pre;"}})}(),function(o){var n=o.fabric||(o.fabric={});n.Textbox=n.util.createClass(n.IText,n.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:n.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var u=0,r=0,h=0,a={},d=0;d<l.graphemeLines.length;d++)l.graphemeText[h]===`
`&&d>0?(r=0,h++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[h])&&d>0&&(r++,h++),a[d]={line:u,offset:r},h+=l.graphemeLines[d].length,r+=l.graphemeLines[d].length;return a},styleHas:function(l,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];r&&(u=r.line)}return n.Text.prototype.styleHas.call(this,l,u)},isEmptyStyles:function(l){if(!this.styles)return!0;var u=0,r=l+1,h,a,d=!1,p=this._styleMap[l],f=this._styleMap[l+1];p&&(l=p.line,u=p.offset),f&&(r=f.line,d=r===l,h=f.offset),a=typeof l>"u"?this.styles:{line:this.styles[l]};for(var v in a)for(var _ in a[v])if(_>=u&&(!d||_<h))for(var b in a[v][_])return!1;return!0},_getStyleDeclaration:function(l,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[l];if(!r)return null;l=r.line,u=r.offset+u}return this.callSuper("_getStyleDeclaration",l,u)},_setStyleDeclaration:function(l,u,r){var h=this._styleMap[l];l=h.line,u=h.offset+u,this.styles[l][u]=r},_deleteStyleDeclaration:function(l,u){var r=this._styleMap[l];l=r.line,u=r.offset+u,delete this.styles[l][u]},_getLineStyle:function(l){var u=this._styleMap[l];return!!this.styles[u.line]},_setLineStyle:function(l){var u=this._styleMap[l];this.styles[u.line]={}},_wrapText:function(l,u){var r=[],h;for(this.isWrapping=!0,h=0;h<l.length;h++)r=r.concat(this._wrapLine(l[h],h,u));return this.isWrapping=!1,r},_measureWord:function(l,u,r){var h=0,a,d=!0;r=r||0;for(var p=0,f=l.length;p<f;p++){var v=this._getGraphemeBox(l[p],u,p+r,a,d);h+=v.kernedWidth,a=l[p]}return h},_wrapLine:function(l,u,r,R){var a=0,d=this.splitByGrapheme,p=[],f=[],v=d?n.util.string.graphemeSplit(l):l.split(this._wordJoiners),_="",b=0,y=d?"":" ",x=0,C=0,S=0,O=!0,E=this._getWidthOfCharSpacing(),R=R||0;v.length===0&&v.push([]),r-=R;for(var z=0;z<v.length;z++)_=d?v[z]:n.util.string.graphemeSplit(v[z]),x=this._measureWord(_,u,b),b+=_.length,a+=C+x-E,a>r&&!O?(p.push(f),f=[],a=x,O=!0):a+=E,!O&&!d&&f.push(y),f=f.concat(_),C=d?0:this._measureWord([y],u,b),b++,O=!1,x>S&&(S=x);return z&&p.push(f),S+R>this.dynamicMinWidth&&(this.dynamicMinWidth=S-E+R),p},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var u=n.Text.prototype._splitTextIntoLines.call(this,l),r=this._wrapText(u.lines,this.width),h=new Array(r.length),a=0;a<r.length;a++)h[a]=r[a].join("");return u.lines=h,u.graphemeLines=r,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var u in this._styleMap)this._textLines[u]&&(l[this._styleMap[u].line]=1);for(var u in this.styles)l[u]||delete this.styles[u]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),n.Textbox.fromObject=function(l,u){var r=n.util.stylesFromArray(l.styles,l.text),h=Object.assign({},l,{styles:r});return n.Object._fromObject("Textbox",h,u,"text")}}(i),function(){var o=t.controlsUtils,n=o.scaleSkewCursorStyleHandler,l=o.scaleCursorStyleHandler,u=o.scalingEqually,r=o.scalingYOrSkewingX,h=o.scalingXOrSkewingY,a=o.scaleOrSkewActionName,d=t.Object.prototype.controls;if(d.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:n,actionHandler:h,getActionName:a}),d.mr=new t.Control({x:.5,y:0,cursorStyleHandler:n,actionHandler:h,getActionName:a}),d.mb=new t.Control({x:0,y:.5,cursorStyleHandler:n,actionHandler:r,getActionName:a}),d.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:n,actionHandler:r,getActionName:a}),d.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),d.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),d.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:u}),d.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:u}),d.mtr=new t.Control({x:0,y:-.5,actionHandler:o.rotationWithSnapping,cursorStyleHandler:o.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var p=t.Textbox.prototype.controls={};p.mtr=d.mtr,p.tr=d.tr,p.br=d.br,p.tl=d.tl,p.bl=d.bl,p.mt=d.mt,p.mb=d.mb,p.mr=new t.Control({x:.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:n,actionName:"resizing"}),p.ml=new t.Control({x:-.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:n,actionName:"resizing"})}}()})(Or);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function ui(i){return i+.5|0}const ie=(i,t,e)=>Math.max(Math.min(i,e),t);function He(i){return ie(ui(i*2.55),0,255)}function ae(i){return ie(ui(i*255),0,255)}function Kt(i){return ie(ui(i/2.55)/100,0,1)}function Jn(i){return ie(ui(i*100),0,100)}const zt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},pn=[..."0123456789ABCDEF"],ia=i=>pn[i&15],na=i=>pn[(i&240)>>4]+pn[i&15],gi=i=>(i&240)>>4===(i&15),sa=i=>gi(i.r)&&gi(i.g)&&gi(i.b)&&gi(i.a);function ra(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&zt[i[1]]*17,g:255&zt[i[2]]*17,b:255&zt[i[3]]*17,a:t===5?zt[i[4]]*17:255}:(t===7||t===9)&&(e={r:zt[i[1]]<<4|zt[i[2]],g:zt[i[3]]<<4|zt[i[4]],b:zt[i[5]]<<4|zt[i[6]],a:t===9?zt[i[7]]<<4|zt[i[8]]:255})),e}const oa=(i,t)=>i<255?t(i):"";function aa(i){var t=sa(i)?ia:na;return i?"#"+t(i.r)+t(i.g)+t(i.b)+oa(i.a,t):void 0}const la=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function kr(i,t,e){const s=t*Math.min(e,1-e),c=(g,m=(g+i/30)%12)=>e-s*Math.max(Math.min(m-3,9-m,1),-1);return[c(0),c(8),c(4)]}function ha(i,t,e){const s=(c,g=(c+i/60)%6)=>e-e*t*Math.max(Math.min(g,4-g,1),0);return[s(5),s(3),s(1)]}function ca(i,t,e){const s=kr(i,1,.5);let c;for(t+e>1&&(c=1/(t+e),t*=c,e*=c),c=0;c<3;c++)s[c]*=1-t-e,s[c]+=t;return s}function ua(i,t,e,s,c){return i===c?(t-e)/s+(t<e?6:0):t===c?(e-i)/s+2:(i-t)/s+4}function An(i){const e=i.r/255,s=i.g/255,c=i.b/255,g=Math.max(e,s,c),m=Math.min(e,s,c),o=(g+m)/2;let n,l,u;return g!==m&&(u=g-m,l=o>.5?u/(2-g-m):u/(g+m),n=ua(e,s,c,u,g),n=n*60+.5),[n|0,l||0,o]}function En(i,t,e,s){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,s)).map(ae)}function Fn(i,t,e){return En(kr,i,t,e)}function fa(i,t,e){return En(ca,i,t,e)}function da(i,t,e){return En(ha,i,t,e)}function Mr(i){return(i%360+360)%360}function ga(i){const t=la.exec(i);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?He(+t[5]):ae(+t[5]));const c=Mr(+t[2]),g=+t[3]/100,m=+t[4]/100;return t[1]==="hwb"?s=fa(c,g,m):t[1]==="hsv"?s=da(c,g,m):s=Fn(c,g,m),{r:s[0],g:s[1],b:s[2],a:e}}function pa(i,t){var e=An(i);e[0]=Mr(e[0]+t),e=Fn(e),i.r=e[0],i.g=e[1],i.b=e[2]}function ma(i){if(!i)return;const t=An(i),e=t[0],s=Jn(t[1]),c=Jn(t[2]);return i.a<255?`hsla(${e}, ${s}%, ${c}%, ${Kt(i.a)})`:`hsl(${e}, ${s}%, ${c}%)`}const Zn={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ts={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function va(){const i={},t=Object.keys(ts),e=Object.keys(Zn);let s,c,g,m,o;for(s=0;s<t.length;s++){for(m=o=t[s],c=0;c<e.length;c++)g=e[c],o=o.replace(g,Zn[g]);g=parseInt(ts[m],16),i[o]=[g>>16&255,g>>8&255,g&255]}return i}let pi;function _a(i){pi||(pi=va(),pi.transparent=[0,0,0,0]);const t=pi[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const ba=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function ya(i){const t=ba.exec(i);let e=255,s,c,g;if(t){if(t[7]!==s){const m=+t[7];e=t[8]?He(m):ie(m*255,0,255)}return s=+t[1],c=+t[3],g=+t[5],s=255&(t[2]?He(s):ie(s,0,255)),c=255&(t[4]?He(c):ie(c,0,255)),g=255&(t[6]?He(g):ie(g,0,255)),{r:s,g:c,b:g,a:e}}}function xa(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${Kt(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const en=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,Te=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function Ca(i,t,e){const s=Te(Kt(i.r)),c=Te(Kt(i.g)),g=Te(Kt(i.b));return{r:ae(en(s+e*(Te(Kt(t.r))-s))),g:ae(en(c+e*(Te(Kt(t.g))-c))),b:ae(en(g+e*(Te(Kt(t.b))-g))),a:i.a+e*(t.a-i.a)}}function mi(i,t,e){if(i){let s=An(i);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=Fn(s),i.r=s[0],i.g=s[1],i.b=s[2]}}function Pr(i,t){return i&&Object.assign(t||{},i)}function es(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=ae(i[3]))):(t=Pr(i,{r:0,g:0,b:0,a:1}),t.a=ae(t.a)),t}function Sa(i){return i.charAt(0)==="r"?ya(i):ga(i)}class ii{constructor(t){if(t instanceof ii)return t;const e=typeof t;let s;e==="object"?s=es(t):e==="string"&&(s=ra(t)||_a(t)||Sa(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=Pr(this._rgb);return t&&(t.a=Kt(t.a)),t}set rgb(t){this._rgb=es(t)}rgbString(){return this._valid?xa(this._rgb):void 0}hexString(){return this._valid?aa(this._rgb):void 0}hslString(){return this._valid?ma(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,c=t.rgb;let g;const m=e===g?.5:e,o=2*m-1,n=s.a-c.a,l=((o*n===-1?o:(o+n)/(1+o*n))+1)/2;g=1-l,s.r=255&l*s.r+g*c.r+.5,s.g=255&l*s.g+g*c.g+.5,s.b=255&l*s.b+g*c.b+.5,s.a=m*s.a+(1-m)*c.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=Ca(this._rgb,t._rgb,e)),this}clone(){return new ii(this.rgb)}alpha(t){return this._rgb.a=ae(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=ui(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return mi(this._rgb,2,t),this}darken(t){return mi(this._rgb,2,-t),this}saturate(t){return mi(this._rgb,1,t),this}desaturate(t){return mi(this._rgb,1,-t),this}rotate(t){return pa(this._rgb,t),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function Gt(){}const wa=(()=>{let i=0;return()=>i++})();function dt(i){return i===null||typeof i>"u"}function vt(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function ct(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function xt(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function Bt(i,t){return xt(i)?i:t}function ht(i,t){return typeof i>"u"?t:i}const Ta=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,Dr=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function mt(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function pt(i,t,e,s){let c,g,m;if(vt(i))if(g=i.length,s)for(c=g-1;c>=0;c--)t.call(e,i[c],c);else for(c=0;c<g;c++)t.call(e,i[c],c);else if(ct(i))for(m=Object.keys(i),g=m.length,c=0;c<g;c++)t.call(e,i[m[c]],m[c])}function zi(i,t){let e,s,c,g;if(!i||!t||i.length!==t.length)return!1;for(e=0,s=i.length;e<s;++e)if(c=i[e],g=t[e],c.datasetIndex!==g.datasetIndex||c.index!==g.index)return!1;return!0}function Wi(i){if(vt(i))return i.map(Wi);if(ct(i)){const t=Object.create(null),e=Object.keys(i),s=e.length;let c=0;for(;c<s;++c)t[e[c]]=Wi(i[e[c]]);return t}return i}function Ar(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function Oa(i,t,e,s){if(!Ar(i))return;const c=t[i],g=e[i];ct(c)&&ct(g)?ni(c,g,s):t[i]=Wi(g)}function ni(i,t,e){const s=vt(t)?t:[t],c=s.length;if(!ct(i))return i;e=e||{};const g=e.merger||Oa;let m;for(let o=0;o<c;++o){if(m=s[o],!ct(m))continue;const n=Object.keys(m);for(let l=0,u=n.length;l<u;++l)g(n[l],i,m,e)}return i}function $e(i,t){return ni(i,t,{merger:ka})}function ka(i,t,e){if(!Ar(i))return;const s=t[i],c=e[i];ct(s)&&ct(c)?$e(s,c):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=Wi(c))}const is={"":i=>i,x:i=>i.x,y:i=>i.y};function Ma(i){const t=i.split("."),e=[];let s="";for(const c of t)s+=c,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function Pa(i){const t=Ma(i);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function le(i,t){return(is[t]||(is[t]=Pa(t)))(i)}function Ln(i){return i.charAt(0).toUpperCase()+i.slice(1)}const si=i=>typeof i<"u",he=i=>typeof i=="function",ns=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function Da(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const bt=Math.PI,_t=2*bt,Aa=_t+bt,Hi=Number.POSITIVE_INFINITY,Ea=bt/180,St=bt/2,fe=bt/4,ss=bt*2/3,ne=Math.log10,Ut=Math.sign;function qe(i,t,e){return Math.abs(i-t)<e}function rs(i){const t=Math.round(i);i=qe(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(ne(i))),s=i/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function Fa(i){const t=[],e=Math.sqrt(i);let s;for(s=1;s<e;s++)i%s===0&&(t.push(s),t.push(i/s));return e===(e|0)&&t.push(e),t.sort((c,g)=>c-g).pop(),t}function De(i){return!isNaN(parseFloat(i))&&isFinite(i)}function La(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function Er(i,t,e){let s,c,g;for(s=0,c=i.length;s<c;s++)g=i[s][e],isNaN(g)||(t.min=Math.min(t.min,g),t.max=Math.max(t.max,g))}function Wt(i){return i*(bt/180)}function Rn(i){return i*(180/bt)}function os(i){if(!xt(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function Fr(i,t){const e=t.x-i.x,s=t.y-i.y,c=Math.sqrt(e*e+s*s);let g=Math.atan2(s,e);return g<-.5*bt&&(g+=_t),{angle:g,distance:c}}function mn(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function Ra(i,t){return(i-t+Aa)%_t-bt}function jt(i){return(i%_t+_t)%_t}function ri(i,t,e,s){const c=jt(i),g=jt(t),m=jt(e),o=jt(g-c),n=jt(m-c),l=jt(c-g),u=jt(c-m);return c===g||c===m||s&&g===m||o>n&&l<u}function Mt(i,t,e){return Math.max(t,Math.min(e,i))}function Ia(i){return Mt(i,-32768,32767)}function Qt(i,t,e,s=1e-6){return i>=Math.min(t,e)-s&&i<=Math.max(t,e)+s}function In(i,t,e){e=e||(m=>i[m]<t);let s=i.length-1,c=0,g;for(;s-c>1;)g=c+s>>1,e(g)?c=g:s=g;return{lo:c,hi:s}}const Jt=(i,t,e,s)=>In(i,e,s?c=>{const g=i[c][t];return g<e||g===e&&i[c+1][t]===e}:c=>i[c][t]<e),Ba=(i,t,e)=>In(i,e,s=>i[s][t]>=e);function ja(i,t,e){let s=0,c=i.length;for(;s<c&&i[s]<t;)s++;for(;c>s&&i[c-1]>e;)c--;return s>0||c<i.length?i.slice(s,c):i}const Lr=["push","pop","shift","splice","unshift"];function za(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Lr.forEach(e=>{const s="_onData"+Ln(e),c=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...g){const m=c.apply(this,g);return i._chartjs.listeners.forEach(o=>{typeof o[s]=="function"&&o[s](...g)}),m}})})}function as(i,t){const e=i._chartjs;if(!e)return;const s=e.listeners,c=s.indexOf(t);c!==-1&&s.splice(c,1),!(s.length>0)&&(Lr.forEach(g=>{delete i[g]}),delete i._chartjs)}function Rr(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const Ir=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function Br(i,t){let e=[],s=!1;return function(...c){e=c,s||(s=!0,Ir.call(window,()=>{s=!1,i.apply(t,e)}))}}function Wa(i,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(i,t,s)):i.apply(this,s),t}}const Bn=i=>i==="start"?"left":i==="end"?"right":"center",Pt=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2,Ha=(i,t,e,s)=>i===(s?"left":"right")?e:i==="center"?(t+e)/2:t;function jr(i,t,e){const s=t.length;let c=0,g=s;if(i._sorted){const{iScale:m,_parsed:o}=i,n=m.axis,{min:l,max:u,minDefined:r,maxDefined:h}=m.getUserBounds();r&&(c=Mt(Math.min(Jt(o,n,l).lo,e?s:Jt(t,n,m.getPixelForValue(l)).lo),0,s-1)),h?g=Mt(Math.max(Jt(o,m.axis,u,!0).hi+1,e?0:Jt(t,n,m.getPixelForValue(u),!0).hi+1),c,s)-c:g=s-c}return{start:c,count:g}}function zr(i){const{xScale:t,yScale:e,_scaleRanges:s}=i,c={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return i._scaleRanges=c,!0;const g=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,c),g}const vi=i=>i===0||i===1,ls=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*_t/e)),hs=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*_t/e)+1,Ke={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*St)+1,easeOutSine:i=>Math.sin(i*St),easeInOutSine:i=>-.5*(Math.cos(bt*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>vi(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>vi(i)?i:ls(i,.075,.3),easeOutElastic:i=>vi(i)?i:hs(i,.075,.3),easeInOutElastic(i){return vi(i)?i:i<.5?.5*ls(i*2,.1125,.45):.5+.5*hs(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-Ke.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?Ke.easeInBounce(i*2)*.5:Ke.easeOutBounce(i*2-1)*.5+.5};function jn(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function cs(i){return jn(i)?i:new ii(i)}function nn(i){return jn(i)?i:new ii(i).saturate(.5).darken(.1).hexString()}const Va=["x","y","borderWidth","radius","tension"],Na=["color","borderColor","backgroundColor"];function Ya(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:Na},numbers:{type:"number",properties:Va}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Xa(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const us=new Map;function Ua(i,t){t=t||{};const e=i+JSON.stringify(t);let s=us.get(e);return s||(s=new Intl.NumberFormat(i,t),us.set(e,s)),s}function fi(i,t,e){return Ua(t,e).format(i)}const Wr={values(i){return vt(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const s=this.chart.options.locale;let c,g=i;if(e.length>1){const l=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(l<1e-4||l>1e15)&&(c="scientific"),g=Ga(i,e)}const m=ne(Math.abs(g)),o=isNaN(m)?1:Math.max(Math.min(-1*Math.floor(m),20),0),n={notation:c,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(n,this.options.ticks.format),fi(i,s,n)},logarithmic(i,t,e){if(i===0)return"0";const s=e[t].significand||i/Math.pow(10,Math.floor(ne(i)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?Wr.numeric.call(this,i,t,e):""}};function Ga(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var $i={formatters:Wr};function $a(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:$i.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const xe=Object.create(null),vn=Object.create(null);function Qe(i,t){if(!t)return i;const e=t.split(".");for(let s=0,c=e.length;s<c;++s){const g=e[s];i=i[g]||(i[g]=Object.create(null))}return i}function sn(i,t,e){return typeof t=="string"?ni(Qe(i,t),e):ni(Qe(i,""),t)}class qa{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,c)=>nn(c.backgroundColor),this.hoverBorderColor=(s,c)=>nn(c.borderColor),this.hoverColor=(s,c)=>nn(c.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return sn(this,t,e)}get(t){return Qe(this,t)}describe(t,e){return sn(vn,t,e)}override(t,e){return sn(xe,t,e)}route(t,e,s,c){const g=Qe(this,t),m=Qe(this,s),o="_"+e;Object.defineProperties(g,{[o]:{value:g[e],writable:!0},[e]:{enumerable:!0,get(){const n=this[o],l=m[c];return ct(n)?Object.assign({},l,n):ht(n,l)},set(n){this[o]=n}}})}apply(t){t.forEach(e=>e(this))}}var Ct=new qa({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Ya,Xa,$a]);function Ka(i){return!i||dt(i.size)||dt(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function Vi(i,t,e,s,c){let g=t[c];return g||(g=t[c]=i.measureText(c).width,e.push(c)),g>s&&(s=g),s}function Qa(i,t,e,s){s=s||{};let c=s.data=s.data||{},g=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(c=s.data={},g=s.garbageCollect=[],s.font=t),i.save(),i.font=t;let m=0;const o=e.length;let n,l,u,r,h;for(n=0;n<o;n++)if(r=e[n],r!=null&&!vt(r))m=Vi(i,c,g,m,r);else if(vt(r))for(l=0,u=r.length;l<u;l++)h=r[l],h!=null&&!vt(h)&&(m=Vi(i,c,g,m,h));i.restore();const a=g.length/2;if(a>e.length){for(n=0;n<a;n++)delete c[g[n]];g.splice(0,a)}return m}function de(i,t,e){const s=i.currentDevicePixelRatio,c=e!==0?Math.max(e/2,.5):0;return Math.round((t-c)*s)/s+c}function fs(i,t){t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore()}function _n(i,t,e,s){Hr(i,t,e,s,null)}function Hr(i,t,e,s,c){let g,m,o,n,l,u,r,h;const a=t.pointStyle,d=t.rotation,p=t.radius;let f=(d||0)*Ea;if(a&&typeof a=="object"&&(g=a.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){i.save(),i.translate(e,s),i.rotate(f),i.drawImage(a,-a.width/2,-a.height/2,a.width,a.height),i.restore();return}if(!(isNaN(p)||p<=0)){switch(i.beginPath(),a){default:c?i.ellipse(e,s,c/2,p,0,0,_t):i.arc(e,s,p,0,_t),i.closePath();break;case"triangle":u=c?c/2:p,i.moveTo(e+Math.sin(f)*u,s-Math.cos(f)*p),f+=ss,i.lineTo(e+Math.sin(f)*u,s-Math.cos(f)*p),f+=ss,i.lineTo(e+Math.sin(f)*u,s-Math.cos(f)*p),i.closePath();break;case"rectRounded":l=p*.516,n=p-l,m=Math.cos(f+fe)*n,r=Math.cos(f+fe)*(c?c/2-l:n),o=Math.sin(f+fe)*n,h=Math.sin(f+fe)*(c?c/2-l:n),i.arc(e-r,s-o,l,f-bt,f-St),i.arc(e+h,s-m,l,f-St,f),i.arc(e+r,s+o,l,f,f+St),i.arc(e-h,s+m,l,f+St,f+bt),i.closePath();break;case"rect":if(!d){n=Math.SQRT1_2*p,u=c?c/2:n,i.rect(e-u,s-n,2*u,2*n);break}f+=fe;case"rectRot":r=Math.cos(f)*(c?c/2:p),m=Math.cos(f)*p,o=Math.sin(f)*p,h=Math.sin(f)*(c?c/2:p),i.moveTo(e-r,s-o),i.lineTo(e+h,s-m),i.lineTo(e+r,s+o),i.lineTo(e-h,s+m),i.closePath();break;case"crossRot":f+=fe;case"cross":r=Math.cos(f)*(c?c/2:p),m=Math.cos(f)*p,o=Math.sin(f)*p,h=Math.sin(f)*(c?c/2:p),i.moveTo(e-r,s-o),i.lineTo(e+r,s+o),i.moveTo(e+h,s-m),i.lineTo(e-h,s+m);break;case"star":r=Math.cos(f)*(c?c/2:p),m=Math.cos(f)*p,o=Math.sin(f)*p,h=Math.sin(f)*(c?c/2:p),i.moveTo(e-r,s-o),i.lineTo(e+r,s+o),i.moveTo(e+h,s-m),i.lineTo(e-h,s+m),f+=fe,r=Math.cos(f)*(c?c/2:p),m=Math.cos(f)*p,o=Math.sin(f)*p,h=Math.sin(f)*(c?c/2:p),i.moveTo(e-r,s-o),i.lineTo(e+r,s+o),i.moveTo(e+h,s-m),i.lineTo(e-h,s+m);break;case"line":m=c?c/2:Math.cos(f)*p,o=Math.sin(f)*p,i.moveTo(e-m,s-o),i.lineTo(e+m,s+o);break;case"dash":i.moveTo(e,s),i.lineTo(e+Math.cos(f)*(c?c/2:p),s+Math.sin(f)*p);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function Zt(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function qi(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function Ki(i){i.restore()}function Ja(i,t,e,s,c){if(!t)return i.lineTo(e.x,e.y);if(c==="middle"){const g=(t.x+e.x)/2;i.lineTo(g,t.y),i.lineTo(g,e.y)}else c==="after"!=!!s?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function Za(i,t,e,s){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function tl(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),dt(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function el(i,t,e,s,c){if(c.strikethrough||c.underline){const g=i.measureText(s),m=t-g.actualBoundingBoxLeft,o=t+g.actualBoundingBoxRight,n=e-g.actualBoundingBoxAscent,l=e+g.actualBoundingBoxDescent,u=c.strikethrough?(n+l)/2:l;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=c.decorationWidth||2,i.moveTo(m,u),i.lineTo(o,u),i.stroke()}}function il(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function Ce(i,t,e,s,c,g={}){const m=vt(t)?t:[t],o=g.strokeWidth>0&&g.strokeColor!=="";let n,l;for(i.save(),i.font=c.string,tl(i,g),n=0;n<m.length;++n)l=m[n],g.backdrop&&il(i,g.backdrop),o&&(g.strokeColor&&(i.strokeStyle=g.strokeColor),dt(g.strokeWidth)||(i.lineWidth=g.strokeWidth),i.strokeText(l,e,s,g.maxWidth)),i.fillText(l,e,s,g.maxWidth),el(i,e,s,l,g),s+=Number(c.lineHeight);i.restore()}function oi(i,t){const{x:e,y:s,w:c,h:g,radius:m}=t;i.arc(e+m.topLeft,s+m.topLeft,m.topLeft,1.5*bt,bt,!0),i.lineTo(e,s+g-m.bottomLeft),i.arc(e+m.bottomLeft,s+g-m.bottomLeft,m.bottomLeft,bt,St,!0),i.lineTo(e+c-m.bottomRight,s+g),i.arc(e+c-m.bottomRight,s+g-m.bottomRight,m.bottomRight,St,0,!0),i.lineTo(e+c,s+m.topRight),i.arc(e+c-m.topRight,s+m.topRight,m.topRight,0,-St,!0),i.lineTo(e+m.topLeft,s)}const nl=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,sl=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function rl(i,t){const e=(""+i).match(nl);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const ol=i=>+i||0;function zn(i,t){const e={},s=ct(t),c=s?Object.keys(t):t,g=ct(i)?s?m=>ht(i[m],i[t[m]]):m=>i[m]:()=>i;for(const m of c)e[m]=ol(g(m));return e}function Vr(i){return zn(i,{top:"y",right:"x",bottom:"y",left:"x"})}function be(i){return zn(i,["topLeft","topRight","bottomLeft","bottomRight"])}function At(i){const t=Vr(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Tt(i,t){i=i||{},t=t||Ct.font;let e=ht(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=ht(i.style,t.style);s&&!(""+s).match(sl)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const c={family:ht(i.family,t.family),lineHeight:rl(ht(i.lineHeight,t.lineHeight),e),size:e,style:s,weight:ht(i.weight,t.weight),string:""};return c.string=Ka(c),c}function Ve(i,t,e,s){let c=!0,g,m,o;for(g=0,m=i.length;g<m;++g)if(o=i[g],o!==void 0&&(t!==void 0&&typeof o=="function"&&(o=o(t),c=!1),e!==void 0&&vt(o)&&(o=o[e%o.length],c=!1),o!==void 0))return s&&!c&&(s.cacheable=!1),o}function al(i,t,e){const{min:s,max:c}=i,g=Dr(t,(c-s)/2),m=(o,n)=>e&&o===0?0:o+n;return{min:m(s,-Math.abs(g)),max:m(c,g)}}function ce(i,t){return Object.assign(Object.create(i),t)}function Wn(i,t=[""],e,s,c=()=>i[0]){const g=e||i;typeof s>"u"&&(s=Ur("_fallback",i));const m={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:g,_fallback:s,_getTarget:c,override:o=>Wn([o,...i],t,g,s)};return new Proxy(m,{deleteProperty(o,n){return delete o[n],delete o._keys,delete i[0][n],!0},get(o,n){return Yr(o,n,()=>pl(n,t,i,o))},getOwnPropertyDescriptor(o,n){return Reflect.getOwnPropertyDescriptor(o._scopes[0],n)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(o,n){return gs(o).includes(n)},ownKeys(o){return gs(o)},set(o,n,l){const u=o._storage||(o._storage=c());return o[n]=u[n]=l,delete o._keys,!0}})}function Ae(i,t,e,s){const c={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:Nr(i,s),setContext:g=>Ae(i,g,e,s),override:g=>Ae(i.override(g),t,e,s)};return new Proxy(c,{deleteProperty(g,m){return delete g[m],delete i[m],!0},get(g,m,o){return Yr(g,m,()=>hl(g,m,o))},getOwnPropertyDescriptor(g,m){return g._descriptors.allKeys?Reflect.has(i,m)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,m)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(g,m){return Reflect.has(i,m)},ownKeys(){return Reflect.ownKeys(i)},set(g,m,o){return i[m]=o,delete g[m],!0}})}function Nr(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:c=t.allKeys}=i;return{allKeys:c,scriptable:e,indexable:s,isScriptable:he(e)?e:()=>e,isIndexable:he(s)?s:()=>s}}const ll=(i,t)=>i?i+Ln(t):t,Hn=(i,t)=>ct(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Yr(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t))return i[t];const s=e();return i[t]=s,s}function hl(i,t,e){const{_proxy:s,_context:c,_subProxy:g,_descriptors:m}=i;let o=s[t];return he(o)&&m.isScriptable(t)&&(o=cl(t,o,i,e)),vt(o)&&o.length&&(o=ul(t,o,i,m.isIndexable)),Hn(t,o)&&(o=Ae(o,c,g&&g[t],m)),o}function cl(i,t,e,s){const{_proxy:c,_context:g,_subProxy:m,_stack:o}=e;if(o.has(i))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+i);o.add(i);let n=t(g,m||s);return o.delete(i),Hn(i,n)&&(n=Vn(c._scopes,c,i,n)),n}function ul(i,t,e,s){const{_proxy:c,_context:g,_subProxy:m,_descriptors:o}=e;if(typeof g.index<"u"&&s(i))return t[g.index%t.length];if(ct(t[0])){const n=t,l=c._scopes.filter(u=>u!==n);t=[];for(const u of n){const r=Vn(l,c,i,u);t.push(Ae(r,g,m&&m[i],o))}}return t}function Xr(i,t,e){return he(i)?i(t,e):i}const fl=(i,t)=>i===!0?t:typeof i=="string"?le(t,i):void 0;function dl(i,t,e,s,c){for(const g of t){const m=fl(e,g);if(m){i.add(m);const o=Xr(m._fallback,e,c);if(typeof o<"u"&&o!==e&&o!==s)return o}else if(m===!1&&typeof s<"u"&&e!==s)return null}return!1}function Vn(i,t,e,s){const c=t._rootScopes,g=Xr(t._fallback,e,s),m=[...i,...c],o=new Set;o.add(s);let n=ds(o,m,e,g||e,s);return n===null||typeof g<"u"&&g!==e&&(n=ds(o,m,g,n,s),n===null)?!1:Wn(Array.from(o),[""],c,g,()=>gl(t,e,s))}function ds(i,t,e,s,c){for(;e;)e=dl(i,t,e,s,c);return e}function gl(i,t,e){const s=i._getTarget();t in s||(s[t]={});const c=s[t];return vt(c)&&ct(e)?e:c||{}}function pl(i,t,e,s){let c;for(const g of t)if(c=Ur(ll(g,i),e),typeof c<"u")return Hn(i,c)?Vn(e,s,i,c):c}function Ur(i,t){for(const e of t){if(!e)continue;const s=e[i];if(typeof s<"u")return s}}function gs(i){let t=i._keys;return t||(t=i._keys=ml(i._scopes)),t}function ml(i){const t=new Set;for(const e of i)for(const s of Object.keys(e).filter(c=>!c.startsWith("_")))t.add(s);return Array.from(t)}function Gr(i,t,e,s){const{iScale:c}=i,{key:g="r"}=this._parsing,m=new Array(s);let o,n,l,u;for(o=0,n=s;o<n;++o)l=o+e,u=t[l],m[o]={r:c.parse(le(u,g),l)};return m}const vl=Number.EPSILON||1e-14,Ee=(i,t)=>t<i.length&&!i[t].skip&&i[t],$r=i=>i==="x"?"y":"x";function _l(i,t,e,s){const c=i.skip?t:i,g=t,m=e.skip?t:e,o=mn(g,c),n=mn(m,g);let l=o/(o+n),u=n/(o+n);l=isNaN(l)?0:l,u=isNaN(u)?0:u;const r=s*l,h=s*u;return{previous:{x:g.x-r*(m.x-c.x),y:g.y-r*(m.y-c.y)},next:{x:g.x+h*(m.x-c.x),y:g.y+h*(m.y-c.y)}}}function bl(i,t,e){const s=i.length;let c,g,m,o,n,l=Ee(i,0);for(let u=0;u<s-1;++u)if(n=l,l=Ee(i,u+1),!(!n||!l)){if(qe(t[u],0,vl)){e[u]=e[u+1]=0;continue}c=e[u]/t[u],g=e[u+1]/t[u],o=Math.pow(c,2)+Math.pow(g,2),!(o<=9)&&(m=3/Math.sqrt(o),e[u]=c*m*t[u],e[u+1]=g*m*t[u])}}function yl(i,t,e="x"){const s=$r(e),c=i.length;let g,m,o,n=Ee(i,0);for(let l=0;l<c;++l){if(m=o,o=n,n=Ee(i,l+1),!o)continue;const u=o[e],r=o[s];m&&(g=(u-m[e])/3,o[`cp1${e}`]=u-g,o[`cp1${s}`]=r-g*t[l]),n&&(g=(n[e]-u)/3,o[`cp2${e}`]=u+g,o[`cp2${s}`]=r+g*t[l])}}function xl(i,t="x"){const e=$r(t),s=i.length,c=Array(s).fill(0),g=Array(s);let m,o,n,l=Ee(i,0);for(m=0;m<s;++m)if(o=n,n=l,l=Ee(i,m+1),!!n){if(l){const u=l[t]-n[t];c[m]=u!==0?(l[e]-n[e])/u:0}g[m]=o?l?Ut(c[m-1])!==Ut(c[m])?0:(c[m-1]+c[m])/2:c[m-1]:c[m]}bl(i,c,g),yl(i,g,t)}function _i(i,t,e){return Math.max(Math.min(i,e),t)}function Cl(i,t){let e,s,c,g,m,o=Zt(i[0],t);for(e=0,s=i.length;e<s;++e)m=g,g=o,o=e<s-1&&Zt(i[e+1],t),g&&(c=i[e],m&&(c.cp1x=_i(c.cp1x,t.left,t.right),c.cp1y=_i(c.cp1y,t.top,t.bottom)),o&&(c.cp2x=_i(c.cp2x,t.left,t.right),c.cp2y=_i(c.cp2y,t.top,t.bottom)))}function Sl(i,t,e,s,c){let g,m,o,n;if(t.spanGaps&&(i=i.filter(l=>!l.skip)),t.cubicInterpolationMode==="monotone")xl(i,c);else{let l=s?i[i.length-1]:i[0];for(g=0,m=i.length;g<m;++g)o=i[g],n=_l(l,o,i[Math.min(g+1,m-(s?0:1))%m],t.tension),o.cp1x=n.previous.x,o.cp1y=n.previous.y,o.cp2x=n.next.x,o.cp2y=n.next.y,l=o}t.capBezierPoints&&Cl(i,e)}function qr(){return typeof window<"u"&&typeof document<"u"}function Nn(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Ni(i,t,e){let s;return typeof i=="string"?(s=parseInt(i,10),i.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=i,s}const Qi=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function wl(i,t){return Qi(i).getPropertyValue(t)}const Tl=["top","right","bottom","left"];function ye(i,t,e){const s={};e=e?"-"+e:"";for(let c=0;c<4;c++){const g=Tl[c];s[g]=parseFloat(i[t+"-"+g+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const Ol=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function kl(i,t){const e=i.touches,s=e&&e.length?e[0]:i,{offsetX:c,offsetY:g}=s;let m=!1,o,n;if(Ol(c,g,i.target))o=c,n=g;else{const l=t.getBoundingClientRect();o=s.clientX-l.left,n=s.clientY-l.top,m=!0}return{x:o,y:n,box:m}}function me(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:s}=t,c=Qi(e),g=c.boxSizing==="border-box",m=ye(c,"padding"),o=ye(c,"border","width"),{x:n,y:l,box:u}=kl(i,e),r=m.left+(u&&o.left),h=m.top+(u&&o.top);let{width:a,height:d}=t;return g&&(a-=m.width+o.width,d-=m.height+o.height),{x:Math.round((n-r)/a*e.width/s),y:Math.round((l-h)/d*e.height/s)}}function Ml(i,t,e){let s,c;if(t===void 0||e===void 0){const g=Nn(i);if(!g)t=i.clientWidth,e=i.clientHeight;else{const m=g.getBoundingClientRect(),o=Qi(g),n=ye(o,"border","width"),l=ye(o,"padding");t=m.width-l.width-n.width,e=m.height-l.height-n.height,s=Ni(o.maxWidth,g,"clientWidth"),c=Ni(o.maxHeight,g,"clientHeight")}}return{width:t,height:e,maxWidth:s||Hi,maxHeight:c||Hi}}const bi=i=>Math.round(i*10)/10;function Pl(i,t,e,s){const c=Qi(i),g=ye(c,"margin"),m=Ni(c.maxWidth,i,"clientWidth")||Hi,o=Ni(c.maxHeight,i,"clientHeight")||Hi,n=Ml(i,t,e);let{width:l,height:u}=n;if(c.boxSizing==="content-box"){const h=ye(c,"border","width"),a=ye(c,"padding");l-=a.width+h.width,u-=a.height+h.height}return l=Math.max(0,l-g.width),u=Math.max(0,s?l/s:u-g.height),l=bi(Math.min(l,m,n.maxWidth)),u=bi(Math.min(u,o,n.maxHeight)),l&&!u&&(u=bi(l/2)),(t!==void 0||e!==void 0)&&s&&n.height&&u>n.height&&(u=n.height,l=bi(Math.floor(u*s))),{width:l,height:u}}function ps(i,t,e){const s=t||1,c=Math.floor(i.height*s),g=Math.floor(i.width*s);i.height=Math.floor(i.height),i.width=Math.floor(i.width);const m=i.canvas;return m.style&&(e||!m.style.height&&!m.style.width)&&(m.style.height=`${i.height}px`,m.style.width=`${i.width}px`),i.currentDevicePixelRatio!==s||m.height!==c||m.width!==g?(i.currentDevicePixelRatio=s,m.height=c,m.width=g,i.ctx.setTransform(s,0,0,s,0,0),!0):!1}const Dl=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch{}return i}();function ms(i,t){const e=wl(i,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function ve(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function Al(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:s==="middle"?e<.5?i.y:t.y:s==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function El(i,t,e,s){const c={x:i.cp2x,y:i.cp2y},g={x:t.cp1x,y:t.cp1y},m=ve(i,c,e),o=ve(c,g,e),n=ve(g,t,e),l=ve(m,o,e),u=ve(o,n,e);return ve(l,u,e)}const Fl=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},Ll=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function Pe(i,t,e){return i?Fl(t,e):Ll()}function Kr(i,t){let e,s;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=s)}function Qr(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function Jr(i){return i==="angle"?{between:ri,compare:Ra,normalize:jt}:{between:Qt,compare:(t,e)=>t-e,normalize:t=>t}}function vs({start:i,end:t,count:e,loop:s,style:c}){return{start:i%e,end:t%e,loop:s&&(t-i+1)%e===0,style:c}}function Rl(i,t,e){const{property:s,start:c,end:g}=e,{between:m,normalize:o}=Jr(s),n=t.length;let{start:l,end:u,loop:r}=i,h,a;if(r){for(l+=n,u+=n,h=0,a=n;h<a&&m(o(t[l%n][s]),c,g);++h)l--,u--;l%=n,u%=n}return u<l&&(u+=n),{start:l,end:u,loop:r,style:i.style}}function Zr(i,t,e){if(!e)return[i];const{property:s,start:c,end:g}=e,m=t.length,{compare:o,between:n,normalize:l}=Jr(s),{start:u,end:r,loop:h,style:a}=Rl(i,t,e),d=[];let p=!1,f=null,v,_,b;const y=()=>n(c,b,v)&&o(c,b)!==0,x=()=>o(g,v)===0||n(g,b,v),C=()=>p||y(),S=()=>!p||x();for(let O=u,E=u;O<=r;++O)_=t[O%m],!_.skip&&(v=l(_[s]),v!==b&&(p=n(v,c,g),f===null&&C()&&(f=o(v,c)===0?O:E),f!==null&&S()&&(d.push(vs({start:f,end:O,loop:h,count:m,style:a})),f=null),E=O,b=v));return f!==null&&d.push(vs({start:f,end:r,loop:h,count:m,style:a})),d}function to(i,t){const e=[],s=i.segments;for(let c=0;c<s.length;c++){const g=Zr(s[c],i.points,t);g.length&&e.push(...g)}return e}function Il(i,t,e,s){let c=0,g=t-1;if(e&&!s)for(;c<t&&!i[c].skip;)c++;for(;c<t&&i[c].skip;)c++;for(c%=t,e&&(g+=c);g>c&&i[g%t].skip;)g--;return g%=t,{start:c,end:g}}function Bl(i,t,e,s){const c=i.length,g=[];let m=t,o=i[t],n;for(n=t+1;n<=e;++n){const l=i[n%c];l.skip||l.stop?o.skip||(s=!1,g.push({start:t%c,end:(n-1)%c,loop:s}),t=m=l.stop?n:null):(m=n,o.skip&&(t=n)),o=l}return m!==null&&g.push({start:t%c,end:m%c,loop:s}),g}function jl(i,t){const e=i.points,s=i.options.spanGaps,c=e.length;if(!c)return[];const g=!!i._loop,{start:m,end:o}=Il(e,c,g,s);if(s===!0)return _s(i,[{start:m,end:o,loop:g}],e,t);const n=o<m?o+c:o,l=!!i._fullLoop&&m===0&&o===c-1;return _s(i,Bl(e,m,n,l),e,t)}function _s(i,t,e,s){return!s||!s.setContext||!e?t:zl(i,t,e,s)}function zl(i,t,e,s){const c=i._chart.getContext(),g=bs(i.options),{_datasetIndex:m,options:{spanGaps:o}}=i,n=e.length,l=[];let u=g,r=t[0].start,h=r;function a(d,p,f,v){const _=o?-1:1;if(d!==p){for(d+=n;e[d%n].skip;)d-=_;for(;e[p%n].skip;)p+=_;d%n!==p%n&&(l.push({start:d%n,end:p%n,loop:f,style:v}),u=v,r=p%n)}}for(const d of t){r=o?r:d.start;let p=e[r%n],f;for(h=r+1;h<=d.end;h++){const v=e[h%n];f=bs(s.setContext(ce(c,{type:"segment",p0:p,p1:v,p0DataIndex:(h-1)%n,p1DataIndex:h%n,datasetIndex:m}))),Wl(f,u)&&a(r,h-1,d.loop,u),p=v,u=f}r<h-1&&a(r,h-1,d.loop,u)}return l}function bs(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function Wl(i,t){if(!t)return!1;const e=[],s=function(c,g){return jn(g)?(e.includes(g)||e.push(g),e.indexOf(g)):g};return JSON.stringify(i,s)!==JSON.stringify(t,s)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class Hl{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,c){const g=e.listeners[c],m=e.duration;g.forEach(o=>o({chart:t,initial:e.initial,numSteps:m,currentStep:Math.min(s-e.start,m)}))}_refresh(){this._request||(this._running=!0,this._request=Ir.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,c)=>{if(!s.running||!s.items.length)return;const g=s.items;let m=g.length-1,o=!1,n;for(;m>=0;--m)n=g[m],n._active?(n._total>s.duration&&(s.duration=n._total),n.tick(t),o=!0):(g[m]=g[g.length-1],g.pop());o&&(c.draw(),this._notify(c,s,t,"progress")),g.length||(s.running=!1,this._notify(c,s,t,"complete"),s.initial=!1),e+=g.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,c)=>Math.max(s,c._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let c=s.length-1;for(;c>=0;--c)s[c].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var $t=new Hl;const ys="transparent",Vl={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const s=cs(i||ys),c=s.valid&&cs(t||ys);return c&&c.valid?c.mix(s,e).hexString():t},number(i,t,e){return i+(t-i)*e}};class Nl{constructor(t,e,s,c){const g=e[s];c=Ve([t.to,c,g,t.from]);const m=Ve([t.from,g,c]);this._active=!0,this._fn=t.fn||Vl[t.type||typeof m],this._easing=Ke[t.easing]||Ke.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=m,this._to=c,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const c=this._target[this._prop],g=s-this._start,m=this._duration-g;this._start=s,this._duration=Math.floor(Math.max(m,t.duration)),this._total+=g,this._loop=!!t.loop,this._to=Ve([t.to,e,c,t.from]),this._from=Ve([t.from,c,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,c=this._prop,g=this._from,m=this._loop,o=this._to;let n;if(this._active=g!==o&&(m||e<s),!this._active){this._target[c]=o,this._notify(!0);return}if(e<0){this._target[c]=g;return}n=e/s%2,n=m&&n>1?2-n:n,n=this._easing(Math.min(1,Math.max(0,n))),this._target[c]=this._fn(g,o,n)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let c=0;c<s.length;c++)s[c][e]()}}class eo{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!ct(t))return;const e=Object.keys(Ct.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(c=>{const g=t[c];if(!ct(g))return;const m={};for(const o of e)m[o]=g[o];(vt(g.properties)&&g.properties||[c]).forEach(o=>{(o===c||!s.has(o))&&s.set(o,m)})})}_animateOptions(t,e){const s=e.options,c=Xl(t,s);if(!c)return[];const g=this._createAnimations(c,s);return s.$shared&&Yl(t.options.$animations,s).then(()=>{t.options=s},()=>{}),g}_createAnimations(t,e){const s=this._properties,c=[],g=t.$animations||(t.$animations={}),m=Object.keys(e),o=Date.now();let n;for(n=m.length-1;n>=0;--n){const l=m[n];if(l.charAt(0)==="$")continue;if(l==="options"){c.push(...this._animateOptions(t,e));continue}const u=e[l];let r=g[l];const h=s.get(l);if(r)if(h&&r.active()){r.update(h,u,o);continue}else r.cancel();if(!h||!h.duration){t[l]=u;continue}g[l]=r=new Nl(h,t,l,u),c.push(r)}return c}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return $t.add(this._chart,s),!0}}function Yl(i,t){const e=[],s=Object.keys(t);for(let c=0;c<s.length;c++){const g=i[s[c]];g&&g.active()&&e.push(g.wait())}return Promise.all(e)}function Xl(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function xs(i,t){const e=i&&i.options||{},s=e.reverse,c=e.min===void 0?t:0,g=e.max===void 0?t:0;return{start:s?g:c,end:s?c:g}}function Ul(i,t,e){if(e===!1)return!1;const s=xs(i,e),c=xs(t,e);return{top:c.end,right:s.end,bottom:c.start,left:s.start}}function Gl(i){let t,e,s,c;return ct(i)?(t=i.top,e=i.right,s=i.bottom,c=i.left):t=e=s=c=i,{top:t,right:e,bottom:s,left:c,disabled:i===!1}}function io(i,t){const e=[],s=i._getSortedDatasetMetas(t);let c,g;for(c=0,g=s.length;c<g;++c)e.push(s[c].index);return e}function Cs(i,t,e,s={}){const c=i.keys,g=s.mode==="single";let m,o,n,l;if(t!==null){for(m=0,o=c.length;m<o;++m){if(n=+c[m],n===e){if(s.all)continue;break}l=i.values[n],xt(l)&&(g||t===0||Ut(t)===Ut(l))&&(t+=l)}return t}}function $l(i){const t=Object.keys(i),e=new Array(t.length);let s,c,g;for(s=0,c=t.length;s<c;++s)g=t[s],e[s]={x:g,y:i[g]};return e}function Ss(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function ql(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function Kl(i){const{min:t,max:e,minDefined:s,maxDefined:c}=i.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:c?e:Number.POSITIVE_INFINITY}}function Ql(i,t,e){const s=i[t]||(i[t]={});return s[e]||(s[e]={})}function ws(i,t,e,s){for(const c of t.getMatchingVisibleMetas(s).reverse()){const g=i[c.index];if(e&&g>0||!e&&g<0)return c.index}return null}function Ts(i,t){const{chart:e,_cachedMeta:s}=i,c=e._stacks||(e._stacks={}),{iScale:g,vScale:m,index:o}=s,n=g.axis,l=m.axis,u=ql(g,m,s),r=t.length;let h;for(let a=0;a<r;++a){const d=t[a],{[n]:p,[l]:f}=d,v=d._stacks||(d._stacks={});h=v[l]=Ql(c,u,p),h[o]=f,h._top=ws(h,m,!0,s.type),h._bottom=ws(h,m,!1,s.type);const _=h._visualValues||(h._visualValues={});_[o]=f}}function rn(i,t){const e=i.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function Jl(i,t){return ce(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Zl(i,t,e){return ce(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Re(i,t){const e=i.controller.index,s=i.vScale&&i.vScale.axis;if(s){t=t||i._parsed;for(const c of t){const g=c._stacks;if(!g||g[s]===void 0||g[s][e]===void 0)return;delete g[s][e],g[s]._visualValues!==void 0&&g[s]._visualValues[e]!==void 0&&delete g[s]._visualValues[e]}}}const on=i=>i==="reset"||i==="none",Os=(i,t)=>t?i:Object.assign({},i),th=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:io(e,!0),values:null};class Ht{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Ss(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Re(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),c=(r,h,a,d)=>r==="x"?h:r==="r"?d:a,g=e.xAxisID=ht(s.xAxisID,rn(t,"x")),m=e.yAxisID=ht(s.yAxisID,rn(t,"y")),o=e.rAxisID=ht(s.rAxisID,rn(t,"r")),n=e.indexAxis,l=e.iAxisID=c(n,g,m,o),u=e.vAxisID=c(n,m,g,o);e.xScale=this.getScaleForId(g),e.yScale=this.getScaleForId(m),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&as(this._data,this),t._stacked&&Re(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(ct(e))this._data=$l(e);else if(s!==e){if(s){as(s,this);const c=this._cachedMeta;Re(c),c._parsed=[]}e&&Object.isExtensible(e)&&za(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let c=!1;this._dataCheck();const g=e._stacked;e._stacked=Ss(e.vScale,e),e.stack!==s.stack&&(c=!0,Re(e),e.stack=s.stack),this._resyncElements(t),(c||g!==e._stacked)&&Ts(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:c}=this,{iScale:g,_stacked:m}=s,o=g.axis;let n=t===0&&e===c.length?!0:s._sorted,l=t>0&&s._parsed[t-1],u,r,h;if(this._parsing===!1)s._parsed=c,s._sorted=!0,h=c;else{vt(c[t])?h=this.parseArrayData(s,c,t,e):ct(c[t])?h=this.parseObjectData(s,c,t,e):h=this.parsePrimitiveData(s,c,t,e);const a=()=>r[o]===null||l&&r[o]<l[o];for(u=0;u<e;++u)s._parsed[u+t]=r=h[u],n&&(a()&&(n=!1),l=r);s._sorted=n}m&&Ts(this,h)}parsePrimitiveData(t,e,s,c){const{iScale:g,vScale:m}=t,o=g.axis,n=m.axis,l=g.getLabels(),u=g===m,r=new Array(c);let h,a,d;for(h=0,a=c;h<a;++h)d=h+s,r[h]={[o]:u||g.parse(l[d],d),[n]:m.parse(e[d],d)};return r}parseArrayData(t,e,s,c){const{xScale:g,yScale:m}=t,o=new Array(c);let n,l,u,r;for(n=0,l=c;n<l;++n)u=n+s,r=e[u],o[n]={x:g.parse(r[0],u),y:m.parse(r[1],u)};return o}parseObjectData(t,e,s,c){const{xScale:g,yScale:m}=t,{xAxisKey:o="x",yAxisKey:n="y"}=this._parsing,l=new Array(c);let u,r,h,a;for(u=0,r=c;u<r;++u)h=u+s,a=e[h],l[u]={x:g.parse(le(a,o),h),y:m.parse(le(a,n),h)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const c=this.chart,g=this._cachedMeta,m=e[t.axis],o={keys:io(c,!0),values:e._stacks[t.axis]._visualValues};return Cs(o,m,g.index,{mode:s})}updateRangeFromParsed(t,e,s,c){const g=s[e.axis];let m=g===null?NaN:g;const o=c&&s._stacks[e.axis];c&&o&&(c.values=o,m=Cs(c,g,this._cachedMeta.index)),t.min=Math.min(t.min,m),t.max=Math.max(t.max,m)}getMinMax(t,e){const s=this._cachedMeta,c=s._parsed,g=s._sorted&&t===s.iScale,m=c.length,o=this._getOtherScale(t),n=th(e,s,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:r}=Kl(o);let h,a;function d(){a=c[h];const p=a[o.axis];return!xt(a[t.axis])||u>p||r<p}for(h=0;h<m&&!(!d()&&(this.updateRangeFromParsed(l,t,a,n),g));++h);if(g){for(h=m-1;h>=0;--h)if(!d()){this.updateRangeFromParsed(l,t,a,n);break}}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let c,g,m;for(c=0,g=e.length;c<g;++c)m=e[c][t.axis],xt(m)&&s.push(m);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,c=e.vScale,g=this.getParsed(t);return{label:s?""+s.getLabelForValue(g[s.axis]):"",value:c?""+c.getLabelForValue(g[c.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Gl(ht(this.options.clip,Ul(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,c=s.data||[],g=e.chartArea,m=[],o=this._drawStart||0,n=this._drawCount||c.length-o,l=this.options.drawActiveElementsOnTop;let u;for(s.dataset&&s.dataset.draw(t,g,o,n),u=o;u<o+n;++u){const r=c[u];r.hidden||(r.active&&l?m.push(r):r.draw(t,g))}for(u=0;u<m.length;++u)m[u].draw(t,g)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const c=this.getDataset();let g;if(t>=0&&t<this._cachedMeta.data.length){const m=this._cachedMeta.data[t];g=m.$context||(m.$context=Zl(this.getContext(),t,m)),g.parsed=this.getParsed(t),g.raw=c.data[t],g.index=g.dataIndex=t}else g=this.$context||(this.$context=Jl(this.chart.getContext(),this.index)),g.dataset=c,g.index=g.datasetIndex=this.index;return g.active=!!e,g.mode=s,g}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const c=e==="active",g=this._cachedDataOpts,m=t+"-"+e,o=g[m],n=this.enableOptionSharing&&si(s);if(o)return Os(o,n);const l=this.chart.config,u=l.datasetElementScopeKeys(this._type,t),r=c?[`${t}Hover`,"hover",t,""]:[t,""],h=l.getOptionScopes(this.getDataset(),u),a=Object.keys(Ct.elements[t]),d=()=>this.getContext(s,c,e),p=l.resolveNamedOptions(h,a,d,r);return p.$shared&&(p.$shared=n,g[m]=Object.freeze(Os(p,n))),p}_resolveAnimations(t,e,s){const c=this.chart,g=this._cachedDataOpts,m=`animation-${e}`,o=g[m];if(o)return o;let n;if(c.options.animation!==!1){const u=this.chart.config,r=u.datasetAnimationScopeKeys(this._type,e),h=u.getOptionScopes(this.getDataset(),r);n=u.createResolver(h,this.getContext(t,s,e))}const l=new eo(c,n&&n.animations);return n&&n._cacheable&&(g[m]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||on(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),c=this._sharedOptions,g=this.getSharedOptions(s),m=this.includeOptions(e,g)||g!==c;return this.updateSharedOptions(g,e,s),{sharedOptions:g,includeOptions:m}}updateElement(t,e,s,c){on(c)?Object.assign(t,s):this._resolveAnimations(e,c).update(t,s)}updateSharedOptions(t,e,s){t&&!on(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,c){t.active=c;const g=this.getStyle(e,c);this._resolveAnimations(e,s,c).update(t,{options:!c&&this.getSharedOptions(g)||g})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[o,n,l]of this._syncList)this[o](n,l);this._syncList=[];const c=s.length,g=e.length,m=Math.min(g,c);m&&this.parse(0,m),g>c?this._insertElements(c,g-c,t):g<c&&this._removeElements(g,c-g)}_insertElements(t,e,s=!0){const c=this._cachedMeta,g=c.data,m=t+e;let o;const n=l=>{for(l.length+=e,o=l.length-1;o>=m;o--)l[o]=l[o-e]};for(n(g),o=t;o<m;++o)g[o]=new this.dataElementType;this._parsing&&n(c._parsed),this.parse(t,e),s&&this.updateElements(g,t,e,"reset")}updateElements(t,e,s,c){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const c=s._parsed.splice(t,e);s._stacked&&Re(s,c)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,c]=t;this[e](s,c)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Z(Ht,"defaults",{}),Z(Ht,"datasetElementType",null),Z(Ht,"dataElementType",null);function eh(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let s=[];for(let c=0,g=e.length;c<g;c++)s=s.concat(e[c].controller.getAllParsedValues(i));i._cache.$bar=Rr(s.sort((c,g)=>c-g))}return i._cache.$bar}function ih(i){const t=i.iScale,e=eh(t,i.type);let s=t._length,c,g,m,o;const n=()=>{m===32767||m===-32768||(si(o)&&(s=Math.min(s,Math.abs(m-o)||s)),o=m)};for(c=0,g=e.length;c<g;++c)m=t.getPixelForValue(e[c]),n();for(o=void 0,c=0,g=t.ticks.length;c<g;++c)m=t.getPixelForTick(c),n();return s}function nh(i,t,e,s){const c=e.barThickness;let g,m;return dt(c)?(g=t.min*e.categoryPercentage,m=e.barPercentage):(g=c*s,m=1),{chunk:g/s,ratio:m,start:t.pixels[i]-g/2}}function sh(i,t,e,s){const c=t.pixels,g=c[i];let m=i>0?c[i-1]:null,o=i<c.length-1?c[i+1]:null;const n=e.categoryPercentage;m===null&&(m=g-(o===null?t.end-t.start:o-g)),o===null&&(o=g+g-m);const l=g-(g-Math.min(m,o))/2*n;return{chunk:Math.abs(o-m)/2*n/s,ratio:e.barPercentage,start:l}}function rh(i,t,e,s){const c=e.parse(i[0],s),g=e.parse(i[1],s),m=Math.min(c,g),o=Math.max(c,g);let n=m,l=o;Math.abs(m)>Math.abs(o)&&(n=o,l=m),t[e.axis]=l,t._custom={barStart:n,barEnd:l,start:c,end:g,min:m,max:o}}function no(i,t,e,s){return vt(i)?rh(i,t,e,s):t[e.axis]=e.parse(i,s),t}function ks(i,t,e,s){const c=i.iScale,g=i.vScale,m=c.getLabels(),o=c===g,n=[];let l,u,r,h;for(l=e,u=e+s;l<u;++l)h=t[l],r={},r[c.axis]=o||c.parse(m[l],l),n.push(no(h,r,g,l));return n}function an(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function oh(i,t,e){return i!==0?Ut(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function ah(i){let t,e,s,c,g;return i.horizontal?(t=i.base>i.x,e="left",s="right"):(t=i.base<i.y,e="bottom",s="top"),t?(c="end",g="start"):(c="start",g="end"),{start:e,end:s,reverse:t,top:c,bottom:g}}function lh(i,t,e,s){let c=t.borderSkipped;const g={};if(!c){i.borderSkipped=g;return}if(c===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:m,end:o,reverse:n,top:l,bottom:u}=ah(i);c==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===s?c=l:(e._bottom||0)===s?c=u:(g[Ms(u,m,o,n)]=!0,c=l)),g[Ms(c,m,o,n)]=!0,i.borderSkipped=g}function Ms(i,t,e,s){return s?(i=hh(i,t,e),i=Ps(i,e,t)):i=Ps(i,t,e),i}function hh(i,t,e){return i===t?e:i===e?t:i}function Ps(i,t,e){return i==="start"?t:i==="end"?e:i}function ch(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class Pi extends Ht{parsePrimitiveData(t,e,s,c){return ks(t,e,s,c)}parseArrayData(t,e,s,c){return ks(t,e,s,c)}parseObjectData(t,e,s,c){const{iScale:g,vScale:m}=t,{xAxisKey:o="x",yAxisKey:n="y"}=this._parsing,l=g.axis==="x"?o:n,u=m.axis==="x"?o:n,r=[];let h,a,d,p;for(h=s,a=s+c;h<a;++h)p=e[h],d={},d[g.axis]=g.parse(le(p,l),h),r.push(no(le(p,u),d,m,h));return r}updateRangeFromParsed(t,e,s,c){super.updateRangeFromParsed(t,e,s,c);const g=s._custom;g&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,g.min),t.max=Math.max(t.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:c}=e,g=this.getParsed(t),m=g._custom,o=an(m)?"["+m.start+", "+m.end+"]":""+c.getLabelForValue(g[c.axis]);return{label:""+s.getLabelForValue(g[s.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,c){const g=c==="reset",{index:m,_cachedMeta:{vScale:o}}=this,n=o.getBasePixel(),l=o.isHorizontal(),u=this._getRuler(),{sharedOptions:r,includeOptions:h}=this._getSharedOptions(e,c);for(let a=e;a<e+s;a++){const d=this.getParsed(a),p=g||dt(d[o.axis])?{base:n,head:n}:this._calculateBarValuePixels(a),f=this._calculateBarIndexPixels(a,u),v=(d._stacks||{})[o.axis],_={horizontal:l,base:p.base,enableBorderRadius:!v||an(d._custom)||m===v._top||m===v._bottom,x:l?p.head:f.center,y:l?f.center:p.head,height:l?f.size:Math.abs(p.size),width:l?Math.abs(p.size):f.size};h&&(_.options=r||this.resolveDataElementOptions(a,t[a].active?"active":c));const b=_.options||t[a].options;lh(_,b,v,m),ch(_,b,u.ratio),this.updateElement(t[a],a,_,c)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,c=s.getMatchingVisibleMetas(this._type).filter(n=>n.controller.options.grouped),g=s.options.stacked,m=[],o=n=>{const l=n.controller.getParsed(e),u=l&&l[n.vScale.axis];if(dt(u)||isNaN(u))return!0};for(const n of c)if(!(e!==void 0&&o(n))&&((g===!1||m.indexOf(n.stack)===-1||g===void 0&&n.stack===void 0)&&m.push(n.stack),n.index===t))break;return m.length||m.push(void 0),m}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,s){const c=this._getStacks(t,s),g=e!==void 0?c.indexOf(e):-1;return g===-1?c.length-1:g}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,c=[];let g,m;for(g=0,m=e.data.length;g<m;++g)c.push(s.getPixelForValue(this.getParsed(g)[s.axis],g));const o=t.barThickness;return{min:o||ih(e),pixels:c,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:c},options:{base:g,minBarLength:m}}=this,o=g||0,n=this.getParsed(t),l=n._custom,u=an(l);let r=n[e.axis],h=0,a=s?this.applyStack(e,n,s):r,d,p;a!==r&&(h=a-r,a=r),u&&(r=l.barStart,a=l.barEnd-l.barStart,r!==0&&Ut(r)!==Ut(l.barEnd)&&(h=0),h+=r);const f=!dt(g)&&!u?g:h;let v=e.getPixelForValue(f);if(this.chart.getDataVisibility(t)?d=e.getPixelForValue(h+a):d=v,p=d-v,Math.abs(p)<m){p=oh(p,e,o)*m,r===o&&(v-=p/2);const _=e.getPixelForDecimal(0),b=e.getPixelForDecimal(1),y=Math.min(_,b),x=Math.max(_,b);v=Math.max(Math.min(v,x),y),d=v+p,s&&!u&&(n._stacks[e.axis]._visualValues[c]=e.getValueForPixel(d)-e.getValueForPixel(v))}if(v===e.getPixelForValue(o)){const _=Ut(p)*e.getLineWidthForValue(o)/2;v+=_,p-=_}return{size:p,base:v,head:d,center:d+p/2}}_calculateBarIndexPixels(t,e){const s=e.scale,c=this.options,g=c.skipNull,m=ht(c.maxBarThickness,1/0);let o,n;if(e.grouped){const l=g?this._getStackCount(t):e.stackCount,u=c.barThickness==="flex"?sh(t,e,c,l):nh(t,e,c,l),r=this._getStackIndex(this.index,this._cachedMeta.stack,g?t:void 0);o=u.start+u.chunk*r+u.chunk/2,n=Math.min(m,u.chunk*u.ratio)}else o=s.getPixelForValue(this.getParsed(t)[s.axis],t),n=Math.min(m,e.min*e.ratio);return{base:o-n/2,head:o+n/2,center:o,size:n}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,c=s.length;let g=0;for(;g<c;++g)this.getParsed(g)[e.axis]!==null&&s[g].draw(this._ctx)}}Z(Pi,"id","bar"),Z(Pi,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Z(Pi,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Di extends Ht{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,c){const g=super.parsePrimitiveData(t,e,s,c);for(let m=0;m<g.length;m++)g[m]._custom=this.resolveDataElementOptions(m+s).radius;return g}parseArrayData(t,e,s,c){const g=super.parseArrayData(t,e,s,c);for(let m=0;m<g.length;m++){const o=e[s+m];g[m]._custom=ht(o[2],this.resolveDataElementOptions(m+s).radius)}return g}parseObjectData(t,e,s,c){const g=super.parseObjectData(t,e,s,c);for(let m=0;m<g.length;m++){const o=e[s+m];g[m]._custom=ht(o&&o.r&&+o.r,this.resolveDataElementOptions(m+s).radius)}return g}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:c,yScale:g}=e,m=this.getParsed(t),o=c.getLabelForValue(m.x),n=g.getLabelForValue(m.y),l=m._custom;return{label:s[t]||"",value:"("+o+", "+n+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,c){const g=c==="reset",{iScale:m,vScale:o}=this._cachedMeta,{sharedOptions:n,includeOptions:l}=this._getSharedOptions(e,c),u=m.axis,r=o.axis;for(let h=e;h<e+s;h++){const a=t[h],d=!g&&this.getParsed(h),p={},f=p[u]=g?m.getPixelForDecimal(.5):m.getPixelForValue(d[u]),v=p[r]=g?o.getBasePixel():o.getPixelForValue(d[r]);p.skip=isNaN(f)||isNaN(v),l&&(p.options=n||this.resolveDataElementOptions(h,a.active?"active":c),g&&(p.options.radius=0)),this.updateElement(a,h,p,c)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let c=super.resolveDataElementOptions(t,e);c.$shared&&(c=Object.assign({},c,{$shared:!1}));const g=c.radius;return e!=="active"&&(c.radius=0),c.radius+=ht(s&&s._custom,g),c}}Z(Di,"id","bubble"),Z(Di,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),Z(Di,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function uh(i,t,e){let s=1,c=1,g=0,m=0;if(t<_t){const o=i,n=o+t,l=Math.cos(o),u=Math.sin(o),r=Math.cos(n),h=Math.sin(n),a=(b,y,x)=>ri(b,o,n,!0)?1:Math.max(y,y*e,x,x*e),d=(b,y,x)=>ri(b,o,n,!0)?-1:Math.min(y,y*e,x,x*e),p=a(0,l,r),f=a(St,u,h),v=d(bt,l,r),_=d(bt+St,u,h);s=(p-v)/2,c=(f-_)/2,g=-(p+v)/2,m=-(f+_)/2}return{ratioX:s,ratioY:c,offsetX:g,offsetY:m}}class _e extends Ht{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,c=this._cachedMeta;if(this._parsing===!1)c._parsed=s;else{let g=n=>+s[n];if(ct(s[t])){const{key:n="value"}=this._parsing;g=l=>+le(s[l],n)}let m,o;for(m=t,o=t+e;m<o;++m)c._parsed[m]=g(m)}}_getRotation(){return Wt(this.options.rotation-90)}_getCircumference(){return Wt(this.options.circumference)}_getRotationExtents(){let t=_t,e=-_t;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const c=this.chart.getDatasetMeta(s).controller,g=c._getRotation(),m=c._getCircumference();t=Math.min(t,g),e=Math.max(e,g+m)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,c=this._cachedMeta,g=c.data,m=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,o=Math.max((Math.min(s.width,s.height)-m)/2,0),n=Math.min(Ta(this.options.cutout,o),1),l=this._getRingWeight(this.index),{circumference:u,rotation:r}=this._getRotationExtents(),{ratioX:h,ratioY:a,offsetX:d,offsetY:p}=uh(r,u,n),f=(s.width-m)/h,v=(s.height-m)/a,_=Math.max(Math.min(f,v)/2,0),b=Dr(this.options.radius,_),y=Math.max(b*n,0),x=(b-y)/this._getVisibleDatasetWeightTotal();this.offsetX=d*b,this.offsetY=p*b,c.total=this.calculateTotal(),this.outerRadius=b-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*l,0),this.updateElements(g,0,g.length,t)}_circumference(t,e){const s=this.options,c=this._cachedMeta,g=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||c._parsed[t]===null||c.data[t].hidden?0:this.calculateCircumference(c._parsed[t]*g/_t)}updateElements(t,e,s,c){const g=c==="reset",m=this.chart,o=m.chartArea,l=m.options.animation,u=(o.left+o.right)/2,r=(o.top+o.bottom)/2,h=g&&l.animateScale,a=h?0:this.innerRadius,d=h?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,c);let v=this._getRotation(),_;for(_=0;_<e;++_)v+=this._circumference(_,g);for(_=e;_<e+s;++_){const b=this._circumference(_,g),y=t[_],x={x:u+this.offsetX,y:r+this.offsetY,startAngle:v,endAngle:v+b,circumference:b,outerRadius:d,innerRadius:a};f&&(x.options=p||this.resolveDataElementOptions(_,y.active?"active":c)),v+=b,this.updateElement(y,_,x,c)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,c;for(c=0;c<e.length;c++){const g=t._parsed[c];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(c)&&!e[c].hidden&&(s+=Math.abs(g))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?_t*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,c=s.data.labels||[],g=fi(e._parsed[t],s.options.locale);return{label:c[t]||"",value:g}}getMaxBorderWidth(t){let e=0;const s=this.chart;let c,g,m,o,n;if(!t){for(c=0,g=s.data.datasets.length;c<g;++c)if(s.isDatasetVisible(c)){m=s.getDatasetMeta(c),t=m.data,o=m.controller;break}}if(!t)return 0;for(c=0,g=t.length;c<g;++c)n=o.resolveDataElementOptions(c),n.borderAlign!=="inner"&&(e=Math.max(e,n.borderWidth||0,n.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,c=t.length;s<c;++s){const g=this.resolveDataElementOptions(s);e=Math.max(e,g.offset||0,g.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(ht(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Z(_e,"id","doughnut"),Z(_e,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Z(_e,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),Z(_e,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:c}}=t.legend.options;return e.labels.map((g,m)=>{const n=t.getDatasetMeta(0).controller.getStyle(m);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:c,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(m),index:m}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class Ai extends Ht{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:c=[],_dataset:g}=e,m=this.chart._animationsDisabled;let{start:o,count:n}=jr(e,c,m);this._drawStart=o,this._drawCount=n,zr(e)&&(o=0,n=c.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!g._decimated,s.points=c;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(s,void 0,{animated:!m,options:l},t),this.updateElements(c,o,n,t)}updateElements(t,e,s,c){const g=c==="reset",{iScale:m,vScale:o,_stacked:n,_dataset:l}=this._cachedMeta,{sharedOptions:u,includeOptions:r}=this._getSharedOptions(e,c),h=m.axis,a=o.axis,{spanGaps:d,segment:p}=this.options,f=De(d)?d:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||g||c==="none",_=e+s,b=t.length;let y=e>0&&this.getParsed(e-1);for(let x=0;x<b;++x){const C=t[x],S=v?C:{};if(x<e||x>=_){S.skip=!0;continue}const O=this.getParsed(x),E=dt(O[a]),R=S[h]=m.getPixelForValue(O[h],x),z=S[a]=g||E?o.getBasePixel():o.getPixelForValue(n?this.applyStack(o,O,n):O[a],x);S.skip=isNaN(R)||isNaN(z)||E,S.stop=x>0&&Math.abs(O[h]-y[h])>f,p&&(S.parsed=O,S.raw=l.data[x]),r&&(S.options=u||this.resolveDataElementOptions(x,C.active?"active":c)),v||this.updateElement(C,x,S,c),y=O}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,c=t.data||[];if(!c.length)return s;const g=c[0].size(this.resolveDataElementOptions(0)),m=c[c.length-1].size(this.resolveDataElementOptions(c.length-1));return Math.max(s,g,m)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Z(Ai,"id","line"),Z(Ai,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Z(Ai,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Je extends Ht{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,c=s.data.labels||[],g=fi(e._parsed[t].r,s.options.locale);return{label:c[t]||"",value:g}}parseObjectData(t,e,s,c){return Gr.bind(this)(t,e,s,c)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,c)=>{const g=this.getParsed(c).r;!isNaN(g)&&this.chart.getDataVisibility(c)&&(g<e.min&&(e.min=g),g>e.max&&(e.max=g))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,c=Math.min(e.right-e.left,e.bottom-e.top),g=Math.max(c/2,0),m=Math.max(s.cutoutPercentage?g/100*s.cutoutPercentage:1,0),o=(g-m)/t.getVisibleDatasetCount();this.outerRadius=g-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(t,e,s,c){const g=c==="reset",m=this.chart,n=m.options.animation,l=this._cachedMeta.rScale,u=l.xCenter,r=l.yCenter,h=l.getIndexAngle(0)-.5*bt;let a=h,d;const p=360/this.countVisibleElements();for(d=0;d<e;++d)a+=this._computeAngle(d,c,p);for(d=e;d<e+s;d++){const f=t[d];let v=a,_=a+this._computeAngle(d,c,p),b=m.getDataVisibility(d)?l.getDistanceFromCenterForValue(this.getParsed(d).r):0;a=_,g&&(n.animateScale&&(b=0),n.animateRotate&&(v=_=h));const y={x:u,y:r,innerRadius:0,outerRadius:b,startAngle:v,endAngle:_,options:this.resolveDataElementOptions(d,f.active?"active":c)};this.updateElement(f,d,y,c)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,c)=>{!isNaN(this.getParsed(c).r)&&this.chart.getDataVisibility(c)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?Wt(this.resolveDataElementOptions(t,e).angle||s):0}}Z(Je,"id","polarArea"),Z(Je,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Z(Je,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:c}}=t.legend.options;return e.labels.map((g,m)=>{const n=t.getDatasetMeta(0).controller.getStyle(m);return{text:g,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,fontColor:c,lineWidth:n.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(m),index:m}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class bn extends _e{}Z(bn,"id","pie"),Z(bn,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Ei extends Ht{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,c){return Gr.bind(this)(t,e,s,c)}update(t){const e=this._cachedMeta,s=e.dataset,c=e.data||[],g=e.iScale.getLabels();if(s.points=c,t!=="resize"){const m=this.resolveDatasetElementOptions(t);this.options.showLine||(m.borderWidth=0);const o={_loop:!0,_fullLoop:g.length===c.length,options:m};this.updateElement(s,void 0,o,t)}this.updateElements(c,0,c.length,t)}updateElements(t,e,s,c){const g=this._cachedMeta.rScale,m=c==="reset";for(let o=e;o<e+s;o++){const n=t[o],l=this.resolveDataElementOptions(o,n.active?"active":c),u=g.getPointPositionForValue(o,this.getParsed(o).r),r=m?g.xCenter:u.x,h=m?g.yCenter:u.y,a={x:r,y:h,angle:u.angle,skip:isNaN(r)||isNaN(h),options:l};this.updateElement(n,o,a,c)}}}Z(Ei,"id","radar"),Z(Ei,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),Z(Ei,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Fi extends Ht{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:c,yScale:g}=e,m=this.getParsed(t),o=c.getLabelForValue(m.x),n=g.getLabelForValue(m.y);return{label:s[t]||"",value:"("+o+", "+n+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,c=this.chart._animationsDisabled;let{start:g,count:m}=jr(e,s,c);if(this._drawStart=g,this._drawCount=m,zr(e)&&(g=0,m=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:n}=e;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!n._decimated,o.points=s;const l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(o,void 0,{animated:!c,options:l},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,g,m,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,c){const g=c==="reset",{iScale:m,vScale:o,_stacked:n,_dataset:l}=this._cachedMeta,u=this.resolveDataElementOptions(e,c),r=this.getSharedOptions(u),h=this.includeOptions(c,r),a=m.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,v=De(p)?p:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||g||c==="none";let b=e>0&&this.getParsed(e-1);for(let y=e;y<e+s;++y){const x=t[y],C=this.getParsed(y),S=_?x:{},O=dt(C[d]),E=S[a]=m.getPixelForValue(C[a],y),R=S[d]=g||O?o.getBasePixel():o.getPixelForValue(n?this.applyStack(o,C,n):C[d],y);S.skip=isNaN(E)||isNaN(R)||O,S.stop=y>0&&Math.abs(C[a]-b[a])>v,f&&(S.parsed=C,S.raw=l.data[y]),h&&(S.options=r||this.resolveDataElementOptions(y,x.active?"active":c)),_||this.updateElement(x,y,S,c),b=C}this.updateSharedOptions(r,c,u)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let o=0;for(let n=e.length-1;n>=0;--n)o=Math.max(o,e[n].size(this.resolveDataElementOptions(n))/2);return o>0&&o}const s=t.dataset,c=s.options&&s.options.borderWidth||0;if(!e.length)return c;const g=e[0].size(this.resolveDataElementOptions(0)),m=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(c,g,m)/2}}Z(Fi,"id","scatter"),Z(Fi,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),Z(Fi,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var fh=Object.freeze({__proto__:null,BarController:Pi,BubbleController:Di,DoughnutController:_e,LineController:Ai,PieController:bn,PolarAreaController:Je,RadarController:Ei,ScatterController:Fi});function ge(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Yn{constructor(t){Z(this,"options");this.options=t||{}}static override(t){Object.assign(Yn.prototype,t)}init(){}formats(){return ge()}parse(){return ge()}format(){return ge()}add(){return ge()}diff(){return ge()}startOf(){return ge()}endOf(){return ge()}}var dh={_date:Yn};function gh(i,t,e,s){const{controller:c,data:g,_sorted:m}=i,o=c._cachedMeta.iScale;if(o&&t===o.axis&&t!=="r"&&m&&g.length){const n=o._reversePixels?Ba:Jt;if(s){if(c._sharedOptions){const l=g[0],u=typeof l.getRange=="function"&&l.getRange(t);if(u){const r=n(g,t,e-u),h=n(g,t,e+u);return{lo:r.lo,hi:h.hi}}}}else return n(g,t,e)}return{lo:0,hi:g.length-1}}function di(i,t,e,s,c){const g=i.getSortedVisibleDatasetMetas(),m=e[t];for(let o=0,n=g.length;o<n;++o){const{index:l,data:u}=g[o],{lo:r,hi:h}=gh(g[o],t,m,c);for(let a=r;a<=h;++a){const d=u[a];d.skip||s(d,l,a)}}}function ph(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(s,c){const g=t?Math.abs(s.x-c.x):0,m=e?Math.abs(s.y-c.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(m,2))}}function ln(i,t,e,s,c){const g=[];return!c&&!i.isPointInArea(t)||di(i,e,t,function(o,n,l){!c&&!Zt(o,i.chartArea,0)||o.inRange(t.x,t.y,s)&&g.push({element:o,datasetIndex:n,index:l})},!0),g}function mh(i,t,e,s){let c=[];function g(m,o,n){const{startAngle:l,endAngle:u}=m.getProps(["startAngle","endAngle"],s),{angle:r}=Fr(m,{x:t.x,y:t.y});ri(r,l,u)&&c.push({element:m,datasetIndex:o,index:n})}return di(i,e,t,g),c}function vh(i,t,e,s,c,g){let m=[];const o=ph(e);let n=Number.POSITIVE_INFINITY;function l(u,r,h){const a=u.inRange(t.x,t.y,c);if(s&&!a)return;const d=u.getCenterPoint(c);if(!(!!g||i.isPointInArea(d))&&!a)return;const f=o(t,d);f<n?(m=[{element:u,datasetIndex:r,index:h}],n=f):f===n&&m.push({element:u,datasetIndex:r,index:h})}return di(i,e,t,l),m}function hn(i,t,e,s,c,g){return!g&&!i.isPointInArea(t)?[]:e==="r"&&!s?mh(i,t,e,c):vh(i,t,e,s,c,g)}function Ds(i,t,e,s,c){const g=[],m=e==="x"?"inXRange":"inYRange";let o=!1;return di(i,e,t,(n,l,u)=>{n[m](t[e],c)&&(g.push({element:n,datasetIndex:l,index:u}),o=o||n.inRange(t.x,t.y,c))}),s&&!o?[]:g}var _h={evaluateInteractionItems:di,modes:{index(i,t,e,s){const c=me(t,i),g=e.axis||"x",m=e.includeInvisible||!1,o=e.intersect?ln(i,c,g,s,m):hn(i,c,g,!1,s,m),n=[];return o.length?(i.getSortedVisibleDatasetMetas().forEach(l=>{const u=o[0].index,r=l.data[u];r&&!r.skip&&n.push({element:r,datasetIndex:l.index,index:u})}),n):[]},dataset(i,t,e,s){const c=me(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;let o=e.intersect?ln(i,c,g,s,m):hn(i,c,g,!1,s,m);if(o.length>0){const n=o[0].datasetIndex,l=i.getDatasetMeta(n).data;o=[];for(let u=0;u<l.length;++u)o.push({element:l[u],datasetIndex:n,index:u})}return o},point(i,t,e,s){const c=me(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;return ln(i,c,g,s,m)},nearest(i,t,e,s){const c=me(t,i),g=e.axis||"xy",m=e.includeInvisible||!1;return hn(i,c,g,e.intersect,s,m)},x(i,t,e,s){const c=me(t,i);return Ds(i,c,"x",e.intersect,s)},y(i,t,e,s){const c=me(t,i);return Ds(i,c,"y",e.intersect,s)}}};const so=["left","top","right","bottom"];function Ie(i,t){return i.filter(e=>e.pos===t)}function As(i,t){return i.filter(e=>so.indexOf(e.pos)===-1&&e.box.axis===t)}function Be(i,t){return i.sort((e,s)=>{const c=t?s:e,g=t?e:s;return c.weight===g.weight?c.index-g.index:c.weight-g.weight})}function bh(i){const t=[];let e,s,c,g,m,o;for(e=0,s=(i||[]).length;e<s;++e)c=i[e],{position:g,options:{stack:m,stackWeight:o=1}}=c,t.push({index:e,box:c,pos:g,horizontal:c.isHorizontal(),weight:c.weight,stack:m&&g+m,stackWeight:o});return t}function yh(i){const t={};for(const e of i){const{stack:s,pos:c,stackWeight:g}=e;if(!s||!so.includes(c))continue;const m=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});m.count++,m.weight+=g}return t}function xh(i,t){const e=yh(i),{vBoxMaxWidth:s,hBoxMaxHeight:c}=t;let g,m,o;for(g=0,m=i.length;g<m;++g){o=i[g];const{fullSize:n}=o.box,l=e[o.stack],u=l&&o.stackWeight/l.weight;o.horizontal?(o.width=u?u*s:n&&t.availableWidth,o.height=c):(o.width=s,o.height=u?u*c:n&&t.availableHeight)}return e}function Ch(i){const t=bh(i),e=Be(t.filter(l=>l.box.fullSize),!0),s=Be(Ie(t,"left"),!0),c=Be(Ie(t,"right")),g=Be(Ie(t,"top"),!0),m=Be(Ie(t,"bottom")),o=As(t,"x"),n=As(t,"y");return{fullSize:e,leftAndTop:s.concat(g),rightAndBottom:c.concat(n).concat(m).concat(o),chartArea:Ie(t,"chartArea"),vertical:s.concat(c).concat(n),horizontal:g.concat(m).concat(o)}}function Es(i,t,e,s){return Math.max(i[e],t[e])+Math.max(i[s],t[s])}function ro(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function Sh(i,t,e,s){const{pos:c,box:g}=e,m=i.maxPadding;if(!ct(c)){e.size&&(i[c]-=e.size);const r=s[e.stack]||{size:0,count:1};r.size=Math.max(r.size,e.horizontal?g.height:g.width),e.size=r.size/r.count,i[c]+=e.size}g.getPadding&&ro(m,g.getPadding());const o=Math.max(0,t.outerWidth-Es(m,i,"left","right")),n=Math.max(0,t.outerHeight-Es(m,i,"top","bottom")),l=o!==i.w,u=n!==i.h;return i.w=o,i.h=n,e.horizontal?{same:l,other:u}:{same:u,other:l}}function wh(i){const t=i.maxPadding;function e(s){const c=Math.max(t[s]-i[s],0);return i[s]+=c,c}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function Th(i,t){const e=t.maxPadding;function s(c){const g={left:0,top:0,right:0,bottom:0};return c.forEach(m=>{g[m]=Math.max(t[m],e[m])}),g}return s(i?["left","right"]:["top","bottom"])}function Ne(i,t,e,s){const c=[];let g,m,o,n,l,u;for(g=0,m=i.length,l=0;g<m;++g){o=i[g],n=o.box,n.update(o.width||t.w,o.height||t.h,Th(o.horizontal,t));const{same:r,other:h}=Sh(t,e,o,s);l|=r&&c.length,u=u||h,n.fullSize||c.push(o)}return l&&Ne(c,t,e,s)||u}function yi(i,t,e,s,c){i.top=e,i.left=t,i.right=t+s,i.bottom=e+c,i.width=s,i.height=c}function Fs(i,t,e,s){const c=e.padding;let{x:g,y:m}=t;for(const o of i){const n=o.box,l=s[o.stack]||{count:1,placed:0,weight:1},u=o.stackWeight/l.weight||1;if(o.horizontal){const r=t.w*u,h=l.size||n.height;si(l.start)&&(m=l.start),n.fullSize?yi(n,c.left,m,e.outerWidth-c.right-c.left,h):yi(n,t.left+l.placed,m,r,h),l.start=m,l.placed+=r,m=n.bottom}else{const r=t.h*u,h=l.size||n.width;si(l.start)&&(g=l.start),n.fullSize?yi(n,g,c.top,h,e.outerHeight-c.bottom-c.top):yi(n,g,t.top+l.placed,h,r),l.start=g,l.placed+=r,g=n.right}}t.x=g,t.y=m}var Dt={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,s){if(!i)return;const c=At(i.options.layout.padding),g=Math.max(t-c.width,0),m=Math.max(e-c.height,0),o=Ch(i.boxes),n=o.vertical,l=o.horizontal;pt(i.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const u=n.reduce((p,f)=>f.box.options&&f.box.options.display===!1?p:p+1,0)||1,r=Object.freeze({outerWidth:t,outerHeight:e,padding:c,availableWidth:g,availableHeight:m,vBoxMaxWidth:g/2/u,hBoxMaxHeight:m/2}),h=Object.assign({},c);ro(h,At(s));const a=Object.assign({maxPadding:h,w:g,h:m,x:c.left,y:c.top},c),d=xh(n.concat(l),r);Ne(o.fullSize,a,r,d),Ne(n,a,r,d),Ne(l,a,r,d)&&Ne(n,a,r,d),wh(a),Fs(o.leftAndTop,a,r,d),a.x+=a.w,a.y+=a.h,Fs(o.rightAndBottom,a,r,d),i.chartArea={left:a.left,top:a.top,right:a.left+a.w,bottom:a.top+a.h,height:a.h,width:a.w},pt(o.chartArea,p=>{const f=p.box;Object.assign(f,i.chartArea),f.update(a.w,a.h,{left:0,top:0,right:0,bottom:0})})}};class oo{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,c){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,c?Math.floor(e/c):s)}}isAttached(t){return!0}updateConfig(t){}}class Oh extends oo{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Li="$chartjs",kh={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ls=i=>i===null||i==="";function Mh(i,t){const e=i.style,s=i.getAttribute("height"),c=i.getAttribute("width");if(i[Li]={initial:{height:s,width:c,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Ls(c)){const g=ms(i,"width");g!==void 0&&(i.width=g)}if(Ls(s))if(i.style.height==="")i.height=i.width/(t||2);else{const g=ms(i,"height");g!==void 0&&(i.height=g)}return i}const ao=Dl?{passive:!0}:!1;function Ph(i,t,e){i.addEventListener(t,e,ao)}function Dh(i,t,e){i.canvas.removeEventListener(t,e,ao)}function Ah(i,t){const e=kh[i.type]||i.type,{x:s,y:c}=me(i,t);return{type:e,chart:t,native:i,x:s!==void 0?s:null,y:c!==void 0?c:null}}function Yi(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function Eh(i,t,e){const s=i.canvas,c=new MutationObserver(g=>{let m=!1;for(const o of g)m=m||Yi(o.addedNodes,s),m=m&&!Yi(o.removedNodes,s);m&&e()});return c.observe(document,{childList:!0,subtree:!0}),c}function Fh(i,t,e){const s=i.canvas,c=new MutationObserver(g=>{let m=!1;for(const o of g)m=m||Yi(o.removedNodes,s),m=m&&!Yi(o.addedNodes,s);m&&e()});return c.observe(document,{childList:!0,subtree:!0}),c}const ai=new Map;let Rs=0;function lo(){const i=window.devicePixelRatio;i!==Rs&&(Rs=i,ai.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function Lh(i,t){ai.size||window.addEventListener("resize",lo),ai.set(i,t)}function Rh(i){ai.delete(i),ai.size||window.removeEventListener("resize",lo)}function Ih(i,t,e){const s=i.canvas,c=s&&Nn(s);if(!c)return;const g=Br((o,n)=>{const l=c.clientWidth;e(o,n),l<c.clientWidth&&e()},window),m=new ResizeObserver(o=>{const n=o[0],l=n.contentRect.width,u=n.contentRect.height;l===0&&u===0||g(l,u)});return m.observe(c),Lh(i,g),m}function cn(i,t,e){e&&e.disconnect(),t==="resize"&&Rh(i)}function Bh(i,t,e){const s=i.canvas,c=Br(g=>{i.ctx!==null&&e(Ah(g,i))},i);return Ph(s,t,c),c}class jh extends oo{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(Mh(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[Li])return!1;const s=e[Li].initial;["height","width"].forEach(g=>{const m=s[g];dt(m)?e.removeAttribute(g):e.setAttribute(g,m)});const c=s.style||{};return Object.keys(c).forEach(g=>{e.style[g]=c[g]}),e.width=e.width,delete e[Li],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const c=t.$proxies||(t.$proxies={}),m={attach:Eh,detach:Fh,resize:Ih}[e]||Bh;c[e]=m(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),c=s[e];if(!c)return;({attach:cn,detach:cn,resize:cn}[e]||Dh)(t,e,c),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,c){return Pl(t,e,s,c)}isAttached(t){const e=Nn(t);return!!(e&&e.isConnected)}}function zh(i){return!qr()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?Oh:jh}var Mi;let ee=(Mi=class{constructor(){Z(this,"x");Z(this,"y");Z(this,"active",!1);Z(this,"options");Z(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return De(this.x)&&De(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const c={};return t.forEach(g=>{c[g]=s[g]&&s[g].active()?s[g]._to:this[g]}),c}},Z(Mi,"defaults",{}),Z(Mi,"defaultRoutes"),Mi);function Wh(i,t){const e=i.options.ticks,s=Hh(i),c=Math.min(e.maxTicksLimit||s,s),g=e.major.enabled?Nh(t):[],m=g.length,o=g[0],n=g[m-1],l=[];if(m>c)return Yh(t,l,g,m/c),l;const u=Vh(g,t,c);if(m>0){let r,h;const a=m>1?Math.round((n-o)/(m-1)):null;for(xi(t,l,u,dt(a)?0:o-a,o),r=0,h=m-1;r<h;r++)xi(t,l,u,g[r],g[r+1]);return xi(t,l,u,n,dt(a)?t.length:n+a),l}return xi(t,l,u),l}function Hh(i){const t=i.options.offset,e=i._tickSize(),s=i._length/e+(t?0:1),c=i._maxLength/e;return Math.floor(Math.min(s,c))}function Vh(i,t,e){const s=Xh(i),c=t.length/e;if(!s)return Math.max(c,1);const g=Fa(s);for(let m=0,o=g.length-1;m<o;m++){const n=g[m];if(n>c)return n}return Math.max(c,1)}function Nh(i){const t=[];let e,s;for(e=0,s=i.length;e<s;e++)i[e].major&&t.push(e);return t}function Yh(i,t,e,s){let c=0,g=e[0],m;for(s=Math.ceil(s),m=0;m<i.length;m++)m===g&&(t.push(i[m]),c++,g=e[c*s])}function xi(i,t,e,s,c){const g=ht(s,0),m=Math.min(ht(c,i.length),i.length);let o=0,n,l,u;for(e=Math.ceil(e),c&&(n=c-s,e=n/Math.floor(n/e)),u=g;u<0;)o++,u=Math.round(g+o*e);for(l=Math.max(g,0);l<m;l++)l===u&&(t.push(i[l]),o++,u=Math.round(g+o*e))}function Xh(i){const t=i.length;let e,s;if(t<2)return!1;for(s=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==s)return!1;return s}const Uh=i=>i==="left"?"right":i==="right"?"left":i,Is=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,Bs=(i,t)=>Math.min(t||i,i);function js(i,t){const e=[],s=i.length/t,c=i.length;let g=0;for(;g<c;g+=s)e.push(i[Math.floor(g)]);return e}function Gh(i,t,e){const s=i.ticks.length,c=Math.min(t,s-1),g=i._startPixel,m=i._endPixel,o=1e-6;let n=i.getPixelForTick(c),l;if(!(e&&(s===1?l=Math.max(n-g,m-n):t===0?l=(i.getPixelForTick(1)-n)/2:l=(n-i.getPixelForTick(c-1))/2,n+=c<t?l:-l,n<g-o||n>m+o)))return n}function $h(i,t){pt(i,e=>{const s=e.gc,c=s.length/2;let g;if(c>t){for(g=0;g<c;++g)delete e.data[s[g]];s.splice(0,c)}})}function je(i){return i.drawTicks?i.tickLength:0}function zs(i,t){if(!i.display)return 0;const e=Tt(i.font,t),s=At(i.padding);return(vt(i.text)?i.text.length:1)*e.lineHeight+s.height}function qh(i,t){return ce(i,{scale:t,type:"scale"})}function Kh(i,t,e){return ce(i,{tick:e,index:t,type:"tick"})}function Qh(i,t,e){let s=Bn(i);return(e&&t!=="right"||!e&&t==="right")&&(s=Uh(s)),s}function Jh(i,t,e,s){const{top:c,left:g,bottom:m,right:o,chart:n}=i,{chartArea:l,scales:u}=n;let r=0,h,a,d;const p=m-c,f=o-g;if(i.isHorizontal()){if(a=Pt(s,g,o),ct(e)){const v=Object.keys(e)[0],_=e[v];d=u[v].getPixelForValue(_)+p-t}else e==="center"?d=(l.bottom+l.top)/2+p-t:d=Is(i,e,t);h=o-g}else{if(ct(e)){const v=Object.keys(e)[0],_=e[v];a=u[v].getPixelForValue(_)-f+t}else e==="center"?a=(l.left+l.right)/2-f+t:a=Is(i,e,t);d=Pt(s,m,c),r=e==="left"?-St:St}return{titleX:a,titleY:d,maxWidth:h,rotation:r}}class Se extends ee{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:c}=this;return t=Bt(t,Number.POSITIVE_INFINITY),e=Bt(e,Number.NEGATIVE_INFINITY),s=Bt(s,Number.POSITIVE_INFINITY),c=Bt(c,Number.NEGATIVE_INFINITY),{min:Bt(t,s),max:Bt(e,c),minDefined:xt(t),maxDefined:xt(e)}}getMinMax(t){let{min:e,max:s,minDefined:c,maxDefined:g}=this.getUserBounds(),m;if(c&&g)return{min:e,max:s};const o=this.getMatchingVisibleMetas();for(let n=0,l=o.length;n<l;++n)m=o[n].controller.getMinMax(this,t),c||(e=Math.min(e,m.min)),g||(s=Math.max(s,m.max));return e=g&&e>s?s:e,s=c&&e>s?e:s,{min:Bt(e,Bt(s,e)),max:Bt(s,Bt(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){mt(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:c,grace:g,ticks:m}=this.options,o=m.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=al(this,g,c),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const n=o<this.ticks.length;this._convertTicksToLabels(n?js(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),m.display&&(m.autoSkip||m.source==="auto")&&(this.ticks=Wh(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),n&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){mt(this.options.afterUpdate,[this])}beforeSetDimensions(){mt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){mt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),mt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){mt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,c,g;for(s=0,c=t.length;s<c;s++)g=t[s],g.label=mt(e.callback,[g.value,s,t],this)}afterTickToLabelConversion(){mt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){mt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=Bs(this.ticks.length,t.ticks.maxTicksLimit),c=e.minRotation||0,g=e.maxRotation;let m=c,o,n,l;if(!this._isVisible()||!e.display||c>=g||s<=1||!this.isHorizontal()){this.labelRotation=c;return}const u=this._getLabelSizes(),r=u.widest.width,h=u.highest.height,a=Mt(this.chart.width-r,0,this.maxWidth);o=t.offset?this.maxWidth/s:a/(s-1),r+6>o&&(o=a/(s-(t.offset?.5:1)),n=this.maxHeight-je(t.grid)-e.padding-zs(t.title,this.chart.options.font),l=Math.sqrt(r*r+h*h),m=Rn(Math.min(Math.asin(Mt((u.highest.height+6)/o,-1,1)),Math.asin(Mt(n/l,-1,1))-Math.asin(Mt(h/l,-1,1)))),m=Math.max(c,Math.min(g,m))),this.labelRotation=m}afterCalculateLabelRotation(){mt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){mt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:c,grid:g}}=this,m=this._isVisible(),o=this.isHorizontal();if(m){const n=zs(c,e.options.font);if(o?(t.width=this.maxWidth,t.height=je(g)+n):(t.height=this.maxHeight,t.width=je(g)+n),s.display&&this.ticks.length){const{first:l,last:u,widest:r,highest:h}=this._getLabelSizes(),a=s.padding*2,d=Wt(this.labelRotation),p=Math.cos(d),f=Math.sin(d);if(o){const v=s.mirror?0:f*r.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+v+a)}else{const v=s.mirror?0:p*r.width+f*h.height;t.width=Math.min(this.maxWidth,t.width+v+a)}this._calculatePadding(l,u,f,p)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,c){const{ticks:{align:g,padding:m},position:o}=this.options,n=this.labelRotation!==0,l=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,r=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,a=0;n?l?(h=c*t.width,a=s*e.height):(h=s*t.height,a=c*e.width):g==="start"?a=e.width:g==="end"?h=t.width:g!=="inner"&&(h=t.width/2,a=e.width/2),this.paddingLeft=Math.max((h-u+m)*this.width/(this.width-u),0),this.paddingRight=Math.max((a-r+m)*this.width/(this.width-r),0)}else{let u=e.height/2,r=t.height/2;g==="start"?(u=0,r=t.height):g==="end"&&(u=e.height,r=0),this.paddingTop=u+m,this.paddingBottom=r+m}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){mt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)dt(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=js(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:c,_longestTextCache:g}=this,m=[],o=[],n=Math.floor(e/Bs(e,s));let l=0,u=0,r,h,a,d,p,f,v,_,b,y,x;for(r=0;r<e;r+=n){if(d=t[r].label,p=this._resolveTickFontOptions(r),c.font=f=p.string,v=g[f]=g[f]||{data:{},gc:[]},_=p.lineHeight,b=y=0,!dt(d)&&!vt(d))b=Vi(c,v.data,v.gc,b,d),y=_;else if(vt(d))for(h=0,a=d.length;h<a;++h)x=d[h],!dt(x)&&!vt(x)&&(b=Vi(c,v.data,v.gc,b,x),y+=_);m.push(b),o.push(y),l=Math.max(b,l),u=Math.max(y,u)}$h(g,e);const C=m.indexOf(l),S=o.indexOf(u),O=E=>({width:m[E]||0,height:o[E]||0});return{first:O(0),last:O(e-1),widest:O(C),highest:O(S),widths:m,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Ia(this._alignToPixels?de(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=Kh(this.getContext(),t,s))}return this.$context||(this.$context=qh(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Wt(this.labelRotation),s=Math.abs(Math.cos(e)),c=Math.abs(Math.sin(e)),g=this._getLabelSizes(),m=t.autoSkipPadding||0,o=g?g.widest.width+m:0,n=g?g.highest.height+m:0;return this.isHorizontal()?n*s>o*c?o/s:n/c:n*c<o*s?n/s:o/c}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,c=this.options,{grid:g,position:m,border:o}=c,n=g.offset,l=this.isHorizontal(),r=this.ticks.length+(n?1:0),h=je(g),a=[],d=o.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,v=function(J){return de(s,J,p)};let _,b,y,x,C,S,O,E,R,z,V,K;if(m==="top")_=v(this.bottom),S=this.bottom-h,E=_-f,z=v(t.top)+f,K=t.bottom;else if(m==="bottom")_=v(this.top),z=t.top,K=v(t.bottom)-f,S=_+f,E=this.top+h;else if(m==="left")_=v(this.right),C=this.right-h,O=_-f,R=v(t.left)+f,V=t.right;else if(m==="right")_=v(this.left),R=t.left,V=v(t.right)-f,C=_+f,O=this.left+h;else if(e==="x"){if(m==="center")_=v((t.top+t.bottom)/2+.5);else if(ct(m)){const J=Object.keys(m)[0],et=m[J];_=v(this.chart.scales[J].getPixelForValue(et))}z=t.top,K=t.bottom,S=_+f,E=S+h}else if(e==="y"){if(m==="center")_=v((t.left+t.right)/2);else if(ct(m)){const J=Object.keys(m)[0],et=m[J];_=v(this.chart.scales[J].getPixelForValue(et))}C=_-f,O=C-h,R=t.left,V=t.right}const G=ht(c.ticks.maxTicksLimit,r),Y=Math.max(1,Math.ceil(r/G));for(b=0;b<r;b+=Y){const J=this.getContext(b),et=g.setContext(J),nt=o.setContext(J),w=et.lineWidth,P=et.color,D=nt.dash||[],M=nt.dashOffset,I=et.tickWidth,k=et.tickColor,T=et.tickBorderDash||[],A=et.tickBorderDashOffset;y=Gh(this,b,n),y!==void 0&&(x=de(s,y,w),l?C=O=R=V=x:S=E=z=K=x,a.push({tx1:C,ty1:S,tx2:O,ty2:E,x1:R,y1:z,x2:V,y2:K,width:w,color:P,borderDash:D,borderDashOffset:M,tickWidth:I,tickColor:k,tickBorderDash:T,tickBorderDashOffset:A}))}return this._ticksLength=r,this._borderValue=_,a}_computeLabelItems(t){const e=this.axis,s=this.options,{position:c,ticks:g}=s,m=this.isHorizontal(),o=this.ticks,{align:n,crossAlign:l,padding:u,mirror:r}=g,h=je(s.grid),a=h+u,d=r?-u:a,p=-Wt(this.labelRotation),f=[];let v,_,b,y,x,C,S,O,E,R,z,V,K="middle";if(c==="top")C=this.bottom-d,S=this._getXAxisLabelAlignment();else if(c==="bottom")C=this.top+d,S=this._getXAxisLabelAlignment();else if(c==="left"){const Y=this._getYAxisLabelAlignment(h);S=Y.textAlign,x=Y.x}else if(c==="right"){const Y=this._getYAxisLabelAlignment(h);S=Y.textAlign,x=Y.x}else if(e==="x"){if(c==="center")C=(t.top+t.bottom)/2+a;else if(ct(c)){const Y=Object.keys(c)[0],J=c[Y];C=this.chart.scales[Y].getPixelForValue(J)+a}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(c==="center")x=(t.left+t.right)/2-a;else if(ct(c)){const Y=Object.keys(c)[0],J=c[Y];x=this.chart.scales[Y].getPixelForValue(J)}S=this._getYAxisLabelAlignment(h).textAlign}e==="y"&&(n==="start"?K="top":n==="end"&&(K="bottom"));const G=this._getLabelSizes();for(v=0,_=o.length;v<_;++v){b=o[v],y=b.label;const Y=g.setContext(this.getContext(v));O=this.getPixelForTick(v)+g.labelOffset,E=this._resolveTickFontOptions(v),R=E.lineHeight,z=vt(y)?y.length:1;const J=z/2,et=Y.color,nt=Y.textStrokeColor,w=Y.textStrokeWidth;let P=S;m?(x=O,S==="inner"&&(v===_-1?P=this.options.reverse?"left":"right":v===0?P=this.options.reverse?"right":"left":P="center"),c==="top"?l==="near"||p!==0?V=-z*R+R/2:l==="center"?V=-G.highest.height/2-J*R+R:V=-G.highest.height+R/2:l==="near"||p!==0?V=R/2:l==="center"?V=G.highest.height/2-J*R:V=G.highest.height-z*R,r&&(V*=-1),p!==0&&!Y.showLabelBackdrop&&(x+=R/2*Math.sin(p))):(C=O,V=(1-z)*R/2);let D;if(Y.showLabelBackdrop){const M=At(Y.backdropPadding),I=G.heights[v],k=G.widths[v];let T=V-M.top,A=0-M.left;switch(K){case"middle":T-=I/2;break;case"bottom":T-=I;break}switch(S){case"center":A-=k/2;break;case"right":A-=k;break}D={left:A,top:T,width:k+M.width,height:I+M.height,color:Y.backdropColor}}f.push({label:y,font:E,textOffset:V,options:{rotation:p,color:et,strokeColor:nt,strokeWidth:w,textAlign:P,textBaseline:K,translation:[x,C],backdrop:D}})}return f}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Wt(this.labelRotation))return t==="top"?"left":"right";let c="center";return e.align==="start"?c="left":e.align==="end"?c="right":e.align==="inner"&&(c="inner"),c}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:c,padding:g}}=this.options,m=this._getLabelSizes(),o=t+g,n=m.widest.width;let l,u;return e==="left"?c?(u=this.right+g,s==="near"?l="left":s==="center"?(l="center",u+=n/2):(l="right",u+=n)):(u=this.right-o,s==="near"?l="right":s==="center"?(l="center",u-=n/2):(l="left",u=this.left)):e==="right"?c?(u=this.left+g,s==="near"?l="right":s==="center"?(l="center",u-=n/2):(l="left",u-=n)):(u=this.left+o,s==="near"?l="left":s==="center"?(l="center",u+=n/2):(l="right",u=this.right)):l="right",{textAlign:l,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:c,width:g,height:m}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,c,g,m),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const c=this.ticks.findIndex(g=>g.value===t);return c>=0?e.setContext(this.getContext(c)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,c=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let g,m;const o=(n,l,u)=>{!u.width||!u.color||(s.save(),s.lineWidth=u.width,s.strokeStyle=u.color,s.setLineDash(u.borderDash||[]),s.lineDashOffset=u.borderDashOffset,s.beginPath(),s.moveTo(n.x,n.y),s.lineTo(l.x,l.y),s.stroke(),s.restore())};if(e.display)for(g=0,m=c.length;g<m;++g){const n=c[g];e.drawOnChartArea&&o({x:n.x1,y:n.y1},{x:n.x2,y:n.y2},n),e.drawTicks&&o({x:n.tx1,y:n.ty1},{x:n.tx2,y:n.ty2},{color:n.tickColor,width:n.tickWidth,borderDash:n.tickBorderDash,borderDashOffset:n.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:c}}=this,g=s.setContext(this.getContext()),m=s.display?g.width:0;if(!m)return;const o=c.setContext(this.getContext(0)).lineWidth,n=this._borderValue;let l,u,r,h;this.isHorizontal()?(l=de(t,this.left,m)-m/2,u=de(t,this.right,o)+o/2,r=h=n):(r=de(t,this.top,m)-m/2,h=de(t,this.bottom,o)+o/2,l=u=n),e.save(),e.lineWidth=g.width,e.strokeStyle=g.color,e.beginPath(),e.moveTo(l,r),e.lineTo(u,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,c=this._computeLabelArea();c&&qi(s,c);const g=this.getLabelItems(t);for(const m of g){const o=m.options,n=m.font,l=m.label,u=m.textOffset;Ce(s,l,0,u,n,o)}c&&Ki(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:c}}=this;if(!s.display)return;const g=Tt(s.font),m=At(s.padding),o=s.align;let n=g.lineHeight/2;e==="bottom"||e==="center"||ct(e)?(n+=m.bottom,vt(s.text)&&(n+=g.lineHeight*(s.text.length-1))):n+=m.top;const{titleX:l,titleY:u,maxWidth:r,rotation:h}=Jh(this,n,e,o);Ce(t,s.text,0,0,g,{color:s.color,maxWidth:r,rotation:h,textAlign:Qh(o,e,c),textBaseline:"middle",translation:[l,u]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=ht(t.grid&&t.grid.z,-1),c=ht(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Se.prototype.draw?[{z:e,draw:g=>{this.draw(g)}}]:[{z:s,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:c,draw:()=>{this.drawBorder()}},{z:e,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",c=[];let g,m;for(g=0,m=e.length;g<m;++g){const o=e[g];o[s]===this.id&&(!t||o.type===t)&&c.push(o)}return c}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Tt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Ci{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;ec(e)&&(s=this.register(e));const c=this.items,g=t.id,m=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+t);return g in c||(c[g]=t,Zh(t,m,s),this.override&&Ct.override(t.id,t.overrides)),m}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,c=this.scope;s in e&&delete e[s],c&&s in Ct[c]&&(delete Ct[c][s],this.override&&delete xe[s])}}function Zh(i,t,e){const s=ni(Object.create(null),[e?Ct.get(e):{},Ct.get(t),i.defaults]);Ct.set(t,s),i.defaultRoutes&&tc(t,i.defaultRoutes),i.descriptors&&Ct.describe(t,i.descriptors)}function tc(i,t){Object.keys(t).forEach(e=>{const s=e.split("."),c=s.pop(),g=[i].concat(s).join("."),m=t[e].split("."),o=m.pop(),n=m.join(".");Ct.route(g,c,n,o)})}function ec(i){return"id"in i&&"defaults"in i}class ic{constructor(){this.controllers=new Ci(Ht,"datasets",!0),this.elements=new Ci(ee,"elements"),this.plugins=new Ci(Object,"plugins"),this.scales=new Ci(Se,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(c=>{const g=s||this._getRegistryForType(c);s||g.isForType(c)||g===this.plugins&&c.id?this._exec(t,g,c):pt(c,m=>{const o=s||this._getRegistryForType(m);this._exec(t,o,m)})})}_exec(t,e,s){const c=Ln(t);mt(s["before"+c],[],s),e[t](s),mt(s["after"+c],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const c=e.get(t);if(c===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return c}}var Yt=new ic;class nc{constructor(){this._init=[]}notify(t,e,s,c){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const g=c?this._descriptors(t).filter(c):this._descriptors(t),m=this._notify(g,t,e,s);return e==="afterDestroy"&&(this._notify(g,t,"stop"),this._notify(this._init,t,"uninstall")),m}_notify(t,e,s,c){c=c||{};for(const g of t){const m=g.plugin,o=m[s],n=[e,c,g.options];if(mt(o,n,m)===!1&&c.cancelable)return!1}return!0}invalidate(){dt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,c=ht(s.options&&s.options.plugins,{}),g=sc(s);return c===!1&&!e?[]:oc(t,g,c,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,c=(g,m)=>g.filter(o=>!m.some(n=>o.plugin.id===n.plugin.id));this._notify(c(e,s),t,"stop"),this._notify(c(s,e),t,"start")}}function sc(i){const t={},e=[],s=Object.keys(Yt.plugins.items);for(let g=0;g<s.length;g++)e.push(Yt.getPlugin(s[g]));const c=i.plugins||[];for(let g=0;g<c.length;g++){const m=c[g];e.indexOf(m)===-1&&(e.push(m),t[m.id]=!0)}return{plugins:e,localIds:t}}function rc(i,t){return!t&&i===!1?null:i===!0?{}:i}function oc(i,{plugins:t,localIds:e},s,c){const g=[],m=i.getContext();for(const o of t){const n=o.id,l=rc(s[n],c);l!==null&&g.push({plugin:o,options:ac(i.config,{plugin:o,local:e[n]},l,m)})}return g}function ac(i,{plugin:t,local:e},s,c){const g=i.pluginScopeKeys(t),m=i.getOptionScopes(s,g);return e&&t.defaults&&m.push(t.defaults),i.createResolver(m,c,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function yn(i,t){const e=Ct.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function lc(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function hc(i,t){return i===t?"_index_":"_value_"}function Ws(i){if(i==="x"||i==="y"||i==="r")return i}function cc(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function xn(i,...t){if(Ws(i))return i;for(const e of t){const s=e.axis||cc(e.position)||i.length>1&&Ws(i[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function Hs(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function uc(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===i||s.yAxisID===i);if(e.length)return Hs(i,"x",e[0])||Hs(i,"y",e[0])}return{}}function fc(i,t){const e=xe[i.type]||{scales:{}},s=t.scales||{},c=yn(i.type,t),g=Object.create(null);return Object.keys(s).forEach(m=>{const o=s[m];if(!ct(o))return console.error(`Invalid scale configuration for scale: ${m}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${m}`);const n=xn(m,o,uc(m,i),Ct.scales[o.type]),l=hc(n,c),u=e.scales||{};g[m]=$e(Object.create(null),[{axis:n},o,u[n],u[l]])}),i.data.datasets.forEach(m=>{const o=m.type||i.type,n=m.indexAxis||yn(o,t),u=(xe[o]||{}).scales||{};Object.keys(u).forEach(r=>{const h=lc(r,n),a=m[h+"AxisID"]||h;g[a]=g[a]||Object.create(null),$e(g[a],[{axis:h},s[a],u[r]])})}),Object.keys(g).forEach(m=>{const o=g[m];$e(o,[Ct.scales[o.type],Ct.scale])}),g}function ho(i){const t=i.options||(i.options={});t.plugins=ht(t.plugins,{}),t.scales=fc(i,t)}function co(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function dc(i){return i=i||{},i.data=co(i.data),ho(i),i}const Vs=new Map,uo=new Set;function Si(i,t){let e=Vs.get(i);return e||(e=t(),Vs.set(i,e),uo.add(e)),e}const ze=(i,t,e)=>{const s=le(t,e);s!==void 0&&i.add(s)};class gc{constructor(t){this._config=dc(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=co(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ho(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Si(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Si(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Si(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return Si(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let c=s.get(t);return(!c||e)&&(c=new Map,s.set(t,c)),c}getOptionScopes(t,e,s){const{options:c,type:g}=this,m=this._cachedScopes(t,s),o=m.get(e);if(o)return o;const n=new Set;e.forEach(u=>{t&&(n.add(t),u.forEach(r=>ze(n,t,r))),u.forEach(r=>ze(n,c,r)),u.forEach(r=>ze(n,xe[g]||{},r)),u.forEach(r=>ze(n,Ct,r)),u.forEach(r=>ze(n,vn,r))});const l=Array.from(n);return l.length===0&&l.push(Object.create(null)),uo.has(e)&&m.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,xe[e]||{},Ct.datasets[e]||{},{type:e},Ct,vn]}resolveNamedOptions(t,e,s,c=[""]){const g={$shared:!0},{resolver:m,subPrefixes:o}=Ns(this._resolverCache,t,c);let n=m;if(mc(m,e)){g.$shared=!1,s=he(s)?s():s;const l=this.createResolver(t,s,o);n=Ae(m,s,l)}for(const l of e)g[l]=n[l];return g}createResolver(t,e,s=[""],c){const{resolver:g}=Ns(this._resolverCache,t,s);return ct(e)?Ae(g,e,void 0,c):g}}function Ns(i,t,e){let s=i.get(t);s||(s=new Map,i.set(t,s));const c=e.join();let g=s.get(c);return g||(g={resolver:Wn(t,e),subPrefixes:e.filter(o=>!o.toLowerCase().includes("hover"))},s.set(c,g)),g}const pc=i=>ct(i)&&Object.getOwnPropertyNames(i).reduce((t,e)=>t||he(i[e]),!1);function mc(i,t){const{isScriptable:e,isIndexable:s}=Nr(i);for(const c of t){const g=e(c),m=s(c),o=(m||g)&&i[c];if(g&&(he(o)||pc(o))||m&&vt(o))return!0}return!1}var vc="4.4.0";const _c=["top","bottom","left","right","chartArea"];function Ys(i,t){return i==="top"||i==="bottom"||_c.indexOf(i)===-1&&t==="x"}function Xs(i,t){return function(e,s){return e[i]===s[i]?e[t]-s[t]:e[i]-s[i]}}function Us(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),mt(e&&e.onComplete,[i],t)}function bc(i){const t=i.chart,e=t.options.animation;mt(e&&e.onProgress,[i],t)}function fo(i){return qr()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const Ri={},Gs=i=>{const t=fo(i);return Object.values(Ri).filter(e=>e.canvas===t).pop()};function yc(i,t,e){const s=Object.keys(i);for(const c of s){const g=+c;if(g>=t){const m=i[c];delete i[c],(e>0||g>t)&&(i[g+e]=m)}}}function xc(i,t,e,s){return!e||i.type==="mouseout"?null:s?t:i}function wi(i,t,e){return i.options.clip?i[e]:t[e]}function Cc(i,t){const{xScale:e,yScale:s}=i;return e&&s?{left:wi(e,t,"left"),right:wi(e,t,"right"),top:wi(s,t,"top"),bottom:wi(s,t,"bottom")}:t}class Xt{static register(...t){Yt.add(...t),$s()}static unregister(...t){Yt.remove(...t),$s()}constructor(t,e){const s=this.config=new gc(e),c=fo(t),g=Gs(c);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const m=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||zh(c)),this.platform.updateConfig(s);const o=this.platform.acquireContext(c,m.aspectRatio),n=o&&o.canvas,l=n&&n.height,u=n&&n.width;if(this.id=wa(),this.ctx=o,this.canvas=n,this.width=u,this.height=l,this._options=m,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new nc,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Wa(r=>this.update(r),m.resizeDelay||0),this._dataChanges=[],Ri[this.id]=this,!o||!n){console.error("Failed to create chart: can't acquire context from the given item");return}$t.listen(this,"complete",Us),$t.listen(this,"progress",bc),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:c,_aspectRatio:g}=this;return dt(t)?e&&g?g:c?s/c:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Yt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ps(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return fs(this.canvas,this.ctx),this}stop(){return $t.stop(this),this}resize(t,e){$t.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,c=this.canvas,g=s.maintainAspectRatio&&this.aspectRatio,m=this.platform.getMaximumSize(c,t,e,g),o=s.devicePixelRatio||this.platform.getDevicePixelRatio(),n=this.width?"resize":"attach";this.width=m.width,this.height=m.height,this._aspectRatio=this.aspectRatio,ps(this,o,!0)&&(this.notifyPlugins("resize",{size:m}),mt(s.onResize,[this,m],this),this.attached&&this._doResize(n)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};pt(e,(s,c)=>{s.id=c})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,c=Object.keys(s).reduce((m,o)=>(m[o]=!1,m),{});let g=[];e&&(g=g.concat(Object.keys(e).map(m=>{const o=e[m],n=xn(m,o),l=n==="r",u=n==="x";return{options:o,dposition:l?"chartArea":u?"bottom":"left",dtype:l?"radialLinear":u?"category":"linear"}}))),pt(g,m=>{const o=m.options,n=o.id,l=xn(n,o),u=ht(o.type,m.dtype);(o.position===void 0||Ys(o.position,l)!==Ys(m.dposition))&&(o.position=m.dposition),c[n]=!0;let r=null;if(n in s&&s[n].type===u)r=s[n];else{const h=Yt.getScale(u);r=new h({id:n,type:u,ctx:this.ctx,chart:this}),s[r.id]=r}r.init(o,t)}),pt(c,(m,o)=>{m||delete s[o]}),pt(s,m=>{Dt.configure(this,m,m.options),Dt.addBox(this,m)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((c,g)=>c.index-g.index),s>e){for(let c=e;c<s;++c)this._destroyDatasetMeta(c);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(Xs("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,c)=>{e.filter(g=>g===s._dataset).length===0&&this._destroyDatasetMeta(c)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,c;for(this._removeUnreferencedMetasets(),s=0,c=e.length;s<c;s++){const g=e[s];let m=this.getDatasetMeta(s);const o=g.type||this.config.type;if(m.type&&m.type!==o&&(this._destroyDatasetMeta(s),m=this.getDatasetMeta(s)),m.type=o,m.indexAxis=g.indexAxis||yn(o,this.options),m.order=g.order||0,m.index=s,m.label=""+g.label,m.visible=this.isDatasetVisible(s),m.controller)m.controller.updateIndex(s),m.controller.linkScales();else{const n=Yt.getController(o),{datasetElementType:l,dataElementType:u}=Ct.datasets[o];Object.assign(n,{dataElementType:Yt.getElement(u),datasetElementType:l&&Yt.getElement(l)}),m.controller=new n(this,s),t.push(m.controller)}}return this._updateMetasets(),t}_resetElements(){pt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),c=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let m=0;for(let l=0,u=this.data.datasets.length;l<u;l++){const{controller:r}=this.getDatasetMeta(l),h=!c&&g.indexOf(r)===-1;r.buildOrUpdateElements(h),m=Math.max(+r.getMaxOverflow(),m)}m=this._minPadding=s.layout.autoPadding?m:0,this._updateLayout(m),c||pt(g,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Xs("z","_idx"));const{_active:o,_lastEvent:n}=this;n?this._eventHandler(n,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){pt(this.scales,t=>{Dt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!ns(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:c,count:g}of e){const m=s==="_removeElements"?-g:g;yc(t,c,m)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=g=>new Set(t.filter(m=>m[0]===g).map((m,o)=>o+","+m.splice(1).join(","))),c=s(0);for(let g=1;g<e;g++)if(!ns(c,s(g)))return;return Array.from(c).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Dt.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],pt(this.boxes,c=>{s&&c.position==="chartArea"||(c.configure&&c.configure(),this._layers.push(...c._layers()))},this),this._layers.forEach((c,g)=>{c._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,he(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),c={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",c)!==!1&&(s.controller._update(e),c.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",c))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&($t.has(this)?this.attached&&!$t.running(this)&&$t.start(this):(this.draw(),Us({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:c}=this._resizeBeforeDraw;this._resize(s,c),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let c,g;for(c=0,g=e.length;c<g;++c){const m=e[c];(!t||m.visible)&&s.push(m)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s=t._clip,c=!s.disabled,g=Cc(t,this.chartArea),m={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",m)!==!1&&(c&&qi(e,{left:s.left===!1?0:g.left-s.left,right:s.right===!1?this.width:g.right+s.right,top:s.top===!1?0:g.top-s.top,bottom:s.bottom===!1?this.height:g.bottom+s.bottom}),t.controller.draw(),c&&Ki(e),m.cancelable=!1,this.notifyPlugins("afterDatasetDraw",m))}isPointInArea(t){return Zt(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,c){const g=_h.modes[e];return typeof g=="function"?g(this,t,s,c):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let c=s.filter(g=>g&&g._dataset===e).pop();return c||(c={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(c)),c}getContext(){return this.$context||(this.$context=ce(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const c=s?"show":"hide",g=this.getDatasetMeta(t),m=g.controller._resolveAnimations(void 0,c);si(e)?(g.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),m.update(g,{visible:s}),this.update(o=>o.datasetIndex===t?c:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),$t.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),fs(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Ri[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(g,m)=>{e.addEventListener(this,g,m),t[g]=m},c=(g,m,o)=>{g.offsetX=m,g.offsetY=o,this._eventHandler(g)};pt(this.options.events,g=>s(g,c))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(n,l)=>{e.addEventListener(this,n,l),t[n]=l},c=(n,l)=>{t[n]&&(e.removeEventListener(this,n,l),delete t[n])},g=(n,l)=>{this.canvas&&this.resize(n,l)};let m;const o=()=>{c("attach",o),this.attached=!0,this.resize(),s("resize",g),s("detach",m)};m=()=>{this.attached=!1,c("resize",g),this._stop(),this._resize(0,0),s("attach",o)},e.isAttached(this.canvas)?o():m()}unbindEvents(){pt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},pt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const c=s?"set":"remove";let g,m,o,n;for(e==="dataset"&&(g=this.getDatasetMeta(t[0].datasetIndex),g.controller["_"+c+"DatasetHoverStyle"]()),o=0,n=t.length;o<n;++o){m=t[o];const l=m&&this.getDatasetMeta(m.datasetIndex).controller;l&&l[c+"HoverStyle"](m.element,m.datasetIndex,m.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:g,index:m})=>{const o=this.getDatasetMeta(g);if(!o)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:o.data[m],index:m}});!zi(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const c=this.options.hover,g=(n,l)=>n.filter(u=>!l.some(r=>u.datasetIndex===r.datasetIndex&&u.index===r.index)),m=g(e,t),o=s?t:g(t,e);m.length&&this.updateHoverStyle(m,c.mode,!1),o.length&&c.mode&&this.updateHoverStyle(o,c.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},c=m=>(m.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,c)===!1)return;const g=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,c),(g||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:c=[],options:g}=this,m=e,o=this._getActiveElements(t,c,s,m),n=Da(t),l=xc(t,this._lastEvent,s,n);s&&(this._lastEvent=null,mt(g.onHover,[t,o,this],this),n&&mt(g.onClick,[t,o,this],this));const u=!zi(o,c);return(u||e)&&(this._active=o,this._updateHoverStyles(o,c,e)),this._lastEvent=l,u}_getActiveElements(t,e,s,c){if(t.type==="mouseout")return[];if(!s)return e;const g=this.options.hover;return this.getElementsAtEventForMode(t,g.mode,g,c)}}Z(Xt,"defaults",Ct),Z(Xt,"instances",Ri),Z(Xt,"overrides",xe),Z(Xt,"registry",Yt),Z(Xt,"version",vc),Z(Xt,"getChart",Gs);function $s(){return pt(Xt.instances,i=>i._plugins.invalidate())}function Sc(i,t,e){const{startAngle:s,pixelMargin:c,x:g,y:m,outerRadius:o,innerRadius:n}=t;let l=c/o;i.beginPath(),i.arc(g,m,o,s-l,e+l),n>c?(l=c/n,i.arc(g,m,n,e+l,s-l,!0)):i.arc(g,m,c,e+St,s-St),i.closePath(),i.clip()}function wc(i){return zn(i,["outerStart","outerEnd","innerStart","innerEnd"])}function Tc(i,t,e,s){const c=wc(i.options.borderRadius),g=(e-t)/2,m=Math.min(g,s*t/2),o=n=>{const l=(e-Math.min(g,n))*s/2;return Mt(n,0,Math.min(g,l))};return{outerStart:o(c.outerStart),outerEnd:o(c.outerEnd),innerStart:Mt(c.innerStart,0,m),innerEnd:Mt(c.innerEnd,0,m)}}function Oe(i,t,e,s){return{x:e+i*Math.cos(t),y:s+i*Math.sin(t)}}function Xi(i,t,e,s,c,g){const{x:m,y:o,startAngle:n,pixelMargin:l,innerRadius:u}=t,r=Math.max(t.outerRadius+s+e-l,0),h=u>0?u+s+e+l:0;let a=0;const d=c-n;if(s){const Y=u>0?u-s:0,J=r>0?r-s:0,et=(Y+J)/2,nt=et!==0?d*et/(et+s):d;a=(d-nt)/2}const p=Math.max(.001,d*r-e/bt)/r,f=(d-p)/2,v=n+f+a,_=c-f-a,{outerStart:b,outerEnd:y,innerStart:x,innerEnd:C}=Tc(t,h,r,_-v),S=r-b,O=r-y,E=v+b/S,R=_-y/O,z=h+x,V=h+C,K=v+x/z,G=_-C/V;if(i.beginPath(),g){const Y=(E+R)/2;if(i.arc(m,o,r,E,Y),i.arc(m,o,r,Y,R),y>0){const w=Oe(O,R,m,o);i.arc(w.x,w.y,y,R,_+St)}const J=Oe(V,_,m,o);if(i.lineTo(J.x,J.y),C>0){const w=Oe(V,G,m,o);i.arc(w.x,w.y,C,_+St,G+Math.PI)}const et=(_-C/h+(v+x/h))/2;if(i.arc(m,o,h,_-C/h,et,!0),i.arc(m,o,h,et,v+x/h,!0),x>0){const w=Oe(z,K,m,o);i.arc(w.x,w.y,x,K+Math.PI,v-St)}const nt=Oe(S,v,m,o);if(i.lineTo(nt.x,nt.y),b>0){const w=Oe(S,E,m,o);i.arc(w.x,w.y,b,v-St,E)}}else{i.moveTo(m,o);const Y=Math.cos(E)*r+m,J=Math.sin(E)*r+o;i.lineTo(Y,J);const et=Math.cos(R)*r+m,nt=Math.sin(R)*r+o;i.lineTo(et,nt)}i.closePath()}function Oc(i,t,e,s,c){const{fullCircles:g,startAngle:m,circumference:o}=t;let n=t.endAngle;if(g){Xi(i,t,e,s,n,c);for(let l=0;l<g;++l)i.fill();isNaN(o)||(n=m+(o%_t||_t))}return Xi(i,t,e,s,n,c),i.fill(),n}function kc(i,t,e,s,c){const{fullCircles:g,startAngle:m,circumference:o,options:n}=t,{borderWidth:l,borderJoinStyle:u,borderDash:r,borderDashOffset:h}=n,a=n.borderAlign==="inner";if(!l)return;i.setLineDash(r||[]),i.lineDashOffset=h,a?(i.lineWidth=l*2,i.lineJoin=u||"round"):(i.lineWidth=l,i.lineJoin=u||"bevel");let d=t.endAngle;if(g){Xi(i,t,e,s,d,c);for(let p=0;p<g;++p)i.stroke();isNaN(o)||(d=m+(o%_t||_t))}a&&Sc(i,t,d),g||(Xi(i,t,e,s,d,c),i.stroke())}class Ye extends ee{constructor(e){super();Z(this,"circumference");Z(this,"endAngle");Z(this,"fullCircles");Z(this,"innerRadius");Z(this,"outerRadius");Z(this,"pixelMargin");Z(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,c){const g=this.getProps(["x","y"],c),{angle:m,distance:o}=Fr(g,{x:e,y:s}),{startAngle:n,endAngle:l,innerRadius:u,outerRadius:r,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],c),a=(this.options.spacing+this.options.borderWidth)/2,p=ht(h,l-n)>=_t||ri(m,n,l),f=Qt(o,u+a,r+a);return p&&f}getCenterPoint(e){const{x:s,y:c,startAngle:g,endAngle:m,innerRadius:o,outerRadius:n}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:l,spacing:u}=this.options,r=(g+m)/2,h=(o+n+u+l)/2;return{x:s+Math.cos(r)*h,y:c+Math.sin(r)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:c}=this,g=(s.offset||0)/4,m=(s.spacing||0)/2,o=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=c>_t?Math.floor(c/_t):0,c===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const n=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(n)*g,Math.sin(n)*g);const l=1-Math.sin(Math.min(bt,c||0)),u=g*l;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,Oc(e,this,u,m,o),kc(e,this,u,m,o),e.restore()}}Z(Ye,"id","arc"),Z(Ye,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),Z(Ye,"defaultRoutes",{backgroundColor:"backgroundColor"}),Z(Ye,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function go(i,t,e=t){i.lineCap=ht(e.borderCapStyle,t.borderCapStyle),i.setLineDash(ht(e.borderDash,t.borderDash)),i.lineDashOffset=ht(e.borderDashOffset,t.borderDashOffset),i.lineJoin=ht(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=ht(e.borderWidth,t.borderWidth),i.strokeStyle=ht(e.borderColor,t.borderColor)}function Mc(i,t,e){i.lineTo(e.x,e.y)}function Pc(i){return i.stepped?Ja:i.tension||i.cubicInterpolationMode==="monotone"?Za:Mc}function po(i,t,e={}){const s=i.length,{start:c=0,end:g=s-1}=e,{start:m,end:o}=t,n=Math.max(c,m),l=Math.min(g,o),u=c<m&&g<m||c>o&&g>o;return{count:s,start:n,loop:t.loop,ilen:l<n&&!u?s+l-n:l-n}}function Dc(i,t,e,s){const{points:c,options:g}=t,{count:m,start:o,loop:n,ilen:l}=po(c,e,s),u=Pc(g);let{move:r=!0,reverse:h}=s||{},a,d,p;for(a=0;a<=l;++a)d=c[(o+(h?l-a:a))%m],!d.skip&&(r?(i.moveTo(d.x,d.y),r=!1):u(i,p,d,h,g.stepped),p=d);return n&&(d=c[(o+(h?l:0))%m],u(i,p,d,h,g.stepped)),!!n}function Ac(i,t,e,s){const c=t.points,{count:g,start:m,ilen:o}=po(c,e,s),{move:n=!0,reverse:l}=s||{};let u=0,r=0,h,a,d,p,f,v;const _=y=>(m+(l?o-y:y))%g,b=()=>{p!==f&&(i.lineTo(u,f),i.lineTo(u,p),i.lineTo(u,v))};for(n&&(a=c[_(0)],i.moveTo(a.x,a.y)),h=0;h<=o;++h){if(a=c[_(h)],a.skip)continue;const y=a.x,x=a.y,C=y|0;C===d?(x<p?p=x:x>f&&(f=x),u=(r*u+y)/++r):(b(),i.lineTo(y,x),d=C,r=0,p=f=x),v=x}b()}function Cn(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Ac:Dc}function Ec(i){return i.stepped?Al:i.tension||i.cubicInterpolationMode==="monotone"?El:ve}function Fc(i,t,e,s){let c=t._path;c||(c=t._path=new Path2D,t.path(c,e,s)&&c.closePath()),go(i,t.options),i.stroke(c)}function Lc(i,t,e,s){const{segments:c,options:g}=t,m=Cn(t);for(const o of c)go(i,g,o.style),i.beginPath(),m(i,t,o,{start:e,end:e+s-1})&&i.closePath(),i.stroke()}const Rc=typeof Path2D=="function";function Ic(i,t,e,s){Rc&&!t.options.segment?Fc(i,t,e,s):Lc(i,t,e,s)}class se extends ee{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const c=s.spanGaps?this._loop:this._fullLoop;Sl(this._points,s,t,c,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=jl(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,c=t[e],g=this.points,m=to(this,{property:e,start:c,end:c});if(!m.length)return;const o=[],n=Ec(s);let l,u;for(l=0,u=m.length;l<u;++l){const{start:r,end:h}=m[l],a=g[r],d=g[h];if(a===d){o.push(a);continue}const p=Math.abs((c-a[e])/(d[e]-a[e])),f=n(a,d,p,s.stepped);f[e]=t[e],o.push(f)}return o.length===1?o[0]:o}pathSegment(t,e,s){return Cn(this)(t,this,e,s)}path(t,e,s){const c=this.segments,g=Cn(this);let m=this._loop;e=e||0,s=s||this.points.length-e;for(const o of c)m&=g(t,this,o,{start:e,end:e+s-1});return!!m}draw(t,e,s,c){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(t.save(),Ic(t,this,s,c),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Z(se,"id","line"),Z(se,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Z(se,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Z(se,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function qs(i,t,e,s){const c=i.options,{[e]:g}=i.getProps([e],s);return Math.abs(t-g)<c.radius+c.hitRadius}class Ii extends ee{constructor(e){super();Z(this,"parsed");Z(this,"skip");Z(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,c){const g=this.options,{x:m,y:o}=this.getProps(["x","y"],c);return Math.pow(e-m,2)+Math.pow(s-o,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(e,s){return qs(this,e,"x",s)}inYRange(e,s){return qs(this,e,"y",s)}getCenterPoint(e){const{x:s,y:c}=this.getProps(["x","y"],e);return{x:s,y:c}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const c=s&&e.borderWidth||0;return(s+c)*2}draw(e,s){const c=this.options;this.skip||c.radius<.1||!Zt(this,s,this.size(c)/2)||(e.strokeStyle=c.borderColor,e.lineWidth=c.borderWidth,e.fillStyle=c.backgroundColor,_n(e,c,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}Z(Ii,"id","point"),Z(Ii,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Z(Ii,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function mo(i,t){const{x:e,y:s,base:c,width:g,height:m}=i.getProps(["x","y","base","width","height"],t);let o,n,l,u,r;return i.horizontal?(r=m/2,o=Math.min(e,c),n=Math.max(e,c),l=s-r,u=s+r):(r=g/2,o=e-r,n=e+r,l=Math.min(s,c),u=Math.max(s,c)),{left:o,top:l,right:n,bottom:u}}function re(i,t,e,s){return i?0:Mt(t,e,s)}function Bc(i,t,e){const s=i.options.borderWidth,c=i.borderSkipped,g=Vr(s);return{t:re(c.top,g.top,0,e),r:re(c.right,g.right,0,t),b:re(c.bottom,g.bottom,0,e),l:re(c.left,g.left,0,t)}}function jc(i,t,e){const{enableBorderRadius:s}=i.getProps(["enableBorderRadius"]),c=i.options.borderRadius,g=be(c),m=Math.min(t,e),o=i.borderSkipped,n=s||ct(c);return{topLeft:re(!n||o.top||o.left,g.topLeft,0,m),topRight:re(!n||o.top||o.right,g.topRight,0,m),bottomLeft:re(!n||o.bottom||o.left,g.bottomLeft,0,m),bottomRight:re(!n||o.bottom||o.right,g.bottomRight,0,m)}}function zc(i){const t=mo(i),e=t.right-t.left,s=t.bottom-t.top,c=Bc(i,e/2,s/2),g=jc(i,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:g},inner:{x:t.left+c.l,y:t.top+c.t,w:e-c.l-c.r,h:s-c.t-c.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(c.t,c.l)),topRight:Math.max(0,g.topRight-Math.max(c.t,c.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(c.b,c.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(c.b,c.r))}}}}function un(i,t,e,s){const c=t===null,g=e===null,o=i&&!(c&&g)&&mo(i,s);return o&&(c||Qt(t,o.left,o.right))&&(g||Qt(e,o.top,o.bottom))}function Wc(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function Hc(i,t){i.rect(t.x,t.y,t.w,t.h)}function fn(i,t,e={}){const s=i.x!==e.x?-t:0,c=i.y!==e.y?-t:0,g=(i.x+i.w!==e.x+e.w?t:0)-s,m=(i.y+i.h!==e.y+e.h?t:0)-c;return{x:i.x+s,y:i.y+c,w:i.w+g,h:i.h+m,radius:i.radius}}class Bi extends ee{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:c}}=this,{inner:g,outer:m}=zc(this),o=Wc(m.radius)?oi:Hc;t.save(),(m.w!==g.w||m.h!==g.h)&&(t.beginPath(),o(t,fn(m,e,g)),t.clip(),o(t,fn(g,-e,m)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),o(t,fn(g,e)),t.fillStyle=c,t.fill(),t.restore()}inRange(t,e,s){return un(this,t,e,s)}inXRange(t,e){return un(this,t,null,e)}inYRange(t,e){return un(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:c,horizontal:g}=this.getProps(["x","y","base","horizontal"],t);return{x:g?(e+c)/2:e,y:g?s:(s+c)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}Z(Bi,"id","bar"),Z(Bi,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Z(Bi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Vc=Object.freeze({__proto__:null,ArcElement:Ye,BarElement:Bi,LineElement:se,PointElement:Ii});const Sn=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Ks=Sn.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function vo(i){return Sn[i%Sn.length]}function _o(i){return Ks[i%Ks.length]}function Nc(i,t){return i.borderColor=vo(t),i.backgroundColor=_o(t),++t}function Yc(i,t){return i.backgroundColor=i.data.map(()=>vo(t++)),t}function Xc(i,t){return i.backgroundColor=i.data.map(()=>_o(t++)),t}function Uc(i){let t=0;return(e,s)=>{const c=i.getDatasetMeta(s).controller;c instanceof _e?t=Yc(e,t):c instanceof Je?t=Xc(e,t):c&&(t=Nc(e,t))}}function Qs(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function Gc(i){return i&&(i.borderColor||i.backgroundColor)}var $c={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:s},options:c}=i.config,{elements:g}=c;if(!e.forceOverride&&(Qs(s)||Gc(c)||g&&Qs(g)))return;const m=Uc(i);s.forEach(m)}};function qc(i,t,e,s,c){const g=c.samples||s;if(g>=e)return i.slice(t,t+e);const m=[],o=(e-2)/(g-2);let n=0;const l=t+e-1;let u=t,r,h,a,d,p;for(m[n++]=i[u],r=0;r<g-2;r++){let f=0,v=0,_;const b=Math.floor((r+1)*o)+1+t,y=Math.min(Math.floor((r+2)*o)+1,e)+t,x=y-b;for(_=b;_<y;_++)f+=i[_].x,v+=i[_].y;f/=x,v/=x;const C=Math.floor(r*o)+1+t,S=Math.min(Math.floor((r+1)*o)+1,e)+t,{x:O,y:E}=i[u];for(a=d=-1,_=C;_<S;_++)d=.5*Math.abs((O-f)*(i[_].y-E)-(O-i[_].x)*(v-E)),d>a&&(a=d,h=i[_],p=_);m[n++]=h,u=p}return m[n++]=i[l],m}function Kc(i,t,e,s){let c=0,g=0,m,o,n,l,u,r,h,a,d,p;const f=[],v=t+e-1,_=i[t].x,y=i[v].x-_;for(m=t;m<t+e;++m){o=i[m],n=(o.x-_)/y*s,l=o.y;const x=n|0;if(x===u)l<d?(d=l,r=m):l>p&&(p=l,h=m),c=(g*c+o.x)/++g;else{const C=m-1;if(!dt(r)&&!dt(h)){const S=Math.min(r,h),O=Math.max(r,h);S!==a&&S!==C&&f.push({...i[S],x:c}),O!==a&&O!==C&&f.push({...i[O],x:c})}m>0&&C!==a&&f.push(i[C]),f.push(o),u=x,g=0,d=p=l,r=h=a=m}}return f}function bo(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Js(i){i.data.datasets.forEach(t=>{bo(t)})}function Qc(i,t){const e=t.length;let s=0,c;const{iScale:g}=i,{min:m,max:o,minDefined:n,maxDefined:l}=g.getUserBounds();return n&&(s=Mt(Jt(t,g.axis,m).lo,0,e-1)),l?c=Mt(Jt(t,g.axis,o).hi+1,s,e)-s:c=e-s,{start:s,count:c}}var Jc={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){Js(i);return}const s=i.width;i.data.datasets.forEach((c,g)=>{const{_data:m,indexAxis:o}=c,n=i.getDatasetMeta(g),l=m||c.data;if(Ve([o,i.options.indexAxis])==="y"||!n.controller.supportsDecimation)return;const u=i.scales[n.xAxisID];if(u.type!=="linear"&&u.type!=="time"||i.options.parsing)return;let{start:r,count:h}=Qc(n,l);const a=e.threshold||4*s;if(h<=a){bo(c);return}dt(m)&&(c._data=l,delete c.data,Object.defineProperty(c,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let d;switch(e.algorithm){case"lttb":d=qc(l,r,h,s,e);break;case"min-max":d=Kc(l,r,h,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}c._decimated=d})},destroy(i){Js(i)}};function Zc(i,t,e){const s=i.segments,c=i.points,g=t.points,m=[];for(const o of s){let{start:n,end:l}=o;l=Xn(n,l,c);const u=wn(e,c[n],c[l],o.loop);if(!t.segments){m.push({source:o,target:u,start:c[n],end:c[l]});continue}const r=to(t,u);for(const h of r){const a=wn(e,g[h.start],g[h.end],h.loop),d=Zr(o,c,a);for(const p of d)m.push({source:p,target:h,start:{[e]:Zs(u,a,"start",Math.max)},end:{[e]:Zs(u,a,"end",Math.min)}})}}return m}function wn(i,t,e,s){if(s)return;let c=t[i],g=e[i];return i==="angle"&&(c=jt(c),g=jt(g)),{property:i,start:c,end:g}}function tu(i,t){const{x:e=null,y:s=null}=i||{},c=t.points,g=[];return t.segments.forEach(({start:m,end:o})=>{o=Xn(m,o,c);const n=c[m],l=c[o];s!==null?(g.push({x:n.x,y:s}),g.push({x:l.x,y:s})):e!==null&&(g.push({x:e,y:n.y}),g.push({x:e,y:l.y}))}),g}function Xn(i,t,e){for(;t>i;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function Zs(i,t,e,s){return i&&t?s(i[e],t[e]):i?i[e]:t?t[e]:0}function yo(i,t){let e=[],s=!1;return vt(i)?(s=!0,e=i):e=tu(i,t),e.length?new se({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function tr(i){return i&&i.fill!==!1}function eu(i,t,e){let c=i[t].fill;const g=[t];let m;if(!e)return c;for(;c!==!1&&g.indexOf(c)===-1;){if(!xt(c))return c;if(m=i[c],!m)return!1;if(m.visible)return c;g.push(c),c=m.fill}return!1}function iu(i,t,e){const s=ou(i);if(ct(s))return isNaN(s.value)?!1:s;let c=parseFloat(s);return xt(c)&&Math.floor(c)===c?nu(s[0],t,c,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function nu(i,t,e,s){return(i==="-"||i==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function su(i,t){let e=null;return i==="start"?e=t.bottom:i==="end"?e=t.top:ct(i)?e=t.getPixelForValue(i.value):t.getBasePixel&&(e=t.getBasePixel()),e}function ru(i,t,e){let s;return i==="start"?s=e:i==="end"?s=t.options.reverse?t.min:t.max:ct(i)?s=i.value:s=t.getBaseValue(),s}function ou(i){const t=i.options,e=t.fill;let s=ht(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function au(i){const{scale:t,index:e,line:s}=i,c=[],g=s.segments,m=s.points,o=lu(t,e);o.push(yo({x:null,y:t.bottom},s));for(let n=0;n<g.length;n++){const l=g[n];for(let u=l.start;u<=l.end;u++)hu(c,m[u],o)}return new se({points:c,options:{}})}function lu(i,t){const e=[],s=i.getMatchingVisibleMetas("line");for(let c=0;c<s.length;c++){const g=s[c];if(g.index===t)break;g.hidden||e.unshift(g.dataset)}return e}function hu(i,t,e){const s=[];for(let c=0;c<e.length;c++){const g=e[c],{first:m,last:o,point:n}=cu(g,t,"x");if(!(!n||m&&o)){if(m)s.unshift(n);else if(i.push(n),!o)break}}i.push(...s)}function cu(i,t,e){const s=i.interpolate(t,e);if(!s)return{};const c=s[e],g=i.segments,m=i.points;let o=!1,n=!1;for(let l=0;l<g.length;l++){const u=g[l],r=m[u.start][e],h=m[u.end][e];if(Qt(c,r,h)){o=c===r,n=c===h;break}}return{first:o,last:n,point:s}}class xo{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:c,y:g,radius:m}=this;return e=e||{start:0,end:_t},t.arc(c,g,m,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:c}=this,g=t.angle;return{x:e+Math.cos(g)*c,y:s+Math.sin(g)*c,angle:g}}}function uu(i){const{chart:t,fill:e,line:s}=i;if(xt(e))return fu(t,e);if(e==="stack")return au(i);if(e==="shape")return!0;const c=du(i);return c instanceof xo?c:yo(c,s)}function fu(i,t){const e=i.getDatasetMeta(t);return e&&i.isDatasetVisible(t)?e.dataset:null}function du(i){return(i.scale||{}).getPointPositionForValue?pu(i):gu(i)}function gu(i){const{scale:t={},fill:e}=i,s=su(e,t);if(xt(s)){const c=t.isHorizontal();return{x:c?s:null,y:c?null:s}}return null}function pu(i){const{scale:t,fill:e}=i,s=t.options,c=t.getLabels().length,g=s.reverse?t.max:t.min,m=ru(e,t,g),o=[];if(s.grid.circular){const n=t.getPointPositionForValue(0,g);return new xo({x:n.x,y:n.y,radius:t.getDistanceFromCenterForValue(m)})}for(let n=0;n<c;++n)o.push(t.getPointPositionForValue(n,m));return o}function dn(i,t,e){const s=uu(t),{line:c,scale:g,axis:m}=t,o=c.options,n=o.fill,l=o.backgroundColor,{above:u=l,below:r=l}=n||{};s&&c.points.length&&(qi(i,e),mu(i,{line:c,target:s,above:u,below:r,area:e,scale:g,axis:m}),Ki(i))}function mu(i,t){const{line:e,target:s,above:c,below:g,area:m,scale:o}=t,n=e._loop?"angle":t.axis;i.save(),n==="x"&&g!==c&&(er(i,s,m.top),ir(i,{line:e,target:s,color:c,scale:o,property:n}),i.restore(),i.save(),er(i,s,m.bottom)),ir(i,{line:e,target:s,color:g,scale:o,property:n}),i.restore()}function er(i,t,e){const{segments:s,points:c}=t;let g=!0,m=!1;i.beginPath();for(const o of s){const{start:n,end:l}=o,u=c[n],r=c[Xn(n,l,c)];g?(i.moveTo(u.x,u.y),g=!1):(i.lineTo(u.x,e),i.lineTo(u.x,u.y)),m=!!t.pathSegment(i,o,{move:m}),m?i.closePath():i.lineTo(r.x,e)}i.lineTo(t.first().x,e),i.closePath(),i.clip()}function ir(i,t){const{line:e,target:s,property:c,color:g,scale:m}=t,o=Zc(e,s,c);for(const{source:n,target:l,start:u,end:r}of o){const{style:{backgroundColor:h=g}={}}=n,a=s!==!0;i.save(),i.fillStyle=h,vu(i,m,a&&wn(c,u,r)),i.beginPath();const d=!!e.pathSegment(i,n);let p;if(a){d?i.closePath():nr(i,s,r,c);const f=!!s.pathSegment(i,l,{move:d,reverse:!0});p=d&&f,p||nr(i,s,u,c)}i.closePath(),i.fill(p?"evenodd":"nonzero"),i.restore()}}function vu(i,t,e){const{top:s,bottom:c}=t.chart.chartArea,{property:g,start:m,end:o}=e||{};g==="x"&&(i.beginPath(),i.rect(m,s,o-m,c-s),i.clip())}function nr(i,t,e,s){const c=t.interpolate(e,s);c&&i.lineTo(c.x,c.y)}var _u={id:"filler",afterDatasetsUpdate(i,t,e){const s=(i.data.datasets||[]).length,c=[];let g,m,o,n;for(m=0;m<s;++m)g=i.getDatasetMeta(m),o=g.dataset,n=null,o&&o.options&&o instanceof se&&(n={visible:i.isDatasetVisible(m),index:m,fill:iu(o,m,s),chart:i,axis:g.controller.options.indexAxis,scale:g.vScale,line:o}),g.$filler=n,c.push(n);for(m=0;m<s;++m)n=c[m],!(!n||n.fill===!1)&&(n.fill=eu(c,m,e.propagate))},beforeDraw(i,t,e){const s=e.drawTime==="beforeDraw",c=i.getSortedVisibleDatasetMetas(),g=i.chartArea;for(let m=c.length-1;m>=0;--m){const o=c[m].$filler;o&&(o.line.updateControlPoints(g,o.axis),s&&o.fill&&dn(i.ctx,o,g))}},beforeDatasetsDraw(i,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=i.getSortedVisibleDatasetMetas();for(let c=s.length-1;c>=0;--c){const g=s[c].$filler;tr(g)&&dn(i.ctx,g,i.chartArea)}},beforeDatasetDraw(i,t,e){const s=t.meta.$filler;!tr(s)||e.drawTime!=="beforeDatasetDraw"||dn(i.ctx,s,i.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const sr=(i,t)=>{let{boxHeight:e=t,boxWidth:s=t}=i;return i.usePointStyle&&(e=Math.min(e,t),s=i.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},bu=(i,t)=>i!==null&&t!==null&&i.datasetIndex===t.datasetIndex&&i.index===t.index;class rr extends ee{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=mt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,c)=>t.sort(s,c,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,c=Tt(s.font),g=c.size,m=this._computeTitleHeight(),{boxWidth:o,itemHeight:n}=sr(s,g);let l,u;e.font=c.string,this.isHorizontal()?(l=this.maxWidth,u=this._fitRows(m,g,o,n)+10):(u=this.maxHeight,l=this._fitCols(m,c,o,n)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(u,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,c){const{ctx:g,maxWidth:m,options:{labels:{padding:o}}}=this,n=this.legendHitBoxes=[],l=this.lineWidths=[0],u=c+o;let r=t;g.textAlign="left",g.textBaseline="middle";let h=-1,a=-u;return this.legendItems.forEach((d,p)=>{const f=s+e/2+g.measureText(d.text).width;(p===0||l[l.length-1]+f+2*o>m)&&(r+=u,l[l.length-(p>0?0:1)]=0,a+=u,h++),n[p]={left:0,top:a,row:h,width:f,height:c},l[l.length-1]+=f+o}),r}_fitCols(t,e,s,c){const{ctx:g,maxHeight:m,options:{labels:{padding:o}}}=this,n=this.legendHitBoxes=[],l=this.columnSizes=[],u=m-t;let r=o,h=0,a=0,d=0,p=0;return this.legendItems.forEach((f,v)=>{const{itemWidth:_,itemHeight:b}=yu(s,e,g,f,c);v>0&&a+b+2*o>u&&(r+=h+o,l.push({width:h,height:a}),d+=h+o,p++,h=a=0),n[v]={left:d,top:a,col:p,width:_,height:b},h=Math.max(h,_),a+=b+o}),r+=h,l.push({width:h,height:a}),r}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:c},rtl:g}}=this,m=Pe(g,this.left,this.width);if(this.isHorizontal()){let o=0,n=Pt(s,this.left+c,this.right-this.lineWidths[o]);for(const l of e)o!==l.row&&(o=l.row,n=Pt(s,this.left+c,this.right-this.lineWidths[o])),l.top+=this.top+t+c,l.left=m.leftForLtr(m.x(n),l.width),n+=l.width+c}else{let o=0,n=Pt(s,this.top+t+c,this.bottom-this.columnSizes[o].height);for(const l of e)l.col!==o&&(o=l.col,n=Pt(s,this.top+t+c,this.bottom-this.columnSizes[o].height)),l.top=n,l.left+=this.left+c,l.left=m.leftForLtr(m.x(l.left),l.width),n+=l.height+c}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;qi(t,this),this._draw(),Ki(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:c}=this,{align:g,labels:m}=t,o=Ct.color,n=Pe(t.rtl,this.left,this.width),l=Tt(m.font),{padding:u}=m,r=l.size,h=r/2;let a;this.drawTitle(),c.textAlign=n.textAlign("left"),c.textBaseline="middle",c.lineWidth=.5,c.font=l.string;const{boxWidth:d,boxHeight:p,itemHeight:f}=sr(m,r),v=function(C,S,O){if(isNaN(d)||d<=0||isNaN(p)||p<0)return;c.save();const E=ht(O.lineWidth,1);if(c.fillStyle=ht(O.fillStyle,o),c.lineCap=ht(O.lineCap,"butt"),c.lineDashOffset=ht(O.lineDashOffset,0),c.lineJoin=ht(O.lineJoin,"miter"),c.lineWidth=E,c.strokeStyle=ht(O.strokeStyle,o),c.setLineDash(ht(O.lineDash,[])),m.usePointStyle){const R={radius:p*Math.SQRT2/2,pointStyle:O.pointStyle,rotation:O.rotation,borderWidth:E},z=n.xPlus(C,d/2),V=S+h;Hr(c,R,z,V,m.pointStyleWidth&&d)}else{const R=S+Math.max((r-p)/2,0),z=n.leftForLtr(C,d),V=be(O.borderRadius);c.beginPath(),Object.values(V).some(K=>K!==0)?oi(c,{x:z,y:R,w:d,h:p,radius:V}):c.rect(z,R,d,p),c.fill(),E!==0&&c.stroke()}c.restore()},_=function(C,S,O){Ce(c,O.text,C,S+f/2,l,{strikethrough:O.hidden,textAlign:n.textAlign(O.textAlign)})},b=this.isHorizontal(),y=this._computeTitleHeight();b?a={x:Pt(g,this.left+u,this.right-s[0]),y:this.top+u+y,line:0}:a={x:this.left+u,y:Pt(g,this.top+y+u,this.bottom-e[0].height),line:0},Kr(this.ctx,t.textDirection);const x=f+u;this.legendItems.forEach((C,S)=>{c.strokeStyle=C.fontColor,c.fillStyle=C.fontColor;const O=c.measureText(C.text).width,E=n.textAlign(C.textAlign||(C.textAlign=m.textAlign)),R=d+h+O;let z=a.x,V=a.y;n.setWidth(this.width),b?S>0&&z+R+u>this.right&&(V=a.y+=x,a.line++,z=a.x=Pt(g,this.left+u,this.right-s[a.line])):S>0&&V+x>this.bottom&&(z=a.x=z+e[a.line].width+u,a.line++,V=a.y=Pt(g,this.top+y+u,this.bottom-e[a.line].height));const K=n.x(z);if(v(K,V,C),z=Ha(E,z+d+h,b?z+R:this.right,t.rtl),_(n.x(z),V,C),b)a.x+=R+u;else if(typeof C.text!="string"){const G=l.lineHeight;a.y+=Co(C,G)+u}else a.y+=x}),Qr(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=Tt(e.font),c=At(e.padding);if(!e.display)return;const g=Pe(t.rtl,this.left,this.width),m=this.ctx,o=e.position,n=s.size/2,l=c.top+n;let u,r=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),u=this.top+l,r=Pt(t.align,r,this.right-h);else{const d=this.columnSizes.reduce((p,f)=>Math.max(p,f.height),0);u=l+Pt(t.align,this.top,this.bottom-d-t.labels.padding-this._computeTitleHeight())}const a=Pt(o,r,r+h);m.textAlign=g.textAlign(Bn(o)),m.textBaseline="middle",m.strokeStyle=e.color,m.fillStyle=e.color,m.font=s.string,Ce(m,e.text,a,u,s)}_computeTitleHeight(){const t=this.options.title,e=Tt(t.font),s=At(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,c,g;if(Qt(t,this.left,this.right)&&Qt(e,this.top,this.bottom)){for(g=this.legendHitBoxes,s=0;s<g.length;++s)if(c=g[s],Qt(t,c.left,c.left+c.width)&&Qt(e,c.top,c.top+c.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!Su(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const c=this._hoveredItem,g=bu(c,s);c&&!g&&mt(e.onLeave,[t,c,this],this),this._hoveredItem=s,s&&!g&&mt(e.onHover,[t,s,this],this)}else s&&mt(e.onClick,[t,s,this],this)}}function yu(i,t,e,s,c){const g=xu(s,i,t,e),m=Cu(c,s,t.lineHeight);return{itemWidth:g,itemHeight:m}}function xu(i,t,e,s){let c=i.text;return c&&typeof c!="string"&&(c=c.reduce((g,m)=>g.length>m.length?g:m)),t+e.size/2+s.measureText(c).width}function Cu(i,t,e){let s=i;return typeof t.text!="string"&&(s=Co(t,e)),s}function Co(i,t){const e=i.text?i.text.length:0;return t*e}function Su(i,t){return!!((i==="mousemove"||i==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(i==="click"||i==="mouseup"))}var wu={id:"legend",_element:rr,start(i,t,e){const s=i.legend=new rr({ctx:i.ctx,options:e,chart:i});Dt.configure(i,s,e),Dt.addBox(i,s)},stop(i){Dt.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,t,e){const s=i.legend;Dt.configure(i,s,e),s.options=e},afterUpdate(i){const t=i.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(i,t){t.replay||i.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,t,e){const s=t.datasetIndex,c=e.chart;c.isDatasetVisible(s)?(c.hide(s),t.hidden=!0):(c.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const t=i.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:c,color:g,useBorderRadius:m,borderRadius:o}}=i.legend.options;return i._getSortedDatasetMetas().map(n=>{const l=n.controller.getStyle(e?0:void 0),u=At(l.borderWidth);return{text:t[n.index].label,fillStyle:l.backgroundColor,fontColor:g,hidden:!n.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:l.borderColor,pointStyle:s||l.pointStyle,rotation:l.rotation,textAlign:c||l.textAlign,borderRadius:m&&(o||l.borderRadius),datasetIndex:n.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};class Un extends ee{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const c=vt(s.text)?s.text.length:1;this._padding=At(s.padding);const g=c*Tt(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:c,right:g,options:m}=this,o=m.align;let n=0,l,u,r;return this.isHorizontal()?(u=Pt(o,s,g),r=e+t,l=g-s):(m.position==="left"?(u=s+t,r=Pt(o,c,e),n=bt*-.5):(u=g-t,r=Pt(o,e,c),n=bt*.5),l=c-e),{titleX:u,titleY:r,maxWidth:l,rotation:n}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=Tt(e.font),g=s.lineHeight/2+this._padding.top,{titleX:m,titleY:o,maxWidth:n,rotation:l}=this._drawArgs(g);Ce(t,e.text,0,0,s,{color:e.color,maxWidth:n,rotation:l,textAlign:Bn(e.align),textBaseline:"middle",translation:[m,o]})}}function Tu(i,t){const e=new Un({ctx:i.ctx,options:t,chart:i});Dt.configure(i,e,t),Dt.addBox(i,e),i.titleBlock=e}var Ou={id:"title",_element:Un,start(i,t,e){Tu(i,e)},stop(i){const t=i.titleBlock;Dt.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const s=i.titleBlock;Dt.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ti=new WeakMap;var ku={id:"subtitle",start(i,t,e){const s=new Un({ctx:i.ctx,options:e,chart:i});Dt.configure(i,s,e),Dt.addBox(i,s),Ti.set(i,s)},stop(i){Dt.removeBox(i,Ti.get(i)),Ti.delete(i)},beforeUpdate(i,t,e){const s=Ti.get(i);Dt.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Xe={average(i){if(!i.length)return!1;let t,e,s=0,c=0,g=0;for(t=0,e=i.length;t<e;++t){const m=i[t].element;if(m&&m.hasValue()){const o=m.tooltipPosition();s+=o.x,c+=o.y,++g}}return{x:s/g,y:c/g}},nearest(i,t){if(!i.length)return!1;let e=t.x,s=t.y,c=Number.POSITIVE_INFINITY,g,m,o;for(g=0,m=i.length;g<m;++g){const n=i[g].element;if(n&&n.hasValue()){const l=n.getCenterPoint(),u=mn(t,l);u<c&&(c=u,o=n)}}if(o){const n=o.tooltipPosition();e=n.x,s=n.y}return{x:e,y:s}}};function Nt(i,t){return t&&(vt(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function qt(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function Mu(i,t){const{element:e,datasetIndex:s,index:c}=t,g=i.getDatasetMeta(s).controller,{label:m,value:o}=g.getLabelAndValue(c);return{chart:i,label:m,parsed:g.getParsed(c),raw:i.data.datasets[s].data[c],formattedValue:o,dataset:g.getDataset(),dataIndex:c,datasetIndex:s,element:e}}function or(i,t){const e=i.chart.ctx,{body:s,footer:c,title:g}=i,{boxWidth:m,boxHeight:o}=t,n=Tt(t.bodyFont),l=Tt(t.titleFont),u=Tt(t.footerFont),r=g.length,h=c.length,a=s.length,d=At(t.padding);let p=d.height,f=0,v=s.reduce((y,x)=>y+x.before.length+x.lines.length+x.after.length,0);if(v+=i.beforeBody.length+i.afterBody.length,r&&(p+=r*l.lineHeight+(r-1)*t.titleSpacing+t.titleMarginBottom),v){const y=t.displayColors?Math.max(o,n.lineHeight):n.lineHeight;p+=a*y+(v-a)*n.lineHeight+(v-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*u.lineHeight+(h-1)*t.footerSpacing);let _=0;const b=function(y){f=Math.max(f,e.measureText(y).width+_)};return e.save(),e.font=l.string,pt(i.title,b),e.font=n.string,pt(i.beforeBody.concat(i.afterBody),b),_=t.displayColors?m+2+t.boxPadding:0,pt(s,y=>{pt(y.before,b),pt(y.lines,b),pt(y.after,b)}),_=0,e.font=u.string,pt(i.footer,b),e.restore(),f+=d.width,{width:f,height:p}}function Pu(i,t){const{y:e,height:s}=t;return e<s/2?"top":e>i.height-s/2?"bottom":"center"}function Du(i,t,e,s){const{x:c,width:g}=s,m=e.caretSize+e.caretPadding;if(i==="left"&&c+g+m>t.width||i==="right"&&c-g-m<0)return!0}function Au(i,t,e,s){const{x:c,width:g}=e,{width:m,chartArea:{left:o,right:n}}=i;let l="center";return s==="center"?l=c<=(o+n)/2?"left":"right":c<=g/2?l="left":c>=m-g/2&&(l="right"),Du(l,i,t,e)&&(l="center"),l}function ar(i,t,e){const s=e.yAlign||t.yAlign||Pu(i,e);return{xAlign:e.xAlign||t.xAlign||Au(i,t,e,s),yAlign:s}}function Eu(i,t){let{x:e,width:s}=i;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function Fu(i,t,e){let{y:s,height:c}=i;return t==="top"?s+=e:t==="bottom"?s-=c+e:s-=c/2,s}function lr(i,t,e,s){const{caretSize:c,caretPadding:g,cornerRadius:m}=i,{xAlign:o,yAlign:n}=e,l=c+g,{topLeft:u,topRight:r,bottomLeft:h,bottomRight:a}=be(m);let d=Eu(t,o);const p=Fu(t,n,l);return n==="center"?o==="left"?d+=l:o==="right"&&(d-=l):o==="left"?d-=Math.max(u,h)+c:o==="right"&&(d+=Math.max(r,a)+c),{x:Mt(d,0,s.width-t.width),y:Mt(p,0,s.height-t.height)}}function Oi(i,t,e){const s=At(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-s.right:i.x+s.left}function hr(i){return Nt([],qt(i))}function Lu(i,t,e){return ce(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function cr(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const So={beforeTitle:Gt,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Gt,beforeBody:Gt,beforeLabel:Gt,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return dt(e)||(t+=e),t},labelColor(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Gt,afterBody:Gt,beforeFooter:Gt,footer:Gt,afterFooter:Gt};function Lt(i,t,e,s){const c=i[t].call(e,s);return typeof c>"u"?So[t].call(e,s):c}class Tn extends ee{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),c=s.enabled&&e.options.animation&&s.animations,g=new eo(this.chart,c);return c._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=Lu(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,c=Lt(s,"beforeTitle",this,t),g=Lt(s,"title",this,t),m=Lt(s,"afterTitle",this,t);let o=[];return o=Nt(o,qt(c)),o=Nt(o,qt(g)),o=Nt(o,qt(m)),o}getBeforeBody(t,e){return hr(Lt(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,c=[];return pt(t,g=>{const m={before:[],lines:[],after:[]},o=cr(s,g);Nt(m.before,qt(Lt(o,"beforeLabel",this,g))),Nt(m.lines,Lt(o,"label",this,g)),Nt(m.after,qt(Lt(o,"afterLabel",this,g))),c.push(m)}),c}getAfterBody(t,e){return hr(Lt(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,c=Lt(s,"beforeFooter",this,t),g=Lt(s,"footer",this,t),m=Lt(s,"afterFooter",this,t);let o=[];return o=Nt(o,qt(c)),o=Nt(o,qt(g)),o=Nt(o,qt(m)),o}_createItems(t){const e=this._active,s=this.chart.data,c=[],g=[],m=[];let o=[],n,l;for(n=0,l=e.length;n<l;++n)o.push(Mu(this.chart,e[n]));return t.filter&&(o=o.filter((u,r,h)=>t.filter(u,r,h,s))),t.itemSort&&(o=o.sort((u,r)=>t.itemSort(u,r,s))),pt(o,u=>{const r=cr(t.callbacks,u);c.push(Lt(r,"labelColor",this,u)),g.push(Lt(r,"labelPointStyle",this,u)),m.push(Lt(r,"labelTextColor",this,u))}),this.labelColors=c,this.labelPointStyles=g,this.labelTextColors=m,this.dataPoints=o,o}update(t,e){const s=this.options.setContext(this.getContext()),c=this._active;let g,m=[];if(!c.length)this.opacity!==0&&(g={opacity:0});else{const o=Xe[s.position].call(this,c,this._eventPosition);m=this._createItems(s),this.title=this.getTitle(m,s),this.beforeBody=this.getBeforeBody(m,s),this.body=this.getBody(m,s),this.afterBody=this.getAfterBody(m,s),this.footer=this.getFooter(m,s);const n=this._size=or(this,s),l=Object.assign({},o,n),u=ar(this.chart,s,l),r=lr(s,l,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,g={opacity:1,x:r.x,y:r.y,width:n.width,height:n.height,caretX:o.x,caretY:o.y}}this._tooltipItems=m,this.$context=void 0,g&&this._resolveAnimations().update(this,g),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,c){const g=this.getCaretPosition(t,s,c);e.lineTo(g.x1,g.y1),e.lineTo(g.x2,g.y2),e.lineTo(g.x3,g.y3)}getCaretPosition(t,e,s){const{xAlign:c,yAlign:g}=this,{caretSize:m,cornerRadius:o}=s,{topLeft:n,topRight:l,bottomLeft:u,bottomRight:r}=be(o),{x:h,y:a}=t,{width:d,height:p}=e;let f,v,_,b,y,x;return g==="center"?(y=a+p/2,c==="left"?(f=h,v=f-m,b=y+m,x=y-m):(f=h+d,v=f+m,b=y-m,x=y+m),_=f):(c==="left"?v=h+Math.max(n,u)+m:c==="right"?v=h+d-Math.max(l,r)-m:v=this.caretX,g==="top"?(b=a,y=b-m,f=v-m,_=v+m):(b=a+p,y=b+m,f=v+m,_=v-m),x=b),{x1:f,x2:v,x3:_,y1:b,y2:y,y3:x}}drawTitle(t,e,s){const c=this.title,g=c.length;let m,o,n;if(g){const l=Pe(s.rtl,this.x,this.width);for(t.x=Oi(this,s.titleAlign,s),e.textAlign=l.textAlign(s.titleAlign),e.textBaseline="middle",m=Tt(s.titleFont),o=s.titleSpacing,e.fillStyle=s.titleColor,e.font=m.string,n=0;n<g;++n)e.fillText(c[n],l.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+o,n+1===g&&(t.y+=s.titleMarginBottom-o)}}_drawColorBox(t,e,s,c,g){const m=this.labelColors[s],o=this.labelPointStyles[s],{boxHeight:n,boxWidth:l}=g,u=Tt(g.bodyFont),r=Oi(this,"left",g),h=c.x(r),a=n<u.lineHeight?(u.lineHeight-n)/2:0,d=e.y+a;if(g.usePointStyle){const p={radius:Math.min(l,n)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},f=c.leftForLtr(h,l)+l/2,v=d+n/2;t.strokeStyle=g.multiKeyBackground,t.fillStyle=g.multiKeyBackground,_n(t,p,f,v),t.strokeStyle=m.borderColor,t.fillStyle=m.backgroundColor,_n(t,p,f,v)}else{t.lineWidth=ct(m.borderWidth)?Math.max(...Object.values(m.borderWidth)):m.borderWidth||1,t.strokeStyle=m.borderColor,t.setLineDash(m.borderDash||[]),t.lineDashOffset=m.borderDashOffset||0;const p=c.leftForLtr(h,l),f=c.leftForLtr(c.xPlus(h,1),l-2),v=be(m.borderRadius);Object.values(v).some(_=>_!==0)?(t.beginPath(),t.fillStyle=g.multiKeyBackground,oi(t,{x:p,y:d,w:l,h:n,radius:v}),t.fill(),t.stroke(),t.fillStyle=m.backgroundColor,t.beginPath(),oi(t,{x:f,y:d+1,w:l-2,h:n-2,radius:v}),t.fill()):(t.fillStyle=g.multiKeyBackground,t.fillRect(p,d,l,n),t.strokeRect(p,d,l,n),t.fillStyle=m.backgroundColor,t.fillRect(f,d+1,l-2,n-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:c}=this,{bodySpacing:g,bodyAlign:m,displayColors:o,boxHeight:n,boxWidth:l,boxPadding:u}=s,r=Tt(s.bodyFont);let h=r.lineHeight,a=0;const d=Pe(s.rtl,this.x,this.width),p=function(O){e.fillText(O,d.x(t.x+a),t.y+h/2),t.y+=h+g},f=d.textAlign(m);let v,_,b,y,x,C,S;for(e.textAlign=m,e.textBaseline="middle",e.font=r.string,t.x=Oi(this,f,s),e.fillStyle=s.bodyColor,pt(this.beforeBody,p),a=o&&f!=="right"?m==="center"?l/2+u:l+2+u:0,y=0,C=c.length;y<C;++y){for(v=c[y],_=this.labelTextColors[y],e.fillStyle=_,pt(v.before,p),b=v.lines,o&&b.length&&(this._drawColorBox(e,t,y,d,s),h=Math.max(r.lineHeight,n)),x=0,S=b.length;x<S;++x)p(b[x]),h=r.lineHeight;pt(v.after,p)}a=0,h=r.lineHeight,pt(this.afterBody,p),t.y-=g}drawFooter(t,e,s){const c=this.footer,g=c.length;let m,o;if(g){const n=Pe(s.rtl,this.x,this.width);for(t.x=Oi(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=n.textAlign(s.footerAlign),e.textBaseline="middle",m=Tt(s.footerFont),e.fillStyle=s.footerColor,e.font=m.string,o=0;o<g;++o)e.fillText(c[o],n.x(t.x),t.y+m.lineHeight/2),t.y+=m.lineHeight+s.footerSpacing}}drawBackground(t,e,s,c){const{xAlign:g,yAlign:m}=this,{x:o,y:n}=t,{width:l,height:u}=s,{topLeft:r,topRight:h,bottomLeft:a,bottomRight:d}=be(c.cornerRadius);e.fillStyle=c.backgroundColor,e.strokeStyle=c.borderColor,e.lineWidth=c.borderWidth,e.beginPath(),e.moveTo(o+r,n),m==="top"&&this.drawCaret(t,e,s,c),e.lineTo(o+l-h,n),e.quadraticCurveTo(o+l,n,o+l,n+h),m==="center"&&g==="right"&&this.drawCaret(t,e,s,c),e.lineTo(o+l,n+u-d),e.quadraticCurveTo(o+l,n+u,o+l-d,n+u),m==="bottom"&&this.drawCaret(t,e,s,c),e.lineTo(o+a,n+u),e.quadraticCurveTo(o,n+u,o,n+u-a),m==="center"&&g==="left"&&this.drawCaret(t,e,s,c),e.lineTo(o,n+r),e.quadraticCurveTo(o,n,o+r,n),e.closePath(),e.fill(),c.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,c=s&&s.x,g=s&&s.y;if(c||g){const m=Xe[t.position].call(this,this._active,this._eventPosition);if(!m)return;const o=this._size=or(this,t),n=Object.assign({},m,this._size),l=ar(e,t,n),u=lr(t,n,l,e);(c._to!==u.x||g._to!==u.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=o.width,this.height=o.height,this.caretX=m.x,this.caretY=m.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const c={width:this.width,height:this.height},g={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const m=At(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=s,this.drawBackground(g,t,c,e),Kr(t,e.textDirection),g.y+=m.top,this.drawTitle(g,t,e),this.drawBody(g,t,e),this.drawFooter(g,t,e),Qr(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,c=t.map(({datasetIndex:o,index:n})=>{const l=this.chart.getDatasetMeta(o);if(!l)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:l.data[n],index:n}}),g=!zi(s,c),m=this._positionChanged(c,e);(g||m)&&(this._active=c,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const c=this.options,g=this._active||[],m=this._getActiveElements(t,g,e,s),o=this._positionChanged(m,t),n=e||!zi(m,g)||o;return n&&(this._active=m,(c.enabled||c.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),n}_getActiveElements(t,e,s,c){const g=this.options;if(t.type==="mouseout")return[];if(!c)return e;const m=this.chart.getElementsAtEventForMode(t,g.mode,g,s);return g.reverse&&m.reverse(),m}_positionChanged(t,e){const{caretX:s,caretY:c,options:g}=this,m=Xe[g.position].call(this,t,e);return m!==!1&&(s!==m.x||c!==m.y)}}Z(Tn,"positioners",Xe);var Ru={id:"tooltip",_element:Tn,positioners:Xe,afterInit(i,t,e){e&&(i.tooltip=new Tn({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:So},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Iu=Object.freeze({__proto__:null,Colors:$c,Decimation:Jc,Filler:_u,Legend:wu,SubTitle:ku,Title:Ou,Tooltip:Ru});const Bu=(i,t,e,s)=>(typeof t=="string"?(e=i.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function ju(i,t,e,s){const c=i.indexOf(t);if(c===-1)return Bu(i,t,e,s);const g=i.lastIndexOf(t);return c!==g?e:c}const zu=(i,t)=>i===null?null:Mt(Math.round(i),0,t);function ur(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class On extends Se{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:c,label:g}of e)s[c]===g&&s.splice(c,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(dt(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:ju(s,t,ht(e,t),this._addedLabels),zu(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:c}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(c=this.getLabels().length-1)),this.min=s,this.max=c}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,c=[];let g=this.getLabels();g=t===0&&e===g.length-1?g:g.slice(t,e+1),this._valueRange=Math.max(g.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let m=t;m<=e;m++)c.push({value:m});return c}getLabelForValue(t){return ur.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}Z(On,"id","category"),Z(On,"defaults",{ticks:{callback:ur}});function Wu(i,t){const e=[],{bounds:c,step:g,min:m,max:o,precision:n,count:l,maxTicks:u,maxDigits:r,includeBounds:h}=i,a=g||1,d=u-1,{min:p,max:f}=t,v=!dt(m),_=!dt(o),b=!dt(l),y=(f-p)/(r+1);let x=rs((f-p)/d/a)*a,C,S,O,E;if(x<1e-14&&!v&&!_)return[{value:p},{value:f}];E=Math.ceil(f/x)-Math.floor(p/x),E>d&&(x=rs(E*x/d/a)*a),dt(n)||(C=Math.pow(10,n),x=Math.ceil(x*C)/C),c==="ticks"?(S=Math.floor(p/x)*x,O=Math.ceil(f/x)*x):(S=p,O=f),v&&_&&g&&La((o-m)/g,x/1e3)?(E=Math.round(Math.min((o-m)/x,u)),x=(o-m)/E,S=m,O=o):b?(S=v?m:S,O=_?o:O,E=l-1,x=(O-S)/E):(E=(O-S)/x,qe(E,Math.round(E),x/1e3)?E=Math.round(E):E=Math.ceil(E));const R=Math.max(os(x),os(S));C=Math.pow(10,dt(n)?R:n),S=Math.round(S*C)/C,O=Math.round(O*C)/C;let z=0;for(v&&(h&&S!==m?(e.push({value:m}),S<m&&z++,qe(Math.round((S+z*x)*C)/C,m,fr(m,y,i))&&z++):S<m&&z++);z<E;++z){const V=Math.round((S+z*x)*C)/C;if(_&&V>o)break;e.push({value:V})}return _&&h&&O!==o?e.length&&qe(e[e.length-1].value,o,fr(o,y,i))?e[e.length-1].value=o:e.push({value:o}):(!_||O===o)&&e.push({value:O}),e}function fr(i,t,{horizontal:e,minRotation:s}){const c=Wt(s),g=(e?Math.sin(c):Math.cos(c))||.001,m=.75*t*(""+i).length;return Math.min(t/g,m)}class Ui extends Se{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return dt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:c,max:g}=this;const m=n=>c=e?c:n,o=n=>g=s?g:n;if(t){const n=Ut(c),l=Ut(g);n<0&&l<0?o(0):n>0&&l>0&&m(0)}if(c===g){let n=g===0?1:Math.abs(g*.05);o(g+n),t||m(c-n)}this.min=c,this.max=g}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,c;return s?(c=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,c>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${c} ticks. Limiting to 1000.`),c=1e3)):(c=this.computeTickLimit(),e=e||11),e&&(c=Math.min(e,c)),c}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const c={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},g=this._range||this,m=Wu(c,g);return t.bounds==="ticks"&&Er(m,this,"value"),t.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const c=(s-e)/Math.max(t.length-1,1)/2;e-=c,s+=c}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return fi(t,this.chart.options.locale,this.options.ticks.format)}}class kn extends Ui{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=xt(t)?t:0,this.max=xt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=Wt(this.options.ticks.minRotation),c=(t?Math.sin(s):Math.cos(s))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,g.lineHeight/c))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}Z(kn,"id","linear"),Z(kn,"defaults",{ticks:{callback:$i.formatters.numeric}});const li=i=>Math.floor(ne(i)),pe=(i,t)=>Math.pow(10,li(i)+t);function dr(i){return i/Math.pow(10,li(i))===1}function gr(i,t,e){const s=Math.pow(10,e),c=Math.floor(i/s);return Math.ceil(t/s)-c}function Hu(i,t){const e=t-i;let s=li(e);for(;gr(i,t,s)>10;)s++;for(;gr(i,t,s)<10;)s--;return Math.min(s,li(i))}function Vu(i,{min:t,max:e}){t=Bt(i.min,t);const s=[],c=li(t);let g=Hu(t,e),m=g<0?Math.pow(10,Math.abs(g)):1;const o=Math.pow(10,g),n=c>g?Math.pow(10,c):0,l=Math.round((t-n)*m)/m,u=Math.floor((t-n)/o/10)*o*10;let r=Math.floor((l-u)/Math.pow(10,g)),h=Bt(i.min,Math.round((n+u+r*Math.pow(10,g))*m)/m);for(;h<e;)s.push({value:h,major:dr(h),significand:r}),r>=10?r=r<15?15:20:r++,r>=20&&(g++,r=2,m=g>=0?1:m),h=Math.round((n+u+r*Math.pow(10,g))*m)/m;const a=Bt(i.max,h);return s.push({value:a,major:dr(a),significand:r}),s}class Mn extends Se{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=Ui.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return xt(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=xt(t)?Math.max(0,t):null,this.max=xt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!xt(this._userMin)&&(this.min=t===pe(this.min,0)?pe(this.min,-1):pe(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,c=this.max;const g=o=>s=t?s:o,m=o=>c=e?c:o;s===c&&(s<=0?(g(1),m(10)):(g(pe(s,-1)),m(pe(c,1)))),s<=0&&g(pe(c,-1)),c<=0&&m(pe(s,1)),this.min=s,this.max=c}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=Vu(e,this);return t.bounds==="ticks"&&Er(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":fi(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=ne(t),this._valueRange=ne(this.max)-ne(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(ne(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}Z(Mn,"id","logarithmic"),Z(Mn,"defaults",{ticks:{callback:$i.formatters.logarithmic,major:{enabled:!0}}});function Pn(i){const t=i.ticks;if(t.display&&i.display){const e=At(t.backdropPadding);return ht(t.font&&t.font.size,Ct.font.size)+e.height}return 0}function Nu(i,t,e){return e=vt(e)?e:[e],{w:Qa(i,t.string,e),h:e.length*t.lineHeight}}function pr(i,t,e,s,c){return i===s||i===c?{start:t-e/2,end:t+e/2}:i<s||i>c?{start:t-e,end:t}:{start:t,end:t+e}}function Yu(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),s=[],c=[],g=i._pointLabels.length,m=i.options.pointLabels,o=m.centerPointLabels?bt/g:0;for(let n=0;n<g;n++){const l=m.setContext(i.getPointLabelContext(n));c[n]=l.padding;const u=i.getPointPosition(n,i.drawingArea+c[n],o),r=Tt(l.font),h=Nu(i.ctx,r,i._pointLabels[n]);s[n]=h;const a=jt(i.getIndexAngle(n)+o),d=Math.round(Rn(a)),p=pr(d,u.x,h.w,0,180),f=pr(d,u.y,h.h,90,270);Xu(e,t,a,p,f)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=$u(i,s,c)}function Xu(i,t,e,s,c){const g=Math.abs(Math.sin(e)),m=Math.abs(Math.cos(e));let o=0,n=0;s.start<t.l?(o=(t.l-s.start)/g,i.l=Math.min(i.l,t.l-o)):s.end>t.r&&(o=(s.end-t.r)/g,i.r=Math.max(i.r,t.r+o)),c.start<t.t?(n=(t.t-c.start)/m,i.t=Math.min(i.t,t.t-n)):c.end>t.b&&(n=(c.end-t.b)/m,i.b=Math.max(i.b,t.b+n))}function Uu(i,t,e){const s=i.drawingArea,{extra:c,additionalAngle:g,padding:m,size:o}=e,n=i.getPointPosition(t,s+c+m,g),l=Math.round(Rn(jt(n.angle+St))),u=Qu(n.y,o.h,l),r=qu(l),h=Ku(n.x,o.w,r);return{visible:!0,x:n.x,y:u,textAlign:r,left:h,top:u,right:h+o.w,bottom:u+o.h}}function Gu(i,t){if(!t)return!0;const{left:e,top:s,right:c,bottom:g}=i;return!(Zt({x:e,y:s},t)||Zt({x:e,y:g},t)||Zt({x:c,y:s},t)||Zt({x:c,y:g},t))}function $u(i,t,e){const s=[],c=i._pointLabels.length,g=i.options,{centerPointLabels:m,display:o}=g.pointLabels,n={extra:Pn(g)/2,additionalAngle:m?bt/c:0};let l;for(let u=0;u<c;u++){n.padding=e[u],n.size=t[u];const r=Uu(i,u,n);s.push(r),o==="auto"&&(r.visible=Gu(r,l),r.visible&&(l=r))}return s}function qu(i){return i===0||i===180?"center":i<180?"left":"right"}function Ku(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function Qu(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function Ju(i,t,e){const{left:s,top:c,right:g,bottom:m}=e,{backdropColor:o}=t;if(!dt(o)){const n=be(t.borderRadius),l=At(t.backdropPadding);i.fillStyle=o;const u=s-l.left,r=c-l.top,h=g-s+l.width,a=m-c+l.height;Object.values(n).some(d=>d!==0)?(i.beginPath(),oi(i,{x:u,y:r,w:h,h:a,radius:n}),i.fill()):i.fillRect(u,r,h,a)}}function Zu(i,t){const{ctx:e,options:{pointLabels:s}}=i;for(let c=t-1;c>=0;c--){const g=i._pointLabelItems[c];if(!g.visible)continue;const m=s.setContext(i.getPointLabelContext(c));Ju(e,m,g);const o=Tt(m.font),{x:n,y:l,textAlign:u}=g;Ce(e,i._pointLabels[c],n,l+o.lineHeight/2,o,{color:m.color,textAlign:u,textBaseline:"middle"})}}function wo(i,t,e,s){const{ctx:c}=i;if(e)c.arc(i.xCenter,i.yCenter,t,0,_t);else{let g=i.getPointPosition(0,t);c.moveTo(g.x,g.y);for(let m=1;m<s;m++)g=i.getPointPosition(m,t),c.lineTo(g.x,g.y)}}function tf(i,t,e,s,c){const g=i.ctx,m=t.circular,{color:o,lineWidth:n}=t;!m&&!s||!o||!n||e<0||(g.save(),g.strokeStyle=o,g.lineWidth=n,g.setLineDash(c.dash),g.lineDashOffset=c.dashOffset,g.beginPath(),wo(i,e,m,s),g.closePath(),g.stroke(),g.restore())}function ef(i,t,e){return ce(i,{label:e,index:t,type:"pointLabel"})}class Ue extends Ui{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=At(Pn(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=xt(t)&&!isNaN(t)?t:0,this.max=xt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Pn(this.options))}generateTickLabels(t){Ui.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const c=mt(this.options.pointLabels.callback,[e,s],this);return c||c===0?c:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?Yu(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,c){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-c)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,c))}getIndexAngle(t){const e=_t/(this._pointLabels.length||1),s=this.options.startAngle||0;return jt(t*e+Wt(s))}getDistanceFromCenterForValue(t){if(dt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(dt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return ef(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const c=this.getIndexAngle(t)-St+s;return{x:Math.cos(c)*e+this.xCenter,y:Math.sin(c)*e+this.yCenter,angle:c}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:c,bottom:g}=this._pointLabelItems[t];return{left:e,top:s,right:c,bottom:g}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),wo(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:c,border:g}=e,m=this._pointLabels.length;let o,n,l;if(e.pointLabels.display&&Zu(this,m),c.display&&this.ticks.forEach((u,r)=>{if(r!==0){n=this.getDistanceFromCenterForValue(u.value);const h=this.getContext(r),a=c.setContext(h),d=g.setContext(h);tf(this,a,n,m,d)}}),s.display){for(t.save(),o=m-1;o>=0;o--){const u=s.setContext(this.getPointLabelContext(o)),{color:r,lineWidth:h}=u;!h||!r||(t.lineWidth=h,t.strokeStyle=r,t.setLineDash(u.borderDash),t.lineDashOffset=u.borderDashOffset,n=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(o,n),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const c=this.getIndexAngle(0);let g,m;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(c),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((o,n)=>{if(n===0&&!e.reverse)return;const l=s.setContext(this.getContext(n)),u=Tt(l.font);if(g=this.getDistanceFromCenterForValue(this.ticks[n].value),l.showLabelBackdrop){t.font=u.string,m=t.measureText(o.label).width,t.fillStyle=l.backdropColor;const r=At(l.backdropPadding);t.fillRect(-m/2-r.left,-g-u.size/2-r.top,m+r.width,u.size+r.height)}Ce(t,o.label,0,-g,u,{color:l.color,strokeColor:l.textStrokeColor,strokeWidth:l.textStrokeWidth})}),t.restore()}drawTitle(){}}Z(Ue,"id","radialLinear"),Z(Ue,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:$i.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),Z(Ue,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Z(Ue,"descriptors",{angleLines:{_fallback:"grid"}});const Ji={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},It=Object.keys(Ji);function mr(i,t){return i-t}function vr(i,t){if(dt(t))return null;const e=i._adapter,{parser:s,round:c,isoWeekday:g}=i._parseOpts;let m=t;return typeof s=="function"&&(m=s(m)),xt(m)||(m=typeof s=="string"?e.parse(m,s):e.parse(m)),m===null?null:(c&&(m=c==="week"&&(De(g)||g===!0)?e.startOf(m,"isoWeek",g):e.startOf(m,c)),+m)}function _r(i,t,e,s){const c=It.length;for(let g=It.indexOf(i);g<c-1;++g){const m=Ji[It[g]],o=m.steps?m.steps:Number.MAX_SAFE_INTEGER;if(m.common&&Math.ceil((e-t)/(o*m.size))<=s)return It[g]}return It[c-1]}function nf(i,t,e,s,c){for(let g=It.length-1;g>=It.indexOf(e);g--){const m=It[g];if(Ji[m].common&&i._adapter.diff(c,s,m)>=t-1)return m}return It[e?It.indexOf(e):0]}function sf(i){for(let t=It.indexOf(i)+1,e=It.length;t<e;++t)if(Ji[It[t]].common)return It[t]}function br(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:s,hi:c}=In(e,t),g=e[s]>=t?e[s]:e[c];i[g]=!0}}function rf(i,t,e,s){const c=i._adapter,g=+c.startOf(t[0].value,s),m=t[t.length-1].value;let o,n;for(o=g;o<=m;o=+c.add(o,1,s))n=e[o],n>=0&&(t[n].major=!0);return t}function yr(i,t,e){const s=[],c={},g=t.length;let m,o;for(m=0;m<g;++m)o=t[m],c[o]=m,s.push({value:o,major:!1});return g===0||!e?s:rf(i,s,c,e)}class hi extends Se{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),c=this._adapter=new dh._date(t.adapters.date);c.init(e),$e(s.displayFormats,c.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:vr(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:c,max:g,minDefined:m,maxDefined:o}=this.getUserBounds();function n(l){!m&&!isNaN(l.min)&&(c=Math.min(c,l.min)),!o&&!isNaN(l.max)&&(g=Math.max(g,l.max))}(!m||!o)&&(n(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&n(this.getMinMax(!1))),c=xt(c)&&!isNaN(c)?c:+e.startOf(Date.now(),s),g=xt(g)&&!isNaN(g)?g:+e.endOf(Date.now(),s)+1,this.min=Math.min(c,g-1),this.max=Math.max(c+1,g)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,c=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&c.length&&(this.min=this._userMin||c[0],this.max=this._userMax||c[c.length-1]);const g=this.min,m=this.max,o=ja(c,g,m);return this._unit=e.unit||(s.autoSkip?_r(e.minUnit,this.min,this.max,this._getLabelCapacity(g)):nf(this,o.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:sf(this._unit),this.initOffsets(c),t.reverse&&o.reverse(),yr(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,c,g;this.options.offset&&t.length&&(c=this.getDecimalForValue(t[0]),t.length===1?e=1-c:e=(this.getDecimalForValue(t[1])-c)/2,g=this.getDecimalForValue(t[t.length-1]),t.length===1?s=g:s=(g-this.getDecimalForValue(t[t.length-2]))/2);const m=t.length<3?.5:.25;e=Mt(e,0,m),s=Mt(s,0,m),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,c=this.options,g=c.time,m=g.unit||_r(g.minUnit,e,s,this._getLabelCapacity(e)),o=ht(c.ticks.stepSize,1),n=m==="week"?g.isoWeekday:!1,l=De(n)||n===!0,u={};let r=e,h,a;if(l&&(r=+t.startOf(r,"isoWeek",n)),r=+t.startOf(r,l?"day":m),t.diff(s,e,m)>1e5*o)throw new Error(e+" and "+s+" are too far apart with stepSize of "+o+" "+m);const d=c.ticks.source==="data"&&this.getDataTimestamps();for(h=r,a=0;h<s;h=+t.add(h,o,m),a++)br(u,h,d);return(h===s||c.bounds==="ticks"||a===1)&&br(u,h,d),Object.keys(u).sort(mr).map(p=>+p)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const c=this.options.time.displayFormats,g=this._unit,m=e||c[g];return this._adapter.format(t,m)}_tickFormatFunction(t,e,s,c){const g=this.options,m=g.ticks.callback;if(m)return mt(m,[t,e,s],this);const o=g.time.displayFormats,n=this._unit,l=this._majorUnit,u=n&&o[n],r=l&&o[l],h=s[e],a=l&&r&&h&&h.major;return this._adapter.format(t,c||(a?r:u))}generateTickLabels(t){let e,s,c;for(e=0,s=t.length;e<s;++e)c=t[e],c.label=this._tickFormatFunction(c.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,c=Wt(this.isHorizontal()?e.maxRotation:e.minRotation),g=Math.cos(c),m=Math.sin(c),o=this._resolveTickFontOptions(0).size;return{w:s*g+o*m,h:s*m+o*g}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,c=s[e.unit]||s.millisecond,g=this._tickFormatFunction(t,0,yr(this,[t],this._majorUnit),c),m=this._getLabelSize(g),o=Math.floor(this.isHorizontal()?this.width/m.w:this.height/m.h)-1;return o>0?o:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const c=this.getMatchingVisibleMetas();if(this._normalized&&c.length)return this._cache.data=c[0].controller.getAllParsedValues(this);for(e=0,s=c.length;e<s;++e)t=t.concat(c[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const c=this.getLabels();for(e=0,s=c.length;e<s;++e)t.push(vr(this,c[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Rr(t.sort(mr))}}Z(hi,"id","time"),Z(hi,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function ki(i,t,e){let s=0,c=i.length-1,g,m,o,n;e?(t>=i[s].pos&&t<=i[c].pos&&({lo:s,hi:c}=Jt(i,"pos",t)),{pos:g,time:o}=i[s],{pos:m,time:n}=i[c]):(t>=i[s].time&&t<=i[c].time&&({lo:s,hi:c}=Jt(i,"time",t)),{time:g,pos:o}=i[s],{time:m,pos:n}=i[c]);const l=m-g;return l?o+(n-o)*(t-g)/l:o}class Dn extends hi{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=ki(e,this.min),this._tableRange=ki(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,c=[],g=[];let m,o,n,l,u;for(m=0,o=t.length;m<o;++m)l=t[m],l>=e&&l<=s&&c.push(l);if(c.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(m=0,o=c.length;m<o;++m)u=c[m+1],n=c[m-1],l=c[m],Math.round((u+n)/2)!==l&&g.push({time:l,pos:m/(o-1)});return g}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((c,g)=>c-g)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(ki(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return ki(this._table,s*this._tableRange+this._minPos,!0)}}Z(Dn,"id","timeseries"),Z(Dn,"defaults",hi.defaults);var of=Object.freeze({__proto__:null,CategoryScale:On,LinearScale:kn,LogarithmicScale:Mn,RadialLinearScale:Ue,TimeScale:hi,TimeSeriesScale:Dn});const af=[fh,Vc,Iu,of];Xt.register(...af);function lf(i){let t,e,s,c,g,m,o,n,l,u,r,h,a,d,p,f;return{c(){t=ut("div"),e=ut("h2"),e.textContent="Perceptron (1-layer Neural Network) Hyperparameters",s=Ft(),c=ut("label"),g=te(`Learning Rate
                `),m=ut("input"),o=Ft(),n=ut("label"),l=te(`Max Iteration
                `),u=ut("input"),r=Ft(),h=ut("label"),a=te(`Min Error Rate
                `),d=ut("input"),kt(m,"type","number"),kt(u,"type","number"),kt(d,"type","number"),kt(t,"class","param"),kt(t,"id","perceptron_param")},m(v,_){Gi(v,t,_),ot(t,e),ot(t,s),ot(t,c),ot(c,g),ot(c,m),Ot(m,i[3].learning_rate),ot(t,o),ot(t,n),ot(n,l),ot(n,u),Ot(u,i[3].max_iter),ot(t,r),ot(t,h),ot(h,a),ot(h,d),Ot(d,i[3].min_error_rate),p||(f=[oe(m,"input",i[9]),oe(u,"input",i[10]),oe(d,"input",i[11])],p=!0)},p(v,_){_&8&&Rt(m.value)!==v[3].learning_rate&&Ot(m,v[3].learning_rate),_&8&&Rt(u.value)!==v[3].max_iter&&Ot(u,v[3].max_iter),_&8&&Rt(d.value)!==v[3].min_error_rate&&Ot(d,v[3].min_error_rate)},d(v){v&&ci(t),p=!1,Fe(f)}}}function hf(i){let t,e,s,c,g,m,o,n;return{c(){t=ut("div"),e=ut("h2"),e.textContent="K Nearest Neighbors Hyperparameters",s=Ft(),c=ut("label"),g=te(`K
                `),m=ut("input"),kt(m,"type","number"),kt(t,"class","param"),kt(t,"id","knn_param")},m(l,u){Gi(l,t,u),ot(t,e),ot(t,s),ot(t,c),ot(c,g),ot(c,m),Ot(m,i[2].k),o||(n=oe(m,"input",i[8]),o=!0)},p(l,u){u&4&&Rt(m.value)!==l[2].k&&Ot(m,l[2].k)},d(l){l&&ci(t),o=!1,n()}}}function cf(i){let t,e,s,c,g,m,o,n,l,u,r,h,a,d,p,f;return{c(){t=ut("div"),e=ut("h2"),e.textContent="K Means Hyperparameters",s=Ft(),c=ut("label"),g=te(`Number of Clusters (K)
                `),m=ut("input"),o=Ft(),n=ut("label"),l=te(`Max Iteration
                `),u=ut("input"),r=Ft(),h=ut("label"),a=te(`Min Distance
                `),d=ut("input"),kt(m,"type","number"),kt(u,"type","number"),kt(d,"type","number"),kt(t,"class","param"),kt(t,"id","kmeans_param")},m(v,_){Gi(v,t,_),ot(t,e),ot(t,s),ot(t,c),ot(c,g),ot(c,m),Ot(m,i[1].n_clusters),ot(t,o),ot(t,n),ot(n,l),ot(n,u),Ot(u,i[1].max_iter),ot(t,r),ot(t,h),ot(h,a),ot(h,d),Ot(d,i[1].min_dist),p||(f=[oe(m,"input",i[5]),oe(u,"input",i[6]),oe(d,"input",i[7])],p=!0)},p(v,_){_&2&&Rt(m.value)!==v[1].n_clusters&&Ot(m,v[1].n_clusters),_&2&&Rt(u.value)!==v[1].max_iter&&Ot(u,v[1].max_iter),_&2&&Rt(d.value)!==v[1].min_dist&&Ot(d,v[1].min_dist)},d(v){v&&ci(t),p=!1,Fe(f)}}}function uf(i){let t,e,s,c,g,m,o,n,l,u,r,h,a,d,p,f,v,_,b,y,x,C,S,O,E,R;function z(G,Y){if(G[0]=="kmeans")return cf;if(G[0]=="knn")return hf;if(G[0]=="perceptron")return lf}let V=z(i),K=V&&V(i);return{c(){t=ut("main"),e=ut("h1"),e.textContent="Digit Recognizer",s=Ft(),c=ut("h2"),c.textContent="Try a pre-trained model",g=Ft(),m=ut("label"),o=ut("select"),n=ut("option"),n.textContent="model 1",l=Ft(),u=ut("div"),u.innerHTML='<div><p>Draw a digit:</p> <canvas id="canvas" class="svelte-owbo5l"></canvas> <button>Clear</button></div> <div><p>Probability Result</p> <canvas id="probability_chart" class="svelte-owbo5l"></canvas></div>',r=Ft(),h=ut("h2"),h.textContent="Train your own model!",a=Ft(),d=ut("label"),p=te(`Select a machine learning model to train:
        `),f=ut("select"),v=ut("option"),v.textContent="K Means",_=ut("option"),_.textContent="K Nearest Neighbors",b=ut("option"),b.textContent="Perceptron (1-layer Neural Network)",y=Ft(),K&&K.c(),x=Ft(),C=ut("div"),C.innerHTML='<button id="start">Start Training</button> <button id="stop">Stop</button>',S=Ft(),O=ut("canvas"),n.__value="model1",Ot(n,n.__value),kt(u,"class","grid"),v.__value="kmeans",Ot(v,v.__value),_.__value="knn",Ot(_,_.__value),b.__value="perceptron",Ot(b,b.__value),i[0]===void 0&&ji(()=>i[4].call(f)),kt(C,"class","grid"),kt(O,"id","training_chart"),kt(O,"class","svelte-owbo5l"),kt(t,"class","container")},m(G,Y){Gi(G,t,Y),ot(t,e),ot(t,s),ot(t,c),ot(t,g),ot(t,m),ot(m,o),ot(o,n),ot(t,l),ot(t,u),ot(t,r),ot(t,h),ot(t,a),ot(t,d),ot(d,p),ot(d,f),ot(f,v),ot(f,_),ot(f,b),qn(f,i[0],!0),ot(t,y),K&&K.m(t,null),ot(t,x),ot(t,C),ot(t,S),ot(t,O),E||(R=oe(f,"change",i[4]),E=!0)},p(G,[Y]){Y&1&&qn(f,G[0]),V===(V=z(G))&&K?K.p(G,Y):(K&&K.d(1),K=V&&V(G),K&&(K.c(),K.m(t,x)))},i:Ze,o:Ze,d(G){G&&ci(t),K&&K.d(),E=!1,R()}}}function ff(i,t,e){Ro(()=>{const p=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9];new Xt("probability_chart",{type:"bar",data:{labels:p.map((_,b)=>b),datasets:[{label:"Probability",data:p}]},options:{responsive:!0}});const f=Array.from({length:100},(_,b)=>1/b);new Xt("training_chart",{type:"line",data:{labels:f.map((_,b)=>b),datasets:[{label:"Error Rate",data:f}]}});const v=new Or.fabric.Canvas("canvas",{isDrawingMode:!0});v.freeDrawingBrush.color="white",v.freeDrawingBrush.width=10});let s="kmeans",c={n_clusters:10,max_iter:100,min_dist:.01},g={k:10},m={learning_rate:.1,max_iter:10,min_error_rate:.001};function o(){s=Fo(this),e(0,s)}function n(){c.n_clusters=Rt(this.value),e(1,c)}function l(){c.max_iter=Rt(this.value),e(1,c)}function u(){c.min_dist=Rt(this.value),e(1,c)}function r(){g.k=Rt(this.value),e(2,g)}function h(){m.learning_rate=Rt(this.value),e(3,m)}function a(){m.max_iter=Rt(this.value),e(3,m)}function d(){m.min_error_rate=Rt(this.value),e(3,m)}return[s,c,g,m,o,n,l,u,r,h,a,d]}class df extends Uo{constructor(t){super(),Xo(this,t,ff,uf,Do,{})}}async function gf(){const i=performance.now();await Tr();const t=performance.now();console.log(`wasm init took ${t-i} milliseconds`),new df({target:document.getElementById("app")})}gf();
