var $=Object.defineProperty;var H=(i,_,o)=>_ in i?$(i,_,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[_]=o;var A=(i,_,o)=>(H(i,typeof _!="symbol"?_+"":_,o),o);(function(){"use strict";let i;const _=new Array(128).fill(void 0);_.push(void 0,null,!0,!1);function o(n){return _[n]}let b=_.length;function O(n){n<132||(_[n]=b,b=n)}function T(n){const t=o(n);return O(n),t}const x=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&x.decode();let l=null;function y(){return(l===null||l.byteLength===0)&&(l=new Uint8Array(i.memory.buffer)),l}function p(n,t){return n=n>>>0,x.decode(y().subarray(n,n+t))}function s(n){b===_.length&&_.push(_.length+1);const t=b;return b=_[t],_[t]=n,t}function E(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`);return n.ptr}function S(){i.set_panic_hook()}let k=0;const h=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},U=typeof h.encodeInto=="function"?function(n,t){return h.encodeInto(n,t)}:function(n,t){const e=h.encode(n);return t.set(e),{read:n.length,written:e.length}};function C(n,t,e){if(e===void 0){const f=h.encode(n),m=t(f.length,1)>>>0;return y().subarray(m,m+f.length).set(f),k=f.length,m}let r=n.length,c=t(r,1)>>>0;const g=y();let a=0;for(;a<r;a++){const f=n.charCodeAt(a);if(f>127)break;g[c+a]=f}if(a!==r){a!==0&&(n=n.slice(a)),c=e(c,r,r=a+n.length*3,1)>>>0;const f=y().subarray(c+a,c+r),m=U(n,f);a+=m.written}return k=a,c}let d=null;function j(){return(d===null||d.byteLength===0)&&(d=new Int32Array(i.memory.buffer)),d}function u(n,t){try{return n.apply(this,t)}catch(e){i.__wbindgen_exn_store(s(e))}}class w{static __wrap(t){t=t>>>0;const e=Object.create(w.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();i.__wbg_dataset_free(t)}static mnist_training(){const t=i.dataset_mnist_training();return w.__wrap(t)}static mnist_testing(){const t=i.dataset_mnist_testing();return w.__wrap(t)}}class v{static __wrap(t){t=t>>>0;const e=Object.create(v.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();i.__wbg_kmeans_free(t)}constructor(t){const e=i.kmeans_new(t);return v.__wrap(e)}step(t){return E(t,w),i.kmeans_step(this.__wbg_ptr,t.__wbg_ptr)}evaluate(t){return E(t,w),i.kmeans_evaluate(this.__wbg_ptr,t.__wbg_ptr)}}async function F(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await n.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(n,t);return e instanceof WebAssembly.Instance?{instance:e,module:n}:e}}function L(){const n={};return n.wbg={},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return s(t)},n.wbg.__wbg_stack_658279fe44541cf6=function(t,e){const r=o(e).stack,c=C(r,i.__wbindgen_malloc,i.__wbindgen_realloc),g=k;j()[t/4+1]=g,j()[t/4+0]=c},n.wbg.__wbg_error_f851667af71bcfc6=function(t,e){let r,c;try{r=t,c=e,console.error(p(t,e))}finally{i.__wbindgen_free(r,c,1)}},n.wbg.__wbindgen_object_drop_ref=function(t){T(t)},n.wbg.__wbg_randomFillSync_dc1e9a60c158336d=function(){return u(function(t,e){o(t).randomFillSync(T(e))},arguments)},n.wbg.__wbg_getRandomValues_37fa2ca9e4e07fab=function(){return u(function(t,e){o(t).getRandomValues(o(e))},arguments)},n.wbg.__wbg_crypto_c48a774b022d20ac=function(t){const e=o(t).crypto;return s(e)},n.wbg.__wbindgen_is_object=function(t){const e=o(t);return typeof e=="object"&&e!==null},n.wbg.__wbg_process_298734cf255a885d=function(t){const e=o(t).process;return s(e)},n.wbg.__wbg_versions_e2e78e134e3e5d01=function(t){const e=o(t).versions;return s(e)},n.wbg.__wbg_node_1cd7a5d853dbea79=function(t){const e=o(t).node;return s(e)},n.wbg.__wbindgen_is_string=function(t){return typeof o(t)=="string"},n.wbg.__wbg_require_8f08ceecec0f4fee=function(){return u(function(){const t=module.require;return s(t)},arguments)},n.wbg.__wbindgen_string_new=function(t,e){const r=p(t,e);return s(r)},n.wbg.__wbg_msCrypto_bcb970640f50a1e8=function(t){const e=o(t).msCrypto;return s(e)},n.wbg.__wbindgen_is_function=function(t){return typeof o(t)=="function"},n.wbg.__wbg_newnoargs_581967eacc0e2604=function(t,e){const r=new Function(p(t,e));return s(r)},n.wbg.__wbg_call_cb65541d95d71282=function(){return u(function(t,e){const r=o(t).call(o(e));return s(r)},arguments)},n.wbg.__wbg_self_1ff1d729e9aae938=function(){return u(function(){const t=self.self;return s(t)},arguments)},n.wbg.__wbg_window_5f4faef6c12b79ec=function(){return u(function(){const t=window.window;return s(t)},arguments)},n.wbg.__wbg_globalThis_1d39714405582d3c=function(){return u(function(){const t=globalThis.globalThis;return s(t)},arguments)},n.wbg.__wbg_global_651f05c6a0944d1c=function(){return u(function(){const t=global.global;return s(t)},arguments)},n.wbg.__wbindgen_is_undefined=function(t){return o(t)===void 0},n.wbg.__wbg_call_01734de55d61e11d=function(){return u(function(t,e,r){const c=o(t).call(o(e),o(r));return s(c)},arguments)},n.wbg.__wbg_buffer_085ec1f694018c4f=function(t){const e=o(t).buffer;return s(e)},n.wbg.__wbg_newwithbyteoffsetandlength_6da8e527659b86aa=function(t,e,r){const c=new Uint8Array(o(t),e>>>0,r>>>0);return s(c)},n.wbg.__wbg_new_8125e318e6245eed=function(t){const e=new Uint8Array(o(t));return s(e)},n.wbg.__wbg_set_5cf90238115182c3=function(t,e,r){o(t).set(o(e),r>>>0)},n.wbg.__wbg_newwithlength_e5d69174d6984cd7=function(t){const e=new Uint8Array(t>>>0);return s(e)},n.wbg.__wbg_subarray_13db269f57aa838d=function(t,e,r){const c=o(t).subarray(e>>>0,r>>>0);return s(c)},n.wbg.__wbindgen_object_clone_ref=function(t){const e=o(t);return s(e)},n.wbg.__wbindgen_throw=function(t,e){throw new Error(p(t,e))},n.wbg.__wbindgen_memory=function(){const t=i.memory;return s(t)},n}function q(n,t){return i=n.exports,R.__wbindgen_wasm_module=t,d=null,l=null,i}async function R(n){if(i!==void 0)return i;typeof n>"u"&&(n=new URL("/digit-recognizer/assets/wasm_bg-d1db472f.wasm",self.location));const t=L();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:r}=await F(await n,t);return q(e,r)}let W,I;async function z(){const n=performance.now();await R();const t=performance.now();console.log(`wasm init took ${t-n} milliseconds`),S(),W=w.mnist_training(),I=w.mnist_testing()}async function D(n,t){postMessage({event:n,data:t})}class V{constructor(){A(this,"model");A(this,"interval_id")}start_training(t){this.stop_training(),this.model=new v(t.n_clusters);let e=0;this.interval_id=setInterval(()=>{var g,a;const r=(g=this.model)==null?void 0:g.step(W),c=(a=this.model)==null?void 0:a.evaluate(I);e++,D("step",{i:e,training_err:r,testing_err:c}),e>=t.max_iter&&this.stop_training()})}stop_training(){clearInterval(this.interval_id)}}const B=z(),M=new V;onmessage=async n=>{await B;const{event:t,data:e}=n.data;switch(t){case"start_training":console.log("[Worker] Received start training event"),M.start_training(e);break;case"stop_training":console.log("[Worker] Received stop training event"),M.stop_training();break}}})();
